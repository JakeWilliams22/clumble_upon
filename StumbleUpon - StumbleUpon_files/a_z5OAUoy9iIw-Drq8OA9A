require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var $, ActivityCenterC, ActivityNotificationM, Application, Backbone, BlockedParticipantsC, Chaplin, ContactsC, ErrorsController, ListItemsC, ListsC, Model, ModesC, ParticipantM, ParticipantsC, StumblesC, UserM, VisitorStumblesC, analytics, cookieDomain, hostname, mediator, root, routes, storage, urlPatternsToIgnore, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

require('../bower_components/poly/all');

$ = window.jQuery = require('jquery');

require('../bower_components/jquery.cookie/jquery.cookie');

require('../bower_components/jQuery.dotdotdot/src/js/jquery.dotdotdot.js');

require('../bower_components/Jcrop/js/Jcrop.js');

require('touchclick');

require('ajaxRetry');

require('../vendor/scripts/jquery.smartbanner.js');

require('../vendor/scripts/jquery.autogrow.js');

require('../vendor/scripts/taggle.js');

require('../bower_components/bootstrap-stylus/js/modal.js');

require('../bower_components/bootstrap-stylus/js/tooltip.js');

hostname = window.location.hostname;

if (hostname.match('stumbleupon.com')) {
  cookieDomain = '.stumbleupon.com';
} else if (hostname.match('stumble.net')) {
  cookieDomain = hostname.split('www').pop();
}

$.ajaxSetup({
  timeout: 45000
});

$.cookie.defaults = {
  path: '/',
  domain: cookieDomain
};

_ = require('lodash');

_.str = require('underscore.string');

_.mixin(_.str.exports());

_.str.include('Underscore.string', 'string');

Backbone = require('backbone');

Backbone.$ = $;

Chaplin = require('chaplin');

mediator = Chaplin.mediator;

window.Chaplin = Chaplin;

window.SUdebug = require('./su-debug');

routes = require('./routes');

urlPatternsToIgnore = require('./url-patterns-to-ignore');

ErrorsController = require('./controllers/errors-controller');

UserM = require('./models/user-model');

ModesC = require('./models/modes-collection');

ContactsC = require('./models/contacts-collection');

StumblesC = require('./models/stumbles-collection');

VisitorStumblesC = require('./models/visitor-stumbles-collection');

ActivityNotificationM = require('./models/activity-notification-model');

ListItemsC = require('./models/list-items-collection');

ParticipantsC = require('./models/participants-collection');

ParticipantM = require('./models/participant-model');

BlockedParticipantsC = require('./models/blocked-participants-collection');

ActivityCenterC = require('./models/activity-center-collection');

ListsC = require('./models/lists-collection');

storage = require('simple-storage');

utils = require('./lib/utils');

root = require('./lib/root');

Model = require('./models/base/model');

analytics = require('./lib/analytics');

setTimeout((function(_this) {
  return function() {
    return root().location.reload(true);
  };
})(this), utils.toMs('12h'));

module.exports = Application = (function(_super) {
  __extends(Application, _super);

  function Application() {
    return Application.__super__.constructor.apply(this, arguments);
  }

  Application.prototype.initialize = function(options) {
    var ignorePatterns, ignoreRegEx;
    ignorePatterns = urlPatternsToIgnore.join('|');
    ignoreRegEx = new RegExp(ignorePatterns);
    if (ignoreRegEx.test(window.location.href)) {
      return;
    } else if ((window.location === window.top.location) || (window.location.pathname === '/submit' && window.top.location.hostname.match(/stumbleupon.com|stumble.net/)) || window.top.location.hostname.match('optimizely')) {
      Application.__super__.initialize.apply(this, arguments);
      this.initControllers();
    } else {
      utils.gotoNoToolbarUrl();
    }
    if (utils.isiOS()) {
      $('html').addClass('ios');
    }
    if (utils.isIpad()) {
      $('html').addClass('ipad');
    }
    if (utils.isAndroid()) {
      $('html').addClass('android');
    }
    if (utils.isMobile()) {
      return $('html').addClass('mobile');
    }
  };

  Application.prototype.initControllers = function() {
    return this.errorsController = new ErrorsController;
  };

  Application.prototype.initMediator = function() {
    var currentTime, fromEmail, referrer, referrerDomain, webfont, _ref;
    mediator.canTransition = false;
    mediator.transitionWasChecked = false;
    mediator.userM = new UserM({}, {
      parse: false,
      auth: !utils.isVisitor()
    });
    mediator.participantM = new ParticipantM;
    mediator.modesC = new ModesC;
    mediator.contactsC = new ContactsC;
    this.initStumblesCollection();
    mediator.listItemsC = new ListItemsC;
    mediator.listsC = new ListsC;
    mediator.blockedParticipantsC = new BlockedParticipantsC;
    mediator.activityNotificationM = new ActivityNotificationM;
    mediator.conversationC = new ActivityCenterC([], {
      scope: 'conversation'
    });
    mediator.activityFollowC = new ActivityCenterC([], {
      scope: 'follow'
    });
    mediator.loadTimes = [];
    mediator.currentProfileM = new Model;
    mediator.update = false;
    mediator.sessionStumbleViews = 0;
    mediator.profileItemsPerPage = 30;
    mediator.progressBarOpen = false;
    mediator.triedDeepLinking = false;
    mediator.maxConvoParticipants = 25;
    mediator.timeToFirstStumble = null;
    mediator.visitorStumbleCount = 0;
    mediator.visitorStumbleCountMax = 1;
    mediator.dismissedTutorial = false;
    mediator.currentRoute = null;
    mediator.overrideBrowserAddonEnabled = false;
    mediator.seal();
    webfont = require('./lib/webfont');
    webfont.loadAll();
    utils.clearLegacyCookies();
    fromEmail = (_ref = utils.queryParams.parse(root().location.href)) != null ? _ref.fromEmail : void 0;
    if (fromEmail) {
      analytics.trackEvent("fromEmail:" + fromEmail);
    }
    referrer = root().document.referrer;
    if (referrer) {
      referrerDomain = utils.getDomain(referrer);
      analytics.trackEvent("referrer:" + referrerDomain);
    }
    if (!storage.get('collections-fv', 'local')) {
      currentTime = new Date();
      storage.set('collections-fv', currentTime.getTime());
    }
    if (utils.isVisitor()) {
      this.subscribeEvent('auth:success', this.authSuccess);
    }
    return this.subscribeEvent('mutual:update', this.updateMutualConnections);
  };

  Application.prototype.authSuccess = function(authResponse) {
    mediator.userM.setFromAuthResponse(authResponse);
    return this.initStumblesCollection();
  };

  Application.prototype.initStumblesCollection = function() {
    var _ref, _ref1;
    if (utils.isVisitor()) {
      if (((_ref = mediator.stumblesC) != null ? _ref.constructor : void 0) !== VisitorStumblesC) {
        return mediator.stumblesC = new VisitorStumblesC;
      }
    } else {
      if (((_ref1 = mediator.stumblesC) != null ? _ref1.constructor : void 0) !== StumblesC) {
        return mediator.stumblesC = new StumblesC;
      }
    }
  };

  Application.prototype.updateMutualConnections = function() {
    return mediator.contactsC.fetch({
      reset: true
    });
  };

  return Application;

})(Chaplin.Application);


},{"../bower_components/Jcrop/js/Jcrop.js":752,"../bower_components/bootstrap-stylus/js/modal.js":753,"../bower_components/bootstrap-stylus/js/tooltip.js":754,"../bower_components/jQuery.dotdotdot/src/js/jquery.dotdotdot.js":755,"../bower_components/jquery.cookie/jquery.cookie":756,"../bower_components/poly/all":757,"../vendor/scripts/jquery.autogrow.js":784,"../vendor/scripts/jquery.smartbanner.js":785,"../vendor/scripts/taggle.js":786,"./controllers/errors-controller":"rplz2l","./lib/analytics":116,"./lib/root":129,"./lib/utils":156,"./lib/webfont":158,"./models/activity-center-collection":161,"./models/activity-notification-model":163,"./models/base/model":168,"./models/blocked-participants-collection":170,"./models/contacts-collection":171,"./models/list-items-collection":199,"./models/lists-collection":202,"./models/modes-collection":212,"./models/participant-model":213,"./models/participants-collection":214,"./models/stumbles-collection":240,"./models/user-model":258,"./models/visitor-stumbles-collection":262,"./routes":263,"./su-debug":265,"./url-patterns-to-ignore":596,"ajaxRetry":770,"backbone":772,"chaplin":773,"jquery":774,"lodash":776,"simple-storage":780,"touchclick":781,"underscore.string":782}],2:[function(require,module,exports){
var branch, buildId, hash, _ref;

branch = (typeof SUdebug !== "undefined" && SUdebug !== null ? (_ref = SUdebug.branch) != null ? typeof _ref.replace === "function" ? _ref.replace('/', '-') : void 0 : void 0 : void 0) || 'unknown';

hash = (typeof SUdebug !== "undefined" && SUdebug !== null ? SUdebug.hash : void 0) || 'unknown';

buildId = "" + branch + "_" + hash;

module.exports = Object.freeze({
  PROTOCOL_HTTP: 'http:',
  PROTOCOL_HTTPS: 'https:',
  localDev: {
    host: 'www.ebogod.v5.stumble.net',
    protocol: 'https:',
    logLevel: 8,
    conversationHost: 'http://10.1.11.28/convo-dev',
    conversationJwtPath: '/auth/token',
    fbAppId: '624400444287104',
    SPAHost: 'local.stumble.net',
    SPAPort: '3333',
    SPADomain: '.stumble.net',
    googleClientId: '337843873170.apps.googleusercontent.com',
    googleApiKey: '_K52f11vwg2SswmbjNYBWdq-'
  },
  suteamProd: {
    logLevel: 8
  },
  host: 'www.stumbleupon.com',
  protocol: 'https:',
  prefix: '/api/v2_0',
  buildId: buildId,
  headers: {
    'X-Su-ConsumerKey': '35774027dc2f2f64a280e63eafb018505c045655',
    'X-Su-Version': "spa 3.1 js " + buildId + " SU"
  },
  showBetaOptinView: false,
  logLevel: 5,
  conversationHost: 'http://svc.stumbleupon.com/convo',
  conversationJwtPath: '/auth/token',
  fbAppId: '267470608481',
  appIdIphone: '386244833',
  googleClientId: '337843873170-7thp888ksf318d8dececl2uhg29ln6tr.apps.googleusercontent.com',
  googleApiKey: 'JuByPI0_AcGKI71c6u9Pj3tE',
  googleScopes: 'https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/plus.login profile email',
  recaptchaSiteKey: '6LdocxATAAAAAHW1BXF7qo_NoaKqyDb8UTQWmLKp',
  invisibleRecaptchaSiteKey: '6LeqJDwUAAAAANA2VzUkSRl2e2fBZLTTLd60ey1r',
  continuousScrollMaxItems: 500
});


},{}],"controllers/addon-controller":[function(require,module,exports){
module.exports=require('wP9Fvu');
},{}],"wP9Fvu":[function(require,module,exports){
var $, AddonController, AddonV, AppBaseController, StumbleBarAddonV, panel, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppBaseController = require('./base/app-controller');

AddonV = require('../views/addon-view');

StumbleBarAddonV = require('../views/stumblebar-addon-view');

utils = require('../lib/utils');

panel = require('../lib/panel');

$ = require('jquery');

module.exports = AddonController = (function(_super) {
  __extends(AddonController, _super);

  function AddonController() {
    return AddonController.__super__.constructor.apply(this, arguments);
  }

  AddonController.prototype.displayAddon = function() {
    return this.view = new AddonV();
  };

  AddonController.prototype.displayStumbleBarAddon = function() {
    return this.view = new StumbleBarAddonV();
  };

  AddonController.prototype.beforeAction = function() {
    if (navigator.userAgent.indexOf("Chrome/") !== -1 && document.cookie.indexOf('hii') === -1 && !$('link[rel="chrome-webstore-item"]').length) {
      document.cookie = 'hii=1';
      return window.location.reload(true);
    }
    panel.close();
    return AddonController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        _this.reuse('toolbar', utils.getToolbarView(), {
          region: 'toolbar'
        });
        return _this.publishEvent('disable-toolbar-buttons');
      };
    })(this));
  };

  return AddonController;

})(AppBaseController);


},{"../lib/panel":125,"../lib/utils":156,"../views/addon-view":602,"../views/stumblebar-addon-view":719,"./base/app-controller":"GaC0VN","jquery":774}],"GaC0VN":[function(require,module,exports){
var $, AppController, AppView, BaseController, TimersC, stumble, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

_ = require('lodash');

BaseController = require('./controller');

AppView = require('../../views/app-view');

TimersC = require('../../models/timers-collection');

stumble = require('../../lib/stumble');

module.exports = AppController = (function(_super) {
  __extends(AppController, _super);

  function AppController() {
    return AppController.__super__.constructor.apply(this, arguments);
  }

  AppController.prototype.beforeAction = function(routeVars, route, option) {
    return AppController.__super__.beforeAction.apply(this, arguments).then(this.viewStoredConversation).then((function(_this) {
      return function() {
        _this.reuse('app', AppView);
        return _this.reuse('timers', TimersC);
      };
    })(this));
  };

  AppController.prototype.initialize = function() {
    AppController.__super__.initialize.apply(this, arguments);
    return this.subscribeEvent('stumble:next', this.stumbleNext);
  };

  AppController.prototype.stumbleNext = function() {
    return stumble.stumbleNext();
  };

  return AppController;

})(BaseController);


},{"../../lib/stumble":130,"../../models/timers-collection":248,"../../views/app-view":605,"./controller":"UQqhgU","jquery":774,"lodash":776}],"controllers/base/app-controller":[function(require,module,exports){
module.exports=require('GaC0VN');
},{}],"controllers/base/controller":[function(require,module,exports){
module.exports=require('UQqhgU');
},{}],"UQqhgU":[function(require,module,exports){
var $, AnnounceEvents, AppView, Backbone, Chaplin, Controller, InterestsC, Mixin, StopTimers, TimersC, analytics, config, globalConfig, guid, mediator, root, storage, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

$ = require('jquery');

Backbone = require('backbone');

Backbone.$ = $;

Mixin = require('mixen');

Chaplin = require('chaplin');

StopTimers = require('../../lib/mixins/stop-timers');

AnnounceEvents = require('../../lib/mixins/announce-events');

utils = require('../../lib/utils');

root = require('../../lib/root');

mediator = require('chaplin').mediator;

AppView = require('../../views/app-view');

analytics = require('../../lib/analytics');

config = require('../../config');

TimersC = require('../../models/timers-collection');

storage = require('simple-storage');

InterestsC = require('../../models/interests-collection');

guid = require('../../lib/guid');

globalConfig = require('../../config');

utils = require('../../lib/utils');

module.exports = Controller = (function(_super) {
  __extends(Controller, _super);

  function Controller() {
    return Controller.__super__.constructor.apply(this, arguments);
  }

  Controller.prototype.PROTOCOL_DEFAULT = config.PROTOCOL_HTTP;

  Controller.prototype.PROTOCOL_SECURE = config.PROTOCOL_HTTPS;

  Controller.prototype.RESOLUTION_CONTINUE = 'continue';

  Controller.prototype.RESOLUTION_QUIT = 'quit';

  Controller.prototype.initialize = function() {
    Controller.__super__.initialize.apply(this, arguments);
    return this.subscribeEvent('populate:models', this.onPopulateModels);
  };

  Controller.prototype.beforeAction = function(routeVars, route, options) {
    var debugInfo, dfd;
    dfd = new $.Deferred;
    if (window.location.protocol !== this.getProtocol()) {
      window.location.href = this.getProtocol() + '//' + window.location.host + '/' + route.path + (route.query && '?') + route.query;
    }
    dfd.resolve(null);
    dfd.promise();
    mediator.currentRoute = route;
    this.adjustTitle('StumbleUpon');
    this.adjustMetas(new Chaplin.Model());
    if (utils.isSUBrowserAddonEnabled()) {
      $('iframe#__su__toolbar').css('height', '0px');
      $('html>style').remove();
      $(document.body).attr('style', null);
    }
    debugInfo = 'refreshing session';
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('li_fingerprint', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('li_err_model', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('li_err_resp', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('li_err_opts', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('li_cookie', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('wa_fingerprint', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('wa_err_txt', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('wa_thrown', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('wa_err_xhr', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('wa_cookie', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('sr_fingerprint', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('sr_err_txt', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('sr_thrown', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('sr_err_xhr', null);
    }
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('sr_cookie', null);
    }
    return this.sessionRefresh().then(this.transitionCheck()).then((function(_this) {
      return function() {
        return utils.getCachedCollection('all-interests', utils.DAY_IN_MILLISECONDS, InterestsC, {}, true);
      };
    })(this)).then((function(_this) {
      return function(categorizedInterests) {
        _this.allInterestsC = categorizedInterests;
        debugInfo = 'when access token';
        return _this.whenAccessTokenKey.apply(_this, arguments);
      };
    })(this)).then((function(_this) {
      return function() {
        debugInfo = 'logging in';
        return _this.login.apply(_this, arguments);
      };
    })(this)).then((function(_this) {
      return function(quitOrContinue) {
        var interestsCount;
        if (quitOrContinue === _this.RESOLUTION_QUIT) {
          return _this.RESOLUTION_QUIT;
        }
        debugInfo = 'expiring cache';
        utils.expireCache();
        debugInfo = 'getting interests count';
        interestsCount = mediator.userM.get('interests_count');
        if (interestsCount === 0) {
          debugInfo = 'publishing no interests';
          return _this.publishEvent('user:nointerest');
        } else {
          debugInfo = 'populating models';
          _this.onPopulateModels();
          debugInfo = 'publishing user fetched';
          return _this.publishEvent('user:fetched');
        }
      };
    })(this)).then(function(quit) {
      if (quit === this.RESOLUTION_QUIT) {
        utils.redirectToLogin();
      }
      return quit;
    }, (function(_this) {
      return function(err) {
        if (typeof window.setErrorMeta === "function") {
          window.setErrorMeta('basecontrollerdebug', debugInfo);
        }
        return _this.appStartFailed(routeVars, route, options);
      };
    })(this));
  };

  Controller.prototype.getProtocol = function() {
    return this.PROTOCOL_SECURE;
  };

  Controller.prototype.visitorIsAllowed = function() {
    return true;
  };

  Controller.prototype.adjustMetas = function(model) {
    var a, aiWebUrl, defaultDescription, deleteMetaByName, deleteMetaByProperty, description, interestLink, interestM, ogUrl, setMetaByName, setMetaByProperty, twitterAppUrl, urlId, urlMetas;
    deleteMetaByName = function(name) {
      return $('meta[name="' + name + '"]').remove();
    };
    setMetaByName = function(name, content) {
      var meta;
      content = content || '';
      meta = $('meta[name="' + name + '"]');
      if (!meta.length) {
        return meta = $('head').append('<meta name="' + name + '" content="' + content + '">');
      } else {
        return meta.attr('content', content);
      }
    };
    deleteMetaByProperty = function(property) {
      return $('meta[property="' + property + '"]').remove();
    };
    setMetaByProperty = function(property, content) {
      var meta;
      content = content || '';
      meta = $('meta[property="' + property + '"]');
      if (!meta.length) {
        return meta = $('head').append('<meta property="' + property + '" content="' + content + '">');
      } else {
        return meta.attr('content', content);
      }
    };
    defaultDescription = 'StumbleUpon is the easiest way to discover new and interesting web pages, photos and videos across the Web.';
    description = (model != null ? model.get('description') : void 0) || defaultDescription;
    urlId = model != null ? model.get('urlid') : void 0;
    twitterAppUrl = "stumbleupon://urlid/" + urlId + "?ref_src=tw";
    ogUrl = aiWebUrl = model != null ? model.get('_route') : void 0;
    if (ogUrl) {
      a = document.createElement('A');
      a.href = ogUrl;
      aiWebUrl = a.href;
      if (a.search.length) {
        a.search += "&";
      }
      a.search += "ref_src=fb";
      ogUrl = a.href;
    }
    interestLink = '';
    if (model != null ? model.get('categoryid') : void 0) {
      interestM = this.allInterestsC.findById(model.get('categoryid'));
      interestLink = "http://www.stumbleupon.com/interest/" + ((interestM != null ? interestM.getSlug() : void 0) || (model != null ? model.get('categoryid') : void 0));
    }
    urlMetas = [
      {
        name: "description",
        content: description,
        always: true
      }, {
        name: "twitter:card",
        content: "summary"
      }, {
        name: "twitter:site",
        content: "@stumbleupon"
      }, {
        name: "twitter:title",
        content: model != null ? model.get('_title') : void 0
      }, {
        name: "twitter:description",
        content: description
      }, {
        name: "twitter:image",
        content: (model != null ? model.get('picture_large') : void 0) || (model != null ? model.get('thumbnail_b') : void 0)
      }, {
        name: "twitter:app:name:iphone",
        content: "StumbleUpon!"
      }, {
        name: "twitter:app:id:iphone",
        content: config.appIdIphone
      }, {
        name: "twitter:app:url:iphone",
        content: twitterAppUrl
      }, {
        name: "twitter:app:name:ipad",
        content: "StumbleUpon!"
      }, {
        name: "twitter:app:id:ipad",
        content: config.appIdIphone
      }, {
        name: "twitter:app:url:ipad",
        content: twitterAppUrl
      }, {
        name: "twitter:app:name:googleplay",
        content: "StumbleUpon"
      }, {
        name: "twitter:app:id:googleplay",
        content: "com.stumbleupon.android.app"
      }, {
        name: "twitter:app:url:googleplay",
        content: twitterAppUrl
      }, {
        property: "fb:app_id",
        content: config.fbAppId
      }, {
        property: "og:type",
        content: "stumbleupon:page"
      }, {
        property: "og:site_name",
        content: model != null ? model.get('_domain') : void 0
      }, {
        property: "og:url",
        content: ogUrl
      }, {
        property: "og:title",
        content: model != null ? model.get('_title') : void 0
      }, {
        property: "og:description",
        content: description
      }, {
        property: "og:image",
        content: (model != null ? model.get('picture_wide') : void 0) || (model != null ? model.get('thumbnail_b') : void 0)
      }, {
        property: "stumbleupon:interest",
        content: interestLink
      }, {
        property: "al:ios:url",
        content: "stumbleupon://urlid/" + urlId + "?ref_src=sumobilesite"
      }, {
        property: "al:ios:app_store_id",
        content: config.appIdIphone
      }, {
        property: "al:ios:app_name",
        content: "StumbleUpon!"
      }, {
        property: "al:web:url",
        content: aiWebUrl
      }
    ];
    return urlMetas.forEach(function(metaSpec) {
      if (!metaSpec.always && ['StumbleModel', 'UrlModel'].indexOf(model.constructor.name) === -1) {
        if (metaSpec.name) {
          return deleteMetaByName(metaSpec.name);
        } else if (metaSpec.property) {
          return deleteMetaByProperty(metaSpec.property);
        }
      } else {
        if (metaSpec.name) {
          return setMetaByName(metaSpec.name, metaSpec.content);
        } else if (metaSpec.property) {
          return setMetaByProperty(metaSpec.property, metaSpec.content);
        }
      }
    });
  };

  Controller.prototype.refresh = function() {
    return root().location.reload(true);
  };

  Controller.prototype.viewStoredConversation = function() {
    var convoId;
    if (!utils.isVisitor() && (convoId = storage.get('view-convo'))) {
      storage.remove('view-convo');
      return Chaplin.utils.redirectTo({
        url: "convo/" + convoId
      });
    }
  };

  Controller.prototype.login = function() {
    var dfd, fingerprint;
    dfd = new $.Deferred;
    if (utils.isLoggedIn() || (this.visitorIsAllowed() && utils.isVisitor())) {
      mediator.userM.startListeners();
      dfd.resolve(this.RESOLUTION_CONTINUE);
    } else if (!this.visitorIsAllowed() && utils.isVisitor()) {
      dfd.resolve(this.RESOLUTION_QUIT);
    } else {
      fingerprint = utils.fingerprint();
      if (typeof window.setErrorMeta === "function") {
        window.setErrorMeta('li_fingerprint', fingerprint);
      }
      mediator.userM.fetch({
        success: function(model, response, options) {
          return dfd.resolve(this.RESOLUTION_CONTINUE);
        },
        error: function(model, response, options) {
          var code, e;
          try {
            code = JSON.parse(response.responseText || '{}')._code;
            if ([3000, 401].indexOf(code) !== -1) {
              utils.clearAllCookies();
              this.clear();
              if (window.location.href === '/') {
                window.location.reload(true);
              } else {
                window.location.href = '/';
              }
              return (new $.Deferred).promise();
            }
          } catch (_error) {
            e = _error;
          }
          if (typeof window.setErrorMeta === "function") {
            window.setErrorMeta('li_err_model', JSON.stringify(model || {}));
          }
          if (typeof window.setErrorMeta === "function") {
            window.setErrorMeta('li_err_resp', JSON.stringify(response || {}));
          }
          if (typeof window.setErrorMeta === "function") {
            window.setErrorMeta('li_err_opts', JSON.stringify(options || {}));
          }
          if (typeof window.setErrorMeta === "function") {
            window.setErrorMeta('li_cookie', document.cookie);
          }
          return dfd.reject(new Error('login failed'));
        }
      });
    }
    return dfd.promise();
  };

  Controller.prototype.whenAccessTokenKey = function() {
    var dfd, fingerprint;
    dfd = new $.Deferred;
    if (utils.getDoubleDownToken()) {
      dfd.resolve();
    } else {
      fingerprint = utils.fingerprint();
      if (typeof window.setErrorMeta === "function") {
        window.setErrorMeta('wa_fingerprint', fingerprint);
      }
      $.ajax({
        url: '/p?f=' + fingerprint,
        method: 'GET',
        complete: function(jqXHR, textStatus) {
          return dfd.resolve();
        },
        error: function(jqXHR, textStatus, errorThrown) {
          if (typeof window.setErrorMeta === "function") {
            window.setErrorMeta('wa_err_txt', textStatus || 'null');
          }
          if (typeof window.setErrorMeta === "function") {
            window.setErrorMeta('wa_thrown', errorThrown || 'null');
          }
          if (typeof window.setErrorMeta === "function") {
            window.setErrorMeta('wa_err_xhr', JSON.stringify(jqXHR));
          }
          return typeof window.setErrorMeta === "function" ? window.setErrorMeta('wa_cookie', document.cookie) : void 0;
        }
      });
    }
    return dfd.promise();
  };

  Controller.prototype.sessionRefresh = _.once(function() {
    var dfd, fingerprint;
    dfd = new $.Deferred;
    fingerprint = utils.fingerprint();
    if (typeof window.setErrorMeta === "function") {
      window.setErrorMeta('sr_fingerprint', fingerprint);
    }
    $.ajax({
      url: '/p?f=' + fingerprint,
      method: 'GET',
      complete: function(jqXHR, textStatus) {
        return dfd.resolve();
      },
      error: function(jqXHR, textStatus, errorThrown) {
        if (typeof window.setErrorMeta === "function") {
          window.setErrorMeta('sr_err_txt', textStatus || 'null');
        }
        if (typeof window.setErrorMeta === "function") {
          window.setErrorMeta('sr_thrown', errorThrown || 'null');
        }
        if (typeof window.setErrorMeta === "function") {
          window.setErrorMeta('sr_err_xhr', JSON.stringify(jqXHR));
        }
        return typeof window.setErrorMeta === "function" ? window.setErrorMeta('sr_cookie', document.cookie) : void 0;
      }
    });
    return dfd.promise();
  });

  Controller.prototype.onPopulateModels = function() {
    if (!utils.isVisitor() && utils.isLoggedIn()) {
      return this.populateModels();
    }
  };

  Controller.prototype.populateModels = _.once(function() {
    var accessToken, convoOptions, e, followOptions;
    convoOptions = {
      remove: false
    };
    convoOptions.data = {
      start: 0,
      limit: 25
    };
    followOptions = {
      remove: false
    };
    followOptions.data = {
      start: 0,
      limit: 25
    };
    mediator.modesC.fetch();
    mediator.listsC.fetch();
    mediator.contactsC.fetch();
    mediator.activityNotificationM.fetch();
    mediator.conversationC.fetch(convoOptions);
    mediator.activityFollowC.fetch(followOptions);
    if (!utils.isDev()) {
      try {
        accessToken = cookie.get('su_accesstoken');
        if (accessToken) {
          return $.ajax({
            url: 'http://svc.stumbleupon.com/convo/auth/token',
            headers: {
              'X-Su-AccessTokenKey': accessToken
            }
          });
        }
      } catch (_error) {
        e = _error;
        return console.error('Failed to get auth for convo/auth/token', e);
      }
    }
  });

  Controller.prototype.appStartFailed = function(params, options) {
    console.error("Unable to start app");
    if (utils.isDev()) {
      console.error("If you're on dev you MUST login from https://" + config.localDev.host + "/login See the comments above in this file!");
    }
    debugger;
    analytics.trackEvent('authFailure', mediator.sessionStumbleViews);
    utils.clearLegacyCookies();
    return utils.redirectToAppStartFailed(params, options);
  };

  Controller.prototype.transitionCheck = function() {
    var ajaxProps, dfd;
    if (Chaplin.mediator.transitionWasChecked) {
      dfd = new $.Deferred;
      dfd.resolve(null);
      return dfd.promise();
    } else {
      ajaxProps = {
        url: document.location.protocol + '//' + document.location.host + '/api/v2_0/user/canTransitionToMix',
        headers: _.assign({}, globalConfig.headers, {
          'X-Su-ClientId': guid.get(),
          'X-Su-AccessTokenKey': utils.getDoubleDownToken()
        }),
        data: {
          from: 'spa-app-load',
          userid: Chaplin.mediator.userM.get('userid')
        },
        xhrFields: {
          withCredentials: true
        }
      };
      return $.ajax(ajaxProps).then(function(response) {
        Chaplin.mediator.transitionWasChecked = true;
        Chaplin.mediator.canTransition = !!response.mix;
        if (!!response.mix) {
          return $(document.body).addClass('can-transition');
        }
      }).fail(function(err) {
        return Chaplin.mediator.canTransition = false;
      });
    }
  };

  return Controller;

})(Mixin(AnnounceEvents, StopTimers, Chaplin.Controller));


},{"../../config":2,"../../lib/analytics":116,"../../lib/guid":119,"../../lib/mixins/announce-events":123,"../../lib/mixins/stop-timers":124,"../../lib/root":129,"../../lib/utils":156,"../../models/interests-collection":188,"../../models/timers-collection":248,"../../views/app-view":605,"backbone":772,"chaplin":773,"jquery":774,"lodash":776,"mixen":777,"simple-storage":780}],"EnhJGH":[function(require,module,exports){
var Controller, EmailVerifyController, EmailVerifyModel, EmailVerifyView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('./base/controller');

EmailVerifyView = require('../views/email-verify-view');

EmailVerifyModel = require('../models/email-verify-model');

module.exports = EmailVerifyController = (function(_super) {
  __extends(EmailVerifyController, _super);

  function EmailVerifyController() {
    return EmailVerifyController.__super__.constructor.apply(this, arguments);
  }

  EmailVerifyController.prototype.verifyMail = function(data, params, options) {
    var evm;
    evm = new EmailVerifyModel(data);
    this.view = new EmailVerifyView({
      name: 'Verifypage',
      model: evm
    });
    return evm.save();
  };

  return EmailVerifyController;

})(Controller);


},{"../models/email-verify-model":175,"../views/email-verify-view":636,"./base/controller":"UQqhgU"}],"controllers/email-verify-controller":[function(require,module,exports){
module.exports=require('EnhJGH');
},{}],"controllers/errors-controller":[function(require,module,exports){
module.exports=require('rplz2l');
},{}],"rplz2l":[function(require,module,exports){
var $, ApiErrorM, ApiErrorV, Controller, ErrorsController, GeneralErrorV, NotFoundV, analytics,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('./base/controller');

NotFoundV = require('../views/errors/not-found-view');

GeneralErrorV = require('../views/general-error-view');

ApiErrorV = require('../views/api-error-view');

ApiErrorM = require('../models/api-error-model');

$ = require('jquery');

analytics = require('../lib/analytics');

module.exports = ErrorsController = (function(_super) {
  __extends(ErrorsController, _super);

  function ErrorsController() {
    return ErrorsController.__super__.constructor.apply(this, arguments);
  }

  ErrorsController.prototype.initialize = function() {
    return this.subscribeEvent('error:general', this.general);
  };

  ErrorsController.prototype.general = function() {
    return this.view = new GeneralErrorV();
  };

  ErrorsController.prototype.notFound = function() {
    $('.stumble').remove();
    return this.view = new NotFoundV();
  };

  ErrorsController.prototype.api = function(params, route, options) {
    var apiErrorM;
    apiErrorM = ApiErrorM.fromResponse(options.response);
    apiErrorM.setPreviousRoute(route.previous);
    analytics.trackEvent('api-error-view', 1, {
      action: 'view',
      label: 'error#api'
    });
    try {
      return window.close();
    } finally {
      Chaplin.utils.redirectTo({
        url: '/'
      }, {}, {
        replace: true
      });
    }
  };

  ErrorsController.prototype.getProtocol = function() {
    return document.location.protocol;
  };

  return ErrorsController;

})(Controller);


},{"../lib/analytics":116,"../models/api-error-model":165,"../views/api-error-view":604,"../views/errors/not-found-view":643,"../views/general-error-view":648,"./base/controller":"UQqhgU","jquery":774}],"POBnuo":[function(require,module,exports){
var AppStartController, AppView, ErrorView, ErrorsController, Model, StaticToolbarView, TimersC, analytics,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ErrorsController = require('../errors-controller');

analytics = require('../../lib/analytics');

Model = require('../../models/base/model');

ErrorView = require('../../views/errors/app-start-view');

AppView = require('../../views/app-view');

TimersC = require('../../models/timers-collection');

StaticToolbarView = require('../../views/toolbar/static-toolbar-view');

module.exports = AppStartController = (function(_super) {
  __extends(AppStartController, _super);

  function AppStartController() {
    return AppStartController.__super__.constructor.apply(this, arguments);
  }

  AppStartController.prototype.beforeAction = function(routeVars, route, options) {
    this.reuse('app', AppView);
    this.reuse('timers', TimersC);
    return this.reuse('toolbar', StaticToolbarView, {
      region: 'toolbar'
    });
  };

  AppStartController.prototype.fail = function(params, route, options) {
    var errorModel;
    analytics.trackEvent('app-start-error-view', 1, {
      action: 'view',
      label: 'error#fail'
    });
    errorModel = new Model({
      source: decodeURIComponent(params.source || "")
    });
    return this.view = new ErrorView({
      model: errorModel
    });
  };

  return AppStartController;

})(ErrorsController);


},{"../../lib/analytics":116,"../../models/base/model":168,"../../models/timers-collection":248,"../../views/app-view":605,"../../views/errors/app-start-view":637,"../../views/toolbar/static-toolbar-view":729,"../errors-controller":"rplz2l"}],"controllers/errors/app-start-controller":[function(require,module,exports){
module.exports=require('POBnuo');
},{}],"controllers/errors/badge-submit-errors-controller":[function(require,module,exports){
module.exports=require('ACyywb');
},{}],"ACyywb":[function(require,module,exports){
var BadgeSubmitErrorV, BadgeSubmitErrorsController, BaseErrorController, Model, analytics,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

BaseErrorController = require('./base-error-controller');

analytics = require('../../lib/analytics');

BadgeSubmitErrorV = require('../../views/errors/badge-submit-view');

Model = require('../../models/base/model');

module.exports = BadgeSubmitErrorsController = (function(_super) {
  __extends(BadgeSubmitErrorsController, _super);

  function BadgeSubmitErrorsController() {
    return BadgeSubmitErrorsController.__super__.constructor.apply(this, arguments);
  }

  BadgeSubmitErrorsController.prototype.api = function(params, route, options) {
    var model;
    analytics.trackEvent('badge-submit-api-error-view', 1, {
      action: 'view',
      label: 'error#api'
    });
    model = new Model({
      encodedUrl: encodeURIComponent(params.url)
    });
    return this.view = new BadgeSubmitErrorV({
      model: model
    });
  };

  return BadgeSubmitErrorsController;

})(BaseErrorController);


},{"../../lib/analytics":116,"../../models/base/model":168,"../../views/errors/badge-submit-view":638,"./base-error-controller":"0hvB+t"}],"controllers/errors/base-error-controller":[function(require,module,exports){
module.exports=require('0hvB+t');
},{}],"0hvB+t":[function(require,module,exports){
var AppBaseController, AppView, BaseErrorController, StaticToolbarView, TimersC, panel, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppBaseController = require('../base/app-controller');

utils = require('../../lib/utils');

panel = require('../../lib/panel');

AppView = require('../../views/app-view');

TimersC = require('../../models/timers-collection');

StaticToolbarView = require('../../views/toolbar/static-toolbar-view');

module.exports = BaseErrorController = (function(_super) {
  __extends(BaseErrorController, _super);

  function BaseErrorController() {
    return BaseErrorController.__super__.constructor.apply(this, arguments);
  }

  BaseErrorController.prototype.beforeAction = function() {
    panel.close();
    return BaseErrorController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        _this.reuse('app', AppView);
        _this.reuse('timers', TimersC);
        return _this.reuse('toolbar', StaticToolbarView, {
          region: 'toolbar'
        });
      };
    })(this));
  };

  return BaseErrorController;

})(AppBaseController);


},{"../../lib/panel":125,"../../lib/utils":156,"../../models/timers-collection":248,"../../views/app-view":605,"../../views/toolbar/static-toolbar-view":729,"../base/app-controller":"GaC0VN"}],"I1qtaK":[function(require,module,exports){
var BaseErrorController, ForbiddenController, ForbiddenV,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

BaseErrorController = require('./base-error-controller');

ForbiddenV = require('../../views/errors/forbidden-view');

module.exports = ForbiddenController = (function(_super) {
  __extends(ForbiddenController, _super);

  function ForbiddenController() {
    return ForbiddenController.__super__.constructor.apply(this, arguments);
  }

  ForbiddenController.prototype.forbidden = function() {
    return this.view = new ForbiddenV();
  };

  return ForbiddenController;

})(BaseErrorController);


},{"../../views/errors/forbidden-view":640,"./base-error-controller":"0hvB+t"}],"controllers/errors/forbidden-controller":[function(require,module,exports){
module.exports=require('I1qtaK');
},{}],"r8Cpl5":[function(require,module,exports){
var AppBaseController, ImpossibleUrlController, ImpossibleUrlV, panel, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppBaseController = require('../base/app-controller');

ImpossibleUrlV = require('../../views/errors/impossible-url-view');

utils = require('../../lib/utils');

panel = require('../../lib/panel');

module.exports = ImpossibleUrlController = (function(_super) {
  __extends(ImpossibleUrlController, _super);

  function ImpossibleUrlController() {
    return ImpossibleUrlController.__super__.constructor.apply(this, arguments);
  }

  ImpossibleUrlController.prototype.beforeAction = function() {
    panel.close();
    return ImpossibleUrlController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        return _this.reuse('toolbar', utils.getToolbarView(), {
          region: 'toolbar'
        });
      };
    })(this));
  };

  ImpossibleUrlController.prototype.impossible = function() {
    return this.view = new ImpossibleUrlV();
  };

  return ImpossibleUrlController;

})(AppBaseController);


},{"../../lib/panel":125,"../../lib/utils":156,"../../views/errors/impossible-url-view":641,"../base/app-controller":"GaC0VN"}],"controllers/errors/impossible-url-controller":[function(require,module,exports){
module.exports=require('r8Cpl5');
},{}],"srJZrP":[function(require,module,exports){
var BaseErrorController, InternalServerController, InternalServerV, analytics,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

BaseErrorController = require('./base-error-controller');

InternalServerV = require('../../views/errors/internal-server-view');

analytics = require('../../lib/analytics');

module.exports = InternalServerController = (function(_super) {
  __extends(InternalServerController, _super);

  function InternalServerController() {
    return InternalServerController.__super__.constructor.apply(this, arguments);
  }

  InternalServerController.prototype.api = function() {
    analytics.trackEvent('badge-submit-api-error-view', 1, {
      action: 'view',
      label: 'error#api'
    });
    return this.view = new InternalServerV();
  };

  return InternalServerController;

})(BaseErrorController);


},{"../../lib/analytics":116,"../../views/errors/internal-server-view":642,"./base-error-controller":"0hvB+t"}],"controllers/errors/internal-server-controller":[function(require,module,exports){
module.exports=require('srJZrP');
},{}],"j+DEja":[function(require,module,exports){
var AppBaseController, NotFoundController, NotFoundV, panel, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppBaseController = require('../base/app-controller');

NotFoundV = require('../../views/errors/not-found-view');

utils = require('../../lib/utils');

panel = require('../../lib/panel');

module.exports = NotFoundController = (function(_super) {
  __extends(NotFoundController, _super);

  function NotFoundController() {
    return NotFoundController.__super__.constructor.apply(this, arguments);
  }

  NotFoundController.prototype.beforeAction = function() {
    panel.close();
    return NotFoundController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        return _this.reuse('toolbar', utils.getToolbarView(), {
          region: 'toolbar'
        });
      };
    })(this));
  };

  NotFoundController.prototype.notFound = function() {
    return this.view = new NotFoundV();
  };

  return NotFoundController;

})(AppBaseController);


},{"../../lib/panel":125,"../../lib/utils":156,"../../views/errors/not-found-view":643,"../base/app-controller":"GaC0VN"}],"controllers/errors/not-found-controller":[function(require,module,exports){
module.exports=require('j+DEja');
},{}],"svD88M":[function(require,module,exports){
var AppBaseController, FollowingController, FollowingRunoutView, panel, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppBaseController = require('./base/app-controller');

FollowingRunoutView = require('../views/following-runout-view');

utils = require('../lib/utils');

panel = require('../lib/panel');

module.exports = FollowingController = (function(_super) {
  __extends(FollowingController, _super);

  function FollowingController() {
    return FollowingController.__super__.constructor.apply(this, arguments);
  }

  FollowingController.prototype.initialize = function() {
    FollowingController.__super__.initialize.apply(this, arguments);
    return this.subscribeEvent('likers:currentPageNumber', this.onPageNumberChange);
  };

  FollowingController.prototype.beforeAction = function() {
    panel.close();
    return FollowingController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        _this.reuse('toolbar', utils.getToolbarView(), {
          region: 'toolbar'
        });
        return _this.publishEvent('disable-toolbar-buttons');
      };
    })(this));
  };

  FollowingController.prototype.onPageNumberChange = function(newPage) {
    return this.pageNumber = newPage;
  };

  FollowingController.prototype.displayFollowingRecommend = function(data) {
    return this.view = new FollowingRunoutView({
      name: 'FollowingRunoutView'
    });
  };

  return FollowingController;

})(AppBaseController);


},{"../lib/panel":125,"../lib/utils":156,"../views/following-runout-view":647,"./base/app-controller":"GaC0VN"}],"controllers/following-runout-controller":[function(require,module,exports){
module.exports=require('svD88M');
},{}],"1qSlK6":[function(require,module,exports){
var Controller, DismissedTutorialModel, GoogleConnectModel, HomePageController, HomepageView, SignupModel, i18n, storage, utils,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('./base/controller');

utils = require('../lib/utils');

i18n = require('../lib/i18n');

HomepageView = require('../views/homepage-view');

SignupModel = require('../models/signup-model');

GoogleConnectModel = require('../models/google-connect-model');

DismissedTutorialModel = require('../models/dismissed-tutorial-model');

storage = require('simple-storage');

module.exports = HomePageController = (function(_super) {
  __extends(HomePageController, _super);

  function HomePageController() {
    this.redirectUser = __bind(this.redirectUser, this);
    return HomePageController.__super__.constructor.apply(this, arguments);
  }

  HomePageController.prototype.nextUrl = "";

  HomePageController.prototype.initialize = function() {
    HomePageController.__super__.initialize.apply(this, arguments);
    this.subscribeEvent('login:model:success', this.redirectLogin);
    this.subscribeEvent('signup:model:success', this.redirectSignup);
    this.subscribeEvent('fb:model:login:success', this.redirectLogin);
    this.subscribeEvent('fb:model:signup:success', this.redirectSignup);
    this.subscribeEvent('google:model:login:success', this.redirectLogin);
    this.subscribeEvent('google:model:signup:success', this.redirectSignup);
    if (utils.isRecognizedVisitor()) {
      this._title = i18n('TRANSITION_TITLE');
      this._description = i18n('TRANSITION_DESCRIPTION');
      return this._rcclass = 'recognized';
    } else {
      this._title = 'StumbleUpon moved to Mix on June 30th. Join us today!';
      this._description = 'From the makers of StumbleUpon, comes Mix: a new way to discover and save all your favorite things on the web.';
      return this._rcclass = 'unrecognized';
    }
  };

  HomePageController.prototype.home = function(params, route, options) {
    var _ref, _ref1;
    if (utils.isMobile()) {
      return Chaplin.utils.redirectTo('mix#rc');
    }
    this.nextUrl = params.next;
    if ((options != null ? (_ref = options.query) != null ? _ref.isVisitor : void 0 : void 0) != null) {
      this._track_postfix = ":visitor";
    } else {
      this._track_postfix = (params != null ? params._track_postfix : void 0) != null ? params._track_postfix : '';
    }
    if (!this.nextUrl) {
      this.nextUrl = utils.getCurrentQueryParamValue('next');
    }
    if (!this.nextUrl && ((options != null ? (_ref1 = options.query) != null ? _ref1.next : void 0 : void 0) != null)) {
      this.nextUrl = decodeURIComponent(options.query.next);
    }
    if (utils.isVisitor()) {
      utils.facebookInitialize();
      this.view = new HomepageView({
        name: 'Homepage',
        model: new SignupModel({
          _track_postfix: this._track_postfix,
          _title: this._title,
          _description: this._description,
          _footnote: this._footnote,
          _rcclass: this._rcclass
        })
      });
      return this.trackSignupPageLoad();
    } else {
      return this.redirectUser();
    }
  };

  HomePageController.prototype.redirectLogin = function(res) {
    this.publishEvent('auth:success', res);
    return this.redirectUser(res);
  };

  HomePageController.prototype.redirectSignup = function(res) {
    var dismissedTutorialM;
    this.publishEvent('auth:success', res);
    dismissedTutorialM = new DismissedTutorialModel({
      userid: res.user.userid,
      dismissed_onboarding_tutorial: false
    });
    dismissedTutorialM.save();
    return utils.redirectToSignupInterest();
  };

  HomePageController.prototype.redirectUser = function(res) {
    var anchor, decodedUrl, domain, relativeUrl, url;
    if (res == null) {
      res = {};
    }
    url = '/su/';
    if ((this.nextUrl != null) && typeof this.nextUrl !== 'undefined' && this.nextUrl !== "") {
      decodedUrl = decodeURIComponent(this.nextUrl);
      domain = utils.getDomain(decodedUrl);
      if (utils.isValidRedirectDomain(domain)) {
        anchor = document.createElement('a');
        anchor.href = decodedUrl;
        relativeUrl = anchor.pathname + anchor.search;
        if (relativeUrl !== "") {
          url = relativeUrl;
        }
      }
    }
    return window.location = url;
  };

  HomePageController.prototype.trackSignupPageLoad = function() {
    var SU, options, request, user;
    SU = require('../lib/su');
    request = require('../lib/request');
    options = {
      data: {},
      noretry: true
    };
    user = new SU.User;
    request(user.reportSignupPageLoad, [null, null, options]);
  };

  return HomePageController;

})(Controller);


},{"../lib/i18n":121,"../lib/request":128,"../lib/su":153,"../lib/utils":156,"../models/dismissed-tutorial-model":173,"../models/google-connect-model":184,"../models/signup-model":238,"../views/homepage-view":652,"./base/controller":"UQqhgU","simple-storage":780}],"controllers/homepage-controller":[function(require,module,exports){
module.exports=require('1qSlK6');
},{}],"controllers/interests-controller":[function(require,module,exports){
module.exports=require('mtRlGp');
},{}],"mtRlGp":[function(require,module,exports){
var $, AppController, CollectionView, CreateMyInterestsHeadingViewConstructor, EditMyInterestsHeadingViewConstructor, InterestModel, InterestV, InterestsCollection, InterestsController, Model, MyInterestsM, MyInterestsV, PopularInterestsCollection, ProfileHeadV, ProfileV, SuggestInterestsHeadingViewConstructor, TabV, UserInterestsC, View, analytics, mediator, panel, profile, stumble, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppController = require('./base/app-controller');

MyInterestsM = require('../models/user-interests-model');

UserInterestsC = require('../models/user-interests-collection');

InterestsCollection = require('../models/interests-collection');

InterestModel = require('../models/interest-model');

PopularInterestsCollection = require('../models/popular-interests-collection');

Model = require('../models/base/model');

MyInterestsV = require('../views/settings/my-interests-view');

analytics = require('../lib/analytics');

stumble = require('../lib/stumble');

panel = require('../lib/panel');

utils = require('../lib/utils');

mediator = require('chaplin').mediator;

EditMyInterestsHeadingViewConstructor = require('../views/settings/heading-edit-interests-view');

CreateMyInterestsHeadingViewConstructor = require('../views/settings/heading-create-interests-view');

SuggestInterestsHeadingViewConstructor = require('../views/settings/heading-suggest-interests-view');

TabV = require('../views/widgets/tab-view');

profile = require('../lib/profile');

View = require('../views/base/view');

CollectionView = require('../views/base/collection-view');

InterestV = require('../views/settings/interest-view');

ProfileV = require('../views/profile/profile-view');

ProfileHeadV = require('../views/profile/profilehead-view');

$ = require('jquery');


/*
  Controller class for updating user settings.
 */

module.exports = InterestsController = (function(_super) {
  __extends(InterestsController, _super);

  function InterestsController() {
    return InterestsController.__super__.constructor.apply(this, arguments);
  }

  InterestsController.prototype.beforeAction = function(params, route, options) {
    this.subscribeEvent('interest:change:checked', this.onInterestChecked);
    this.allInterestsC = new InterestsCollection;
    this.myInterestsC = new UserInterestsC;
    this._updatesEnabled = true;
    this._initializeToolbar = route.action !== "createMyInterests";
    return InterestsController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        var dfd;
        if (utils.isVisitor()) {
          dfd = new $.Deferred;
          dfd.resolve(new PopularInterestsCollection([]));
          return dfd.promise();
        } else {
          return utils.getCachedCollection('popular-interests', utils.DAY_IN_MILLISECONDS, PopularInterestsCollection, {}, true);
        }
      };
    })(this)).then((function(_this) {
      return function(popularInterestsC) {
        return _this.popularInterestsC = popularInterestsC;
      };
    })(this)).then((function(_this) {
      return function() {
        _this.myUserName = mediator.userM.get('username');
        if (utils.isVisitor()) {
          _this.userName = 0;
        }
        if (params != null ? params.username : void 0) {
          _this.userName = params.username;
        } else {
          _this.userName = _this.myUserName;
        }
        return profile.setIdentityModel({
          username: _this.userName
        });
      };
    })(this)).then((function(_this) {
      return function() {
        var dfd, identityM;
        identityM = mediator.currentProfileM.get('identityM');
        identityM.set('_currentList', 'interests');
        _this.userId = identityM.get('userid');
        _this.myUserId = mediator.userM.get('userid');
        if (utils.isVisitor()) {
          dfd = new $.Deferred;
          dfd.resolve(new UserInterestsC([]));
          return dfd.promise();
        } else {
          return _this.myInterestsC.fetch({
            userId: _this.myUserId
          });
        }
      };
    })(this)).then((function(_this) {
      return function() {
        var dfd;
        _this.myCopiedInterestsC = new UserInterestsC(_this.myInterestsC.models);
        if (_this.userId !== _this.myUserId) {
          _this.currentUserInterestsC = new UserInterestsC;
          return _this.currentUserInterestsC.fetch({
            userId: _this.userId
          });
        } else {
          _this.currentUserInterestsC = _this.myInterestsC;
          dfd = new $.Deferred;
          dfd.resolve();
          return dfd.promise();
        }
      };
    })(this)).then((function(_this) {
      return function() {
        _this.myInterestsM = new MyInterestsM({
          myInterestsC: _this.myInterestsC,
          allInterestsC: _this.allInterestsC
        });
        _this.mixinSpecialInterestCollections();
        stumble.getCollection().setActive(null);
        if (_this._initializeToolbar) {
          return _this.reuse('toolbar', utils.getToolbarView(), {
            region: 'toolbar'
          });
        }
      };
    })(this));
  };

  InterestsController.prototype.viewInterests = function(params, route, options) {
    var canEditList, collection, headerM, identityM;
    this.reuse('profile', ProfileV, {
      region: 'content'
    });
    $('#profile-container').removeClass('list-detail-view');
    identityM = mediator.currentProfileM.get('identityM');
    headerM = new Model({
      _selectorName: this.currentUserInterestsC.length + " Interests",
      hideViewToggle: true,
      _hideSearch: true
    });
    headerM.set('_isSelf', identityM.get('_isSelf'));
    canEditList = headerM.get('_isSelf') && headerM.get('_canEdit');
    headerM.set('_showEditInterest', headerM.get('_isSelf'));
    headerM.set('_currentList', identityM.get('_currentList'));
    headerM.set('_canFollow', !identityM.get('_isSelf'));
    headerM.set('_showSearch', false);
    this.trackingCategory = 'my-interests-edit-view';
    this.trackingLabel = 'interests#viewOtherUserInterests';
    this.headerV = new ProfileHeadV({
      region: 'profilehead',
      model: headerM
    });
    if (identityM.get('_isSelf') || utils.isVisitor()) {
      collection = this.myInterestsC;
      if (utils.isVisitor()) {
        collection = this.currentUserInterestsC;
      }
      this.view = new View({
        region: 'profile',
        className: 'container',
        id: 'profile-interests-container',
        model: new Model(),
        containerMethod: 'html',
        autoRender: true
      });
      this.view.subview('tab-view', new CollectionView({
        itemView: InterestV,
        collection: collection,
        container: '#profile-interests-container',
        containerMethod: 'html',
        id: 'profile-interests',
        className: 'profile-interests three-column'
      }));
      return this.subscribeEvent('interest-view:clicked', this.onMyInterestClicked);
    } else {
      this.view = new MyInterestsV({
        model: this.myInterestsM,
        showToolbar: true,
        className: 'profile-interests',
        trackingCategory: this.trackingCategory,
        trackingLabel: this.trackingLabel,
        region: 'profile',
        containerMethod: 'append'
      });
      this.allInterestsC.setHiddenActionButtons(['my-interests']);
      return this.view.subview('tab-view', new TabV({
        model: this.myInterestsM,
        tabViewProvider: this.allInterestsC,
        container: '#tab-view-container',
        containerMethod: 'html',
        id: 'interest-category-nav',
        hideNavBar: true
      }));
    }
  };

  InterestsController.prototype.editMyInterests = function(params, route, options) {
    this.trackingCategory = 'my-interests-edit-view';
    this.trackingLabel = 'interests#editMyInterests';
    return this._showInterestsView(EditMyInterestsHeadingViewConstructor, 'edit-interests', 'my-interests-edit-view-container', true, ['popular', this.userName + '-interests']);
  };

  InterestsController.prototype.createMyInterests = function(params, route, options) {
    this.trackingCategory = 'my-interests-edit-view';
    this.trackingLabel = 'interests#createMyInterests';
    this._showInterestsView(CreateMyInterestsHeadingViewConstructor, this.myInterestsC.getUserInterestIdsJson, 'my-interests-create-view-container', false, ['my-interests', this.userName + '-interests']);
    return this.trackSignupPageLoad();
  };

  InterestsController.prototype.suggestInterests = function(params, route, options) {
    this.trackingCategory = 'my-interests-edit-view';
    this.trackingLabel = 'interests#suggestInterests';
    return this._showInterestsView(SuggestInterestsHeadingViewConstructor, this.myInterestsC.getUserInterestIdsJson, 'my-interests-suggest-view-container', true, ['my-interests', this.userName + '-interests']);
  };

  InterestsController.prototype._showInterestsView = function(headingViewConstructor, headingViewTrackingLabel, className, showToolbar, hiddenActionButtons) {
    var model;
    panel.close();
    model = this.myInterestsModel;
    this.view = new MyInterestsV({
      model: model,
      showToolbar: showToolbar,
      className: className,
      trackingCategory: this.trackingCategory,
      trackingLabel: this.trackingLabel
    });
    this.view.subview('heading-view', new headingViewConstructor({
      model: model,
      myInterestsC: this.myInterestsC,
      container: '#heading-container',
      containerMethod: 'html',
      id: 'interest-category-nav',
      trackingLabel: headingViewTrackingLabel
    }));
    this.allInterestsC.setHiddenActionButtons(hiddenActionButtons);
    this.view.subview('tab-view', new TabV({
      model: model,
      tabViewProvider: this.allInterestsC,
      container: '#tab-view-container',
      containerMethod: 'html',
      id: 'interest-category-nav'
    }));
    return analytics.trackEvent(this.trackingCategory, 1, {
      action: 'view',
      label: this.trackingLabel
    });
  };


  /*
   * event handler for adding to the base user-interests collection -- this also adds to the copied interests
   */

  InterestsController.prototype._addToMyCopiedInterests = function(model, collection, options) {
    return this.myCopiedInterestsC.add(model);
  };


  /*
   * sets the checked state (see widget-provider) of interest models in an InterestCollection depending
   * on their presence in this user-interests collection
   */

  InterestsController.prototype._markMyInterests = function() {
    return this.myInterestsM.markMyInterests(this.myInterestsC, this.allInterestsC);
  };

  InterestsController.prototype.onInterestChecked = function(model, newValue, options) {
    if (this.updatesAreEnabled()) {
      this.disableUpdates();
      if (newValue) {
        analytics.trackEvent(this.trackingCategory, 1, {
          action: 'add-interest',
          label: model.get('id')
        });
        this.myInterestsC.add(model.attributes);
      } else {
        analytics.trackEvent(this.trackingCategory, 0, {
          action: 'delete-interest',
          label: model.get('id')
        });
        this.myInterestsC.remove(model.id);
      }
      return this.myInterestsM.save();
    } else {
      return false;
    }
  };

  InterestsController.prototype.mixinSpecialInterestCollections = function() {
    this.allInterestsC.add(new InterestModel({
      subInterestsC: this.myCopiedInterestsC,
      name: 'My Interests',
      _total: this.myInterestsC.length
    }));
    this.allInterestsC.add(new InterestModel({
      subInterestsC: this.currentUserInterestsC,
      name: this.userName + ' Interests',
      _total: this.currentUserInterestsC.length
    }));
    this.allInterestsC.add(new InterestModel({
      subInterestsC: this.popularInterestsC,
      name: 'Popular',
      _total: this.popularInterestsC.length
    }));
    utils.getCachedCollection('all-interests', utils.DAY_IN_MILLISECONDS, InterestsCollection, {}, true).then((function(_this) {
      return function(categorizedInterests) {
        var mixinCategorizedResults;
        mixinCategorizedResults = function() {
          _this.allInterestsC.add(categorizedInterests.models);
          return _this._markMyInterests();
        };
        if (categorizedInterests.length) {
          return mixinCategorizedResults();
        } else {
          return _this.listenToOnce(categorizedInterests, 'sync', mixinCategorizedResults);
        }
      };
    })(this));
    this.listenTo(this.myInterestsC, 'add', this._addToMyCopiedInterests);
    this.listenTo(this.myInterestsC, 'add remove', this._markMyInterests);
    return this.listenTo(this.myInterestsC, 'sync', this.enableUpdates);
  };

  InterestsController.prototype.disableUpdates = function() {
    this.view.disable();
    return this._updatesEnabled = false;
  };

  InterestsController.prototype.enableUpdates = function() {
    this.view.enable();
    return this._updatesEnabled = true;
  };

  InterestsController.prototype.updatesAreEnabled = function() {
    return this._updatesEnabled;
  };

  InterestsController.prototype.onMyInterestClicked = function(data) {
    var interestModel;
    interestModel = data != null ? data.model : void 0;
    return Chaplin.utils.redirectTo({
      url: "/stumbler/" + this.userName + "/interest/" + (interestModel.get('id'))
    });
  };

  InterestsController.prototype.trackSignupPageLoad = function() {
    var SU, options, request, user;
    SU = require('../lib/su');
    request = require('../lib/request');
    options = {
      data: {},
      noretry: true
    };
    user = new SU.User;
    request(user.reportInterestsPageLoad, [null, null, options]);
  };

  return InterestsController;

})(AppController);


},{"../lib/analytics":116,"../lib/panel":125,"../lib/profile":126,"../lib/request":128,"../lib/stumble":130,"../lib/su":153,"../lib/utils":156,"../models/base/model":168,"../models/interest-model":187,"../models/interests-collection":188,"../models/popular-interests-collection":215,"../models/user-interests-collection":256,"../models/user-interests-model":257,"../views/base/collection-view":606,"../views/base/view":608,"../views/profile/profile-view":684,"../views/profile/profilehead-view":686,"../views/settings/heading-create-interests-view":706,"../views/settings/heading-edit-interests-view":707,"../views/settings/heading-suggest-interests-view":708,"../views/settings/interest-view":709,"../views/settings/my-interests-view":710,"../views/widgets/tab-view":747,"./base/app-controller":"GaC0VN","chaplin":773,"jquery":774}],"controllers/login-controller":[function(require,module,exports){
module.exports=require('clXari');
},{}],"clXari":[function(require,module,exports){
var $, Controller, LoginController, mediator, root, storage, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('./base/controller');

storage = require('simple-storage');

mediator = require('chaplin').mediator;

utils = require('../lib/utils');

root = require('../lib/root');

$ = require('jquery');

module.exports = LoginController = (function(_super) {
  __extends(LoginController, _super);

  function LoginController() {
    return LoginController.__super__.constructor.apply(this, arguments);
  }

  LoginController.prototype.logout = function() {
    this.publishEvent('auth:loggedout');
    this.resetStorage();
    utils.clearCookies();
    if (storage.get('return_count', 'session')) {
      storage.set('return_count', storage.get('return_count', 'session') + 1, 'session');
    } else {
      storage.set('return_count', 1, 'session');
    }
    if (storage.get('return_count', 'session') < 3) {
      return root().location.href = '/';
    }
  };

  LoginController.prototype.resetStorage = function() {
    mediator.userM.clear({
      silent: true
    });
    storage.remove('key');
    storage.remove('user');
    storage.remove('activeMode');
    storage.remove('modeInfo');
    storage.clear('session');
    if (storage.get('stumbles')) {
      return storage.clear();
    }
  };

  return LoginController;

})(Controller);


},{"../lib/root":129,"../lib/utils":156,"./base/controller":"UQqhgU","chaplin":773,"jquery":774,"simple-storage":780}],"ueWto2":[function(require,module,exports){
var AppBaseController, MixController, MixRCV, Model, panel, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppBaseController = require('./base/app-controller');

MixRCV = require('../views/mix-rc-view');

utils = require('../lib/utils');

panel = require('../lib/panel');

Model = require('../models/base/model');

module.exports = MixController = (function(_super) {
  __extends(MixController, _super);

  function MixController() {
    return MixController.__super__.constructor.apply(this, arguments);
  }

  MixController.prototype.rc = function() {
    var greeting, model, name, user, _ref;
    if (!Chaplin.mediator.canTransition && utils.isMobile()) {
      return utils.redirectToTransitionStatic();
    }
    if (utils.isVisitor()) {
      return utils.redirectToTransitionStatic();
    }
    user = Chaplin.mediator.userM;
    name = (user != null ? (_ref = user.get('name')) != null ? _ref.split(' ')[0] : void 0 : void 0) || false;
    greeting = '';
    if (name) {
      greeting = 'Hey ' + name;
    }
    model = new Model();
    model.set({
      '_mixOnboardGreeting': greeting
    });
    return this.view = new MixRCV({
      model: model
    });
  };

  MixController.prototype.beforeAction = function() {
    panel.close();
    return MixController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        return _this.reuse('toolbar', utils.getToolbarView(), {
          region: 'toolbar'
        });
      };
    })(this));
  };

  MixController.prototype.getProtocol = function() {
    return document.location.protocol;
  };

  return MixController;

})(AppBaseController);


},{"../lib/panel":125,"../lib/utils":156,"../models/base/model":168,"../views/mix-rc-view":661,"./base/app-controller":"GaC0VN"}],"controllers/mix-controller":[function(require,module,exports){
module.exports=require('ueWto2');
},{}],"dkDAy5":[function(require,module,exports){
var ActivityCenterController, ActivityCenterView, Controller, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('../base/controller');

ActivityCenterView = require('../../views/activity-center/activity-center-view');

mediator = require('chaplin').mediator;

module.exports = ActivityCenterController = (function(_super) {
  __extends(ActivityCenterController, _super);

  function ActivityCenterController() {
    return ActivityCenterController.__super__.constructor.apply(this, arguments);
  }

  ActivityCenterController.prototype.initialize = function() {
    ActivityCenterController.__super__.initialize.apply(this, arguments);
    return this.view = new ActivityCenterView({
      className: 'activity-center-container container',
      region: 'panel-right',
      collection: mediator.conversationC,
      conversationCollection: mediator.conversationC,
      followCollection: mediator.activityFollowC
    });
  };

  return ActivityCenterController;

})(Controller);


},{"../../views/activity-center/activity-center-view":597,"../base/controller":"UQqhgU","chaplin":773}],"controllers/panels/activity-center-controller":[function(require,module,exports){
module.exports=require('dkDAy5');
},{}],"controllers/panels/alert-controller":[function(require,module,exports){
module.exports=require('NtLx2I');
},{}],"NtLx2I":[function(require,module,exports){
var AlertController, AlertM, AlertV, Controller,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('../base/controller');

AlertV = require('../../views/alert-view');

AlertM = require('../../models/alert-model');

module.exports = AlertController = (function(_super) {
  __extends(AlertController, _super);

  function AlertController() {
    return AlertController.__super__.constructor.apply(this, arguments);
  }

  AlertController.prototype.initialize = function(options) {
    AlertController.__super__.initialize.apply(this, arguments);
    this.model = new AlertM({
      text: options != null ? options.text : void 0,
      type: options != null ? options.type : void 0
    });
    return this.view = new AlertV({
      region: 'panel',
      model: this.model
    });
  };

  return AlertController;

})(Controller);


},{"../../models/alert-model":164,"../../views/alert-view":603,"../base/controller":"UQqhgU"}],"controllers/panels/conversation-controller":[function(require,module,exports){
module.exports=require('9FDYms');
},{}],"9FDYms":[function(require,module,exports){
var Controller, ConversationController, ConversationV, EventsV, Model, ParticipantsV, mediator, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('../base/controller');

Model = require('../../models/base/model');

ConversationV = require('../../views/conversations/conversation-view');

EventsV = require('../../views/conversations/events-view');

ParticipantsV = require('../../views/conversations/participants-view');

mediator = require('chaplin').mediator;

utils = require('../../lib/utils');

module.exports = ConversationController = (function(_super) {
  __extends(ConversationController, _super);

  function ConversationController() {
    return ConversationController.__super__.constructor.apply(this, arguments);
  }

  ConversationController.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    ConversationController.__super__.initialize.apply(this, arguments);
    this.conversationM = options.conversationM;
    return this.createConversation();
  };

  ConversationController.prototype.createConversation = function() {
    var conversationM;
    conversationM = this.conversationM;
    if (!conversationM) {
      return utils.logDebug("ConversationModel required");
    }
    this.conversationId = conversationM.get('id');
    this.conversationView = new ConversationV({
      autoRender: true,
      model: conversationM,
      className: 'conversation-container container',
      region: 'panel-right'
    });
    this.eventsView = new EventsV({
      autoRender: true,
      container: '.event-list',
      collection: conversationM.get('eventsC')
    });
    return this.conversationView.subview(this.eventsView);
  };

  return ConversationController;

})(Controller);


},{"../../lib/utils":156,"../../models/base/model":168,"../../views/conversations/conversation-view":612,"../../views/conversations/events-view":614,"../../views/conversations/participants-view":623,"../base/controller":"UQqhgU","chaplin":773}],"GutTFp":[function(require,module,exports){
var Controller, DropdownMenuController, DropdownMenuView, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('../base/controller');

DropdownMenuView = require('../../views/dropdown-menu-view');

mediator = require('chaplin').mediator;

module.exports = DropdownMenuController = (function(_super) {
  __extends(DropdownMenuController, _super);

  function DropdownMenuController() {
    return DropdownMenuController.__super__.constructor.apply(this, arguments);
  }

  DropdownMenuController.prototype.initialize = function() {
    DropdownMenuController.__super__.initialize.apply(this, arguments);
    return this.view = new DropdownMenuView({
      model: mediator.activityNotificationM
    });
  };

  return DropdownMenuController;

})(Controller);


},{"../../views/dropdown-menu-view":632,"../base/controller":"UQqhgU","chaplin":773}],"controllers/panels/dropdown-menu-controller":[function(require,module,exports){
module.exports=require('GutTFp');
},{}],"4vd+/e":[function(require,module,exports){
var Controller, DropdownShareController, DropdownShareView, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('../base/controller');

DropdownShareView = require('../../views/dropdown-share-view');

mediator = require('chaplin').mediator;

module.exports = DropdownShareController = (function(_super) {
  __extends(DropdownShareController, _super);

  function DropdownShareController() {
    return DropdownShareController.__super__.constructor.apply(this, arguments);
  }

  DropdownShareController.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    DropdownShareController.__super__.initialize.apply(this, arguments);
    return this.view = new DropdownShareView({
      model: (options != null ? options.stumbleM : void 0) || mediator.stumblesC.getActive(),
      relateToSelector: options != null ? options.relateToSelector : void 0,
      container: '#dropdown-share-container'
    });
  };

  return DropdownShareController;

})(Controller);


},{"../../views/dropdown-share-view":633,"../base/controller":"UQqhgU","chaplin":773}],"controllers/panels/dropdown-share-controller":[function(require,module,exports){
module.exports=require('4vd+/e');
},{}],"controllers/panels/dropdown-thumbdown-controller":[function(require,module,exports){
module.exports=require('uALb3R');
},{}],"uALb3R":[function(require,module,exports){
var Controller, DropdownThumbDownController, DropdownThumbDownView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('../base/controller');

DropdownThumbDownView = require('../../views/dropdown-thumbdown-view');

module.exports = DropdownThumbDownController = (function(_super) {
  __extends(DropdownThumbDownController, _super);

  function DropdownThumbDownController() {
    return DropdownThumbDownController.__super__.constructor.apply(this, arguments);
  }

  DropdownThumbDownController.prototype.initialize = function() {
    DropdownThumbDownController.__super__.initialize.apply(this, arguments);
    return this.view = new DropdownThumbDownView;
  };

  return DropdownThumbDownController;

})(Controller);


},{"../../views/dropdown-thumbdown-view":634,"../base/controller":"UQqhgU"}],"hShYzq":[function(require,module,exports){
var Controller, EmailShareController, EmailShareModel, EmailShareView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('../base/controller');

EmailShareView = require('../../views/email-share-view');

EmailShareModel = require('../../models/email-share-model');

module.exports = EmailShareController = (function(_super) {
  __extends(EmailShareController, _super);

  function EmailShareController() {
    return EmailShareController.__super__.constructor.apply(this, arguments);
  }

  EmailShareController.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    EmailShareController.__super__.initialize.apply(this, arguments);
    return this.view = new EmailShareView({
      autoRender: true,
      region: 'panel',
      className: 'email-share-container',
      model: new EmailShareModel,
      stumbleM: options.stumbleM
    });
  };

  return EmailShareController;

})(Controller);


},{"../../models/email-share-model":174,"../../views/email-share-view":635,"../base/controller":"UQqhgU"}],"controllers/panels/email-share-controller":[function(require,module,exports){
module.exports=require('hShYzq');
},{}],"MIZV2H":[function(require,module,exports){
var AddToListView, Controller, CreateListView, ListController, ListM, mediator, panel,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('../base/controller');

AddToListView = require('../../views/add-to-list-view');

CreateListView = require('../../views/create-list-view');

ListM = require('../../models/list-model');

mediator = require('chaplin').mediator;

panel = require('../../lib/panel');

module.exports = ListController = (function(_super) {
  __extends(ListController, _super);

  function ListController() {
    return ListController.__super__.constructor.apply(this, arguments);
  }

  ListController.prototype.initialize = function() {
    ListController.__super__.initialize.apply(this, arguments);
    this.subscribeEvent('list:displaycreate', this.displayCreateList);
    this.subscribeEvent('list:added', this.addCurrentStumbleTo);
    this.subscribeEvent('list:itemadd', this.addCurrentStumbleTo);
    this.subscribeEvent('list:displayadd', this.displayAddToList);
    this.subscribeEvent('list:itemadded', this.closePanel);
    this.subscribeEvent('list:itemadded:error', this.closePanel);
    this.displayAddToList();
    return mediator.listsC.fetch();
  };

  ListController.prototype.displayAddToList = function() {
    var _ref;
    if ((_ref = this.createlistview) != null) {
      _ref.dispose();
    }
    return this.addtolistview = new AddToListView({
      collection: mediator.listsC
    });
  };

  ListController.prototype.displayCreateList = function(name) {
    var listM, _ref;
    listM = new ListM({
      name: name
    });
    if ((_ref = this.addtolistview) != null) {
      _ref.dispose();
    }
    return this.createlistview = new CreateListView({
      model: listM
    });
  };

  ListController.prototype.addCurrentStumbleTo = function(listM) {
    return listM.get('listItemsC').addCurrentStumble();
  };

  ListController.prototype.closePanel = function() {
    return this.setTimeout((function(_this) {
      return function() {
        return panel.close();
      };
    })(this), '2s');
  };

  return ListController;

})(Controller);


},{"../../lib/panel":125,"../../models/list-model":200,"../../views/add-to-list-view":601,"../../views/create-list-view":626,"../base/controller":"UQqhgU","chaplin":773}],"controllers/panels/list-controller":[function(require,module,exports){
module.exports=require('MIZV2H');
},{}],"SgcMXx":[function(require,module,exports){
var Controller, ModesController, ModesView, View, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('../base/controller');

ModesView = require('../../views/modes-view');

View = require('../../views/base/view');

mediator = require('chaplin').mediator;

module.exports = ModesController = (function(_super) {
  __extends(ModesController, _super);

  function ModesController() {
    return ModesController.__super__.constructor.apply(this, arguments);
  }

  ModesController.prototype.initialize = function() {
    ModesController.__super__.initialize.apply(this, arguments);
    return this.view = new ModesView({
      autoRender: true,
      region: 'panel',
      className: 'modes-container',
      collection: mediator.modesC,
      filterer: function(model) {
        return model.get('_hide') === !true;
      }
    });
  };

  return ModesController;

})(Controller);


},{"../../views/base/view":608,"../../views/modes-view":666,"../base/controller":"UQqhgU","chaplin":773}],"controllers/panels/modes-controller":[function(require,module,exports){
module.exports=require('SgcMXx');
},{}],"aBON5c":[function(require,module,exports){
var Controller, ShareController, ShareModel, ShareView, mediator, panel,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Controller = require('../base/controller');

ShareView = require('../../views/share-view');

ShareModel = require('../../models/share-model');

mediator = require('chaplin').mediator;

panel = require('../../lib/panel');

module.exports = ShareController = (function(_super) {
  __extends(ShareController, _super);

  function ShareController() {
    return ShareController.__super__.constructor.apply(this, arguments);
  }

  ShareController.prototype.initialize = function(options) {
    var shareM;
    if (options == null) {
      options = {};
    }
    this.options = options;
    ShareController.__super__.initialize.apply(this, arguments);
    if (!this.canShare()) {
      setTimeout((function(_this) {
        return function() {
          return panel.open('alert', {
            type: 'error',
            text: "You cannot share this page."
          });
        };
      })(this), 400);
      return this.dispose();
    }
    shareM = new ShareModel();
    return this.view = new ShareView({
      autoRender: true,
      region: 'panel',
      className: 'share-container',
      shareM: shareM,
      model: options.stumbleM,
      shareUrlId: options.shareUrlId
    });
  };

  ShareController.prototype.canShare = function() {
    var _ref;
    return !!(((_ref = this.options) != null ? _ref.stumbleM : void 0) || mediator.stumblesC.getActive());
  };

  return ShareController;

})(Controller);


},{"../../lib/panel":125,"../../models/share-model":236,"../../views/share-view":717,"../base/controller":"UQqhgU","chaplin":773}],"controllers/panels/share-controller":[function(require,module,exports){
module.exports=require('aBON5c');
},{}],"controllers/profile/additionslikes-controller":[function(require,module,exports){
module.exports=require('LbDTXs');
},{}],"LbDTXs":[function(require,module,exports){
var $, AdditionsCollection, AdditionsLikesController, Model, ProfileController, ProfileListV, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

AdditionsCollection = require('../../models/likes-additions-collection');

ProfileListV = require('../../views/profile/list-view');

Model = require('../../models/base/model');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = AdditionsLikesController = (function(_super) {
  __extends(AdditionsLikesController, _super);

  function AdditionsLikesController() {
    return AdditionsLikesController.__super__.constructor.apply(this, arguments);
  }

  AdditionsLikesController.prototype.displayAdditionLikes = function(data) {
    var additionsCollection, identityM, options;
    identityM = mediator.currentProfileM.get('identityM');
    identityM.set('_currentList', 'additions');
    this.setNavSelection('additions');
    options = {};
    options.data = {
      userid: identityM.get('userid'),
      limit: mediator.profileItemsPerPage,
      offset: 0
    };
    additionsCollection = new AdditionsCollection;
    additionsCollection.fetch(options);
    this.displayUserHeader();
    return this.displayProfileView(additionsCollection);
  };

  AdditionsLikesController.prototype.getHeaderModel = function(identityM) {
    var headerM;
    $('#profile-container').removeClass('list-detail-view');
    if (identityM.get('_isSelf')) {
      $('#profile-container').addClass('owner');
    } else {
      $('#profile-container').removeClass('owner');
    }
    headerM = new Model({
      _selectorName: "Additions",
      _isDefault: true
    });
    return headerM;
  };

  return AdditionsLikesController;

})(ProfileController);


},{"../../models/base/model":168,"../../models/likes-additions-collection":192,"../../views/profile/list-view":679,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"controllers/profile/followers-controller":[function(require,module,exports){
module.exports=require('PTNjgv');
},{}],"PTNjgv":[function(require,module,exports){
var $, FollowersC, FollowersController, Model, ProfileController, UsersV, ViewDecorator, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

FollowersC = require('../../models/followers-collection');

UsersV = require('../../views/profile/users-view');

Model = require('../../models/base/model');

mediator = require('chaplin').mediator;

$ = require('jquery');

ViewDecorator = require('../../views/decorators/decorator');

module.exports = FollowersController = (function(_super) {
  __extends(FollowersController, _super);

  function FollowersController() {
    return FollowersController.__super__.constructor.apply(this, arguments);
  }

  FollowersController.prototype.displayFollowers = function(data) {
    var followersC, identityM, options;
    $('#profile-container').removeClass('list-detail-view');
    identityM = mediator.currentProfileM.get('identityM');
    identityM.set('_currentList', 'followers');
    this.setNavSelection('followers');
    options = {};
    options.data = {
      userid: identityM.get('userid'),
      limit: mediator.profileItemsPerPage,
      offset: 0
    };
    followersC = new FollowersC;
    followersC.fetch(options);
    followersC._total = identityM.get('followers_count');
    this.displayUserHeader();
    return this.displayView(followersC);
  };

  FollowersController.prototype.displayView = function(followersC) {
    var ViewConstructor;
    if (followersC) {
      this.followersC = followersC;
    }
    if (this.paginated) {
      ViewConstructor = ViewDecorator.makePaginated(UsersV);
    } else {
      ViewConstructor = ViewDecorator.makeContinuouslyScrollable(UsersV);
    }
    return this.view = new ViewConstructor({
      autoRender: true,
      region: 'profile',
      collection: this.followersC
    });
  };

  FollowersController.prototype.refreshProfileView = function() {
    var _ref;
    if ((_ref = this.view) != null) {
      _ref.dispose();
    }
    return this.displayFollowers();
  };

  FollowersController.prototype.getHeaderModel = function(identityM) {
    var headerM;
    return headerM = new Model({
      _selectorName: 'Followers',
      _canFollowMore: true,
      itemCount: identityM.get('followers_count')
    });
  };

  return FollowersController;

})(ProfileController);


},{"../../models/base/model":168,"../../models/followers-collection":182,"../../views/decorators/decorator":629,"../../views/profile/users-view":691,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"juhPJu":[function(require,module,exports){
var $, FollowingC, FollowingController, Model, ProfileController, UsersV, ViewDecorator, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

FollowingC = require('../../models/following-collection');

UsersV = require('../../views/profile/users-view');

Model = require('../../models/base/model');

mediator = require('chaplin').mediator;

$ = require('jquery');

ViewDecorator = require('../../views/decorators/decorator');

module.exports = FollowingController = (function(_super) {
  __extends(FollowingController, _super);

  function FollowingController() {
    return FollowingController.__super__.constructor.apply(this, arguments);
  }

  FollowingController.prototype.connections = function(data) {
    return Chaplin.utils.redirectTo({
      'url': "/stumbler/" + data.username + "/following"
    });
  };

  FollowingController.prototype.displayFollowing = function(data) {
    var followingC, identityM, options;
    $('#profile-container').removeClass('list-detail-view');
    identityM = mediator.currentProfileM.get('identityM');
    identityM.set('_currentList', 'following');
    this.setNavSelection('following');
    options = {};
    options.data = {
      userid: identityM.get('userid'),
      limit: mediator.profileItemsPerPage,
      offset: 0
    };
    followingC = new FollowingC;
    followingC.fetch(options);
    followingC._total = identityM.get('following_count');
    this.displayUserHeader();
    return this.displayView(followingC);
  };

  FollowingController.prototype.displayView = function(followingC) {
    var ViewConstructor;
    if (followingC) {
      this.followingC = followingC;
    }
    if (this.paginated) {
      ViewConstructor = ViewDecorator.makePaginated(UsersV);
    } else {
      ViewConstructor = ViewDecorator.makeContinuouslyScrollable(UsersV);
    }
    return this.view = new ViewConstructor({
      autoRender: true,
      region: 'profile',
      collection: this.followingC
    });
  };

  FollowingController.prototype.refreshProfileView = function() {
    var _ref;
    if ((_ref = this.view) != null) {
      _ref.dispose();
    }
    return this.displayView();
  };

  FollowingController.prototype.getHeaderModel = function(identityM) {
    var headerM;
    return headerM = new Model({
      _selectorName: 'Following',
      _canFollowMore: true,
      itemCount: identityM.get('following_count')
    });
  };

  return FollowingController;

})(ProfileController);


},{"../../models/base/model":168,"../../models/following-collection":183,"../../views/decorators/decorator":629,"../../views/profile/users-view":691,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"controllers/profile/following-controller":[function(require,module,exports){
module.exports=require('juhPJu');
},{}],"controllers/profile/followinglists-controller":[function(require,module,exports){
module.exports=require('rjdrI+');
},{}],"rjdrI+":[function(require,module,exports){
var $, Model, ProfileController, ProfileFollowingListsController, ProfileHeadV, ProfileListsFollowingC, lists, mediator, profile, user,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

ProfileListsFollowingC = require('../../models/profile-listsfollowing-collection');

profile = require('../../lib/profile');

ProfileHeadV = require('../../views/profile/profilehead-view');

Model = require('../../models/base/model');

lists = require('../../lib/lists');

user = require('../../lib/user');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = ProfileFollowingListsController = (function(_super) {
  __extends(ProfileFollowingListsController, _super);

  function ProfileFollowingListsController() {
    return ProfileFollowingListsController.__super__.constructor.apply(this, arguments);
  }

  ProfileFollowingListsController.prototype.displayLists = function(data) {
    var identityM, listsItemC, options;
    identityM = mediator.currentProfileM.get('identityM');
    identityM.set('_currentList', 'following-lists');
    options = {};
    options.reset = true;
    options.data = {
      userid: identityM.get('userid'),
      limit: mediator.profileItemsPerPage,
      offset: 0,
      sorted: true
    };
    listsItemC = new ProfileListsFollowingC;
    return listsItemC.fetch(options).then((function(_this) {
      return function(data) {
        _this.displayUserHeader();
        return _this.displayProfileView(listsItemC, {
          listId: 'following-lists'
        });
      };
    })(this));
  };

  ProfileFollowingListsController.prototype.getHeaderModel = function(identityM) {
    var headerM;
    $('#profile-container').removeClass('list-detail-view');
    if (identityM.get('_isSelf')) {
      $('#profile-container').addClass('owner');
    } else {
      $('#profile-container').removeClass('owner');
    }
    headerM = new Model({
      _selectorName: "Followed Lists",
      _isDefault: true
    });
    return headerM;
  };

  return ProfileFollowingListsController;

})(ProfileController);


},{"../../lib/lists":122,"../../lib/profile":126,"../../lib/user":155,"../../models/base/model":168,"../../models/profile-listsfollowing-collection":220,"../../views/profile/profilehead-view":686,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"zQih3N":[function(require,module,exports){
var $, HistoryController, HistoryItemsC, HistoryListV, Model, ProfileController, lists, mediator, profile, user,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

HistoryItemsC = require('../../models/history-collection');

profile = require('../../lib/profile');

HistoryListV = require('../../views/profile/history-list-view');

Model = require('../../models/base/model');

lists = require('../../lib/lists');

user = require('../../lib/user');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = HistoryController = (function(_super) {
  __extends(HistoryController, _super);

  function HistoryController() {
    return HistoryController.__super__.constructor.apply(this, arguments);
  }

  HistoryController.prototype.pageSize = 100;

  HistoryController.prototype.displayHistory = function(data) {
    var historyItemsC, identityM, options;
    identityM = mediator.currentProfileM.get('identityM');
    identityM.set('_currentList', 'history');
    options = {};
    options.reset = true;
    options.data = {
      userid: identityM.get('userid'),
      limit: this.pageSize,
      offset: 0
    };
    historyItemsC = new HistoryItemsC;
    return historyItemsC.fetch(options).then((function(_this) {
      return function(data) {
        _this.displayUserHeader();
        return _this.displayProfileView(historyItemsC, {
          listId: 'history'
        }, HistoryListV);
      };
    })(this));
  };

  HistoryController.prototype.getHeaderModel = function(identityM) {
    var headerM;
    $('#profile-container').removeClass('list-detail-view');
    if (identityM.get('_isSelf')) {
      $('#profile-container').addClass('owner');
    } else {
      $('#profile-container').removeClass('owner');
    }
    headerM = new Model({
      _selectorName: "History"
    });
    return headerM;
  };

  return HistoryController;

})(ProfileController);


},{"../../lib/lists":122,"../../lib/profile":126,"../../lib/user":155,"../../models/base/model":168,"../../models/history-collection":185,"../../views/profile/history-list-view":673,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"controllers/profile/history-controller":[function(require,module,exports){
module.exports=require('zQih3N');
},{}],"SuAmUW":[function(require,module,exports){
var InterestsC, LikesByInterestController, LikesController, LikesForInterestC, mediator, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

LikesController = require('./likes-controller');

LikesForInterestC = require('../../models/likes-for-interest-collection');

InterestsC = require('../../models/interests-collection');

utils = require('../../lib/utils');

mediator = require('chaplin').mediator;

module.exports = LikesByInterestController = (function(_super) {
  __extends(LikesByInterestController, _super);

  function LikesByInterestController() {
    return LikesByInterestController.__super__.constructor.apply(this, arguments);
  }

  LikesByInterestController.prototype.getLikes = function(interestId) {
    var identityM, likesC;
    identityM = mediator.currentProfileM.get('identityM');
    likesC = new LikesForInterestC([], {
      userId: identityM.get('userid'),
      interestId: interestId
    });
    likesC.fetch();
    if (this.headerUpdated !== true) {
      likesC.on('sync', (function(_this) {
        return function() {
          _this.displayUserHeader();
          return _this.headerUpdated = true;
        };
      })(this));
    }
    return likesC;
  };

  LikesByInterestController.prototype.displayLikes = function(params, route) {
    return utils.getCachedCollection('all-interests', utils.DAY_IN_MILLISECONDS, InterestsC, {}, true).then((function(_this) {
      return function(categorizedInterests) {
        var display;
        display = function() {
          var identityM, interestM, _ref;
          identityM = mediator.currentProfileM.get('identityM');
          interestM = utils.interestModelFromParams(params, categorizedInterests);
          if (!interestM) {
            Chaplin.utils.redirectTo('errors/not-found#notFound');
          }
          identityM.set('_currentList', interestM.get('id'));
          _this.isListDetailView = true;
          _this.listName = "Your likes from " + (interestM.get('name'));
          _this.likesC = _this.getLikes(interestM.get('id'));
          _this.selectorName = "Interests";
          if ((_ref = _this.profileListView) != null) {
            _ref.dispose();
          }
          return _this.displayProfileView(_this.likesC);
        };
        if (categorizedInterests.length) {
          return display();
        } else {
          return _this.listenToOnce(categorizedInterests, 'sync', display);
        }
      };
    })(this));
  };

  return LikesByInterestController;

})(LikesController);


},{"../../lib/utils":156,"../../models/interests-collection":188,"../../models/likes-for-interest-collection":194,"./likes-controller":"tPjidB","chaplin":773}],"controllers/profile/likes-by-interest-controller":[function(require,module,exports){
module.exports=require('SuAmUW');
},{}],"+pzGf1":[function(require,module,exports){
var LikesByTagController, LikesController, LikesForTagC, mediator, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

LikesController = require('./likes-controller');

LikesForTagC = require('../../models/likes-for-tag-collection');

utils = require('../../lib/utils');

mediator = require('chaplin').mediator;

module.exports = LikesByTagController = (function(_super) {
  __extends(LikesByTagController, _super);

  function LikesByTagController() {
    return LikesByTagController.__super__.constructor.apply(this, arguments);
  }

  LikesByTagController.beforeAction = function(params, route, options) {
    return LikesByTagController.__super__.constructor.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        return _this.getLikesCollection(params.tagId);
      };
    })(this)).then((function(_this) {
      return function(likesC) {
        return _this.likesC = likesC;
      };
    })(this));
  };

  LikesByTagController.prototype.getLikesCollection = function(id) {
    var identityM, likesC;
    identityM = mediator.currentProfileM.get('identityM');
    likesC = new LikesForTagC([], {
      userId: identityM.get('userid'),
      tagId: id
    });
    likesC.fetch();
    if (this.headerUpdated !== true) {
      likesC.on('sync', (function(_this) {
        return function() {
          _this.displayUserHeader();
          return _this.headerUpdated = true;
        };
      })(this));
    }
    return likesC;
  };

  LikesByTagController.prototype.displayLikes = function(params, route) {
    var identityM, tagId, _ref;
    identityM = mediator.currentProfileM.get('identityM');
    tagId = params.tagId;
    identityM.set('_currentList', tagId);
    this.isListDetailView = true;
    this.listName = "Your likes from " + (utils.getTagName(tagId));
    this.likesC = this.getLikesCollection(tagId);
    this.selectorName = "Tags";
    if ((_ref = this.profileListView) != null) {
      _ref.dispose();
    }
    return this.displayProfileView(this.likesC);
  };

  return LikesByTagController;

})(LikesController);


},{"../../lib/utils":156,"../../models/likes-for-tag-collection":195,"./likes-controller":"tPjidB","chaplin":773}],"controllers/profile/likes-by-tag-controller":[function(require,module,exports){
module.exports=require('+pzGf1');
},{}],"tPjidB":[function(require,module,exports){
var $, LikesC, LikesController, LikesSearchC, Model, ProfileController, mediator, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

LikesC = require('../../models/likes-collection');

LikesSearchC = require('../../models/likes-search-collection');

Model = require('../../models/base/model');

utils = require('../../lib/utils');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = LikesController = (function(_super) {
  __extends(LikesController, _super);

  function LikesController() {
    return LikesController.__super__.constructor.apply(this, arguments);
  }

  LikesController.prototype.initialize = function() {
    LikesController.__super__.initialize.apply(this, arguments);
    this.subscribeEvent('profile:searchfromheader', this.onSearchFromHeader);
    this.isListDetailView = false;
    return this.listName = null;
  };

  LikesController.prototype.displaySelf = function() {
    var _ref;
    return Chaplin.utils.redirectTo({
      url: "stumbler/" + ((_ref = mediator.userM) != null ? _ref.get('username') : void 0)
    });
  };

  LikesController.prototype.displayLikes = function(data) {
    var identityM, numberOfLikes, postfix;
    identityM = mediator.currentProfileM.get('identityM');
    identityM.set('_currentList', 'likes');
    numberOfLikes = utils.numberFormat(parseInt(identityM.get('likes_count') || 0));
    postfix = ' Likes';
    if (numberOfLikes === '1') {
      postfix = ' Like';
    }
    this.selectorName = numberOfLikes + postfix;
    this.setNavSelection('likes');
    this.likesC = this.getLikesCollection();
    this.displayUserHeader();
    return this.displayProfileView(this.likesC, {
      listId: 'likes'
    });
  };

  LikesController.prototype.getLikesCollection = function(query) {
    var identityM, likesC, options;
    identityM = mediator.currentProfileM.get('identityM');
    options = {};
    options.data = {
      userid: identityM.get('userid'),
      limit: mediator.profileItemsPerPage,
      offset: 0
    };
    if (query) {
      likesC = new LikesSearchC([], {
        query: query
      });
      options.data.q = query;
    } else {
      likesC = new LikesC;
    }
    likesC.fetch(options);
    likesC.on('sync', (function(_this) {
      return function() {
        if (!((query != null) || _this.headerUpdated)) {
          return _this.displayUserHeader() && (_this.headerUpdated = true);
        }
      };
    })(this));
    return likesC;
  };

  LikesController.prototype.onSearchFromHeader = function(query) {
    var _ref;
    if ((_ref = this.profileListView) != null) {
      _ref.dispose();
    }
    return this.displayProfileView(this.likesC = this.getLikesCollection(query));
  };

  LikesController.prototype.getHeaderModel = function(identityM) {
    var headerM, _ref, _ref1;
    $('#profile-container').removeClass('list-detail-view');
    if (this.isListDetailView) {
      $('#profile-container').addClass('list-detail-view');
    }
    if (identityM.get('_isSelf')) {
      $('#profile-container').addClass('owner');
    } else {
      $('#profile-container').removeClass('owner');
    }
    headerM = new Model({
      _selectorName: this.selectorName,
      _canEdit: false,
      _isSelf: identityM.get('_isSelf'),
      _isDefault: true,
      _canStumbleLikes: ((_ref = this.likesC) != null ? _ref.length : void 0) > 0,
      _isListDetailView: this.isListDetailView,
      _showSearch: true,
      name: this.listName
    });
    if (identityM.get('userid') === ((_ref1 = mediator.userM) != null ? _ref1.get('userid') : void 0)) {
      headerM.set({
        id: 'likes'
      });
    }
    return headerM;
  };

  return LikesController;

})(ProfileController);


},{"../../lib/utils":156,"../../models/base/model":168,"../../models/likes-collection":193,"../../models/likes-search-collection":197,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"controllers/profile/likes-controller":[function(require,module,exports){
module.exports=require('tPjidB');
},{}],"controllers/profile/list-controller":[function(require,module,exports){
module.exports=require('JwTF1w');
},{}],"JwTF1w":[function(require,module,exports){
var $, ListMetaM, ProfileController, ProfileHeadV, ProfileListController, ProfileListItemsC, lists, mediator, profile, user,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

ProfileListItemsC = require('../../models/profile-listitems-collection');

profile = require('../../lib/profile');

ListMetaM = require('../../models/listmeta-model');

ProfileHeadV = require('../../views/profile/profilehead-view');

lists = require('../../lib/lists');

user = require('../../lib/user');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = ProfileListController = (function(_super) {
  __extends(ProfileListController, _super);

  function ProfileListController() {
    return ProfileListController.__super__.constructor.apply(this, arguments);
  }

  ProfileListController.prototype.displayList = function(data) {
    var identityM, listItemsC, options, userid;
    identityM = mediator.currentProfileM.get('identityM');
    userid = mediator.userM.get('userid');
    identityM.set('_currentList', data.listId);
    this.setNavSelection(data.listId);
    options = {};
    options.data = {
      listId: data.listId,
      limit: mediator.profileItemsPerPage,
      offset: 0
    };
    if (userid) {
      options.data.userid = userid;
    }
    listItemsC = new ProfileListItemsC;
    listItemsC.listId = data.listId;
    listItemsC.fetch(options);
    this.displayProfileView(listItemsC, {
      listId: data.listId
    });
    return this.displayListHeader(data.listId, userid);
  };

  ProfileListController.prototype.displayListHeader = function(listId, userid) {
    var fetchModel, identityM, listMetaM, listsC, options;
    identityM = mediator.currentProfileM.get('identityM');
    options = {};
    options.data = {
      listId: listId,
      offset: 0,
      limit: 1,
      userid: userid
    };
    listMetaM = new ListMetaM({
      _selectorName: 'Loading...'
    });
    this.createHeadView(listMetaM);
    fetchModel = (function(_this) {
      return function() {
        return listMetaM.fetch(options).then(function(data) {
          var _ref, _ref1, _ref2, _ref3;
          if (!_this.disposed) {
            _this.setButtons(listMetaM);
            _this.setHeaderModelProperties(listMetaM);
            if (!identityM.get('username')) {
              profile.setIdentityModel({
                username: (_ref = data.list) != null ? (_ref1 = _ref.owner) != null ? _ref1.username : void 0 : void 0
              });
            }
            return listMetaM.set({
              _owner_username: (_ref2 = data.list) != null ? (_ref3 = _ref2.owner) != null ? _ref3.username : void 0 : void 0
            });
          }
        });
      };
    })(this);
    if (identityM.get('_isSelf')) {
      listsC = user.getCurrentUserLists();
      listsC.whenPopulated().then((function(_this) {
        return function() {
          var list;
          list = listsC.findWhere({
            'id': listId
          });
          if (list) {
            listMetaM.set(list.toJSON());
            _this.setButtons(listMetaM);
            return _this.setHeaderModelProperties(listMetaM);
          } else {
            return fetchModel();
          }
        };
      })(this));
    } else {
      fetchModel();
    }
    return this.setListSubHeader(listMetaM);
  };

  ProfileListController.prototype.setListSubHeader = function(listMetaM) {
    var identityM;
    $('#profile-container').removeClass('list-detail-view');
    identityM = mediator.currentProfileM.get('identityM');
    if (identityM.get('_isSelf')) {
      $('#profile-container').addClass('owner');
    } else {
      $('#profile-container').removeClass('owner');
    }
    $('#profile-container').addClass('list-detail-view');
    return listMetaM.set({
      _selectorName: "Lists",
      _isListDetailView: true
    });
  };

  ProfileListController.prototype.setButtons = function(listMetaM) {
    var canEdit;
    canEdit = lists.canEdit(listMetaM);
    listMetaM.set({
      _canEdit: canEdit,
      _canStumbleList: listMetaM.get("itemCount") > 0
    });
    if (canEdit) {
      return $('#profile-container').addClass('owner');
    } else {
      return $('#profile-container').removeClass('owner');
    }
  };

  ProfileListController.prototype.createHeadView = function(listMetaM) {
    var identityM;
    identityM = mediator.currentProfileM.get('identityM');
    return this.headerV = new ProfileHeadV({
      region: 'profilehead',
      model: listMetaM
    });
  };

  return ProfileListController;

})(ProfileController);


},{"../../lib/lists":122,"../../lib/profile":126,"../../lib/user":155,"../../models/listmeta-model":201,"../../models/profile-listitems-collection":218,"../../views/profile/profilehead-view":686,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"controllers/profile/lists-controller":[function(require,module,exports){
module.exports=require('AZ40Zy');
},{}],"AZ40Zy":[function(require,module,exports){
var $, Model, ProfileController, ProfileHeadV, ProfileListsController, ProfileListsItemsC, ProfileListsV, lists, mediator, profile, user,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

ProfileListsItemsC = require('../../models/profile-lists-collection');

profile = require('../../lib/profile');

ProfileHeadV = require('../../views/profile/profilehead-view');

ProfileListsV = require('../../views/profile/lists-view');

Model = require('../../models/base/model');

lists = require('../../lib/lists');

user = require('../../lib/user');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = ProfileListsController = (function(_super) {
  __extends(ProfileListsController, _super);

  function ProfileListsController() {
    return ProfileListsController.__super__.constructor.apply(this, arguments);
  }

  ProfileListsController.prototype.displayLists = function(data) {
    var identityM, listsItemC, options;
    identityM = mediator.currentProfileM.get('identityM');
    identityM.set('_currentList', 'lists');
    options = {};
    options.reset = true;
    options.data = {
      userid: identityM.get('userid'),
      limit: mediator.profileItemsPerPage,
      offset: 0,
      sorted: true
    };
    listsItemC = new ProfileListsItemsC;
    return listsItemC.fetch(options).then((function(_this) {
      return function(data) {
        _this.displayUserHeader();
        return _this.displayProfileView(listsItemC, {
          'listId': 'lists'
        }, ProfileListsV);
      };
    })(this));
  };

  ProfileListsController.prototype.getHeaderModel = function(identityM) {
    var headerM;
    $('#profile-container').removeClass('list-detail-view');
    if (identityM.get('_isSelf')) {
      $('#profile-container').addClass('owner');
    } else {
      $('#profile-container').removeClass('owner');
    }
    headerM = new Model({
      _selectorName: "Lists",
      _isDefault: true
    });
    return headerM;
  };

  return ProfileListsController;

})(ProfileController);


},{"../../lib/lists":122,"../../lib/profile":126,"../../lib/user":155,"../../models/base/model":168,"../../models/profile-lists-collection":219,"../../views/profile/lists-view":680,"../../views/profile/profilehead-view":686,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"iOvw+V":[function(require,module,exports){
var $, Model, PhotoLikesC, PhotoLikesController, ProfileController, ProfileListV, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

PhotoLikesC = require('../../models/likes-photos-collection');

ProfileListV = require('../../views/profile/list-view');

Model = require('../../models/base/model');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = PhotoLikesController = (function(_super) {
  __extends(PhotoLikesController, _super);

  function PhotoLikesController() {
    return PhotoLikesController.__super__.constructor.apply(this, arguments);
  }

  PhotoLikesController.prototype.displayPhotoLikes = function(data) {
    var identityM, options, photoLikesC;
    identityM = mediator.currentProfileM.get('identityM');
    identityM.set('_currentList', 'photos');
    this.setNavSelection('photos');
    options = {};
    options.data = {
      userid: identityM.get('userid'),
      limit: mediator.profileItemsPerPage,
      offset: 0
    };
    photoLikesC = new PhotoLikesC;
    photoLikesC.fetch(options);
    this.displayUserHeader();
    return this.displayProfileView(photoLikesC);
  };

  PhotoLikesController.prototype.getHeaderModel = function(identityM) {
    var headerM;
    $('#profile-container').removeClass('list-detail-view');
    if (identityM.get('_isSelf')) {
      $('#profile-container').addClass('owner');
    } else {
      $('#profile-container').removeClass('owner');
    }
    headerM = new Model({
      _selectorName: "Photos",
      _isDefault: true
    });
    return headerM;
  };

  return PhotoLikesController;

})(ProfileController);


},{"../../models/base/model":168,"../../models/likes-photos-collection":196,"../../views/profile/list-view":679,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"controllers/profile/photolikes-controller":[function(require,module,exports){
module.exports=require('iOvw+V');
},{}],"controllers/profile/profile-controller":[function(require,module,exports){
module.exports=require('ZRDRht');
},{}],"ZRDRht":[function(require,module,exports){
var $, AppBaseController, Model, ProfileController, ProfileHeadV, ProfileListV, ProfileV, ViewDecorator, config, mediator, panel, profile, stumble, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppBaseController = require('../base/app-controller');

utils = require('../../lib/utils');

_ = require('lodash');

$ = require('jquery');

panel = require('../../lib/panel');

stumble = require('../../lib/stumble');

profile = require('../../lib/profile');

mediator = require('chaplin').mediator;

config = require('../../config');

ProfileV = require('../../views/profile/profile-view');

ProfileHeadV = require('../../views/profile/profilehead-view');

ProfileListV = require('../../views/profile/list-view');

Model = require('../../models/base/model');

ViewDecorator = require('../../views/decorators/decorator');

module.exports = ProfileController = (function(_super) {
  __extends(ProfileController, _super);

  function ProfileController() {
    this.redirectUser = __bind(this.redirectUser, this);
    return ProfileController.__super__.constructor.apply(this, arguments);
  }

  ProfileController.prototype.addToListErrorMsg = 'There was an error adding to the list';

  ProfileController.prototype.listAddFailDuplicateCode = 19230;

  ProfileController.prototype.pageAlreadyInListErrorMsg = "That page is already in that List.";

  ProfileController.prototype.submitUrlErrorMsg = "That page cannot be added to StumbleUpon";

  ProfileController.prototype.addToListSuccessMsg = 'Page added to list!';

  ProfileController.prototype.initialize = function() {
    ProfileController.__super__.initialize.apply(this, arguments);
    $('body').addClass('viewing-profile');
    this.subscribeEvent('profile:itemaddedtolist', this.onItemAddedToList);
    this.subscribeEvent('profile:itemfailedtoadd', this.onItemFailedToAdd);
    this.subscribeEvent('profile:itemfailedtosubmit', this.onItemFailedToSubmit);
    this.subscribeEvent('profile:viewtype:changed', this.refreshProfileView);
    this.subscribeEvent('profile:identity:changed', this.refreshProfileView);
    this.subscribeEvent('profile:identity:onlyHeader:reset', this.displayUserHeader);
    this.subscribeEvent('profile:currentPageNumber', this.onPageNumberChange);
    this.subscribeEvent('scroll-view:maxed-out', this.showPaginated);
    if (utils.isVisitor()) {
      this.subscribeEvent('fb:model:login:success', this.redirectUser);
      this.subscribeEvent('fb:model:signup:success', this.redirectSignup);
    }
    return this.clearCurrentConvoM();
  };

  ProfileController.prototype.clearCurrentConvoM = function() {
    return utils.clearCurrentConvoM(true);
  };

  ProfileController.prototype.onItemAddedToList = function() {
    return panel.displaySuccessMsg(this.addToListSuccessMsg);
  };

  ProfileController.prototype.onItemFailedToAdd = function(e) {
    var json;
    if (e != null ? e.responseText : void 0) {
      json = JSON.parse(e.responseText);
      if (json._code === this.listAddFailDuplicateCode) {
        return panel.displaySuccessMsg(this.pageAlreadyInListErrorMsg);
      } else {
        return panel.displayErrorMsg(this.addToListErrorMsg);
      }
    } else {
      return panel.displayErrorMsg(this.addToListErrorMsg);
    }
  };

  ProfileController.prototype.onItemFailedToSubmit = function(err) {
    return panel.displayErrorMsg(this.submitUrlErrorMsg);
  };

  ProfileController.prototype.onPageNumberChange = function(newPage) {
    return this.pageNumber = newPage;
  };

  ProfileController.prototype.beforeAction = function(data) {
    panel.close();
    return ProfileController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        return profile.setIdentityModel(data);
      };
    })(this)).then((function(_this) {
      return function() {
        _this.setListView();
        _this.reuse('toolbar', utils.getToolbarView(), {
          region: 'toolbar',
          noScroll: true,
          skipStumbleIncrement: true
        });
        mediator.stumblesC.setActive(null);
        return _this.reuse('profile', ProfileV, {
          region: 'content'
        });
      };
    })(this), function(err) {
      var response;
      response = JSON.parse(err.responseText);
      if (response._error === "Forbidden") {
        Chaplin.utils.redirectTo({
          url: "/403"
        });
      }
      if (response._error === "Requested user does not exist") {
        return Chaplin.utils.redirectTo({
          url: "/404"
        });
      }
    });
  };

  ProfileController.prototype.showPaginated = function() {
    this.paginated = true;
    this.pageNumber = Math.floor(config.continuousScrollMaxItems / mediator.profileItemsPerPage);
    return this.refreshProfileView();
  };

  ProfileController.prototype.displayProfileView = function(collection, options, ListViewConstructor) {
    var ViewConstructor, o, profileOptions;
    if (options == null) {
      options = {};
    }
    if (ListViewConstructor == null) {
      ListViewConstructor = ProfileListV;
    }
    if (collection) {
      this.collection = collection;
    }
    if (options) {
      this.options = _.extend(this.options || {}, options);
    }
    o = {
      autoRender: true,
      region: 'profile',
      collection: this.collection,
      pageNumber: this.pageNumber || 0
    };
    if (!this.collection) {
      return;
    }
    profileOptions = _.extend(this.options, o);
    if (this.profileListView) {
      this.profileListView.dispose();
    }
    if (this.paginated) {
      ViewConstructor = ViewDecorator.makePaginated(ListViewConstructor);
    } else {
      ViewConstructor = ViewDecorator.makeContinuouslyScrollable(ListViewConstructor);
    }
    return this.profileListView = new ViewConstructor(profileOptions);
  };

  ProfileController.prototype.refreshProfileView = function() {
    var _ref;
    if ((_ref = this.profileListView) != null) {
      _ref.dispose();
    }
    return this.displayProfileView();
  };

  ProfileController.prototype.displayUserHeader = function() {
    var headerM, identityM;
    identityM = mediator.currentProfileM.get('identityM');
    headerM = this.getHeaderModel(identityM);
    headerM = this.setHeaderModelProperties(headerM);
    headerM.set('_showSearch', headerM.get('_showSearch') || false);
    if (this.headerV) {
      this.headerV.model.set(headerM.attributes);
      return this.publishEvent('profile:refresh:header');
    } else {
      return this.headerV = new ProfileHeadV({
        region: 'profilehead',
        model: headerM
      });
    }
  };

  ProfileController.prototype.setHeaderModelProperties = function(headerM) {
    var canEditList, identityM;
    identityM = mediator.currentProfileM.get('identityM');
    headerM.set('_isSelf', identityM.get('_isSelf'));
    headerM.set('userid', identityM.get('userid'));
    canEditList = headerM.get('_isSelf') && headerM.get('_canEdit');
    headerM.set('_currentList', identityM.get('_currentList'));
    headerM.set('_canFollow', !(identityM.get('_isSelf') || utils.isVisitor() || utils.isMobile()));
    headerM.set('_trackingPrefix', utils.isVisitor() ? 'visitor:' : '');
    return headerM;
  };

  ProfileController.prototype.getHeaderModel = function(identityM) {
    var headerM, name;
    if (identityM.get('_isSelf')) {
      name = "Your Profile";
    } else {
      name = identityM.get('username') + '\'s Profile';
    }
    return headerM = new Model({
      _selectorName: name
    });
  };

  ProfileController.prototype.setListView = function() {
    var currentProfileM;
    currentProfileM = mediator.currentProfileM;
    return currentProfileM.set('listv', $.cookie('listv') || 'tile');
  };

  ProfileController.prototype.setNavSelection = function(id) {
    $('.profile-view').find('.selectable').removeClass('active');
    return $('.profile-view [data-selectid=' + id + ']').closest('.selectable').addClass('active');
  };

  ProfileController.prototype.redirectUser = function(res) {
    this.publishEvent('auth:success', res);
    return window.location.reload(true);
  };

  ProfileController.prototype.redirectSignup = function(res) {
    this.publishEvent('auth:success', res);
    return utils.redirectToSignupInterest();
  };

  ProfileController.prototype.dispose = function() {
    ProfileController.__super__.dispose.apply(this, arguments);
    return $('body').removeClass('viewing-profile');
  };

  return ProfileController;

})(AppBaseController);


},{"../../config":2,"../../lib/panel":125,"../../lib/profile":126,"../../lib/stumble":130,"../../lib/utils":156,"../../models/base/model":168,"../../views/decorators/decorator":629,"../../views/profile/list-view":679,"../../views/profile/profile-view":684,"../../views/profile/profilehead-view":686,"../base/app-controller":"GaC0VN","chaplin":773,"jquery":774,"lodash":776}],"controllers/profile/tag-cloud-controller":[function(require,module,exports){
module.exports=require('VUNDlD');
},{}],"VUNDlD":[function(require,module,exports){
var $, Model, ProfileController, TagCloudCollection, TagCloudController, TagCloudView, mediator, profile, user, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

TagCloudCollection = require('../../models/tag-cloud-collection');

profile = require('../../lib/profile');

TagCloudView = require('../../views/profile/tag-cloud-view');

Model = require('../../models/base/model');

user = require('../../lib/user');

utils = require('../../lib/utils');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = TagCloudController = (function(_super) {
  __extends(TagCloudController, _super);

  function TagCloudController() {
    return TagCloudController.__super__.constructor.apply(this, arguments);
  }

  TagCloudController.prototype.displayTagCloud = function() {
    var identityM, options, tagCloudC;
    identityM = mediator.currentProfileM.get('identityM');
    identityM.set('_currentList', 'tag');
    options = {};
    options.data = {
      userid: identityM.get('userid')
    };
    tagCloudC = new TagCloudCollection;
    this.listenToOnce(tagCloudC, 'sync', (function(_this) {
      return function(collection, response, options) {
        return utils.storeTagCloud(collection);
      };
    })(this));
    return tagCloudC.fetch(options).then((function(_this) {
      return function() {
        _this.displayUserHeader();
        return _this.view = new TagCloudView({
          collection: tagCloudC
        });
      };
    })(this));
  };

  TagCloudController.prototype.getHeaderModel = function(identityM) {
    var headerM;
    $('#profile-container').removeClass('list-detail-view');
    if (identityM.get('_isSelf')) {
      $('#profile-container').addClass('owner');
    } else {
      $('#profile-container').removeClass('owner');
    }
    headerM = new Model({
      _selectorName: "Tag",
      hideViewToggle: true
    });
    return headerM;
  };

  return TagCloudController;

})(ProfileController);


},{"../../lib/profile":126,"../../lib/user":155,"../../lib/utils":156,"../../models/base/model":168,"../../models/tag-cloud-collection":244,"../../views/profile/tag-cloud-view":689,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"controllers/profile/videolikes-controller":[function(require,module,exports){
module.exports=require('Qt5eXh');
},{}],"Qt5eXh":[function(require,module,exports){
var $, Model, ProfileController, ProfileListV, VideoLikesC, VideoLikesController, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileController = require('./profile-controller');

VideoLikesC = require('../../models/likes-videos-collection');

ProfileListV = require('../../views/profile/list-view');

Model = require('../../models/base/model');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = VideoLikesController = (function(_super) {
  __extends(VideoLikesController, _super);

  function VideoLikesController() {
    return VideoLikesController.__super__.constructor.apply(this, arguments);
  }

  VideoLikesController.prototype.displayVideoLikes = function(data) {
    var identityM, options, videoLikesC;
    identityM = mediator.currentProfileM.get('identityM');
    identityM.set('_currentList', 'videos');
    this.setNavSelection('videos');
    options = {};
    options.data = {
      userid: identityM.get('userid'),
      limit: mediator.profileItemsPerPage,
      offset: 0
    };
    videoLikesC = new VideoLikesC;
    videoLikesC.fetch(options).then((function(_this) {
      return function() {};
    })(this));
    this.displayUserHeader();
    return this.displayProfileView(videoLikesC);
  };

  VideoLikesController.prototype.getHeaderModel = function(identityM) {
    var headerM;
    $('#profile-container').removeClass('list-detail-view');
    if (identityM.get('_isSelf')) {
      $('#profile-container').addClass('owner');
    } else {
      $('#profile-container').removeClass('owner');
    }
    headerM = new Model({
      _selectorName: "Videos",
      _isDefault: true
    });
    return headerM;
  };

  return VideoLikesController;

})(ProfileController);


},{"../../models/base/model":168,"../../models/likes-videos-collection":198,"../../views/profile/list-view":679,"./profile-controller":"ZRDRht","chaplin":773,"jquery":774}],"controllers/reset-password/base-controller":[function(require,module,exports){
module.exports=require('y/4jgE');
},{}],"y/4jgE":[function(require,module,exports){
var AppController, Chaplin, ResetPasswordBaseView, ResetPasswordController, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppController = require('../base/app-controller');

ResetPasswordBaseView = require('../../views/reset-password/base-view');

utils = require('../../lib/utils');

Chaplin = require('chaplin');

module.exports = ResetPasswordController = (function(_super) {
  __extends(ResetPasswordController, _super);

  function ResetPasswordController() {
    return ResetPasswordController.__super__.constructor.apply(this, arguments);
  }

  ResetPasswordController.prototype.beforeAction = function(params, options, target) {
    return ResetPasswordController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        _this.reuse('toolbar', utils.getToolbarView(), {
          region: 'toolbar'
        });
        _this.publishEvent('disable-toolbar-buttons');
        Chaplin.mediator.stumblesC.setActive(null);
        return _this.reuse('reset-password-base', ResetPasswordBaseView, {
          region: 'content'
        });
      };
    })(this));
  };

  return ResetPasswordController;

})(AppController);


},{"../../lib/utils":156,"../../views/reset-password/base-view":695,"../base/app-controller":"GaC0VN","chaplin":773}],"+uT6o6":[function(require,module,exports){
var ResetPasswordBaseController, ResetPasswordConfirmController, ResetPasswordConfirmModel, ResetPasswordConfirmView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ResetPasswordBaseController = require('./base-controller');

ResetPasswordConfirmView = require('../../views/reset-password/confirm-view');

ResetPasswordConfirmModel = require('../../models/reset-password/confirm-model');

module.exports = ResetPasswordConfirmController = (function(_super) {
  __extends(ResetPasswordConfirmController, _super);

  function ResetPasswordConfirmController() {
    return ResetPasswordConfirmController.__super__.constructor.apply(this, arguments);
  }

  ResetPasswordConfirmController.prototype.index = function(data) {
    var model;
    model = new ResetPasswordConfirmModel;
    if ((data != null ? data.confirmId : void 0) != null) {
      model.set('confirmId', data.confirmId);
      model.set('_isConfirmIdEmpty', false);
    } else {
      model.set('_isConfirmIdEmpty', true);
    }
    return this.view = new ResetPasswordConfirmView({
      model: model
    });
  };

  return ResetPasswordConfirmController;

})(ResetPasswordBaseController);


},{"../../models/reset-password/confirm-model":225,"../../views/reset-password/confirm-view":696,"./base-controller":"y/4jgE"}],"controllers/reset-password/confirm-controller":[function(require,module,exports){
module.exports=require('+uT6o6');
},{}],"cwRVAT":[function(require,module,exports){
var ResetPasswordBaseController, ResetPasswordRequestController, ResetPasswordRequestModel, ResetPasswordRequestView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ResetPasswordBaseController = require('./base-controller');

ResetPasswordRequestView = require('../../views/reset-password/request-view');

ResetPasswordRequestModel = require('../../models/reset-password/request-model');

module.exports = ResetPasswordRequestController = (function(_super) {
  __extends(ResetPasswordRequestController, _super);

  function ResetPasswordRequestController() {
    return ResetPasswordRequestController.__super__.constructor.apply(this, arguments);
  }

  ResetPasswordRequestController.prototype.index = function() {
    return this.view = new ResetPasswordRequestView({
      model: new ResetPasswordRequestModel
    });
  };

  return ResetPasswordRequestController;

})(ResetPasswordBaseController);


},{"../../models/reset-password/request-model":226,"../../views/reset-password/request-view":697,"./base-controller":"y/4jgE"}],"controllers/reset-password/request-controller":[function(require,module,exports){
module.exports=require('cwRVAT');
},{}],"controllers/settings/account-controller":[function(require,module,exports){
module.exports=require('xwdIac');
},{}],"xwdIac":[function(require,module,exports){
var SettingsAccountController, SettingsAccountModel, SettingsAccountView, SettingsBaseController,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SettingsBaseController = require('./base-controller');

SettingsAccountView = require('../../views/settings/account-view');

SettingsAccountModel = require('../../models/settings/account-model');

module.exports = SettingsAccountController = (function(_super) {
  __extends(SettingsAccountController, _super);

  function SettingsAccountController() {
    return SettingsAccountController.__super__.constructor.apply(this, arguments);
  }

  SettingsAccountController.prototype.index = function(data, params, options) {
    var model;
    model = new SettingsAccountModel;
    return model.fetch().then((function(_this) {
      return function() {
        return _this.view = new SettingsAccountView({
          model: model
        });
      };
    })(this));
  };

  return SettingsAccountController;

})(SettingsBaseController);


},{"../../models/settings/account-model":230,"../../views/settings/account-view":701,"./base-controller":"cbCaNc"}],"cbCaNc":[function(require,module,exports){
var $, AppController, Chaplin, SettingsBaseView, SettingsController, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppController = require('../base/app-controller');

SettingsBaseView = require('../../views/settings/base-view');

utils = require('../../lib/utils');

Chaplin = require('chaplin');

$ = require('jquery');

module.exports = SettingsController = (function(_super) {
  __extends(SettingsController, _super);

  function SettingsController() {
    return SettingsController.__super__.constructor.apply(this, arguments);
  }

  SettingsController.prototype.beforeAction = function(params, options, target) {
    return SettingsController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        if (!utils.isLoggedIn()) {
          Chaplin.utils.redirectTo({
            url: "?next=" + document.location.href
          });
          return $.Deferred().reject().promise();
        }
      };
    })(this)).then((function(_this) {
      return function() {
        var settingsBaseView, _ref, _ref1;
        _this.reuse('toolbar', utils.getToolbarView(), {
          region: 'toolbar'
        });
        Chaplin.mediator.stumblesC.setActive(null);
        settingsBaseView = _this.reuse('settings-base', SettingsBaseView, {
          region: 'content'
        });
        return settingsBaseView.setActiveTab(options != null ? (_ref = options.name) != null ? (_ref1 = _ref.split("-")) != null ? _ref1[1] : void 0 : void 0 : void 0);
      };
    })(this));
  };

  return SettingsController;

})(AppController);


},{"../../lib/utils":156,"../../views/settings/base-view":702,"../base/app-controller":"GaC0VN","chaplin":773,"jquery":774}],"controllers/settings/base-controller":[function(require,module,exports){
module.exports=require('cbCaNc');
},{}],"H6uCQL":[function(require,module,exports){
var $, GoogleConnectModel, SettingsBaseController, SettingsConnectionsController, SettingsConnectionsModel, SettingsConnectionsView, TwitterConnectModel, utils,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SettingsBaseController = require('./base-controller');

SettingsConnectionsView = require('../../views/settings/connections-view');

SettingsConnectionsModel = require('../../models/settings/connections-model');

utils = require('../../lib/utils');

TwitterConnectModel = require('../../models/twitter-connect-model');

GoogleConnectModel = require('../../models/google-connect-model');

$ = require('jquery');

module.exports = SettingsConnectionsController = (function(_super) {
  __extends(SettingsConnectionsController, _super);

  function SettingsConnectionsController() {
    this.onGoogleInitialize = __bind(this.onGoogleInitialize, this);
    return SettingsConnectionsController.__super__.constructor.apply(this, arguments);
  }

  SettingsConnectionsController.prototype.index = function(data, params, options) {
    var model, _ref;
    utils.facebookInitialize();
    if (((options != null ? (_ref = options.query) != null ? _ref.oauth_token : void 0 : void 0) != null) && (options.query.oauth_verifier != null)) {
      this.twitterCallback(options.query.oauth_token, options.query.oauth_verifier);
    }
    model = new SettingsConnectionsModel;
    return model.fetch().then((function(_this) {
      return function() {
        _this.view = new SettingsConnectionsView({
          model: model
        });
        return utils.googleInitialize(_this.onGoogleInitialize);
      };
    })(this));
  };

  SettingsConnectionsController.prototype.onGoogleInitialize = function() {
    return this.view.googleConnectM = new GoogleConnectModel({
      link: true
    });
  };

  SettingsConnectionsController.prototype.twitterCallback = function(oauth_token, oauth_verifier) {
    var data, oauth_token_secret, twitterModel;
    oauth_token_secret = $.cookie('oauth_token_secret');
    $.removeCookie('oauth_token_secret');
    data = {
      oauth_token: oauth_token,
      oauth_verifier: oauth_verifier,
      oauth_token_secret: oauth_token_secret
    };
    twitterModel = new TwitterConnectModel;
    return twitterModel.connectionRequestCallback(data);
  };

  return SettingsConnectionsController;

})(SettingsBaseController);


},{"../../lib/utils":156,"../../models/google-connect-model":184,"../../models/settings/connections-model":232,"../../models/twitter-connect-model":249,"../../views/settings/connections-view":704,"./base-controller":"cbCaNc","jquery":774}],"controllers/settings/connections-controller":[function(require,module,exports){
module.exports=require('H6uCQL');
},{}],"controllers/settings/notifications-controller":[function(require,module,exports){
module.exports=require('7hLvyS');
},{}],"7hLvyS":[function(require,module,exports){
var SettingsBaseController, SettingsNotificationsController, SettingsNotificationsModel, SettingsNotificationsView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SettingsBaseController = require('./base-controller');

SettingsNotificationsView = require('../../views/settings/notifications-view');

SettingsNotificationsModel = require('../../models/settings/notifications-model');

module.exports = SettingsNotificationsController = (function(_super) {
  __extends(SettingsNotificationsController, _super);

  function SettingsNotificationsController() {
    return SettingsNotificationsController.__super__.constructor.apply(this, arguments);
  }

  SettingsNotificationsController.prototype.index = function(data, params, options) {
    var model;
    model = new SettingsNotificationsModel;
    return model.fetch().then((function(_this) {
      return function() {
        return _this.view = new SettingsNotificationsView({
          model: model
        });
      };
    })(this));
  };

  return SettingsNotificationsController;

})(SettingsBaseController);


},{"../../models/settings/notifications-model":233,"../../views/settings/notifications-view":711,"./base-controller":"cbCaNc"}],"d7M8RW":[function(require,module,exports){
var SettingsBaseController, SettingsPersonalizationController, SettingsPersonalizationModel, SettingsPersonalizationView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SettingsBaseController = require('./base-controller');

SettingsPersonalizationView = require('../../views/settings/personalization-view');

SettingsPersonalizationModel = require('../../models/settings/personalization-model');

module.exports = SettingsPersonalizationController = (function(_super) {
  __extends(SettingsPersonalizationController, _super);

  function SettingsPersonalizationController() {
    return SettingsPersonalizationController.__super__.constructor.apply(this, arguments);
  }

  SettingsPersonalizationController.prototype.index = function(data, params, options) {
    var model;
    model = new SettingsPersonalizationModel;
    return model.fetch().then((function(_this) {
      return function() {
        return _this.view = new SettingsPersonalizationView({
          model: model
        });
      };
    })(this));
  };

  return SettingsPersonalizationController;

})(SettingsBaseController);


},{"../../models/settings/personalization-model":234,"../../views/settings/personalization-view":712,"./base-controller":"cbCaNc"}],"controllers/settings/personalization-controller":[function(require,module,exports){
module.exports=require('d7M8RW');
},{}],"controllers/settings/profile-controller":[function(require,module,exports){
module.exports=require('9+Xvh+');
},{}],"9+Xvh+":[function(require,module,exports){
var SettingsBaseController, SettingsProfileController, SettingsProfileModel, SettingsProfileView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SettingsBaseController = require('./base-controller');

SettingsProfileView = require('../../views/settings/profile-view');

SettingsProfileModel = require('../../models/settings/profile-model');

module.exports = SettingsProfileController = (function(_super) {
  __extends(SettingsProfileController, _super);

  function SettingsProfileController() {
    return SettingsProfileController.__super__.constructor.apply(this, arguments);
  }

  SettingsProfileController.prototype.index = function(data, params, options) {
    var model;
    model = new SettingsProfileModel;
    return model.fetch().done((function(_this) {
      return function() {
        return _this.view = new SettingsProfileView({
          model: model
        });
      };
    })(this));
  };

  return SettingsProfileController;

})(SettingsBaseController);


},{"../../models/settings/profile-model":235,"../../views/settings/profile-view":713,"./base-controller":"cbCaNc"}],"controllers/submit-controller":[function(require,module,exports){
module.exports=require('PGIivx');
},{}],"PGIivx":[function(require,module,exports){
var $, BadgeV, Controller, InterestsC, LikeConfirmationV, Model, SU, StumbleM, SubmitController, SubmitM, SubmitV, SuggestedInterestsC, TagsC, UrlM, analytics, request, storage, stumble, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SubmitV = require('../views/submit/submit-view');

BadgeV = require('../views/submit/badge-view');

utils = require('../lib/utils');

InterestsC = require('../models/interests-collection');

SuggestedInterestsC = require('../models/suggested-interests-collection');

TagsC = require('../models/submit-tags-collection');

Model = require('../models/base/model');

Controller = require('./base/controller');

storage = require('simple-storage');

SU = require('../lib/su');

request = require('../lib/request');

UrlM = require('../models/url-model');

StumbleM = require('../models/stumble-model');

$ = require('jquery');

LikeConfirmationV = require('../views/submit/like-confirmation-view');

SubmitM = require('../models/badge-submit-model');

analytics = require('../lib/analytics');

_ = require('lodash');

stumble = require('../lib/stumble');


/*
  Controller class for submitting urls for indexing.

  When submitting to the submit endpoint, if an url is provided in the params, look up the url in
  the url service, then based on the results, forward the request to the badge endpoint if the url
  is new, otherwise submit to likes and confirm.

  url provided? --- N ---> forward to submit action
      |                      - show form
      |                      - post to submit
      Y                      - route to like
      |
  url exists? ----- N ---> forward to badge action
      |                      - show form
      |                      - post to submit
      Y                      - route to like
      |
  forward to like action
    - post to rating
    - show confirmation
 */

module.exports = SubmitController = (function(_super) {
  __extends(SubmitController, _super);

  function SubmitController() {
    this._getInterestsCollectionPromise = __bind(this._getInterestsCollectionPromise, this);
    return SubmitController.__super__.constructor.apply(this, arguments);
  }

  SubmitController.prototype.beforeAction = function(params, route, options) {
    return SubmitController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        window.addEventListener('message', _this.onSubmitFormMessage, false);
        return stumble.getCollection().setActive(null);
      };
    })(this));
  };

  SubmitController.prototype.visitorIsAllowed = function() {
    return false;
  };

  SubmitController.prototype._redirectHome = function(params, route, options) {
    return utils.redirectToHome(params, options);
  };

  SubmitController.prototype.showSubmit = function(params, route, options) {
    var url, urlModel, _ref;
    if (utils.isVisitor() || utils.isMobile()) {
      return this._redirectHome(params, route, options);
    }
    url = options != null ? (_ref = options.query) != null ? _ref.url : void 0 : void 0;
    if (url) {

      /* The only way to distinguish an incoming badge request is that the url is provided.  Forward these to the showBadge action */
      return this._getUrlPromise(url).then(function(urlResult) {
        options.urlModel = new UrlM(urlResult.url);
        options.replace = true;
        if (urlResult._success) {
          return Chaplin.utils.redirectTo('submit#submitToLikes', params, options);
        } else {
          return Chaplin.utils.redirectTo('submit#showBadge', params, options);
        }
      });
    } else {
      urlModel = new UrlM();
      urlModel.setUrl("");
      urlModel.setLocked(false);
      return this._getSubmitModelPromise(urlModel).then((function(_this) {
        return function(submitModel) {
          _this.view = new SubmitV({
            model: submitModel
          });
          return analytics.trackEvent('submit-view', 1, {
            action: 'view',
            label: 'submit#showSubmit'
          });
        };
      })(this));
    }
  };

  SubmitController.prototype.showBadge = function(params, route, options) {
    var urlModel, _ref;
    if (utils.isVisitor() || utils.isMobile()) {
      return this._redirectHome(params, route, options);
    } else {
      urlModel = options != null ? options.urlModel : void 0;
      if (!urlModel || !((_ref = options.query) != null ? _ref.url : void 0)) {
        options.replace = true;
        return Chaplin.utils.redirectTo('submit#showSubmit', params, options);
      }
      if (urlModel.getUrlId()) {
        options.replace = true;
        return Chaplin.utils.redirectTo('submit#submitToLikes', params, options);
      }
      urlModel.setUrl(options.query.url);
      urlModel.setLocked(true);
      return this._getSubmitModelPromise(urlModel).then((function(_this) {
        return function(submitModel) {
          _this.view = new BadgeV({
            model: submitModel
          });
          return analytics.trackEvent('submit-badge-view', 1, {
            action: 'view',
            label: 'submit#showBadge'
          });
        };
      })(this));
    }
  };


  /**
    submit a new url or like an existing url
   */

  SubmitController.prototype.submitToLikes = function(params, route, options) {
    var stumbleM, urlModel;
    if (utils.isVisitor() || utils.isMobile()) {
      return this._redirectHome(params, route, options);
    }
    urlModel = options != null ? options.urlModel : void 0;
    if (!urlModel) {
      options.replace = true;
      return Chaplin.utils.redirectTo('submit#showSubmit', params, options);
    }
    urlModel.set({
      'title': 'StumbleUpon is closing down on June 30th, so join Mix today!',
      'description': 'Mix is a new way to curate and discover the best of the web.  Get started below.  You can bring over your Likes, Lists, and Tags from StumbleUpon.'
    });
    if (urlModel.getRating() !== 1) {
      stumbleM = new StumbleM({
        urlid: urlModel.getUrlId()
      });
      return stumbleM.save({
        rating: '1'
      }, {
        success: function(model, response, options) {
          if (response._success) {
            this.view = new LikeConfirmationV({
              model: urlModel
            });
            return analytics.trackEvent('submit-like-view', 1, {
              action: 'view',
              label: 'submit#submitToLikes'
            });
          }
        }
      });
    } else {
      this.view = new LikeConfirmationV({
        model: urlModel
      });
      return analytics.trackEvent('submit-like-view', 1, {
        action: 'view',
        label: 'submit#submitToLikes'
      });
    }
  };

  SubmitController.prototype._getInterestsCollectionPromise = function() {
    return utils.getCachedCollection('all-interests', utils.DAY_IN_MILLISECONDS, InterestsC, {}, true);
  };

  SubmitController.prototype._getUrlPromise = function(url) {
    return request(SU.Url.getInfo, [
      'read', new UrlM(), {
        data: {
          url: url,
          reportIndexMissAsSuccess: true
        }
      }
    ]);
  };

  SubmitController.prototype._getSubmitUrlPromise = function(url, nsfw) {
    var data;
    data = {
      url: url,
      nsfw: nsfw
    };
    return request(SU.Url.submit, [
      'create', new UrlM(), {
        data: data
      }
    ]);
  };

  SubmitController.prototype._getSubmitModelPromise = function(urlModel) {
    var allInterestsC, suggestedInterestsC, tagsC;
    if (urlModel == null) {
      urlModel = new UrlM();
    }
    allInterestsC = this._getInterestsCollectionPromise();
    tagsC = new TagsC();
    if (urlModel.getUrl()) {
      suggestedInterestsC = new SuggestedInterestsC(null, {
        url: urlModel.getUrl()
      });
      suggestedInterestsC.fetch({
        remove: false
      });
    } else {
      suggestedInterestsC = new SuggestedInterestsC(null, null);
    }
    return $.when(urlModel, allInterestsC, suggestedInterestsC, tagsC.fetch({
      data: {
        userid: utils.getLoggedInUserId()
      }
    }).then((function(_this) {
      return function() {
        return tagsC;
      };
    })(this))).then(function(urlM, allInterestsC, suggestedInterestsC, tagsC) {
      return new SubmitM(null, {
        urlM: urlM,
        allInterestsC: allInterestsC,
        flattenedInterestsC: allInterestsC.getLeafInterests(),
        suggestedInterestsC: suggestedInterestsC || allInterestsC,
        tagsC: tagsC,
        tagsToSubmitC: new TagsC()
      });
    });
  };

  SubmitController.prototype.onSubmitFormMessage = function(e) {
    var data, urlM;
    if (e.source.location.hostname === window.location.hostname && e.source.location.protocol === window.location.protocol && e.source.location.pathname === '/submit' && e.data.match(/submitform:saved/)) {
      data = JSON.parse(e.data);
      urlM = new UrlM(data.urlM);
      return Chaplin.utils.redirectTo('submit#submitToLikes', {}, {
        urlModel: urlM
      });
    }
  };

  SubmitController.prototype.dispose = function() {
    return window.removeEventListener('message', this.onSubmitFormMessage, false);
  };

  return SubmitController;

})(Controller);


},{"../lib/analytics":116,"../lib/request":128,"../lib/stumble":130,"../lib/su":153,"../lib/utils":156,"../models/badge-submit-model":166,"../models/base/model":168,"../models/interests-collection":188,"../models/stumble-model":239,"../models/submit-tags-collection":242,"../models/suggested-interests-collection":243,"../models/url-model":252,"../views/submit/badge-view":721,"../views/submit/like-confirmation-view":723,"../views/submit/submit-view":724,"./base/controller":"UQqhgU","jquery":774,"lodash":776,"simple-storage":780}],"sKvE54":[function(require,module,exports){
var $, AdxManager, AppBaseController, Chaplin, ConversationModel, ToolbarController, analytics, mediator, panel, root, storage, stumble, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

Chaplin = require('chaplin');

AppBaseController = require('./base/app-controller');

mediator = require('chaplin').mediator;

utils = require('../lib/utils');

root = require('../lib/root');

stumble = require('../lib/stumble');

analytics = require('../lib/analytics');

$ = require('jquery');

panel = require('../lib/panel');

storage = require('simple-storage');

ConversationModel = require('../models/conversation-model');

AdxManager = require('../lib/adx-manager');

module.exports = ToolbarController = (function(_super) {
  __extends(ToolbarController, _super);

  function ToolbarController() {
    this.redirectUser = __bind(this.redirectUser, this);
    return ToolbarController.__super__.constructor.apply(this, arguments);
  }

  ToolbarController.prototype.initialize = function() {
    ToolbarController.__super__.initialize.apply(this, arguments);
    this.subscribeEvent('api:userhasnotopics', this.onUserHasNoTopics);
    this.subscribeEvent('toolbar:disabled', utils.gotoUrl);
    this.subscribeEvent('fb:model:login:success', this.redirectUser);
    this.subscribeEvent('fb:model:signup:success', this.redirectSignup);
    this.subscribeEvent('dd:pageloaded', function(ddwindow) {
      var found, topPath;
      topPath = top.location.pathname;
      found = topPath.search(/\/panel\/[a-z]*$/);
      if (found !== -1) {
        topPath = topPath.substr(0, found);
      }
      if (ddwindow.location.pathname.indexOf('su/overlay') === -1 && ddwindow.location.pathname !== topPath) {
        return Chaplin.utils.redirectTo({
          url: ddwindow.location.pathname
        }, {
          path: ddwindow.location.pathname
        });
      }
    });
    return this.View = utils.getToolbarView();
  };

  ToolbarController.prototype.redirectSignup = function(res) {
    this.publishEvent('auth:success', res);
    return utils.redirectToSignupInterest();
  };

  ToolbarController.prototype.redirectUser = function(res) {
    this.publishEvent('auth:success', res);
    return this.refresh();
  };

  ToolbarController.prototype.legacyHandler = function(data, params) {
    var d;
    panel.close();
    d = _.extend(data, {
      urlid: data.route
    });
    stumble.getCollection().addLegacy(data.route, utils.removeForceSpa(params.query));
    return this.stumble(d, params);
  };

  ToolbarController.prototype.directToDD = function() {
    return utils.gotoNoToolbarUrl();
  };

  ToolbarController.prototype.redirectToFeedback = function() {
    return window.location.href = 'http://help.stumbleupon.com/customer/portal/emails/new';
  };

  ToolbarController.prototype.redirectToRC = function() {
    return Chaplin.utils.redirectTo('mix#rc');
  };

  ToolbarController.prototype.stumbleNext = function() {
    var isVisitor, params, redirectRoute;
    if (utils.isMobile()) {
      return this.redirectToRC();
    }
    mediator.overrideBrowserAddonEnabled = false;
    isVisitor = utils.isVisitor();
    if (!isVisitor) {
      redirectRoute = AdxManager.getAdx();
      if (redirectRoute) {
        analytics.trackEvent('stumble:adx-trigger', 1, {
          action: 'redirect',
          label: redirectRoute.path
        });
        if (redirectRoute.urlid) {
          Chaplin.mediator.stumblesC.reportSeenUrl(redirectRoute.urlid);
        }
        return Chaplin.utils.redirectTo(redirectRoute.path);
      }
    }
    if (!isVisitor || (mediator.visitorStumbleCount < mediator.visitorStumbleCountMax)) {
      if (isVisitor) {
        mediator.visitorStumbleCount++;
      }
      return stumble.stumbleNext();
    } else {
      params = {};
      if (isVisitor) {
        params._track_postfix = ":visitor";
      }
      params.next = encodeURIComponent(window.location.href);
      return Chaplin.utils.redirectTo('homepage#home', params);
    }
  };

  ToolbarController.prototype.displayStumbleModel = function(model, options) {
    if (options == null) {
      options = {};
    }
    if (options.conversationM) {
      model.set('_conversationM', options.conversationM);
    }
    model.setActive();
    this.view = new this.View({
      model: model
    });
    this.adjustTitle(model != null ? model.get('_title') : void 0);
    this.adjustMetas(model);
    this.reportDDseenMethod();
    this.reportEmailClick(model != null ? model.get('_route') : void 0);
    this.setTimeout((function(_this) {
      return function() {
        return _this.replaceUrlPath(model);
      };
    })(this), 0);
    if (options.panelToOpen) {
      panel.open(options.panelToOpen, options);
    }
    analytics.trackComscore();
    return this.trackStumblePageLoad();
  };

  ToolbarController.prototype.replaceUrlPath = function(model) {
    var arr, route;
    if (!utils.isVisitor()) {
      route = model.get('_route') || '';
      if (route.charAt(route.length - 1) === '/') {
        arr = route.split('');
        arr.pop();
        route = arr.join('');
      }
      if (window.location.href.indexOf(route) === -1) {
        return utils.replaceState(route);
      }
    }
  };

  ToolbarController.prototype.onStumbleError = function(data, xhr, options) {
    var location, _ref;
    if ((xhr != null ? (_ref = xhr.responseJSON) != null ? _ref._code : void 0 : void 0) === 2000) {
      return location = '/home';
    } else {
      return Chaplin.utils.redirectTo('errors/not-found#notFound');
    }
  };

  ToolbarController.prototype.stumble = function(data, params, options) {
    var isDirectPageLoad, panelReq, tracking_code, urlid;
    if (options == null) {
      options = {};
    }
    if (utils.isMobile()) {
      return this.redirectToRC();
    }
    urlid = data.urlid;
    tracking_code = data.tracking_code;
    panelReq = (data != null ? data.panel : void 0) || false;
    if (urlid === 'redir') {
      urlid = window.location.href.split('pid=').pop().split('&').shift().split('%').shift();
    }
    isDirectPageLoad = stumble.isFreshSession();
    return stumble.getCollection().getById(urlid, tracking_code).then((function(_this) {
      return function(model) {
        var isBrowserAddOnEnabled;
        if (panelReq) {
          _.extend(options, {
            panelToOpen: panelReq
          });
        }
        isBrowserAddOnEnabled = utils.isSUBrowserAddonEnabled() && (!mediator.overrideBrowserAddonEnabled);
        if (isBrowserAddOnEnabled || (model.get("framebreak") < 0 && model.getTemplate().startsWith('site') && model.getTemplate() !== 'site-sandbox' && isDirectPageLoad)) {
          if (!isBrowserAddOnEnabled) {
            analytics.trackEvent('stumble:framebreak');
          }
          return document.location = model.get("url");
        } else {
          return _this.displayStumbleModel(model, options);
        }
      };
    })(this), (function(_this) {
      return function(model, xhr, options) {
        _this.onStumbleError(model, xhr, options);
        if (utils.isVisitor() && model === "Cannot make a stumble with this url") {
          return Chaplin.utils.redirectTo({
            url: 'impossible'
          });
        }
      };
    })(this));
  };

  ToolbarController.prototype.shareLegacy = function(data) {
    return stumble.getCollection().getLegacyShareId(data.shareid).then((function(_this) {
      return function(model) {
        return _this.displayStumbleModel(model);
      };
    })(this), (function(_this) {
      return function(model, xhr, options) {
        return _this.onStumbleError(model, xhr, options);
      };
    })(this));
  };

  ToolbarController.prototype.showActivityCenter = function() {
    if (!stumble.getCollection().getActive()) {
      this.stumbleNext();
    }
    mediator.overrideBrowserAddonEnabled = true;
    return panel.open('activity-center', {
      position: 'right'
    });
  };

  ToolbarController.prototype.stumbleToConversation = function(data) {
    mediator.overrideBrowserAddonEnabled = true;
    $.cookie('deeplink_try', true);
    if (data.conversationId) {
      this.listenToOnce(mediator.participantM, 'sync', (function(_this) {
        return function() {
          var conversationM;
          conversationM = new ConversationModel(data);
          _this.listenToOnce(conversationM, 'sync', function(conversationM) {
            var participantsC;
            participantsC = conversationM.get('participantsC');
            if (utils.isVisitor()) {
              stumble.getCollection().createConversationModel(conversationM.get('topic'));
              utils.setAsConversationVisitor(true);
            }
            if (!participantsC.findWhere({
              'id': utils.getParticipantId()
            })) {
              console.error("Your account does not have permission to view this conversation");
              if (stumble.getCollection().getActive()) {
                panel.open('alert', {
                  type: 'error',
                  text: "You need to be invited to view this conversation"
                });
              }
              _this.stumble({
                urlid: conversationM.get('topic').id
              });
              return conversationM.dispose();
            } else {
              _this.stumble({
                urlid: conversationM.get('topic').id
              }, null, {
                conversationM: conversationM
              });
              if (!utils.isMobile()) {
                return panel.open('conversation', {
                  conversationM: conversationM,
                  position: 'right'
                });
              }
            }
          });
          _this.listenToOnce(conversationM, 'error', function() {
            if (stumble.getCollection().getActive()) {
              utils.logDebug("Unable to load '" + data.conversationId + "'");
              panel.open('alert', {
                type: 'error'
              });
              return _this.replaceUrlPath(stumble.getCollection().getActive());
            } else {
              utils.logDebug("Unable to load '" + data.conversationId + "'  Stumbling...");
              return _this.stumbleNext();
            }
          });
          return conversationM.fetch();
        };
      })(this));
      this.listenToOnce(mediator.participantM, 'error', (function(_this) {
        return function() {
          return _this.stumbleNext().then(function() {
            return panel.open('alert', {
              type: 'error'
            });
          });
        };
      })(this));
      return mediator.participantM.fetch();
    } else {
      utils.logDebug("Missing conversation id. Stumbling...");
      return this.stumbleNext();
    }
  };

  ToolbarController.prototype.stumbleThru = function(data) {
    var domainMode;
    domainMode = mediator.modesC.setDomainMode(data.domain);
    if (domainMode != null ? domainMode.urlid : void 0) {
      return this.stumble(domainMode);
    } else {
      return this.stumbleNext();
    }
  };

  ToolbarController.prototype.stumbleTopic = function(opts) {
    mediator.modesC.setActive(opts.topic);
    this.stumbleNext();
    return this.reportShareClick(data.urlid);
  };

  ToolbarController.prototype.onUserHasNoTopics = function() {
    return Chaplin.utils.redirectTo('interests#createMyInterests');
  };

  ToolbarController.prototype.reportDDseenMethod = function() {
    var href, reportUrl;
    href = root().location.href;
    if (href.match('from=')) {
      reportUrl = decodeURIComponent(href.split('from=').pop());
      if (!reportUrl.match('http')) {
        return $.get(reportUrl);
      }
    }
  };

  ToolbarController.prototype.reportShareClick = _.memoize(function(shareid) {
    return $.get("/su/share/" + shareid + "?_notoolbar=true");
  });

  ToolbarController.prototype.reportEmailClick = _.once(function(base) {
    return $.get("/" + base + "?_notoolbar=true");
  });

  ToolbarController.prototype.createNewList = function() {
    return this.stumbleNext().then((function(_this) {
      return function() {
        panel.open('list');
        return mediator.publish('list:displaycreate');
      };
    })(this));
  };

  ToolbarController.prototype.trackStumblePageLoad = function() {
    var SU, options, request, user;
    SU = require('../lib/su');
    request = require('../lib/request');
    options = {
      data: {},
      noretry: true
    };
    user = new SU.User;
    request(user.reportStumblePageLoad, [null, null, options]);
  };

  ToolbarController.prototype.getProtocol = function() {
    return this.PROTOCOL_DEFAULT;
  };

  return ToolbarController;

})(AppBaseController);


},{"../lib/adx-manager":115,"../lib/analytics":116,"../lib/panel":125,"../lib/request":128,"../lib/root":129,"../lib/stumble":130,"../lib/su":153,"../lib/utils":156,"../models/conversation-model":172,"./base/app-controller":"GaC0VN","chaplin":773,"jquery":774,"lodash":776,"simple-storage":780}],"controllers/toolbar-controller":[function(require,module,exports){
module.exports=require('sKvE54');
},{}],"controllers/update-controller":[function(require,module,exports){
module.exports=require('e6juNz');
},{}],"e6juNz":[function(require,module,exports){
var $, Chaplin, Controller, UpdateController, root, storage, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

$ = require('jquery');

Chaplin = require('chaplin');

Controller = require('./base/controller');

root = require('../lib/root');

storage = require('simple-storage');

utils = require('../lib/utils');

module.exports = UpdateController = (function(_super) {
  __extends(UpdateController, _super);

  function UpdateController() {
    return UpdateController.__super__.constructor.apply(this, arguments);
  }

  UpdateController.prototype.announceEvents = 'update';

  UpdateController.prototype.checkInterval = '2m';

  UpdateController.prototype.maxWait = '20m';

  UpdateController.prototype.initialize = function() {
    UpdateController.__super__.initialize.apply(this, arguments);
    if (!utils.isLocalDev()) {
      this.on('outofdate', (function(_this) {
        return function() {
          storage.remove('version');
          return _this.scheduleRefresh();
        };
      })(this));
      return this.getCurrentVersion().then((function(_this) {
        return function() {
          return _this.monitor();
        };
      })(this));
    }
  };

  UpdateController.prototype.refresh = function() {
    return root().location.reload(true);
  };

  UpdateController.prototype.scheduleRefresh = function() {
    Chaplin.mediator.update = true;
    return this.setTimeout((function(_this) {
      return function() {
        return _this.refresh();
      };
    })(this), this.maxWait);
  };

  UpdateController.prototype.monitor = function() {
    return this.setInterval((function(_this) {
      return function() {
        return _this.check();
      };
    })(this), this.checkInterval);
  };

  UpdateController.prototype.check = function() {
    return $.when(this.getCurrentVersion(), this.getLatest()).then((function(_this) {
      return function(current, latest) {
        var updatemsg;
        updatemsg = current === latest ? 'noupdates' : 'outofdate';
        return _this.trigger("" + updatemsg, current, latest);
      };
    })(this));
  };

  UpdateController.prototype.getCurrentVersion = function() {
    var dfd;
    if (storage.get('version')) {
      dfd = new $.Deferred;
      dfd.promise();
      return dfd.resolve(storage.get('version'));
    } else {
      return this.getLatest().then(function(latest) {
        storage.set('version', latest);
        return latest;
      });
    }
  };

  UpdateController.prototype.getLatest = function() {
    var uid;
    uid = '/su/updatecheck.' + _.now() + _.random(1, 10000) + '.html';
    return $.get(uid).then(function(latest) {
      return latest;
    }, (function(_this) {
      return function() {
        return _this.trigger('checkfailed', arguments);
      };
    })(this));
  };

  return UpdateController;

})(Controller);


},{"../lib/root":129,"../lib/utils":156,"./base/controller":"UQqhgU","chaplin":773,"jquery":774,"lodash":776,"simple-storage":780}],"pud4fq":[function(require,module,exports){
var AppController, InterestsCollection, MyInterestsM, UrlCollectionController, UrlsForInterestC, UrlsView, UserInterestsCollection, ViewDecorator, mediator, profile, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppController = require('./base/app-controller');

InterestsCollection = require('../models/interests-collection');

UserInterestsCollection = require('../models/user-interests-collection');

MyInterestsM = require('../models/user-interests-model');

utils = require('../lib/utils');

UrlsForInterestC = require('../models/urls-for-interest-collection');

ViewDecorator = require('../views/decorators/decorator');

UrlsView = require('../views/urls-view');

profile = require('../lib/profile');

mediator = require('chaplin').mediator;

module.exports = UrlCollectionController = (function(_super) {
  __extends(UrlCollectionController, _super);

  function UrlCollectionController() {
    return UrlCollectionController.__super__.constructor.apply(this, arguments);
  }

  UrlCollectionController.prototype.beforeAction = function(params, route, options) {
    return UrlCollectionController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        return _this.reuse('toolbar', utils.getToolbarView(), {
          region: 'toolbar'
        });
      };
    })(this)).then(function() {
      return utils.getCachedCollection('all-interests', utils.DAY_IN_MILLISECONDS, InterestsCollection, {}, true);
    }).then((function(_this) {
      return function(categorizedInterests) {
        return _this.allInterestsC = categorizedInterests;
      };
    })(this)).then((function(_this) {
      return function() {
        _this.myInterestsC = new UserInterestsCollection;
        return _this.myInterestsC.fetch({
          userId: mediator.userM.get('userid')
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return _this.myInterestsM = new MyInterestsM({
          myInterestsC: _this.myInterestsC,
          allInterestsC: _this.allInterestsC
        });
      };
    })(this)).then((function(_this) {
      return function() {
        return profile.setIdentityModel(params);
      };
    })(this));
  };

  UrlCollectionController.prototype.listUrls = function(params, route, options) {
    var collection, interestM;
    interestM = utils.interestModelFromParams(params, this.allInterestsC);
    if (!interestM) {
      Chaplin.utils.redirectTo('errors/not-found#notFound');
    }
    options = {};
    options.data = {
      interestid: interestM.get('id'),
      limit: Chaplin.mediator.profileItemsPerPage,
      offset: 0
    };
    collection = new UrlsForInterestC;
    return collection.fetch(options).then((function(_this) {
      return function() {
        var ViewConstructor;
        ViewConstructor = ViewDecorator.makeContinuouslyScrollable(UrlsView);
        ViewConstructor.prototype.getRequestMixin = function() {
          return {
            interestid: this.interestId
          };
        };
        return _this.view = new ViewConstructor({
          autoRender: true,
          region: 'content',
          collection: collection,
          model: interestM,
          myInterestsModel: _this.myInterestsM
        });
      };
    })(this));
  };

  return UrlCollectionController;

})(AppController);


},{"../lib/profile":126,"../lib/utils":156,"../models/interests-collection":188,"../models/urls-for-interest-collection":255,"../models/user-interests-collection":256,"../models/user-interests-model":257,"../views/decorators/decorator":629,"../views/urls-view":737,"./base/app-controller":"GaC0VN","chaplin":773}],"controllers/url-collection-controller":[function(require,module,exports){
module.exports=require('pud4fq');
},{}],"j+kYkd":[function(require,module,exports){
var AppBaseController, UrlInfoController, UrlInfoView, panel, stumble, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

AppBaseController = require('./base/app-controller');

stumble = require('../lib/stumble');

UrlInfoView = require('../views/url-info-view');

utils = require('../lib/utils');

panel = require('../lib/panel');

module.exports = UrlInfoController = (function(_super) {
  __extends(UrlInfoController, _super);

  function UrlInfoController() {
    return UrlInfoController.__super__.constructor.apply(this, arguments);
  }

  UrlInfoController.prototype.initialize = function() {
    UrlInfoController.__super__.initialize.apply(this, arguments);
    return this.subscribeEvent('likers:currentPageNumber', this.onPageNumberChange);
  };

  UrlInfoController.prototype.beforeAction = function() {
    panel.close();
    return UrlInfoController.__super__.beforeAction.apply(this, arguments).then((function(_this) {
      return function() {
        _this.reuse('toolbar', utils.getToolbarView(), {
          region: 'toolbar'
        });
        return _this.publishEvent('disable-toolbar-buttons');
      };
    })(this));
  };

  UrlInfoController.prototype.onPageNumberChange = function(newPage) {
    return this.pageNumber = newPage;
  };

  UrlInfoController.prototype.displayUrlInfo = function(data) {
    return stumble.getCollection().getById(data != null ? data.urlid : void 0).then((function(_this) {
      return function(model) {
        _this.adjustMetas(model);
        return _this.view = new UrlInfoView({
          name: 'UrlInfo',
          model: model
        });
      };
    })(this));
  };

  UrlInfoController.prototype.displayUrlInfoUrl = function(data) {
    var url;
    url = decodeURIComponent(decodeURIComponent(data != null ? data.anything : void 0));
    return stumble.getCollection().getByUrl(url).then((function(_this) {
      return function(model) {
        return _this.view = new UrlInfoView({
          name: 'UrlInfo',
          model: model
        });
      };
    })(this), function() {
      return Chaplin.utils.redirectTo({
        url: "/404"
      });
    });
  };

  return UrlInfoController;

})(AppBaseController);


},{"../lib/panel":125,"../lib/stumble":130,"../lib/utils":156,"../views/url-info-view":735,"./base/app-controller":"GaC0VN"}],"controllers/url-info-controller":[function(require,module,exports){
module.exports=require('j+kYkd');
},{}],113:[function(require,module,exports){
var $, Application, routes, _;

_ = require('lodash');

$ = require('jquery');

Application = require('./application');

routes = require('./routes');

$(function() {
  return new Application({
    controllerSuffix: '-controller',
    title: 'StumbleUpon',
    titleTemplate: _.template('<%= subtitle %> - <%= title %>'),
    scrollTo: false,
    routes: routes
  });
});


},{"./application":1,"./routes":263,"jquery":774,"lodash":776}],114:[function(require,module,exports){
var $, storage;

storage = require('simple-storage');

$ = require('jquery');

module.exports = {
  STUMBLE_BUCKETS: [1, 2, 3, 4, 5, 10, 15, 20, 30, 40, 50, 75, 100, 150, 200, 300],
  track: function(action) {
    var experimentId, sCountObj, stumbleCount;
    experimentId = typeof optimizely !== "undefined" && optimizely !== null ? optimizely.activeExperiments[0] : void 0;
    if (action === 'stumble') {
      sCountObj = storage.get('sCount') || {};
      stumbleCount = sCountObj[experimentId] + 1 || 1;
      sCountObj[experimentId] = stumbleCount;
      storage.set('sCount', sCountObj);
      if (this.STUMBLE_BUCKETS.indexOf(stumbleCount) !== -1) {
        return window['optimizely'].push(["trackEvent", "stumble-" + stumbleCount]);
      }
    } else {
      return window['optimizely'].push(["trackEvent", action]);
    }
  },
  trackAppInit: function(hours) {
    var date;
    if ((typeof optimizely !== "undefined" && optimizely !== null ? optimizely.activeExperiments.length : void 0) > 0) {
      if (!$.cookie('nextinit')) {
        date = new Date();
        hours = hours || 24;
        date.setTime(date.setHours(date.getHours() + hours));
        return $.cookie('nextinit', true, {
          expires: date
        });
      }
    } else {
      return $.removeCookie('nextinit');
    }
  }
};


},{"jquery":774,"simple-storage":780}],115:[function(require,module,exports){
var $, AdxManager, adx, mediator, _;

_ = require('lodash');

$ = require('jquery');

mediator = require('chaplin').mediator;

adx = {
  interestSuggestion: {
    active: false,
    redirectRoute: {
      path: 'interests#suggestInterests',
      urlid: '2Japg3'
    },
    shouldTrigger: function(stumbleCount) {
      return false;
    }
  },
  peopleSuggestion: {
    active: true,
    redirectRoute: {
      path: 'mix#rc',
      urlid: null
    },
    shouldTrigger: function(stumbleCount) {
      return Chaplin.mediator.canTransition && 9 === (stumbleCount % 10);
    }
  }
};


/**
 * Managing ADX 'tests'.  An ADX injects is intended to inject administrative pages (such as suggest-interests)
 * into the stumble-next flow.  This class is designed to be instantiated in the stumbleNext action of the toolbar
 * controller.  Do not use it from anywhere else.
 */

module.exports = AdxManager = (function() {
  function AdxManager() {}


  /**
   * Determine if an administrative page should be injected into the stumble flow. This method is designed to be
   * called from the stumbleNext action of the toolbar controller.  Do not call it from anywhere else.
   *
   * @static
   * @return an object with the path and urlid for redirection or null
   */

  AdxManager.getAdx = function() {
    var stumbleCount, suggestInterestAdx, suggestPeopleAdx;
    stumbleCount = parseInt(mediator.userM.get('stumbles_count'));
    if (isNaN(stumbleCount)) {
      stumbleCount = 1;
    }
    suggestInterestAdx = adx.interestSuggestion;
    if (suggestInterestAdx.active && suggestInterestAdx.shouldTrigger(stumbleCount)) {
      return suggestInterestAdx.redirectRoute;
    }
    suggestPeopleAdx = adx.peopleSuggestion;
    if (suggestPeopleAdx.active && suggestPeopleAdx.shouldTrigger(stumbleCount)) {
      return suggestPeopleAdx.redirectRoute;
    }
    return null;
  };

  return AdxManager;

})();


},{"chaplin":773,"jquery":774,"lodash":776}],116:[function(require,module,exports){
var $, SUdebug, abTracking, config, guid, mediator, storage, utils, _, _ref;

_ = require('lodash');

config = require('../config');

SUdebug = require('../su-debug');

abTracking = require('./ab-tracking');

$ = require('jquery');

storage = require('simple-storage');

mediator = require('chaplin').mediator;

guid = require('./guid');

utils = require('./utils');

module.exports = {
  category: "SPA-" + (SUdebug != null ? SUdebug.branch : void 0) + "-" + (SUdebug != null ? (_ref = SUdebug.hash) != null ? _ref.slice(0, 7) : void 0 : void 0),
  trackPageview: function(path) {
    if (path[0] !== '/') {
      path = '/' + path;
    }
    return typeof _gaq !== "undefined" && _gaq !== null ? _gaq.push(['_trackPageview', path]) : void 0;
  },
  trackComscore: function() {
    return typeof COMSCORE !== "undefined" && COMSCORE !== null ? COMSCORE.beacon({
      c1: "2",
      c2: "7677660"
    }) : void 0;
  },
  trackEvent: function(category, value, options) {
    if (options == null) {
      options = {};
    }
    if (category == null) {
      throw new Error('Must specify a category');
    }
    if (category.match(' ')) {
      throw new Error('Category must not have spaces');
    }
    if ((value != null) && isNaN(value)) {
      throw new TypeError('Value must be a number');
    }
    _.defaults(options, {
      action: 'click',
      property: config.headers['X-Su-Version'],
      label: null
    });
    if ((typeof optimizely !== "undefined" && optimizely !== null ? optimizely.activeExperiments.length : void 0) > 0) {
      abTracking.track(category);
    } else {
      storage.remove('sCount');
    }
    console.log('spa', category);
    $.get('/p');
    return true;
  }
};


},{"../config":2,"../su-debug":265,"./ab-tracking":114,"./guid":119,"./utils":156,"chaplin":773,"jquery":774,"lodash":776,"simple-storage":780}],117:[function(require,module,exports){
var $, betaName, betaOptOutName, defaultDays, optInCookie, optOutCookie, _;

_ = require('lodash');

$ = require('jquery');

optInCookie = 'beta';

optOutCookie = 'beta-opt-out';

defaultDays = 365;

betaName = 'test/applause';

betaOptOutName = 'test/legacy';

module.exports = {
  optOutDays: 7,
  optIn: function(days) {
    if (days == null) {
      days = defaultDays;
    }
    $.removeCookie(optOutCookie);
    $.cookie(optInCookie, betaName, {
      expires: days
    });
    return window.location.reload(true);
  },
  optOut: function(days) {
    if (days == null) {
      days = defaultDays;
    }
    $.removeCookie(optInCookie);
    $.cookie(optOutCookie, betaOptOutName, {
      expires: days
    });
    return window.location.reload(true);
  },
  isOptedOut: function() {
    return ($.cookie(optOutCookie) === betaOptOutName) || ($.cookie(optOutCookie) === betaName);
  },
  isOptedIn: function() {
    return $.cookie(optInCookie) === betaName;
  }
};


},{"jquery":774,"lodash":776}],118:[function(require,module,exports){
var $, ClickTracking, analytics, root, _;

root = require('./root');

analytics = require('./analytics');

_ = require('lodash');

$ = require('jquery');

module.exports = ClickTracking = (function() {
  function ClickTracking() {
    this.$body = $('body');
    this.$body.on('click', (function(_this) {
      return function(e) {
        return _this.onClick(e);
      };
    })(this));
  }

  ClickTracking.prototype.getAnalyticsId = function(el) {
    var $el, dataId, dataTrack, _ref, _ref1;
    $el = $(el);
    dataTrack = $el != null ? (_ref = $el.closest('[data-track]')) != null ? _ref.attr('data-track') : void 0 : void 0;
    dataId = $el != null ? (_ref1 = $el.closest('[data-id]')) != null ? _ref1.attr('data-id') : void 0 : void 0;
    return dataTrack || dataId;
  };

  ClickTracking.prototype.onClick = function(e) {
    return _.defer((function(_this) {
      return function() {
        var id;
        id = _this.getAnalyticsId(e.target);
        if (id != null) {
          return analytics.trackEvent(id);
        }
      };
    })(this));
  };

  return ClickTracking;

})();


},{"./analytics":116,"./root":129,"jquery":774,"lodash":776}],119:[function(require,module,exports){
var generateGuid, localStorageKey, s4, storage, _;

_ = require('lodash');

storage = require('simple-storage');

localStorageKey = 'guid';

s4 = function() {
  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
};

generateGuid = _.once(function() {
  return s4() + s4() + "-" + s4() + "-" + s4() + "-" + s4() + "-" + s4() + s4() + s4();
});

module.exports = {
  get: function() {
    var existingGuid, generatedGuid;
    existingGuid = storage.get(localStorageKey);
    if (existingGuid) {
      return existingGuid;
    } else {
      generatedGuid = generateGuid();
      storage.set(localStorageKey, generatedGuid);
      return generatedGuid;
    }
  }
};


},{"lodash":776,"simple-storage":780}],120:[function(require,module,exports){
var stringsDefault;

stringsDefault = require("../strings/en-US");

module.exports = function(phrase, searchFor, replaceWith) {
  var re, source;
  source = stringsDefault[phrase] || phrase;
  re = new RegExp(searchFor, 'g');
  return source.replace(re, replaceWith);
};


},{"../strings/en-US":264}],121:[function(require,module,exports){
var stringsDefault;

stringsDefault = require("../strings/en-US");

module.exports = function(phrase) {
  return stringsDefault[phrase] || phrase;
};


},{"../strings/en-US":264}],122:[function(require,module,exports){
var ListMetaM, ProfileListItemM, SubmitM, mediator, panel;

ProfileListItemM = require('../models/profile-list-item-model');

ListMetaM = require('../models/listmeta-model');

SubmitM = require('../models/submit-model');

panel = require('./panel');

mediator = require('chaplin').mediator;

module.exports = {
  addItemToList: function(urlid, listId) {
    var profileListItemM;
    profileListItemM = new ProfileListItemM({
      urlid: urlid,
      listId: null
    });
    if (listId === 'likes') {
      profileListItemM.set({
        rating: 1
      });
    } else {
      profileListItemM.set({
        listId: listId
      });
    }
    return profileListItemM.save().then(function(data) {
      var url;
      if (!data.item) {
        url = data.url;
      } else {
        url = data.item.url;
      }
      mediator.publish('profile:itemaddedtolist', url, listId);
      return data;
    }, function(err) {
      mediator.publish('profile:itemfailedtoadd', err);
      return err;
    });
  },
  createList: function(listname) {
    var listMetaM;
    listMetaM = new ListMetaM;
    listMetaM.set({
      name: listname,
      visibility: 'public',
      userid: mediator.userM.get('userid')
    });
    return listMetaM.save().then(function(data) {
      mediator.publish('profile:list:created', listMetaM);
      return data;
    });
  },
  submitUrl: function(url) {
    var submitM;
    submitM = new SubmitM;
    submitM.set({
      url: url
    });
    return submitM.save().then((function(_this) {
      return function(data) {
        var urlData, urlid;
        urlData = _this.extractUrlObject(data);
        urlid = urlData.publicid;
        if (data._success === false) {
          mediator.publish('profile:itemfailedtosubmit', data._reason);
        } else {
          _this.addItemToList(urlid, 'likes');
          mediator.publish('profile:url:submitted', urlid);
        }
        return data;
      };
    })(this), function(err) {
      mediator.publish('profile:itemfailedtosubmit', err);
      return err;
    });
  },
  extractUrlObject: function(data) {
    var useDiscovery, useDiscoveryUrl, useUrl, _ref, _ref1, _ref2, _ref3;
    useDiscovery = (_ref = data.discovery) != null ? _ref.publicid : void 0;
    useUrl = (_ref1 = data.url) != null ? _ref1.publicid : void 0;
    useDiscoveryUrl = (_ref2 = data.discovery) != null ? (_ref3 = _ref2.url) != null ? _ref3.publicid : void 0 : void 0;
    if (useDiscovery) {
      data = data.discovery;
    } else if (useUrl) {
      data = data.url;
    } else if (useDiscoveryUrl) {
      data = data.discovery.url;
    }
    return data;
  },
  canEdit: function(listM) {
    var currentUsername, isLikeList, ownerUsername, _ref;
    currentUsername = mediator.userM.get('username');
    ownerUsername = (_ref = listM.get('owner')) != null ? _ref.username : void 0;
    isLikeList = listM.get('id') === 'likes';
    return currentUsername === ownerUsername && !isLikeList;
  },
  canFollow: function(listM) {
    var currentUsername, isLikeList, ownerUsername, _ref;
    currentUsername = mediator.userM.get('username');
    ownerUsername = (_ref = listM.get('owner')) != null ? _ref.username : void 0;
    isLikeList = listM.get('id') === 'likes';
    return currentUsername !== ownerUsername && !isLikeList;
  }
};


},{"../models/listmeta-model":201,"../models/profile-list-item-model":216,"../models/submit-model":241,"./panel":125,"chaplin":773}],123:[function(require,module,exports){
var AnnounceEvents, mediator, _;

_ = require('lodash');

mediator = require('chaplin').mediator;

module.exports = AnnounceEvents = (function() {
  function AnnounceEvents() {}

  AnnounceEvents.prototype.announceEvents = null;

  AnnounceEvents.prototype.initialize = function() {
    if (typeof this.announceEvents === 'string') {
      this.on('all', function(name) {
        var args;
        args = _.toArray(arguments);
        args.shift();
        args.unshift(this.announceEvents + ':' + name);
        return mediator.publish.apply(mediator, args);
      });
    }
    return AnnounceEvents.__super__.initialize.apply(this, arguments);
  };

  return AnnounceEvents;

})();


},{"chaplin":773,"lodash":776}],124:[function(require,module,exports){
var StopTimers, start, utils;

utils = require('../utils');

start = function(type, args) {
  var method, timer;
  if (!this.disposed) {
    method = window["set" + type];
    timer = method.apply(window, args);
    this.timers[type].push(timer);
    return timer;
  }
};

module.exports = StopTimers = (function() {
  function StopTimers() {
    this.resetTimers();
    StopTimers.__super__.constructor.apply(this, arguments);
  }

  StopTimers.prototype.resetTimers = function() {
    return this.timers = {
      Interval: [],
      Timeout: []
    };
  };

  StopTimers.prototype.setInterval = function() {
    if (arguments[1]) {
      arguments[1] = utils.toMs(arguments[1]);
    }
    return start.call(this, 'Interval', arguments);
  };

  StopTimers.prototype.setTimeout = function() {
    if (arguments[1]) {
      arguments[1] = utils.toMs(arguments[1]);
    }
    return start.call(this, 'Timeout', arguments);
  };

  StopTimers.prototype.dispose = function() {
    var clearMethod, key, val, _ref;
    _ref = this.timers;
    for (key in _ref) {
      val = _ref[key];
      clearMethod = window["clear" + key];
      val.forEach(clearMethod);
    }
    this.resetTimers();
    return StopTimers.__super__.dispose.apply(this, arguments);
  };

  return StopTimers;

})();


},{"../utils":156}],125:[function(require,module,exports){
var $, analytics, currentPanel, disposeDelay, mediator, panel, utils, _,
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

$ = require('jquery');

_ = require('lodash');

mediator = require('chaplin').mediator;

utils = require('./utils');

analytics = require('./analytics');

currentPanel = null;

disposeDelay = 300;

panel = {
  open: _.debounce(function(name, options) {
    var _ref, _ref1, _ref2;
    if (options == null) {
      options = {};
    }
    if (currentPanel === name && name !== 'share') {
      return;
    }
    if (!options.position) {
      options.position = 'top';
    }
    currentPanel = name;
    if ((_ref = this.controller) != null) {
      if (typeof _ref.dispose === "function") {
        _ref.dispose();
      }
    }
    if (options.left) {
      this.safari5HackAdd(options.left);
    }
    this.Controller = require("controllers/panels/" + name + "-controller");
    this.controller = new this.Controller(options);
    analytics.trackEvent(name + '-panelopen');
    mediator.publish('panel:opened', name, options);
    return (_ref1 = $('#app-container')) != null ? (_ref2 = _ref1.attr('data-panel', name)) != null ? _ref2.attr('data-panel-position', options.position) : void 0 : void 0;
  }, disposeDelay, {
    leading: true,
    trailing: false
  }),
  close: _.debounce(function(delay) {
    var _ref, _ref1;
    if (currentPanel != null) {
      currentPanel = null;
      setTimeout((function(_this) {
        return function() {
          var _ref;
          if ((_ref = _this.controller) != null) {
            if (typeof _ref.dispose === "function") {
              _ref.dispose();
            }
          }
          return mediator.publish('panel:closed');
        };
      })(this), disposeDelay);
      this.safari5HackRemove();
      return (_ref = $('#app-container')) != null ? (_ref1 = _ref.removeAttr('data-panel')) != null ? _ref1.removeAttr('data-panel-position') : void 0 : void 0;
    }
  }, disposeDelay, {
    leading: true,
    trailing: false
  }),
  toggle: _.debounce(function(panels) {
    if (typeof panels === 'string') {
      panels = [panels];
    }
    if (__indexOf.call(panels, currentPanel) >= 0) {
      this.close();
      return;
    }
    return this.open(panels[0]);
  }, disposeDelay, {
    leading: true,
    trailing: false
  }),
  isOpen: function() {
    if (currentPanel) {
      return true;
    } else {
      return false;
    }
  },
  getCurrentPanel: function() {
    return currentPanel;
  },
  safari5HackAdd: function(leftPos) {
    if (utils.isOldSafari()) {
      return $('#panel-container').css('left', leftPos);
    }
  },
  safari5HackRemove: function() {
    if (utils.isOldSafari()) {
      return $('#panel-container').removeAttr('style');
    }
  },
  displayErrorMsg: function(txt) {
    if (txt) {
      return this.open('alert', {
        type: 'error',
        text: txt
      });
    }
  },
  displaySuccessMsg: function(txt) {
    if (txt) {
      return this.open('alert', {
        type: 'success',
        text: txt
      });
    }
  },
  onWindowKeyDown: function(e) {
    if (e.keyCode === 27) {
      return this.close();
    }
  }
};

$(window).on('keydown', _.bind(panel.onWindowKeyDown, panel));

module.exports = panel;


},{"./analytics":116,"./utils":156,"chaplin":773,"jquery":774,"lodash":776}],126:[function(require,module,exports){
var $, IdentityM, ProfileListsCollection, mediator, _;

$ = require('jquery');

mediator = require('chaplin').mediator;

IdentityM = require('../models/identity-model');

ProfileListsCollection = require('../models/profile-lists-collection');

_ = require('lodash');

module.exports = {
  setIdentityModel: function(data) {
    var currentIdentityM, currentProfileM, dfd, options, publishChange;
    currentProfileM = mediator.currentProfileM;
    currentIdentityM = currentProfileM.get('identityM');
    if (!currentIdentityM || (data != null ? data.reset : void 0)) {
      currentIdentityM = new IdentityM;
      currentProfileM.set({
        'identityM': currentIdentityM
      });
      publishChange = _.debounce(function() {
        if (data != null ? data.onlyHeaderReset : void 0) {
          return mediator.publish('profile:identity:onlyHeader:reset', currentIdentityM);
        } else {
          return mediator.publish('profile:identity:changed', currentIdentityM);
        }
      }, 50);
      currentIdentityM.on('change:userid', publishChange);
      currentIdentityM.on('change:_isSelf', publishChange);
    }
    if (currentIdentityM.get('username') !== data.username && data.username) {
      currentProfileM.unset('listsC');
      options = {};
      options.data = {
        id: data.username
      };
      return currentIdentityM.fetch(options);
    } else {
      dfd = new $.Deferred;
      dfd.resolve();
      return dfd.promise();
    }
  },
  getLists: function() {
    var currentIdentityM, currentListsC, currentProfileM, options, userid;
    currentProfileM = mediator.currentProfileM;
    currentIdentityM = currentProfileM.get('identityM');
    currentListsC = currentProfileM.get('listsC');
    userid = currentIdentityM.get('userid');
    if (!currentListsC) {
      currentListsC = new ProfileListsCollection;
      currentProfileM.set({
        'listsC': currentListsC
      });
      options = {};
      options.data = {
        userid: userid,
        sorted: true
      };
      currentListsC.fetch(options);
    }
    return currentListsC;
  }
};


},{"../models/identity-model":186,"../models/profile-lists-collection":219,"chaplin":773,"jquery":774,"lodash":776}],127:[function(require,module,exports){
var $, Relate, mediator, _;

$ = require('jquery');

_ = require('lodash');

mediator = require('chaplin').mediator;

module.exports = Relate = (function() {
  Relate.prototype.defaults = {
    positionType: 'fixed',
    position: "bottomleft",
    matchWidth: false,
    matchHeight: false,
    offsetLeft: 0,
    offsetTop: 0,
    includeRelateMargin: false,
    includeElementMargin: false,
    keepInBounds: true
  };

  function Relate(selector, options) {
    if (options == null) {
      options = {};
    }
    this.config = _.extend({}, this.defaults, options);
    this.$el = $(selector);
    mediator.subscribe('window:resize', this.position, this);
  }

  Relate.prototype.to = function(selector) {
    if (selector) {
      this.$relateTo = $(selector);
      this.position();
      this.checkSizeTimeout = setTimeout(_.bind(this.position, this), 50);
    }
    return this;
  };

  Relate.prototype.update = function(elSelector, relationSelector) {
    if (elSelector) {
      this.$el = $(elSelector);
    }
    if (relationSelector) {
      this.$relatTo = $(relationSelector);
    }
    this.position();
    return this;
  };

  Relate.prototype.position = function() {
    var elHeight, elOffset, elWidth, left, relateHeight, relateOffset, relateWidth, top, windowHeight, windowWidth;
    if (this.disposed || !this.$relateTo || !this.$el || !this.$relateTo.is(':visible')) {
      return this;
    }
    windowHeight = $(window).height();
    windowWidth = $(window).width();
    elOffset = this.$el.offset();
    relateOffset = this.$relateTo.offset();
    elWidth = this.$el.outerWidth(this.config.includeElementMargin);
    elHeight = this.$el.outerHeight(this.config.includeElementMargin);
    relateWidth = this.$relateTo.outerWidth(this.config.includeRelateMargin);
    relateHeight = this.$relateTo.outerHeight(this.config.includeRelateMargin);
    switch (this.config.position) {
      case 'left':
        left = relateOffset.left - elWidth;
        top = relateOffset.top - elHeight;
        break;
      case 'right':
        left = relateOffset.left + relateWidth;
        top = relateOffset.top - elHeight;
        break;
      case 'bottomleft':
        left = relateOffset.left;
        top = relateHeight + relateOffset.top;
        break;
      case 'bottomright':
        left = relateOffset.left + relateWidth;
        top = relateHeight + relateOffset.top;
        break;
      case 'rightedge-bottomright':
        left = (relateOffset.left + relateWidth) - elWidth;
        top = relateHeight + relateOffset.top;
        break;
      case 'topleft':
        left = relateOffset.left;
        top = relateOffset.top - elHeight;
        break;
      case 'topright':
        left = relateOffset.left + relateWidth;
        top = relateOffset.top - elHeight;
        break;
      case 'topcenter':
        left = (relateOffset.left + (relateWidth / 2)) - (elWidth / 2);
        top = relateOffset.top - elHeight;
        break;
      case 'bottomcenter':
        left = (relateOffset.left + (relateWidth / 2)) - (elWidth / 2);
        top = relateHeight + relateOffset.top;
        break;
      default:
        throw new Error("Not a valid position type");
    }
    left += this.config.offsetLeft;
    top += this.config.offsetTop;
    if (this.config.keepInBounds) {
      if ((left + elWidth) > windowWidth) {
        left = windowWidth - elWidth;
      }
      if ((top + elHeight) > windowHeight) {
        top = windowHeight - elHeight;
      }
      if (left < 0) {
        left = 0;
      }
      if (top < 0) {
        top = 0;
      }
    }
    if (this.config.matchWidth) {
      this.$el.width(relateWidth);
    }
    if (this.config.matchHeight) {
      this.$el.height(relateHeight);
    }
    this.$el.css({
      top: top + 'px',
      left: left + 'px',
      position: this.config.positionType
    });
    return this;
  };

  Relate.prototype.dispose = function() {
    clearTimeout(this.checkSizeTimeout);
    this.disposed = true;
    this.$el = null;
    this.$relateTo = null;
    this.config = null;
    return mediator.unsubscribe('window:resize', this.position, this);
  };

  return Relate;

})();


},{"chaplin":773,"jquery":774,"lodash":776}],128:[function(require,module,exports){
var $, Chaplin, SU, analytics, announce, apiFail, handleError, mediator, rejectedPromise, root, utils;

Chaplin = require('chaplin');

mediator = Chaplin.mediator;

SU = require('./su');

root = require('./root');

utils = require('./utils');

$ = require('jquery');

analytics = require('./analytics');

apiFail = {
  threshold: 20,
  count: 0,
  errorPage: '/500'
};

announce = function(name, data) {
  var code, eventName, _ref;
  Chaplin.mediator.publish('api:' + name, data);
  code = (data != null ? data._code : void 0) || 0;
  if (code === 0) {
    try {
      code = (_ref = JSON.parse(data != null ? data.responseText : void 0)) != null ? _ref._code : void 0;
    } catch (_error) {
      code = 0;
    }
  }
  eventName = "api-" + name + "-" + code;
  console.error(eventName, data);
  return analytics.trackEvent(eventName, code);
};

handleError = function(res) {
  var code, data, isStumblingDomain, _ref, _ref1;
  data = (res != null ? res.responseJSON : void 0) || res;
  code = (data != null ? data._code : void 0) || null;
  if (utils.isOutOfStumbles(res)) {
    code = 99999;
  }
  isStumblingDomain = (_ref = mediator.modesC) != null ? _ref.isStumblingDomain() : void 0;
  if (code === 99999 && isStumblingDomain) {
    code = 99998;
  }
  if (code === null) {
    try {
      code = (_ref1 = JSON.parse(res != null ? res.responseText : void 0)) != null ? _ref1._code : void 0;
    } catch (_error) {
      code = null;
    }
  }
  switch (code) {
    case 1230:
    case 1070:
    case 5090:
      return (function() {
        return announce('badauth', data);
      })();
    case 5020:
    case 5030:
      return (function() {
        return announce('outofstumbles', data);
      })();
    case 5060:
      return (function() {
        return announce('userhasnotopics', data);
      })();
    case 401:
    case 1010:
      return (function() {
        return announce('invalidtoken', data);
      })();
    case 19230:
      return (function() {
        return announce('urlalreadyinlist', data);
      })();
    case 2000:
      return (function() {
        return announce('urldoesnotexist', data);
      })();
    case 99999:
      return (function() {
        return announce('stumblesempty', data);
      })();
    case 99998:
      return (function() {
        return announce('domainstumblesempty', data);
      })();
    default:
      return (function() {
        return announce('unknownerror', data);
      })();
  }
};

rejectedPromise = function() {
  var dfd;
  dfd = new $.Deferred;
  dfd.reject();
  return dfd.promise();
};

module.exports = function(apimethod, args) {
  var method, model, options;
  method = args[0];
  model = args[1];
  options = args[2] || {};
  if (apiFail.count >= apiFail.threshold) {
    try {
      analytics.trackEvent('maxApiErrors', apiFail.count);
      console.error('maxApiErrors', apiFail.count);
      debugger;
    } catch (_error) {}
    apiFail.count = 0;
    Chaplin.utils.redirectTo({
      url: apiFail.errorPage
    });
    return rejectedPromise();
  } else if (apiFail.count && options.failOnFirstError) {
    return rejectedPromise();
  } else {
    return apimethod(options.data, function(res) {
      if (res.status && res.status >= 400 && res.status <= 599) {
        handleError(res);
        apiFail.count += 1;
        return typeof options.error === "function" ? options.error(res, options.data) : void 0;
      } else if ((options != null ? options.ignoreSuccessProperty : void 0) || ((res != null ? res._success : void 0) && (!utils.isOutOfStumbles(res, options.data) || !utils.isLoggedIn()))) {
        apiFail.count = 0;
        return typeof options.success === "function" ? options.success(res, options.data) : void 0;
      } else {
        handleError(res);
        apiFail.count += 1;
        return typeof options.error === "function" ? options.error(res) : void 0;
      }
    }, handleError);
  }
};


},{"./analytics":116,"./root":129,"./su":153,"./utils":156,"chaplin":773,"jquery":774}],129:[function(require,module,exports){
(function (global){
var internal;

internal = {};

module.exports = function() {
  if (typeof window !== "undefined" && window !== null) {
    return window;
  } else if (typeof global !== "undefined" && global !== null) {
    return global;
  } else {
    return internal;
  }
};


}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],130:[function(require,module,exports){
var $, analytics, mediator, panel, utils;

mediator = require('chaplin').mediator;

panel = require('./panel');

analytics = require('./analytics');

utils = require('./utils');

$ = require('jquery');

module.exports = {
  FRESHNESS_THRESHOLD: 30,
  getCollection: function() {
    var currentMode, _ref;
    currentMode = (_ref = mediator.modesC) != null ? _ref.getActive() : void 0;
    if ((currentMode != null ? currentMode.get('listId') : void 0) != null) {
      return mediator.listItemsC;
    } else {
      return mediator.stumblesC;
    }
  },
  getNext: function() {
    return this.getCollection().getNext(arguments);
  },
  whereUnseen: function() {
    return this.getCollection().whereUnseen(arguments);
  },
  stumbleNext: function() {
    var suggestPageCookie;
    suggestPageCookie = $.cookie('suggest-page');
    if (suggestPageCookie && suggestPageCookie === '0') {
      utils.setSuggestPageCookie(1);
      utils.redirectToSuggestPage();
    }
    panel.close();
    this.updateLastStumbleTime();
    return this.getNext().then((function(_this) {
      return function(model) {
        var route;
        route = (model != null ? typeof model.get === "function" ? model.get('_route') : void 0 : void 0) || '/';
        if (mediator.update) {
          return utils.gotoUrl(utils.appendParams('/' + route, {
            update: utils.unix()
          }));
        } else {
          return Chaplin.utils.redirectTo({
            url: route
          });
        }
      };
    })(this), (function(_this) {
      return function(data) {
        var code, eventName, _ref, _ref1;
        if (data != null ? data.visitor : void 0) {
          return window.location.href = utils.getNoSpaUrl();
        } else {
          code = (data != null ? (_ref = data.responseJSON) != null ? _ref._code : void 0 : void 0) || 0;
          eventName = "stumbleNextError-" + code;
          console.error(eventName, data);
          analytics.trackEvent(eventName);
          return (_ref1 = window.heap) != null ? _ref1.track(eventName) : void 0;
        }
      };
    })(this));
  },
  updateLastStumbleTime: function() {
    return $.cookie('stumble:last', utils.unix());
  },
  getLastStumbleTime: function() {
    return $.cookie('stumble:last') || 0;
  },
  isTooLongSinceStumble: function() {
    return utils.unix() - this.getLastStumbleTime() > this.FRESHNESS_THRESHOLD;
  },
  isFreshSession: function() {
    return this.getCollection().size() === 0 && this.isTooLongSinceStumble();
  }
};


},{"./analytics":116,"./panel":125,"./utils":156,"chaplin":773,"jquery":774}],131:[function(require,module,exports){
var SUJS, StumbleUpon;

SUJS = StumbleUpon = (function() {
  StumbleUpon.prototype.Activities = require('./stumbleupon/activities');

  StumbleUpon.prototype.Comment = require('./stumbleupon/comment');

  StumbleUpon.prototype.Contact = require('./stumbleupon/contact');

  StumbleUpon.prototype.Conversations = require('./stumbleupon/conversations');

  StumbleUpon.prototype.config = require('./stumbleupon/config');

  StumbleUpon.prototype.debug = true;

  StumbleUpon.prototype.History = require('./stumbleupon/history');

  StumbleUpon.prototype.Interests = require('./stumbleupon/interests');

  StumbleUpon.prototype.Lists = require('./stumbleupon/lists');

  StumbleUpon.prototype.Notifications = require('./stumbleupon/notifications');

  StumbleUpon.prototype.Participants = require('./stumbleupon/participants');

  StumbleUpon.prototype.Report = require('./stumbleupon/report');

  StumbleUpon.prototype.Share = require('./stumbleupon/share');

  StumbleUpon.prototype.Submit = require('./stumbleupon/submit');

  StumbleUpon.prototype.Stumble = require('./stumbleupon/stumble');

  StumbleUpon.prototype.Url = require('./stumbleupon/url');

  StumbleUpon.prototype.User = require('./stumbleupon/user');

  StumbleUpon.prototype.Settings = require('./stumbleupon/settings');

  function StumbleUpon(options) {}

  return StumbleUpon;

})();

if (module) {
  module.exports = SUJS;
}

if (window) {
  window.SUJS = SUJS;
}


},{"./stumbleupon/activities":132,"./stumbleupon/comment":134,"./stumbleupon/config":135,"./stumbleupon/contact":136,"./stumbleupon/conversations":137,"./stumbleupon/history":138,"./stumbleupon/interests":139,"./stumbleupon/lists":142,"./stumbleupon/notifications":144,"./stumbleupon/participants":145,"./stumbleupon/report":146,"./stumbleupon/settings":147,"./stumbleupon/share":148,"./stumbleupon/stumble":149,"./stumbleupon/submit":150,"./stumbleupon/url":151,"./stumbleupon/user":152}],132:[function(require,module,exports){
var Activities, api;

api = require('./api');

module.exports = Activities = (function() {
  function Activities() {}

  Activities.get = function(data, callback) {
    var options;
    if (data == null) {
      data = {};
    }
    data.scope = data.scope || 'conversation,follow';
    options = {
      data: data,
      type: 'GET',
      url: "/activities",
      devpath: "http://10.1.11.28/v2-dev/api/v2_0",
      xhrFields: {
        withCredentials: false
      },
      maxRetry: 1
    };
    return api(options, callback);
  };

  Activities.markRead = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'PUT',
      url: "/activities/" + data.id + "/read",
      devpath: "http://10.1.11.28/v2-dev/api/v2_0",
      xhrFields: {
        withCredentials: false
      },
      maxRetry: 1
    };
    return api(options, callback);
  };

  Activities.snapshot = function(data, callback) {
    var options;
    if (data == null) {
      data = {};
    }
    data.scope = 'conversation,follow';
    options = {
      data: data,
      type: 'GET',
      url: "/activities/snapshot",
      devpath: "http://10.1.11.28/v2-dev/api/v2_0",
      xhrFields: {
        withCredentials: false
      },
      maxRetry: 1
    };
    return api(options, callback);
  };

  Activities.setSnapshot = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'PUT',
      url: "/activities/snapshot",
      devpath: "http://10.1.11.28/v2-dev/api/v2_0",
      xhrFields: {
        withCredentials: false
      },
      maxRetry: 1
    };
    return api(options, callback);
  };

  return Activities;

})();


},{"./api":133}],133:[function(require,module,exports){
var $, analytics, config, generateHeaders, globalConfig, guid, noretry, storage, utils, _,
  __hasProp = {}.hasOwnProperty;

_ = require('lodash');

$ = require('jquery');

globalConfig = require('../../config');

config = require('./config');

utils = require('../utils');

analytics = require('../analytics');

storage = require('simple-storage');

guid = require('../guid');

generateHeaders = function(options) {
  var defaults, headers;
  defaults = {
    'X-Su-ClientId': guid.get(),
    'X-Su-AccessTokenKey': utils.getDoubleDownToken()
  };
  headers = _.clone(globalConfig.headers);
  return _(headers).defaults(defaults).omit(function(value) {
    return _.isEmpty(value);
  }).value();
};

noretry = [5060, 5020, 5030, 19230, 2000];

module.exports = function(options, callback, failCallback) {
  var basePath, hasUndefined, key, sendData, xhr;
  failCallback = failCallback || function() {};
  if (utils.isDev() && options.devpath) {
    basePath = options.devpath;
  } else {
    basePath = options.path || config.api.path;
  }
  options.pathname = options.url;
  options.url = basePath + options.url;
  hasUndefined = false;
  if (options != null ? options.data : void 0) {
    sendData = options.data;
    for (key in sendData) {
      if (!__hasProp.call(sendData, key)) continue;
      if (typeof sendData[key] === 'undefined') {
        hasUndefined = true;
        break;
      }
    }
  }
  xhr = $.ajax(_.defaults(options, {
    data: {},
    error: function() {
      if (typeof callback === 'function') {
        return callback.apply(this, arguments);
      }
    },
    success: function() {
      if (typeof callback === 'function') {
        return callback.apply(this, arguments);
      }
    },
    type: 'GET',
    xhrFields: {
      withCredentials: true
    },
    headers: generateHeaders(options),
    shouldRetry: function(res, retryCount, requestMethod) {
      var code, delay, dfd, httpStatus, retry, _ref, _ref1, _ref2;
      dfd = new $.Deferred;
      code = (res != null ? (_ref = res.responseJSON) != null ? _ref._code : void 0 : void 0) || 0;
      if (code === 0) {
        try {
          code = (_ref1 = JSON.parse(res != null ? res.responseText : void 0)) != null ? _ref1._code : void 0;
        } catch (_error) {
          code = 0;
        }
      }
      httpStatus = res != null ? (_ref2 = res.status) != null ? _ref2.toString() : void 0 : void 0;
      retry = hasUndefined !== true && retryCount <= 5 && !_(noretry).contains(code) && options.noretry !== true;
      delay = utils.toMs(retryCount * 2 + 's');
      if (httpStatus === '403') {
        console.error('api request failed with 403, NOT retrying', arguments);
        failCallback(options);
        return;
      }
      if (httpStatus === '404') {
        console.error('api request failed with 404, NOT retrying because why do that?', arguments);
        failCallback(options);
        return;
      }
      if (retryCount >= 2 && code === 1010 && options.preventDisableSpa !== true) {
        Chaplin.utils.redirectTo({
          url: 'logout'
        });
        return;
      }
      if (retry) {
        console.warn('api request failed, retrying', arguments);
      } else {
        console.error('api requests failed, but NOT retrying', arguments);
        failCallback(options);
        return;
      }
      if (typeof options.maxRetry === 'number' && retryCount > options.maxRetry) {
        console.error('Api failures exceed max retry.  Aborting retries');
        dfd.reject();
        options.error = 'max-retry';
        failCallback(options);
        return;
      }
      setTimeout((function(_this) {
        return function() {
          var r;
          r = new XMLHttpRequest();
          r.open('GET', '/p', true);
          r.send();
          return dfd.resolve(retry);
        };
      })(this), delay);
      try {
        analytics.trackEvent('apiRetry', retryCount);
      } catch (_error) {}
      return dfd.promise();
    }
  }));
  return xhr;
};


},{"../../config":2,"../analytics":116,"../guid":119,"../utils":156,"./config":135,"jquery":774,"lodash":776,"simple-storage":780}],134:[function(require,module,exports){
var Comment, api;

api = require('./api');

module.exports = Comment = (function() {
  function Comment() {}

  Comment.add = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/comment'
    };
    return api(options, callback);
  };

  Comment["delete"] = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'DELETE',
      url: '/comment/url'
    };
    return api(options, callback);
  };

  Comment.get = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: '/comment/url'
    };
    return api(options, callback);
  };

  return Comment;

})();


},{"./api":133}],135:[function(require,module,exports){
var utils;

utils = require('../utils');

module.exports = {
  api: {
    path: utils.getApiBaseUrl()
  }
};


},{"../utils":156}],136:[function(require,module,exports){
var Contact, api;

api = require('./api');

module.exports = Contact = (function() {
  function Contact() {}

  Contact.findByEmail = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: '/contact/find/email'
    };
    return api(options, callback);
  };

  Contact.get = function(data, callback) {
    var options;
    options = {
      type: 'GET',
      url: '/contact'
    };
    return api(options, callback);
  };

  Contact.invite = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      url: '/contact/invite'
    };
    return api(options, callback);
  };

  return Contact;

})();


},{"./api":133}],137:[function(require,module,exports){
var Conversations, api, globalConfig, host, utils;

api = require('./api');

globalConfig = require('../../config');

utils = require('../utils');

if (utils.isDev()) {
  host = globalConfig.localDev.conversationHost;
} else {
  host = globalConfig.conversationHost;
}

module.exports = Conversations = (function() {
  function Conversations() {}

  Conversations.get = function(data, callback, failCallback) {
    var options, url;
    url = "/conversations/" + data.conversationId;
    delete data.conversationId;
    options = {
      type: 'GET',
      path: host,
      url: url,
      data: data,
      xhrFields: {
        withCredentials: false
      },
      maxRetry: 0
    };
    return api(options, callback, failCallback);
  };

  Conversations.create = function(data, callback, failCallback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      path: host,
      url: "/conversations",
      xhrFields: {
        withCredentials: false
      },
      maxRetry: 0
    };
    return api(options, callback, failCallback);
  };

  Conversations.addParticipants = function(data, callback, failCallback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      path: host,
      url: "/conversations/" + data.conversationId + "/participants",
      xhrFields: {
        withCredentials: false
      }
    };
    return api(options, callback, failCallback);
  };

  Conversations.addComment = function(data, callback, failCallback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      path: host,
      url: "/conversations/" + data.conversationId + "/comments",
      xhrFields: {
        withCredentials: false
      }
    };
    return api(options, callback, failCallback);
  };

  Conversations.mute = function(data, callback, failCallback) {
    var options;
    options = {
      data: data,
      type: 'PUT',
      path: host,
      url: "/conversations/" + data.conversationId + "/mute",
      xhrFields: {
        withCredentials: false
      }
    };
    return api(options, callback, failCallback);
  };

  return Conversations;

})();


},{"../../config":2,"../utils":156,"./api":133}],138:[function(require,module,exports){
var Lists, api;

api = require('./api');

module.exports = Lists = (function() {
  function Lists() {}

  Lists.getGroupLikes = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/history/" + data.userid + "/likes/groups"
    };
    return api(options, callback);
  };

  Lists.getLikes = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/history/" + data.userid + "/likes/all"
    };
    return api(options, callback);
  };

  Lists.getPhotoLikes = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/history/" + data.userid + "/likes/photos"
    };
    return api(options, callback);
  };

  Lists.getRecentLikes = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/history/" + data.userid + "/likes/recent"
    };
    return api(options, callback);
  };

  Lists.getStumbles = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/history/" + data.userid + "/stumbles",
      noretry: true
    };
    return api(options, callback);
  };

  Lists.getVideoLikes = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/history/" + data.userid + "/likes/videos"
    };
    return api(options, callback);
  };

  Lists.searchLikes = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/history/" + data.userid + "/likes/search",
      noretry: true
    };
    return api(options, callback);
  };

  Lists.getAdditions = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/history/" + data.userid + "/likes/discoveries",
      noretry: true
    };
    return api(options, callback);
  };

  Lists.getUsedTags = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/history/" + data.userid + "/likes/tagCloud",
      noretry: true
    };
    return api(options, callback);
  };

  return Lists;

})();


},{"./api":133}],139:[function(require,module,exports){
var Interests, api;

api = require('./api');

module.exports = Interests = (function() {
  function Interests() {}

  Interests.getInterests = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: "/interests"
    };
    return api(options, callback);
  };

  Interests.getPopularInterests = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: "/interests/popular"
    };
    return api(options, callback);
  };

  Interests.getUrls = function(data, callback) {
    var interestId, options;
    interestId = data != null ? data.interestid : void 0;
    delete data.interestid;
    options = {
      data: data || {},
      type: 'GET',
      url: "/interests/" + interestId + "/urls"
    };
    return api(options, callback);
  };

  return Interests;

})();


},{"./api":133}],140:[function(require,module,exports){
var Image;

module.exports = Image = {
  getBase64DataFromImage: function(img, callback) {
    var canvas, ctx, dataURL;
    canvas = document.createElement('canvas');
    canvas.width = img.width;
    canvas.height = img.height;
    ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0);
    dataURL = canvas.toDataURL('image/png');
    return callback(dataURL);
  },
  getBase64DataFromImageUrl: function(url, callback) {
    var img;
    img = document.createElement('img');
    img.onload = function() {
      return Image.getBase64DataFromImage(img, function(dataUrl) {
        return callback(dataUrl);
      });
    };
    return img.src = url;
  }
};


},{}],141:[function(require,module,exports){
var Misc;

module.exports = Misc = {

  /*
  Returns a random integer between min and max
  Using Math.round() will give you a non-uniform distribution!
   */
  generateRandomInt: function(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  },
  generateRandomUserData: function() {
    var randStr, userData;
    randStr = Math.round(new Date().getTime() / 1000) + Misc.generateRandomInt(1, 100000);
    userData = {
      username: 'user' + randStr,
      password: 'fastman888',
      email: "user" + randStr + "@testytest.com",
      bmonth: Misc.generateRandomInt(1, 12).toString(),
      bday: Misc.generateRandomInt(1, 28).toString(),
      byear: Misc.generateRandomInt(1938, 1978).toString(),
      gender: Misc.generateRandomInt(1, 2).toString(),
      findfriends: Misc.generateRandomInt(0, 1).toString()
    };
    return userData;
  }
};


},{}],142:[function(require,module,exports){
var Lists, api;

api = require('./api');

module.exports = Lists = (function() {
  function Lists() {}

  Lists.addItem = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      url: "/list/" + data.listId + "/items",
      maxRetry: 0
    };
    return api(options, callback);
  };

  Lists.create = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      url: "/user/" + data.userid + "/lists"
    };
    return api(options, callback);
  };

  Lists["delete"] = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'DELETE',
      url: "/list/" + data.id
    };
    return api(options, callback);
  };

  Lists.deleteItem = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'DELETE',
      url: "/list/" + data.listId + "/items/" + data.id
    };
    return api(options, callback);
  };

  Lists.get = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/user/" + data.id + "/lists"
    };
    return api(options, callback);
  };

  Lists.getItems = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/list/" + data.listId + "/items"
    };
    return api(options, callback);
  };

  Lists.getMeta = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/list/" + data.listId
    };
    return api(options, callback);
  };

  Lists.update = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'PUT',
      url: "/list/" + data.id
    };
    return api(options, callback);
  };

  return Lists;

})();


},{"./api":133}],143:[function(require,module,exports){
var Mediator,
  __slice = [].slice;

module.exports = Mediator = (function() {
  function Mediator() {
    this.channels = {};
  }

  Mediator.subscribe = function(name, callback) {
    if (this.channels[name] == null) {
      this.channels[name] = [];
    }
    this.channels[name].push({
      context: this,
      callback: callback
    });
    return this;
  };

  Mediator.unsubscribe = function(name, callback) {
    var i, sub, _i, _len, _ref, _results;
    _ref = this.channels[name];
    _results = [];
    for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
      sub = _ref[i];
      if (sub.callback === callback) {
        _results.push(this.channels[name].splice(i, 1));
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  Mediator.publish = function() {
    var data, name, sub, _i, _len, _ref, _results;
    name = arguments[0], data = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    _ref = this.channels[name];
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      sub = _ref[_i];
      _results.push(sub.callback.apply(sub.context, data));
    }
    return _results;
  };

  return Mediator;

})();


},{}],144:[function(require,module,exports){
var Notifications, api;

api = require('./api');

module.exports = Notifications = (function() {
  function Notifications() {}

  Notifications.get = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/user/" + data.userid + "/notifications"
    };
    return api(options, callback);
  };

  return Notifications;

})();


},{"./api":133}],145:[function(require,module,exports){
var Participants, api, globalConfig, host, utils;

api = require('./api');

globalConfig = require('../../config');

utils = require('../utils');

if (utils.isDev()) {
  host = globalConfig.localDev.conversationHost;
} else {
  host = globalConfig.conversationHost;
}

module.exports = Participants = (function() {
  function Participants() {}

  Participants.get = function(data, callback, failCallback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      path: host,
      url: "/participants/" + data.participantId,
      xhrFields: {
        withCredentials: false
      }
    };
    return api(options, callback, failCallback);
  };

  Participants.query = function(data, callback, failCallback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      path: host,
      url: "/participants",
      xhrFields: {
        withCredentials: false
      }
    };
    return api(options, callback, failCallback);
  };

  Participants.queryNoRetry = function(data, callback, failCallback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      path: host,
      url: "/participants",
      xhrFields: {
        withCredentials: false
      },
      noretry: true
    };
    return api(options, callback, failCallback);
  };

  Participants.blockedParticipants = function(data, callback, failCallback) {
    var options;
    options = {
      type: 'GET',
      path: host,
      url: "/participants/" + data.participantId + "/blocked",
      xhrFields: {
        withCredentials: false
      },
      maxRetry: 0
    };
    return api(options, callback, failCallback);
  };

  Participants.blockParticipants = function(data, callback, failCallback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      path: host,
      url: "/participants/" + data.participantId + "/blocked",
      xhrFields: {
        withCredentials: false
      }
    };
    return api(options, callback, failCallback);
  };

  Participants.unblockParticipants = function(data, callback, failCallback) {
    var options;
    options = {
      data: data,
      type: 'DELETE',
      path: host,
      url: "/participants/" + data.participantId + "/blocked",
      xhrFields: {
        withCredentials: false
      }
    };
    return api(options, callback, failCallback);
  };

  Participants.participantBlockStatus = function(data, callback, failCallback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      path: host,
      url: "/participants/" + data.participantId + "/blocked/" + data.blockedParticipantId,
      xhrFields: {
        withCredentials: false
      }
    };
    return api(options, callback, failCallback);
  };

  return Participants;

})();


},{"../../config":2,"../utils":156,"./api":133}],146:[function(require,module,exports){
var Report, api;

api = require('./api');

module.exports = Report = (function() {
  function Report() {}

  Report.event = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/report/event'
    };
    return api(options, callback);
  };

  Report.timers = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      url: "/report/timers"
    };
    return api(options, callback);
  };

  Report.seen = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      url: "/report/seenurls"
    };
    return api(options, callback);
  };

  Report.info = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: "/report/info",
      noretry: true
    };
    return api(options, callback);
  };

  Report.misclassified = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/report/misclassified",
      noretry: true
    };
    return api(options, callback);
  };

  Report.wrongLanguage = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/report/wrongLanguage",
      noretry: true
    };
    return api(options, callback);
  };

  Report.notAvailable = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/report/notAvailable",
      noretry: true
    };
    return api(options, callback);
  };

  Report.flagStumbler = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/report/flagStumbler",
      noretry: true
    };
    return api(options, callback);
  };

  Report.externalShare = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/message/report/external",
      noretry: true
    };
    return api(options, callback);
  };

  return Report;

})();


},{"./api":133}],147:[function(require,module,exports){
var Settings, api;

api = require('./api');

module.exports = Settings = (function() {
  function Settings() {}

  Settings.getProfile = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: "/settings/profile"
    };
    return api(options, callback);
  };

  Settings.setProfile = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/settings/profile"
    };
    return api(options, callback);
  };

  Settings.getAccount = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: "/settings/accountInfo"
    };
    return api(options, callback);
  };

  Settings.setAccount = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/settings/accountInfo"
    };
    return api(options, callback);
  };

  Settings.markForDeletion = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/settings/markForDeletion"
    };
    return api(options, callback);
  };

  Settings.unmarkDeletion = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/settings/unmarkDeletion"
    };
    return api(options, callback);
  };

  Settings.changePassword = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/settings/password"
    };
    return api(options, callback);
  };

  Settings.getPersonalization = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: "/settings/personalization"
    };
    return api(options, callback);
  };

  Settings.setPersonalization = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/settings/personalization"
    };
    return api(options, callback);
  };

  Settings.getNotifications = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: "/settings/notifications"
    };
    return api(options, callback);
  };

  Settings.setNotifications = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/settings/notifications"
    };
    return api(options, callback);
  };

  Settings.getConnections = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: "/settings/connections"
    };
    return api(options, callback);
  };

  Settings.setConnections = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/settings/connections"
    };
    return api(options, callback);
  };

  return Settings;

})();


},{"./api":133}],148:[function(require,module,exports){
var Share, api;

api = require('./api');

module.exports = Share = (function() {
  function Share() {}

  Share.url = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/message/send'
    };
    if ((data != null ? data.no_email : void 0) === true) {
      options.no_email = true;
    }
    return api(options, callback);
  };

  Share.seen = function(data, callback) {
    var options;
    options = {
      contentType: 'application/json',
      data: '{"isRead":true}',
      type: 'PUT',
      url: "/shares/" + data.id
    };
    return api(options, callback);
  };

  Share.get = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: "/shares/" + data.id
    };
    return api(options, callback);
  };

  return Share;

})();


},{"./api":133}],149:[function(require,module,exports){
var Stumble, api;

api = require('./api');

module.exports = Stumble = (function() {
  function Stumble() {}

  Stumble.activity = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/activity'
    };
    return api(options, callback);
  };

  Stumble.all = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/all'
    };
    return api(options, callback);
  };

  Stumble.suggestVisitor = function(data, callback) {
    var options;
    options = {
      data: {},
      type: 'GET',
      url: '/suggest/visitor/urls'
    };
    return api(options, callback);
  };

  Stumble.app = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/app'
    };
    return api(options, callback);
  };

  Stumble.blockDomain = function(data, callback) {
    var options;
    options = {
      type: 'POST',
      url: "/domain/" + data.urlid + "/block"
    };
    return api(options, callback);
  };

  Stumble.domain = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/domain',
      maxRetry: 0
    };
    return api(options, callback);
  };

  Stumble.following = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/following'
    };
    return api(options, callback);
  };

  Stumble.interest = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/interest'
    };
    return api(options, callback);
  };

  Stumble.keyword = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/keyword'
    };
    return api(options, callback);
  };

  Stumble.list = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/list'
    };
    return api(options, callback);
  };

  Stumble.news = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/news'
    };
    return api(options, callback);
  };

  Stumble.photo = function(data, callback) {
    var options;
    data.interests = ["302"];
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/interest'
    };
    return api(options, callback);
  };

  Stumble.related = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/related_url'
    };
    return api(options, callback);
  };

  Stumble.setRating = function(data, callback) {
    var options;
    if (data.type === 0) {
      return Stumble.unrate.apply(Stumble, arguments);
    } else {
      options = {
        type: 'POST',
        url: "/discovery/rating",
        data: data || {}
      };
      return api(options, callback);
    }
  };

  Stumble.setRatingOneTime = function(data, callback) {
    var options;
    if (data.type === 0) {
      return Stumble.unrate.apply(Stumble, arguments);
    } else {
      options = {
        type: 'POST',
        url: "/discovery/rating",
        data: data || {},
        noretry: true
      };
      return api(options, callback);
    }
  };

  Stumble.trending = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/trending'
    };
    return api(options, callback);
  };

  Stumble.unblockDomain = function(data, callback) {
    var options;
    options = {
      type: 'POST',
      url: "/domain/" + data.urlid + "/unblock"
    };
    return api(options, callback);
  };

  Stumble.unrate = function(data, callback) {
    var options;
    options = {
      type: 'DELETE',
      url: "/discovery/" + data.urlid + "/rating"
    };
    return api(options, callback);
  };

  Stumble.urlid = function(data, callback) {
    var options;
    if (data == null) {
      data = {};
    }
    options = {
      data: data,
      type: 'GET',
      url: '/url'
    };
    return api(options, callback);
  };

  Stumble.user = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/user'
    };
    return api(options, callback);
  };

  Stumble.video = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/stumble/video'
    };
    return api(options, callback);
  };

  return Stumble;

})();


},{"./api":133}],150:[function(require,module,exports){
var Submit, api;

api = require('./api');

module.exports = Submit = (function() {
  function Submit() {}

  Submit.submit = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      url: '/submit'
    };
    return api(options, callback);
  };

  return Submit;

})();


},{"./api":133}],151:[function(require,module,exports){
var Url, api;

api = require('./api');

module.exports = Url = (function() {
  function Url() {}

  Url.getInfo = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: '/url'
    };
    return api(options, callback);
  };

  Url.getLikers = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/url/" + data.urlid + "/newLikers"
    };
    return api(options, callback);
  };

  Url.getThumb = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/url/thumb"
    };
    return api(options, callback);
  };

  Url.getUrls = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/url/urls"
    };
    return api(options, callback);
  };

  Url.addThumb = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      url: "/url/thumb"
    };
    return api(options, callback);
  };

  Url.setInterests = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/url/interest'
    };
    return api(options, callback);
  };

  Url.getSuggestedInterests = function(data, callback) {
    var options, url;
    url = "/classification";
    if (data != null ? data.urlid : void 0) {
      url = "/classification/" + data.urlid;
    }
    options = {
      data: data || {},
      type: 'GET',
      url: url
    };
    return api(options, callback);
  };

  Url.classify = function(data, callback) {
    var options, url;
    url = "/classification/" + data.urlid + "/doClassification";
    data['user-tags'] = data['user-tags'] || [];
    options = {
      data: data || {},
      type: 'POST',
      url: url,
      noretry: true
    };
    return api(options, callback);
  };

  Url.submit = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/submit'
    };
    return api(options, callback);
  };

  Url.submitOneTime = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/submit',
      noretry: true
    };
    return api(options, callback);
  };

  Url.requeue = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/url/requeue',
      noretry: true
    };
    return api(options, callback);
  };

  return Url;

})();


},{"./api":133}],152:[function(require,module,exports){
var User, api, globalConfig, mediator, storage, utils,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

api = require('./api');

storage = require('simple-storage');

globalConfig = require('../../config');

utils = require('../utils');

mediator = require('chaplin').mediator;

module.exports = User = (function() {
  function User() {
    this.login = __bind(this.login, this);
    this.twitterUnlink = __bind(this.twitterUnlink, this);
    this.twitterConnectionRequestCallback = __bind(this.twitterConnectionRequestCallback, this);
    this.twitterConnectionRequest = __bind(this.twitterConnectionRequest, this);
    this.googleUnlink = __bind(this.googleUnlink, this);
    this.googleLink = __bind(this.googleLink, this);
    this.googleConnect = __bind(this.googleConnect, this);
    this.fbLink = __bind(this.fbLink, this);
    this.fbUnlink = __bind(this.fbUnlink, this);
    this.fbConnect = __bind(this.fbConnect, this);
    this.create = __bind(this.create, this);
  }

  User.prototype.create = function(data, callback) {
    var options;
    if (api && api.headers) {
      delete api.headers['X-Su-AccessTokenKey'];
    }
    options = {
      data: data || {},
      type: 'POST',
      url: '/signup',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.fbConnect = function(data, callback) {
    var options;
    if (api && api.headers) {
      delete api.headers['X-Su-AccessTokenKey'];
    }
    options = {
      data: data || {},
      type: 'POST',
      url: '/fb/login',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.fbSignup = function(data, callback) {
    return utils.redirectToTransitionStatic();
  };

  User.prototype.fbUnlink = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/fb/unlink',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.fbLink = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/fb/link',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.googleConnect = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/google/login',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.googleSignup = function(data, callback) {
    return utils.redirectToTransitionStatic();
  };

  User.prototype.googleLink = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/google/link',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.googleUnlink = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/google/unlink',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.twitterConnectionRequest = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: '/twitter/connectionRequest',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.twitterConnectionRequestCallback = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: '/twitter/connectionRequestCallback',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.twitterUnlink = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/twitter/unlink',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.follow = function(data, callback) {
    var options;
    options = {
      type: 'POST',
      url: "/connection/follow/" + data.userid
    };
    return api(options, callback);
  };

  User.prototype.followList = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'POST',
      url: "/user/" + data.userid + "/lists/following/" + data.listId
    };
    return api(options, callback);
  };

  User.prototype.mutualFollow = function(data, callback) {
    var options;
    data = data || {};
    data.filter_spam = true;
    options = {
      data: data,
      type: 'GET',
      url: "/connection/" + data.userid + "/mutual"
    };
    return api(options, callback);
  };

  User.prototype.followers = function(data, callback) {
    var options;
    data = data || {};
    data.filter_spam = true;
    options = {
      data: data,
      type: 'GET',
      url: "/connection/" + data.userid + "/followers"
    };
    return api(options, callback);
  };

  User.prototype.following = function(data, callback) {
    var options;
    data = data || {};
    data.filter_spam = true;
    options = {
      data: data,
      type: 'GET',
      url: "/connection/" + data.userid + "/following"
    };
    return api(options, callback);
  };

  User.prototype.get = function(data, callback) {
    var fingerprint, options, _ref, _ref1;
    if (!data) {
      data = {};
      data.id = '';
    }
    fingerprint = ((_ref = window._errs) != null ? (_ref1 = _ref.meta) != null ? _ref1.li_fingerprint : void 0 : void 0) || '';
    options = {
      type: 'GET',
      url: "/user/" + data.id + "?version=2&f=" + fingerprint,
      maxRetry: 0
    };
    return api(options, callback);
  };

  User.prototype.getJwt = function(data, callback, failCallback) {
    var host, options, url;
    if (utils.isDev()) {
      host = globalConfig.localDev.conversationHost;
      url = globalConfig.localDev.conversationJwtPath;
    } else {
      host = globalConfig.conversationHost;
      url = globalConfig.conversationJwtPath;
    }
    options = {
      data: data,
      type: 'GET',
      path: host,
      url: url,
      xhrFields: {
        withCredentials: false
      },
      maxRetry: 0,
      preventDisableSpa: true
    };
    return api(options, callback, failCallback);
  };

  User.prototype.getAccessToken = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/reflecttoken"
    };
    return api(options, callback);
  };

  User.prototype.getLists = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/user/" + data.userid + "/lists"
    };
    return api(options, callback);
  };

  User.prototype.getListsCreated = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/user/" + data.userid + "/lists/created"
    };
    return api(options, callback);
  };

  User.prototype.getListsFollowing = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/user/" + data.userid + "/lists/following"
    };
    return api(options, callback);
  };

  User.prototype.getUsers = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: "/user/0/users"
    };
    return api(options, callback);
  };

  User.prototype.getInterests = function(data, callback) {
    var options, url;
    if (data != null ? data.allInterests : void 0) {
      url = "/interests";
      delete data.allInterests;
    } else {
      url = "/user/" + (data != null ? data.userid : void 0) + "/interests";
    }
    options = {
      data: data || {},
      type: 'GET',
      url: url
    };
    return api(options, callback);
  };

  User.prototype.login = function(data, callback) {
    var options;
    storage.set('key', null);
    options = {
      data: data || {},
      type: 'POST',
      url: '/auth/login',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.passwordResetRequest = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/auth/resetpassword',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.passwordResetConfirm = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/auth/resetpassword/confirm',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.requestToken = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      url: '/auth/requesttoken'
    };
    return api(options, callback);
  };

  User.prototype.searchLists = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'GET',
      url: "/user/" + data.userid + "/lists/search"
    };
    return api(options, callback);
  };

  User.prototype.setInterests = function(data, callback) {
    var options, userid;
    userid = data.userid;
    delete data.userid;
    options = {
      data: data || {},
      type: 'POST',
      url: "/user/" + userid + "/interests"
    };
    return api(options, callback);
  };

  User.prototype.setPhoto = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: "/user/" + data.userid + "/photo"
    };
    return api(options, callback);
  };

  User.prototype.suggestUsername = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/signup/suggestusername'
    };
    return api(options, callback);
  };

  User.prototype.unfollow = function(data, callback) {
    var options;
    options = {
      type: 'POST',
      url: "/connection/unfollow/" + data.userid
    };
    return api(options, callback);
  };

  User.prototype.unfollowList = function(data, callback) {
    var options;
    options = {
      data: data,
      type: 'DELETE',
      url: "/user/" + data.userid + "/lists/following/" + data.listId
    };
    return api(options, callback);
  };

  User.prototype.validateEmail = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/signup/validateemail',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.validateUsername = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      url: '/signup/validateusername',
      noretry: true
    };
    return api(options, callback);
  };

  User.prototype.verifyEmail = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      noretry: true,
      url: "/user/setVerifiedEmail"
    };
    return api(options, callback);
  };

  User.prototype.onboardingTutorial = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'POST',
      noretry: true,
      url: "/user/" + data.userid + "/onboardingtutorial"
    };
    return api(options, callback);
  };

  User.prototype.suggestedStumblers = function(data, callback) {
    var options;
    options = {
      data: data || {},
      type: 'GET',
      noretry: true,
      url: "/topStumblers"
    };
    return api(options, callback);
  };

  User.prototype.getLikesForInterest = function(data, callback) {
    var options, url;
    url = "/user/" + (data != null ? data.userid : void 0) + "/interest/" + (data != null ? data.interestid : void 0) + "/likes";
    options = {
      data: data || {},
      type: 'GET',
      noretry: true,
      url: url
    };
    return api(options, callback);
  };

  User.prototype.getLikesForTag = function(data, callback) {
    var options, url;
    url = "/user/" + (data != null ? data.userid : void 0) + "/tag/" + (data != null ? data.tagid : void 0) + "/likes";
    options = {
      data: data || {},
      type: 'GET',
      noretry: true,
      url: url
    };
    return api(options, callback);
  };

  User.prototype.reportSignupPageLoad = function(data, callback) {
    var options, url;
    url = "/signup/pageload";
    options = {
      data: data || {},
      type: 'GET',
      noretry: true,
      url: url
    };
    return api(options, callback);
  };

  User.prototype.reportInterestsPageLoad = function(data, callback) {
    var options, url;
    url = "/interests/pageload";
    options = {
      data: data || {},
      type: 'GET',
      noretry: true,
      url: url
    };
    return api(options, callback);
  };

  User.prototype.reportStumblePageLoad = function(data, callback) {
    var options, url;
    url = "/stumble/pageload";
    options = {
      data: data || {},
      type: 'GET',
      noretry: true,
      url: url
    };
    return api(options, callback);
  };

  return User;

})();


},{"../../config":2,"../utils":156,"./api":133,"chaplin":773,"simple-storage":780}],153:[function(require,module,exports){
var StumbleUpon;

StumbleUpon = require('./stumbleupon');

module.exports = new StumbleUpon();


},{"./stumbleupon":131}],154:[function(require,module,exports){
var Chaplin, support, utils;

Chaplin = require('chaplin');

utils = require('./utils');

support = utils.beget(Chaplin.support);

module.exports = support;


},{"./utils":156,"chaplin":773}],155:[function(require,module,exports){
var ProfileListsCollection, mediator;

mediator = require('chaplin').mediator;

ProfileListsCollection = require('../models/profile-lists-collection');

module.exports = {
  getCurrentUserLists: function(reset) {
    var listsC, options, userM;
    if (reset == null) {
      reset = false;
    }
    userM = mediator.userM;
    listsC = userM.get('_listsC');
    if ((!listsC) || reset) {
      listsC = new ProfileListsCollection;
      userM.set({
        '_listsC': listsC
      });
      options = {};
      options.data = {
        userid: mediator.userM.get('userid')
      };
      listsC.fetch(options).then(function() {
        return listsC.add({
          '_queued': false,
          '_sortOrder': 1,
          'name': 'Likes',
          'id': 'likes'
        });
      });
    }
    return listsC;
  }
};


},{"../models/profile-lists-collection":219,"chaplin":773}],156:[function(require,module,exports){
var $, Chaplin, JsSHA, SUdebug, config, mediator, moment, root, seedSalt, storage, utils, _;

$ = require('jquery');

_ = require('lodash');

Chaplin = require('chaplin');

mediator = require('chaplin').mediator;

config = require('../config');

root = require('../lib/root');

SUdebug = require('../su-debug');

moment = require('moment');

storage = require('simple-storage');

JsSHA = require('jssha');

utils = Chaplin.utils.beget(Chaplin.utils);

seedSalt = {};

utils.randomSeed = function(seed) {
  var m_w, m_z, mask, random;
  m_w = 123456789;
  m_z = 987654321;
  mask = 0xffffffff;
  seed = seed || "";
  if (!seedSalt[seed]) {
    seedSalt[seed] = {
      v1: Math.random() * 100,
      v2: Math.random() * 100,
      v3: Math.random() * 100,
      v4: Math.random() * 100,
      v5: Math.random() * 100
    };
  }
  m_w = seedSalt[seed].v1;
  return random = function() {
    var result;
    m_z = (seedSalt[seed].v2 * (m_z & seedSalt[seed].v4) + (m_z >> 16)) & mask;
    m_w = (seedSalt[seed].v3 * (m_w & seedSalt[seed].v4) + (m_w >> 16)) & mask;
    result = ((m_z << 16) + m_w) & mask;
    result /= seedSalt[seed].v5;
    return Math.abs(result + 0.5);
  };
};

utils.queryParams.parse = function(queryString) {
  var current, e, field, pair, pairs, params, value, _i, _len, _ref;
  params = {};
  if (!queryString) {
    return params;
  }
  queryString = queryString.slice(queryString.indexOf('?') + 1);
  pairs = queryString.split('&');
  for (_i = 0, _len = pairs.length; _i < _len; _i++) {
    pair = pairs[_i];
    if (!pair.length) {
      continue;
    }
    _ref = pair.split('='), field = _ref[0], value = _ref[1];
    if (!field.length) {
      continue;
    }
    try {
      field = decodeURIComponent(field);
      value = decodeURIComponent(value);
    } catch (_error) {
      e = _error;
      field = null;
      value = null;
    }
    if (!!field) {
      current = params[field];
    }
    if (current) {
      if (current.push) {
        current.push(value);
      } else {
        params[field] = [current, value];
      }
    } else if (field) {
      params[field] = value;
    }
  }
  return params;
};

_(utils).extend({
  DAY_IN_MILLISECONDS: 1000 * 60 * 60 * 24,
  secondsSincePageStart: function() {
    var finishTime;
    finishTime = new Date();
    return (finishTime.getTime() - window.SUstartTime.getTime()) / 1000;
  },
  getCurrentQueryParamValue: function(key) {
    var queryParams;
    queryParams = utils.queryParams.parse(window.location.search);
    return queryParams[key];
  },
  initialParams: utils.queryParams.parse(window.location.search),
  isAndroid: function() {
    var match;
    match = root().navigator.userAgent.match('Android');
    if (match != null) {
      return true;
    } else {
      return false;
    }
  },
  isiOS: function() {
    var match;
    match = root().navigator.userAgent.match('iPad|iPhone|iPod');
    if (match != null) {
      return true;
    } else {
      return false;
    }
  },
  isIpad: function() {
    var match;
    match = root().navigator.userAgent.match('iPad');
    if (match != null) {
      return true;
    } else {
      return false;
    }
  },
  getiOSversion: function() {
    var v;
    if (utils.isiOS()) {
      v = navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);
      return [parseInt(v[1], 10), parseInt(v[2], 10), parseInt(v[3] || 0, 10)];
    }
  },

  /**
  * Method to select the correct link for app installs -- see https://docs.google.com/a/stumbleupon.com/spreadsheets/d/1pL4Pcg_Dl6CYIGBL6k0A7p7LKJC_k-qpek7aa7tTpEk/edit#gid=242129171
  * @param {string} The mobile platform ('ios' or 'android') that is to be installed
  * @param {string} The entry point ('vtb' or 'splash') where the link is being surfaced
  * @return {string} The appropriate link
   */
  getMobileDownloadLink: function(targetPlatfom, entryPoint) {
    var pre, requestingDevice;
    requestingDevice = this.isMobile() ? 'mobile' : 'desktop';
    pre = (this.initialParams.pre || 'default') + '.' + requestingDevice + '.' + targetPlatfom + '.' + entryPoint;
    switch (pre) {
      case 'default.mobile.ios.vtb':
        return "https://app.adjust.com/tj6ui0?campaign=organic_banner";
      case 'default.mobile.ios.splash':
        return "https://app.adjust.com/tj6ui0?campaign=organic_splash";
      case 'default.mobile.android.vtb':
        return "https://app.adjust.com/bdwiqo?campaign=organic_banner";
      case 'default.mobile.android.splash':
        return "https://app.adjust.com/bdwiqo?campaign=organic_splash";
      case 'default.desktop.ios.vtb':
        return "https://app.adjust.com/knizob?campaign=organic";
      case 'default.desktop.ios.splash':
        throw new Error("mobile splash not supported on desktop");
        break;
      case 'default.desktop.android.vtb':
        return "https://app.adjust.com/33ldak?campaign=organic";
      case 'default.desktop.android.splash':
        throw new Error("mobile splash not supported on desktop");
        break;
      case 'default.mobile.ios.convo':
        return "https://app.adjust.com/t2mzg9?redirect=https%3A%2F%2Fitunes.apple.com%2Fapp%2Fapple-store%2Fid386244833%3Fpt%3D332887%26ct%3DMobile%2520Web%2520Convo%2520Chat%2520Banner%26mt%3D8/";
      case 'default.mobile.android.convo':
        return "https://app.adjust.com/kcbe1w";
      case 'paid.mobile.ios.vtb':
        return 'https://app.adjust.com/tj6ui0?campaign=paid_banner';
      case 'paid.mobile.ios.splash':
        return 'https://app.adjust.com/tj6ui0?campaign=paid_splash';
      case 'paid.mobile.android.vtb':
        return 'https://app.adjust.com/bdwiqo?campaign=paid_banner';
      case 'paid.mobile.android.splash':
        return 'https://app.adjust.com/bdwiqo?campaign=paid_splash';
      case 'paid.desktop.ios.vtb':
        return 'https://app.adjust.com/knizob?campaign=paid';
      case 'paid.desktop.ios.splash':
        throw new Error("mobile splash not supported on desktop");
        break;
      case 'paid.desktop.android.vtb':
        return 'https://app.adjust.com/33ldak?campaign=paid';
      case 'paid.desktop.android.splash':
        throw new Error("mobile splash not supported on desktop");
        break;
      case 'trade.mobile.ios.vtb':
        return 'https://app.adjust.com/tj6ui0?campaign=partner_trade';
      case 'trade.mobile.ios.splash':
        return 'https://app.adjust.com/tj6ui0?campaign=partner_trade';
      case 'trade.mobile.android.vtb':
        return 'https://app.adjust.com/bdwiqo?campaign=partner_trade';
      case 'trade.mobile.android.splash':
        return 'https://app.adjust.com/bdwiqo?campaign=partner_trade';
      case 'trade.desktop.ios.vtb':
        return 'https://app.adjust.com/knizob?campaign=partner_trade';
      case 'trade.desktop.ios.splash':
        throw new Error("mobile splash not supported on desktop");
        break;
      case 'trade.desktop.android.vtb':
        return 'https://app.adjust.com/33ldak?campaign=partner_trade';
      case 'trade.desktop.android.splash':
        throw new Error("mobile splash not supported on desktop");
        break;
      case 'default.mobile.android.footer':
        return "https://app.adjust.com/bdwiqo?campaign=organic_banner";
      case 'default.mobile.ios.footer':
        return "https://app.adjust.com/tj6ui0?campaign=organic_banner?redirect=https%3A%2F%2Fitunes.apple.com%2Fapp%2Fapple-store%2Fid386244833%3Fpt%3D332887%26ct%3DMobile%2520Web%2520Bikini%2520Banner%26mt%3D8";
      default:
        throw new Error("link not found for " + pre);
    }
  },
  isMobile: function() {
    return this.isiOS() || this.isAndroid();
  },
  getAppStoreLink: function() {
    if (this.isiOS()) {
      return utils.getMobileDownloadLink("ios", "splash");
    } else if (this.isAndroid()) {
      return utils.getMobileDownloadLink("android", "splash");
    }
  },
  getAppLink: function(urlid) {
    var path;
    path = urlid != null ? "urlid/" + urlid : "home";
    if (this.isiOS()) {
      return "stumbleupon://" + path;
    } else if (this.isAndroid()) {
      return "intent://" + path + "/#Intent;scheme=stumbleupon;package=com.stumbleupon.android.app;end";
    }
  },
  isOldSafari: function() {
    var _ref;
    return window.navigator.userAgent.match('Version/5') && ((_ref = window.navigator.vendor) != null ? _ref.match('Apple') : void 0);
  },
  canHandleDeeplink: function() {
    return this.isAndroid() && (this.isChrome() || this.isFirefox() || this.isOpera());
  },
  isChrome: function() {
    return window.navigator.userAgent.toLowerCase().indexOf('chrome') > -1;
  },
  isFirefox: function() {
    return window.navigator.userAgent.toLowerCase().indexOf('firefox') > -1;
  },
  isOpera: function() {
    return window.navigator.userAgent.toLowerCase().indexOf('opera') > -1;
  },
  isEmail: function(str) {
    var pattern;
    pattern = new RegExp('[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})', 'i');
    return pattern.test(str);
  },
  getParticipantId: function() {
    var _ref;
    return (_ref = mediator.participantM) != null ? _ref.get('id') : void 0;
  },
  getLoggedInUserId: function() {
    var _ref;
    return (_ref = mediator.userM) != null ? _ref.get('userid') : void 0;
  },
  isLoggedIn: function() {
    var _ref;
    return (_ref = mediator.userM) != null ? _ref.has('userid') : void 0;
  },
  isRecognizedVisitor: function() {
    return !$.cookie('su_accesstoken' && $.cookie('userid'));
  },
  getRecognizedVisitorUserid: function() {
    return $.cookie('userid');
  },
  isVisitor: function() {
    return !$.cookie('su_accesstoken');
  },
  getFacebookAppId: function() {
    if (this.isDev()) {
      return config.localDev.fbAppId;
    } else {
      return config.fbAppId;
    }
  },
  facebookInitialize: function() {
    window.fbAsyncInit = function() {
      FB.init({
        appId: utils.getFacebookAppId(),
        xfbml: true,
        version: 'v2.8'
      });
    };
    return (function(d, s, id) {
      var fjs, js;
      js = void 0;
      fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {
        return;
      }
      js = d.createElement(s);
      js.id = id;
      js.src = '//connect.facebook.net/en_US/sdk.js';
      fjs.parentNode.insertBefore(js, fjs);
    })(document, 'script', 'facebook-jssdk');
  },
  getGoogleConfigs: function() {
    var result;
    result = {};
    if (this.isDev()) {
      return result = {
        clientId: config.localDev.googleClientId,
        apiKey: config.localDev.googleApiKey,
        scopes: config.googleScopes
      };
    } else {
      return result = {
        clientId: config.googleClientId,
        apiKey: config.googleApiKey,
        scopes: config.googleScopes
      };
    }
  },
  googleInitialize: function(callback) {
    var meta, s, scriptElement;
    scriptElement = "google-plus-api";
    window['onGoogleInitializeCallback'] = callback;
    if (document.getElementById(scriptElement) == null) {
      s = document.createElement('script');
      s.id = scriptElement;
      s.async = true;
      s.defer = true;
      s.src = "https://plus.google.com/js/client:platform.js?onload=onGoogleInitializeCallback";
      meta = document.createElement("meta");
      meta.name = "google-signin-client_id";
      meta.content = utils.getGoogleConfigs().clientId;
      document.head.appendChild(meta);
      return document.head.appendChild(s);
    }
  },
  recaptchInitialize: function(callback) {
    var e;
    window['onRecaptchaLoadCallback'] = callback;
    e = document.createElement("script");
    e.type = "text/javascript";
    e.async = true;
    e.defer = true;
    e.src = "https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoadCallback&render=explicit";
    return document.head.appendChild(e);
  },
  isConversationVisitor: false,
  setAsConversationVisitor: function(isVisitor) {
    return this.isConversationVisitor = isVisitor;
  },
  isVisitorConversation: function() {
    return this.isConversationVisitor;
  },
  scrollToTop: function() {
    if (document.body.scrollTop > 0) {
      return root().scrollTo(0, 0);
    }
  },
  isCurrentOrChildElement: function(parentElement, childElement) {
    var current, _ref, _ref1, _ref2;
    current = childElement;
    while (current) {
      if (((_ref = current.attributes) != null ? (_ref1 = _ref['id']) != null ? _ref1.value : void 0 : void 0) === ((_ref2 = parentElement.attributes['id']) != null ? _ref2.value : void 0)) {
        return true;
      }
      current = current.parentNode;
    }
    return false;
  },
  onContentLoaded: function() {
    $('body').addClass('loaded');
    return $('.spinner-idx').remove();
  },
  isImage: function(str) {
    var ext, imgExts;
    imgExts = ['jpg', 'jpeg', 'png', 'gif', 'bmp'];
    ext = this.removeParams(str).split('.').pop();
    ext = ext.toLowerCase();
    return _(imgExts).contains(ext);
  },
  isToolbarEnabled: function() {
    if (root().location.href.match('_notoolbar')) {
      return false;
    } else {
      return true;
    }
  },
  gotoUrl: function(url) {
    return root().location.assign(url);
  },
  stripHtml: function(string) {
    if (string == null) {
      string = "";
    }
    return string.replace(/<(?:.|\n)*?>/gm, '');
  },
  stripProtocol: function(url) {
    return url.split('http://').pop().split('https://').pop();
  },
  stripBase64: function(string) {
    return string.substr(string.indexOf("base64,") + "base64,".length);
  },
  getDomain: function(url) {
    var match;
    if (typeof url !== 'string') {
      throw new TypeError('Must pass a string');
    }
    if (url.indexOf('www') === 0) {
      match = url.split('www.');
    } else {
      match = url.match(/\/([^\/]+)\/?/)[1].split("www.");
    }
    if (match) {
      return _(match).last();
    }
  },
  getSoundcloudPath: function(url) {
    var parts, path;
    if (url.match('soundcloud.com')) {
      parts = url.split('soundcloud.com');
      if (parts.length > 0) {
        path = parts[1];
      }
      return path = encodeURIComponent(path);
    }
  },
  getYoutubeId: function(url) {
    var match;
    if (url.match('youtube.com/')) {
      match = url.match(/^.*(youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);
      if ((match != null ? match.length : void 0) === 3) {
        return match[2];
      }
    }
  },
  getMetacafeId: function(url) {
    if (url.match('metacafe.com/watch/')) {
      return url.split('/watch/').pop().split('/').shift().split('?').shift();
    }
  },
  getPinterestId: function(url) {
    if (url.match('pinterest.com/pin/')) {
      return url.split('pin/').pop().split('/').shift().split('?').shift();
    }
  },
  getFacebookPost: function(url) {
    if (url.match('facebook.com/')) {
      return url;
    }
  },
  getVineId: function(url) {
    if (url.match('vine.co/v/')) {
      return url.split('/v/').pop().split('/').shift();
    }
  },
  getPinterestBoardId: function(url) {
    if (url.match('pinterest.com') && !this.getPinterestId(url)) {
      return url.split('pinterest.com/').pop();
    }
  },
  getDailymotionId: function(url) {
    if (url.match('dailymotion.com/video/')) {
      return url.split('/video/').pop().split('_').shift();
    }
  },
  getVimeoId: function(url) {
    if (url.match('vimeo.com/')) {
      return url.split('vimeo.com/').pop().split('/').shift().split('?').shift();
    }
  },
  getTweetId: function(url) {
    if (url.match('twitter.com/')) {
      return url.split('/status/').pop().split('/').shift();
    }
  },
  getFlickrUsername: function(url) {
    var details;
    details = this.getFlickrDetails(url);
    if (details) {
      return details.username;
    }
  },
  getFlickrId: function(url) {
    var details;
    details = this.getFlickrDetails(url);
    if (details) {
      return details.photoid;
    }
  },
  getFlickrDetails: function(url) {
    var flickr;
    if (url.indexOf('flickr.com/photos/') !== -1) {
      flickr = url.match('flickr.com/photos/([a-zA-Z0-9@]*)/([0-9]*)');
      if ((flickr != null ? flickr.length : void 0) === 3 && !!flickr[1] && !!flickr[2]) {
        return {
          username: flickr[1],
          photoid: flickr[2]
        };
      }
    }
  },
  getInstagramId: function(url) {
    var insta;
    if (url.indexOf('instagram.com/p/') !== -1) {
      insta = url.match('instagram.com/p/([a-zA-Z0-9_@]*)');
      return insta[1];
    }
  },
  getReflectToken: function() {
    var endpoint, expiresIn;
    endpoint = '/auth/reflecttoken';
    expiresIn = moment().add(10, 'years').toDate();
    return $.ajax({
      url: config.localDev.protocol + '//' + config.localDev.host + config.prefix + endpoint,
      xhrFields: {
        withCredentials: true
      }
    }).then(function(resp) {
      if (resp != null ? resp.token : void 0) {
        return $.cookie('su_accesstoken', resp.token, {
          expires: expiresIn
        });
      } else {
        return $.removeCookie('su_accesstoken');
      }
    }, function(e) {
      return console.warn('Unable to get logged in user access token (ignore as visitor)', e);
    });
  },
  getTedTalkId: function(url) {
    var ted;
    if (url.indexOf('www.ted.com/talks/') !== -1) {
      ted = url.match('www.ted.com/talks/([a-zA-Z0-9_@]*)');
      return ted[1];
    }
  },
  appendParams: function(url, params) {
    var prefix;
    prefix = url.match('\\?') ? '&' : '?';
    return url + prefix + $.param(params);
  },
  removeForceSpa: function(string) {
    string = string.replace(/_forcespa=[^&]*&{0,1}/, '');
    return string.replace(/\?$/, '');
  },
  removeParams: function(url) {
    return url.split('?').shift();
  },
  isLocalDev: function() {
    if (this.isRemoteDev() || this.isProd()) {
      return false;
    } else {
      return true;
    }
  },
  isRemoteDev: function() {
    return (root().location.hostname.match('stumble.net')) && (!root().location.hostname.match('local.stumble.net'));
  },
  isDev: function() {
    return this.isLocalDev() || this.isRemoteDev();
  },
  isProd: function() {
    var hostname;
    hostname = root().location.hostname;
    if (hostname.slice(-16) === '.stumbleupon.com' || hostname === 'stumbleupon.com') {
      return true;
    } else {
      return false;
    }
  },
  isSuteamSession: function() {
    return $.cookie('suteam') === "true";
  },
  getApiBaseUrl: function() {
    var host, protocol;
    if (this.isLocalDev()) {
      host = config.localDev.host;
      protocol = config.localDev.protocol;
    } else if (this.isProd()) {
      host = config.host;
      protocol = config.protocol;
    } else if (this.isRemoteDev()) {
      host = window.location.hostname;
      protocol = 'https:';
    } else {
      host = window.location.hostname;
      protocol = 'https:';
    }
    return protocol + '//' + host + config.prefix;
  },
  getApiUrl: function(endpoint) {
    return this.getApiBaseUrl() + '/' + endpoint;
  },
  generateUserColor: _.memoize(function(seed) {
    var color, diff, intNum, num;
    intNum = (1 << 24) * Math.random() | 0;
    intNum = Math.abs(intNum.toFixed(0));
    color = "#" + intNum.toString(16);
    if (color.length < 7) {
      diff = 7 - color.length;
      while (diff) {
        num = Math.floor(Math.random() * 16);
        color += num.toString(16);
        diff--;
      }
    }
    return color;
  }),
  ranges: [
    {
      divider: 1e18,
      suffix: 'P'
    }, {
      divider: 1e15,
      suffix: 'E'
    }, {
      divider: 1e12,
      suffix: 'T'
    }, {
      divider: 1e9,
      suffix: 'G'
    }, {
      divider: 1e6,
      suffix: 'M'
    }, {
      divider: 1e3,
      suffix: 'k'
    }
  ],
  numberFormat: function(value) {
    var i;
    if (typeof value === 'string') {
      value = parseInt(value);
    }
    i = 0;
    while (i < this.ranges.length) {
      if (value >= this.ranges[i].divider) {
        return (value / this.ranges[i].divider).toFixed(1) + this.ranges[i].suffix;
      }
      i++;
    }
    return value != null ? value.toString() : void 0;
  },
  getMedian: function(values) {
    var half;
    values.sort(function(a, b) {
      return a - b;
    });
    half = Math.floor(values.length / 2);
    if (values.length % 2) {
      return values[half];
    } else {
      return (values[half - 1] + values[half]) / 2.0;
    }
  },
  getStumbleUrl: function() {
    var host, protocol;
    if (this.isLocalDev()) {
      host = config.localDev.host;
      protocol = 'http:';
    } else {
      host = root().location.hostname;
      protocol = root().location.protocol;
    }
    return protocol + '//' + host;
  },
  convertDevToProdUrl: function(url) {
    var domain;
    domain = this.getDomain(url);
    if (this.isDev() && (domain !== "stumbleupon.com")) {
      url = url.replace(domain, "stumbleupon.com");
    }
    return url;
  },
  getToolbarView: function() {
    if (this.isVisitor() || this.isMobile()) {
      return require('../views/toolbar/visitor-toolbar-view');
    } else {
      return require('../views/toolbar/auth-toolbar-view');
    }
  },
  isOutOfStumbles: function(res, options) {
    var _ref, _ref1;
    if (options == null) {
      options = {};
    }
    if (_.isArray(options.guess_urlids) && options.guess_only === 1 && options.guesses === 0) {
      return false;
    } else {
      return !((!_.has(res, "url") && !_.has(res, "guesses")) || ((_.has(res, "url") || _.has(res, "guesses")) && (((res != null ? res.url : void 0) != null) || (res != null ? (_ref = res.guesses) != null ? (_ref1 = _ref.values) != null ? _ref1.length : void 0 : void 0 : void 0))));
    }
  },
  toMs: function(str) {
    var duration, hasUnit, unit;
    unit = typeof str.slice === "function" ? str.slice(-1) : void 0;
    duration = typeof str.slice === "function" ? str.slice(0, -1) : void 0;
    hasUnit = isNaN(parseInt(unit));
    if (typeof str === 'number' || !hasUnit) {
      return str;
    } else if (str.slice(-2) === 'ms') {
      return parseInt(str.slice(0, -2));
    } else {
      switch (unit) {
        case 's':
          return duration * 1000;
        case 'm':
          return duration * 60000;
        case 'h':
          return duration * 3600000;
        case 'd':
          return duration * 86400000;
        case 'w':
          return duration * 604800000;
        default:
          throw Error('Unknown unit ' + unit);
      }
    }
  },
  whenTruthy: function(key, obj, timeout, frequency) {
    var checking, dfd, giveUp;
    if (obj == null) {
      obj = mediator;
    }
    if (timeout == null) {
      timeout = '1m';
    }
    if (frequency == null) {
      frequency = '100ms';
    }
    dfd = new $.Deferred;
    if (obj[key]) {
      dfd.resolve(obj[key]);
    } else {
      giveUp = setTimeout(function() {
        clearInterval(checking);
        return dfd.reject(obj[key]);
      }, this.toMs(timeout));
      checking = setInterval(function() {
        if (obj[key]) {
          clearInterval(giveUp);
          clearInterval(checking);
          return dfd.resolve(obj[key]);
        }
      }, this.toMs(frequency));
    }
    return dfd.promise();
  },
  unix: function() {
    return Math.floor(_.now() / 1000);
  },
  setSuAccessToken: function(token) {
    var expiresIn;
    expiresIn = moment().add(10, 'years').toDate();
    if (root().location.hostname.match(config.localDev.SPAHost)) {
      $.cookie('su_accesstoken', token, {
        domain: config.localDev.SPADomain,
        expires: expiresIn
      });
    } else {
      $.cookie('su_accesstoken', token, {
        expires: expiresIn
      });
    }
    return storage.set('key', token);
  },
  setSURemember: function(SURemember) {
    var expiresIn;
    expiresIn = moment().add(10, 'years').toDate();
    if (root().location.hostname.match(config.localDev.SPAHost)) {
      return $.cookie('SU_REMEMBER', SURemember, {
        domain: config.localDev.SPADomain,
        expires: expiresIn
      });
    } else {
      return $.cookie('SU_REMEMBER', SURemember, {
        expires: expiresIn
      });
    }
  },
  setUserid: function(userid) {
    var expiresIn;
    expiresIn = moment().add(10, 'years').toDate();
    if (root().location.hostname.match(config.localDev.SPAHost)) {
      return $.cookie('userid', userid, {
        domain: config.localDev.SPADomain.replace(/^www/, ''),
        expires: expiresIn
      });
    } else {
      return $.cookie('userid', userid, {
        domain: document.location.hostname.replace(/^www/, ''),
        expires: expiresIn
      });
    }
  },
  clearCookies: function() {
    var domain;
    domain = config.host;
    if (root().location.hostname.match(config.localDev.SPAHost)) {
      domain = config.localDev.SPADomain;
    }
    return ['su_accesstoken', 'ssid', 'SU_REMEMBER', 'seulepage', 'ozspa', 'u', 'dismissed_tutorial'].forEach(function(name) {
      $.removeCookie(name);
      return $.removeCookie(name, {
        domain: domain
      });
    });
  },
  clearAllCookies: function() {
    var domain;
    domain = config.host;
    if (root().location.hostname.match(config.localDev.SPAHost)) {
      domain = config.localDev.SPADomain;
    }
    return Object.keys($.cookie()).forEach(function(key) {
      $.removeCookie(key);
      $.removeCookie(key, {
        domain: domain
      });
      $.removeCookie(key, {
        domain: 'stumbleupon.com'
      });
      $.removeCookie(key, {
        domain: '.stumbleupon.com'
      });
      $.removeCookie(key, {
        domain: 'www.stumbleupon.com'
      });
      return $.removeCookie(key, {
        domain: '.www.stumbleupon.com'
      });
    });
  },
  clearLegacyCookies: function() {
    var domain;
    domain = config.host;
    if (root().location.hostname.match(config.localDev.SPAHost)) {
      domain = config.localDev.SPADomain;
    }
    return Object.keys($.cookie()).forEach(function(key) {
      if ((key.slice(0, 3) === 'mp_') || (key.slice(0, 3) === 'ct_')) {
        $.removeCookie(key);
        $.removeCookie(key, {
          domain: domain
        });
        if ($.cookie(key) !== "") {
          return document.cookie = key + "=; ; path=/; ;";
        }
      }
    });
  },
  getDoubleDownToken: function() {
    return $.cookie('su_accesstoken');
  },
  isSUBrowserAddonEnabled: function() {
    return window.suExtensionApi != null;
  },
  redirectToAppStartFailed: function(params, options) {
    debugger;
    var _ref;
    if (typeof Chaplin.mediator.userM === "object") {
      if (typeof window.setErrorMeta === "function") {
        window.setErrorMeta('userM', JSON.stringify(Chaplin.mediator.userM));
      }
    }
    if (typeof Chaplin.mediator.currentRoute === "object") {
      if (typeof window.setErrorMeta === "function") {
        window.setErrorMeta('route', JSON.stringify(Chaplin.mediator.currentRoute));
      }
    }
    if ((_ref = window._errs) != null) {
      _ref.push(new Error("Redirecting to app-start-fail"));
    }
    params.source = encodeURIComponent(window.location.href);
    options.query = {
      source: encodeURIComponent(window.location.href)
    };
    return Chaplin.utils.redirectTo('errors/app-start#fail', params, options);
  },
  redirectToHome: function(params, options) {
    var context, url, _ref, _ref1;
    params.next = encodeURIComponent(window.location.href);
    url = encodeURIComponent(options.url || this.getCurrentQueryParamValue('url'));
    context = encodeURIComponent('https://mix.com/mixit?url=' + encodeURIComponent((options != null ? (_ref = options.query) != null ? _ref.url : void 0 : void 0) || this.getCurrentQueryParamValue('url')) + '&title=' + encodeURIComponent(options != null ? (_ref1 = options.query) != null ? _ref1.title : void 0 : void 0));
    params.context = context;
    options.query = {
      next: encodeURIComponent(window.location.href),
      context: context
    };
    options.replace = true;
    return Chaplin.utils.redirectTo('homepage#home', params, options);
  },
  redirectToSuggestPage: function() {
    var routeName, _ref;
    routeName = 'interests#suggestInterests';
    if (((_ref = mediator.currentRoute) != null ? _ref.name : void 0) !== routeName) {
      return Chaplin.utils.redirectTo(routeName);
    }
  },
  redirectToSignupInterest: function() {
    var routeName, _ref;
    routeName = 'interests#createMyInterests';
    if (((_ref = mediator.currentRoute) != null ? _ref.name : void 0) !== routeName) {
      return window.location.href = ("" + config.PROTOCOL_HTTP + "//") + window.location.host + "/signup/choose-interests";
    }
  },
  redirectToLogin: function() {
    var next, url;
    next = encodeURIComponent(window.location.href);
    if (utils.isDev()) {
      url = ("https://" + config.localDev.host + "/?next=") + next;
    } else {
      url = "https://www.stumbleupon.com/?next=" + next;
    }
    return window.location.href = url;
  },
  redirectToSuggestStumblers: function() {
    var url;
    if (utils.isLocalDev()) {
      url = "http://" + config.localDev.SPAHost + ":" + config.localDev.SPAPort + "/";
    } else if (utils.isRemoteDev()) {
      url = "http://" + config.localDev.host + "/";
    } else {
      url = "http://www.stumbleupon.com/";
    }
    return window.location.href = url + 'following/runout';
  },
  redirectToTransitionStatic: function() {
    return window.location.href = "https://" + document.location.host + "/transition";
  },
  isValidRedirectDomain: function(domain) {
    var isValid;
    isValid = false;
    if (domain === "stumbleupon.com" || (utils.isDev() && (domain.match(config.localDev.SPADomain) || domain.match('localhost')))) {
      return isValid = true;
    }
  },
  setSuggestPageCookie: function(val) {
    var expiresIn;
    expiresIn = moment().add(5, 'minute').toDate();
    return $.cookie('suggest-page', val, {
      expires: expiresIn
    });
  },
  noop: function() {
    return arguments;
  },
  hasNoSpa: function() {
    return window.location.href.match('_nospa');
  },
  getNoSpaUrl: function() {
    if (!this.hasNoSpa()) {
      return this.appendParams(window.location.href, {
        '_nospa': true
      });
    }
  },
  getNoToolbarUrl: function() {
    var href;
    href = window.location.href;
    if (!(href.match('_notoolbar') && href.match('_nospa'))) {
      return this.appendParams(href, {
        '_notoolbar': true,
        '_nospa': true
      });
    }
  },
  gotoNoToolbarUrl: function() {
    if (!(window.location.href.match('_notoolbar') && window.location.href.match('_nospa'))) {
      return window.location.replace(this.getNoToolbarUrl());
    }
  },
  canDisplayMobilePopup: function() {
    return this.isMobile();
  },
  replaceState: function(path) {
    if (path[0] !== '/') {
      path = "/" + path;
    }
    return root().history.replaceState({
      path: path
    }, null, path);
  },
  verticalPush: function($el, height) {
    var translate;
    if (utils.isMobile()) {
      if (height == null) {
        height = $(document).height();
      }
      translate = "translate3d(0," + height + "px, 0)";
      return $el != null ? $el.css('transform', translate) : void 0;
    }
  },
  getDiff: function(base, updated) {
    var diff;
    diff = {};
    $.each(updated, function(key, value) {
      if (base.hasOwnProperty(key)) {
        if (updated[key] !== base[key]) {
          return diff[key] = updated[key];
        }
      }
    });
    return diff;
  },
  logLevels: {
    EMERGENCY: 0,
    ALERT: 1,
    CRITICAL: 2,
    ERROR: 3,
    WARNING: 4,
    NOTICE: 5,
    INFORMATIONAL: 6,
    DEBUG: 7,
    TRACE: 8
  },
  consoleLog: function(logLevel, logs) {
    var configuredLogLevel;
    configuredLogLevel = config.logLevel;
    if (this.isDev()) {
      configuredLogLevel = config.localDev.logLevel;
    }
    if (this.isProd() && this.isSuteamSession()) {
      configuredLogLevel = config.suteamProd.logLevel;
    }
    if (configuredLogLevel >= logLevel) {
      if (logLevel <= this.logLevels.ERROR) {
        return typeof console !== "undefined" && console !== null ? console.error.apply(console, logs) : void 0;
      } else if (logLevel === this.logLevels.WARNING) {
        return typeof console !== "undefined" && console !== null ? console.warn.apply(console, logs) : void 0;
      } else if (logLevel === this.logLevels.INFORMATIONAL) {
        return typeof console !== "undefined" && console !== null ? console.info.apply(console, logs) : void 0;
      } else if (logLevel === this.logLevels.NOTICE) {
        return typeof console !== "undefined" && console !== null ? console.log.apply(console, logs) : void 0;
      } else if (logLevel === this.logLevels.DEBUG) {
        return typeof console !== "undefined" && console !== null ? console.debug.apply(console, logs) : void 0;
      } else if (logLevel === this.logLevels.TRACE) {
        return typeof console !== "undefined" && console !== null ? console.trace.apply(console, logs) : void 0;
      }
    }
  },
  log: function(logLevel, logs) {
    return this.consoleLog(logLevel, [].slice.call(arguments, 1));
  },
  logDebug: function(logs) {
    return this.log(this.logLevels.DEBUG, logs);
  },
  logTrace: function(logs) {
    return this.log(this.logLevels.TRACE, logs);
  },
  logWarning: function(logs) {
    return this.log(this.logLevels.WARNING, logs);
  },
  logError: function() {
    return this.log(this.logLevels.ERROR, arguments);

    /** a cheap way to cache collection results from the controller */
  },
  getCachedCollection: function(cacheKey, cacheExpirationMilliseconds, CollectionConstructor, collectionConstructorOptions, expireWithUser) {
    var cache, cachedCollection, collection, dfd, empty, expiration, expired, now;
    if (collectionConstructorOptions == null) {
      collectionConstructorOptions = {};
    }
    if (expireWithUser == null) {
      expireWithUser = false;
    }
    cache = storage.get('spa-cache') || {};
    dfd = new $.Deferred;
    cachedCollection = cache[cacheKey];
    now = new Date().getTime();
    expiration = (cachedCollection != null ? cachedCollection._expires : void 0) || 0;
    expired = now > expiration;
    empty = _(cachedCollection != null ? cachedCollection.models : void 0).size() === 0;
    if (expired || empty) {
      cache[cacheKey] = null;
      collection = new CollectionConstructor(null, collectionConstructorOptions);
      collection.once('sync', (function(_this) {
        return function(coll) {
          return utils.cacheCollection(cacheKey, coll, now + cacheExpirationMilliseconds, expireWithUser);
        };
      })(this));
      collection.on('sync', function() {
        return dfd.resolve(collection);
      });
      collection.fetch();
      return dfd.promise();
    } else {
      collection = new CollectionConstructor(cachedCollection.models, collectionConstructorOptions);
      dfd.resolve(collection);
      return dfd.promise();
    }
  },
  expireCache: function() {
    var cache, now;
    cache = storage.get('spa-cache') || {};
    now = new Date().getTime();
    _.forEach(cache, function(cachedObject, cacheKey) {
      var expiration, expired;
      expiration = (cachedObject != null ? cachedObject._expires : void 0) || 0;
      expired = now > expiration;
      if (expired) {
        delete cache[cacheKey];
      }
      if ((cachedObject._uid != null) && cachedObject._uid !== utils.getLoggedInUserId()) {
        return delete cache[cacheKey];
      }
    });
    return storage.set('spa-cache', cache);
  },
  cacheCollection: function(cacheKey, collection, expiration, expireWithUser) {
    var cache, cacheObject;
    cache = storage.get('spa-cache') || {};
    cacheObject = {
      _expires: expiration,
      models: collection.models
    };
    if (expireWithUser) {
      cacheObject['_uid'] = utils.getLoggedInUserId();
    }
    cache[cacheKey] = cacheObject;
    return storage.set('spa-cache', cache);
  },
  clearCache: function(cacheKey) {
    var cache;
    if (cacheKey == null) {
      cacheKey = null;
    }
    cache = storage.get('spa-cache') || {};
    if (cacheKey) {
      delete cache[cacheKey];
    } else {
      cache = {};
    }
    return storage.set('spa-cache', cache);
  },
  clearCurrentConvoM: function(dispose) {
    var convoM, currentStumble, stumble;
    if (dispose == null) {
      dispose = false;
    }
    stumble = require('../lib/stumble');
    currentStumble = stumble.getCollection().getActive();
    if (currentStumble) {
      convoM = currentStumble.get('_conversationM');
      currentStumble.unset('_conversationM');
      if (dispose) {
        return convoM != null ? convoM.dispose() : void 0;
      }
    }
  },

  /**
   * decide whether the bottom edge of a scrolling element's overflow is approaching within a tolerance
   * of the bounding box's bottom edge, using a multiple of the bounding box's height to determine the
   * tolerance
   *
   * @param scrollEl {jQuery} the overflowing element
   * @param heightFactor {float} the factor to multiply the element height by to determine the tolerance
   */
  contentScrolledNearBottomEdge: function(scrollEl, heightFactor) {
    return scrollEl.prop('scrollHeight') - scrollEl.scrollTop() <= scrollEl.prop('offsetHeight') * heightFactor;
  },

  /**
   * get the next pagination offset for a paginated collection
   *
   * @param scrollEl {jQuery} the overflowing element
   * @param heightFactor {float} the factor to multiply the element height by to determine the tolerance
   */
  getNextCollectionOffset: function(collection) {
    return collection.nextOffset || 0;
  },
  getTagName: function(tagId) {
    var cache, cacheObject, model, models;
    cache = storage.get('spa-cache') || {};
    cacheObject = cache['tags-from-last-fetch'] || {};
    models = cacheObject.models || [];
    model = _.find(models, (function(_this) {
      return function(value, index, collection) {
        return value.id === tagId;
      };
    })(this));
    return (model != null ? model.name : void 0) || tagId;
  },
  storeTagCloud: function(tagsC) {
    var expiration, expireWithUser, now;
    now = new Date().getTime();
    expiration = now + utils.DAY_IN_MILLISECONDS;
    expireWithUser = true;
    return utils.cacheCollection('tags-from-last-fetch', tagsC, expiration, expireWithUser);
  },

  /*
   * produce a hash using timestamp and cookies
   * @return {Number} a 32 bit integer
   */
  fingerprint: function() {
    var shaObj;
    shaObj = new JsSHA("SHA-1", "TEXT");
    shaObj.update(new Date().valueOf());
    shaObj.update(document.cookie);
    return shaObj.getHash("HEX");
  },
  interestModelFromParams: function(params, interestC) {
    var interestId, interestM, interestSlug;
    interestId = parseInt(params.interestid || params.interestId);
    if (isNaN(interestId)) {
      interestSlug = params.interestslug;
      interestId = parseInt(interestSlug);
      if (isNaN(interestId)) {
        interestM = interestC.findByName(interestSlug);
        if (!interestM || !interestM.getId()) {
          return false;
        }
        interestId = interestM.getId();
      }
    }
    return interestM || interestC.findById(interestId);
  }
});

module.exports = utils;


},{"../config":2,"../lib/root":129,"../lib/stumble":130,"../su-debug":265,"../views/toolbar/auth-toolbar-view":728,"../views/toolbar/visitor-toolbar-view":731,"chaplin":773,"jquery":774,"jssha":775,"lodash":776,"moment":778,"simple-storage":780}],157:[function(require,module,exports){
var $, Chaplin, Handlebars, i18n, i18n_replace, mediator, moment, root, storage, stumble, utils, viewingOwnProfile, _;

Chaplin = require('chaplin');

mediator = require('chaplin').mediator;

i18n = require('./i18n');

i18n_replace = require('./i18n-replace');

root = require('./root');

stumble = require('./stumble');

utils = require('./utils');

Handlebars = require('hbsfy/runtime');

moment = require('moment');

storage = require('simple-storage');

_ = require('lodash');

$ = require('jquery');

Handlebars.registerHelper('with', function(context, options) {
  if (!context || Handlebars.Utils.isEmpty(context)) {
    return options.inverse(this);
  } else {
    return options.fn(context);
  }
});


/*
 * Get Chaplin-declared named routes. {{#url "like" "105"}}{{/url}}
Handlebars.registerHelper 'url', (routeName, params..., options) ->
  Chaplin.utils.reverse routeName, params
 */

Handlebars.registerHelper('without', function(context, options) {
  var inverse;
  inverse = options.inverse;
  options.inverse = options.fn;
  options.fn = inverse;
  return Handlebars.helpers["with"].call(this, context, options);
});

Handlebars.registerHelper('currentMode', function(prop) {
  var _ref;
  return ((_ref = mediator.modesC.getActive()) != null ? _ref.get(prop) : void 0) || storage.get('activeMode') || 'All Interests';
});

Handlebars.registerHelper('currentUrl', function(prop) {
  var _ref;
  return (_ref = stumble.getCollection().getActive()) != null ? _ref.get(prop) : void 0;
});

Handlebars.registerHelper('currentUser', function(prop) {
  return mediator.userM.get(prop);
});

Handlebars.registerHelper('numberFormat', function(string) {
  return utils.numberFormat(string);
});

Handlebars.registerHelper('numberFormatCommas', function(string) {
  if (typeof string === 'string') {
    string = parseInt(string);
  }
  return _.str.numberFormat(string);
});

Handlebars.registerHelper('formatTimestamp', function(timestamp, format) {
  if (format == null) {
    format = 'MMM Do, YYYY';
  }
  return moment.unix(timestamp).format(format);
});

Handlebars.registerHelper('fromNow', function(timestamp) {
  return moment(timestamp).fromNow();
});

Handlebars.registerHelper('formatISOTimestamp', function(timestamp) {
  return moment(timestamp).format('MMM Do, YYYY');
});

Handlebars.registerHelper('pathName', function() {
  return root().location.pathname;
});

Handlebars.registerHelper('i18n', function(phrase) {
  return i18n(phrase);
});

Handlebars.registerHelper('i18n-replace', function(phrase, searchFor, replaceWith) {
  return i18n_replace(phrase, searchFor, replaceWith);
});

Handlebars.registerHelper('titleize', function(str) {
  return _(str).chain().humanize().titleize().value();
});

Handlebars.registerHelper('utmSource', function(url) {
  if (url.match('utm_source')) {
    return url;
  } else {
    return utils.appendParams(url, {
      'utm_source': 'stumbleupon'
    });
  }
});

Handlebars.registerHelper('ifCond', function(v1, v2, options) {
  if (v1 === v2) {
    return options.fn(this);
  } else {
    return options.inverse(this);
  }
});

viewingOwnProfile = function() {
  var identityM, myModel;
  identityM = mediator.currentProfileM.get('identityM');
  myModel = mediator.userM;
  return identityM.get('userid') === myModel.get('userid');
};

Handlebars.registerHelper('viewingOwnProfile', function(options) {
  if (viewingOwnProfile()) {
    return options.fn(this);
  }
});

Handlebars.registerHelper('isLoggedIn', function(options) {
  if (utils.isLoggedIn()) {
    return options.fn(this);
  }
});

Handlebars.registerHelper('isSuteamSession', function(options) {
  if (utils.isSuteamSession()) {
    return options.fn(this);
  }
});

Handlebars.registerHelper('viewingOtherProfile', function(options) {
  if (!viewingOwnProfile()) {
    return options.fn(this);
  }
});

Handlebars.registerHelper('isGreater', function(v1, v2, options) {
  if (v1 > v2) {
    return options.fn(this);
  } else {
    return options.inverse(this);
  }
});

Handlebars.registerHelper('plural', function(val, singular, plural, prepend) {
  var count, word;
  if (prepend == null) {
    prepend = true;
  }
  if (_.isArray(val)) {
    count = val.length;
  } else {
    count = _.str.toNumber(val);
  }
  word = count === 1 ? singular : plural;
  if (prepend) {
    return $.trim(count + ' ' + word);
  } else {
    return word;
  }
});

Handlebars.registerHelper('otherParticipants', function(participants) {
  var count, postfix;
  count = participants.length - 1;
  postfix = count === 1 ? 'other' : 'others';
  return count + ' ' + postfix;
});

Handlebars.registerHelper('ifMultiple', function(val, options) {
  if (_.isArray(val) && val.length > 1) {
    return options.fn(this);
  } else {
    return options.inverse(this);
  }
});

Handlebars.registerHelper('firstChar', function(str) {
  if (typeof str === 'string') {
    return str[0];
  }
});

Handlebars.registerHelper('getDomain', function(str) {
  if (typeof str === 'string') {
    return utils.getDomain(str);
  }
});

Handlebars.registerHelper('isAndroid', function() {
  return utils.isAndroid();
});

Handlebars.registerHelper('isiOS', function() {
  return utils.isiOS();
});

Handlebars.registerHelper('isMobile', function() {
  return utils.isMobile();
});

Handlebars.registerHelper('encodeValue', function(valueToEncode) {
  return encodeURIComponent(valueToEncode);
});


},{"./i18n":121,"./i18n-replace":120,"./root":129,"./stumble":130,"./utils":156,"chaplin":773,"hbsfy/runtime":795,"jquery":774,"lodash":776,"moment":778,"simple-storage":780}],158:[function(require,module,exports){
var mediator, publish;

mediator = require('chaplin').mediator;

publish = function(args, state) {
  var applyArgs;
  applyArgs = ["webfont:" + state].concat(Array.prototype.slice.call(args, 0));
  return mediator.publish.apply(mediator, applyArgs);
};

window.WebFontConfig = {
  google: {
    families: ["Oswald::latin", "Lato", "Raleway"]
  },
  loading: function() {
    return publish(arguments, 'loading');
  },
  active: function() {
    window._typekitLoaded = {
      state: "loaded"
    };
    return publish(arguments, 'active');
  },
  inactive: function() {
    return publish(arguments, 'inactive');
  },
  fontloading: function() {
    return publish(arguments, 'fontloading');
  },
  fontactive: function() {
    return publish(arguments, 'fontactive');
  },
  fontinactive: function() {
    return publish(arguments, 'fontinactive');
  }
};

module.exports = {
  loadAll: function() {
    var s, wf;
    wf = document.createElement("script");
    wf.src = "//ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";
    wf.type = "text/javascript";
    wf.async = "true";
    s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(wf, s);
    return null;
  }
};


},{"chaplin":773}],159:[function(require,module,exports){
var ActionButtonModel, Model, SU, analytics, request, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

_ = require('lodash');

analytics = require('../lib/analytics');

module.exports = ActionButtonModel = (function(_super) {
  __extends(ActionButtonModel, _super);

  function ActionButtonModel() {
    return ActionButtonModel.__super__.constructor.apply(this, arguments);
  }

  ActionButtonModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    throw new Error(method + ' unsupported');
  };

  ActionButtonModel.prototype.setButtonText = function(buttonText) {
    return this.set('buttonText', buttonText);
  };

  ActionButtonModel.prototype.getButtonText = function() {
    return this.get('buttonText');
  };

  ActionButtonModel.prototype.setTrackingCategory = function(trackingCategory) {
    return this.set('trackingCategory', trackingCategory);
  };

  ActionButtonModel.prototype.getTrackingCategory = function() {
    return this.get('trackingCategory');
  };


  /*
   * <String> or <Function> if a string is provided, it will be sent.  if a function is provided
                            * it will be called and it's return will be sent as string
   */

  ActionButtonModel.prototype.setTrackingLabel = function(trackingLabel) {
    return this.set('trackingLabel', trackingLabel);
  };

  ActionButtonModel.prototype.getTrackingLabel = function() {
    var label;
    label = this.get('trackingLabel');
    if (typeof label === 'function') {
      return label();
    } else {
      return label;
    }
  };

  ActionButtonModel.prototype.setClassNames = function(classNames) {
    return this.set('classNames', classNames);
  };

  ActionButtonModel.prototype.getClassNames = function() {
    return this.get('classNames');
  };

  ActionButtonModel.prototype.setId = function(id) {
    return this.set('id', id);
  };

  ActionButtonModel.prototype.getId = function() {
    return this.get('id');
  };

  ActionButtonModel.prototype.setAction = function(action) {
    return this.set('action', action);
  };

  ActionButtonModel.prototype.getAction = function() {
    return this.get('action');
  };

  ActionButtonModel.prototype.setTooltip = function(tooltip) {
    return this.set('tooltip', tooltip);
  };

  ActionButtonModel.prototype.getTooltip = function() {
    return this.get('tooltip');
  };

  ActionButtonModel.prototype.setClicked = function(clicked) {
    if (clicked && !this.getClicked() && !this.getDisabled()) {
      analytics.trackEvent(this.getTrackingCategory(), 1, {
        action: 'click',
        label: this.getTrackingLabel()
      });
      this.setDisabled(true);
    }
    return this.set('clicked', clicked);
  };

  ActionButtonModel.prototype.getClicked = function() {
    return this.get('clicked');
  };

  ActionButtonModel.prototype.reset = function() {
    this.setClicked(false);
    this.setDisabled(false);
    return this.setSelected(false);
  };

  ActionButtonModel.prototype.setDisabled = function(disabled) {
    return this.set('disabled', !!disabled);
  };

  ActionButtonModel.prototype.getDisabled = function() {
    return !!this.get('disabled');
  };

  ActionButtonModel.prototype.initialize = function(attributes, options) {
    ActionButtonModel.__super__.initialize.apply(this, arguments);
    return this.setClicked(false);
  };

  return ActionButtonModel;

})(Model);


},{"../lib/analytics":116,"../lib/request":128,"../lib/su":153,"./base/model":168,"lodash":776}],160:[function(require,module,exports){
var ActionButtonM, ActionButtonsCollection, Collection, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

ActionButtonM = require('./action-button-model');

module.exports = ActionButtonsCollection = (function(_super) {
  __extends(ActionButtonsCollection, _super);

  function ActionButtonsCollection() {
    return ActionButtonsCollection.__super__.constructor.apply(this, arguments);
  }

  ActionButtonsCollection.prototype.model = ActionButtonM;

  ActionButtonsCollection.prototype.sync = function(method, model, options) {
    throw new Error(method + ' unsupported');
  };

  ActionButtonsCollection.prototype.disable = function() {
    return this.each(function(model) {
      return this.model.setDisabled(true);
    });
  };

  return ActionButtonsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./action-button-model":159,"./base/collection":167}],161:[function(require,module,exports){
var ActivityCenterCollection, ActivityCenterM, Collection, SU, UrlsCollection, UsersCollection, moment, request, storage, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

ActivityCenterM = require('./activity-center-model');

UsersCollection = require('./users-collection');

UrlsCollection = require('./urls-collection');

moment = require('moment');

storage = require('simple-storage');

SU = require('../lib/su');

request = require('../lib/request');

_ = require('lodash');

module.exports = ActivityCenterCollection = (function(_super) {
  __extends(ActivityCenterCollection, _super);

  function ActivityCenterCollection() {
    return ActivityCenterCollection.__super__.constructor.apply(this, arguments);
  }

  ActivityCenterCollection.prototype.model = ActivityCenterM;

  ActivityCenterCollection.prototype.initialize = function(models, options) {
    var scope;
    scope = options != null ? options.scope : void 0;
    this.usersC = new UsersCollection();
    this.urlsC = new UrlsCollection();
    this.baseHost = 'https://nb9-stumbleupon.netdna-ssl.com/';
    this.defaultThumb = this.baseHost + 'qd2XW2ApGssxAW0J-XD3Ag';
    this.currentScope = scope || 'conversation,follow';
    if (this.currentScope === 'follow') {
      this.followActivityIds = [];
    }
    return this.on('sync', (function(_this) {
      return function(collection, resp) {
        var urlids, userids, _ref;
        storage.set('last-ac', moment());
        if ((resp != null ? (_ref = resp.activities) != null ? _ref._total : void 0 : void 0) > 0) {
          userids = [];
          urlids = [];
          resp.activities.values.forEach(function(activity) {
            userids.push(activity.sourceUserId);
            if (activity.urlId) {
              return urlids.push(activity.urlId);
            }
          });
          userids = _.uniq(userids);
          urlids = _.uniq(urlids);
          if (userids.length) {
            _this.getActivityUsers(userids);
          }
          if (urlids.length) {
            return _this.getActivityUrls(urlids);
          }
        }
      };
    })(this));
  };

  ActivityCenterCollection.prototype.comparator = function(model) {
    return -moment(model.get('occurred')).utc();
  };

  ActivityCenterCollection.prototype.getActivityUsers = function(userids) {
    this.usersC.fetch({
      remove: false,
      data: {
        userids: userids
      }
    });
    return this.usersC.on('sync', (function(_this) {
      return function() {
        return _this.each(function(item) {
          var userM, userid;
          userid = _.parseInt(item.get('sourceUserId'));
          userM = _this.usersC.findWhere({
            userid: userid
          });
          return item.set('_userM', userM != null ? userM.toJSON() : void 0);
        });
      };
    })(this));
  };

  ActivityCenterCollection.prototype.getActivityUrls = function(urlids) {
    this.urlsC.fetch({
      remove: false,
      data: {
        urlids: urlids
      }
    });
    return this.urlsC.on('sync', (function(_this) {
      return function() {
        return _this.each(function(item) {
          var urlObj, urlid, _ref, _ref1;
          urlid = item.get('urlId');
          urlObj = ((_ref = _this.urlsC.findWhere({
            urlid: urlid
          })) != null ? _ref.toJSON() : void 0) || {};
          urlObj._thumb = _this.defaultThumb;
          if (((_ref1 = urlObj.thumb) != null ? _ref1.large : void 0) != null) {
            urlObj._thumb = _this.baseHost + urlObj.thumb.large;
          }
          return item.set('_urlM', urlObj);
        });
      };
    })(this));
  };

  ActivityCenterCollection.prototype.sync = function(method, model, options) {
    options.data = options.data || {};
    options.data.scope = options.data.scope || this.currentScope;
    switch (method) {
      case 'read':
        return request(SU.Activities.get, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ActivityCenterCollection.prototype.parse = function(res) {
    var result;
    result = this._parsePaginated(res.activities);
    if (this.currentScope !== 'follow') {
      return result;
    } else {
      return result.filter((function(_this) {
        return function(activity) {
          return _this.followActivityIds.indexOf(activity.sourceUserId) < 0 && _this.followActivityIds.push(activity.sourceUserId);
        };
      })(this));
    }
  };

  return ActivityCenterCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./activity-center-model":162,"./base/collection":167,"./urls-collection":254,"./users-collection":261,"lodash":776,"moment":778,"simple-storage":780}],162:[function(require,module,exports){
var ActivityCenterModel, Model, SU, mediator, request, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

utils = require('../lib/utils');

mediator = require('chaplin').mediator;

_ = require('lodash');

module.exports = ActivityCenterModel = (function(_super) {
  __extends(ActivityCenterModel, _super);

  function ActivityCenterModel() {
    return ActivityCenterModel.__super__.constructor.apply(this, arguments);
  }

  ActivityCenterModel.prototype.initialize = function() {
    ActivityCenterModel.__super__.initialize.apply(this, arguments);
    if (this.get('group') === 'conversation') {
      return this.setConversationModel();
    }
  };

  ActivityCenterModel.prototype.reportError = _.once(function(string) {
    return _errs.push(new Error(string));
  });

  ActivityCenterModel.prototype.setConversationModel = function() {
    this.set({
      '_user-color': utils.generateUserColor(this.get('sourceUserId'))
    });
    this.set({
      '_originatorName': this.getConvoOriginatorDisplayName()
    });
    return this.set({
      '_action': this.getConvoAction()
    });
  };

  ActivityCenterModel.prototype.getConvoAction = function() {
    var type;
    type = this.get('type');
    if (type === 'conversationcommentadded') {
      return 'commented on a conversation.';
    } else if (type === 'conversationcreated') {
      return 'started a conversation with ' + this.getParticipantString() + '.';
    } else if (type === 'conversationparticipantsinvited') {
      return 'invited ' + this.getParticipantString() + ' to a conversation.';
    }
  };

  ActivityCenterModel.prototype.getParticipantString = function() {
    var currentUserId, otherParticipantCount, otherParticipantString, participantOne, participants, _ref, _ref1, _ref2, _ref3;
    currentUserId = (_ref = mediator.userM) != null ? (_ref1 = _ref.get('userid')) != null ? _ref1.toString() : void 0 : void 0;
    participants = this.getParticipants();
    participantOne = ((_ref2 = participants[0]) != null ? _ref2.suUserName : void 0) || ((_ref3 = participants[0]) != null ? _ref3.email : void 0) || 'someone';
    otherParticipantString = '';
    participants.forEach(function(item) {
      if (item.suUserId === currentUserId) {
        return participantOne = 'you';
      }
    });
    otherParticipantCount = participants.length - 1;
    if (otherParticipantCount === 1) {
      otherParticipantString = ' and 1 other';
    } else if (otherParticipantCount > 1) {
      otherParticipantString = ' and ' + otherParticipantCount + ' others';
    }
    return participantOne + otherParticipantString;
  };

  ActivityCenterModel.prototype.getConvoOriginatorDisplayName = function() {
    if (this.isConvoEventCreatedBySelf()) {
      return 'You';
    } else {
      return this.getConvoOriginatorName();
    }
  };

  ActivityCenterModel.prototype.getConvoOriginatorName = function() {
    var name, _ref, _ref1, _ref2, _ref3;
    name = ((_ref = this.get('conversationDetails')) != null ? (_ref1 = _ref.originator) != null ? _ref1.suUserName : void 0 : void 0) || ((_ref2 = this.get('conversationDetails')) != null ? (_ref3 = _ref2.originator) != null ? _ref3.email : void 0 : void 0);
    return _.truncate(name, 15);
  };

  ActivityCenterModel.prototype.getParticipants = function() {
    var participants, _ref;
    participants = ((_ref = this.get('conversationDetails')) != null ? _ref.participants : void 0) || [];
    return this.removeCreatorFromParticipants(participants);
  };

  ActivityCenterModel.prototype.removeCreatorFromParticipants = function(participants) {
    var originatorId, _ref, _ref1;
    originatorId = (_ref = this.get('conversationDetails')) != null ? (_ref1 = _ref.originator) != null ? _ref1.id : void 0 : void 0;
    return _.without(participants, _.findWhere(participants, {
      id: originatorId
    }));
  };

  ActivityCenterModel.prototype.isConvoEventCreatedBySelf = function() {
    var currentUserId, _ref, _ref1, _ref2, _ref3;
    currentUserId = (_ref = mediator.userM) != null ? (_ref1 = _ref.get('userid')) != null ? _ref1.toString() : void 0 : void 0;
    return ((_ref2 = this.get('conversationDetails')) != null ? (_ref3 = _ref2.originator) != null ? _ref3.suUserId : void 0 : void 0) === currentUserId;
  };

  ActivityCenterModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    options.data = {
      id: this.get('id'),
      read: this.get('read')
    };
    switch (method) {
      case 'update':
        return request(SU.Activities.markRead, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ActivityCenterModel.prototype.set = function(attributes, options) {
    if (options == null) {
      options = {};
    }
    _.defaults(options, {
      validate: true
    });
    return ActivityCenterModel.__super__.set.apply(this, arguments);
  };

  ActivityCenterModel.prototype.validate = function(attrs) {
    var activities, group, _ref, _ref1;
    if ((attrs != null ? (_ref = attrs.conversationDetails) != null ? (_ref1 = _ref.participants) != null ? _ref1.length : void 0 : void 0 : void 0) > mediator.maxConvoParticipants) {
      return "Too many participants";
    }
    activities = {
      "follow": true,
      "conversation": true
    };
    group = attrs != null ? attrs.group : void 0;
    if (activities[group]) {
      return void 0;
    } else {
      return "activity " + group + " cannot be rendered";
    }
  };

  return ActivityCenterModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"chaplin":773,"lodash":776}],163:[function(require,module,exports){
var ActivityNotificationModel, Model, SU, request, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

utils = require('../lib/utils');

module.exports = ActivityNotificationModel = (function(_super) {
  __extends(ActivityNotificationModel, _super);

  function ActivityNotificationModel() {
    return ActivityNotificationModel.__super__.constructor.apply(this, arguments);
  }

  ActivityNotificationModel.prototype.initialize = function() {
    ActivityNotificationModel.__super__.initialize.apply(this, arguments);
    if (!utils.isVisitor()) {
      return this.setInterval((function(_this) {
        return function() {
          return _this.fetch();
        };
      })(this), '10m');
    }
  };

  ActivityNotificationModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    if (method === 'create') {
      options.data = {
        last_checked: this.get('last_checked')
      };
    }
    switch (method) {
      case 'read':
        return request(SU.Activities.snapshot, arguments);
      case 'create':
        return request(SU.Activities.setSnapshot, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return ActivityNotificationModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168}],164:[function(require,module,exports){
var AlertModel, Model, i18n, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

request = require('../lib/request');

i18n = require('../lib/i18n');

module.exports = AlertModel = (function(_super) {
  __extends(AlertModel, _super);

  function AlertModel() {
    return AlertModel.__super__.constructor.apply(this, arguments);
  }

  AlertModel.prototype.defaults = {
    text: i18n("NETWORK_ERROR_PREVENTS_ACTION"),
    type: 'error',
    delay: true
  };

  return AlertModel;

})(Model);


},{"../lib/i18n":121,"../lib/request":128,"./base/model":168}],165:[function(require,module,exports){
var ApiErrorModel, Model, request, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

request = require('../lib/request');

_ = require('lodash');

module.exports = ApiErrorModel = (function(_super) {
  __extends(ApiErrorModel, _super);

  function ApiErrorModel() {
    this.getMailToHref = __bind(this.getMailToHref, this);
    return ApiErrorModel.__super__.constructor.apply(this, arguments);
  }

  ApiErrorModel.prototype.defaults = {
    email: 'support@stumbleupon.com'
  };

  ApiErrorModel.fromResponse = function(response) {
    var error, model, reason;
    model = new this();
    if ((response != null ? response._success : void 0) === false) {
      reason = response != null ? response._reason : void 0;
      error = response != null ? response._error : void 0;
      if (error) {
        if (_.isArray(error)) {
          reason = error[0];
        }
        model.setMessage(error.message);
        model.setCode(error.code);
        model.setType(error.type);
        model.setStruct(error.struct);
      }
      if (reason) {
        if (_.isArray(reason)) {
          reason = reason[0];
        }
        model.setMessage(reason.message);
        model.setCode(reason.code);
        model.setType(reason.type);
        model.setStruct(reason.struct);
      }
    }
    return model;
  };

  ApiErrorModel.prototype.setEmail = function(email) {
    this.set('email', email);
    return this.set('_mailtohref', this.getMailToHref);
  };

  ApiErrorModel.prototype.getEmail = function() {
    return this.get('email');
  };

  ApiErrorModel.prototype.setMessage = function(message) {
    this.set('message', message);
    return this.set('_mailtohref', this.getMailToHref);
  };

  ApiErrorModel.prototype.getMessage = function() {
    return this.get('message');
  };

  ApiErrorModel.prototype.setCode = function(code) {
    this.set('code', code);
    return this.set('_mailtohref', this.getMailToHref);
  };

  ApiErrorModel.prototype.getCode = function() {
    return this.get('code');
  };

  ApiErrorModel.prototype.setType = function(type) {
    this.set('type', type);
    return this.set('_mailtohref', this.getMailToHref);
  };

  ApiErrorModel.prototype.getType = function() {
    return this.get('type');
  };

  ApiErrorModel.prototype.setStruct = function(struct) {
    this.set('struct', struct);
    return this.set('_mailtohref', this.getMailToHref);
  };

  ApiErrorModel.prototype.getStruct = function() {
    return this.get('struct');
  };

  ApiErrorModel.prototype.setPreviousRoute = function(previousRoute) {
    this.set('_previousRoute', previousRoute);
    return this.set('_mailtohref', this.getMailToHref);
  };

  ApiErrorModel.prototype.getPreviousRoute = function() {
    return this.get('_previousRoute');
  };

  ApiErrorModel.prototype.getMailToHref = function() {
    var href;
    href = "mailto:";
    href += this.getEmail();
    href += "?subject=";
    href += encodeURIComponent("API Error");
    href += "&body=";
    return href += encodeURIComponent("The error reported was, '" + this.getMessage() + " (code: " + this.getCode() + "; context: " + this.getStruct() + "; source: " + JSON.stringify(this.getPreviousRoute()) + ")'");
  };

  return ApiErrorModel;

})(Model);


},{"../lib/request":128,"./base/model":168,"lodash":776}],166:[function(require,module,exports){
var $, BadgeSubmitModel, InterestM, InterestsC, Model, SU, SearchM, StumbleM, UrlM, UserTagM, i18n, mediator, request, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

UserTagM = require('./user-tag-model');

InterestM = require('./interest-model');

StumbleM = require('./stumble-model');

SU = require('../lib/su');

request = require('../lib/request');

InterestsC = require('./interests-collection');

mediator = require('chaplin').mediator;

$ = require('jquery');

UrlM = require('./url-model');

SearchM = require('./search-input-model');

_ = require('lodash');

i18n = require('../lib/i18n');


/**
  This is a complex model composed of four collections and a model:

  {
    urlM: an empty url model to be populated and saved to the submit endpoint
    allInterestsC: a list of all the interests, in their hierarchy
    flattenedInterestsC: a collection of all the leaf-level interests, flattened
    suggestedInterestsC: a collection of interests as returned from the classification endpoint
    tagsC: a collection of the user's saved tags as returned from the tag-cloud endpoint
  }

  This is tightly coupled with views of the SubmitController.

  This model will manage synchronization between the two collections as they morph
 */

module.exports = BadgeSubmitModel = (function(_super) {
  __extends(BadgeSubmitModel, _super);

  function BadgeSubmitModel() {
    return BadgeSubmitModel.__super__.constructor.apply(this, arguments);
  }

  BadgeSubmitModel.prototype.listen = {
    'sync': 'onSync'
  };

  BadgeSubmitModel.prototype.initialize = function(data, options) {
    var _ref;
    BadgeSubmitModel.__super__.initialize.apply(this, arguments);
    this.setUrlModel(options.urlM);
    this.set('allInterestsC', options.allInterestsC);
    this.set('flattenedInterestsC', options.flattenedInterestsC || ((_ref = options.allInterestsC) != null ? _ref.getLeafInterests() : void 0));
    this.set('suggestedInterestsC', options.suggestedInterestsC);
    this.set('tagsC', options.tagsC);
    this.set('tagsToSubmitC', options.tagsToSubmitC);
    this.set('interestSearchModel', this._createSearchModel(this.getFlattenedInterestsCollection(), true));
    this.set('tagSearchModel', this._createSearchModel(this.getTagsCollection(), false, i18n('ADD_TAGS')));
    this.listenTo(this.get('allInterestsC'), 'all', this.onSomethingChanged);
    this.listenTo(this.get('allInterestsC'), 'sync', this.onAllInterestsSync);
    this.listenTo(this.get('flattenedInterestsC'), 'all', this.onSomethingChanged);
    return this.listenTo(this.get('suggestedInterestsC'), 'all', this.onSomethingChanged);
  };

  BadgeSubmitModel.prototype.getAllInterestsCollection = function() {
    return this.get('allInterestsC');
  };

  BadgeSubmitModel.prototype.getFlattenedInterestsCollection = function() {
    return this.get('flattenedInterestsC');
  };

  BadgeSubmitModel.prototype.getSuggestedInterestsCollection = function() {
    return this.get('suggestedInterestsC');
  };

  BadgeSubmitModel.prototype.getTagsToSubmitCollection = function() {
    return this.get('tagsToSubmitC');
  };

  BadgeSubmitModel.prototype.getTagsCollection = function() {
    return this.get('tagsC');
  };

  BadgeSubmitModel.prototype.setUrlModel = function(urlModel) {
    return this.set('urlM', urlModel);
  };

  BadgeSubmitModel.prototype.getUrlModel = function() {
    return this.get('urlM');
  };

  BadgeSubmitModel.prototype.setUrl = function(url) {
    return this.set('_url', url.trim());
  };

  BadgeSubmitModel.prototype.getUrl = function() {
    return this.get('_url');
  };

  BadgeSubmitModel.prototype.setNsfw = function(nsfw) {
    return this.set('nsfw', nsfw);
  };

  BadgeSubmitModel.prototype.getNsfw = function() {
    return this.get('nsfw');
  };

  BadgeSubmitModel.prototype.getInterestSearchModel = function() {
    return this.get('interestSearchModel');
  };

  BadgeSubmitModel.prototype.getTagSearchModel = function() {
    return this.get('tagSearchModel');
  };

  BadgeSubmitModel.prototype._createSearchModel = function(searchListProvider, restrictToList, placeholderText) {
    var searchM;
    if (restrictToList == null) {
      restrictToList = false;
    }
    if (placeholderText == null) {
      placeholderText = i18n('SEARCH_INTERESTS');
    }
    searchM = new SearchM();
    searchM.setId('submit-search-interests');
    searchM.setRestrictToList(restrictToList);
    searchM.setSearchText('');
    searchM.setPlaceholderText(placeholderText);
    searchM.setSearchOpen(false);
    searchM.setSearchListProvider(searchListProvider);
    return searchM;
  };

  BadgeSubmitModel.prototype.getCheckedUserTags = function() {
    var checkedInterests;
    checkedInterests = this.getTagsToSubmitCollection().getChecked();
    return _.map(_.where(checkedInterests, function(model) {
      return model instanceof UserTagM;
    }), function(model) {
      return model.getName();
    });
  };

  BadgeSubmitModel.prototype.getCheckedInterestIds = function() {
    var checkedInterests;
    checkedInterests = this.getSuggestedInterestsCollection().getChecked();
    return _.pluck(_.where(checkedInterests, function(model) {
      return model instanceof InterestM;
    }), 'id');
  };

  BadgeSubmitModel.prototype.onAllInterestsSync = function() {
    var flattenedInterestsCollection;
    flattenedInterestsCollection = this.getAllInterestsCollection().getLeafInterests();
    this.getFlattenedInterestsCollection().set(flattenedInterestsCollection.models);
    this.getFlattenedInterestsCollection().setFilterText(this.getInterestSearchModel().getSearchText());
    if (this.getInterestSearchModel().getSearchText()) {
      return this.getInterestSearchModel().setSearchOpen(true);
    }
  };

  BadgeSubmitModel.prototype.validate = function() {
    var checkedInterestIds, checkedUserTags, nsfw, url;
    url = this.getUrl();
    nsfw = this.getNsfw();
    checkedInterestIds = this.getCheckedInterestIds();
    checkedUserTags = this.getCheckedUserTags();
    if (!(nsfw === true || nsfw === false)) {
      return i18n('NSFW_IS_REQUIRED');
    }
    if (!url.substring) {
      return i18n('URL_MUST_BE_STRING');
    }
    if (!/^https{0,1}:\/\/[\S]+$/.test(url)) {
      return i18n('URL_MUST_BE_GOOD');
    }
    if ((checkedInterestIds != null ? checkedInterestIds.length : void 0) === 0 && (checkedUserTags != null ? checkedUserTags.length : void 0) === 0) {
      return i18n('CLASSIFICATION_IS_REQUIRED');
    }
    return null;
  };

  BadgeSubmitModel.prototype.sync = function(method, model, options) {
    var args, tags, userTags;
    if (options == null) {
      options = {};
    }
    this.publishEvent('model:sync:start', this);
    tags = this.getCheckedInterestIds();
    userTags = this.getCheckedUserTags();
    if (method === 'create') {
      options.data = {
        url: this.getUrl(),
        nsfw: this.getNsfw()
      };
    }
    switch (method) {
      case 'create':
        args = arguments;
        return request(SU.Url.submitOneTime, args).then(function(response, success, xhr) {
          var dfd, discovery, urlid, _ref;
          if (success === "success" && response._success) {
            discovery = response.discovery;
            if (discovery._success) {
              urlid = (_ref = discovery.url) != null ? _ref.urlid : void 0;
              if (!urlid) {
                urlid = discovery.urlid;
              }
              options.data = {
                urlid: urlid,
                tags: tags,
                'user-tags': userTags
              };
              return request(SU.Url.classify, args);
            }
          } else {
            dfd = $.Deferred();
            dfd.reject(response);
            return dfd.promise();
          }
        }).then(function(response, success, xhr) {
          var dfd, urlModel;
          if (success === "success" && response._success) {
            urlModel = new UrlM(response.url);
            if (urlModel.getRating() !== 1) {
              return request(SU.Stumble.setRatingOneTime, [
                'update', new StumbleM(), {
                  data: {
                    urlid: urlModel.getUrlId(),
                    type: '1'
                  }
                }
              ]);
            }
          } else {
            dfd = $.Deferred();
            dfd.reject(response);
            return dfd.promise();
          }
        }).then((function(_this) {
          return function(response, success, xhr) {
            var params;
            if (success !== "success" || !response._success) {
              params = {
                response: response,
                url: _this.getUrl()
              };
              options.response = response;
              return Chaplin.utils.redirectTo('errors/badge-submit-errors#api', params, options);
            } else {
              return true;
            }
          };
        })(this)).fail((function(_this) {
          return function(response) {
            var params;
            params = {
              response: response,
              url: _this.getUrl()
            };
            options.response = response;
            return Chaplin.utils.redirectTo('errors/badge-submit-errors#api', params, options);
          };
        })(this));
      default:
        throw new Error(method + ' unsupported');
    }
  };

  BadgeSubmitModel.prototype.parse = function(response) {
    var urlModel, _ref, _ref1, _ref2, _ref3;
    if ((response != null ? response._success : void 0) && ((_ref = response.discovery) != null ? _ref._success : void 0) && ((_ref1 = response.discovery.url) != null ? _ref1._success : void 0)) {
      urlModel = new UrlM(response.discovery.url);
    } else if ((response != null ? response._success : void 0) && ((_ref2 = response.discovery) != null ? _ref2._success : void 0)) {
      urlModel = new UrlM(response.discovery);
    } else if ((response != null ? response._success : void 0) && ((_ref3 = response.url) != null ? _ref3.url : void 0)) {
      urlModel = new UrlM(response.url);
    }
    if (urlModel) {
      return this.setUrlModel(urlModel);
    }
  };

  BadgeSubmitModel.prototype.addTag = function(text) {
    var userTagM;
    userTagM = new UserTagM();
    userTagM.setName(text);
    userTagM.setChecked(true);
    return this.getTagsToSubmitCollection().unshift(userTagM);
  };

  return BadgeSubmitModel;

})(Model);


},{"../lib/i18n":121,"../lib/request":128,"../lib/su":153,"./base/model":168,"./interest-model":187,"./interests-collection":188,"./search-input-model":227,"./stumble-model":239,"./url-model":252,"./user-tag-model":259,"chaplin":773,"jquery":774,"lodash":776}],167:[function(require,module,exports){
var AnnounceEvents, Chaplin, CheckableItemListP, Collection, Mixin, Model, SearchInputListP, StopTimers, TabViewProvider, WhenPopulated, mediator, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Mixin = require('mixen');

Chaplin = require('chaplin');

Model = require('./model');

mediator = require('chaplin').mediator;

WhenPopulated = require('../mixins/when-populated');

StopTimers = require('../../lib/mixins/stop-timers');

AnnounceEvents = require('../../lib/mixins/announce-events');

SearchInputListP = require('../mixins/search-input-list-provider');

CheckableItemListP = require('../mixins/checkable-item-list-provider');

TabViewProvider = require('../mixins/tab-view-provider');

_ = require('lodash');

module.exports = Collection = (function(_super) {
  __extends(Collection, _super);

  function Collection() {
    return Collection.__super__.constructor.apply(this, arguments);
  }

  Collection.prototype.model = Model;

  Collection.prototype.initialize = function() {
    this._fetchedOnce = false;
    this.listenToOnce(this, 'sync', function() {
      return this._fetchedOnce = true;
    });
    return Collection.__super__.initialize.apply(this, arguments);
  };

  Collection.prototype.hasFetched = function() {
    return this._fetchedOnce;
  };

  Collection.prototype.set = function() {
    if (!this.disposed) {
      return Collection.__super__.set.apply(this, arguments);
    }
  };


  /*
   * capture certain information from pagination endpoints and set them as object properties
   * adding and deleting from paginated results will invalidate these properties
   */

  Collection.prototype._parsePaginated = function(dataNode) {
    var fetchedCount, fetchedOffset, fetchedOffsets, lastFetchedLimit, lastFetchedOffset, totalCount, _ref, _ref1;
    totalCount = (dataNode != null ? dataNode._total : void 0) || 0;
    totalCount = parseInt(totalCount);
    fetchedOffsets = this.fetchedOffsets || _([]);
    totalCount = Math.max(this.totalCount || 0, totalCount);
    if (totalCount !== this.totalCount) {
      this.totalCount = totalCount;
      this.trigger('change:totalCount', totalCount);
    }
    lastFetchedLimit = (dataNode != null ? dataNode._limit : void 0) || (dataNode != null ? (_ref = dataNode.values) != null ? _ref.length : void 0 : void 0) || 1;
    this.lastFetchedLimit = parseInt(lastFetchedLimit);
    fetchedCount = (dataNode != null ? (_ref1 = dataNode.values) != null ? _ref1.length : void 0 : void 0) || 0;
    this.lastFetchedCount = fetchedCount;
    lastFetchedOffset = dataNode != null ? dataNode._offset : void 0;
    if (!lastFetchedOffset) {
      fetchedOffset = fetchedOffsets.last();
      if (fetchedOffset) {
        lastFetchedOffset = fetchedOffset.next;
      } else {
        lastFetchedOffset = 0;
      }
    }
    this.lastFetchedOffset = parseInt(lastFetchedOffset);
    this.nextOffset = this.lastFetchedOffset + this.lastFetchedCount;
    if (fetchedOffsets != null) {
      fetchedOffsets.push({
        offset: this.lastFetchedOffset,
        limit: this.lastFetchedLimit,
        count: this.lastFetchedCount,
        next: this.nextOffset
      });
    }
    this.fetchedOffsets = fetchedOffsets;
    return dataNode != null ? dataNode.values : void 0;
  };

  return Collection;

})(Mixin(TabViewProvider, CheckableItemListP, SearchInputListP, AnnounceEvents, StopTimers, WhenPopulated, Chaplin.Collection));


},{"../../lib/mixins/announce-events":123,"../../lib/mixins/stop-timers":124,"../mixins/checkable-item-list-provider":205,"../mixins/search-input-list-provider":206,"../mixins/tab-view-provider":208,"../mixins/when-populated":209,"./model":168,"chaplin":773,"lodash":776,"mixen":777}],168:[function(require,module,exports){
var $, AnnounceEvents, Backbone, Chaplin, Mixin, Model, StopTimers, WhenPopulated, WidgetProvider,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

Backbone = require('backbone');

Backbone.$ = $;

Mixin = require('mixen');

$ = require('jquery');

Backbone = require('backbone');

Backbone.$ = $;

Chaplin = require('chaplin');

WhenPopulated = require('../mixins/when-populated');

StopTimers = require('../../lib/mixins/stop-timers');

AnnounceEvents = require('../../lib/mixins/announce-events');

WidgetProvider = require('../mixins/widget-provider');

module.exports = Model = (function(_super) {
  __extends(Model, _super);

  function Model() {
    return Model.__super__.constructor.apply(this, arguments);
  }

  Model.prototype.set = function() {
    if (!this.disposed) {
      return Model.__super__.set.apply(this, arguments);
    }
  };

  Model.prototype.toggle = function(property) {
    return this.set(property, !this.get(property));
  };

  return Model;

})(Mixin(WidgetProvider, AnnounceEvents, StopTimers, WhenPopulated, Chaplin.Model));


},{"../../lib/mixins/announce-events":123,"../../lib/mixins/stop-timers":124,"../mixins/when-populated":209,"../mixins/widget-provider":210,"backbone":772,"chaplin":773,"jquery":774,"mixen":777}],169:[function(require,module,exports){
var BlockedParticipantModel, Model, SU, mediator, request, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

_ = require('lodash');

utils = require('../lib/utils');

mediator = require('chaplin').mediator;

SU = require('../lib/su');

request = require('../lib/request');

module.exports = BlockedParticipantModel = (function(_super) {
  __extends(BlockedParticipantModel, _super);

  function BlockedParticipantModel() {
    return BlockedParticipantModel.__super__.constructor.apply(this, arguments);
  }

  BlockedParticipantModel.prototype.sync = function(method, model, options) {
    var id;
    if (options == null) {
      options = {};
    }
    id = model.get('id');
    options.ignoreSuccessProperty = true;
    options.data = {
      blockedParticipantIds: id,
      participantId: utils.getParticipantId()
    };
    switch (method) {
      case 'update':
        return request(SU.Participants.blockParticipants, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  BlockedParticipantModel.prototype.validate = function(json) {
    if (json.id === utils.getParticipantId()) {
      return "You can't block yourself!";
    }
  };

  return BlockedParticipantModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"chaplin":773,"lodash":776}],170:[function(require,module,exports){
var BlockedParticipantModel, BlockedParticipantsCollection, Collection, SU, mediator, request, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

BlockedParticipantModel = require('./blocked-participant-model');

mediator = require('chaplin').mediator;

_ = require('lodash');

request = require('../lib/request');

SU = require('../lib/su');

utils = require('../lib/utils');

module.exports = BlockedParticipantsCollection = (function(_super) {
  __extends(BlockedParticipantsCollection, _super);

  function BlockedParticipantsCollection() {
    return BlockedParticipantsCollection.__super__.constructor.apply(this, arguments);
  }

  BlockedParticipantsCollection.prototype.model = BlockedParticipantModel;

  BlockedParticipantsCollection.prototype.fetchOnce = _.once(function() {
    return this.fetch();
  });

  BlockedParticipantsCollection.prototype.sync = function(method, model, options) {
    options = {
      ignoreSuccessProperty: true,
      data: {
        participantId: utils.getParticipantId()
      },
      success: (function(_this) {
        return function(models) {
          return _this.add(models);
        };
      })(this)
    };
    switch (method) {
      case 'read':
        return request(SU.Participants.blockedParticipants, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return BlockedParticipantsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/collection":167,"./blocked-participant-model":169,"chaplin":773,"lodash":776}],171:[function(require,module,exports){
var ContactsCollection, ParticipantsCollection, mediator, storage, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ParticipantsCollection = require('./participants-collection');

_ = require('lodash');

mediator = require('chaplin').mediator;

utils = require('../lib/utils');

storage = require('simple-storage');

module.exports = ContactsCollection = (function(_super) {
  __extends(ContactsCollection, _super);

  function ContactsCollection() {
    return ContactsCollection.__super__.constructor.apply(this, arguments);
  }

  ContactsCollection.prototype.initialize = function() {
    ContactsCollection.__super__.initialize.apply(this, arguments);
    this.subscribeEvent('contacts:saved', (function(_this) {
      return function() {
        return _this.setInvitedCount();
      };
    })(this));
    return this.listenTo(this, 'sync', this.setInvitedCount);
  };

  ContactsCollection.prototype.setInvitedCount = function() {
    var currentUserId, storedContacts;
    currentUserId = mediator.userM.get('userid').toString();
    storedContacts = storage.get('contacts' + currentUserId);
    if (!storedContacts) {
      return;
    }
    _.forEach(storedContacts, (function(_this) {
      return function(count, contact) {
        var contactM;
        contactM = _this.findWhere({
          suUid: contact
        }) || _this.findWhere({
          _name: contact
        });
        if (contactM) {
          return contactM.set({
            invitedCount: storedContacts[contact]
          });
        } else if (utils.isEmail(contact)) {
          return _this.add({
            email: contact,
            invitedCount: storedContacts[contact]
          });
        }
      };
    })(this));
    return this.sort();
  };

  return ContactsCollection;

})(ParticipantsCollection);


},{"../lib/utils":156,"./participants-collection":214,"chaplin":773,"lodash":776,"simple-storage":780}],172:[function(require,module,exports){
var ConversationModel, EventsCollection, Model, ParticipantsCollection, SU, mediator, request, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

_ = require('lodash');

SU = require('../lib/su');

ParticipantsCollection = require('./participants-collection');

EventsCollection = require('./events-collection');

request = require('../lib/request');

mediator = require('chaplin').mediator;

utils = require('../lib/utils');


/*
  * a conversation is an identifiable entity composed of a topic, a participants collection,
  * an invited participants collection, and an events collection
 */

module.exports = ConversationModel = (function(_super) {
  __extends(ConversationModel, _super);

  function ConversationModel() {
    return ConversationModel.__super__.constructor.apply(this, arguments);
  }

  ConversationModel.prototype.initialize = function() {
    ConversationModel.__super__.initialize.apply(this, arguments);
    return this.listenTo(this, 'sync', (function(_this) {
      return function(model, resp) {
        var eventsC, invitesC, participantsC;
        participantsC = new ParticipantsCollection(model.get('participants'));
        participantsC.setConversationId(_this.get('id'));
        model.set('participantsC', participantsC);
        eventsC = new EventsCollection(model.get('events'), {
          conversationId: _this.get('id'),
          participantsC: _this.get('participantsC')
        });
        model.set('eventsC', eventsC);
        invitesC = new ParticipantsCollection(mediator.contactsC.toJSON());
        invitesC.setConversationId(_this.get('id'));
        invitesC.each(function(participant) {
          var foundParticipant;
          foundParticipant = participantsC.findWhere({
            suUserId: participant.get('suUid')
          }) || participantsC.findWhere({
            id: participant.get('id')
          });
          if (foundParticipant) {
            return participant.set({
              '_isParticipant': true
            });
          }
        });
        return model.set('invitesC', invitesC);
      };
    })(this));
  };

  ConversationModel.prototype.sync = function(method, model, options) {
    var _ref;
    if (options == null) {
      options = {};
    }
    options.data = options.data || {};
    if ((_ref = options.data) != null) {
      _ref.conversationId = this.get('conversationId');
    }
    options.ignoreSuccessProperty = true;
    switch (method) {
      case 'read':
        return request(SU.Conversations.get, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ConversationModel.prototype.mute = function() {
    var options;
    options = {
      data: {
        conversationId: this.get('conversationId')
      },
      ignoreSuccessProperty: true
    };
    return request(SU.Conversations.mute, [null, null, options]);
  };

  ConversationModel.prototype.parse = function(data, options) {
    return data;
  };

  ConversationModel.prototype.dispose = function() {
    var eventsC;
    if (!this.disposed) {
      utils.clearCurrentConvoM(false);
      this.unset('participantsC');
      eventsC = this.get('eventsC');
      eventsC.dispose();
      this.unset('eventsC');
    }
    return ConversationModel.__super__.dispose.apply(this, arguments);
  };

  return ConversationModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"./events-collection":177,"./participants-collection":214,"chaplin":773,"lodash":776}],173:[function(require,module,exports){
var $, DismissedTutorialModel, Model, SU, mediator, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = DismissedTutorialModel = (function(_super) {
  __extends(DismissedTutorialModel, _super);

  function DismissedTutorialModel() {
    return DismissedTutorialModel.__super__.constructor.apply(this, arguments);
  }

  DismissedTutorialModel.prototype.initialize = function() {
    var dismissedTutorialCookie, userObjectDismissedValue;
    DismissedTutorialModel.__super__.initialize.apply(this, arguments);
    userObjectDismissedValue = mediator.userM.get('dismissed_onboarding_tutorial');
    dismissedTutorialCookie = $.cookie('dismissed_tutorial');
    if ((!mediator.dismissedTutorial) && (userObjectDismissedValue == null) && (dismissedTutorialCookie != null)) {
      this.set({
        userid: mediator.userM.get('userid'),
        dismissed_onboarding_tutorial: dismissedTutorialCookie === 'true'
      });
      return this.save();
    }
  };

  DismissedTutorialModel.prototype.sync = function(method, model, options) {
    var user;
    if (options == null) {
      options = {};
    }
    user = new SU.User;
    options = {
      data: model.toJSON()
    };
    switch (method) {
      case 'create':
        mediator.dismissedTutorial = this.get('dismissed_onboarding_tutorial');
        return request(user.onboardingTutorial, [null, null, options]);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  DismissedTutorialModel.prototype.getDismissedTutorial = function() {
    return !!(mediator.dismissedTutorial || mediator.userM.get('dismissed_onboarding_tutorial'));
  };

  return DismissedTutorialModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"chaplin":773,"jquery":774}],174:[function(require,module,exports){
var EmailShareModel, Model, SU, mediator, request, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

mediator = require('chaplin').mediator;

utils = require('../lib/utils');

module.exports = EmailShareModel = (function(_super) {
  __extends(EmailShareModel, _super);

  function EmailShareModel() {
    this.handleEmailFailEvent = __bind(this.handleEmailFailEvent, this);
    this.prepEmails = __bind(this.prepEmails, this);
    return EmailShareModel.__super__.constructor.apply(this, arguments);
  }

  EmailShareModel.prototype.sync = function(method, model, options) {
    var apiData, data;
    if (options == null) {
      options = {};
    }
    if (method !== 'create') {
      throw new Error(method + ' unsupported');
    }
    data = model.toJSON();
    if (this.prepEmails(data)) {
      mediator.publish('email-share:model:share:start');
      apiData = {
        contentId: data.urlid,
        contentType: 'url',
        initialMessage: data.message,
        emails: data.emails
      };
      options = {
        data: apiData,
        ignoreSuccessProperty: true,
        success: function() {
          return mediator.publish('email-share:model:share:sent');
        },
        error: function() {
          return mediator.publish('email-share:model:share:failed');
        }
      };
      return request(SU.Conversations.create, [null, apiData, options]);
    }
  };

  EmailShareModel.prototype.prepEmails = function(data) {
    var email, _i, _len, _ref;
    data.emails = data.emails.toLowerCase();
    data.emails = data.emails.replace(/[;,]/g, ' ');
    data.emails = data.emails.replace(/[ ]+/g, ' ');
    data.emails = data.emails.trim();
    if (!data.emails.length) {
      this.handleEmailFailEvent('Please supply an email address');
      return false;
    }
    data.emails = data.emails.split(' ');
    data.emails = _.uniq(data.emails);
    _ref = data.emails;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      email = _ref[_i];
      if (!utils.isEmail(email)) {
        this.handleEmailFailEvent('"' + email + '" does not appear to be a valid email address');
        return false;
      }
    }
    return true;
  };

  EmailShareModel.prototype.handleEmailFailEvent = function(message) {
    return this.publishEvent('email-share:model:email:error', message);
  };

  return EmailShareModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"chaplin":773,"lodash":776}],175:[function(require,module,exports){
var $, EmailverifyModel, Model, SU, config, request, utils,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

utils = require('../lib/utils');

config = require('../config');

$ = require('jquery');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = EmailverifyModel = (function(_super) {
  __extends(EmailverifyModel, _super);

  function EmailverifyModel() {
    this.processErrorFailure = __bind(this.processErrorFailure, this);
    this.processVerificationSuccess = __bind(this.processVerificationSuccess, this);
    return EmailverifyModel.__super__.constructor.apply(this, arguments);
  }

  EmailverifyModel.prototype.initialize = function(data) {
    EmailverifyModel.__super__.initialize.apply(this, arguments);
    this.set('email', decodeURIComponent(data.email));
    return this.set('hash', data.hash);
  };

  EmailverifyModel.prototype.sync = function(method, model, options) {
    var user;
    if (options == null) {
      options = {};
    }
    options = {
      success: this.processVerificationSuccess,
      error: this.processErrorFailure,
      data: model.toJSON()
    };
    user = new SU.User;
    switch (method) {
      case 'create':
        return request(user.verifyEmail, [null, null, options]);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  EmailverifyModel.prototype.processVerificationSuccess = function(response, status, xhr) {
    return this.publishEvent('email-verify:model:success');
  };

  EmailverifyModel.prototype.processErrorFailure = function(xhr, status, err) {
    if (xhr._error) {
      return this.publishEvent('email-verify:model:failure');
    } else {
      return this.publishEvent('email-verify:model:error');
    }
  };

  return EmailverifyModel;

})(Model);


},{"../config":2,"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"jquery":774}],176:[function(require,module,exports){
var EventModel, Model, SU, mediator, request, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

mediator = require('chaplin').mediator;

utils = require('../lib/utils');

_ = require('lodash');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = EventModel = (function(_super) {
  __extends(EventModel, _super);

  function EventModel(attributes, options) {
    var _ref;
    this.participantsC = options.participantsC || ((_ref = options.collection) != null ? _ref.participantsC : void 0) || _({});
    EventModel.__super__.constructor.apply(this, arguments);
  }

  EventModel.prototype.initialize = function(attributes, options) {
    var createdBySelf, myParticipantId, participants, type;
    EventModel.__super__.initialize.apply(this, arguments);
    myParticipantId = utils.getParticipantId();
    createdBySelf = this.get('createdBy') === myParticipantId;
    type = this.get('type');
    if (type === 'create') {
      participants = this.get('_invitedParticipants');
      _.remove(participants, (function(_this) {
        return function(item) {
          return item.id === _this.get('createdBy');
        };
      })(this));
    }
    this.set('_createdBySelf', createdBySelf);
    return this.setParticipantColor();
  };

  EventModel.prototype.setParticipantColor = function(color) {
    var participantM;
    if (this.get('type') === 'message') {
      participantM = this.get('_createdByParticipantM');
      color = participantM != null ? participantM.get('_user-color') : void 0;
      if (color) {
        return this.set('_user-color', color);
      }
    }
  };


  /*
    * @override
   */

  EventModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    options.data = options.data || {};
    options.data.conversationId = model.get('conversationId');
    options.data.message = model.get('message');
    options.ignoreSuccessProperty = true;
    switch (method) {
      case 'create':
        return request(SU.Conversations.addComment, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };


  /*
    * @override
    * look up the participant's data-model in the participants collection and attach it to the
    * attributes before setting this model's attributes
   */

  EventModel.prototype.set = function(attributes, options) {
    attributes = this.attachCreator(attributes);
    return EventModel.__super__.set.apply(this, arguments);
  };

  EventModel.prototype.attachCreator = function(data) {
    var model;
    model = this.participantsC.findWhere({
      'id': data.createdBy
    });
    data._createdByParticipantM = model;
    return data;
  };

  return EventModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"chaplin":773,"lodash":776}],177:[function(require,module,exports){
var $, Collection, EventM, EventsCollection, ParticipantM, Q, SU, mediator, moment, request, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

EventM = require('./event-model');

ParticipantM = require('./participant-model');

Q = require('q');

_ = require('lodash');

$ = require('jquery');

mediator = require('chaplin').mediator;

SU = require('../lib/su');

request = require('../lib/request');

utils = require('../lib/utils');

moment = require('moment');

module.exports = EventsCollection = (function(_super) {
  __extends(EventsCollection, _super);

  function EventsCollection() {
    return EventsCollection.__super__.constructor.apply(this, arguments);
  }

  EventsCollection.prototype.model = EventM;

  EventsCollection.prototype._pollInterval = 50000;

  EventsCollection.prototype._pollIntervalMultiplier = 1;

  EventsCollection.prototype._pollIntervalMax = 600000;

  EventsCollection.prototype._lastPollTime = moment(0);


  /*
    * @override
   */

  EventsCollection.prototype.initialize = function(data, options) {
    if (options == null) {
      options = {};
    }
    EventsCollection.__super__.initialize.apply(this, arguments);
    this.conversationId = options.conversationId;
    this.participantsC = options.participantsC;
    this.listenTo(mediator.blockedParticipantsC, 'add', this.onNewBlockedParticipant);
    return this.doPoll(options);
  };


  /*
    * Keep track of whether the user is in the conversation
   */

  EventsCollection.prototype.isValidParticipant = function(participantId) {
    if (!this.participantsC.findWhere({
      'id': participantId
    })) {
      return false;
    }
    if (mediator.blockedParticipantsC.findWhere({
      'id': participantId
    })) {
      return false;
    }
    return true;
  };


  /*
    * start pinging the server for new events
   */

  EventsCollection.prototype.doPoll = function(options) {
    if (this._poller) {
      clearTimeout(this._poller);
    }
    return this._poller = setTimeout((function(_this) {
      return function() {
        return _this.fetchNew(options);
      };
    })(this), this.getPollInterval());
  };

  EventsCollection.prototype.getPollInterval = function() {
    return Math.min(this._pollInterval * this._pollIntervalMultiplier, this._pollIntervalMax);
  };


  /*
    * stop pinging the server for new events
   */

  EventsCollection.prototype.stopPolling = function() {
    return clearTimeout(this._poller);
  };


  /*
    * @override
   */

  EventsCollection.prototype.sync = function(method, model, options) {
    var now;
    now = moment();
    if (options.data == null) {
      options.data = {
        conversationId: this.conversationId
      };
    }
    options.ignoreSuccessProperty = true;
    switch (method) {
      case 'read':
        request(SU.Conversations.get, arguments);
        break;
      default:
        throw new Error(method + ' unsupported');
    }
    return this._lastPollTime = now;
  };


  /*
    * fetch events that have come in (possibly) since the last request and add them.
    * unwanted messages will be filtered in the override of 'set' method.  sets up
    * the next poll
   */

  EventsCollection.prototype.fetchNew = function(options) {
    var now;
    now = moment();
    options.data = {
      conversationId: this.conversationId,
      eventsSince: this._lastPollTime.format('YYYY-MM-DDTHH:mm:ssZ')
    };
    options.ignoreSuccessProperty = true;
    options.success = (function(_this) {
      return function(conversationObject, options) {
        var newEvents;
        newEvents = conversationObject != null ? conversationObject.events : void 0;
        if (newEvents) {
          _this.add(newEvents);
          _this._lastPollTime = now;
          _this._pollIntervalMultiplier = 1;
        } else {
          _this._pollIntervalMultiplier += 1;
        }
        return _this.doPoll(options);
      };
    })(this);
    return request(SU.Conversations.get, ['read', this, options]);
  };


  /*
    * call this to send a message to this conversation via the service
    * @param message <string> the message to be sent
    * @param options <Object>
    *   - type: known types are 'comment' and 'create'
   */

  EventsCollection.prototype.addMessage = function(message, options) {
    var type;
    if (options == null) {
      options = {};
    }
    if (this.isValidParticipant(utils.getParticipantId())) {
      type = options.type || 'comment';
      return this.create({
        createdBy: utils.getParticipantId(),
        type: type,
        message: message,
        conversationId: this.conversationId
      }, {
        participantsC: this.participantsC
      });
    } else {
      return console.error("Cannot add message to conversation");
    }
  };


  /*
    * Filters a recently blocked participants messages out
   */

  EventsCollection.prototype.onNewBlockedParticipant = function(participantM) {
    return this.remove(this.where({
      createdBy: participantM.get('id')
    }));
  };


  /*
    * @override
    *   filter out unwanted messages from the incoming data
   */

  EventsCollection.prototype.set = function(eventAttributesList, options) {
    _.remove(eventAttributesList, (function(_this) {
      return function(eventAttributes) {
        return !_this.isValidParticipant(eventAttributes.createdBy);
      };
    })(this));
    return EventsCollection.__super__.set.apply(this, arguments);
  };

  EventsCollection.prototype.dispose = function() {
    this.stopPolling();
    return EventsCollection.__super__.dispose.apply(this, arguments);
  };

  return EventsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/collection":167,"./event-model":176,"./participant-model":213,"chaplin":773,"jquery":774,"lodash":776,"moment":778,"q":779}],178:[function(require,module,exports){
var FacebookConnectModel, Model, SU, mediator, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

mediator = require('chaplin').mediator;

module.exports = FacebookConnectModel = (function(_super) {
  __extends(FacebookConnectModel, _super);

  function FacebookConnectModel() {
    this.notifyPermissionsError = __bind(this.notifyPermissionsError, this);
    this.notifyError = __bind(this.notifyError, this);
    this.notifyFbLink = __bind(this.notifyFbLink, this);
    this.notifyFbSignup = __bind(this.notifyFbSignup, this);
    this.notifyFbLogin = __bind(this.notifyFbLogin, this);
    this.notifyFbUnlink = __bind(this.notifyFbUnlink, this);
    this.fbLink = __bind(this.fbLink, this);
    this.fbSignup = __bind(this.fbSignup, this);
    this.onFbConnect = __bind(this.onFbConnect, this);
    this.checkPermissions = __bind(this.checkPermissions, this);
    return FacebookConnectModel.__super__.constructor.apply(this, arguments);
  }

  FacebookConnectModel.prototype.sync = function(method, model, options) {
    var data, link, rerequest;
    if (options == null) {
      options = {};
    }
    this.publishEvent('fb:model:sync:start', this);
    data = model.toJSON();
    rerequest = data.rerequest;
    link = (data.link != null) === true ? true : false;
    switch (method) {
      case 'create':
        if (!rerequest) {
          return FB.login(((function(_this) {
            return function(response) {
              return _this.checkPermissions(response, link);
            };
          })(this)), {
            scope: 'public_profile,email'
          });
        } else {
          return FB.login(((function(_this) {
            return function(response) {
              return _this.checkPermissions(response, link);
            };
          })(this)), {
            scope: 'public_profile,email',
            auth_type: 'rerequest'
          });
        }
        break;
      default:
        throw new Error(method + ' unsupported');
    }
  };

  FacebookConnectModel.prototype.checkPermissions = function(res, link) {
    var userid;
    if (link == null) {
      link = false;
    }
    if ((res != null) && (res.authResponse != null)) {
      userid = res.authResponse.userID;
      if (userid) {
        FB.api('/' + userid + '/permissions', (function(_this) {
          return function(response) {
            var data, key, permission, _results;
            if (response && !response.error) {
              data = response.data;
              _results = [];
              for (key in data) {
                permission = data[key];
                if (permission.permission === "email") {
                  if (permission.status === "granted") {
                    if (link) {
                      _results.push(_this.fbLink(res));
                    } else {
                      _results.push(_this.onFbConnect(res));
                    }
                  } else {
                    _results.push(_this.notifyPermissionsError("Please provide e-mail address, it will provide you with a better stumble experience."));
                  }
                } else {
                  _results.push(void 0);
                }
              }
              return _results;
            } else {
              return _this.notifyPermissionsError("Please provide us the necessary permissions, or signup via e-mail");
            }
          };
        })(this));
      }
    }
  };

  FacebookConnectModel.prototype.onFbConnect = function(res) {
    var data, options, user;
    if (((res != null ? res.authResponse : void 0) != null) && res.authResponse.accessToken && res.authResponse.expiresIn && res.authResponse.userID) {
      data = {
        fb_id: res.authResponse.userID,
        fb_token_lifetime: res.authResponse.expiresIn,
        fb_token: res.authResponse.accessToken
      };
      options = {
        data: data,
        error: this.fbSignup,
        success: this.notifyFbLogin
      };
      user = new SU.User;
      return request(user.fbConnect, [null, null, options]);
    }
  };

  FacebookConnectModel.prototype.fbSignup = function(res, data) {
    var options, user;
    if (data != null) {
      options = {
        data: data,
        success: this.notifyFbSignup,
        error: this.notifyError
      };
      user = new SU.User;
      return request(user.fbSignup, [null, null, options]);
    }
  };

  FacebookConnectModel.prototype.fbLink = function(res) {
    var data, options, user;
    if (((res != null ? res.authResponse : void 0) != null) && res.authResponse.accessToken && res.authResponse.expiresIn && res.authResponse.userID) {
      data = {
        fb_id: res.authResponse.userID,
        fb_token_lifetime: res.authResponse.expiresIn,
        fb_token: res.authResponse.accessToken
      };
      options = {
        data: data,
        success: this.notifyFbLink,
        error: this.notifyError
      };
      user = new SU.User;
      return request(user.fbLink, [null, null, options]);
    }
  };

  FacebookConnectModel.prototype.fbUnlink = function() {
    var options, user;
    options = {
      success: this.notifyFbUnlink,
      error: this.notifyError
    };
    user = new SU.User;
    return request(user.fbUnlink, [null, null, options]);
  };

  FacebookConnectModel.prototype.notifyFbUnlink = function(res) {
    return this.publishEvent('fb:model:unlink:success', res);
  };

  FacebookConnectModel.prototype.notifyFbLogin = function(res) {
    return this.publishEvent('fb:model:login:success', res);
  };

  FacebookConnectModel.prototype.notifyFbSignup = function(res) {
    return this.publishEvent('fb:model:signup:success', res);
  };

  FacebookConnectModel.prototype.notifyFbLink = function(res) {
    return this.publishEvent('fb:model:link:success', res);
  };

  FacebookConnectModel.prototype.notifyError = function(res) {
    var errorMessage, _ref;
    errorMessage = (_ref = JSON.parse(res.responseText)) != null ? _ref._error : void 0;
    return this.publishEvent('fb:model:signup:error', errorMessage);
  };

  FacebookConnectModel.prototype.notifyPermissionsError = function(message) {
    return this.publishEvent('fb:model:signup:error', message);
  };

  return FacebookConnectModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"chaplin":773}],179:[function(require,module,exports){
var FollowListModel, Model, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = FollowListModel = (function(_super) {
  __extends(FollowListModel, _super);

  function FollowListModel() {
    return FollowListModel.__super__.constructor.apply(this, arguments);
  }

  FollowListModel.prototype.sync = function(method, model, options) {
    var user;
    if (options == null) {
      options = {};
    }
    user = new SU.User;
    options.data = {
      userid: model.get('userid'),
      listId: model.get('listid')
    };
    switch (method) {
      case 'create':
        return request(user.followList, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return FollowListModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],180:[function(require,module,exports){
var FollowModel, Model, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = FollowModel = (function(_super) {
  __extends(FollowModel, _super);

  function FollowModel() {
    return FollowModel.__super__.constructor.apply(this, arguments);
  }

  FollowModel.prototype.sync = function(method, model, options) {
    var success, user;
    if (options == null) {
      options = {};
    }
    user = new SU.User;
    options.data = {
      userid: model.get('userid')
    };
    success = options.success || function() {};
    options.success = (function(_this) {
      return function() {
        _this.publishEvent('mutual:update');
        return success(arguments);
      };
    })(this);
    switch (method) {
      case 'create':
        return request(user.follow, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return FollowModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],181:[function(require,module,exports){
var FollowUserModel, Model,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

module.exports = FollowUserModel = (function(_super) {
  __extends(FollowUserModel, _super);

  function FollowUserModel() {
    return FollowUserModel.__super__.constructor.apply(this, arguments);
  }

  FollowUserModel.prototype.idAttribute = 'userid';

  return FollowUserModel;

})(Model);


},{"./base/model":168}],182:[function(require,module,exports){
var Collection, FollowUserM, FollowersCollection, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

FollowUserM = require('./follow-user-model');

module.exports = FollowersCollection = (function(_super) {
  __extends(FollowersCollection, _super);

  function FollowersCollection() {
    return FollowersCollection.__super__.constructor.apply(this, arguments);
  }

  FollowersCollection.prototype.model = FollowUserM;

  FollowersCollection.prototype.sync = function(method, model, options) {
    this.user = new SU.User;
    switch (method) {
      case 'read':
        return request(this.user.followers, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  FollowersCollection.prototype.parse = function(res) {
    return this._parsePaginated(res.followers);
  };

  return FollowersCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./follow-user-model":181}],183:[function(require,module,exports){
var Collection, FollowUserM, FollowingCollection, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

FollowUserM = require('./follow-user-model');

module.exports = FollowingCollection = (function(_super) {
  __extends(FollowingCollection, _super);

  function FollowingCollection() {
    return FollowingCollection.__super__.constructor.apply(this, arguments);
  }

  FollowingCollection.prototype.model = FollowUserM;

  FollowingCollection.prototype.sync = function(method, model, options) {
    this.user = new SU.User;
    switch (method) {
      case 'read':
        return request(this.user.following, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  FollowingCollection.prototype.parse = function(res) {
    return this._parsePaginated(res.following);
  };

  return FollowingCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./follow-user-model":181}],184:[function(require,module,exports){
var GoogleConnectModel, Model, SU, mediator, moment, request, utils,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

utils = require('../lib/utils');

request = require('../lib/request');

mediator = require('chaplin').mediator;

moment = require('moment');

module.exports = GoogleConnectModel = (function(_super) {
  __extends(GoogleConnectModel, _super);

  function GoogleConnectModel() {
    this.notifyLoginSuccess = __bind(this.notifyLoginSuccess, this);
    this.notifySignupSuccess = __bind(this.notifySignupSuccess, this);
    this.notifySuccess = __bind(this.notifySuccess, this);
    this.notifyError = __bind(this.notifyError, this);
    this.fakeBirthdayFromAge = __bind(this.fakeBirthdayFromAge, this);
    this.googleLink = __bind(this.googleLink, this);
    this.googleSignup = __bind(this.googleSignup, this);
    this.googleConnect = __bind(this.googleConnect, this);
    return GoogleConnectModel.__super__.constructor.apply(this, arguments);
  }

  GoogleConnectModel.prototype._token = '';

  GoogleConnectModel.prototype._id = '';

  GoogleConnectModel.prototype._token_lifetime = '';

  GoogleConnectModel.prototype.initialize = function() {
    GoogleConnectModel.__super__.initialize.apply(this, arguments);
    return gapi.load('auth2', (function(_this) {
      return function() {
        if (gapi.auth2.getAuthInstance() == null) {
          return gapi.client.load('plus', 'v1').then(function() {
            return gapi.auth2.init({
              fetch_basic_profile: false,
              scope: utils.getGoogleConfigs().scopes
            }).then(function() {
              var auth2;
              auth2 = gapi.auth2.getAuthInstance();
              _this.bindConnectButton();
              if (_this.get('link')) {
                return auth2.currentUser.listen(_this.googleLink);
              } else {
                return auth2.currentUser.listen(_this.googleConnect);
              }
            });
          });
        }
      };
    })(this));
  };

  GoogleConnectModel.prototype.googleConnect = function() {
    var auth2, currentUser, data, options, user, _ref;
    auth2 = (_ref = gapi.auth2) != null ? _ref.getAuthInstance() : void 0;
    if (auth2 != null) {
      if (auth2.isSignedIn.get()) {
        currentUser = auth2.currentUser.get();
        this._token = currentUser.getAuthResponse().access_token;
        this._token_lifetime = currentUser.getAuthResponse().expires_in;
        this._id = currentUser.getId();
        if (this._id) {
          data = {
            token: this._token,
            id: this._id,
            token_lifetime: this._token_lifetime
          };
          options = {
            data: data,
            success: this.notifyLoginSuccess,
            error: this.googleSignup
          };
          user = new SU.User;
          return request(user.googleConnect, [null, null, options]);
        } else {
          return this.notifyError();
        }
      }
    }
  };

  GoogleConnectModel.prototype.googleSignup = function() {
    var auth2, birthday, data, options, user, _ref;
    auth2 = (_ref = gapi.auth2) != null ? _ref.getAuthInstance() : void 0;
    if (auth2 != null) {
      if (auth2.isSignedIn.get()) {
        if (this.get('_age')) {
          birthday = this.fakeBirthdayFromAge(parseInt(this.get('_age')));
          data = {
            token: this._token,
            birthday: birthday
          };
          options = {
            data: data,
            success: this.notifySignupSuccess,
            error: this.notifyError
          };
          user = new SU.User;
          return request(user.googleSignup, [null, null, options]);
        } else {
          return this.publishEvent('google:model:askAge', this);
        }
      }
    }
  };

  GoogleConnectModel.prototype.googleLink = function() {
    var auth2, data, options, user, _ref;
    auth2 = (_ref = gapi.auth2) != null ? _ref.getAuthInstance() : void 0;
    if (auth2 != null) {
      if (auth2.isSignedIn.get()) {
        this._token = auth2.currentUser.get().getAuthResponse().access_token;
        data = {
          token: this._token
        };
        options = {
          data: data,
          success: this.notifySuccess,
          error: this.notifyError
        };
        user = new SU.User;
        return request(user.googleLink, [null, null, options]);
      }
    }
  };

  GoogleConnectModel.prototype.googleUnlink = function() {
    var user, _ref;
    if ((typeof gapi !== "undefined" && gapi !== null ? (_ref = gapi.auth2) != null ? _ref.getAuthInstance() : void 0 : void 0) != null) {
      gapi.auth2.getAuthInstance().disconnect();
    }
    user = new SU.User;
    return request(user.googleUnlink, [null, null, {}]);
  };

  GoogleConnectModel.prototype.bindConnectButton = function() {
    var targetElement, _ref, _ref1;
    targetElement = document.getElementById("google-connect-button");
    return (_ref = gapi.auth2) != null ? (_ref1 = _ref.getAuthInstance()) != null ? _ref1.attachClickHandler(targetElement) : void 0 : void 0;
  };

  GoogleConnectModel.prototype.fakeBirthdayFromAge = function(age) {
    var m;
    m = moment();
    m.year(m.year() - age);
    return m.format("YYYY-M-D");
  };

  GoogleConnectModel.prototype.notifyError = function(res) {
    var errorMessage, _ref;
    if (res == null) {
      res = '';
    }
    if (res === '') {
      errorMessage = "Sorry, couldn't connect, try again later.";
    } else {
      errorMessage = (_ref = JSON.parse(res.responseText)) != null ? _ref._error : void 0;
    }
    return this.publishEvent('google:model:error', errorMessage);
  };

  GoogleConnectModel.prototype.notifySuccess = function() {
    return this.publishEvent('google:model:success');
  };

  GoogleConnectModel.prototype.notifySignupSuccess = function(res) {
    return this.publishEvent('google:model:signup:success', res);
  };

  GoogleConnectModel.prototype.notifyLoginSuccess = function(res) {
    return this.publishEvent('google:model:login:success', res);
  };

  return GoogleConnectModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"chaplin":773,"moment":778}],185:[function(require,module,exports){
var Collection, HistoryCollection, ProfileListItemModel, SU, request, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

ProfileListItemModel = require('./profile-list-item-model');

_ = require('lodash');

module.exports = HistoryCollection = (function(_super) {
  __extends(HistoryCollection, _super);

  function HistoryCollection() {
    return HistoryCollection.__super__.constructor.apply(this, arguments);
  }

  HistoryCollection.prototype.model = ProfileListItemModel;

  HistoryCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(SU.History.getStumbles, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  HistoryCollection.prototype.parse = function(res) {
    var _ref;
    this._total = (_ref = res.stumbles) != null ? _ref._total : void 0;
    return this._parsePaginated(res.stumbles);
  };

  return HistoryCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./profile-list-item-model":216,"lodash":776}],186:[function(require,module,exports){
var IdentityModel, Model, SU, mediator, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SU = require('../lib/su');

Model = require('./base/model');

request = require('../lib/request');

mediator = require('chaplin').mediator;

module.exports = IdentityModel = (function(_super) {
  __extends(IdentityModel, _super);

  function IdentityModel() {
    return IdentityModel.__super__.constructor.apply(this, arguments);
  }

  IdentityModel.prototype.initialize = function() {
    IdentityModel.__super__.initialize.apply(this, arguments);
    return this.on('sync', (function(_this) {
      return function(model, resp) {
        var _ref;
        if (model.get('userid') === ((_ref = mediator.userM) != null ? _ref.get('userid') : void 0)) {
          return _this.set('_isSelf', true);
        } else {
          return _this.set('_isSelf', false);
        }
      };
    })(this));
  };

  IdentityModel.prototype.sync = function(method, model, options) {
    this.user = new SU.User;
    switch (method) {
      case 'read':
        return request(this.user.get, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  IdentityModel.prototype.parse = function(res) {
    var user;
    user = res != null ? res.user : void 0;
    if (user && user.likes_count) {
      user.likes_count = Math.max(0, user.likes_count);
    }
    return user;
  };

  return IdentityModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"chaplin":773}],187:[function(require,module,exports){
var InterestModel, Mixin, Model, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Mixin = require('mixen');

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = InterestModel = (function(_super) {
  __extends(InterestModel, _super);

  function InterestModel() {
    return InterestModel.__super__.constructor.apply(this, arguments);
  }

  InterestModel.prototype.initialize = function(attributes, options) {
    var InterestsC;
    InterestsC = require('../models/interests-collection');
    if ((attributes != null ? attributes.values : void 0) && !(options != null ? options.subInterestsC : void 0)) {
      return this.set('subInterestsC', new InterestsC(attributes != null ? attributes.values : void 0));
    }
  };

  InterestModel.prototype.sync = function(method, model, options) {
    var user;
    if (options == null) {
      options = {};
    }
    user = new SU.User;
    options.data = {
      userid: model.get('userid')
    };
    switch (method) {
      case 'create':
        return request(user.follow, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  InterestModel.prototype.getId = function() {
    var _ref;
    return (_ref = this.get('id')) != null ? _ref.toString() : void 0;
  };

  InterestModel.prototype.getName = function() {
    return this.get('name');
  };

  InterestModel.prototype.getSlug = function() {
    return this.get('name').toLowerCase().replace(' ', '-').replace('_', '-').replace('/', '-');
  };

  return InterestModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../models/interests-collection":188,"./base/model":168,"mixen":777}],188:[function(require,module,exports){
var Collection, InterestM, InterestV, InterestsCollection, ItemSelectionV, SU, ViewDecorator, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

InterestM = require('./interest-model');

request = require('../lib/request');

ViewDecorator = require('../views/decorators/decorator');

InterestV = require('../views/settings/interest-view');

ItemSelectionV = require('../views/widgets/item-selection-view');


/** a collection of the interest from the interests api endpoint.  caches to html5 storage for 1 day by default */

module.exports = InterestsCollection = (function(_super) {
  __extends(InterestsCollection, _super);

  function InterestsCollection() {
    this.getLeafInterests = __bind(this.getLeafInterests, this);
    return InterestsCollection.__super__.constructor.apply(this, arguments);
  }

  InterestsCollection.prototype.model = InterestM;

  InterestsCollection.prototype.announceEvents = 'interest';

  InterestsCollection.prototype.parse = function(obj) {
    return obj.interests.values;
  };

  InterestsCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(SU.Interests.getInterests, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  InterestsCollection.prototype.eachLeafNode = function(iteratee) {
    var scanModels;
    scanModels = function(collection, iteratee) {
      return collection.forEach(function(interestModel) {
        var subInterests;
        subInterests = interestModel.get('subInterestsC');
        if (subInterests != null ? subInterests.length : void 0) {
          return scanModels(subInterests, iteratee);
        } else {
          return iteratee(interestModel);
        }
      });
    };
    return scanModels(this, iteratee);
  };

  InterestsCollection.prototype.getLeafInterests = function() {
    var flattened, scanModels;
    flattened = new InterestsCollection();
    scanModels = function(collection, flattened) {
      return collection.forEach(function(interestModel) {
        var subInterests;
        subInterests = interestModel.get('subInterestsC');
        if (subInterests != null ? subInterests.length : void 0) {
          return scanModels(subInterests, flattened);
        } else {
          return flattened.add(interestModel.clone());
        }
      });
    };
    scanModels(this, flattened);
    return flattened;
  };


  /*
   * override the default method to return a view constructor
   */

  InterestsCollection.prototype.getTabViewConstructorForAction = function(action) {
    var ItemView, TabContentView;
    ItemView = ViewDecorator.makeCheckable(InterestV);
    return TabContentView = (function(_super1) {
      __extends(TabContentView, _super1);

      function TabContentView() {
        return TabContentView.__super__.constructor.apply(this, arguments);
      }

      TabContentView.prototype.itemView = ItemView;

      return TabContentView;

    })(ItemSelectionV);
  };


  /*
   * override the default method to retrieve data for an action (see tab-view-provider)
   */

  InterestsCollection.prototype.getDataForAction = function(action) {
    var interestModel;
    interestModel = this.find((function(_this) {
      return function(model) {
        return _this._keyFromValue(model.get('name')) === action;
      };
    })(this));
    this.currentActionData = interestModel != null ? interestModel.get('subInterestsC') : void 0;
    return this.currentActionData;
  };


  /*
   * override default method to get an array of action: buttonText mappings (see tab-view-provider)
   */

  InterestsCollection.prototype.getActionToButtonTextMap = function() {
    this.actionToButtonTextMap = this.map((function(_this) {
      return function(model) {
        var key, value;
        value = model.get('name');
        if (value) {
          key = _this._keyFromValue(value);
          return [key, value];
        } else {
          return ['', ''];
        }
      };
    })(this));
    this.actionToButtonTextMap.unshift(['my-interests', 'My Interests']);
    return this.actionToButtonTextMap;
  };

  InterestsCollection.prototype.findById = function(interestId) {
    var leafInterests;
    leafInterests = this.getLeafInterests();
    return leafInterests.get(interestId);
  };

  InterestsCollection.prototype.findByName = function(interestNameOrSlug) {
    var interestSlug, leafInterests, normalize;
    normalize = function(abnormal) {
      return abnormal.toLowerCase().replace(' ', '-').replace('_', '-').replace('/', '-');
    };
    interestSlug = normalize(interestNameOrSlug);
    leafInterests = this.getLeafInterests();
    return leafInterests.find(function(interest) {
      return normalize(interest.getSlug()) === interestSlug;
    });
  };

  return InterestsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"../views/decorators/decorator":629,"../views/settings/interest-view":709,"../views/widgets/item-selection-view":742,"./base/collection":167,"./interest-model":187}],189:[function(require,module,exports){
var LikerModel, Model, SU, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SU = require('../lib/su');

Model = require('./base/model');

mediator = require('chaplin').mediator;

module.exports = LikerModel = (function(_super) {
  __extends(LikerModel, _super);

  function LikerModel() {
    return LikerModel.__super__.constructor.apply(this, arguments);
  }

  LikerModel.prototype.defaults = {
    '_sortOrder': 2
  };

  LikerModel.prototype.initialize = function() {
    LikerModel.__super__.initialize.apply(this, arguments);
    return this.setSortOrder();
  };

  LikerModel.prototype.setSortOrder = function() {
    var _ref;
    if (((_ref = mediator.userM) != null ? _ref.get('username') : void 0) === this.get('username')) {
      return this.set('_sortOrder', 3);
    } else {
      if (this.get('is_followed')) {
        return this.set('_sortOrder', 0);
      } else if (this.get('thumbnail')) {
        return this.set('_sortOrder', 1);
      }
    }
  };

  return LikerModel;

})(Model);


},{"../lib/su":153,"./base/model":168,"chaplin":773}],190:[function(require,module,exports){
var Collection, LikerM, LikersCollection, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

LikerM = require('./liker-model');

module.exports = LikersCollection = (function(_super) {
  __extends(LikersCollection, _super);

  function LikersCollection() {
    return LikersCollection.__super__.constructor.apply(this, arguments);
  }

  LikersCollection.prototype.model = LikerM;

  LikersCollection.prototype.comparator = '_sortOrder';

  LikersCollection.prototype.getTotal = function() {
    return this.totalCount;
  };

  LikersCollection.prototype.getTotalRemainder = function(total) {
    if (total > 5) {
      return total - 5;
    }
  };

  LikersCollection.prototype.spliceFirst = function(count) {
    return this.slice(0, count);
  };

  LikersCollection.prototype.spliceRemainder = function(index) {
    return this.slice(index, this.length);
  };

  LikersCollection.prototype.sync = function(method, model, options) {
    if (options.data == null) {
      options.data = {
        urlid: this.get('urlid')
      };
    }
    switch (method) {
      case 'read':
        return request(SU.Url.getLikers, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  LikersCollection.prototype.parse = function(res) {
    return this._parsePaginated(res.likers);
  };

  return LikersCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./liker-model":189}],191:[function(require,module,exports){
var LikersPreviewModel, Model, SU,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SU = require('../lib/su');

Model = require('./base/model');

module.exports = LikersPreviewModel = (function(_super) {
  __extends(LikersPreviewModel, _super);

  function LikersPreviewModel() {
    return LikersPreviewModel.__super__.constructor.apply(this, arguments);
  }

  return LikersPreviewModel;

})(Model);


},{"../lib/su":153,"./base/model":168}],192:[function(require,module,exports){
var Collection, LikesAdditionsCollection, ProfileListItemModel, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

ProfileListItemModel = require('./profile-list-item-model');

module.exports = LikesAdditionsCollection = (function(_super) {
  __extends(LikesAdditionsCollection, _super);

  function LikesAdditionsCollection() {
    return LikesAdditionsCollection.__super__.constructor.apply(this, arguments);
  }

  LikesAdditionsCollection.prototype.model = ProfileListItemModel;

  LikesAdditionsCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(SU.History.getAdditions, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  LikesAdditionsCollection.prototype.parse = function(res) {
    var _ref;
    this._total = (_ref = res.likes) != null ? _ref._total : void 0;
    return this._parsePaginated(res.likes);
  };

  return LikesAdditionsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./profile-list-item-model":216}],193:[function(require,module,exports){
var Collection, LikesCollection, ProfileListItemModel, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

ProfileListItemModel = require('./profile-list-item-model');

module.exports = LikesCollection = (function(_super) {
  __extends(LikesCollection, _super);

  function LikesCollection() {
    return LikesCollection.__super__.constructor.apply(this, arguments);
  }

  LikesCollection.prototype.model = ProfileListItemModel;

  LikesCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(SU.History.getLikes, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  LikesCollection.prototype.parse = function(res) {
    var _ref;
    this._total = (_ref = res.likes) != null ? _ref._total : void 0;
    return this._parsePaginated(res.likes);
  };

  return LikesCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./profile-list-item-model":216}],194:[function(require,module,exports){
var LikesCollection, LikesForInterestCollection, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

LikesCollection = require('./likes-collection');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = LikesForInterestCollection = (function(_super) {
  __extends(LikesForInterestCollection, _super);

  function LikesForInterestCollection() {
    return LikesForInterestCollection.__super__.constructor.apply(this, arguments);
  }

  LikesForInterestCollection.prototype.initialize = function(models, options) {
    this.userId = options != null ? options.userId : void 0;
    return this.interestId = options != null ? options.interestId : void 0;
  };

  LikesForInterestCollection.prototype.sync = function(method, model, options) {
    var user, _base, _base1, _base2;
    if (options == null) {
      options = {};
    }
    user = new SU.User;
    if (options.data == null) {
      options.data = {};
    }
    if ((_base = options.data).interestid == null) {
      _base.interestid = this.interestId;
    }
    if ((_base1 = options.data).userid == null) {
      _base1.userid = this.userId;
    }
    if ((_base2 = options.data).v == null) {
      _base2.v = 2;
    }
    switch (method) {
      case 'read':
        return request(user.getLikesForInterest, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return LikesForInterestCollection;

})(LikesCollection);


},{"../lib/request":128,"../lib/su":153,"./likes-collection":193}],195:[function(require,module,exports){
var LikesCollection, LikesForTagCollection, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

LikesCollection = require('./likes-collection');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = LikesForTagCollection = (function(_super) {
  __extends(LikesForTagCollection, _super);

  function LikesForTagCollection() {
    return LikesForTagCollection.__super__.constructor.apply(this, arguments);
  }

  LikesForTagCollection.prototype.initialize = function(models, options) {
    this.userId = options != null ? options.userId : void 0;
    return this.tagId = options != null ? options.tagId : void 0;
  };

  LikesForTagCollection.prototype.sync = function(method, model, options) {
    var user, _base, _base1, _base2;
    if (options == null) {
      options = {};
    }
    user = new SU.User;
    if (options.data == null) {
      options.data = {};
    }
    if ((_base = options.data).tagid == null) {
      _base.tagid = this.tagId;
    }
    if ((_base1 = options.data).userid == null) {
      _base1.userid = this.userId;
    }
    if ((_base2 = options.data).v == null) {
      _base2.v = 2;
    }
    switch (method) {
      case 'read':
        return request(user.getLikesForTag, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return LikesForTagCollection;

})(LikesCollection);


},{"../lib/request":128,"../lib/su":153,"./likes-collection":193}],196:[function(require,module,exports){
var Collection, LikesPhotosCollection, ProfileListItemModel, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

ProfileListItemModel = require('./profile-list-item-model');

module.exports = LikesPhotosCollection = (function(_super) {
  __extends(LikesPhotosCollection, _super);

  function LikesPhotosCollection() {
    return LikesPhotosCollection.__super__.constructor.apply(this, arguments);
  }

  LikesPhotosCollection.prototype.model = ProfileListItemModel;

  LikesPhotosCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(SU.History.getPhotoLikes, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  LikesPhotosCollection.prototype.parse = function(res) {
    var _ref;
    this._total = (_ref = res.likes) != null ? _ref._total : void 0;
    return this._parsePaginated(res.likes);
  };

  return LikesPhotosCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./profile-list-item-model":216}],197:[function(require,module,exports){
var Collection, LikesSearchCollection, ProfileListItemModel, SU, request, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

ProfileListItemModel = require('./profile-list-item-model');

_ = require('lodash');

module.exports = LikesSearchCollection = (function(_super) {
  __extends(LikesSearchCollection, _super);

  function LikesSearchCollection() {
    return LikesSearchCollection.__super__.constructor.apply(this, arguments);
  }

  LikesSearchCollection.prototype.model = ProfileListItemModel;

  LikesSearchCollection.prototype.initialize = function(models, options) {
    return this.query = options != null ? options.query : void 0;
  };

  LikesSearchCollection.prototype.sync = function(method, model, options) {
    options.data = options.data || {};
    if (!options.data.q) {
      options.data.q = this.query;
      options.error = (function(_this) {
        return function(response, options) {
          var fauxResponse;
          options = _.extend({
            parse: true
          }, options);
          fauxResponse = {
            _success: true,
            likes: {
              _limit: (options != null ? options.limit : void 0) || 30,
              _offset: (options != null ? options.offset : void 0) || 0,
              _total: 0,
              values: []
            }
          };
          _this.set(fauxResponse, options);
          return _this.trigger('sync', _this, response, options);
        };
      })(this);
    }
    switch (method) {
      case 'read':
        return request(SU.History.searchLikes, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  LikesSearchCollection.prototype.parse = function(res) {
    var _ref;
    this._total = (_ref = res.likes) != null ? _ref._total : void 0;
    return this._parsePaginated(res.likes);
  };

  return LikesSearchCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./profile-list-item-model":216,"lodash":776}],198:[function(require,module,exports){
var Collection, LikesVideosCollection, ProfileListItemModel, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

ProfileListItemModel = require('./profile-list-item-model');

module.exports = LikesVideosCollection = (function(_super) {
  __extends(LikesVideosCollection, _super);

  function LikesVideosCollection() {
    return LikesVideosCollection.__super__.constructor.apply(this, arguments);
  }

  LikesVideosCollection.prototype.model = ProfileListItemModel;

  LikesVideosCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(SU.History.getVideoLikes, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  LikesVideosCollection.prototype.parse = function(res) {
    var _ref;
    this._total = (_ref = res.likes) != null ? _ref._total : void 0;
    return this._parsePaginated(res.likes);
  };

  return LikesVideosCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./profile-list-item-model":216}],199:[function(require,module,exports){
var ListItemCollection, SU, StumbleM, StumblesC, mediator, request, stumble,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

StumblesC = require('./stumbles-collection');

StumbleM = require('./stumble-model');

SU = require('../lib/su');

mediator = require('chaplin').mediator;

request = require('../lib/request');

stumble = require('../lib/stumble');

module.exports = ListItemCollection = (function(_super) {
  __extends(ListItemCollection, _super);

  function ListItemCollection() {
    return ListItemCollection.__super__.constructor.apply(this, arguments);
  }

  ListItemCollection.prototype.model = StumbleM;

  ListItemCollection.prototype.listPosition = null;

  ListItemCollection.prototype.initialize = function() {
    ListItemCollection.__super__.initialize.apply(this, arguments);
    return this.subscribeEvent('mode:activechanged', (function(_this) {
      return function() {
        return _this.reset();
      };
    })(this));
  };

  ListItemCollection.prototype.addCurrentStumble = function() {
    var currentStumble, currentStumbleUrlid, existingM;
    currentStumble = stumble.getCollection().getActive();
    currentStumbleUrlid = currentStumble.get('urlid');
    existingM = this.findWhere({
      'urlid': currentStumbleUrlid
    });
    if (currentStumble.get('_legacy')) {
      return this.publishEvent('list:itemadded:error', {}, true);
    } else if (existingM != null) {
      return this.publishEvent('list:itemadded:error');
    } else {
      return this.add({
        'urlid': currentStumbleUrlid
      });
    }
  };

  ListItemCollection.prototype.fillBuffer = function() {
    return null;
  };

  ListItemCollection.prototype.getNext = function() {
    return this.fetch({
      fresh: true,
      merge: true
    }).then((function(_this) {
      return function(res) {
        var _ref, _ref1;
        _this.listPosition = res != null ? (_ref = res.url) != null ? _ref.list_position : void 0 : void 0;
        return _this.get(res != null ? (_ref1 = res.url) != null ? _ref1.urlid : void 0 : void 0);
      };
    })(this));
  };

  ListItemCollection.prototype.getListPosition = function() {
    return parseInt(this.listPosition);
  };

  ListItemCollection.prototype.getDefaultOptions = function() {
    var currentMode;
    currentMode = mediator.modesC.getActive();
    return {
      data: {
        guesses: 0,
        listId: currentMode != null ? currentMode.get('listId') : void 0,
        listPosition: this.getListPosition() + 1 || 0
      }
    };
  };

  ListItemCollection.prototype.whereSeen = function() {
    return this.filter(function(model) {
      var currentMode;
      currentMode = mediator.modesC.getActive();
      return model.get('_seen') && (currentMode != null ? currentMode.get('listId') : void 0) === model.get('_listId');
    });
  };

  ListItemCollection.prototype.whereUnseen = function() {
    return this.reject(function(model) {
      return model.get('_seen');
    });
  };

  ListItemCollection.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    switch (method) {
      case 'read':
        return request(SU.Stumble.list, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return ListItemCollection;

})(StumblesC);


},{"../lib/request":128,"../lib/stumble":130,"../lib/su":153,"./stumble-model":239,"./stumbles-collection":240,"chaplin":773}],200:[function(require,module,exports){
var ListItemsC, ListModel, Model, SU, mediator, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

ListItemsC = require('./list-items-collection');

mediator = require('chaplin').mediator;

module.exports = ListModel = (function(_super) {
  __extends(ListModel, _super);

  function ListModel() {
    return ListModel.__super__.constructor.apply(this, arguments);
  }

  ListModel.prototype.defaults = {
    'name': 'New List',
    'visibility': 'public',
    '_visible': true
  };

  ListModel.prototype.initialize = function() {
    ListModel.__super__.initialize.apply(this, arguments);
    this.set('listItemsC', new ListItemsC());
    this.on('sync', (function(_this) {
      return function(model, resp) {
        var _ref;
        if (!_this.has('id')) {
          return _this.set('id', (_ref = resp.list) != null ? _ref.id : void 0);
        }
      };
    })(this));
    this.get('listItemsC').on('add', (function(_this) {
      return function() {
        return _this.save().then(function() {
          _this.publishEvent('list:loading:end');
          return _this.publishEvent('list:itemadded', _this);
        }, function() {
          _this.publishEvent('list:loading:end');
          return _this.publishEvent('list:itemadded:error', _this);
        });
      };
    })(this));
    return this.on('change:id', (function(_this) {
      return function() {
        return _this.publishEvent('list:added', _this);
      };
    })(this));
  };

  ListModel.prototype.sync = function(method, model, options) {
    var listItemsC;
    if (options == null) {
      options = {};
    }
    this.publishEvent('model:sync:start', this);
    listItemsC = model.get('listItemsC');
    if (listItemsC.length > 0) {
      method = 'update';
      options.data = {
        listId: this.get('id'),
        urlid: listItemsC.last().get('urlid')
      };
    }
    if (method === 'create') {
      options.data = model.toJSON();
      delete options.data.listItemsC;
    }
    switch (method) {
      case 'create':
        return request(SU.Lists.create, arguments);
      case 'update':
        return request(SU.Lists.addItem, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return ListModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"./list-items-collection":199,"chaplin":773}],201:[function(require,module,exports){
var ListMetaModel, Model, SU, mediator, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

mediator = require('chaplin').mediator;

module.exports = ListMetaModel = (function(_super) {
  __extends(ListMetaModel, _super);

  function ListMetaModel() {
    return ListMetaModel.__super__.constructor.apply(this, arguments);
  }

  ListMetaModel.prototype.initialize = function() {
    ListMetaModel.__super__.initialize.apply(this, arguments);
    return this.on('change:name', this.onChangeName, this);
  };

  ListMetaModel.prototype.onChangeName = function() {
    return mediator.publish('list:changename', this, this.get('name'));
  };

  ListMetaModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    if (method !== 'read') {
      options.data = model.toJSON();
    }
    switch (method) {
      case 'create':
        return request(SU.Lists.create, arguments);
      case 'read':
        return request(SU.Lists.getMeta, arguments);
      case 'update':
        return request(SU.Lists.update, arguments);
      case 'delete':
        return request(SU.Lists["delete"], arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ListMetaModel.prototype.parse = function(res) {
    return res.list;
  };

  return ListMetaModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"chaplin":773}],202:[function(require,module,exports){
var Collection, ListM, ListsCollection, SU, mediator, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

ListM = require('./list-model');

request = require('../lib/request');

mediator = require('chaplin').mediator;

module.exports = ListsCollection = (function(_super) {
  __extends(ListsCollection, _super);

  function ListsCollection() {
    return ListsCollection.__super__.constructor.apply(this, arguments);
  }

  ListsCollection.prototype.model = ListM;

  ListsCollection.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    if (options.data == null) {
      options.data = {
        id: mediator.userM.get('userid'),
        sorted: true
      };
    }
    switch (method) {
      case 'read':
        return request(SU.Lists.get, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ListsCollection.prototype.parse = function(res) {
    var _ref, _ref1;
    this._total = (_ref = res.lists) != null ? _ref._total : void 0;
    return (_ref1 = res.lists) != null ? _ref1.values : void 0;
  };

  return ListsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./list-model":200,"chaplin":773}],203:[function(require,module,exports){
var $, LoginModel, Model, SU, mediator, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = LoginModel = (function(_super) {
  var recaptchaValidationDeferred;

  __extends(LoginModel, _super);

  function LoginModel() {
    this.validateRecaptcha = __bind(this.validateRecaptcha, this);
    this.notifyValidation = __bind(this.notifyValidation, this);
    this.notifyErrorResult = __bind(this.notifyErrorResult, this);
    this.notifySuccess = __bind(this.notifySuccess, this);
    return LoginModel.__super__.constructor.apply(this, arguments);
  }

  recaptchaValidationDeferred = new $.Deferred();

  LoginModel.prototype.initialize = function() {
    return this.on('invalid', function(model, error) {
      return this.notifyValidation(model, error);
    });
  };

  LoginModel.prototype.validate = function() {
    var result, _ref, _ref1;
    if (arguments != null ? arguments[0] : void 0) {
      if (((_ref = arguments[0]) != null ? _ref.username : void 0) === '') {
        result = {
          message: "Please enter a valid username",
          attribute: "username"
        };
        return result;
      } else if (((_ref1 = arguments[0]) != null ? _ref1.password : void 0) === '') {
        result = {
          message: "Please enter a valid password",
          attribute: "password"
        };
        return result;
      }
    }
  };

  LoginModel.prototype.sync = function(method, model, options) {
    var data;
    if (options == null) {
      options = {};
    }
    this.publishEvent('login:model:sync:start', this);
    data = model.toJSON();
    this.validateRecaptcha(data.recaptcha);
    return $.when(recaptchaValidationDeferred).then((function(_this) {
      return function() {
        var user;
        options = {
          success: _this.notifySuccess,
          error: _this.notifyErrorResult,
          data: data
        };
        user = new SU.User;
        switch (method) {
          case 'create':
            return request(user.login, [null, null, options]);
          default:
            throw new Error(method + ' unsupported');
        }
      };
    })(this)).fail((function(_this) {
      return function() {
        return _this.publishEvent('login:model:sync:end', _this);
      };
    })(this));
  };

  LoginModel.prototype.notifySuccess = function(res) {
    return this.publishEvent('login:model:success', res);
  };

  LoginModel.prototype.notifyErrorResult = function(res) {
    var errorMessage, result, _ref;
    errorMessage = "";
    if (res.responseText) {
      errorMessage = (_ref = JSON.parse(res.responseText)) != null ? _ref._error : void 0;
    }
    result = {
      message: errorMessage,
      attribute: "general"
    };
    return this.publishEvent('login:model:error', result);
  };

  LoginModel.prototype.notifyValidation = function(model, error) {
    return this.publishEvent('login:model:error', error);
  };

  LoginModel.prototype.validateRecaptcha = function(recaptcha) {
    var result;
    if ((recaptcha == null) || !recaptcha) {
      result = {
        message: "Please complete the captcha.",
        attribute: "general"
      };
      this.publishEvent('login:model:error', result);
      return recaptchaValidationDeferred = new $.Deferred();
    } else {
      return recaptchaValidationDeferred.resolve();
    }
  };

  return LoginModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"chaplin":773,"jquery":774}],204:[function(require,module,exports){
var $, Cache, Chaplin, moment, storage, utils, _;

_ = require('lodash');

$ = require('jquery');

Chaplin = require('chaplin');

storage = require('simple-storage');

utils = require('../../lib/utils');

moment = require('moment');

module.exports = Cache = (function() {
  function Cache() {}

  Cache.prototype.cache = {
    uid_helper: function() {
      return Chaplin.mediator.userM.get('userid');
    },
    ttl: '1d',
    checkInterval: '10m'
  };

  Cache.prototype.initialize = function(data, options) {
    if (options == null) {
      options = {};
    }
    Cache.__super__.initialize.apply(this, arguments);
    if (options.cache != null) {
      this.cache = _.defaults(options.cache, this.cache);
      this.cache['key'] = this.generateKey();
      this.on('add remove change', this.setCache);
      if (this.checkInterval) {
        return this.removingExpires = setInterval((function(_this) {
          return function() {
            return _this.removeExpired();
          };
        })(this), utils.toMs(this.cache.checkInterval));
      }
    }
  };

  Cache.prototype.getExpires = function() {
    var amount, ttl, unit;
    ttl = this.cache.ttl;
    amount = ttl.slice(0, -1);
    unit = ttl.slice(-1);
    return moment().add(unit, amount).unix();
  };

  Cache.prototype.generateKey = function() {
    var _base;
    return this.cache.uid + ((typeof (_base = this.cache).uid_helper === "function" ? _base.uid_helper() : void 0) || '');
  };

  Cache.prototype.getKey = function() {
    var _ref, _ref1;
    return ((_ref = this.collection) != null ? (_ref1 = _ref.cache) != null ? _ref1.key : void 0 : void 0) || this.cache.key;
  };

  Cache.prototype.setCache = _.debounce(function(options) {
    var data;
    data = this.chain().reject({
      '_nocache': true
    }).transform((function(_this) {
      return function(result, model) {
        return result.push({
          id: model.id,
          expires: _this.getExpires(),
          data: model.toJSON()
        });
      };
    })(this)).value();
    return storage.set(this.getKey(), data);
  }, 100, {
    leading: true,
    trailing: true
  });

  Cache.prototype.getCache = function() {
    this.removeExpired();
    return _(storage.get(this.getKey())).transform(function(result, item) {
      return result.push(item.data);
    }).value();
  };

  Cache.prototype.hasCache = function() {
    return !_.isEmpty(storage.get(this.getKey()));
  };

  Cache.prototype.removeCache = function() {
    return storage.remove(this.getKey());
  };

  Cache.prototype.removeExpired = function() {
    var cached, notExpired, now;
    now = moment().unix();
    cached = storage.get(this.getKey());
    if (cached != null) {
      notExpired = typeof cached.filter === "function" ? cached.filter((function(_this) {
        return function(item) {
          var expired;
          expired = now > item.expires;
          if (expired) {
            _this.remove(item.id);
          }
          return !expired;
        };
      })(this)) : void 0;
      storage.set(this.getKey(), notExpired || []);
    }
    return this;
  };

  Cache.prototype.fetch = function(options) {
    var dfd;
    if (options == null) {
      options = {};
    }
    dfd = new $.Deferred;
    if (options.remove == null) {
      options.remove = false;
    }
    if (this.hasCache() && options.fresh !== true) {
      _.defer((function(_this) {
        return function() {
          var cached;
          cached = _this.getCache();
          if (options.remove) {
            _this.reset(cached, {
              silent: true
            });
          } else {
            _this.add(cached, {
              silent: true
            });
          }
          _this.trigger('sync');
          return dfd.resolve(_this, cached, options);
        };
      })(this));
      return dfd.promise();
    } else {
      return Cache.__super__.fetch.call(this, options);
    }
  };

  return Cache;

})();


},{"../../lib/utils":156,"chaplin":773,"jquery":774,"lodash":776,"moment":778,"simple-storage":780}],205:[function(require,module,exports){
var CheckableItemListProvider;

module.exports = CheckableItemListProvider = (function() {
  function CheckableItemListProvider() {}

  CheckableItemListProvider.prototype.getChecked = function() {
    return this.filter(function(interestModel) {
      return interestModel.getChecked();
    });
  };

  return CheckableItemListProvider;

})();


},{}],206:[function(require,module,exports){
var $, SearchInputListProvider, _;

$ = require('jquery');

_ = require('lodash');

module.exports = SearchInputListProvider = (function() {
  var searchFieldNameAttribute;

  function SearchInputListProvider() {}

  searchFieldNameAttribute = 'name';

  SearchInputListProvider.prototype.getSelected = function() {
    var selectableOptions;
    selectableOptions = this.where({
      _selectable: true
    });
    if (selectableOptions.length === 1) {
      return selectableOptions[0];
    }
    if (this._highlightedModel) {
      return this._highlightedModel;
    }
    return null;
  };

  SearchInputListProvider.prototype.getSelectableCount = function() {
    var selectable;
    selectable = this.where({
      '_selectable': true
    });
    return _.size(selectable);
  };

  SearchInputListProvider.prototype.setFilterText = function(filterText) {
    var count;
    this._filterText = filterText;
    count = 0;
    this.each(function(model) {
      if (model.get(searchFieldNameAttribute).toLowerCase().indexOf(filterText.toLowerCase()) > -1) {
        model.set('_selectable', true);
        return count++;
      } else {
        return model.set('_selectable', false);
      }
    });
    return count;
  };

  SearchInputListProvider.prototype.unhighlightAll = function() {
    this._highlightedModel = null;
    return this.each(function(model) {
      return model.set('_highlighted', false);
    });
  };

  SearchInputListProvider.prototype.highlightNext = function(backwards) {
    var found, handleTheHighlighting, highlighted, selectableModels;
    if (backwards == null) {
      backwards = false;
    }
    selectableModels = this.filter(function(model) {
      return model.get('_selectable');
    });
    found = false;
    highlighted = false;
    handleTheHighlighting = (function(_this) {
      return function(model) {
        if (found && !highlighted) {
          highlighted = true;
          model.set('_highlighted', true);
          _this._highlightedModel = model;
          return true;
        }
        if (model.get('_highlighted')) {
          found = true;
          return model.set('_highlighted', false);
        }
      };
    })(this);
    if (!backwards) {
      _.forEach(selectableModels, handleTheHighlighting);
      if (!found) {
        selectableModels[0].set('_highlighted', true);
        this._highlightedModel = selectableModels[0];
      }
      if (found && !highlighted) {
        selectableModels[selectableModels.length - 1].set('_highlighted', true);
        return this._highlightedModel = selectableModels[selectableModels.length - 1];
      }
    } else {
      _.forEachRight(selectableModels, handleTheHighlighting);
      if (!found) {
        selectableModels[selectableModels.length - 1].set('_highlighted', true);
      }
      if (found && !highlighted) {
        return selectableModels[0].set('_highlighted', true);
      }
    }
  };

  SearchInputListProvider.prototype.highlightPrevious = function() {
    return this.highlightNext(true);
  };

  return SearchInputListProvider;

})();


},{"jquery":774,"lodash":776}],207:[function(require,module,exports){
var SetUserThumbnail;

module.exports = SetUserThumbnail = (function() {
  function SetUserThumbnail() {}

  SetUserThumbnail.prototype.initialize = function() {
    this.setUserThumbnail();
    return this.on('change:picture_small', (function(_this) {
      return function() {
        return _this.setUserThumbnail();
      };
    })(this));
  };

  SetUserThumbnail.prototype.setUserThumbnail = function(url, force) {
    if (force == null) {
      force = false;
    }
    if (url == null) {
      url = (typeof this.getThumbUrl === "function" ? this.getThumbUrl() : void 0) || 'https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg';
    }
    return ['small', 'med', 'large'].forEach((function(_this) {
      return function(size) {
        if (!(force === false && _this.get("picture_" + size))) {
          return _this.set("picture_" + size, url);
        }
      };
    })(this));
  };

  return SetUserThumbnail;

})();


},{}],208:[function(require,module,exports){
var ActionButtonM, ItemSelectionV, TabViewProvider, defaultEventPrefix, i18n, _;

_ = require('lodash');

i18n = require('../../lib/i18n');

ItemSelectionV = require('../../views/widgets/item-selection-view');

ActionButtonM = require('../../models/action-button-model');

defaultEventPrefix = 'tab-view';


/*
 * mixin to define an interface and default implementation for collections to implement a tab view.
 */

module.exports = TabViewProvider = (function() {
  function TabViewProvider() {}


  /*
   * default way to convert a value to a key
   */

  TabViewProvider.prototype._keyFromValue = function(value) {
    return value != null ? value.trim().toLowerCase().replace(/[\/\s]/, '-') : void 0;
  };


  /*
   * default method to get an array of action: buttonText mappings
   */

  TabViewProvider.prototype.getActionToButtonTextMap = function() {
    this.actionToButtonTextMap = this.map((function(_this) {
      return function(model) {
        var key, value;
        value = model.get('name');
        key = _this._keyFromValue(value);
        return [key, value];
      };
    })(this));
    return this.actionToButtonTextMap;
  };


  /*
   * a setter for hiding action buttons in the nav bar
   */

  TabViewProvider.prototype.setHiddenActionButtons = function(hiddenActionButtons) {
    return this.hiddenActionButtons = hiddenActionButtons;
  };


  /*
   * default method to retrieve data for an action
   */

  TabViewProvider.prototype.getDataForAction = function(action) {
    var dataObject;
    dataObject = this.find((function(_this) {
      return function(model) {
        return _this._keyFromValue(model.get('name')) === action;
      };
    })(this));
    if (dataObject instanceof Chaplin.model) {
      return {
        model: dataObject
      };
    } else {
      return {
        collection: dataObject
      };
    }
  };


  /*
   * default method to return a view constructor
   */

  TabViewProvider.prototype.getTabViewConstructorForAction = function(action) {
    return ItemSelectionV;
  };

  TabViewProvider.prototype._createActionButtonsCollection = function() {
    var ActionButtonsC, actionButtonsC;
    ActionButtonsC = require('../../models/action-buttons-collection');
    actionButtonsC = this.actionButtonsC || new ActionButtonsC();
    return this._updateActionButtons(this.getActionToButtonTextMap(), actionButtonsC);
  };

  TabViewProvider.prototype._updateActionButtons = function(actionToButtonTextMap, actionButtonsC) {
    var hiddenActionButtons, newActionButtons;
    newActionButtons = [];
    hiddenActionButtons = _(this.hiddenActionButtons);
    _.each(actionToButtonTextMap, (function(_this) {
      return function(mappingObject) {
        var action, actionButtonM, buttonText;
        action = mappingObject[0];
        if (action && hiddenActionButtons.indexOf(action) === -1) {
          buttonText = mappingObject[1];
          actionButtonM = new ActionButtonM({
            id: _this.eventPrefix + '-category-button-' + action,
            action: action,
            disabled: false,
            classNames: ['btn-nav btn-sunav-sulight'],
            trackingCategory: _this.eventPrefix + '-category-click',
            trackingLabel: action,
            buttonText: i18n(buttonText)
          });
          return newActionButtons.push(actionButtonM);
        }
      };
    })(this));
    if (actionButtonsC != null) {
      actionButtonsC.add(newActionButtons);
    }
    return actionButtonsC;
  };

  TabViewProvider.prototype.getActionButtonsCollection = function() {
    return this.actionButtonsC;
  };

  TabViewProvider.prototype.selectFirstTab = function() {
    var _ref, _ref1;
    return (_ref = this.actionButtonsC) != null ? (_ref1 = _ref.first()) != null ? _ref1.setClicked(true) : void 0 : void 0;
  };


  /*
   * options.eventPrefix -- an event prefix when raising events
   * options.hiddenActionButtons -- an array of action-button actions to hide
   */

  TabViewProvider.prototype.initializeTabViewProvider = function(options) {
    this.eventPrefix = (options != null ? options.eventPrefix : void 0) || this.eventPrefix || defaultEventPrefix;
    this.hiddenActionButtons = this.hiddenActionButtons || (options != null ? options.hiddenActionButtons : void 0) || [];
    if (!this.actionButtonsC) {
      this.actionButtonsC = this._createActionButtonsCollection();
      return this.listenTo(this, 'all', _.debounce(this.onTabViewProviderUpdate));
    }
  };

  TabViewProvider.prototype.onTabViewProviderUpdate = function() {
    if (this.actionButtonsC) {
      return this._updateActionButtons(this.getActionToButtonTextMap(), this.actionButtonsC);
    }
  };

  return TabViewProvider;

})();


},{"../../lib/i18n":121,"../../models/action-button-model":159,"../../models/action-buttons-collection":160,"../../views/widgets/item-selection-view":742,"lodash":776}],209:[function(require,module,exports){
var $, WhenPopulated;

$ = require('jquery');

module.exports = WhenPopulated = (function() {
  function WhenPopulated() {}

  WhenPopulated.prototype.whenPopulated = function() {
    var dfd;
    dfd = new $.Deferred;
    if (this.length) {
      dfd.resolve(this);
    } else {
      this.on('add', (function(_this) {
        return function() {
          return dfd.resolve(_this);
        };
      })(this));
    }
    return dfd.promise();
  };

  return WhenPopulated;

})();


},{"jquery":774}],210:[function(require,module,exports){
var $, WidgetProvider;

$ = require('jquery');

module.exports = WidgetProvider = (function() {
  function WidgetProvider() {}

  WidgetProvider.prototype.widgetTextAttribute = 'name';

  WidgetProvider.prototype.widgetDataIdAttribute = 'id';

  WidgetProvider.prototype.getWidgetText = function() {
    return this.get(this.widgetTextAttribute) || 'attribute miss';
  };

  WidgetProvider.prototype.getWidgetDataId = function() {
    return this.get(this.widgetDataIdAttribute) || 'attribute miss';
  };

  WidgetProvider.prototype.setSelected = function(selected) {
    return this.set('selected', !!selected);
  };

  WidgetProvider.prototype.getSelected = function() {
    return !!this.get('selected');
  };

  WidgetProvider.prototype.setChecked = function(checked) {
    return this.set('checked', !!checked);
  };

  WidgetProvider.prototype.getChecked = function() {
    return !!this.get('checked');
  };

  WidgetProvider.prototype.setLocked = function(locked) {
    return this.set('_locked', !!locked);
  };

  WidgetProvider.prototype.getLocked = function() {
    return this.get('_locked');
  };

  WidgetProvider.prototype.toggleChecked = function() {
    return this.setChecked(!this.getChecked());
  };

  WidgetProvider.prototype.serialize = function() {
    this.set('widgetText', this.getWidgetText());
    this.set('widgetDataId', this.getWidgetDataId());
    return WidgetProvider.__super__.serialize.apply(this, arguments);
  };

  return WidgetProvider;

})();


},{"jquery":774}],211:[function(require,module,exports){
var ModeModel, Model, SU, request, storage,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SU = require('../lib/su');

Model = require('./base/model');

request = require('../lib/request');

storage = require('simple-storage');

module.exports = ModeModel = (function(_super) {
  __extends(ModeModel, _super);

  function ModeModel() {
    return ModeModel.__super__.constructor.apply(this, arguments);
  }

  ModeModel.prototype.defaults = {
    '_sortOrder': 2,
    '_active': false,
    '_hide': false
  };

  ModeModel.prototype.idAttribute = 'name';

  ModeModel.prototype.initialize = function(data, options) {
    ModeModel.__super__.initialize.apply(this, arguments);
    this.options = options;
    this.saveModeType();
    if (this.get('_mode') !== 'domain') {
      this.set('_active', storage.get('activeMode') === this.get('name'), {
        silent: true
      });
    }
    return this.on('change:_active', function() {
      if (this.get('_active') === true) {
        return storage.set('activeMode', this.get('name'));
      }
    });
  };

  ModeModel.prototype.getModeType = function() {
    if (this.get('_mode')) {
      return this.get('_mode');
    } else if (this.get('is_tag') === true && this.get('id')) {
      return 'tag';
    } else if (this.get('id')) {
      return 'topic';
    } else {
      return 'all';
    }
  };

  ModeModel.prototype.saveModeType = function() {
    return this.set('_mode', this.getModeType());
  };

  return ModeModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"simple-storage":780}],212:[function(require,module,exports){
var $, Chaplin, Collection, ModeM, ModesCollection, SU, mediator, moment, panel, request, storage, stumble, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

ModeM = require('./mode-model');

request = require('../lib/request');

Chaplin = require('chaplin');

mediator = Chaplin.mediator;

storage = require('simple-storage');

_ = require('lodash');

$ = require('jquery');

utils = require('../lib/utils');

moment = require('moment');

panel = require('../lib/panel');

stumble = require('../lib/stumble');

module.exports = ModesCollection = (function(_super) {
  __extends(ModesCollection, _super);

  function ModesCollection() {
    return ModesCollection.__super__.constructor.apply(this, arguments);
  }

  ModesCollection.prototype.model = ModeM;

  ModesCollection.prototype.announceEvents = 'mode';

  ModesCollection.prototype.stumbleThruRegex = /stumblethru:([^;\n\/\\\?\#\&\s]+)/;

  ModesCollection.prototype.pidRegex = /pid:([A-Za-z\d]+)/;

  ModesCollection.prototype.domain_cookie = 'surequesturi';

  ModesCollection.prototype.initialize = function() {
    ModesCollection.__super__.initialize.apply(this, arguments);
    if (/(\sL|^l)ikes$/.test(storage.get('activeMode'))) {
      storage.set('activeMode', 'All Interests');
    }
    this.user = new SU.User();
    this.on('sync', (function(_this) {
      return function() {
        return _this.addDefaultData();
      };
    })(this));
    this.on('reset', (function(_this) {
      return function() {
        return _this.addDefaultData();
      };
    })(this));
    this.addDefaultData();
    this.setDomainMode();
    mediator.subscribe('api:stumblesempty', this.stumblesEmpty, this);
    mediator.subscribe('api:domainstumblesempty', this.clearDomainStumbling, this);
    mediator.subscribe('api:outofstumbles', this.stumblesEmpty, this);
    return mediator.subscribe('interest:sync', this.refreshFromUserInterests, this);
  };

  ModesCollection.prototype.isStumblingDomain = function() {
    var currentMode, currentModeType;
    currentMode = this.getActive();
    currentModeType = currentMode != null ? currentMode.get('_mode') : void 0;
    return currentModeType === 'domain';
  };

  ModesCollection.prototype.clearDomainStumbling = function() {
    var currentMode, currentModeType, _ref;
    currentMode = this.getActive();
    currentModeType = currentMode.get('_mode');
    if (currentModeType === 'domain') {
      if ((_ref = stumble.getCollection()) != null ? _ref.getActive() : void 0) {
        this.setTimeout(function() {
          return panel.open('alert', {
            type: 'success',
            text: 'You viewed all of the stumbles for ' + currentMode.get('name')
          });
        }, 500);
      }
      this.remove(currentMode);
      $.removeCookie(this.domain_cookie);
      storage.set('activeMode', 'All Interests');
      return this.setActive('All Interests');
    }
  };

  ModesCollection.prototype.stumblesEmpty = function() {
    var currentMode, currentModeType;
    currentMode = this.getActive();
    currentModeType = currentMode.get('_mode');
    if (currentModeType === 'domain') {
      return;
    }
    if (currentModeType === 'all') {
      this.setActive('All Interests');
      if (!$.cookie('suggest-page')) {
        return utils.setSuggestPageCookie(0);
      }
    } else {
      this.remove(currentMode);
      storage.set('activeMode', 'All Interests');
      this.setActive('All Interests');
      if (currentModeType === 'following') {
        return utils.redirectToSuggestStumblers();
      } else {
        return this.publishEvent('stumble:next');
      }
    }
  };

  ModesCollection.prototype.fetch = function() {
    if (utils.isLoggedIn()) {
      return ModesCollection.__super__.fetch.apply(this, arguments);
    }
  };

  ModesCollection.prototype.isDomain = function(str) {
    return !!(str != null ? str.match(/\.\w{2,}/) : void 0);
  };

  ModesCollection.prototype.getDomainModel = function(domain) {
    if (!(this.isDomain(domain))) {
      domain = null;
    }
    if (domain || this.getDomain()) {
      return new ModeM({
        _mode: 'domain',
        _active: true,
        name: domain || this.getDomain(),
        _sortOrder: 1
      });
    }
  };

  ModesCollection.prototype.setDomainMode = function(givenDomain) {
    var domain;
    if ((domain = givenDomain || this.getDomain())) {
      this.setDomainParamFlag();
      this.setActive(domain, '_domain');
      return {
        urlid: this.parseOutPid(window.location.href),
        domain: domain
      };
    }
    return null;
  };

  ModesCollection.prototype.getDomain = function() {
    var domain;
    if (!domain) {
      domain = this.getDomainInCookie();
    }
    if (!domain) {
      domain = this.getStoredDomain();
    }
    return domain;
  };

  ModesCollection.prototype.getStoredDomain = function() {
    if (this.isDomain(storage.get('activeMode'))) {
      return storage.get('activeMode');
    }
  };

  ModesCollection.prototype.getDomainInCookie = function() {
    var cookieVal;
    cookieVal = $.cookie(this.domain_cookie);
    if (cookieVal) {
      $.removeCookie(this.domain_cookie);
      return this.parseOutDomain(cookieVal);
    }
  };

  ModesCollection.prototype.setDomainParamFlag = function() {
    return storage.set('domainParamFlag', true);
  };

  ModesCollection.prototype.getDomainParamFlag = function() {
    return storage.get('domainParamFlag');
  };

  ModesCollection.prototype.clearDomainParamFlag = function() {
    return storage.remove('domainParamFlag');
  };

  ModesCollection.prototype.parseOutPid = function(url) {
    if (this.pidRegex.test(url)) {
      return url.split(this.pidRegex)[1];
    }
  };

  ModesCollection.prototype.parseOutDomain = function(url) {
    var domain;
    if (url.match('domain=')) {
      domain = url.split('domain=').pop().split('/').shift().split('&').pop();
    }
    if (this.stumbleThruRegex.test(url)) {
      domain = url.split(this.stumbleThruRegex)[1];
    }
    if (!domain || domain.match(/<[a-z][\s\S]*>/)) {
      return void 0;
    }
    if (this.isDomain(domain)) {
      return domain;
    }
  };

  ModesCollection.prototype.comparator = function(model) {
    return model.get('_sortOrder');
  };

  ModesCollection.prototype.getActive = function() {
    return this.getDomainModel(this.getDomain()) || this.findWhere({
      '_active': true
    }) || this.findWhere({
      'name': 'All Interests'
    });
  };

  ModesCollection.prototype.setActive = function(name, mode) {
    var activeModel;
    if (/(\sL|^l)ikes$/.test(name) || mode === "user") {
      name = 'all';
    }
    if (mode === '_domain' || this.isDomain(name)) {
      if (!this.findWhere({
        'name': name
      })) {
        this.forEach((function(_this) {
          return function(model) {
            return model.set('_active', false);
          };
        })(this));
        this.add(this.getDomainModel(name));
      }
    } else {
      this.forEach((function(_this) {
        return function(model) {
          var _ref;
          return model.set('_active', ((_ref = model.get('name')) != null ? _ref.toLowerCase() : void 0) === name.toLowerCase());
        };
      })(this));
    }
    activeModel = this.findWhere({
      '_active': true
    }) || this.findWhere({
      'name': 'All Interests'
    });
    storage.set('activeMode', activeModel != null ? typeof activeModel.get === "function" ? activeModel.get('name') : void 0 : void 0);
    storage.set('modeInfo', activeModel);
    if (utils.isSUBrowserAddonEnabled()) {
      this.setActiveExtension(activeModel);
    }
    return this.trigger('activechanged', activeModel);
  };

  ModesCollection.prototype.setActiveExtension = function(model) {
    var extensionMode;
    switch (model.get('_mode')) {
      case 'all':
        extensionMode = {
          method: 'general'
        };
        break;
      case 'user':
        extensionMode = {
          method: 'instumbler',
          mode: 'instumbler',
          stumbler: model.get('stumblername'),
          stumblername: model.get('stumblername'),
          contextual: model.get('name'),
          stumblerId: model.get('stumblerId')
        };
        break;
      case 'list':
        extensionMode = {
          method: 'stumblelist',
          mode: 'stumblelist',
          listid: model.get('listId'),
          contextual: model.get('name')
        };
        break;
      default:
        return;
    }
    return window.suExtensionApi.stumble.setMode(extensionMode);
  };

  ModesCollection.prototype.addDefaultData = function() {
    var activeMode, modeInfo;
    modeInfo = storage.get('modeInfo');
    activeMode = storage.get('activeMode') || 'All Interests';
    this.add([
      {
        _mode: 'all',
        _sortOrder: 3,
        _active: true,
        name: 'All Interests',
        _faClass: 'fa fa-globe',
        _hide: true
      }, {
        _mode: 'following',
        _sortOrder: 3,
        name: 'Following',
        _faClass: 'fa fa-users',
        _hide: true
      }, {
        _mode: 'trending',
        _sortOrder: 3,
        name: 'Trending',
        _faClass: 'fa fa-line-chart',
        _hide: true
      }, {
        _mode: 'photos',
        _sortOrder: 3,
        name: 'Photos',
        _faClass: 'fa fa-photo',
        _hide: true
      }, {
        _mode: 'videos',
        _sortOrder: 3,
        name: 'Videos',
        _faClass: 'fa fa-video-camera',
        _hide: true
      }
    ]);
    if (modeInfo && modeInfo.name === activeMode) {
      return this.add(_.extend(modeInfo || {}, {
        name: activeMode,
        _hide: true
      }));
    } else {
      return storage.remove('modeInfo');
    }
  };

  ModesCollection.prototype.sync = function(method, model, options) {
    if (options.data == null) {
      options.data = {
        userid: mediator.userM.get('userid')
      };
    }
    switch (method) {
      case 'read':
        return request(this.user.getInterests, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ModesCollection.prototype.parse = function(res) {
    var _ref;
    return (_ref = res.interests) != null ? _ref.values : void 0;
  };

  ModesCollection.prototype.dispose = function() {
    ModesCollection.__super__.dispose.apply(this, arguments);
    mediator.unsubscribe('api:outofstumbles', this.onOutOfStumbles, this);
    mediator.unsubscribe('api:stumblesempty', this.stumblesEmpty, this);
    mediator.unsubscribe('api:domainstumblesempty', this.stumblesEmpty, this);
    return mediator.unsubscribe('interest:sync', this.refreshFromUserInterests, this);
  };

  ModesCollection.prototype.refreshFromUserInterests = function(collection, resp, options) {
    var interestModels, modeModels, _ref;
    if (utils.getLoggedInUserId() === (options != null ? (_ref = options.data) != null ? _ref.userid : void 0 : void 0)) {
      interestModels = collection.models;
      modeModels = _.map(interestModels, function(interestModel) {
        return new ModeM(interestModel.attributes);
      });
      modeModels = _.sortBy(modeModels, function(modeModel) {
        return modeModel.get('name');
      });
      this.reset(modeModels);
      return this.trigger('sync', this, resp, options);
    }
  };

  return ModesCollection;

})(Collection);


},{"../lib/panel":125,"../lib/request":128,"../lib/stumble":130,"../lib/su":153,"../lib/utils":156,"./base/collection":167,"./mode-model":211,"chaplin":773,"jquery":774,"lodash":776,"moment":778,"simple-storage":780}],213:[function(require,module,exports){
var Model, ParticipantModel, SU, mediator, request, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

_ = require('lodash');

utils = require('../lib/utils');

mediator = require('chaplin').mediator;

SU = require('../lib/su');

request = require('../lib/request');

module.exports = ParticipantModel = (function(_super) {
  __extends(ParticipantModel, _super);

  function ParticipantModel() {
    return ParticipantModel.__super__.constructor.apply(this, arguments);
  }

  ParticipantModel.prototype.defaults = {
    parse: true,
    validate: true
  };

  ParticipantModel.prototype.initialize = function() {
    var isSelf, userSeed;
    ParticipantModel.__super__.initialize.apply(this, arguments);
    userSeed = this.get('suUid') || this.get('id') || this.get('email');
    this.set('_user-color', utils.generateUserColor(userSeed != null ? userSeed.toString() : void 0));
    this.set('_name', this.getParticipantDisplayName());
    if (this.get('id')) {
      isSelf = utils.getParticipantId() === this.get('id');
      this.set('_isSelf', isSelf);
      return mediator.contactsC.whenPopulated().then((function(_this) {
        return function(participantsC) {
          var suUserId;
          suUserId = _this.get('suUserId');
          if (suUserId && !participantsC.findWhere({
            suUid: suUserId
          }) && !isSelf) {
            return _this.set('_notFollowed', true);
          }
        };
      })(this));
    }
  };

  ParticipantModel.prototype.sync = function(method, model, options) {
    var suUserIds, _ref;
    if (options == null) {
      options = {};
    }
    suUserIds = this.get('suUserId') || options.suUserId || ((_ref = options.data) != null ? _ref.suUserId : void 0) || utils.getLoggedInUserId();
    if (!_.isArray(suUserIds)) {
      suUserIds = [suUserIds];
    }
    options.data = options.data || {};
    options.data.suUserIds = suUserIds;
    options.ignoreSuccessProperty = true;
    switch (method) {
      case 'read':
        return request(SU.Participants.queryNoRetry, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ParticipantModel.prototype.block = function() {
    mediator.publish('participant:block:' + this.get('id'), this);
    return mediator.publish('participant:block', this);
  };

  ParticipantModel.prototype.getParticipantDisplayName = function() {
    return this.get('name') || this.get('suName') || this.get('suUserName') || this.get('email');
  };

  ParticipantModel.prototype.parse = function(data, options) {
    if (data.userid) {
      return this.transformSuUserToParticipant(data);
    }
    return data[0];
  };

  ParticipantModel.prototype.validate = function(attributes, options) {
    var _ref, _ref1;
    if ((attributes.suUid && ((_ref = this.collection) != null ? _ref.findWhere({
      suUid: attributes.suUid
    }) : void 0)) || (attributes.email && ((_ref1 = this.collection) != null ? _ref1.findWhere({
      email: attributes.email
    }) : void 0))) {
      'You cannot add duplicate participants';
    }
    if (!attributes.email && !attributes.suUserName) {
      return 'Cannot make a blank participant';
    }
  };

  ParticipantModel.prototype.isInvitable = function() {
    return !(this.isMarkedAsParticipant() || this.isQueuedForInvite());
  };

  ParticipantModel.prototype.isMarkedAsParticipant = function() {
    return this.get('_isParticipant' || false);
  };

  ParticipantModel.prototype.isQueuedForInvite = function() {
    return this.get('_queued') || false;
  };

  ParticipantModel.prototype.queueForInvite = function() {
    return this.set('_queued', true);
  };

  ParticipantModel.prototype.dequeueForInvite = function() {
    return this.unset('_queued', true);
  };

  ParticipantModel.prototype.transformSuUserToParticipant = function(suUser) {
    return _.pick({
      suUid: String(suUser.userid),
      suUserName: suUser.username,
      suName: suUser.name,
      thumbnail: suUser.picture_full
    }, _.identity);
  };

  return ParticipantModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"chaplin":773,"lodash":776}],214:[function(require,module,exports){
var $, Collection, ParticipantM, ParticipantsCollection, SU, mediator, request, storage, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

ParticipantM = require('./participant-model');

mediator = require('chaplin').mediator;

_ = require('lodash');

utils = require('../lib/utils');

request = require('../lib/request');

SU = require('../lib/su');

$ = require('jquery');

storage = require('simple-storage');

module.exports = ParticipantsCollection = (function(_super) {
  __extends(ParticipantsCollection, _super);

  function ParticipantsCollection() {
    this.dequeueForInvite = __bind(this.dequeueForInvite, this);
    this.queueForInvite = __bind(this.queueForInvite, this);
    this._queryModels = __bind(this._queryModels, this);
    this._selectQueryAttribute = __bind(this._selectQueryAttribute, this);
    return ParticipantsCollection.__super__.constructor.apply(this, arguments);
  }

  ParticipantsCollection.prototype.model = ParticipantM;

  ParticipantsCollection.prototype.initialize = function() {
    ParticipantsCollection.__super__.initialize.apply(this, arguments);
    this.on('change:_queued', this.onQueueChanged);
    return this.on('add', this.onQueueChanged);
  };

  ParticipantsCollection.prototype.comparator = function(model) {
    return -model.get('invitedCount') || 0;
  };

  ParticipantsCollection.prototype.setConversationId = function(id) {
    return this.conversationId = id;
  };

  ParticipantsCollection.prototype.inviteQueuedToConversation = function() {
    var participantCount, queuedCount;
    queuedCount = this.getTotalQueued();
    participantCount = this.getTotalInvited();
    if (queuedCount + participantCount < mediator.maxConvoParticipants) {
      return this.inviteQueued(this.conversationId);
    }
  };

  ParticipantsCollection.prototype.getExistingParticipants = function(participantIds) {
    return _.filter(_.map(participantIds, (function(_this) {
      return function(id) {
        var model;
        model = _this.findWhere({
          id: id
        });
        return model != null ? model.toJSON() : void 0;
      };
    })(this)), function(val) {
      return !!val;
    });
  };

  ParticipantsCollection.prototype.fetchNewParticipants = function(participantsIdArr) {
    var dfd, options;
    if (participantsIdArr == null) {
      participantsIdArr = [];
    }
    participantsIdArr = _.filter(participantsIdArr, (function(_this) {
      return function(id) {
        return !_this.findWhere({
          id: id
        });
      };
    })(this));
    if (!participantsIdArr.length) {
      dfd = new $.Deferred();
      return dfd.resolve();
    }
    options = {
      ignoreSuccessProperty: true,
      data: {
        ids: participantsIdArr
      },
      success: (function(_this) {
        return function(json) {
          return _this.add(_.map(_.values(json), function(data) {
            return new ParticipantM(data);
          }));
        };
      })(this)
    };
    return request(SU.Participants.query, [null, null, options]);
  };

  ParticipantsCollection.prototype.inviteQueued = function() {
    var contactsArr, options;
    contactsArr = [];
    options = {};
    options.ignoreSuccessProperty = true;
    options.data = {
      conversationId: this.conversationId
    };
    _.extend(options.data, this.splitQueuedParticipants());
    _.each(this.getQueuedParticipants(), function(model) {
      contactsArr.push(model.getAttributes());
      return model.set('_isParticipant', true);
    });
    if (!utils.isVisitor()) {
      this.saveContacts(contactsArr);
    }
    return request(SU.Conversations.addParticipants, [null, null, options]);
  };

  ParticipantsCollection.prototype.getQueuedParticipants = function() {
    return this.where({
      '_queued': true
    });
  };

  ParticipantsCollection.prototype.hasQueuedParticipants = function() {
    return !!this.findWhere({
      '_queued': true
    });
  };

  ParticipantsCollection.prototype.getTotalQueued = function() {
    return this.getQueuedParticipants().length;
  };

  ParticipantsCollection.prototype.getTotalInvited = function() {
    return this.where({
      '_isParticipant': true
    }).length;
  };

  ParticipantsCollection.prototype.splitQueuedParticipants = function(participants) {
    var parsed, returnObj;
    parsed = {
      participants: [],
      suUserIds: [],
      emails: []
    };
    returnObj = {};
    participants = participants || this.getQueuedParticipants();
    participants.forEach(function(participant) {
      if (participant.get('id')) {
        return parsed.participants.push(participant.get('id'));
      } else if (participant.get('suUid')) {
        return parsed.suUserIds.push(participant.get('suUid'));
      } else if (participant.get('email')) {
        return parsed.emails.push(participant.get('email'));
      }
    });
    _.each(parsed, function(value, key) {
      if (value.length) {
        return returnObj[key] = value;
      }
    });
    return returnObj;
  };

  ParticipantsCollection.prototype.dequeueAll = function() {
    return this.models.forEach(function(model) {
      return model.set({
        '_queued': false
      });
    });
  };

  ParticipantsCollection.prototype.onQueueChanged = function() {
    return this.publishEvent('participants:queued', this.findWhere({
      '_queued': true
    }));
  };

  ParticipantsCollection.prototype._selectQueryAttribute = function(value) {
    var type;
    type = '_name';
    if (utils.isEmail(value)) {
      type = 'email';
    }
    return type;
  };

  ParticipantsCollection.prototype._queryModels = function(queryAttribute, value) {
    var models;
    models = this.filter(function(participant) {
      var name, re;
      re = new RegExp('^' + value + '$', 'i');
      name = participant.get(queryAttribute) || '';
      return re.test(name);
    });
    return models;
  };

  ParticipantsCollection.prototype.queueForInvite = function(value) {
    var invite, model, models, queryAttribute;
    queryAttribute = this._selectQueryAttribute(value);
    models = this._queryModels(queryAttribute, value);
    if (models.length === 0 && queryAttribute === 'email') {
      invite = {
        _queued: true
      };
      invite[queryAttribute] = value;
      invite._name = value;
      return this.add(invite);
    } else if (models.length === 1) {
      model = models[0];
      return model.queueForInvite();
    } else {
      return this.publishEvent('participants:invite-rejected', {
        invitee: value,
        matches: models
      });
    }
  };

  ParticipantsCollection.prototype.dequeueForInvite = function(value) {
    var models, queryAttribute;
    queryAttribute = this._selectQueryAttribute(value);
    models = this._queryModels(queryAttribute, value);
    return _.forEach(models, function(model, index) {
      return model.dequeueForInvite();
    });
  };

  ParticipantsCollection.prototype.sync = function(method, model, options) {
    this.user = new SU.User;
    if (options.data == null) {
      options.data = {
        userid: mediator.userM.get('userid'),
        limit: 50
      };
    }
    switch (method) {
      case 'read':
        return request(this.user.mutualFollow, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ParticipantsCollection.prototype.parse = function(res) {
    return this._parsePaginated(res.mutual);
  };

  ParticipantsCollection.prototype.saveContacts = function(participants) {
    var currentUserId, storedContacts;
    currentUserId = mediator.userM.get('userid').toString();
    storedContacts = storage.get('contacts' + currentUserId) || {};
    _.each(participants, function(contact) {
      var identifier, _ref;
      identifier = ((_ref = contact.suUserId) != null ? _ref.toString() : void 0) || contact.suUid || contact.email;
      if (identifier === currentUserId || !identifier) {
        return;
      }
      if (storedContacts[identifier]) {
        return storedContacts[identifier]++;
      } else {
        return storedContacts[identifier] = 1;
      }
    });
    storage.set('contacts' + currentUserId, storedContacts);
    return this.publishEvent('contacts:saved');
  };

  return ParticipantsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/collection":167,"./participant-model":213,"chaplin":773,"jquery":774,"lodash":776,"simple-storage":780}],215:[function(require,module,exports){
var InterestsCollection, PopularInterestsCollection, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

InterestsCollection = require('./interests-collection');

SU = require('../lib/su');

request = require('../lib/request');


/*
 * This collection gets the list of popular interests
 */

module.exports = PopularInterestsCollection = (function(_super) {
  __extends(PopularInterestsCollection, _super);

  function PopularInterestsCollection() {
    return PopularInterestsCollection.__super__.constructor.apply(this, arguments);
  }

  PopularInterestsCollection.prototype.parse = function(obj) {
    return obj.popular.values;
  };

  PopularInterestsCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        options.data = {
          limit: 60
        };
        return request(SU.Interests.getPopularInterests, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return PopularInterestsCollection;

})(InterestsCollection);


},{"../lib/request":128,"../lib/su":153,"./interests-collection":188}],216:[function(require,module,exports){
var Model, ProfileListItemModel, SU, StumbleModel, request, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

utils = require('../lib/utils');

_ = require('lodash');

request = require('../lib/request');

StumbleModel = require('./stumble-model');

module.exports = ProfileListItemModel = (function(_super) {
  __extends(ProfileListItemModel, _super);

  function ProfileListItemModel() {
    return ProfileListItemModel.__super__.constructor.apply(this, arguments);
  }

  ProfileListItemModel.prototype.defaultThumb = 'http://origin.stumble.net/yrH44Tl-gFLJ1XRCt_buDw';

  ProfileListItemModel.prototype.idAttribute = 'urlid';

  ProfileListItemModel.prototype.parse = function(data) {
    var parseObj;
    if (typeof data.url === 'object' && data.url !== null) {
      data.url._id = data.id;
      parseObj = data.url;
    } else {
      data._id = 'likes';
      parseObj = data;
    }
    parseObj._thumbnail = parseObj.picture_small || parseObj.thumbnail || parseObj.thumbnail_b || this.defaultThumb;
    return parseObj;
  };

  ProfileListItemModel.prototype.getThumb = function() {
    return this.get('_thumbnail');
  };

  ProfileListItemModel.prototype.sync = function(method, model, options) {
    var changedAttr, updateMethod;
    if (utils.isVisitor()) {
      return null;
    }
    changedAttr = _(this.changed).keys().pop();
    switch (changedAttr) {
      case 'rating':
        updateMethod = SU.Stumble.setRating;
        if (options.data == null) {
          options.data = {
            urlid: this.get('urlid'),
            type: this.get('rating')
          };
        }
        if (this.get('rating') === -1 && this.get('subrating')) {
          options.data.subtype = this.get('subrating');
        }
        break;
      case 'listId':
        updateMethod = SU.Lists.addItem;
        if (options.data == null) {
          options.data = {
            urlid: this.get('urlid'),
            listId: this.get('listId')
          };
        }
        break;
      default:
        updateMethod = function() {};
    }
    switch (method) {
      case 'update':
        return request(updateMethod, arguments);
      case 'delete':
        return request(SU.Lists.deleteItem, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return ProfileListItemModel;

})(StumbleModel);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"./stumble-model":239,"lodash":776}],217:[function(require,module,exports){
var Model, ProfileListModel, SU, mediator, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

mediator = require('chaplin').mediator;

SU = require('../lib/su');

request = require('../lib/request');

module.exports = ProfileListModel = (function(_super) {
  __extends(ProfileListModel, _super);

  function ProfileListModel() {
    return ProfileListModel.__super__.constructor.apply(this, arguments);
  }

  ProfileListModel.prototype.defaultThumb = 'http://origin.stumble.net/yrH44Tl-gFLJ1XRCt_buDw';

  ProfileListModel.prototype.initialize = function() {
    ProfileListModel.__super__.initialize.apply(this, arguments);
    mediator.subscribe('list:changename', this.onListNameChange, this);
    this.setUserName();
    this.setOwnerUserName();
    this.setListThumbnail();
    return this.setListName();
  };

  ProfileListModel.prototype.setUserName = function() {
    var identityM, username, _ref;
    identityM = mediator.currentProfileM.get('identityM');
    username = identityM.get('username') || ((_ref = mediator.userM) != null ? _ref.get('username') : void 0);
    return this.set('_username', username);
  };

  ProfileListModel.prototype.setOwnerUserName = function() {
    var owner;
    owner = this.get('owner');
    if (owner != null) {
      return this.set('_owner_username', owner.username);
    }
  };

  ProfileListModel.prototype.setListThumbnail = function() {
    var thumbnail;
    thumbnail = this.get('picture_small') || this.get('thumbnail') || this.get('thumbnail_b') || this.defaultThumb;
    return this.set('_thumbnail', thumbnail);
  };

  ProfileListModel.prototype.onListNameChange = function(listM, newName) {
    if (this.get('id') === listM.get('id')) {
      return this.set('name', newName);
    }
  };

  ProfileListModel.prototype.setListName = function() {
    return this.set('listName', this.get('name'));
  };

  ProfileListModel.prototype.dispose = function() {
    mediator.unsubscribe('list:change:' + this.get('id'), this.onListChange, this);
    return ProfileListModel.__super__.dispose.apply(this, arguments);
  };

  ProfileListModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    if (method !== 'read') {
      options.data = model.toJSON();
    }
    switch (method) {
      case 'create':
        return request(SU.Lists.create, arguments);
      case 'read':
        return request(SU.Lists.getMeta, arguments);
      case 'update':
        return request(SU.Lists.update, arguments);
      case 'delete':
        return request(SU.Lists["delete"], arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return ProfileListModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"chaplin":773}],218:[function(require,module,exports){
var Collection, ProfileListItemModel, ProfileListItemsCollection, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

ProfileListItemModel = require('./profile-list-item-model');

module.exports = ProfileListItemsCollection = (function(_super) {
  __extends(ProfileListItemsCollection, _super);

  function ProfileListItemsCollection() {
    return ProfileListItemsCollection.__super__.constructor.apply(this, arguments);
  }

  ProfileListItemsCollection.prototype.model = ProfileListItemModel;

  ProfileListItemsCollection.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    options.data = options.data || {};
    options.data.listId = options.data.listId || this.listId;
    switch (method) {
      case 'read':
        return request(SU.Lists.getItems, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ProfileListItemsCollection.prototype.parse = function(res) {
    var _ref;
    this._total = (_ref = res.items) != null ? _ref._total : void 0;
    return this._parsePaginated(res.items);
  };

  return ProfileListItemsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./profile-list-item-model":216}],219:[function(require,module,exports){
var Collection, ProfileListModel, ProfileListsCollection, SU, chaplin, mediator, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

chaplin = require('chaplin');

mediator = chaplin.mediator;

ProfileListModel = require('./profile-list-model');

module.exports = ProfileListsCollection = (function(_super) {
  __extends(ProfileListsCollection, _super);

  function ProfileListsCollection() {
    return ProfileListsCollection.__super__.constructor.apply(this, arguments);
  }

  ProfileListsCollection.prototype.model = ProfileListModel;

  ProfileListsCollection.prototype.comparator = function(model) {
    return model.get('_sortOrder');
  };

  ProfileListsCollection.prototype.sync = function(method, model, options) {
    var user;
    user = new SU.User;
    switch (method) {
      case 'read':
        return request(user.getLists, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ProfileListsCollection.prototype.parse = function(res) {
    var _ref;
    this._total = (_ref = res.lists) != null ? _ref._total : void 0;
    return this._parsePaginated(res.lists);
  };

  return ProfileListsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./profile-list-model":217,"chaplin":773}],220:[function(require,module,exports){
var Collection, ProfileListModel, ProfileListsFollowingCollection, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

ProfileListModel = require('./profile-list-model');

module.exports = ProfileListsFollowingCollection = (function(_super) {
  __extends(ProfileListsFollowingCollection, _super);

  function ProfileListsFollowingCollection() {
    return ProfileListsFollowingCollection.__super__.constructor.apply(this, arguments);
  }

  ProfileListsFollowingCollection.prototype.model = ProfileListModel;

  ProfileListsFollowingCollection.prototype.sync = function(method, model, options) {
    this.user = new SU.User;
    switch (method) {
      case 'read':
        return request(this.user.getListsFollowing, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ProfileListsFollowingCollection.prototype.parse = function(res) {
    return this._parsePaginated(res.lists);
  };

  return ProfileListsFollowingCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./profile-list-model":217}],221:[function(require,module,exports){
var Collection, FollowUserM, RecommendFollowers, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

FollowUserM = require('./follow-user-model');

module.exports = RecommendFollowers = (function(_super) {
  __extends(RecommendFollowers, _super);

  function RecommendFollowers() {
    return RecommendFollowers.__super__.constructor.apply(this, arguments);
  }

  RecommendFollowers.prototype.model = FollowUserM;

  RecommendFollowers.prototype.sync = function(method, model, options) {
    var user;
    user = new SU.User;
    switch (method) {
      case 'read':
        return request(user.suggestedStumblers, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  RecommendFollowers.prototype.parse = function(res) {
    return this._parsePaginated(res.stumblers);
  };

  return RecommendFollowers;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./follow-user-model":181}],222:[function(require,module,exports){
var Model, ReportExternalShare, SU, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = ReportExternalShare = (function(_super) {
  __extends(ReportExternalShare, _super);

  function ReportExternalShare() {
    return ReportExternalShare.__super__.constructor.apply(this, arguments);
  }

  ReportExternalShare.prototype.sync = function(method, model, options) {
    var data;
    if (options == null) {
      options = {};
    }
    switch (method) {
      case 'create':
        data = model.toJSON();
        return request(SU.Report.externalShare, [
          null, null, {
            data: data
          }
        ]);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return ReportExternalShare;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],223:[function(require,module,exports){
var Model, ReportStumblerModel, SU, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = ReportStumblerModel = (function(_super) {
  __extends(ReportStumblerModel, _super);

  function ReportStumblerModel() {
    this.notifyError = __bind(this.notifyError, this);
    this.notifySuccess = __bind(this.notifySuccess, this);
    return ReportStumblerModel.__super__.constructor.apply(this, arguments);
  }

  ReportStumblerModel.prototype.sync = function(method, model, options) {
    var data;
    if (options == null) {
      options = {};
    }
    data = model.toJSON();
    delete data.widgetDataId;
    delete data.widgetText;
    delete data.username;
    options = {
      data: data,
      success: this.notifySuccess,
      error: this.notifyError
    };
    switch (method) {
      case 'create':
        return request(SU.Report.flagStumbler, [null, null, options]);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ReportStumblerModel.prototype.notifySuccess = function() {
    return this.publishEvent('report-stumbler:model:success');
  };

  ReportStumblerModel.prototype.notifyError = function() {
    return this.publishEvent('report-stumbler:model:error');
  };

  return ReportStumblerModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],224:[function(require,module,exports){
var Model, ReportWrongStumbleModel, SU, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = ReportWrongStumbleModel = (function(_super) {
  __extends(ReportWrongStumbleModel, _super);

  function ReportWrongStumbleModel() {
    this.notifyError = __bind(this.notifyError, this);
    this.notifySuccess = __bind(this.notifySuccess, this);
    return ReportWrongStumbleModel.__super__.constructor.apply(this, arguments);
  }

  ReportWrongStumbleModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    switch (method) {
      case 'read':
        return request(SU.Report.info, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ReportWrongStumbleModel.prototype.reportMisclassified = function() {
    var data, options;
    data = {
      urlid: this.get('urlid'),
      catid: this.get('catid'),
      note: this.get('note')
    };
    options = {
      data: data,
      success: this.notifySuccess,
      error: this.notifyError
    };
    return request(SU.Report.misclassified, [null, null, options]);
  };

  ReportWrongStumbleModel.prototype.reportWrongLanguage = function() {
    var data, options;
    data = {
      urlid: this.get('urlid'),
      langid: this.get('langid')
    };
    options = {
      data: data,
      success: this.notifySuccess,
      error: this.notifyError
    };
    return request(SU.Report.wrongLanguage, [null, null, options]);
  };

  ReportWrongStumbleModel.prototype.reportNotAvailable = function() {
    var data, options;
    data = {
      urlid: this.get('urlid')
    };
    options = {
      data: data,
      success: this.notifySuccess,
      error: this.notifyError
    };
    return request(SU.Report.notAvailable, [null, null, options]);
  };

  ReportWrongStumbleModel.prototype.notifySuccess = function() {
    return this.publishEvent('wrong-stumble:model:success');
  };

  ReportWrongStumbleModel.prototype.notifyError = function() {
    return this.publishEvent('wrong-stumble:model:error');
  };

  return ReportWrongStumbleModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],225:[function(require,module,exports){
var Model, ResetPasswordConfirmModel, SU, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('../base/model');

SU = require('../../lib/su');

request = require('../../lib/request');

module.exports = ResetPasswordConfirmModel = (function(_super) {
  __extends(ResetPasswordConfirmModel, _super);

  function ResetPasswordConfirmModel() {
    this.notifyValidation = __bind(this.notifyValidation, this);
    this.notifyErrorResult = __bind(this.notifyErrorResult, this);
    this.notifySuccess = __bind(this.notifySuccess, this);
    return ResetPasswordConfirmModel.__super__.constructor.apply(this, arguments);
  }

  ResetPasswordConfirmModel.prototype.initialize = function() {
    return this.on('invalid', function(model, error) {
      return this.notifyValidation(model, error);
    });
  };

  ResetPasswordConfirmModel.prototype.validate = function(data) {
    var result;
    if (!data) {
      return;
    }
    if (data.confirmId === '' || !data.confirmId) {
      result = {
        message: "Please enter the Confirmation Code.",
        attribute: "confirm-id"
      };
    } else if (data.newPassword === '') {
      result = {
        message: "Please enter a new password.",
        attribute: "new-password"
      };
    } else if (data.confirmPassword === '') {
      result = {
        message: "Please confirm the new password.",
        attribute: "confirm-password"
      };
    } else if (data.newPassword !== data.confirmPassword) {
      result = {
        message: "New password and Confirmed password don't match.",
        attribute: "no-match"
      };
    }
    return result;
  };

  ResetPasswordConfirmModel.prototype.sync = function(method, model, options) {
    var data, user;
    if (options == null) {
      options = {};
    }
    this.publishEvent('reset-password:confirm:model:sync:start', this);
    user = new SU.User;
    switch (method) {
      case 'create':
        data = model.toJSON();
        delete data.widgetText;
        delete data.widgetDataId;
        options = {
          success: this.notifySuccess,
          error: this.notifyErrorResult,
          data: data
        };
        return request(user.passwordResetConfirm, [null, null, options]);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ResetPasswordConfirmModel.prototype.notifySuccess = function(res) {
    return this.publishEvent('reset-password:confirm:model:success', res);
  };

  ResetPasswordConfirmModel.prototype.notifyErrorResult = function(res) {
    var errorMessage, result, _ref;
    errorMessage = ((_ref = JSON.parse(res != null ? res.responseText : void 0)) != null ? _ref._error : void 0) || "Could not reset your password! Please try again later!";
    result = {
      message: errorMessage,
      attribute: "general"
    };
    return this.publishEvent('reset-password:confirm:model:error', result);
  };

  ResetPasswordConfirmModel.prototype.notifyValidation = function(model, error) {
    return this.publishEvent('reset-password:confirm:model:error', error);
  };

  return ResetPasswordConfirmModel;

})(Model);


},{"../../lib/request":128,"../../lib/su":153,"../base/model":168}],226:[function(require,module,exports){
var Model, ResetPasswordRequestModel, SU, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('../base/model');

SU = require('../../lib/su');

request = require('../../lib/request');

module.exports = ResetPasswordRequestModel = (function(_super) {
  __extends(ResetPasswordRequestModel, _super);

  function ResetPasswordRequestModel() {
    this.notifyErrorResult = __bind(this.notifyErrorResult, this);
    this.notifySuccess = __bind(this.notifySuccess, this);
    return ResetPasswordRequestModel.__super__.constructor.apply(this, arguments);
  }

  ResetPasswordRequestModel.prototype.initialize = function() {
    return this.on('invalid', function(model, error) {
      return this.publishEvent('reset-password:request:error', error);
    });
  };

  ResetPasswordRequestModel.prototype.validate = function() {
    var data;
    if ((arguments != null ? arguments[0] : void 0) && (arguments[0] != null)) {
      data = arguments[0];
      if (data.email === '') {
        return "Please enter a valid username or e-mail address";
      }
    }
  };

  ResetPasswordRequestModel.prototype.sync = function(method, model, options) {
    var data, user;
    if (options == null) {
      options = {};
    }
    this.publishEvent('reset-password:request:model:sync:start', this);
    user = new SU.User;
    switch (method) {
      case 'create':
        data = model.toJSON();
        delete data.widgetText;
        delete data.widgetDataId;
        options = {
          success: this.notifySuccess,
          error: this.notifyErrorResult,
          data: data
        };
        return request(user.passwordResetRequest, [null, null, options]);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ResetPasswordRequestModel.prototype.notifySuccess = function(res) {
    return this.publishEvent('reset-password:request:success', res);
  };

  ResetPasswordRequestModel.prototype.notifyErrorResult = function(res) {
    var errorMessage, _ref;
    errorMessage = ((_ref = JSON.parse(res != null ? res.responseText : void 0)) != null ? _ref._error : void 0) || "Could not send the reset password request. Please try again!";
    return this.publishEvent('reset-password:request:error', errorMessage);
  };

  return ResetPasswordRequestModel;

})(Model);


},{"../../lib/request":128,"../../lib/su":153,"../base/model":168}],227:[function(require,module,exports){
var Model, SU, SearchInputModel, analytics, request, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

_ = require('lodash');

analytics = require('../lib/analytics');

module.exports = SearchInputModel = (function(_super) {
  __extends(SearchInputModel, _super);

  function SearchInputModel() {
    return SearchInputModel.__super__.constructor.apply(this, arguments);
  }

  SearchInputModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    throw new Error(method + ' unsupported');
  };

  SearchInputModel.prototype.getRestrictToList = function() {
    return this.restrictToList || false;
  };

  SearchInputModel.prototype.setRestrictToList = function(restrict) {
    if (restrict == null) {
      restrict = false;
    }
    return this.restrictToList = restrict;
  };

  SearchInputModel.prototype.setSearchText = function(searchText) {
    var list, selectedCount;
    this.set('searchText', searchText);
    list = this.getSearchListProvider();
    selectedCount = list != null ? list.setFilterText(searchText) : void 0;
    if (!selectedCount) {
      return this.setSearchOpen(false);
    }
  };

  SearchInputModel.prototype.getSearchText = function() {
    return this.get('searchText') || '';
  };

  SearchInputModel.prototype.setSearchOpen = function(searchOpen) {
    return this.set('searchOpen', !!searchOpen);
  };

  SearchInputModel.prototype.getSearchOpen = function() {
    return this.get('searchOpen');
  };

  SearchInputModel.prototype.setPlaceholderText = function(placeholderText) {
    return this.set('placeholderText', placeholderText);
  };

  SearchInputModel.prototype.getPlaceholderText = function() {
    return this.get('placeholderText');
  };

  SearchInputModel.prototype.setClassNames = function(classNames) {
    return this.set('classNames', classNames);
  };

  SearchInputModel.prototype.getClassNames = function() {
    return this.get('classNames');
  };

  SearchInputModel.prototype.setId = function(id) {
    this.set('id', id);
    return this.set('dropviewId', id + '-dropview');
  };

  SearchInputModel.prototype.getId = function() {
    return this.get('id');
  };

  SearchInputModel.prototype.getDropviewId = function() {
    return this.get('dropviewId');
  };

  SearchInputModel.prototype.setAction = function(action) {
    return this.set('action', action);
  };

  SearchInputModel.prototype.getAction = function() {
    return this.get('action');
  };

  SearchInputModel.prototype.setTooltip = function(tooltip) {
    return this.set('tooltip', tooltip);
  };

  SearchInputModel.prototype.getTooltip = function() {
    return this.get('tooltip');
  };

  SearchInputModel.prototype.setDisabled = function(disabled) {
    return this.set('disabled', disabled);
  };

  SearchInputModel.prototype.getDisabled = function() {
    return this.get('disabled');
  };

  SearchInputModel.prototype.setSearchListProvider = function(searchListProvider) {
    searchListProvider.setFilterText(this.getSearchText());
    this.listenTo(searchListProvider, 'change:selected', this.onSelectedModelChange);
    return this.set('searchListProvider', searchListProvider);
  };

  SearchInputModel.prototype.getSearchListProvider = function() {
    return this.get('searchListProvider');
  };

  SearchInputModel.prototype.highlightNext = function() {
    var _ref;
    return (_ref = this.getSearchListProvider()) != null ? _ref.highlightNext() : void 0;
  };

  SearchInputModel.prototype.highlightPrevious = function() {
    var _ref;
    return (_ref = this.getSearchListProvider()) != null ? _ref.highlightPrevious() : void 0;
  };

  SearchInputModel.prototype.setSelectedModel = function(selectedModel) {
    return this.set('selectedModel', selectedModel);
  };

  SearchInputModel.prototype.getSelectedModel = function() {
    return this.get('selectedModel');
  };

  SearchInputModel.prototype.select = function(selected) {
    var handled, _ref;
    handled = false;
    if (!selected) {
      selected = (_ref = this.getSearchListProvider()) != null ? _ref.getSelected() : void 0;
    }
    if (selected) {
      this.setSelectedModel(selected);
      this.setSearchText('');
      this.setSearchOpen(false);
      handled = true;
    } else if (this.getRestrictToList()) {
      this.setSearchText('');
      this.setSearchOpen(false);
      handled = true;
    }
    return handled;
  };

  SearchInputModel.prototype.onSelectedModelChange = function(model, value, options) {
    if (value) {
      this.select(model);
      return model.setSelected(false);
    }
  };

  SearchInputModel.prototype.initialize = function(attributes, options) {
    SearchInputModel.__super__.initialize.apply(this, arguments);
    return this.setSelectedModel(null);
  };

  return SearchInputModel;

})(Model);


},{"../lib/analytics":116,"../lib/request":128,"../lib/su":153,"./base/model":168,"lodash":776}],228:[function(require,module,exports){
var Model, SU, SeenModel, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = SeenModel = (function(_super) {
  __extends(SeenModel, _super);

  function SeenModel() {
    return SeenModel.__super__.constructor.apply(this, arguments);
  }

  SeenModel.prototype.sync = function(method, model, options) {
    var urlid;
    if (options == null) {
      options = {};
    }
    urlid = model.get('urlid');
    if (!urlid) {
      return;
    }
    if (options.data == null) {
      options.data = {
        urlids: [urlid],
        source: model.get('source'),
        mode: 'all'
      };
    }
    return request(SU.Report.seen, arguments);
  };

  return SeenModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],229:[function(require,module,exports){
var AccountDeleteModel, Model, SU, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('../base/model');

SU = require('../../lib/su');

request = require('../../lib/request');

module.exports = AccountDeleteModel = (function(_super) {
  __extends(AccountDeleteModel, _super);

  function AccountDeleteModel() {
    this.notifyValidation = __bind(this.notifyValidation, this);
    this.notifyErrorResult = __bind(this.notifyErrorResult, this);
    this.notifySuccess = __bind(this.notifySuccess, this);
    return AccountDeleteModel.__super__.constructor.apply(this, arguments);
  }

  AccountDeleteModel.prototype.initialize = function() {
    return this.on('invalid', function(model, error) {
      return this.notifyValidation(model, error);
    });
  };

  AccountDeleteModel.prototype.validate = function() {
    var data, result;
    if ((arguments != null ? arguments[0] : void 0) && (arguments[0] != null)) {
      data = arguments[0];
      if (data.password === '') {
        result = {
          message: "Please enter your current password.",
          attribute: "password"
        };
      }
      return result;
    }
  };

  AccountDeleteModel.prototype.sync = function(method, model, options) {
    var data;
    if (options == null) {
      options = {};
    }
    this.publishEvent('accountDeletion:model:sync:start', this);
    switch (method) {
      case 'create':
        data = model.toJSON();
        delete data.widgetText;
        delete data.widgetDataId;
        options = {
          success: this.notifySuccess,
          error: this.notifyErrorResult,
          data: data
        };
        return request(SU.Settings.markForDeletion, [null, null, options]);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  AccountDeleteModel.prototype.unmarkDeletion = function() {
    return request(SU.Settings.unmarkDeletion, [null, null, {}]);
  };

  AccountDeleteModel.prototype.notifySuccess = function(res) {
    return this.publishEvent('accountDeletion:model:success', res);
  };

  AccountDeleteModel.prototype.notifyErrorResult = function(res) {
    var errorMessage, result;
    errorMessage = res != null ? res._reason[0].message : void 0;
    result = {
      message: errorMessage,
      attribute: "general"
    };
    return this.publishEvent('accountDeletion:model:error', result);
  };

  AccountDeleteModel.prototype.notifyValidation = function(model, error) {
    return this.publishEvent('accountDeletion:model:error', error);
  };

  return AccountDeleteModel;

})(Model);


},{"../../lib/request":128,"../../lib/su":153,"../base/model":168}],230:[function(require,module,exports){
var Model, SU, SettingsAccountModel, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('../base/model');

SU = require('../../lib/su');

request = require('../../lib/request');

module.exports = SettingsAccountModel = (function(_super) {
  __extends(SettingsAccountModel, _super);

  function SettingsAccountModel() {
    return SettingsAccountModel.__super__.constructor.apply(this, arguments);
  }

  SettingsAccountModel.prototype.sync = function(method, model, options) {
    var data;
    if (options == null) {
      options = {};
    }
    this.publishEvent("settings:account:sync:start");
    switch (method) {
      case 'create':
        data = model.toJSON();
        delete data.widgetText;
        delete data.widgetDataId;
        delete data.userOver18;
        return request(SU.Settings.setAccount, [
          null, null, {
            data: data
          }
        ]);
      case 'read':
        return request(SU.Settings.getAccount, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  SettingsAccountModel.prototype.parse = function(response) {
    var data;
    data = {};
    if ((response != null ? response.data : void 0) != null) {
      return data = response.data;
    }
  };

  return SettingsAccountModel;

})(Model);


},{"../../lib/request":128,"../../lib/su":153,"../base/model":168}],231:[function(require,module,exports){
var ChangePasswordModel, Model, SU, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('../base/model');

SU = require('../../lib/su');

request = require('../../lib/request');

module.exports = ChangePasswordModel = (function(_super) {
  __extends(ChangePasswordModel, _super);

  function ChangePasswordModel() {
    this.notifyValidation = __bind(this.notifyValidation, this);
    this.notifyErrorResult = __bind(this.notifyErrorResult, this);
    this.notifySuccess = __bind(this.notifySuccess, this);
    return ChangePasswordModel.__super__.constructor.apply(this, arguments);
  }

  ChangePasswordModel.prototype.initialize = function() {
    return this.on('invalid', function(model, error) {
      return this.notifyValidation(model, error);
    });
  };

  ChangePasswordModel.prototype.validate = function() {
    var data, result;
    if ((arguments != null ? arguments[0] : void 0) && (arguments[0] != null)) {
      data = arguments[0];
      if (data.currentPassword === '') {
        result = {
          message: "Please enter current password.",
          attribute: "current-password"
        };
      } else if (data.newPassword === '') {
        result = {
          message: "Please enter new password.",
          attribute: "new-password"
        };
      } else if (data.confirmPassword === '') {
        result = {
          message: "Please confirm the new password.",
          attribute: "confirm-password"
        };
      } else if (data.newPassword !== data.confirmPassword) {
        result = {
          message: "New password and Confirmed password don't match.",
          attribute: "no-match"
        };
      }
      return result;
    }
  };

  ChangePasswordModel.prototype.sync = function(method, model, options) {
    var data;
    if (options == null) {
      options = {};
    }
    this.publishEvent('changePassword:model:sync:start', this);
    switch (method) {
      case 'create':
        data = model.toJSON();
        delete data.widgetText;
        delete data.widgetDataId;
        options = {
          success: this.notifySuccess,
          error: this.notifyErrorResult,
          data: data
        };
        return request(SU.Settings.changePassword, [null, null, options]);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  ChangePasswordModel.prototype.notifySuccess = function(res) {
    return this.publishEvent('changePassword:model:success', res);
  };

  ChangePasswordModel.prototype.notifyErrorResult = function(res) {
    var errorMessage, result;
    errorMessage = res != null ? res._reason[0].message : void 0;
    result = {
      message: errorMessage,
      attribute: "general"
    };
    return this.publishEvent('changePassword:model:error', result);
  };

  ChangePasswordModel.prototype.notifyValidation = function(model, error) {
    return this.publishEvent('changePassword:model:error', error);
  };

  return ChangePasswordModel;

})(Model);


},{"../../lib/request":128,"../../lib/su":153,"../base/model":168}],232:[function(require,module,exports){
var $, Model, SU, SettingsConnectionsModel, config, request, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('../base/model');

utils = require('../../lib/utils');

config = require('../../config');

$ = require('jquery');

SU = require('../../lib/su');

request = require('../../lib/request');

module.exports = SettingsConnectionsModel = (function(_super) {
  __extends(SettingsConnectionsModel, _super);

  function SettingsConnectionsModel() {
    return SettingsConnectionsModel.__super__.constructor.apply(this, arguments);
  }

  SettingsConnectionsModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    switch (method) {
      case 'read':
        return request(SU.Settings.getConnections, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  SettingsConnectionsModel.prototype.parse = function(response) {
    var data;
    data = {};
    if (((response != null ? response.facebook_account : void 0) != null) && ((response != null ? response.google_account : void 0) != null) && ((response != null ? response.twitter_account : void 0) != null)) {
      return data = {
        facebook_account: response.facebook_account,
        google_account: response.google_account,
        twitter_account: response.twitter_account
      };
    }
  };

  return SettingsConnectionsModel;

})(Model);


},{"../../config":2,"../../lib/request":128,"../../lib/su":153,"../../lib/utils":156,"../base/model":168,"jquery":774}],233:[function(require,module,exports){
var $, Model, SU, SettingsNotificationsModel, config, request, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('../base/model');

utils = require('../../lib/utils');

config = require('../../config');

$ = require('jquery');

SU = require('../../lib/su');

request = require('../../lib/request');

module.exports = SettingsNotificationsModel = (function(_super) {
  __extends(SettingsNotificationsModel, _super);

  function SettingsNotificationsModel() {
    return SettingsNotificationsModel.__super__.constructor.apply(this, arguments);
  }

  SettingsNotificationsModel.prototype.sync = function(method, model, options) {
    var data;
    if (options == null) {
      options = {};
    }
    this.publishEvent("settings:notifications:sync:start");
    switch (method) {
      case 'create':
        data = model.toJSON();
        delete data.widgetText;
        delete data.widgetDataId;
        return request(SU.Settings.setNotifications, [
          null, null, {
            data: data
          }
        ]);
      case 'read':
        return request(SU.Settings.getNotifications, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  SettingsNotificationsModel.prototype.parse = function(response) {
    var data;
    data = {};
    if ((response != null ? response.notifications : void 0) != null) {
      response = response.notifications;
      return data = {
        announcementsEmailGroupV2: response.announcementsEmailGroupV2,
        personalEmailGroupV2: response.personalEmailGroupV2,
        socialEmailGroupV2: response.socialEmailGroupV2,
        weeklyRecEmailGroupV2: response.weeklyRecEmailGroupV2
      };
    }
  };

  return SettingsNotificationsModel;

})(Model);


},{"../../config":2,"../../lib/request":128,"../../lib/su":153,"../../lib/utils":156,"../base/model":168,"jquery":774}],234:[function(require,module,exports){
var $, Model, SU, SettingsPersonalizationModel, config, request, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('../base/model');

utils = require('../../lib/utils');

config = require('../../config');

$ = require('jquery');

SU = require('../../lib/su');

request = require('../../lib/request');

module.exports = SettingsPersonalizationModel = (function(_super) {
  __extends(SettingsPersonalizationModel, _super);

  function SettingsPersonalizationModel() {
    return SettingsPersonalizationModel.__super__.constructor.apply(this, arguments);
  }

  SettingsPersonalizationModel.prototype.sync = function(method, model, options) {
    var data;
    if (options == null) {
      options = {};
    }
    this.publishEvent("settings:personalization:sync:start");
    if (model.hasChanged("rating")) {
      utils.clearCache('all-interests');
      utils.clearCache('popular-interests');
    }
    switch (method) {
      case 'create':
        data = model.toJSON();
        delete data.langselect;
        delete data.widgetText;
        delete data.widgetDataId;
        return request(SU.Settings.setPersonalization, [
          null, null, {
            data: data
          }
        ]);
      case 'read':
        return request(SU.Settings.getPersonalization, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  SettingsPersonalizationModel.prototype.parse = function(response) {
    if ((response != null ? response.mimetypes : void 0) != null) {
      $.extend(response, response.mimetypes);
      delete response.mimetypes;
      return response;
    }
  };

  return SettingsPersonalizationModel;

})(Model);


},{"../../config":2,"../../lib/request":128,"../../lib/su":153,"../../lib/utils":156,"../base/model":168,"jquery":774}],235:[function(require,module,exports){
var Model, SU, SettingsProfileModel, config, mediator, request, utils,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('../base/model');

utils = require('../../lib/utils');

config = require('../../config');

SU = require('../../lib/su');

request = require('../../lib/request');

mediator = require('chaplin').mediator;

module.exports = SettingsProfileModel = (function(_super) {
  __extends(SettingsProfileModel, _super);

  function SettingsProfileModel() {
    this.onPictureSaveFailure = __bind(this.onPictureSaveFailure, this);
    this.onPictureSaveSuccess = __bind(this.onPictureSaveSuccess, this);
    return SettingsProfileModel.__super__.constructor.apply(this, arguments);
  }

  SettingsProfileModel.prototype.sync = function(method, model, options) {
    var data;
    if (options == null) {
      options = {};
    }
    this.publishEvent("settings:profile:sync:start");
    switch (method) {
      case 'create':
        data = model.toJSON();
        if (data.changePicture) {
          this.setPictureUrl(data);
        }
        delete data.original;
        delete data.pictureUrl;
        return request(SU.Settings.setProfile, [
          null, null, {
            data: data
          }
        ]);
      case 'read':
        return request(SU.Settings.getProfile, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  SettingsProfileModel.prototype.parse = function(response, options) {
    var parsedJson;
    if ((response != null ? response.basicUserProfileData : void 0) != null) {
      parsedJson = response != null ? response.basicUserProfileData : void 0;
      parsedJson.pictureUrl = mediator.userM.get('picture_med') || "https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg";
      parsedJson.original = parsedJson;
      parsedJson.original.password = void 0;
      return parsedJson;
    }
  };

  SettingsProfileModel.prototype.setPictureUrl = function(model) {
    var data, options;
    if ((model != null ? model.pictureUrl : void 0) != null) {
      data = {
        userid: mediator.userM.get('userid'),
        image: utils.stripBase64(model.pictureUrl)
      };
      options = {
        success: this.onPictureSaveSuccess,
        failure: this.onPictureSaveFailure,
        data: data
      };
      return request(SU.User.prototype.setPhoto, [null, null, options]);
    }
  };

  SettingsProfileModel.prototype.onPictureSaveSuccess = function(response) {
    var _ref;
    mediator.userM.fetch();
    if ((response != null ? (_ref = response.user) != null ? _ref.picture_med : void 0 : void 0) != null) {
      mediator.userM.set('picture_med', response.user.picture_med);
    }
    return this.publishEvent("settings:profile:picture-save:success", response);
  };

  SettingsProfileModel.prototype.onPictureSaveFailure = function(response) {
    return this.publishEvent("settings:profile:picture-save:fail", response);
  };

  return SettingsProfileModel;

})(Model);


},{"../../config":2,"../../lib/request":128,"../../lib/su":153,"../../lib/utils":156,"../base/model":168,"chaplin":773}],236:[function(require,module,exports){
var Model, SU, ShareModel, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = ShareModel = (function(_super) {
  __extends(ShareModel, _super);

  function ShareModel() {
    return ShareModel.__super__.constructor.apply(this, arguments);
  }

  ShareModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    options.data = model != null ? model.get('data') : void 0;
    options.ignoreSuccessProperty = true;
    switch (method) {
      case 'create':
        return request(SU.Conversations.create, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return ShareModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],237:[function(require,module,exports){
var Model, SU, ShareSocialModel, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = ShareSocialModel = (function(_super) {
  __extends(ShareSocialModel, _super);

  function ShareSocialModel() {
    return ShareSocialModel.__super__.constructor.apply(this, arguments);
  }

  ShareSocialModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    if (method === 'create') {
      if (options.data == null) {
        options.data = model.toJSON();
      }
    }
    switch (method) {
      case 'create':
        return request(SU.Share.url, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return ShareSocialModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],238:[function(require,module,exports){
var $, Model, SU, SignupModel, mediator, request, utils,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

mediator = require('chaplin').mediator;

utils = require('../lib/utils');

$ = require('jquery');

module.exports = SignupModel = (function(_super) {
  var birthdayValidationDeferred, emailValidationDeferred, genderValidationDeferred, passwordValidationDeferred, recaptchaValidationDeferred, usernameValidationDeferred;

  __extends(SignupModel, _super);

  function SignupModel() {
    this.validateRecaptcha = __bind(this.validateRecaptcha, this);
    this.validateGender = __bind(this.validateGender, this);
    this.validateBirthday = __bind(this.validateBirthday, this);
    this.validatePassword = __bind(this.validatePassword, this);
    this.handleUserNameEvent = __bind(this.handleUserNameEvent, this);
    this.failUsernameCallback = __bind(this.failUsernameCallback, this);
    this.validUsernameCallback = __bind(this.validUsernameCallback, this);
    this.validateUsername = __bind(this.validateUsername, this);
    this.handleEmailFailEvent = __bind(this.handleEmailFailEvent, this);
    this.failEmailCallback = __bind(this.failEmailCallback, this);
    this.validEmailCallback = __bind(this.validEmailCallback, this);
    this.validateEmail = __bind(this.validateEmail, this);
    this.notifyError = __bind(this.notifyError, this);
    this.notifySuccess = __bind(this.notifySuccess, this);
    return SignupModel.__super__.constructor.apply(this, arguments);
  }

  emailValidationDeferred = new $.Deferred();

  usernameValidationDeferred = new $.Deferred();

  passwordValidationDeferred = new $.Deferred();

  birthdayValidationDeferred = new $.Deferred();

  genderValidationDeferred = new $.Deferred();

  recaptchaValidationDeferred = new $.Deferred();

  SignupModel.prototype.sync = function(method, model, options) {
    var data;
    if (options == null) {
      options = {};
    }
    this.publishEvent('signup:model:sync:start', this);
    data = model.toJSON();
    this.validateEmail(data.email);
    this.validateUsername(data.username);
    this.validatePassword(data.password);
    this.validateBirthday(data.bday, data.bmonth, data.byear);
    this.validateGender(data.gender);
    this.validateRecaptcha(data.recaptcha);
    return $.when(emailValidationDeferred, usernameValidationDeferred, passwordValidationDeferred, birthdayValidationDeferred, genderValidationDeferred, recaptchaValidationDeferred).then((function(_this) {
      return function() {
        var user;
        delete data._track_postfix;
        delete data._description;
        delete data._title;
        delete data._footnote;
        delete data.widgetDataId;
        delete data.widgetText;
        options = {
          success: _this.notifySuccess,
          error: _this.notifyError,
          data: data
        };
        user = new SU.User;
        switch (method) {
          case 'create':
            return request(user.create, [null, null, options]);
          default:
            throw new Error(method + ' unsupported');
        }
      };
    })(this)).fail((function(_this) {
      return function() {
        return _this.publishEvent('signup:model:sync:end', _this);
      };
    })(this));
  };

  SignupModel.prototype.notifySuccess = function(res) {
    return this.publishEvent('signup:model:success', res);
  };

  SignupModel.prototype.notifyError = function(res) {
    var errorMessage, _ref;
    errorMessage = (_ref = JSON.parse(res.responseText)) != null ? _ref._error : void 0;
    return this.publishEvent('signup:model:error', errorMessage);
  };

  SignupModel.prototype.validateEmail = function(value) {
    var data, options, user;
    if (!!value && value.trim().length > 0 && utils.isEmail(value)) {
      data = {
        email: value
      };
      options = {
        data: data,
        success: this.validEmailCallback,
        error: this.failEmailCallback,
        noretry: true
      };
      user = new SU.User;
      request(user.validateEmail, [null, null, options]);
    } else {
      this.handleEmailFailEvent("Please enter a valid e-mail");
    }
  };

  SignupModel.prototype.validEmailCallback = function(res) {
    emailValidationDeferred.resolve();
    return this.publishEvent('signup:model:email:valid', res);
  };

  SignupModel.prototype.failEmailCallback = function(res) {
    var errorMessage, _ref;
    errorMessage = (_ref = JSON.parse(res.responseText)) != null ? _ref._error : void 0;
    return this.handleEmailFailEvent(errorMessage);
  };

  SignupModel.prototype.handleEmailFailEvent = function(message) {
    emailValidationDeferred.reject(message);
    this.publishEvent('signup:model:email:error', message);
    return emailValidationDeferred = new $.Deferred();
  };

  SignupModel.prototype.validateUsername = function(value) {
    var data, message, options, user;
    message = "";
    if (!value || value.trim().length === 0) {
      message = "Username is Required";
    } else if (value.trim().length > 16) {
      message = "Username should be 16 or less characters";
    }
    if (!message) {
      data = {
        username: value
      };
      options = {
        data: data,
        success: this.validUsernameCallback,
        error: this.failUsernameCallback
      };
      user = new SU.User;
      request(user.validateUsername, [null, null, options]);
    } else {
      this.handleUserNameEvent(message);
    }
  };

  SignupModel.prototype.validUsernameCallback = function(res) {
    usernameValidationDeferred.resolve();
    return this.publishEvent('signup:model:username:valid', res);
  };

  SignupModel.prototype.failUsernameCallback = function(res) {
    var errorMessage, _ref;
    errorMessage = (_ref = JSON.parse(res.responseText)) != null ? _ref._error : void 0;
    return this.handleUserNameEvent(errorMessage);
  };

  SignupModel.prototype.handleUserNameEvent = function(message) {
    usernameValidationDeferred.reject(message);
    this.publishEvent('signup:model:username:error', message);
    usernameValidationDeferred = new $.Deferred();
  };

  SignupModel.prototype.validatePassword = function(value) {
    var message;
    message = "";
    if (!value || value.trim().length === 0) {
      message = "Please fill in Password";
    } else if (value.trim().length > 16 || value.trim().length <= 6) {
      message = "Password should be between 6 to 16 characters";
    }
    if (!message) {
      passwordValidationDeferred.resolve();
      return this.publishEvent('signup:model:password:valid');
    } else {
      passwordValidationDeferred.reject(message);
      this.publishEvent('signup:model:password:error', message);
      return passwordValidationDeferred = new $.Deferred();
    }
  };

  SignupModel.prototype.validateBirthday = function(bday, bmonth, byear) {
    var message;
    message = "";
    if ((bmonth == null) || !bmonth) {
      message = "Please enter birth Month";
    } else if ((bday == null) || !bday) {
      message = "Please enter birth Day";
    } else if ((byear == null) || !byear) {
      message = "Please enter birth Year";
    }
    if (!message) {
      birthdayValidationDeferred.resolve();
      return this.publishEvent('signup:model:birthday:valid');
    } else {
      birthdayValidationDeferred.reject(message);
      this.publishEvent('signup:model:birthday:error', message);
      return birthdayValidationDeferred = new $.Deferred();
    }
  };

  SignupModel.prototype.validateGender = function(gender) {
    var message;
    if ((gender == null) || !gender) {
      message = "Please select a Gender";
      genderValidationDeferred.reject(message);
      this.publishEvent('signup:model:gender:error', message);
      return genderValidationDeferred = new $.Deferred();
    } else {
      genderValidationDeferred.resolve();
      return this.publishEvent('signup:model:gender:valid');
    }
  };

  SignupModel.prototype.validateRecaptcha = function(recaptcha) {
    if ((recaptcha == null) || !recaptcha) {
      this.publishEvent('signup:model:recaptch:error', "Please complete the captcha");
      return recaptchaValidationDeferred = new $.Deferred();
    } else {
      recaptchaValidationDeferred.resolve();
      return this.publishEvent('signup:model:recaptcha:valid');
    }
  };

  SignupModel.prototype.getIsEmailSignupVisible = function() {
    return true;
  };

  return SignupModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"chaplin":773,"jquery":774}],239:[function(require,module,exports){
var $, Model, SU, StumbleModel, mediator, request, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

SU = require('../lib/su');

Model = require('./base/model');

request = require('../lib/request');

utils = require('../lib/utils');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = StumbleModel = (function(_super) {
  __extends(StumbleModel, _super);

  function StumbleModel() {
    this.notifyDomainError = __bind(this.notifyDomainError, this);
    this.notifyDomainSuccess = __bind(this.notifyDomainSuccess, this);
    return StumbleModel.__super__.constructor.apply(this, arguments);
  }

  StumbleModel.prototype.idAttribute = 'urlid';

  StumbleModel.prototype.defaults = {
    '_active': false,
    '_seen': false,
    '_reported': false,
    '_inflight': false,
    '_mode': null,
    '_template': 'site',
    '_orig': null,
    '_opts': {}
  };

  StumbleModel.prototype.initialize = function(data, options) {
    if (data != null) {
      this.options = options;
      if (this.get('url') != null) {
        this.savePrivateData();
      }
      this.avoidDoubleToolbar();
      this.on('change:rating', (function(_this) {
        return function() {
          return _this.save();
        };
      })(this));
      this.on('change:_domainBlocked', (function(_this) {
        return function() {
          return _this.save();
        };
      })(this));
      return this.on('change:_seen', (function(_this) {
        return function() {
          if (!_this.get('_byid')) {
            return _this.save();
          }
        };
      })(this));
    }
  };

  StumbleModel.prototype.getInterestName = function() {
    var _ref, _ref1, _ref2;
    return (_ref = this.get('interests')) != null ? (_ref1 = _ref.values) != null ? (_ref2 = _ref1[0]) != null ? _ref2.name : void 0 : void 0 : void 0;
  };

  StumbleModel.prototype.getInterestSlug = function() {
    var _ref, _ref1, _ref2, _ref3;
    return (_ref = this.get('interests')) != null ? (_ref1 = _ref.values) != null ? (_ref2 = _ref1[0]) != null ? (_ref3 = _ref2.name) != null ? _ref3.toLowerCase().replace(/\s/g, '-') : void 0 : void 0 : void 0 : void 0;
  };

  StumbleModel.prototype.getInterestId = function() {
    var _ref, _ref1, _ref2;
    return (_ref = this.get('interests')) != null ? (_ref1 = _ref.values) != null ? (_ref2 = _ref1[0]) != null ? _ref2.id : void 0 : void 0 : void 0;
  };

  StumbleModel.prototype.getTemplate = function() {
    if (this.get('_legacy')) {
      return 'site';
    } else if (utils.isImage(this.get('url'))) {
      return 'image';
    } else if (this.has('_youtubeid')) {
      return 'youtube';
    } else if (this.has('_vineid')) {
      return 'vine';
    } else if (this.has('_dailymotionid')) {
      return 'dailymotion';
    } else if (this.has('_metacafeid')) {
      return 'metacafe';
    } else if (this.has('_vimeoid')) {
      return 'vimeo';
    } else if (this.has('_soundcloudpath')) {
      return 'soundcloud';
    } else if (this.has('_pinterestid')) {
      return 'pinterest';
    } else if (this.has('_pinterestboardid')) {
      return 'pinterest-board';
    } else if (utils.getFacebookPost(this.get('url'))) {
      return 'facebook';
    } else if (this.has('_tweetid')) {
      return 'tweet';
    } else if (this.has('_flickruser') && this.has('_flickrid')) {
      return 'flickr';
    } else if (this.has('_instagramid')) {
      return 'instagram';
    } else if (this.has('_tedtalkid')) {
      return 'ted';
    } else if (utils.isiOS()) {
      return 'site-ios';
    } else if (this.get('flash')) {
      return 'site';
    } else if (this.get('sandbox')) {
      return 'site-sandbox';
    } else {
      return 'site';
    }
  };

  StumbleModel.prototype.getEmbedCode = function() {
    return this.getTweetApiUrl().then($.getJSON);
  };

  StumbleModel.prototype.getTweetApiUrl = function() {
    var apiUrl, dfd, tweet;
    dfd = $.Deferred();
    if (this.has('_tweetid')) {
      tweet = this.get('_tweetid');
      apiUrl = "https://api.twitter.com/1/statuses/oembed.json?id=" + tweet + "&callback=?";
      dfd.resolve(apiUrl);
    } else {
      dfd.reject();
    }
    return dfd.promise();
  };

  StumbleModel.prototype.getThumb = function() {
    var _ref, _ref1;
    if (utils.isImage(this.get('url'))) {
      return this.get('url');
    } else if (((_ref = this.get('thumb')) != null ? _ref.large : void 0) !== null) {
      return 'https://nb9-stumbleupon.netdna-ssl.com/' + ((_ref1 = this.get('thumb')) != null ? _ref1.large : void 0);
    } else if (this.get('thumbnail')) {
      return this.get('thumbnail');
    } else if (this.get('thumbnail_b')) {
      return this.get('thumbnail_b');
    } else {
      return 'https://nb9-stumbleupon.netdna-ssl.com/qd2XW2ApGssxAW0J-XD3Ag';
    }
  };

  StumbleModel.prototype.getRoute = function() {
    var trackingCode;
    trackingCode = this.get('tracking_code');
    if (this.get('_legacy')) {
      return this.get('urlid');
    } else if ((trackingCode == null) || typeof trackingCode === 'undefined') {
      return _(['su', this.get('urlid'), this.get('_stripped')]).compact().value().join('/');
    } else {
      return _(['su', this.get('urlid'), ':' + trackingCode, this.get('_stripped')]).compact().value().join('/');
    }
  };

  StumbleModel.prototype.getShareRoute = function() {
    var protocol, stumbleUrl, trackingCode, urlId, value;
    trackingCode = this.get('tracking_code');
    urlId = this.get('urlid');
    protocol = utils.isDev() ? 'http://' : 'https://';
    stumbleUrl = protocol + window.location.hostname;
    if ((trackingCode == null) || typeof trackingCode === 'undefined') {
      value = _([stumbleUrl, 'su', urlId]);
    } else {
      value = _([stumbleUrl, 'su', urlId, ':' + trackingCode]);
    }
    return value.compact().value().join('/');
  };

  StumbleModel.prototype.savePrivateData = function() {
    var _ref, _ref1;
    this.set('_interest', this.getInterestName());
    this.set('_interestid', this.getInterestId());
    this.set('_interestslug', this.getInterestSlug());
    this.set('_stripped', utils.stripProtocol(this.get('url')).replace(/[?#].*/, ""));
    this.set('_domain', utils.getDomain(this.get('url')));
    this.set('_youtubeid', utils.getYoutubeId(this.get('url')));
    this.set('_vineid', utils.getVineId(this.get('url')));
    this.set('_dailymotionid', utils.getDailymotionId(this.get('url')));
    this.set('_vimeoid', utils.getVimeoId(this.get('url')));
    this.set('_metacafeid', utils.getMetacafeId(this.get('url')));
    this.set('_soundcloudpath', utils.getSoundcloudPath(this.get('url')));
    this.set('_pinterestid', utils.getPinterestId(this.get('url')));
    this.set('_pinterestboardid', utils.getPinterestBoardId(this.get('url')));
    this.set('_tweetid', utils.getTweetId(this.get('url')));
    this.set('_flickruser', utils.getFlickrUsername(this.get('url')));
    this.set('_instagramid', utils.getInstagramId(this.get('url')));
    this.set('_tedtalkid', utils.getTedTalkId(this.get('url')));
    this.set('_flickrid', utils.getFlickrId(this.get('url')));
    this.set('_title', this.get('title') || this.get('_domain'));
    this.set('_userThumb', (_ref = mediator.userM) != null ? _ref.get('picture_small') : void 0);
    this.set('_template', this.getTemplate());
    this.set('_route', this.getRoute());
    this.set('_thumb', this.getThumb());
    this.set('_shareUrl', this.getShareRoute());
    if ((_ref1 = _.str) != null ? _ref1.numberFormat : void 0) {
      this.set('_views', _.str.numberFormat(parseInt(this.get('views') || 0)));
    }
    return this.set('_nocache', this.get('_legacy') === true);
  };

  StumbleModel.prototype.avoidDoubleToolbar = function() {
    var url;
    url = this.get('url');
    if ((url != null) && url.match('.stumbleupon.com')) {
      return this.set('url', utils.appendParams(url, {
        _notoolbar: true,
        _nospa: true
      }));
    }
  };

  StumbleModel.prototype.sync = function(method, model, options) {
    var changedAttr, data, updateMethod;
    changedAttr = _(this.changed).keys().pop();
    switch (changedAttr) {
      case 'rating':
        updateMethod = SU.Stumble.setRating;
        if (options.data == null) {
          options.data = {
            urlid: this.get('urlid'),
            type: this.get('rating')
          };
        }
        if (this.get('rating') === -1 && this.get('subrating')) {
          options.data.subtype = this.get('subrating');
        }
        break;
      case '_seen':
        if (!utils.isVisitor()) {
          updateMethod = this.get('_orig') || SU.Stumble.all;
          options.data = this.get('_opts');
        } else {
          updateMethod = function() {
            var base;
            base = model != null ? model.get('_route') : void 0;
            return $.get("/" + base + "?_notoolbar=true");
          };
        }
        break;
      case '_domainBlocked':
        updateMethod = SU.Stumble.blockDomain;
        data = {
          urlid: this.get('urlid')
        };
        options = {
          success: this.notifyDomainSuccess,
          error: this.notifyDomainError,
          data: data
        };
        break;
      default:
        updateMethod = function() {};
    }
    if (method === 'read') {
      this.set('_byid', true);
    }
    switch (method) {
      case 'update':
        if (changedAttr === '_seen') {
          return this.collection.reportSeen(updateMethod, arguments);
        } else {
          return request(updateMethod, arguments);
        }
        break;
      case 'read':
        return request(SU.Stumble.urlid, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  StumbleModel.prototype.parse = function(res) {
    if (typeof res.url === 'string') {
      return res;
    } else {
      return res.url;
    }
  };

  StumbleModel.prototype.setActive = function() {
    this.collection.setActive(this.get('urlid'));
    return this;
  };

  StumbleModel.prototype.notifyDomainSuccess = function(res) {
    return this.publishEvent('stumble:model:domain:success', res);
  };

  StumbleModel.prototype.notifyDomainError = function(res) {
    var errorMessage, _ref;
    errorMessage = (_ref = JSON.parse(res.responseText)) != null ? _ref._error : void 0;
    return this.publishEvent('login:model:domain:error', errorMessage);
  };

  return StumbleModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"chaplin":773,"jquery":774,"lodash":776}],240:[function(require,module,exports){
var $, Collection, SU, StumbleM, StumblesCollection, UserM, analytics, mediator, moment, request, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

_ = require('lodash');

Collection = require('./base/collection');

SU = require('../lib/su');

StumbleM = require('./stumble-model');

request = require('../lib/request');

utils = require('../lib/utils');

mediator = require('chaplin').mediator;

UserM = require('./user-model');

moment = require('moment');

analytics = require('../lib/analytics');

module.exports = StumblesCollection = (function(_super) {
  __extends(StumblesCollection, _super);

  function StumblesCollection() {
    return StumblesCollection.__super__.constructor.apply(this, arguments);
  }

  StumblesCollection.prototype.model = StumbleM;

  StumblesCollection.prototype.maxItems = 100;

  StumblesCollection.prototype.monitorBuffer = true;

  StumblesCollection.prototype.buffer = {
    guesses: 10,
    fillrate: '3s',
    min: 4,
    maxRequests: 1,
    pending: 0,
    errors: [],
    total: 0
  };

  StumblesCollection.prototype.initialize = function() {
    StumblesCollection.__super__.initialize.apply(this, arguments);
    this.subscribeEvent('user:fetched', this.fillBuffer);
    this.subscribeEvent('stumble:next', this.fillBuffer);
    this.subscribeEvent('api:userhasnotopics', this.onUserHasNoTopics);
    this.subscribeEvent('user:nointerest', this.onUserHasNoTopics);
    this.on('add', this.capSize);
    this.bufferMonitor = this.setInterval((function(_this) {
      return function() {
        if (!mediator.modesC.isStumblingDomain() && _this.monitorBuffer) {
          return _this.fillBuffer();
        }
      };
    })(this), this.buffer.fillrate);
    return this.setInterval((function(_this) {
      return function() {
        _this.remove(_this.where({
          '_seen': false
        }));
        return _this.fillBuffer();
      };
    })(this), '15m');
  };

  StumblesCollection.prototype.setActive = function(urlid) {
    this.forEach((function(_this) {
      return function(model) {
        if (model.get('urlid') === urlid) {
          model.set('_active', true);
          return model.set('_seen', true);
        } else {
          return model.set('_active', false);
        }
      };
    })(this));
    return this.publishEvent('stumble:activechanged', this.getActive());
  };

  StumblesCollection.prototype.getActive = function() {
    return this.findWhere({
      '_active': true
    });
  };

  StumblesCollection.prototype.onBufferStarted = function() {
    this.buffer.pending += 1;
    return this.buffer.total += 1;
  };

  StumblesCollection.prototype.onBufferFailed = function(response) {
    var postfix;
    this.buffer.pending -= 1;
    this.buffer.errors.push(response);
    postfix = _.isString(response) ? response : "error";
    return analytics.trackEvent('api-buffer-' + postfix);
  };

  StumblesCollection.prototype.onBufferAdded = function() {
    return this.buffer.pending -= 1;
  };

  StumblesCollection.prototype.reportSeen = function(apiMethod, args) {
    var a, onComplete, options, stumbleModels;
    if (apiMethod == null) {
      apiMethod = null;
    }
    if (args == null) {
      args = [{}, {}, null];
    }
    if (!utils.isVisitor()) {
      stumbleModels = this.getUnreported();
      if (stumbleModels.length === 0) {
        return false;
      }
      apiMethod = apiMethod || this.getApiMethod() || SU.Stumble.all;
      a = _.cloneDeep(args);
      options = a[2] || this.getDefaultOptions();
      a[2] = options;
      options.data.guess_urlids = [];
      options.data.tracking_codes = [];
      options.data.from_eref = [];
      stumbleModels.forEach(function(stumbleM) {
        options.data.guess_urlids.push(stumbleM.get('urlid'));
        options.data.tracking_codes.push(stumbleM.get('tracking_code'));
        options.data.from_eref.push(!!stumbleM.get('_byid'));
        return stumbleM.set('_inflight', true);
      });
      options.data.guess_only = 1;
      options.data.guesses = 0;
      options.data.local_buffer_item_count = this.whereUnseen().length;
      onComplete = function(responseObj, statusText, xhr) {
        return stumbleModels != null ? stumbleModels.forEach(function(stumbleModel) {
          stumbleModel.set('_inflight', false);
          if (statusText === "success" && responseObj._success) {
            return stumbleModel.set('_reported', true);
          }
        }) : void 0;
      };
      return request(apiMethod, a).then(onComplete, onComplete);
    }
  };

  StumblesCollection.prototype.reportSeenUrl = function(urlid, args) {
    var a, apiMethod, options;
    if (args == null) {
      args = [{}, {}, null];
    }
    if (!utils.isVisitor()) {
      apiMethod = SU.Stumble.all;
      a = _.cloneDeep(args);
      options = a[2] || this.getDefaultOptions();
      a[2] = options;
      options.data.guess_urlids = [urlid];
      options.data.guess_only = 1;
      options.data.guesses = 0;
      return request(apiMethod, a);
    }
  };

  StumblesCollection.prototype.capSize = function() {
    if (this.length > this.maxItems) {
      return this.remove(this.first(10));
    }
  };

  StumblesCollection.prototype.getLastUrlids = function(amount) {
    if (amount == null) {
      amount = 50;
    }
    return this.pluck('urlid').reverse().slice(0, amount);
  };

  StumblesCollection.prototype.onUserHasNoTopics = function() {
    if (window.location.pathname !== '/signup/choose-interests') {
      return utils.redirectToSignupInterest();
    }
  };

  StumblesCollection.prototype.getDefaultOptions = function() {
    var currentMode, options, _ref;
    currentMode = mediator.modesC.getActive();
    options = {
      data: {
        guesses: this.buffer.guesses,
        userid: mediator.userM.get('userid'),
        interests: [currentMode != null ? currentMode.get('id') : void 0],
        userids: currentMode != null ? currentMode.get('userids') : void 0,
        listId: currentMode != null ? currentMode.get('listId') : void 0,
        prefill_ad_hole: true,
        local_buffer_item_count: this.whereUnseen().length
      },
      _mode: currentMode != null ? currentMode.get('name') : void 0
    };
    if (options != null ? (_ref = options._mode) != null ? _ref.match(/\./) : void 0 : void 0) {
      options['data']['domains'] = [currentMode != null ? currentMode.get('name') : void 0];
    } else if ((currentMode != null ? currentMode.get('name') : void 0) !== 'All Interests') {
      options['data']['keyword'] = currentMode != null ? currentMode.get('name') : void 0;
    }
    return options;
  };

  StumblesCollection.prototype.fetch = function(options) {
    if (options == null) {
      options = {};
    }
    return StumblesCollection.__super__.fetch.call(this, _.defaults(options, this.getDefaultOptions()));
  };

  StumblesCollection.prototype.fillBuffer = function(force) {
    var currentMode, start;
    currentMode = mediator.modesC.getActive();
    if (this.buffer.pending <= this.buffer.maxRequests && this.whereUnseen().length <= this.buffer.min && (force === true || ((currentMode != null ? currentMode.get('listId') : void 0) == null)) && mediator.userM.get('interests_count') > 0) {
      this.onBufferStarted();
      start = utils.unix();
      return this.fetch({
        fresh: true,
        remove: false,
        merge: false
      }).then((function(_this) {
        return function() {
          return _this.reportSeen();
        };
      })(this)).then((function(_this) {
        return function() {
          if (_this.whereUnseen().length > 0) {
            return _this.onBufferAdded();
          } else {
            return _this.onBufferFailed('dupes');
          }
        };
      })(this), (function(_this) {
        return function(xhr, response) {
          return _this.onBufferFailed(response);
        };
      })(this));
    }
  };

  StumblesCollection.prototype.getApiMethod = function() {
    var currentMode, _ref;
    currentMode = (_ref = mediator.modesC.getActive()) != null ? _ref.get('_mode') : void 0;
    if (currentMode != null) {
      currentMode = currentMode.toLowerCase();
    }
    switch (currentMode) {
      case 'following':
        return SU.Stumble.following;
      case 'domain':
        return SU.Stumble.domain;
      case 'trending':
        return SU.Stumble.trending;
      case 'photos':
        return SU.Stumble.photo;
      case 'videos':
        return SU.Stumble.video;
      case 'topic':
        return SU.Stumble.interest;
      case 'user':
        return SU.Stumble.user;
      case 'list':
        return SU.Stumble.list;
      case 'keyword':
        return SU.Stumble.keyword;
      default:
        return SU.Stumble.all;
    }
  };

  StumblesCollection.prototype.sync = function(method, model, options) {
    var promise;
    options['data']['guess_only'] = 1;
    switch (method) {
      case 'read':
        promise = request(this.getApiMethod(), arguments);
        break;
      default:
        throw new Error('Unsupported');
    }
    mediator.publish('populate:models', this);
    return promise;
  };

  StumblesCollection.prototype.parse = function(res, options) {
    var duplicates, seenModels, seenUrlIds, urls;
    urls = [];
    if (res.guesses.values.length > 0) {
      res.guesses.values.push(res.url);
      urls = res.guesses.values;
      this.lastResponse = res;
    } else {
      urls.push(res.url);
    }
    urls = urls.filter(function(url) {
      return url !== null;
    });
    seenModels = this.where({
      _seen: true
    });
    seenUrlIds = _.map(seenModels, function(model) {
      return model.get('urlid');
    });
    duplicates = _.remove(urls, function(url) {
      return _.indexOf(seenUrlIds, url.urlid) !== -1;
    });
    duplicates.forEach((function(_this) {
      return function(duplicate) {
        return _this.findWhere({
          urlid: duplicate.urlid
        }).set({
          '_reported': false
        });
      };
    })(this));
    return urls.map((function(_this) {
      return function(url) {
        var _ref, _ref1;
        url._for = options != null ? (_ref = options.data) != null ? _ref.userid : void 0 : void 0;
        url._mode = options != null ? options._mode : void 0;
        url._listId = options != null ? (_ref1 = options.data) != null ? _ref1.listId : void 0 : void 0;
        url._opts = options != null ? options.data : void 0;
        url._orig = _this.getApiMethod();
        return url;
      };
    })(this));
  };

  StumblesCollection.prototype.createConversationModel = function(convoData) {
    var model, modelData;
    convoData.urlid = convoData.id;
    if (!this.findWhere({
      urlid: convoData.urlid
    })) {
      modelData = _.pick(convoData, "urlid", "url", "title");
      model = new StumbleM(modelData);
      return this.add(model);
    }
  };

  StumblesCollection.prototype.getById = function(urlid, tracking_code) {
    var dfd, existing, stumbleM;
    if (tracking_code == null) {
      tracking_code = "";
    }
    if (typeof urlid !== 'string') {
      throw new TypeError('getById must be passed a string');
    }
    dfd = new $.Deferred();
    existing = this.findWhere({
      urlid: urlid
    });
    if (existing) {
      dfd.resolve(existing);
    } else {
      stumbleM = new StumbleM();
      stumbleM.fetch({
        merge: false,
        data: {
          urlid: urlid
        },
        success: (function(_this) {
          return function(model) {
            model.set("tracking_code", tracking_code || model.get("tracking_code"));
            return dfd.resolve(_this.add(model.toJSON()));
          };
        })(this),
        error: function() {
          return dfd.rejectWith(this, arguments);
        }
      });
    }
    return dfd.promise();
  };

  StumblesCollection.prototype.getByUrl = function(url) {
    var dfd, existing, stumbleM;
    if (typeof url !== 'string') {
      throw new TypeError('getById must be passed a string');
    }
    dfd = new $.Deferred();
    existing = this.findWhere({
      url: url
    });
    if (existing) {
      dfd.resolve(existing);
    } else {
      stumbleM = new StumbleM();
      stumbleM.fetch({
        merge: false,
        data: {
          url: url
        },
        success: (function(_this) {
          return function(model) {
            return dfd.resolve(_this.add(model.toJSON()));
          };
        })(this),
        error: function() {
          return dfd.rejectWith(this, arguments);
        }
      });
    }
    return dfd.promise();
  };

  StumblesCollection.prototype.whereUnseen = function() {
    var activeMode, modeName;
    activeMode = mediator.modesC.getActive();
    if (!activeMode) {
      return [];
    } else {
      modeName = activeMode.get('name');
      return this.filter(function(model) {
        return model.get('_mode') === modeName && model.get('_seen') === false;
      });
    }
  };

  StumblesCollection.prototype.getNext = function() {
    var dfd, getUnseenStumble, intervalId;
    dfd = new $.Deferred();
    getUnseenStumble = (function(_this) {
      return function() {
        var unseenM;
        unseenM = _this.whereUnseen()[0];
        if (unseenM != null) {
          clearInterval(intervalId);
          _this.publishEvent('stumble:gotnext');
          return dfd.resolve(unseenM);
        } else if (!utils.isLoggedIn() && utils.isVisitor()) {
          dfd.reject({
            error: "Cant fetch stumblers for a visitor",
            visitor: true
          });
          return clearInterval(intervalId);
        } else if (mediator.modesC.isStumblingDomain() && !_this.isFetching) {
          _this.isFetching = true;
          return _this.fetch().then(function(data) {
            _this.isFetching = false;
            return data;
          });
        }
      };
    })(this);
    intervalId = this.setInterval(getUnseenStumble, 250);
    getUnseenStumble();
    return dfd.promise();
  };

  StumblesCollection.prototype.addLegacy = function(path, query) {
    var appendedPath;
    appendedPath = utils.appendParams(path, {
      _nospa: true,
      _notoolbar: true
    });
    appendedPath += query ? '&' + query : '';
    return this.add({
      url: utils.getStumbleUrl() + '/' + appendedPath,
      urlid: path,
      title: 'StumbleUpon',
      _legacy: true
    });
  };

  StumblesCollection.prototype.getLegacyShareId = function(shareid) {
    var shareResp, stumbleM, userM;
    userM = new UserM;
    shareResp = null;
    stumbleM = null;
    return request(SU.Share.get, [
      null, null, {
        data: {
          id: shareid
        }
      }
    ]).then((function(_this) {
      return function(resp) {
        shareResp = resp;
        return _this.getById(resp.urlid);
      };
    })(this));
  };

  StumblesCollection.prototype.getUnreported = function() {
    return this.filter(function(model) {
      return model.get('_seen') === true && model.get('_reported') === false && model.get('_inflight') === false;
    });
  };

  return StumblesCollection;

})(Collection);


},{"../lib/analytics":116,"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/collection":167,"./stumble-model":239,"./user-model":258,"chaplin":773,"jquery":774,"lodash":776,"moment":778}],241:[function(require,module,exports){
var Model, SU, SubmitModel, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = SubmitModel = (function(_super) {
  __extends(SubmitModel, _super);

  function SubmitModel() {
    return SubmitModel.__super__.constructor.apply(this, arguments);
  }

  SubmitModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    options.data = {
      url: model.get('url'),
      nsfw: false
    };
    switch (method) {
      case 'create':
        return request(SU.Submit.submit, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return SubmitModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],242:[function(require,module,exports){
var Collection, SU, SubmitTagsCollection, UserTagM, request, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

UserTagM = require('./user-tag-model');

SU = require('../lib/su');

request = require('../lib/request');

_ = require('lodash');

module.exports = SubmitTagsCollection = (function(_super) {
  __extends(SubmitTagsCollection, _super);

  function SubmitTagsCollection() {
    return SubmitTagsCollection.__super__.constructor.apply(this, arguments);
  }

  SubmitTagsCollection.prototype.TYPE_INTEREST = 1;

  SubmitTagsCollection.prototype.TYPE_TAG = 2;

  SubmitTagsCollection.prototype.model = UserTagM;

  SubmitTagsCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(SU.History.getUsedTags, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  SubmitTagsCollection.prototype.parse = function(res) {
    var value;
    return value = _.filter(res.tagCloud, (function(_this) {
      return function(tag) {
        return tag.type === _this.TYPE_TAG;
      };
    })(this));
  };

  return SubmitTagsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./user-tag-model":259,"lodash":776}],243:[function(require,module,exports){
var InterestsCollection, SU, SuggestedInterestsCollection, request, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

InterestsCollection = require('./interests-collection');

SU = require('../lib/su');

request = require('../lib/request');

utils = require('../lib/utils');


/** a collection of the interest from the classification api endpoint. */

module.exports = SuggestedInterestsCollection = (function(_super) {
  __extends(SuggestedInterestsCollection, _super);

  function SuggestedInterestsCollection() {
    return SuggestedInterestsCollection.__super__.constructor.apply(this, arguments);
  }

  SuggestedInterestsCollection.prototype.announceEvents = 'suggestedinterests';

  SuggestedInterestsCollection.prototype.comparator = null;

  SuggestedInterestsCollection.prototype.maxSuggestions = 8;

  SuggestedInterestsCollection.prototype.initialize = function(models, options) {
    SuggestedInterestsCollection.__super__.initialize.apply(this, arguments);
    this.url = options.url;
    this.listenTo(this, 'change:checked', this.onChangeChecked);
    return this.listenTo(this, 'add', this.onAdd);
  };

  SuggestedInterestsCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        if (options.data == null) {
          options.data = {
            url: this.url
          };
        }
        options.ignoreSuccessProperty = true;
        return request(SU.Url.getSuggestedInterests, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  SuggestedInterestsCollection.prototype.parse = function(response, options) {
    var interests;
    if (!response._success) {
      return [];
    }
    interests = SuggestedInterestsCollection.__super__.parse.apply(this, arguments);
    return interests.slice(0, this.maxSuggestions);
  };

  SuggestedInterestsCollection.prototype.unshift = function(model) {
    this.pop();
    return SuggestedInterestsCollection.__super__.unshift.apply(this, arguments);
  };

  SuggestedInterestsCollection.prototype.push = function(model) {
    this.shift();
    return SuggestedInterestsCollection.__super__.push.apply(this, arguments);
  };

  SuggestedInterestsCollection.prototype.onAdd = function(model, collection, options) {
    if (collection.length > this.maxSuggestions) {
      collection.pop();
    }
    return this.onChangeChecked(model, model.getChecked(), options);
  };

  SuggestedInterestsCollection.prototype.onChangeChecked = function(model, value, options) {
    if (value) {
      this.where({
        checked: true
      }).forEach(function(interest) {
        if (model.id !== interest.id) {
          return interest.setChecked(false);
        }
      });
    }
    return true;
  };

  return SuggestedInterestsCollection;

})(InterestsCollection);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./interests-collection":188}],244:[function(require,module,exports){
var Collection, Model, SU, TagCloudCollection, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

Model = require('./base/model');

module.exports = TagCloudCollection = (function(_super) {
  __extends(TagCloudCollection, _super);

  function TagCloudCollection() {
    return TagCloudCollection.__super__.constructor.apply(this, arguments);
  }

  TagCloudCollection.prototype.model = Model;

  TagCloudCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(SU.History.getUsedTags, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  TagCloudCollection.prototype.parse = function(res) {
    var tags;
    this._total = res._total;
    tags = res.tagCloud;
    tags.forEach((function(_this) {
      return function(tag) {
        if (tag.type === 2) {
          return tag._isTag = true;
        }
      };
    })(this));
    return tags;
  };

  return TagCloudCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167,"./base/model":168}],245:[function(require,module,exports){
var Collection, Model, TagCloudItemCollection,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

Model = require('./base/model');

module.exports = TagCloudItemCollection = (function(_super) {
  __extends(TagCloudItemCollection, _super);

  function TagCloudItemCollection() {
    return TagCloudItemCollection.__super__.constructor.apply(this, arguments);
  }

  TagCloudItemCollection.prototype.model = Model;

  return TagCloudItemCollection;

})(Collection);


},{"./base/collection":167,"./base/model":168}],246:[function(require,module,exports){
var Model, SU, ThumbnailModel, request, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

_ = require('lodash');

module.exports = ThumbnailModel = (function(_super) {
  __extends(ThumbnailModel, _super);

  function ThumbnailModel() {
    return ThumbnailModel.__super__.constructor.apply(this, arguments);
  }

  ThumbnailModel.prototype.sync = function(method, model, options) {
    var changedAttr, updateMethod;
    if (options == null) {
      options = {};
    }
    if (method === 'read') {
      options.data = {
        urlid: model.get('urlid')
      };
    } else if (method === 'create') {
      changedAttr = _(this.changed).keys().pop();
      if (changedAttr === 'urlid') {
        updateMethod = SU.Url.getInfo;
        options.data = {
          urlid: model.get('urlid')
        };
      } else {
        updateMethod = SU.Url.addThumb;
        options.data = {
          url: model.get('url')
        };
      }
    }
    switch (method) {
      case 'create':
        return request(updateMethod, arguments);
      case 'read':
        return request(SU.Url.getThumb, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return ThumbnailModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"lodash":776}],247:[function(require,module,exports){
var Model, SU, TimerModel, request, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

_ = require('lodash');

module.exports = TimerModel = (function(_super) {
  __extends(TimerModel, _super);

  function TimerModel() {
    return TimerModel.__super__.constructor.apply(this, arguments);
  }

  TimerModel.prototype.idAttribute = 'urlid';

  TimerModel.prototype.initialize = function() {
    TimerModel.__super__.initialize.apply(this, arguments);
    return this.on('change:nextStumbleClick', (function(_this) {
      return function() {
        return _.defer(function() {
          return _this.save();
        });
      };
    })(this));
  };

  TimerModel.prototype.sync = function(method, model, options) {
    var key, stumbleinfo, value, _ref;
    stumbleinfo = [];
    _ref = this.toJSON();
    for (key in _ref) {
      if (!__hasProp.call(_ref, key)) continue;
      value = _ref[key];
      if (key !== 'urlid') {
        stumbleinfo.push({
          event: key,
          timestamp: value
        });
      }
    }
    options.data = {
      urlid: this.get('urlid'),
      stumbleinfo: JSON.stringify(stumbleinfo)
    };
    switch (method) {
      case 'update':
        return request(SU.Report.timers, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return TimerModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"lodash":776}],248:[function(require,module,exports){
var Collection, TimerM, TimersCollection, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

TimerM = require('./timer-model');

utils = require('../lib/utils');

module.exports = TimersCollection = (function(_super) {
  __extends(TimersCollection, _super);

  function TimersCollection() {
    return TimersCollection.__super__.constructor.apply(this, arguments);
  }

  TimersCollection.prototype.model = TimerM;

  TimersCollection.prototype.initialize = function() {
    TimersCollection.__super__.initialize.apply(this, arguments);
    this.subscribeEvent('stumble:startloading', (function(_this) {
      return function(data) {
        return _this.add({
          urlid: data.urlid,
          startLoad: data.timestamp
        });
      };
    })(this));
    this.subscribeEvent('stumble:loaded', (function(_this) {
      return function(data) {
        var _ref;
        return (_ref = _this.findWhere({
          urlid: data.urlid
        })) != null ? _ref.set({
          pageLoaded: utils.unix()
        }) : void 0;
      };
    })(this));
    return this.subscribeEvent('stumble:next', (function(_this) {
      return function(urlid) {
        var _ref;
        return (_ref = _this.findWhere({
          urlid: urlid
        })) != null ? _ref.set({
          nextStumbleClick: utils.unix()
        }) : void 0;
      };
    })(this));
  };

  return TimersCollection;

})(Collection);


},{"../lib/utils":156,"./base/collection":167,"./timer-model":247}],249:[function(require,module,exports){
var $, Model, SU, TwitterConnectModel, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

$ = require('jquery');

module.exports = TwitterConnectModel = (function(_super) {
  __extends(TwitterConnectModel, _super);

  function TwitterConnectModel() {
    this.notifyError = __bind(this.notifyError, this);
    this.notifyLink = __bind(this.notifyLink, this);
    this.redirectToTwitter = __bind(this.redirectToTwitter, this);
    return TwitterConnectModel.__super__.constructor.apply(this, arguments);
  }

  TwitterConnectModel.prototype.sync = function(method, model, options) {
    var user;
    if (options == null) {
      options = {};
    }
    switch (method) {
      case 'read':
        options = {
          success: this.redirectToTwitter
        };
        user = new SU.User;
        return request(user.twitterConnectionRequest, [null, null, options]);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  TwitterConnectModel.prototype.redirectToTwitter = function(response) {
    var _ref, _ref1;
    if ((response != null ? (_ref = response.data) != null ? _ref.url : void 0 : void 0) != null) {
      window.location.href = response.data.url;
    }
    if ((response != null ? (_ref1 = response.data) != null ? _ref1.oauth_token_secret : void 0 : void 0) != null) {
      return $.cookie('oauth_token_secret', response.data.oauth_token_secret);
    }
  };

  TwitterConnectModel.prototype.connectionRequestCallback = function(data) {
    var options, user;
    options = {
      data: data,
      success: this.notifyLink,
      error: this.notifyError
    };
    user = new SU.User;
    return request(user.twitterConnectionRequestCallback, [null, null, options]);
  };

  TwitterConnectModel.prototype.twitterUnlink = function() {
    var user;
    user = new SU.User;
    return request(user.twitterUnlink, [null, null, {}]);
  };

  TwitterConnectModel.prototype.notifyLink = function(res) {
    return this.publishEvent('twitter:model:link:success', res);
  };

  TwitterConnectModel.prototype.notifyError = function(res) {
    var errorMessage, _ref;
    errorMessage = (_ref = JSON.parse(res.responseText)) != null ? _ref._error : void 0;
    return this.publishEvent('twitter:model:error', errorMessage);
  };

  return TwitterConnectModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"jquery":774}],250:[function(require,module,exports){
var Model, SU, UnfollowListModel, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = UnfollowListModel = (function(_super) {
  __extends(UnfollowListModel, _super);

  function UnfollowListModel() {
    return UnfollowListModel.__super__.constructor.apply(this, arguments);
  }

  UnfollowListModel.prototype.sync = function(method, model, options) {
    var user;
    if (options == null) {
      options = {};
    }
    user = new SU.User;
    options.data = {
      userid: model.get('userid'),
      listId: model.get('listid')
    };
    switch (method) {
      case 'create':
        return request(user.unfollowList, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return UnfollowListModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],251:[function(require,module,exports){
var Model, SU, UnfollowModel, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = UnfollowModel = (function(_super) {
  __extends(UnfollowModel, _super);

  function UnfollowModel() {
    return UnfollowModel.__super__.constructor.apply(this, arguments);
  }

  UnfollowModel.prototype.sync = function(method, model, options) {
    var success, user;
    if (options == null) {
      options = {};
    }
    user = new SU.User;
    options.data = {
      userid: model.get('userid')
    };
    success = options.success || function() {};
    options.success = (function(_this) {
      return function() {
        _this.publishEvent('mutual:update');
        return success(arguments);
      };
    })(this);
    switch (method) {
      case 'create':
        return request(user.unfollow, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return UnfollowModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],252:[function(require,module,exports){
var Model, SU, UrlModel, request, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

_ = require('lodash');

utils = require('../lib/utils');

module.exports = UrlModel = (function(_super) {
  __extends(UrlModel, _super);

  function UrlModel() {
    return UrlModel.__super__.constructor.apply(this, arguments);
  }

  UrlModel.prototype.initialize = function(attributes) {
    UrlModel.__super__.initialize.apply(this, arguments);
    if (attributes != null ? attributes.url : void 0) {
      return this.setUrl(attributes.url);
    }
  };

  UrlModel.prototype.sync = function(method, model, options) {
    var changedAttr, updateMethod;
    if (options == null) {
      options = {};
    }
    if (method === 'read') {
      options.data = {
        urlid: model.get('urlid')
      };
    } else if (method === 'create') {
      changedAttr = _(this.changed).keys().pop();
      if (changedAttr === 'urlid') {
        updateMethod = SU.Url.getInfo;
        options.data = {
          urlid: model.get('urlid')
        };
      } else {
        updateMethod = SU.Url.addThumb;
        options.data = {
          url: model.get('url')
        };
      }
    }
    switch (method) {
      case 'create':
        return request(updateMethod, arguments);
      case 'read':
        return request(SU.Url.getThumb, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  UrlModel.prototype.set = function(attributes, options) {
    attributes['_trackingPrefix'] = utils.isVisitor() ? 'visitor:' : '';
    return UrlModel.__super__.set.apply(this, arguments);
  };

  UrlModel.prototype.setUrl = function(url) {
    var decodedUrl;
    if (!/^https{0,1}:\/\/[\S]+$/.test(url)) {
      decodedUrl = decodeURIComponent(url);
      if (/^https{0,1}:\/\/[\S]+$/.test(decodedUrl)) {
        return this.set('url', decodedUrl);
      }
    }
    return this.set('url', url);
  };

  UrlModel.prototype.getUrl = function() {
    return this.get('url');
  };

  UrlModel.prototype.setNsfw = function(nsfw) {
    return this.set('nsfw', nsfw);
  };

  UrlModel.prototype.getNsfw = function() {
    return this.get('nsfw');
  };

  UrlModel.prototype.getUrlId = function() {
    var urlId;
    urlId = this.get('publicid');
    if (!urlId) {
      urlId = this.get('urlid');
    }
    return urlId;
  };

  UrlModel.prototype.getRating = function() {
    return this.get('rating');
  };

  return UrlModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"lodash":776}],253:[function(require,module,exports){
var Model, SU, UrlRequeueModel, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = UrlRequeueModel = (function(_super) {
  __extends(UrlRequeueModel, _super);

  function UrlRequeueModel() {
    return UrlRequeueModel.__super__.constructor.apply(this, arguments);
  }

  UrlRequeueModel.prototype.sync = function(method, model, options) {
    if (options == null) {
      options = {};
    }
    switch (method) {
      case 'create':
        options.data = {
          urlpublicid: model.get('urlid')
        };
        return request(SU.Url.requeue, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  return UrlRequeueModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168}],254:[function(require,module,exports){
var Collection, SU, UrlsCollection, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = UrlsCollection = (function(_super) {
  __extends(UrlsCollection, _super);

  function UrlsCollection() {
    return UrlsCollection.__super__.constructor.apply(this, arguments);
  }

  UrlsCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(SU.Url.getUrls, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  UrlsCollection.prototype.parse = function(res) {
    var _ref;
    return (_ref = res.urls) != null ? _ref.values : void 0;
  };

  return UrlsCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167}],255:[function(require,module,exports){
var Collection, SU, UrlM, UrlsForInterestCollection, request, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

utils = require('../lib/utils');

UrlM = require('./url-model');

module.exports = UrlsForInterestCollection = (function(_super) {
  __extends(UrlsForInterestCollection, _super);

  function UrlsForInterestCollection() {
    return UrlsForInterestCollection.__super__.constructor.apply(this, arguments);
  }

  UrlsForInterestCollection.prototype.model = UrlM;

  UrlsForInterestCollection.prototype.initialize = function() {
    this.pageStateId = utils.fingerprint();
    return UrlsForInterestCollection.__super__.initialize.apply(this, arguments);
  };

  UrlsForInterestCollection.prototype.sync = function(method, model, options) {
    options = options || {
      data: {}
    };
    options.data = options.data || {};
    options.data._pageStateId = this.pageStateId;
    switch (method) {
      case 'read':
        return request(SU.Interests.getUrls, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  UrlsForInterestCollection.prototype.parse = function(res, options) {
    var limit, _ref, _ref1, _ref2;
    this._total = ((_ref = res.urls) != null ? _ref.length : void 0) + this._total;
    limit = (options != null ? (_ref1 = options.data) != null ? _ref1.limit : void 0 : void 0) || ((_ref2 = res.urls) != null ? _ref2.length : void 0) || 1;
    return this._parsePaginated({
      values: res.urls,
      _total: this._total,
      _limit: limit
    });
  };

  return UrlsForInterestCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/collection":167,"./url-model":252}],256:[function(require,module,exports){
var $, InterestsCollection, SU, UserInterestsCollection, request, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

InterestsCollection = require('./interests-collection');

SU = require('../lib/su');

request = require('../lib/request');

_ = require('lodash');

$ = require('jquery');

utils = require('../lib/utils');

module.exports = UserInterestsCollection = (function(_super) {
  __extends(UserInterestsCollection, _super);

  function UserInterestsCollection() {
    this.getUserInterestIdsJson = __bind(this.getUserInterestIdsJson, this);
    this._getInterestsCollectionPromise = __bind(this._getInterestsCollectionPromise, this);
    return UserInterestsCollection.__super__.constructor.apply(this, arguments);
  }

  UserInterestsCollection.prototype.comparator = 'name';

  UserInterestsCollection.prototype.initialize = function(options) {
    UserInterestsCollection.__super__.initialize.apply(this, arguments);
    return this.user = new SU.User();
  };

  UserInterestsCollection.prototype.sync = function(method, model, options) {
    if (options.data == null) {
      options.data = {
        userid: options != null ? options.userId : void 0
      };
    }
    switch (method) {
      case 'read':
        return request(this.user.getInterests, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  UserInterestsCollection.prototype.parse = function(res, options) {
    var values, _ref;
    values = (_ref = res.interests) != null ? _ref.values : void 0;
    _.each(values, function(value) {
      return value.checked = true;
    });
    return values;
  };

  UserInterestsCollection.prototype._getInterestsCollectionPromise = function() {
    return $.when(utils.getCachedCollection('all-interests', utils.DAY_IN_MILLISECONDS, InterestsCollection, {}, true), utils.getCachedCollection('popular-interests', utils.DAY_IN_MILLISECONDS, PopularInterestsCollection, {}, true));
  };

  UserInterestsCollection.prototype.getUserInterestIdsJson = function() {
    var interestIds;
    interestIds = this.pluck('id');
    return JSON.stringify(interestIds);
  };

  return UserInterestsCollection;

})(InterestsCollection);


},{"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./interests-collection":188,"jquery":774,"lodash":776}],257:[function(require,module,exports){
var Model, MyInterestsModel, SU, mediator, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

mediator = require('chaplin').mediator;

SU = require('../lib/su');

request = require('../lib/request');


/**
  This model will deal with the setInterests endpoint for the current user
  pass it a 'myInterestsC' with the current user's interests
  and call 'save' when things are updated.  On 'save', an array of interest ids
  is extracted from the user's interests collection and posted to the
  "/user/#{userid}/interests" endpoint, then when the sync event is triggered,
  the user's interest collection is refetched.
 */

module.exports = MyInterestsModel = (function(_super) {
  __extends(MyInterestsModel, _super);

  function MyInterestsModel() {
    return MyInterestsModel.__super__.constructor.apply(this, arguments);
  }

  MyInterestsModel.prototype.initialize = function(options) {
    var userM;
    MyInterestsModel.__super__.initialize.apply(this, arguments);
    userM = mediator.userM;
    this.set('userM', userM);
    this.userId = userM.get('userid');
    this.listenTo(this, 'sync', this.onSync);
    return this.listenTo(this.getMyInterestsCollection(), 'sync', this.onMyInterestsSync);
  };

  MyInterestsModel.prototype.getMyInterestsCollection = function() {
    return this.get('myInterestsC');
  };

  MyInterestsModel.prototype.getAllInterestsCollection = function() {
    return this.get('allInterestsC');
  };

  MyInterestsModel.prototype.getUserModel = function() {
    return this.get('userM');
  };

  MyInterestsModel.prototype.getInterestIds = function() {
    return this.getMyInterestsCollection().pluck('id');
  };

  MyInterestsModel.prototype.sync = function(method, model, options) {
    var interestIds, user, userId, _ref;
    if (options == null) {
      options = {};
    }
    switch (method) {
      case 'create':
        user = new SU.User();
        userId = (_ref = this.getUserModel()) != null ? _ref.id : void 0;
        if (!userId) {
          throw new Error('Missing user id');
        }
        interestIds = this.getInterestIds();
        options.data = {
          userid: userId,
          interests: interestIds
        };
        this.trigger('request', this, null, options);
        return request(user.setInterests, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  MyInterestsModel.prototype.onSync = function(model, resp, options) {
    return this.getMyInterestsCollection().fetch({
      userId: this.userId,
      remove: true
    });
  };

  MyInterestsModel.prototype.onMyInterestsSync = function(collection, resp, options) {
    var allInterestsC;
    allInterestsC = this.getAllInterestsCollection();
    if (allInterestsC) {
      return this.markMyInterests(collection, allInterestsC);
    }
  };

  MyInterestsModel.prototype.isFollowingInterestById = function(interestId) {
    var myInterestsC;
    myInterestsC = this.getMyInterestsCollection();
    if (myInterestsC.findWhere({
      id: interestId.toString()
    })) {
      return true;
    } else {
      return false;
    }
  };


  /*
   * sets the checked state (see widget-provider) of interest models in an InterestCollection depending
   * on their presence in this user-interests collection
   */

  MyInterestsModel.prototype.markMyInterests = function(myInterests, allInterests) {
    return allInterests.eachLeafNode(function(interestM) {
      if (myInterests.findWhere({
        id: interestM.getId()
      })) {
        return interestM.set({
          checked: true
        }, {
          silent: true
        });
      } else {
        return interestM.set({
          checked: false
        }, {
          silent: true
        });
      }
    });
  };

  return MyInterestsModel;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"chaplin":773}],258:[function(require,module,exports){
var Mixin, Model, SU, SetUserThumbnail, UserModel, analytics, config, request, storage, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SU = require('../lib/su');

Model = require('./base/model');

request = require('../lib/request');

utils = require('../lib/utils');

storage = require('simple-storage');

analytics = require('../lib/analytics');

_ = require('lodash');

Mixin = require('mixen');

SetUserThumbnail = require('./mixins/set-user-thumbnail');

config = require('../config');

module.exports = UserModel = (function(_super) {
  __extends(UserModel, _super);

  function UserModel() {
    return UserModel.__super__.constructor.apply(this, arguments);
  }

  UserModel.prototype.idAttribute = 'userid';

  UserModel.prototype.listenersStarted = false;

  UserModel.prototype.initialize = function(attributes, options) {
    if (options == null) {
      options = {};
    }
    UserModel.__super__.initialize.apply(this, arguments);
    this.user = new SU.User;
    this.subscribeEvent('api:invalidtoken', this.handleTokenFailure);
    if (options.auth) {
      this.startListeners();
      switch (Number(this.get('gender'))) {
        case 1:
          return this.set('_gender', 'male');
        case 2:
          return this.set('_gender', 'female');
        default:
          return this.set('_gender', null);
      }
    }
  };

  UserModel.prototype.startListeners = function() {
    if (!this.listenersStarted) {
      this.listenersStarted = true;
      this.subscribeEvent('auth:loggedout', this.clear);
      this.on('change', (function(_this) {
        return function() {
          return storage.set('user', _this.toJSON());
        };
      })(this));
      this.listenTo(this, 'sync', this.restoreStumbleCount);
      this.restoreStumbleCount(this, null, null);
      this.subscribeEvent('stumble:next', (function(_this) {
        return function() {
          _this.set('stumbles_count', parseInt(_this.get('stumbles_count')) + 1);
          return storage.set('stumbles_count' + _this.get('userid'), _this.get('stumbles_count'));
        };
      })(this));
      return this.subscribeEvent('interest:sync', this.refreshFromUserInterests);
    }
  };

  UserModel.prototype.restoreStumbleCount = function(model, response, options) {
    var currentCount, storedCount;
    storedCount = storage.get('stumbles_count' + this.get('userid')) || 0;
    currentCount = this.get('stumbles_count');
    if (currentCount < storedCount) {
      return this.set('stumbles_count', storedCount);
    }
  };

  UserModel.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(this.user.get, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  UserModel.prototype.parse = function(res) {
    res.user.stumbles_count = Number(res.user.stumbles_count);
    if (res.user.likes_count) {
      res.user.likes_count = Math.max(0, res.user.likes_count);
    }
    return res.user;
  };

  UserModel.prototype.handleTokenFailure = function(ev) {
    utils.clearAllCookies();
    this.clear;
    return window.location.href = '/';
  };

  UserModel.prototype.setFromAuthResponse = function(res) {
    var _ref;
    if (((res != null ? (_ref = res.credentials) != null ? _ref.key : void 0 : void 0) != null) && (res.su_remember != null)) {
      utils.setSuAccessToken(res.credentials.key);
      utils.setSURemember(res.su_remember);
      utils.setUserid(res.user.userid);
      this.set(res.user);
      return storage.set('user', this.toJSON());
    }
  };

  UserModel.prototype.refreshFromUserInterests = function(collection, resp, options) {
    var _ref;
    if (utils.getLoggedInUserId() === (options != null ? (_ref = options.data) != null ? _ref.userid : void 0 : void 0)) {
      return this.set('interests_count', collection.length);
    }
  };

  return UserModel;

})(Mixin(SetUserThumbnail, Model));


},{"../config":2,"../lib/analytics":116,"../lib/request":128,"../lib/su":153,"../lib/utils":156,"./base/model":168,"./mixins/set-user-thumbnail":207,"lodash":776,"mixen":777,"simple-storage":780}],259:[function(require,module,exports){
var Model, UserTag,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

module.exports = UserTag = (function(_super) {
  __extends(UserTag, _super);

  function UserTag() {
    return UserTag.__super__.constructor.apply(this, arguments);
  }

  UserTag.prototype.widgetTextAttribute = 'name';

  UserTag.prototype.widgetDataIdAttribute = 'name';

  UserTag.prototype.setName = function(name) {
    return this.set('name', name.trim());
  };

  UserTag.prototype.getName = function() {
    return this.get('name');
  };

  return UserTag;

})(Model);


},{"./base/model":168}],260:[function(require,module,exports){
var Model, SU, UserToken, mediator, request,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Model = require('./base/model');

SU = require('../lib/su');

request = require('../lib/request');

mediator = require('chaplin').mediator;

module.exports = UserToken = (function(_super) {
  __extends(UserToken, _super);

  function UserToken() {
    this.onRequestTokenSuccess = __bind(this.onRequestTokenSuccess, this);
    return UserToken.__super__.constructor.apply(this, arguments);
  }

  UserToken.prototype.sync = function(method, model, options) {
    var user;
    if (options == null) {
      options = {};
    }
    options = {
      success: this.onRequestTokenSuccess,
      data: {}
    };
    user = new SU.User;
    switch (method) {
      case 'read':
        return request(user.requestToken, [null, null, options]);
    }
  };

  UserToken.prototype.onRequestTokenSuccess = function(res) {
    var _ref;
    if (res != null ? (_ref = res.token) != null ? _ref.key : void 0 : void 0) {
      return this.publishEvent('user-token:request:success', res.token.key);
    }
  };

  return UserToken;

})(Model);


},{"../lib/request":128,"../lib/su":153,"./base/model":168,"chaplin":773}],261:[function(require,module,exports){
var Collection, SU, UsersCollection, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Collection = require('./base/collection');

SU = require('../lib/su');

request = require('../lib/request');

module.exports = UsersCollection = (function(_super) {
  __extends(UsersCollection, _super);

  function UsersCollection() {
    return UsersCollection.__super__.constructor.apply(this, arguments);
  }

  UsersCollection.prototype.initialize = function() {
    return this.user = new SU.User();
  };

  UsersCollection.prototype.sync = function(method, model, options) {
    switch (method) {
      case 'read':
        return request(this.user.getUsers, arguments);
      default:
        throw new Error(method + ' unsupported');
    }
  };

  UsersCollection.prototype.parse = function(res) {
    var _ref;
    return (_ref = res.users) != null ? _ref.values : void 0;
  };

  return UsersCollection;

})(Collection);


},{"../lib/request":128,"../lib/su":153,"./base/collection":167}],262:[function(require,module,exports){
var $, SU, StumbleM, StumblesCollection, VisitorStumblesCollection, mediator, storage, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

$ = require('jquery');

StumblesCollection = require('./stumbles-collection');

SU = require('../lib/su');

utils = require('../lib/utils');

mediator = require('chaplin').mediator;

storage = require('simple-storage');

StumbleM = require('./stumble-model');

_ = require('underscore');

module.exports = VisitorStumblesCollection = (function(_super) {
  __extends(VisitorStumblesCollection, _super);

  function VisitorStumblesCollection() {
    return VisitorStumblesCollection.__super__.constructor.apply(this, arguments);
  }

  VisitorStumblesCollection.prototype.canFetchStorage = true;

  VisitorStumblesCollection.prototype.seenStumblesKey = 'seen-stumbles';

  VisitorStumblesCollection.prototype.SuggestedStumblesKey = 'Suggested-stumbles';

  VisitorStumblesCollection.prototype.urlRegexTracking = /(\/su\/[a-zA-Z\d]+\/.+:.[^\/]+\/)/;

  VisitorStumblesCollection.prototype.urlidRegex = /(\/su\/[a-zA-Z\d]+\/)/;

  VisitorStumblesCollection.prototype.comparator = function(stumble) {
    return stumble.get('urlid');
  };

  VisitorStumblesCollection.prototype.setActive = function(urlid) {
    VisitorStumblesCollection.__super__.setActive.apply(this, arguments);
    return this.markSeen(this.getActive());
  };

  VisitorStumblesCollection.prototype.getNext = function() {
    var dfd, stumble;
    dfd = new $.Deferred();
    stumble = this.getNewStumble();
    if (!stumble || this.length < mediator.visitorStumbleCountMax) {
      this.fetch({
        fresh: true,
        remove: false,
        merge: false,
        success: (function(_this) {
          return function() {
            return dfd.resolve(_this.getNewStumble());
          };
        })(this),
        error: function() {
          return dfd.reject();
        }
      });
      return dfd;
    } else {
      return dfd.resolve(stumble);
    }
  };

  VisitorStumblesCollection.prototype.getNewStumble = function(preventRecurse) {
    var newStumble, stumbles;
    stumbles = this.getUnseenStumbles(1);
    newStumble = null;
    if (stumbles.length) {
      newStumble = stumbles[0];
      return newStumble;
    } else if (!preventRecurse) {
      this.clearSeen();
      return this.getNewStumble(true);
    }
  };

  VisitorStumblesCollection.prototype.getSeen = function() {
    return storage.get(this.seenStumblesKey) || [];
  };

  VisitorStumblesCollection.prototype.markSeen = function(models) {
    return this._saveToList(models, this.seenStumblesKey);
  };

  VisitorStumblesCollection.prototype.clearSeen = function() {
    return storage.remove(this.seenStumblesKey);
  };

  VisitorStumblesCollection.prototype.getUnseenStumbles = function(count) {
    var list;
    return list = this.filterModelsByIds(this.models, this.getSeen(), count);
  };

  VisitorStumblesCollection.prototype.getSuggested = function() {
    return storage.get(this.SuggestedStumblesKey) || [];
  };

  VisitorStumblesCollection.prototype.markSuggested = function(models) {
    return this._saveToList(models, this.SuggestedStumblesKey);
  };

  VisitorStumblesCollection.prototype.getNewSuggestionStumbles = function(count) {
    return this.filterModelsByIds(this.models, this.getSuggested(), count || 4);
  };

  VisitorStumblesCollection.prototype.getInactive = function() {
    return _.filter(this.models, function(model) {
      return model.get('_active') !== true;
    });
  };

  VisitorStumblesCollection.prototype.getApiMethod = function() {
    return SU.Stumble.suggestVisitor;
  };

  VisitorStumblesCollection.prototype.parse = function(res, options) {
    if (res.urls.values.length > 0) {
      return res.urls.values.filter(function(url) {
        return url !== null;
      }).map(function(url) {
        var _ref, _ref1;
        url._for = options != null ? (_ref = options.data) != null ? _ref.userid : void 0 : void 0;
        url._mode = options != null ? options._mode : void 0;
        url._listId = options != null ? (_ref1 = options.data) != null ? _ref1.listId : void 0 : void 0;
        return url;
      });
    }
  };

  VisitorStumblesCollection.prototype._saveToList = function(models, key) {
    var list, ret;
    if (!Array.isArray(models)) {
      if (!(models instanceof Chaplin.Model)) {
        return;
      }
      models = [models];
    }
    list = storage.get(key) || [];
    ret = [list.length];
    _.each(models, function(model) {
      var urlid;
      urlid = model != null ? model.get('urlid') : void 0;
      if (urlid && __indexOf.call(list, urlid) < 0) {
        return list.push(urlid);
      }
    });
    storage.set(key, list);
    ret.push(list.length, list);
    return ret;
  };

  VisitorStumblesCollection.prototype.filterModelsByIds = function(useModels, filterIds, count) {
    var arr;
    arr = _.filter(useModels || [], function(model) {
      var index, urlid;
      urlid = model != null ? model.get('urlid') : void 0;
      if ((index = filterIds.indexOf(urlid)) > -1) {
        filterIds.splice(index, 1);
        return false;
      } else {
        return true;
      }
    });
    if (count) {
      return _.sample(arr, count);
    } else {
      return arr;
    }
  };

  VisitorStumblesCollection.prototype.storeCurrentStumble = function(stumble) {
    var urlid;
    urlid = stumble.get('urlid');
    return storage.set(this.storageKey, urlid);
  };

  VisitorStumblesCollection.prototype.getStoredStumble = function() {
    var storedUrlId;
    storedUrlId = storage.get(this.storageKey);
    if (storedUrlId) {
      return this.findWhere({
        urlid: storedUrlId
      });
    }
  };

  VisitorStumblesCollection.prototype.outOfStumbles = function() {
    return Chaplin.utils.redirectTo({
      url: "lists/1344823807946546320/runout"
    });
  };

  return VisitorStumblesCollection;

})(StumblesCollection);


},{"../lib/su":153,"../lib/utils":156,"./stumble-model":239,"./stumbles-collection":240,"chaplin":773,"jquery":774,"simple-storage":780,"underscore":783}],263:[function(require,module,exports){
module.exports = function(match) {
  match('su/api/nextstumble', 'toolbar#stumbleNext');
  match('return', 'toolbar#stumbleNext');
  match('to/stumble/stumblethru:*domain', 'toolbar#stumbleThru');
  match('to/stumble/topic:*topic', 'toolbar#stumbleTopic');
  match('to/s', 'toolbar#stumbleNext');
  match('su/share/:shareid*anything', 'toolbar#shareLegacy');
  match('su/video/:urlid*anything', 'toolbar#stumble');
  match('su/:urlid/panel/:panel', 'toolbar#stumble');
  match('su/:urlid/\::tracking_code/*content_url', 'toolbar#stumble');
  match('su/:urlid*anything', 'toolbar#stumble');
  match('su/*anything', 'toolbar#stumbleNext');
  match('su', 'toolbar#stumbleNext');
  match('convo/:conversationId/:visitorParticipantId*anything', 'toolbar#stumbleToConversation');
  match('convo/:conversationId*anything', 'toolbar#stumbleToConversation');
  match('', 'homepage#home');
  match('login', 'homepage#home');
  match('logout', 'login#logout');
  match('logged-out', 'login#logout');
  match('signup', 'login#logout');
  match('home', 'homepage#home');
  match('submit', 'submit#showSubmit');
  match('submit/*anything', 'submit#showSubmit');
  match('badge', 'submit#showBadge');
  match('badge/apierr', 'errors/badge-submit-errors#api');
  match('badge/*anything', 'submit#showBadge');
  match('likecontent', 'submit#submitToLikes');
  match('apierr', 'errors#api');
  match('verify/:email/:hash', 'email-verify#verifyMail');
  match('content/:urlid', 'url-info#displayUrlInfo');
  match('content/*anything', 'url-info#displayUrlInfoUrl');
  match('discover/interests', 'interests#editMyInterests');
  match('signup/choose-interests', 'interests#createMyInterests');
  match('suggest-interests', 'interests#suggestInterests');
  match('suggest_interests.php', 'interests#suggestInterests');
  match('suggest_interests', 'interests#suggestInterests');
  match('impossible', 'errors/impossible-url#impossible');
  match('403', 'errors/forbidden#forbidden');
  match('404', 'errors/not-found#notFound');
  match('500', 'errors/internal-server#api');
  match('app-start-fail', 'errors/app-start#fail');
  match('stumbles/create-new-list', 'toolbar#createNewList');
  match('following/runout', 'following-runout#displayFollowingRecommend');
  match('top-stumblers', 'following-runout#displayFollowingRecommend');
  match('feedback', 'toolbar#redirectToFeedback');
  match('addon', 'addon#displayAddon');
  match('stumblebar-addon', 'addon#displayStumbleBarAddon');
  match('rc', 'mix#rc');
  match('stumbler/:username/messages', 'toolbar#showActivityCenter');
  match('stumbler/:username/list/:listId', 'profile/list#displayList');
  match('stumbler/:username/lists', 'profile/lists#displayLists');
  match('stumbler/:username/lists/following', 'profile/followinglists#displayLists');
  match('stumbler/:username/likes', 'profile/likes#displayLikes');
  match('stumbler/:username/likes/tagcloud', 'profile/tag-cloud#displayTagCloud');
  match('stumbler/:username/tagcloud', 'profile/tag-cloud#displayTagCloud');
  match('stumbler/:username/photos', 'profile/photolikes#displayPhotoLikes');
  match('stumbler/:username/videos', 'profile/videolikes#displayVideoLikes');
  match('stumbler/:username/additions', 'profile/additionslikes#displayAdditionLikes');
  match('stumbler/:username/following', 'profile/following#displayFollowing');
  match('stumbler/:username/followers', 'profile/followers#displayFollowers');
  match('stumbler/:username/history', 'profile/history#displayHistory');
  match('stumbler/:username/interests', 'interests#viewInterests');
  match('stumbler/:username/interest/:interestId', 'profile/likes-by-interest#displayLikes');
  match('stumbler/:username/tag/:tagId', 'profile/likes-by-tag#displayLikes');
  match('stumbler/:username/connections', 'profile/following#connections');
  match('stumbler/:username', 'profile/likes#displayLikes');
  match('stumbler/:username/*anything', 'profile/likes#displayLikes');
  match('stumbler', 'profile/likes#displaySelf');
  match('list/:listId', 'profile/list#displayList');
  match('interest/:interestslug', 'url-collection#listUrls');
  match('interest/:interestid/:interestslug', 'url-collection#listUrls');
  match('reset-password', 'reset-password/request#index');
  match('reset-password/confirm/:confirmId', 'reset-password/confirm#index');
  match('reset-password/confirm', 'reset-password/confirm#index');
  match('reset_password', 'reset-password/request#index');
  match('reset_password/confirm/:confirmId', 'reset-password/confirm#index');
  match('reset_password/confirm', 'reset-password/confirm#index');
  match('settings', 'settings/profile#index', {
    name: 'settings-profile'
  });
  match('settings/profile', 'settings/profile#index', {
    name: 'settings-profile'
  });
  match('settings/account', 'settings/account#index', {
    name: 'settings-account'
  });
  match('settings/personalization', 'settings/personalization#index', {
    name: 'settings-personalization'
  });
  match('settings/notifications', 'settings/notifications#index', {
    name: 'settings-notifications'
  });
  match('settings/connections', 'settings/connections#index', {
    name: 'settings-connections'
  });
  match('settings/picture', 'settings/profile#index', {
    name: 'settings-profile'
  });
  match('settings/password', 'settings/account#index', {
    name: 'settings-account'
  });
  match('settings/privacy', 'settings/account#index', {
    name: 'settings-account'
  });
  match('settings/stumbles', 'settings/personalization#index', {
    name: 'settings-personalization'
  });
  match('*route', 'toolbar#directToDD', {
    constraints: {
      route: /^(sponsored-page|help)$/
    }
  });
  match('*route', 'toolbar#legacyHandler', {
    constraints: {
      route: /^(terms|terms\/uk|privacy|legal|toolbar-license|community-rules|addon|multipass)$/
    }
  });
  match('*route/panel/:panel', 'toolbar#legacyHandler');
  return match('*route', 'errors/not-found#notFound');
};


},{}],264:[function(require,module,exports){
module.exports = Object.freeze({
  YOUR_LIKES: "Likes",
  YOUR_LISTS: "Lists",
  YOUR_CONNECTIONS: "Connections",
  FOLLOW_MORE: "Follow More...",
  ADD_PAGE: "Add a Page",
  HELP: "Help",
  SETTINGS: "Settings",
  SIGN_OUT: "Sign Out",
  ADD_TO_LIST: "Add to List",
  SHARE_THIS_PAGE: "Share this Page",
  BROADCAST_THIS_PAGE: "Share this page with all of your StumbleUpon Followers",
  BROADCAST_ALREADY_SENT: "You already shared this page with your followers",
  NO_FOLLOWERS: "Sorry, but you have no followers.",
  BROADCAST_SENT: "Your post has been successfully sent!",
  COMMENTS: "Comments",
  LISTS: "Lists",
  LIKES: "Likes",
  DISCOVERED_BY: "Discovered By",
  HOURS_AGO: "hours ago",
  SENT_YOU_MESSAGE: "sent a message",
  SHARED_PAGE_WITH_YOU: "shared a page",
  NOT_FOR_ME: "Not for Me",
  ALREADY_SEEN: "Seen Page Already",
  DOESNT_LOAD: "Page Does Not Load",
  SPAM: "Report as Spam",
  WRONG_TOPIC: "Report Wrong Topic",
  BLOCK_SITE: "Block This Site",
  NEW_SHARES: "New Shares",
  NEW_MESSAGES: "New Messages",
  NEW_UPDATES: "New Updates",
  MOST_RECENT: "Most Recent",
  CREATE_LIST: "Create List",
  NAME: "Name",
  SEND_TO_EMAIL_ADDRESS: "Send to an Email Address",
  DESCRIPTION: "Description",
  VISIBILITY: "Visibility",
  SAVE: "Save",
  CREATE: "Create",
  CANCEL: "Cancel",
  CLOSE: "Close",
  STUMBLE: "Stumble",
  COMMENTS_ON_THIS_PAGE: "Comments on this page",
  ON: "on",
  YOUR_COMMENT: "Your Comment",
  YOUR_TAGS: "Your Tags",
  VIEW_ALL_COMMENTS: "View all comments",
  COMMENTED_BY: "Commented by",
  TYPE_TO_SEARCH_CREATE_LIST: "Search or Create a New List",
  CREATE_NEW_LIST: "Create New List",
  ALREADY_EXISTS: "already exists",
  CANNOT_ADD_TO_LIST: "Cannot add this page to a list",
  ALREADY_IN_LIST: "Already in the list",
  ADDED_TO: "Added to",
  LIST_NAME_EMPTY: "The list name is empty",
  YOUR_MESSAGE_SENT: "Your message has been sent!",
  ADD_EMAIL_OR_USERNAMES: "Enter emails or SU usernames...",
  SPONSORED: "Sponsored",
  WELCOME_BACK: "Welcome back,",
  CLICK_ADD_TO_LIST: "Click here to add this page to a list.",
  TELL_WHAT_YOU_THINK: "Tell other Stumblers what you think about this page.",
  SHARE_TO_FACEBOOK: "Share this page with your friends on Facebook.",
  SHARE_TO_ANYONE: "Share This Page with Anyone",
  STUMBLE_INTEREST: "Stumble through a specific Interest or Mode.",
  NOTIFICATION_TOOLTIP: "Activity &amp; Notification Center",
  NEW_NOTIFICATION_TOOLTIP: "You have # new notification(s).",
  MENU_HINT: "Browse your Likes, adjust your settings and explore more.",
  DISLIKE_PAGES: "Dislike web pages so we will show you less of stuff like this.",
  LIKE_PAGES: "Like web pages so we can show you even more pages you'll like.",
  CONTINUE: "Continue",
  ADD_TO_LISTS: "Add To Lists",
  STOP_SHARES: "Stop shares from this user",
  ALLOW_SHARES: "Allow shares from this user",
  SAVING: "Saving...",
  VIEW_REPLY: "View & Reply",
  NEW_SHARE: "New Share",
  YOUR_REPLY: "Your Reply",
  SEND: "Send",
  NEXT: "Next",
  SEARCH_INTERESTS: "Search Interests",
  ADD_TAGS: "Type your tag, then 'Enter' to add it",
  LOADING_INTERESTS: "Getting suggested categories from StumbleUpon classification service, please wait ...",
  BADGE_HEADER_TEXT: "Submit this page to StumbleUpon and add it to your Likes.",
  SAFE_FOR_WORK: "Safe for Work?",
  YES: "Yes",
  NO: "No",
  NSFW_IS_REQUIRED: "You must select safe for work",
  URL_MUST_BE_STRING: "Web address must be a string",
  URL_MUST_BE_GOOD: "Web address is not a valid url",
  CLASSIFICATION_IS_REQUIRED: "Please tell us what this page is about",
  WHAT_IS_THIS_PAGE_ABOUT: "What is this page about?  (choose one)",
  TAG_THIS_PAGE: "Add one or more tags",
  ADDED_TO_YOUR_LIKES: "This page has been added to your likes.",
  EDIT_MY_INTERESTS: "Edit My Interests",
  SIGNUP_WELCOME: "Welcome to StumbleUpon, Stumbler",
  CREATE_MY_INTERESTS: "Please Select 10 Interests",
  WHY_TEN_INTERESTS: "Why ten? You'll get better sites, better recommendations, and endless entertainment",
  CONGRATULATIONS_YOU_ARE_READY_TO_STUMBLE: "Congratulations! You're ready to Stumble",
  KEEP_GOING: "Keep Going",
  OR_ALL_CAPS: "OR",
  START_STUMBLING: "Start Stumbling",
  YOU_MIGHT_LIKE: "You might like",
  WE_FOUND_SOME_GREAT_RECOMMENDATIONS: "We found some great recommendations based on your likes and interests",
  DONE: "Done",
  SELECT_AN_INTEREST_TO_STUMBLE: "Select an Interest to Stumble",
  EDIT_INTERESTS: "Edit Interests",
  NETWORK_ERROR_PREVENTS_ACTION: "The selected action could not be completed due to a network error. Please try again.",
  TRANSITION_TITLE: "StumbleUpon moved to Mix on June 30th. Join us today!",
  TRANSITION_DESCRIPTION: "From the makers of StumbleUpon, comes Mix: a new way to discover and save all your favorite things on the web.",
  TRANSITION_FOOTNOTE: "* All content is subject to "
});


},{}],265:[function(require,module,exports){
var _ref;

module.exports = Object.freeze({
  spa: true,
  branch: 'test/redrug',
  hash: '77eb4e0',
  build_date: 'Fri Jul 06 2018 17:13:38 GMT-0800',
  mediator: (_ref = window.Chaplin) != null ? _ref.mediator : void 0
});


},{}],"../templates/activity-center/activity-center":[function(require,module,exports){
module.exports=require('v9Hzkf');
},{}],"v9Hzkf":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "";


  buffer += "<div id=\"activity-center-data\">\n    <div class=\"tabs-container\">\n        <div class=\"conversation active\" data-scope=\"conversation\" data-track=\"notifications:shares-tab\">Shares</div>\n        <div class=\"follow\" data-scope=\"follow\" data-track=\"notifications:activity-tab\">Activity</div>\n    </div>\n    <div class=\"activity-center-list\"></div>\n    <div class=\"loading-ac-items text-center\"><i class=\"fa fa-spin fa-circle-o-notch\"></i></div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"XjqDnL":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;

function program1(depth0,data) {
  
  var stack1;
  return escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.conversationDetails)),stack1 == null || stack1 === false ? stack1 : stack1.title)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1));
  }

function program3(depth0,data) {
  
  var stack1;
  return escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._urlM)),stack1 == null || stack1 === false ? stack1 : stack1.url)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1));
  }

function program5(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "<div class=\"ac-likes\"><span class=\"fa fa-thumbs-up\"></span> "
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._urlM)),stack1 == null || stack1 === false ? stack1 : stack1.likes)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "</div>";
  return buffer;
  }

function program7(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n      <a href=\"/stumbler/"
    + escapeExpression(((stack1 = ((stack1 = ((stack1 = (depth0 && depth0.conversationDetails)),stack1 == null || stack1 === false ? stack1 : stack1.originator)),stack1 == null || stack1 === false ? stack1 : stack1.suUserName)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "\" data-track=\"activity:conversation:clickProfile\" ";
  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.picture_large), {hash:{},inverse:self.program(10, program10, data),fn:self.program(8, program8, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += ">";
  stack1 = helpers.unless.call(depth0, ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.picture_large), {hash:{},inverse:self.noop,fn:self.program(12, program12, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "</a>\n      ";
  return buffer;
  }
function program8(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "class=\"user-thumb\" style=\"background-image:url("
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.picture_large)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + ")\"";
  return buffer;
  }

function program10(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += " class=\"user-color\" style=\"background-color:";
  if (helper = helpers['_user-color']) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0['_user-color']); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"";
  return buffer;
  }

function program12(depth0,data) {
  
  var helper, options;
  return escapeExpression((helper = helpers.firstChar || (depth0 && depth0.firstChar),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0._originatorName), options) : helperMissing.call(depth0, "firstChar", (depth0 && depth0._originatorName), options)));
  }

function program14(depth0,data) {
  
  var buffer = "", stack1, helper, options;
  buffer += "\n       <span class=\"user-color\" style=\"background-color:";
  if (helper = helpers['_user-color']) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0['_user-color']); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">"
    + escapeExpression((helper = helpers.firstChar || (depth0 && depth0.firstChar),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0._originatorName), options) : helperMissing.call(depth0, "firstChar", (depth0 && depth0._originatorName), options)))
    + "</span>\n      ";
  return buffer;
  }

function program16(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n\n          <a href=\"/stumbler/"
    + escapeExpression(((stack1 = ((stack1 = ((stack1 = (depth0 && depth0.conversationDetails)),stack1 == null || stack1 === false ? stack1 : stack1.originator)),stack1 == null || stack1 === false ? stack1 : stack1.suUserName)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "\" data-track=\"activity:conversation:clickProfile\">\n            ";
  if (helper = helpers._originatorName) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._originatorName); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n          </a>\n          ";
  if (helper = helpers._action) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._action); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n\n        ";
  return buffer;
  }

function program18(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n\n         ";
  if (helper = helpers._originatorName) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._originatorName); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + " ";
  if (helper = helpers._action) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._action); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n\n        ";
  return buffer;
  }

function program20(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "<div class=\"message truncate\">";
  if (helper = helpers.message) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.message); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>";
  return buffer;
  }

  buffer += "<div class=\"row\">\n  <div class=\"col-xs-12\">\n    <div class=\"top\">\n      <div class=\"bg-thumb\" style=\"background-image:url("
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._urlM)),stack1 == null || stack1 === false ? stack1 : stack1._thumb)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + ")\"></div>\n      <div class=\" title-block\">\n        <div class=\"title truncate\">";
  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0.conversationDetails)),stack1 == null || stack1 === false ? stack1 : stack1.title), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "</div>\n        ";
  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0._urlM)),stack1 == null || stack1 === false ? stack1 : stack1.likes), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      </div>\n    </div>\n  </div>\n</div>\n<div class=\"row\">\n  <div class=\"col-xs-12\">\n    <div class=\"bottom\">\n      ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._userM), {hash:{},inverse:self.program(14, program14, data),fn:self.program(7, program7, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      <div class=\"content-block\">\n        <div class=\"byline truncate\">\n        ";
  stack1 = helpers['if'].call(depth0, ((stack1 = ((stack1 = (depth0 && depth0.conversationDetails)),stack1 == null || stack1 === false ? stack1 : stack1.originator)),stack1 == null || stack1 === false ? stack1 : stack1.suUserName), {hash:{},inverse:self.program(18, program18, data),fn:self.program(16, program16, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n        </div>\n        ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.message), {hash:{},inverse:self.noop,fn:self.program(20, program20, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n        <div class=\"stats\">\n          <div class=\"timestamp\"><span class=\"fa fa-clock-o\"></span> "
    + escapeExpression((helper = helpers.fromNow || (depth0 && depth0.fromNow),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.occurred), options) : helperMissing.call(depth0, "fromNow", (depth0 && depth0.occurred), options)))
    + "</div>\n          <div class=\"participant-count\"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/activity-center/activity-item-conversation":[function(require,module,exports){
module.exports=require('XjqDnL');
},{}],"kQH+b8":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;

function program1(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n    <a href=\"/stumbler/"
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.username)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "\" data-track=\"activity:follow:clickProfile\" class=\"user-thumb\" style=\"background-image:url("
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.picture_large)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + ")\"></a>\n    ";
  return buffer;
  }

function program3(depth0,data) {
  
  var buffer = "", stack1, helper, options;
  buffer += "\n    <a href=\"/stumbler/"
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.username)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "\" data-track=\"activity:follow:clickProfile\" class=\"user-color\" style=\"background-color:";
  if (helper = helpers['_user-color']) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0['_user-color']); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">"
    + escapeExpression((helper = helpers.firstChar || (depth0 && depth0.firstChar),options={hash:{},data:data},helper ? helper.call(depth0, ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.username), options) : helperMissing.call(depth0, "firstChar", ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.username), options)))
    + "</a>\n    ";
  return buffer;
  }

function program5(depth0,data) {
  
  
  return "\n    ";
  }

function program7(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n    <div class=\"follow-user\" title=\"Follow "
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.username)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "\">\n      <span class=\"fa fa-user-plus\"></span>\n    </div>\n    ";
  return buffer;
  }

  buffer += "<div class=\"row\">\n  <div class=\"col-xs-12\">\n    ";
  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.picture_large), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    <div class=\"content-block\">\n      <div class=\"byline\"><a href=\"/stumbler/"
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.username)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "\" data-track=\"activity:follow:clickProfile\">"
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.username)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "</a> is following you.</div>\n      <div class=\"timestamp\"><span class=\"fa fa-clock-o\"></span> "
    + escapeExpression((helper = helpers.fromNow || (depth0 && depth0.fromNow),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.occurred), options) : helperMissing.call(depth0, "fromNow", (depth0 && depth0.occurred), options)))
    + "</div>\n    </div>\n    ";
  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0._userM)),stack1 == null || stack1 === false ? stack1 : stack1.is_followed), {hash:{},inverse:self.program(7, program7, data),fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/activity-center/activity-item-follow":[function(require,module,exports){
module.exports=require('kQH+b8');
},{}],"62Mg0q":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, self=this;

function program1(depth0,data) {
  
  
  return "\n    <div class=\"fa fa-circle notification\"></div>\n";
  }

function program3(depth0,data) {
  
  
  return "\n    <div class=\"fa fa-circle notification hidden\"></div>\n";
  }

  stack1 = helpers['if'].call(depth0, (depth0 && depth0['new']), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/activity-center/activity-notification":[function(require,module,exports){
module.exports=require('62Mg0q');
},{}],"../templates/activity-center/loading-activities":[function(require,module,exports){
module.exports=require('45cXq2');
},{}],"45cXq2":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"row activities-loading\">\n  <div class=\"col-xs-8 col-xs-offset-2 loading-bell\">\n    <i class=\"fa fa-bell\"></i>\n  </div>\n  <span class=\"col-xs-8 col-xs-offset-2 loading-title\">\n    Your Notifications Live Here\n  </span>\n  <span class=\"col-xs-8 col-xs-offset-2 loading-subtitle\">\n    Make Stumbleupon more fun by sharing pages and following other Stumblers.\n  </span>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/add-to-list":[function(require,module,exports){
module.exports=require('1wKSJJ');
},{}],"1wKSJJ":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;


  buffer += "<div class=\"list-input-row clearfix\">\n    <input type=\"text\" placeholder=\""
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TYPE_TO_SEARCH_CREATE_LIST", options) : helperMissing.call(depth0, "i18n", "TYPE_TO_SEARCH_CREATE_LIST", options)))
    + "\" class=\"dropdown-search col-xs-7 col-sm-8 col-md-9\" autocomplete=\"off\" autofocus>\n    <div class=\"dropdown-create-new btn primary submit col-xs-4 col-sm-3 col-md-2 disabled\" data-track=\"list-create-list\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "CREATE_NEW_LIST", options) : helperMissing.call(depth0, "i18n", "CREATE_NEW_LIST", options)))
    + "</div>\n</div>\n\n<div class=\"dropdown-items-wrap addtolist-items\">\n    \n</div>\n\n<div class=\"spinner\"></div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"qVK48r":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"container-fluid\">\n    <div class=\"row\">\n        <div class=\"su-logo col-xs-6\"></div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-xs-6\">\n            <h1>Keep StumbleUpon at your fingertips.</h1>\n            <h2>Download our free StumbleBar for Chrome</h2>\n        </div>\n    </div>\n    <div class=\"row info-table\">\n        <div class=\"column center col-xs-2\">\n            <div class=\"row\">\n                <div class=\"chrome-logo col-xs-12\"></div>\n            </div>\n            <div class=\"row\">\n                <div class=\"sub-title col-xs-12\">\n                    <strong>StumbleBar</strong> <br> <em>for</em> Google Chrome\n                </div>\n            </div>\n        </div>\n        <div class=\"column right col-xs-4\">\n            <ul class=\"list-bulleted\">\n                <li>The StumbleBar goes with you as you explore. Drag and drop the widget anywhere on the page</li>\n                <li>Like, Share, and create Lists of your favorite stuff</li>\n                <li>Share your discoveries with friends via email or social media</li>\n            </ul>\n            <a class=\"btn btn-primary btn-sublue\" id=\"install-chrome-extension-button\" href=\"https://chrome.google.com/extensions/detail/kcahibnffhnnjcedflmchmokndkjnhpg\" target=\"_blank\">Get the Extension</a>\n        </div>\n        <div class=\"bookmark-info col-xs-3\">\n            <h2>Or, bookmark our Stumble! button</h2>\n            <a class=\"bookmarklet\" href=\"http://www.stumbleupon.com/to/stumble/go/?clientid=73cf54a33e6d6c7733e75f6ec9e7f392&amp;client_type=bookmark&amp;version=1.0\" title=\"StumbleUpon\">\n                <img src=\"http://nb9.stumbleupon.netdna-cdn.com/ccHkx997JfxJPT4YrSIlvg\" alt=\"Stumble!\">\n            </a>\n            <p>\n                Not ready to download the StumbleBar, but want easy access? Drag the button above to your browser so you can still Stumble whenever you please.\n            </p>\n        </div>\n    </div>\n    <div class=\"extra-info row\">\n        <div class=\"col-xs-6\">\n            <p>\n                You can also get the StumbleBar for <a href=\"https://addons.mozilla.org/en-US/firefox/addon/stumblebar-by-stumbleupon\" target=\"_blank\">Mozilla Firefox</a>, as well as StumbleUpon mobile applications for\n                <a href=\"http://www.stumbleupon.com/to/event/redir/?url=https://market.android.com/details?id=com.stumbleupon.android.app&source=suMobile\" target=\"_blank\">Android</a> and\n                <a href=\"http://www.stumbleupon.com/to/event/redir/?url=http://itunes.apple.com/us/app/stumbleupon/id386244833&source=suMobile\" target=\"_blank\">iOS</a>.\n                Visit our <a href=\"/downloads\" target=\"_blank\">Download Page</a> for more info.\n            </p>\n        </div>\n    </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/addon-chrome":[function(require,module,exports){
module.exports=require('qVK48r');
},{}],"../templates/addon-not-chrome":[function(require,module,exports){
module.exports=require('KdOu1R');
},{}],"KdOu1R":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"container-fluid\">\n    <div class=\"row\">\n        <div class=\"su-logo col-xs-6\"></div>\n    </div>\n    <div class=\"row\">\n        <div class=\"col-xs-7\">\n            <h1>Keep StumbleUpon at your fingertips.</h1>\n            <h2>Bookmark the StumbleBar, so something amazing is always just a click away.</h2>\n        </div>\n    </div>\n    <div class=\"row info-table\">\n        <div class=\"bookmark-info col-xs-2\">\n            <a class=\"bookmarklet-small\" href=\"http://www.stumbleupon.com/to/stumble/go/?clientid=73cf54a33e6d6c7733e75f6ec9e7f392&amp;client_type=bookmark&amp;version=1.0\" title=\"StumbleUpon\">\n                <img src=\"http://nb9.stumbleupon.netdna-cdn.com/m5srwEiSx_Zs1bRZwCzqPQ\" alt=\"Stumble!\">\n            </a>\n        </div>\n        <div class=\"col-xs-6\">\n            <h2>\n                Drag the button to the left to your browser so you can make Stumbling easier and Stumble whenever you please.\n            </h2>\n        </div>\n    </div>\n    <div class=\"extra-info row\">\n        <div class=\"col-xs-6\">\n            <p>\n                You can also get the StumbleBar for <a href=\"https://addons.mozilla.org/en-US/firefox/addon/stumblebar-by-stumbleupon\" target=\"_blank\">Mozilla Firefox</a>, and <a href=\"https://chrome.google.com/extensions/detail/kcahibnffhnnjcedflmchmokndkjnhpg\" target=\"_blank\">Google Chrome</a>, as well as StumbleUpon mobile applications for\n                <a href=\"http://www.stumbleupon.com/to/event/redir/?url=https://market.android.com/details?id=com.stumbleupon.android.app&source=suMobile\" target=\"_blank\">Android</a> and\n                <a href=\"http://www.stumbleupon.com/to/event/redir/?url=http://itunes.apple.com/us/app/stumbleupon/id386244833&source=suMobile\" target=\"_blank\">iOS</a>.\n                Visit our <a href=\"/downloads\" target=\"_blank\">Download Page</a> for more info.\n            </p>\n        </div>\n    </div>\n</div>";
  });

},{"hbsfy/runtime":795}],"huS0dS":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, self=this, helperMissing=helpers.helperMissing, functionType="function", escapeExpression=this.escapeExpression;

function program1(depth0,data) {
  
  
  return "\n      <span class=\"alert-symbol fa fa-check\"></span>\n   ";
  }

function program3(depth0,data) {
  
  
  return "\n      <span class=\"alert-symbol fa fa-times\"></span>\n  ";
  }

  buffer += "<div class=\"alert-wrapper text-center\">\n  ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.type), "success", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.type), "success", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  <span class=\"alert-text\">";
  if (helper = helpers.text) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.text); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</span>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/alert":[function(require,module,exports){
module.exports=require('huS0dS');
},{}],"Pg+1ZR":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<h1>Oops! There was a problem</h1>\n<div>\n  ";
  if (helper = helpers.message) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.message); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + " (code ";
  if (helper = helpers.code) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.code); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + ", context: ";
  if (helper = helpers.struct) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.struct); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + ")\n</div>\n<div>\nPlease report this to <a data-link-id=\"report-link\" href=\"";
  if (helper = helpers._mailtohref) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._mailtohref); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">";
  if (helper = helpers.email) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.email); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</a>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/api-error":[function(require,module,exports){
module.exports=require('Pg+1ZR');
},{}],"../templates/app":[function(require,module,exports){
module.exports=require('fo3zxY');
},{}],"fo3zxY":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div id=\"toolbar-container\"></div>\n<div id=\"panel-container\"></div>\n<div id=\"panel-right-container\"></div>\n<div id=\"content-container\"></div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/beta-opt-in":[function(require,module,exports){
module.exports=require('U9Rbn5');
},{}],"U9Rbn5":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"beta-opt-in\">\n    <div class=\"box\" id=\"beta-opt-in-box\">\n        <div class=\"fa fa-stumbleupon-circle\"></div>\n        <h1>Congrats! You've been selected to preview our Improved Site Design.</h1>\n        <h2>You can always opt-out at any time from your settings.</h2>\n\n        <ul>\n            <li>Modern Design</li>\n            <li>Better Navigation</li>\n            <li>Simplified Sharing and Profile</li>\n        </ul>\n\n        <div class=\"opt-in\" data-track=\"collections-modal:opt-in\">\n            OK!\n        </div>\n\n        <div class=\"opt-out\" data-track=\"collections-modal:opt-out\">\n            No Thanks\n        </div>\n    </div>\n</div>";
  });

},{"hbsfy/runtime":795}],"JK9IfS":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n    <div class=\"view-profile\" data-id=\"view-profile\" data-track=\"view-profile\">\n      <a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">View Profile</a>\n    </div>\n    ";
  return buffer;
  }

function program3(depth0,data) {
  
  
  return "\n    <div class=\"block-btn\" data-id=\"block-mobile\" data-track=\"block-mobile\">Block This User</div>\n    ";
  }

  buffer += "<div class=\"col-xs-12 block-box\">\n  <div class=\"mobile-block\">\n    <div class=\"user-to-block\" data-id=\"user-to-block\" data-track=\"user-to-block\">";
  if (helper = helpers._name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n    ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.username), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data},helper ? helper.call(depth0, (depth0 && depth0._isSelf), false, options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0._isSelf), false, options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    <div class=\"close-block\" data-id=\"close-block\" data-track=\"close-block\">Close</div>\n  </div>\n  <div class=\"confirm-block\">\n    <div class=\"col-xs-12 block-msg\">\n      Blocking <span data-id=\"user-to-block\" data-track=\"user-to-block\">";
  if (helper = helpers._name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</span> will hide all replies and invites from the user.\n    </div>\n    <div class=\"cancel-block-btn col-xs-6\" data-id=\"close-block\" data-track=\"close-block\">Cancel</div>\n    <div class=\"confirm-block-btn col-xs-6\" data-id=\"confirm-block-mobile\" data-track=\"confirm-block-mobile\">Block</div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/conversations/block":[function(require,module,exports){
module.exports=require('JK9IfS');
},{}],"LKkC8l":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  
  return "disabled";
  }

function program3(depth0,data) {
  
  
  return "enable";
  }

function program5(depth0,data) {
  
  var buffer = "";
  buffer += "\n      <div class=\"contact-thumbnail\">\n        \n      </div>\n    ";
  return buffer;
  }

function program7(depth0,data) {
  
  
  return "\n      <span class=\"fa fa-envelope\"></span>\n    ";
  }

function program9(depth0,data) {
  
  
  return "su-user";
  }

function program11(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += " data-suid=\"";
  if (helper = helpers.suUid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.suUid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1);
  return buffer;
  }

function program13(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "<div class=\"username\">";
  if (helper = helpers.suUserName) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.suUserName); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>";
  return buffer;
  }

function program15(depth0,data) {
  
  
  return "\n  <div class=\"chk-container\">\n    <div class=\"chk-circle text-center\">\n      <span class=\"fa fa-comment\"></span>\n    </div>\n  </div>\n  ";
  }

function program17(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n  <div class=\"chk-container\">\n    <div class=\"chk-circle text-center ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._queued), {hash:{},inverse:self.noop,fn:self.program(18, program18, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n      <span class=\"fa fa-check\"></span>\n    </div>\n  </div>\n  ";
  return buffer;
  }
function program18(depth0,data) {
  
  
  return "active";
  }

  buffer += "<div class=\"col-xs-12 ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._isParticipant), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\" data-track=\"share-stumbler\">\n  <div class=\"icn-source\">\n    ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.suUserName), {hash:{},inverse:self.program(7, program7, data),fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  </div>\n  <div class=\"identity\">\n    <div class=\"name ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.suUserName), {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\"";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.suUid), {hash:{},inverse:self.noop,fn:self.program(11, program11, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">";
  if (helper = helpers._name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n    ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.suUserName), {hash:{},inverse:self.noop,fn:self.program(13, program13, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  </div>\n  ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._isParticipant), {hash:{},inverse:self.program(17, program17, data),fn:self.program(15, program15, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/conversations/contact":[function(require,module,exports){
module.exports=require('LKkC8l');
},{}],"wS2lun":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "";


  buffer += "<div class=\"row convo-banner\">\n</div>\n<div class=\"row input-top\">\n  <div class=\"col-xs-2 text-center pointer conversation-back\" data-id=\"conversation-back\" data-track=\"conversation-back\">\n    <span class=\"fa fa-chevron-left\" data-id=\"conversation-back-inner\"></span>\n  </div>\n  <div class=\"col-xs-2 text-center pointer conversation-close\" data-touchclick=\"true\" data-id=\"conversation-close\" data-track=\"conversation-close\">\n    <span class=\"fa fa-close collapse-panel\"></span>\n  </div>\n  <div class=\"col-xs-2 text-center pointer conversation-open\" data-touchclick=\"true\" data-id=\"conversation-open\">\n    <span class=\"fa fa-sort-asc collapse-panel\"></span>\n  </div>\n  <div class=\"col-xs-8\">\n    <div class=\"participant-list pointer\" data-id=\"participant-list\" data-track=\"participant-list\"></div>\n  </div>\n  <div class=\"col-xs-2 more-invite\" data-touchclick=\"true\" data-id=\"more-invite\" data-track=\"more-invite\">\n    \n    <div class=\"text-center pointer\">\n      <i class=\"fa fa-user-plus\"></i>\n    </div>\n  </div>\n</div>\n<div class=\"row main-container\">\n  <div class=\"mobile-participants\"></div>\n</div>\n<div class=\"row event-list\"></div>\n<div class=\"row convo-input-bottom\" >\n  <textarea class=\"col-xs-9 text-input convo-message\" type='text' data-id='convo-message' data-track='convo-message' id='convo-message' placeholder='Reply...'></textarea>\n  <div class=\"col-xs-3 panel-action disabled text-center\" data-id=\"message-send\" data-track=\"message-send\" data-touchclick=\"true\">Send</div>\n</div>\n <div class=\"row more-list\">\n  <div class=\"contact-item\" data-id=\"more-invite\" data-track=\"more-invite\">Invite a Person to this Conversation</div>\n  \n</div>\n<div class=\"invites-container\"></div>\n<div class=\"block-container\"></div>\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/conversations/conversation":[function(require,module,exports){
module.exports=require('wS2lun');
},{}],"GDieB0":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, self=this, functionType="function", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  
  return " self";
  }

function program3(depth0,data) {
  
  
  return " col-xs-offset-1";
  }

  buffer += "<div class=\"row";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._createdBySelf), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += " message-row\">\n  <div class=\"col-xs-11";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._createdBySelf), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n    <div class=\"user-thumbnail\">\n      \n    </div>\n    <div class=\"message\">\n      <div class=\"message-author\">"
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._createdByParticipantM)),stack1 == null || stack1 === false ? stack1 : stack1._name)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + " "
    + escapeExpression((helper = helpers.fromNow || (depth0 && depth0.fromNow),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.createdAt), options) : helperMissing.call(depth0, "fromNow", (depth0 && depth0.createdAt), options)))
    + "</div>\n      <div class=\"message-text\">";
  if (helper = helpers.text) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.text); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1);
  if (helper = helpers.message) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.message); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div> \n    </div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/conversations/event-comment":[function(require,module,exports){
module.exports=require('GDieB0');
},{}],"../templates/conversations/event-create":[function(require,module,exports){
module.exports=require('gSF+Uz');
},{}],"gSF+Uz":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n        ";
  if (helper = helpers._name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1);
  stack1 = helpers.unless.call(depth0, (data == null || data === false ? data : data.last), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      ";
  return buffer;
  }
function program2(depth0,data) {
  
  
  return ", ";
  }

function program4(depth0,data) {
  
  
  return " self";
  }

function program6(depth0,data) {
  
  
  return " col-xs-offset-1";
  }

  buffer += "<div class=\"row\">\n  <div class=\"col-xs-10 col-xs-offset-1\">\n    <div class=\"invite text-center event-create\">\n      "
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._createdByParticipantM)),stack1 == null || stack1 === false ? stack1 : stack1._name)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + " invited\n\n      ";
  stack1 = helpers.each.call(depth0, (depth0 && depth0._invitedParticipants), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    </div>\n  </div>\n</div>\n<div class=\"row";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._createdBySelf), {hash:{},inverse:self.noop,fn:self.program(4, program4, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n  <div class=\"col-xs-11";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._createdBySelf), {hash:{},inverse:self.noop,fn:self.program(6, program6, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n    <div class=\"user-thumbnail\">\n      \n    </div>\n    <div class=\"message\">\n      <div class=\"message-author\">"
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._createdByParticipantM)),stack1 == null || stack1 === false ? stack1 : stack1._name)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + " "
    + escapeExpression((helper = helpers.fromNow || (depth0 && depth0.fromNow),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.createdAt), options) : helperMissing.call(depth0, "fromNow", (depth0 && depth0.createdAt), options)))
    + "</div>\n      <div class=\"message-text\">";
  if (helper = helpers.text) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.text); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1);
  if (helper = helpers.message) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.message); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div> \n    </div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"XRA0Mh":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n        ";
  if (helper = helpers._name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1);
  stack1 = helpers.unless.call(depth0, (data == null || data === false ? data : data.last), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      ";
  return buffer;
  }
function program2(depth0,data) {
  
  
  return ", ";
  }

  buffer += "<div class=\"row\">\n  <div class=\"col-xs-10 col-xs-offset-1\">\n    <div class=\"invite text-center\">\n      "
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0._createdByParticipantM)),stack1 == null || stack1 === false ? stack1 : stack1._name)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + " invited\n\n      ";
  stack1 = helpers.each.call(depth0, (depth0 && depth0._invitedParticipants), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    </div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/conversations/event-invite":[function(require,module,exports){
module.exports=require('XRA0Mh');
},{}],"../templates/conversations/invite-mobile":[function(require,module,exports){
module.exports=require('wGBM6u');
},{}],"wGBM6u":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"row input-top no-expand-ms\">\n  <div class=\"col-xs-1 text-right\">\n      <div class=\"input-row-label\">To:</div>\n  </div>\n  <div class=\"col-xs-10 col-ms-9 col-sm-10 no-gutter-left\">\n    <div id=\"invite-to-mobile\" class=\"text-input invite-to\" data-id='invite-to-mobile' data-track='invite-to-mobile'></div>\n  </div>\n</div>\n<div class=\"row invite-list-row no-expand-ms\">\n  <div class=\"invite-list\"></div>\n  <div class=\"input-bottom\">\n    <div class=\"col-xs-6 panel-action disabled text-center invitecancel\" data-id=\"invite-mobile-cancel\" data-track=\"invite-mobile-cancel\">Cancel</div>\n    <div class=\"col-xs-6 panel-action disabled text-center invitesend\" data-id=\"invite-mobile-send\" data-track=\"invite-mobile-send\">Send</div>\n  </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"eWqpRj":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "";


  buffer += "\n<div class=\"row input-top no-expand-ms hidden\">\n  <div class=\"col-xs-1 text-right\">\n      <div class=\"input-row-label\">To:</div>\n  </div>\n  <div class=\"col-xs-10 col-ms-9 col-sm-10 no-gutter-left\">\n    <div id=\"invite-to\" class=\"text-input invite-to\" data-id='invite-to-desktop' data-track='invite-to-desktop'></div>\n  </div>\n</div>\n\n<div class=\"row no-expand-ms invites-outer-container\">\n  <div class=\"invite-list\">\n    <div class=\"loading-container\"></div>\n    <div class=\"social-container\"></div>\n    <div class=\"invites-container\"></div>\n  </div>\n  <div class=\"invite-btns-container\">\n    <div class=\"btn btn30 btn-nobutton cancel-invite col-ms-6\" data-id=\"convo-cancel-invite\" data-track=\"convo-cancel-invite\">Cancel</div>\n    <div class=\"btn btn30 btn-primary disabled send-invite col-ms-6\" data-id=\"convo-send-invite\" data-track=\"convo-send-invite\">Invite</div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/conversations/invite":[function(require,module,exports){
module.exports=require('eWqpRj');
},{}],"../templates/conversations/loading-invites":[function(require,module,exports){
module.exports=require('jni7cJ');
},{}],"jni7cJ":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;


  buffer += "<div class=\"empty-invites\">\n  <div class=\"arrow-container\">\n    <i class=\"fa fa-arrow-up\"></i>\n  </div>\n  <div>"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "SEND_TO_EMAIL_ADDRESS", options) : helperMissing.call(depth0, "i18n", "SEND_TO_EMAIL_ADDRESS", options)))
    + "</div>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/conversations/mobile-participant":[function(require,module,exports){
module.exports=require('AeJ6AV');
},{}],"AeJ6AV":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"participant-display\">\n  <div class=\"col-xs-12\">\n    <div class=\"user-thumbnail\">\n      \n    </div>\n    <div class=\"name\">";
  if (helper = helpers._name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"aqcPfP":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, self=this, functionType="function";

function program1(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n      <span>\n          ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._name), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      </span>\n      ";
  return buffer;
  }
function program2(depth0,data) {
  
  var buffer = "", helper, options;
  buffer += "\n            "
    + escapeExpression((helper = helpers.firstChar || (depth0 && depth0.firstChar),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0._name), options) : helperMissing.call(depth0, "firstChar", (depth0 && depth0._name), options)))
    + "\n          ";
  return buffer;
  }

  buffer += "<div class=\"event-user\" style=\"background-color: ";
  if (helper = helpers['_user-color']) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0['_user-color']); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "; background-image:url('";
  if (helper = helpers._thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "');\">\n      ";
  stack1 = helpers.unless.call(depth0, (depth0 && depth0._thumbnail), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/conversations/participant-thumbnail":[function(require,module,exports){
module.exports=require('aqcPfP');
},{}],"chmTLy":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n    <a href=\"/stumbler/";
  if (helper = helpers.suUserName) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.suUserName); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" title=\"View ";
  if (helper = helpers.suUserName) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.suUserName); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "'s profile\">\n    ";
  return buffer;
  }

function program3(depth0,data) {
  
  
  return "\n    </a>\n    ";
  }

function program5(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n    <div class=\"follow-user\" title=\"Follow ";
  if (helper = helpers._name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n      <span class=\"fa fa-user-plus\"></span>\n    </div>\n    ";
  return buffer;
  }

  buffer += "<div class=\"participant-display\">\n  <div class=\"col-xs-12\">\n    ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.suUserName), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      <div class=\"user-thumbnail\">\n        \n      </div>\n      <div class=\"name\">";
  if (helper = helpers._name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n    ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.suUserName), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._notFollowed), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/conversations/participant":[function(require,module,exports){
module.exports=require('chmTLy');
},{}],"ELjGRo":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"participant-items\">\n  <div class=\"participants-loading-indicator\"></div>\n</div>\n<div class=\"btn btn-primary btn-block btn-30h invite-more\" data-id=\"invite-more\" data-track=\"invite-more\">Invite More</div>\n\n";
  });

},{"hbsfy/runtime":795}],"../templates/conversations/participants":[function(require,module,exports){
module.exports=require('ELjGRo');
},{}],"../templates/convo-app-banner":[function(require,module,exports){
module.exports=require('Y9MR1R');
},{}],"Y9MR1R":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"convo-app-banner\">\n  <div class=\"col-xs-8 col-ms-9\">\n    <p class=\"download-header\"> Use the StumbleUpon App! </p>\n    <p class=\"download-subheader\"> It's faster and even more fun. </p>\n    <p class=\"tablet-header\"> Use the StumbleUpon App! It's faster and even more fun. </p>\n  </div>\n  <div class=\"col-xs-4 col-ms-3\">\n    <div class=\"btn btn-default\"><a class=\"download-url\">OPEN</a></div>\n  </div>\n</div>\n\n";
  });

},{"hbsfy/runtime":795}],"../templates/create-list-item-entry":[function(require,module,exports){
module.exports=require('yF4o8J');
},{}],"yF4o8J":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<span class=\"list-item-text\" data-track=\"list-create-list-search\">Create List \"<span class=\"create-list-item-entry-name\"></span>\"</span>";
  });

},{"hbsfy/runtime":795}],"gyUW2M":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType="function";


  buffer += "<div id=\"createlist\" class=\"createlist-container container\">\n  <div class=\"modal-view\">\n    <div class=\"modal-wrap\">\n      <div class=\"title\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "CREATE_LIST", options) : helperMissing.call(depth0, "i18n", "CREATE_LIST", options)))
    + "</div>\n      <div class=\"modal-body\">\n        <form class=\"form-modal\" onsubmit=\"return false\">\n          <div class=\"wrapper-input\">\n            <label for=\"list-edit-name\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "NAME", options) : helperMissing.call(depth0, "i18n", "NAME", options)))
    + "</label>\n            <input type=\"text\" value=\"";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" id=\"list-edit-name\" maxlength=\"70\">\n          </div>\n          <div class=\"wrapper-input\">\n            <label for=\"list-edit-description\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "DESCRIPTION", options) : helperMissing.call(depth0, "i18n", "DESCRIPTION", options)))
    + "</label>\n            <textarea id=\"list-edit-description\">";
  if (helper = helpers.description) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.description); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</textarea>\n          </div>\n\n          <div class=\"wrapper-input input-visibility\">\n            <label for=\"list-edit-visibility\" class=\"input-visibility-header\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "VISIBILITY", options) : helperMissing.call(depth0, "i18n", "VISIBILITY", options)))
    + "</label>\n            <label for=\"list-edit-public\" class=\"label-inline\">\n              <input type=\"radio\" name=\"visibility\" id=\"list-edit-public\" value=\"public\" checked>\n                Public\n            </label>\n            <label for=\"list-edit-private\" class=\"label-inline\">\n                <input type=\"radio\" name=\"visibility\" id=\"list-edit-private\" value=\"private\">\n                Private\n            </label>\n          </div>\n\n          <div class=\"modal-actions\">\n            <button class=\"btn close-overlay-btn\" id=\"list-cancel\" data-id=\"list-cancel\" data-track=\"list-cancel\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "CANCEL", options) : helperMissing.call(depth0, "i18n", "CANCEL", options)))
    + "</button>\n            <button class=\"btn primary submit\" id=\"list-save\" data-id=\"list-create\" data-track=\"list-create\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "CREATE", options) : helperMissing.call(depth0, "i18n", "CREATE", options)))
    + "</button>\n          </div>\n        </form>\n      </div>\n      <div class=\"spinner hidden\"></div>\n    </div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/create-list":[function(require,module,exports){
module.exports=require('gyUW2M');
},{}],"jLYzvb":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div><div class=\"spinner-bar-spinner\"></div></div>";
  });

},{"hbsfy/runtime":795}],"../templates/decorators/wait-spinner":[function(require,module,exports){
module.exports=require('jLYzvb');
},{}],"q0Wl2K":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, blockHelperMissing=helpers.blockHelperMissing;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper, options;
  buffer += "\n    <a class=\"dropdown-item\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/interests\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:interests\">\n        <span class=\"menu-text\">Interests</span>\n    </a>\n    <a class=\"dropdown-item\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/additions\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:additions\">\n        <span class=\"menu-text\">Additions</span>\n    </a>\n    ";
  options={hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data}
  if (helper = helpers.viewingOwnProfile) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.viewingOwnProfile); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.viewingOwnProfile) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    <a class=\"dropdown-item\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/tagcloud\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:tagcloud\">\n        <span class=\"menu-text\">Tags</span>\n    </a>\n";
  return buffer;
  }
function program2(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n        <a class=\"dropdown-item\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/history\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:history\">\n            <span class=\"menu-text\">History</span>\n        </a>\n    ";
  return buffer;
  }

  buffer += "<a class=\"dropdown-item\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/likes\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:likes\">\n    <span class=\"menu-text\">Likes</span>\n</a>\n<a class=\"dropdown-item\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/photos\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:photos\">\n    <span class=\"menu-text\">Photos</span>\n</a>\n<a class=\"dropdown-item\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/videos\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:videos\">\n    <span class=\"menu-text\">Videos</span>\n</a>\n<a class=\"dropdown-item\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/lists\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists\">\n    <span class=\"menu-text\">Lists</span>\n</a>\n<a class=\"dropdown-item\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/lists/following\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:followed-lists\">\n    <span class=\"menu-text\">Followed Lists</span>\n</a>\n";
  options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data}
  if (helper = helpers.isLoggedIn) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.isLoggedIn); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.isLoggedIn) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/dropdown-list":[function(require,module,exports){
module.exports=require('q0Wl2K');
},{}],"6YMx7Y":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "(";
  if (helper = helpers['new']) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0['new']); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + ")";
  return buffer;
  }

  buffer += "<div class=\"dropdown-item profile\" data-track=\"menu-profile\">\n    <span class=\"menu-text\">My Profile</span>\n</div>\n<div class=\"notifications dropdown-item\" data-id=\"menu-notifications\" data-track=\"menu-notifications\">\n   <span class=\"menu-text\" data-id=\"menu-notifications\">Notifications ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0['new']), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "</span>\n</div>\n<a class=\"dropdown-item\" href=\"/discover/interests\" data-track=\"menu-addinterests\">\n    <span class=\"menu-text\">Edit Interests</span>\n</a>\n<a class=\"dropdown-item\" href=\"/settings/profile\" data-track=\"menu-settings\">\n    <span class=\"menu-text\">Settings</span>\n</a>\n<a class=\"dropdown-item\" href=\"http://help.stumbleupon.com\" data-track=\"menu-help\">\n    <span class=\"menu-text\">Help</span>\n</a>\n<a class=\"dropdown-item\" href=\"/logout\" data-track=\"menu-signout\">\n    <span class=\"menu-text\">Sign Out</span>\n</a>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/dropdown-menu":[function(require,module,exports){
module.exports=require('6YMx7Y');
},{}],"x+VomS":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"share-facebook dropdown-item\" data-track=\"menu:share:facebook\">\n    <span class=\"fa fa-facebook-square menu-icon\"></span>\n    <span class=\"menu-text\">Facebook</span>\n</div>\n<div class=\"share-twitter dropdown-item\" data-track=\"menu:share:twitter\">\n    <span class=\"fa fa-twitter menu-icon\"></span>\n    <span class=\"menu-text\">Twitter</span>\n</div>\n<div class=\"share-mix dropdown-item\" data-track=\"menu:share:mix\">\n    <span class=\"fa svg-mix menu-icon\"></span>\n    <span class=\"menu-text\">Mix</span>\n</div>\n<div class=\"share-email dropdown-item\" data-track=\"menu:share:email\">\n    <span class=\"fa fa-envelope menu-icon\"></span>\n    <span class=\"menu-text\">Email</span>\n</div>\n<div class=\"share-stumbleupon dropdown-item\" data-track=\"menu:share:stumbleupon\">\n    <span class=\"fa fa-stumbleupon-circle menu-icon\"></span>\n    <span class=\"menu-text\">Send to...</span>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/dropdown-share":[function(require,module,exports){
module.exports=require('x+VomS');
},{}],"../templates/dropdown-thumbdown":[function(require,module,exports){
module.exports=require('EJ14Jg');
},{}],"EJ14Jg":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<a class=\"dropdown-item withSubtype\" data-subtype=\"-2\" data-track=\"thumbdown-notforme\">\n    <span class=\"menu-text\">Not For Me</span>\n</a>\n<a class=\"dropdown-item withSubtype\" data-subtype=\"-3\" data-track=\"thumbdown-seen\">\n    <span class=\"menu-text\">Already Seen Page</span>\n</a>\n<a class=\"dropdown-item withSubtype\" data-subtype=\"-6\" data-track=\"thumbdown-doesntload\">\n    <span class=\"menu-text\">Page Doesn't Load</span>\n</a>\n<a class=\"dropdown-item withSubtype\" data-subtype=\"-5\" data-track=\"thumbdown-spam\">\n    <span class=\"menu-text\">Report: Spam</span>\n</a>\n<a class=\"dropdown-item wrong-topic\" data-track=\"thumbdown-wrongtopic\">\n    <span class=\"menu-text\">Report: Wrong Topic</span>\n</a>\n<a class=\"dropdown-item\" data-blockdomain=\"1\" data-track=\"thumbdown-block\">\n    <span class=\"menu-text\">Block Site</span>\n</a>\n\n";
  });

},{"hbsfy/runtime":795}],"../templates/email-share":[function(require,module,exports){
module.exports=require('cxTEmX');
},{}],"cxTEmX":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"container-fluid\">\n    <div class=\"row\">\n        <div class=\"h1\">Share via email</div>\n        <form class=\"share-email-form form-horizontal\" onsubmit=\"return false\">\n            <div class=\"form-group share-email-group\">\n                <label for=\"email-list\" class=\"sr-only\">Email addresses to send to</label>\n                <div class=\"email-col\">\n                    <input class=\"form-control email-list\" type=\"text\" name=\"email-list\" placeholder=\"Email addresses to send to\" autofocus=\"autofocus\"/>\n                    <span class=\"form-control-feedback\" id=\"share-email-feedback\"></span>\n                </div>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"email-text\" class=\"sr-only\">Message text</label>\n                <div class=\"msg-col\">\n                    <textarea class=\"form-control email-text\" name=\"email-text\" placeholder=\"Message text\" ></textarea>\n                </div>\n            </div>\n            <div class=\"form-group\">\n                <div class=\"msg-col\">\n                    <button type=\"button\" class=\"send btn btn-primary email-send pull-right\" data-track=\"share:email:send\">Send&nbsp;<i class=\"fa fa-spinner fa-spin signup-spin hidden\"></i></button>\n                    <div class=\"btn btn-sulight pull-right\" data-id=\"email-send-cancel\" data-track=\"share:email:cancel\">Cancel</div>\n                </div>\n            </div>\n        </form>\n    </div>\n</div>\n\n";
  });

},{"hbsfy/runtime":795}],"../templates/email-verify":[function(require,module,exports){
module.exports=require('nbBTjM');
},{}],"nbBTjM":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"container-fluid\">\n    <div class=\"row topbar\">\n        <div class=\"su-logo\"></div>\n    </div>\n\n    <div id=\"verify-success\" class=\"hidden\">\n      <div class=\"title\">Thanks!</div>\n      <div class=\"sub-title\"><span class=\"email-display\"></span>: Your email is now verified.</div>\n    </div>\n\n    <div id=\"verify-failure\" class=\"hidden\">\n      <div class=\"title\">Uh oh!</div>\n      <div class=\"sub-title\"><span class=\"email-display\"></span>: Something went wrong.<br>Try clicking or copying the link once more to verify.<br>If the problem persists, <a href=\"http://www.stumbleupon.com/feedback\">click here to contact StumbleUpon Support</a>.</div>\n    </div>\n\n    <div id=\"verify-error\" class=\"hidden\">\n        <div class=\"title\">Uh oh!</div>\n        <div class=\"sub-title\">Something went wrong. Please try again at a later time.<br>If the problem persists, <a href=\"http://www.stumbleupon.com/feedback\">click here to contact StumbleUpon Support</a>.</div>\n    </div>\n\n    <div class=\"footer\">\n        <div><span class=\"fa fa-stumbleupon\"></span>  <span id=\"currentYear\"></span> StumbleUpon - All rights reserved</div>\n        <div>\n            <a href=\"/terms\" target=\"_blank\" data-track=\"email-verify:terms\">Terms of Use</a>\n        </div>\n        <div>\n            <a href=\"/privacy\" target=\"_blank\" data-track=\"email-verify:privacy-policy\">Privacy Policy</a>\n        </div>\n    </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/errors/app-start":[function(require,module,exports){
module.exports=require('9Wl2XC');
},{}],"9Wl2XC":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"hand\"></div>\n<div class=\"right-container text-left\">\n    <div class=\"title\">Page Loading Error</div>\n    <div class=\"subtitle\">We were unable to load this page. This may be due to a temporary outage.</div>\n    <div class=\"dash\"></div>\n    <button class=\"btn btn-suorange error-page-retry\" data-touchclick=\"true\" data-track=\"app-start:retry\">\n        Retry\n    </button>\n    <a class=\"btn btn-sublue error-page-contact\" href=\"http://help.stumbleupon.com/customer/portal/emails/new\" target=\"_blank\" data-touchclick=\"true\" data-track=\"app-start:contact-us\">\n        Contact Us\n    </a>\n</div>\n\n";
  });

},{"hbsfy/runtime":795}],"../templates/errors/badge-submit":[function(require,module,exports){
module.exports=require('3mMLj9');
},{}],"3mMLj9":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"hand\"></div>\n<div class=\"right-container text-left\">\n    <div class=\"title\">Add a Page Error</div>\n    <div class=\"subtitle\">We were unable to process this addition. This may be due to a temporary outage.</div>\n    <div class=\"dash\"></div>\n    <button class=\"btn btn-suorange error-page-retry\" data-touchclick=\"true\" data-track=\"badge-submit:retry\">\n        Retry\n    </button>\n</div>\n\n";
  });

},{"hbsfy/runtime":795}],"../templates/errors/forbidden":[function(require,module,exports){
module.exports=require('R0qHUj');
},{}],"R0qHUj":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"hand\"></div>\n<div class=\"right-container text-left\">\n    <div class=\"title\">Not Available</div>\n    <div class=\"subtitle\">The information you requested is not available.  This may be due to your profile and/or privacy settings.</div>\n    <div class=\"dash\"></div>\n    <button class=\"btn btn-suorange error-page-stumble\" data-touchclick=\"true\" data-track=\"error-forbidden:stumble\">\n        Stumble\n    </button>\n</div>\n\n";
  });

},{"hbsfy/runtime":795}],"../templates/errors/impossible-url":[function(require,module,exports){
module.exports=require('+XkjfT');
},{}],"+XkjfT":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"hand\"></div>\n<div class=\"right-container text-left\">\n    <div class=\"title\">Page Not Found</div>\n    <div class=\"subtitle\">Cannot make a stumble with this url.</div>\n    <div class=\"dash\"></div>\n    <button class=\"btn btn-suorange error-page-stumble\" data-touchclick=\"true\" data-track=\"not-found:stumble\">\n        Stumble\n    </button>\n</div>\n\n";
  });

},{"hbsfy/runtime":795}],"../templates/errors/internal-server":[function(require,module,exports){
module.exports=require('4V7FHU');
},{}],"4V7FHU":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"hand\"></div>\n<div class=\"right-container text-left\">\n    <div class=\"title\">Uh Oh</div>\n    <div class=\"subtitle\">We're experiencing some technical difficulties. We're working to fix it and everything will be back to normal soon.</div>\n    <div class=\"dash\"></div>\n    <button class=\"btn btn-suorange error-page-stumble\" data-touchclick=\"true\" data-track=\"internal-server:stumble\">\n        Stumble\n    </button>\n</div>\n\n";
  });

},{"hbsfy/runtime":795}],"OdnYj5":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"hand\"></div>\n<div class=\"right-container text-left\">\n    <div class=\"title\">Page Not Found</div>\n    <div class=\"subtitle\">Sorry, but we seem to have misplaced this page.</div>\n    <div class=\"dash\"></div>\n    <button class=\"btn btn-suorange error-page-stumble\" data-touchclick=\"true\" data-track=\"not-found:stumble\">\n        Stumble\n    </button>\n</div>\n\n";
  });

},{"hbsfy/runtime":795}],"../templates/errors/not-found":[function(require,module,exports){
module.exports=require('OdnYj5');
},{}],"Msiax0":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, self=this;

function program1(depth0,data) {
  
  
  return "\n    <button class=\"follow is-followed btn btn-sulight\" data-id=\"unfollow\">\n      <span class=\"follow-status following\">Following</span>\n      <span class=\"follow-status unfollow\">Unfollow</span>\n    </button>\n  ";
  }

function program3(depth0,data) {
  
  
  return "\n    <button title=\"Follow\" class=\"follow btn btn-sublue\" data-id=\"follow\">\n      <span class=\"follow-status\">Follow</span>\n    </button>\n  ";
  }

  buffer += "<div class=\"follow-btn\">\n  ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.is_followed), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/follow-button":[function(require,module,exports){
module.exports=require('Msiax0');
},{}],"HAzkOi":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, self=this;

function program1(depth0,data) {
  
  
  return "\n    <button class=\"follow is-followed btn btn-sulight\" data-id=\"unfollow\">\n      <span class=\"follow-status following\">Following</span>\n      <span class=\"follow-status unfollow\">Unfollow</span>\n    </button>\n  ";
  }

function program3(depth0,data) {
  
  
  return "\n    <button title=\"Follow\" class=\"follow btn btn-sublue\" data-id=\"follow\">\n      <span class=\"follow-status\">Follow</span>\n    </button>\n  ";
  }

  buffer += "<div class=\"follow-btn\">\n  ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.isFollowing), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/follow-list-button":[function(require,module,exports){
module.exports=require('HAzkOi');
},{}],"8uvyxu":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "";


  buffer += "<div class=\"following-runout-inner\">\n    <div id=\"following-runout-header-container\">\n        <div class=\"following-runout-header-view\">\n            <div class=\"following-title\">Follow some Top Stumblers to discover their Likes</div>\n        </div>\n    </div>\n    <div id=\"stumblers-container\"></div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/following-runout":[function(require,module,exports){
module.exports=require('8uvyxu');
},{}],"../templates/general-error":[function(require,module,exports){
module.exports=require('v//HrN');
},{}],"v//HrN":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<h1>Oops! An error occurred with SPA</h1>\n<div>\n  You can disable the New Webtoolbar from <a class=\"noscript\" href=\"/settings/labs?_notoolbar=true\" target=\"_top\">/settings/labs</a>.\n</div>\n<div>\nPlease report this to <a href=\"mailto:";
  if (helper = helpers.email) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.email); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">";
  if (helper = helpers.email) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.email); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</a>\n</div>\n<textarea>";
  if (helper = helpers.diagnostic) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.diagnostic); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</textarea>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"EFUzNh":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"stopscroll\"></div>\n<div class=\"swipe right\"></div>\n<div class=\"swipe-indicator\">\n  <span>Swipe to Stumble</span>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/glass":[function(require,module,exports){
module.exports=require('EFUzNh');
},{}],"../templates/homepage-age":[function(require,module,exports){
module.exports=require('1MVWwf');
},{}],"1MVWwf":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"homepage-age-container\">\n    <div class=\"dialog-title\">Please Enter your Age</div>\n    <form class=\"main-form form-horizontal\" onsubmit=\"return false\">\n        <div class=\"form-inline age-group\">\n            <label for=\"age\" class=\"sr-only\">Age</label>\n            <select class=\"signup-date form-control age\" id=\"age\" type=\"age\" name=\"age\">\n                <option disabled selected>Age</option>\n            </select>\n        </div>\n        <div class=\"dialog-footer\">\n            <div class=\"btn btn-primary btn-sulight dialog-btn cancel\" data-track=\"homepage:age:cancel\">Cancel</div>\n            <button type=\"submit\" class=\"btn btn-primary save-age dialog-btn btn-sublue\" data-track=\"homepage:age:save\"></i>Save</button>\n        </div>\n    </form>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"/irXeG":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"container\">\n    <div class=\"row\">\n        <div class=\"su-logo-mobile\"></div>\n    </div>\n    <div class=\"row\">\n        <div class=\"sub-title-mobile\">Discover the best of the web, one click at a time.</div>\n    </div>\n    <div class=\"row\">\n        <div class=\"get-app\">\n            <a class=\"mobile-link\" data-track=\"mobile-install\">\n                <div class=\"get-app-btn\"><i class=\"fa fa-spinner fa-spin get-app-spin hidden\"></i> Get the App</div>\n            </a>\n        </div>\n    </div>\n    <div class=\"row\">\n        <div class=\"mobile-image\">\n            <img src=\"//nb9-stumbleupon.netdna-ssl.com/jmBAk622An8JJy3Ku6HIRA\"/>\n        </div>\n    </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/homepage-mobile":[function(require,module,exports){
module.exports=require('/irXeG');
},{}],"wRua1N":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;


  buffer += "<div class=\"container-fluid ";
  if (helper = helpers._rcclass) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._rcclass); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n    <div class=\"topbar\">\n        <div class=\"su-logo\"></div>\n    </div>\n    <div class=\"rc-invite\">\n      <div class=\"main-logo\">\n          <i class=\"fa fa-stumbleupon-circle\"></i>\n      </div>\n      <div class=\"title\">";
  if (helper = helpers._title) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n      <div class=\"description\">\n          ";
  if (helper = helpers._description) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._description); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n      </div>\n      <div class=\"mix-onboard-button-container\">\n        <div class=\"mix-onboard-button btn btn-orange recognized\"\n            id=\"mix-onboard-button\"\n            data-track=\"home:mix-onboard";
  if (helper = helpers._track_postfix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._track_postfix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n            <span class=\"connect-text\">Join Mix</span>\n        </div>\n        <a class=\"mix-onboard-button btn btn-orange unrecognized\"\n            href=\"https://mix.com/\"\n            id=\"mix-learn-more-button\"\n            data-track=\"home:learn-more\">\n            <span class=\"connect-text\">Join Mix</span>\n        </a>\n      </div>\n      <div class=\"description learn-more-link recognized\">\n          <a href=\"https://mix.com/learn-more\">Learn More</a>\n      </div>\n      <div class=\"description letter-link\">\n          <a href=\"https://community.mix.com/blog/2018/7/2/note-from-stumbleupon-thank-you-for-being-part-of-the-magic\">Letter to our Users</a>\n      </div>\n    </div>\n    <div class=\"homepage-age-container\"></div>\n\n    <div class=\"footer\">\n            <div class=\"copyright\">\n              <span class=\"fa fa-stumbleupon\"></span> <span id=\"currentYear\"></span> StumbleUpon - All rights reserved\n            </div>\n            <div class=\"links\">\n              <div class=\"terms-of-use\">\n                  <a href=\"/terms\" target=\"_blank\" data-track=\"home:terms";
  if (helper = helpers._track_postfix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._track_postfix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">Terms of Use</a>\n              </div>\n              <div class=\"privacy\">\n                  <a href=\"/privacy\" target=\"_blank\" data-track=\"home:privacy-policy";
  if (helper = helpers._track_postfix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._track_postfix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">Privacy Policy</a>\n              </div>\n              <div class=\"feedback\">\n                  <a href=\"/feedback\" target=\"_blank\" data-track=\"home:feedback";
  if (helper = helpers._track_postfix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._track_postfix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">Help and Support</a>\n              </div>\n            </div>\n            <div class=\"footnote recognized\">\n              "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TRANSITION_FOOTNOTE", options) : helperMissing.call(depth0, "i18n", "TRANSITION_FOOTNOTE", options)))
    + "<a href=\"https://mix.com/tos\">Mix Terms of Service</a>.\n            </div>\n    </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/homepage":[function(require,module,exports){
module.exports=require('wRua1N');
},{}],"../templates/image":[function(require,module,exports){
module.exports=require('yh+e2b');
},{}],"yh+e2b":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"image-viewer\">\n  <div class=\"image\" style=\"background-image: url('";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\">\n    <img class=\"image-save\" src=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" alt=\"";
  if (helper = helpers._title) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n  </div>\n</div>\n\n\n<div class=\"stopscroll\"></div>\n<div class=\"swipe right\"></div>\n<div class=\"swipe-indicator\">\n  <span>Swipe to Stumble</span>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"W8dktp":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, self=this, functionType="function";

function program1(depth0,data) {
  
  
  return "new";
  }

function program3(depth0,data) {
  
  var buffer = "", helper, options;
  buffer += "\n      and "
    + escapeExpression((helper = helpers.otherParticipants || (depth0 && depth0.otherParticipants),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.participants), options) : helperMissing.call(depth0, "otherParticipants", (depth0 && depth0.participants), options)))
    + "\n    ";
  return buffer;
  }

function program5(depth0,data) {
  
  var buffer = "", helper, options;
  buffer += "\n      "
    + escapeExpression((helper = helpers.plural || (depth0 && depth0.plural),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.replies), "reply", "replies", options) : helperMissing.call(depth0, "plural", (depth0 && depth0.replies), "reply", "replies", options)))
    + "\n    ";
  return buffer;
  }

  buffer += "<div class=\"row ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.replies), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n  <div class=\"col-xs-7 col-ms-3 participants\">\n    "
    + escapeExpression(((stack1 = ((stack1 = ((stack1 = (depth0 && depth0.participants)),stack1 == null || stack1 === false ? stack1 : stack1[0])),stack1 == null || stack1 === false ? stack1 : stack1._name)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "\n    ";
  stack1 = (helper = helpers.ifMultiple || (depth0 && depth0.ifMultiple),options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.participants), options) : helperMissing.call(depth0, "ifMultiple", (depth0 && depth0.participants), options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  </div>\n  <div class=\"hidden-xs col-ms-2 replynum\">\n    ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.replies), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  </div>\n  <div class=\"hidden-xs col-ms-5 title\">";
  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n  <div class=\"col-xs-5 col-ms-2 timestamp text-right\">"
    + escapeExpression((helper = helpers.fromNow || (depth0 && depth0.fromNow),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.lastEvent), options) : helperMissing.call(depth0, "fromNow", (depth0 && depth0.lastEvent), options)))
    + "</div>\n  <div class=\"col-xs-12 visible-xs content\">\n    <span class=\"replynum\">"
    + escapeExpression((helper = helpers.plural || (depth0 && depth0.plural),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.replies), "reply", "replies", options) : helperMissing.call(depth0, "plural", (depth0 && depth0.replies), "reply", "replies", options)))
    + " - </span>\n    <span class=\"title\">";
  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</span>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/inbox-item":[function(require,module,exports){
module.exports=require('W8dktp');
},{}],"tHM+Gb":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"row\">\n  <div class=\"hidden-xs col-ms-12\">\n    <div class=\"panel-title\">Notifications - Conversations</div>\n  </div>\n  <div class=\"col-xs-12\">\n    <div class=\"inbox-list\"></div>\n  </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/inbox":[function(require,module,exports){
module.exports=require('tHM+Gb');
},{}],"../templates/info":[function(require,module,exports){
module.exports=require('5Wf+xl');
},{}],"5Wf+xl":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType="function";


  buffer += "<div class=\"info-box\">\n  <div class=\"info-discover\">\n    <img class=\"info-buddyicon\" src=\"/images/combined/jorge.jpg\">\n    <div>\n       "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "DISCOVERED_BY", options) : helperMissing.call(depth0, "i18n", "DISCOVERED_BY", options)))
    + "\n    </div>\n    <div class=\"info-name\">\n      Jorge Gordon\n    </div>\n    <div>\n      12 "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "HOURS_AGO", options) : helperMissing.call(depth0, "i18n", "HOURS_AGO", options)))
    + "\n    </div>\n  </div>\n  <div class=\"info-image\">\n    <iframe sandbox src=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"></iframe>\n  </div>\n  <div class=\"info-desc\">\n    <div class=\"info-top\">\n      <div class=\"info-button share\">\n        <img src=\"/images/combined/share.png\">\n        "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "SHARE_THIS_PAGE", options) : helperMissing.call(depth0, "i18n", "SHARE_THIS_PAGE", options)))
    + " <span class=\"arrow\">&#x25BC;</span>\n      </div>\n      <div class=\"info-button add\">\n        <img src=\"/images/combined/add.png\">\n        "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "ADD_TO_LIST", options) : helperMissing.call(depth0, "i18n", "ADD_TO_LIST", options)))
    + "\n      </div>\n      <div class=\"info-button comment\">\n        <img src=\"/images/combined/comment.png\">\n        "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "COMMENTS", options) : helperMissing.call(depth0, "i18n", "COMMENTS", options)))
    + "\n      </div>\n    </div>\n    <div class=\"info-share-dropdown\">\n      <div class=\"facebook\">\n        <img src=\"/images/combined/facebook.png\">\n        Facebook\n      </div>\n\n      <div class=\"twitter\">\n        <img src=\"/images/combined/twitter.png\">\n        Twitter\n      </div>\n\n      <div class=\"email\">\n        <img src=\"/images/combined/email.png\">\n        Email/Stumblers\n      </div>\n    </div>\n\n    <div class=\"info-bottom\">\n      <div class=\"info-stats\">\n        <span>\n          <span class=\"info-num\">";
  if (helper = helpers.likes) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.likes); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</span> "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "LIKES", options) : helperMissing.call(depth0, "i18n", "LIKES", options)))
    + "\n        </span>\n\n        <span>\n          <span class=\"info-num\">45</span> "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "COMMENTS", options) : helperMissing.call(depth0, "i18n", "COMMENTS", options)))
    + "\n        </span>\n\n        <span>\n          <span class=\"info-num\">37</span> "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "LISTS", options) : helperMissing.call(depth0, "i18n", "LISTS", options)))
    + "\n        </span>\n      </div>\n    </div>\n\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"smv2ra":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var stack1, helper;
  if (helper = helpers.thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  }

function program3(depth0,data) {
  
  
  return "https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg";
  }

  buffer += "<div style=\"background-image: url('";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.thumbnail), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "')\" class=\"likers-thumbnail\" title=\"@";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"></div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/liker":[function(require,module,exports){
module.exports=require('smv2ra');
},{}],"../templates/likers-preview":[function(require,module,exports){
module.exports=require('GVOLL+');
},{}],"GVOLL+":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;


  buffer += "<div class=\"likers\"></div>\n<span class=\"remainder hidden-xs hidden-ms hidden-sm\">+ "
    + escapeExpression((helper = helpers.numberFormat || (depth0 && depth0.numberFormat),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.remainder), options) : helperMissing.call(depth0, "numberFormat", (depth0 && depth0.remainder), options)))
    + " "
    + escapeExpression((helper = helpers.plural || (depth0 && depth0.plural),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.remainder), "Other.", "Others.", false, options) : helperMissing.call(depth0, "plural", (depth0 && depth0.remainder), "Other.", "Others.", false, options)))
    + "</span>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"G46BbM":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"real-likers\">\n  <div class=\"animation-likes\">\n    <span class=\"caption hidden-xs hidden-ms hidden-sm hidden-md\">Liked by: </span>\n    <div class=\"likers-row\"></div>\n  </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/likers":[function(require,module,exports){
module.exports=require('G46BbM');
},{}],"/qq0tH":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<span class=\"list-item-text\">";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</span>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/list-item":[function(require,module,exports){
module.exports=require('/qq0tH');
},{}],"jeb2CH":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"row loading-indicator\">\n  <div class=\"text-center\">\n    <div class=\"invite text-center js-text-container\">\n      <i class=\"fa fa-refresh fa-spin\"></i>\n    </div>\n  </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/loading-indicator-spinner":[function(require,module,exports){
module.exports=require('jeb2CH');
},{}],"AeNRLl":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"loading-indicator animated flash infinite\">Loading...</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/loading-indicator":[function(require,module,exports){
module.exports=require('AeNRLl');
},{}],"../templates/login":[function(require,module,exports){
module.exports=require('9vl5FX');
},{}],"9vl5FX":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"inner\">\n  <form>\n    <h1>Sign in to StumbleUpon</h1>\n\n    <input id=\"login-username\" type=\"text\" name=\"username\" placeholder=\"Email or Username\" autofocus=\"autofocus\" />\n    <input id=\"login-password\" type=\"password\" name=\"password\" placeholder=\"Password\" />\n\n    <button type=\"submit\" id=\"login-button\">Login</button>\n\n    <div id=\"login-chrome\">\n      Note: This beta currently works most reliably with Google Chrome.\n    </div>\n  </form>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/luna":[function(require,module,exports){
module.exports=require('0bWuty');
},{}],"0bWuty":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div id=\"ad_channel\" class=\"stumbleupon-luna-test ad_channel test-ads1 test-ads\" src=\"/ads/ads.html?ads=ads\" style=\"width: 1px; height: 1px; position: absolute; bottom: 0; right 0; font-size: 0; overflow: hidden;\">\n  This is an advertisement!\n  <script src=\"//platform.stumbleupon.com/1/widgets.js\" onerror=\"ssTest(event, '1');\"></script>\n  <img class=\"stumbleupon-asp-skele\" src=\"https://pixel.adsafeprotected.com/skeleton.gif\" onerror=\"ssTest(event, '11', true);\">\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/mix-rc":[function(require,module,exports){
module.exports=require('f6CcVt');
},{}],"f6CcVt":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;


  buffer += "<div class=\"rc-invite-container\">\n  <div class=\"mix-onboard-message\">\n    <div class=\"greeting\">";
  if (helper = helpers._mixOnboardGreeting) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._mixOnboardGreeting); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n    <div class=\"title\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TRANSITION_TITLE", options) : helperMissing.call(depth0, "i18n", "TRANSITION_TITLE", options)))
    + "</div>\n    <div class=\"description\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TRANSITION_DESCRIPTION", options) : helperMissing.call(depth0, "i18n", "TRANSITION_DESCRIPTION", options)))
    + "</div>\n    <div class=\"mix-onboard-button-container\">\n      <div class=\" btn-mix btn-mix-primary\"\n         id=\"mix-onboard-button\"\n         data-track=\"spa-adx:mix-onboard\">\n         <span class=\"connect-text\">Join Mix</span>\n      </div>\n      <a class=\"learn-more-link\" id=\"mix-learn-more-button\"\n         href=\"https://mix.com/learn-more\" data-track=\"spa-adx:learn-more\">\n         Learn More\n      </a>\n    </div>\n    <div class=\"footnote\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TRANSITION_FOOTNOTE", options) : helperMissing.call(depth0, "i18n", "TRANSITION_FOOTNOTE", options)))
    + "<a href=\"https://mix.com/tos\">Mix Terms of Service</a>.</div>\n  </div>\n</div>\n<div class=\"mix-branding\"></div>\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/modal-overlay":[function(require,module,exports){
module.exports=require('IssChc');
},{}],"IssChc":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"modal\" id=\"myModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"myModalLabel\" aria-hidden=\"true\">\n  <div class=\"modal-dialog\">\n    <div class=\"modal-content\">\n      <div class=\"modal-body\">\n        ";
  if (helper = helpers._message) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._message); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n      </div>\n      <div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-sulight cancel\" data-dismiss=\"modal\" data-id=\"cancel\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "cancel\">Cancel</button>\n        <button type=\"button\" class=\"btn btn-sured confirmAction\" data-id=\"confirmAction\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "confirmAction\">";
  if (helper = helpers._actionName) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._actionName); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</button>\n      </div>\n    </div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/mode":[function(require,module,exports){
module.exports=require('VHyB0o');
},{}],"VHyB0o":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, functionType="function", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper, options;
  buffer += "\n  <div ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._active), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += " data-mode=\"";
  if (helper = helpers._mode) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._mode); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" data-id=\"mode-selection\" data-track=\"mode-selection\" class=\"interest mode-";
  if (helper = helpers._mode) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._mode); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + " item";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._active), {hash:{},inverse:self.noop,fn:self.program(4, program4, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n    "
    + escapeExpression((helper = helpers.titleize || (depth0 && depth0.titleize),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.name), options) : helperMissing.call(depth0, "titleize", (depth0 && depth0.name), options)))
    + "\n  </div>\n";
  return buffer;
  }
function program2(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "data-active=\"";
  if (helper = helpers._active) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._active); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"";
  return buffer;
  }

function program4(depth0,data) {
  
  
  return " selected";
  }

  stack1 = helpers.unless.call(depth0, (depth0 && depth0._hide), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/modes":[function(require,module,exports){
module.exports=require('jBDgCO');
},{}],"jBDgCO":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;


  buffer += "<div class=\"heading row\">\n  <div class=\"col-xs-12 heading-left\">\n    "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "SELECT_AN_INTEREST_TO_STUMBLE", options) : helperMissing.call(depth0, "i18n", "SELECT_AN_INTEREST_TO_STUMBLE", options)))
    + "\n    <div class=\"search-input-container\">\n     search input\n    </div>\n    <div class=\"action-buttons-view-container\">\n      action buttons\n    </div>\n  </div>\n</div>\n<div class=\"row category-links\">\n  <div class=\"app-defined col-xs-12\">\n    <div class=\"categories five-column\">\n      <div data-active=\"false\" data-mode=\"all\" data-id=\"mode-selection\" data-track=\"mode-selection-all\" class=\"category item mode-all\">\n        All Interests\n      </div>\n      <div data-active=\"false\" data-mode=\"following\" data-id=\"mode-selection\" data-track=\"mode-selection-following\" class=\"category item mode-following\">\n        People I Follow\n      </div>\n     <div data-active=\"false\" data-mode=\"trending\" data-id=\"mode-selection\" data-track=\"mode-selection-trending\" class=\"category item mode-trending\">\n        Trending\n      </div>\n      <div data-active=\"false\" data-mode=\"photos\" data-id=\"mode-selection\" data-track=\"mode-selection-photos\" class=\"category item mode-photos\">\n        Photos\n      </div>\n      <div data-active=\"false\" data-mode=\"videos\" data-id=\"mode-selection\" data-track=\"mode-selection-videos\" class=\"category item mode-videos\">\n        Videos\n      </div>\n    </div>\n  </div>\n</div>\n<div class=\"row interest-links\">\n  <div class=\"data-defined col-xs-12\">\n    <div class=\"modes five-column clearfix\"></div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/notification-domain":[function(require,module,exports){
module.exports=require('pb5Xon');
},{}],"pb5Xon":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"content\">\n  Now stumbling ";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + ".\n  You can change your stumble mode anytime.\n</div>\n<div class=\"pointer\"></div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/placeholder-likers":[function(require,module,exports){
module.exports=require('gxkJ4E');
},{}],"gxkJ4E":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"placeholder-likers hidden-xs\">\n    <span class=\"caption hidden-xs hidden-ms hidden-sm hidden-md\">Liked by: </span>\n    <div class=\"likers-container\">\n        <div style=\"background-image: url('https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg')\" class=\"likers-thumbnail\"></div>\n        <div style=\"background-image: url('https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg')\" class=\"likers-thumbnail\"></div>\n        <div style=\"background-image: url('https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg')\" class=\"likers-thumbnail\"></div>\n        <div style=\"background-image: url('https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg')\" class=\"likers-thumbnail\"></div>\n        <div style=\"background-image: url('https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg')\" class=\"likers-thumbnail\"></div>\n    </div>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/prerender":[function(require,module,exports){
module.exports=require('DuMpgn');
},{}],"DuMpgn":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<link rel=\"prefetch\" href=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n<link rel=\"prerender\" href=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n<iframe sandbox security=\"restricted\" src=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"></iframe>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/add-page":[function(require,module,exports){
module.exports=require('LyXdyy');
},{}],"LyXdyy":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<iframe class=\"submit-inline\" name=\"submit-frame\" frameborder=\"0\" src=\"/submit\"></iframe>\n";
  });

},{"hbsfy/runtime":795}],"../templates/profile/identity":[function(require,module,exports){
module.exports=require('e5FUOS');
},{}],"e5FUOS":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, blockHelperMissing=helpers.blockHelperMissing;

function program1(depth0,data) {
  
  
  return "-self";
  }

function program3(depth0,data) {
  
  var stack1, helper;
  if (helper = helpers.picture_large) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.picture_large); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  }

function program5(depth0,data) {
  
  
  return "https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg";
  }

function program7(depth0,data) {
  
  var buffer = "", stack1, helper, options;
  buffer += "\n    <div class=\"extra-buttons hidden-xs hidden-ms hidden-sm\">\n        ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.is_expert), {hash:{},inverse:self.noop,fn:self.program(8, program8, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n        ";
  stack1 = helpers.unless.call(depth0, (depth0 && depth0._isSelf), {hash:{},inverse:self.noop,fn:self.program(10, program10, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n        ";
  options={hash:{},inverse:self.noop,fn:self.program(12, program12, data),data:data}
  if (helper = helpers.isSuteamSession) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.isSuteamSession); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.isSuteamSession) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(12, program12, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    </div>\n";
  return buffer;
  }
function program8(depth0,data) {
  
  
  return "\n            <div class=\"fa-stack\" title=\"Expert Stumbler\">\n              <i class=\"fa fa-certificate fa-stack-2x\"></i>\n              <i class=\"fa fa-check fa-stack-1x fa-inverse\"></i>\n            </div>\n        ";
  }

function program10(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n            <div class=\"fa fa-flag\" data-id=\"report-user\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:report-user\"></div>\n        ";
  return buffer;
  }

function program12(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n            <div class=\"suteam fa fa-stumbleupon dropdown-container\">\n                <div class=\"admin-actions action-dropdown dropdown-menu\">\n                    <a class=\"dropdown-item\" target=\"_blank\" href=\"http://www.stumbleupon.com/dump/dump.php?userid=";
  if (helper = helpers.userid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.userid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">User Dump</a>\n                    <a class=\"dropdown-item\" target=\"_blank\" href=\"http://www.stumbleupon.com/dump/dash.php?user=";
  if (helper = helpers.userid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.userid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">User Dash</a>\n                    <a class=\"dropdown-item\" target=\"_blank\" href=\"https://sugar.stumble.net/sugar/data/dna?id=";
  if (helper = helpers.userid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.userid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "&type=user&_notoolbar\">Dna Admin</a>\n                </div>\n            </div>\n        ";
  return buffer;
  }

  buffer += "\n<a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/likes\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:user-identity";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._isSelf), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n    <div class=\"user-info\">\n        <div class=\"user-thumb\">\n            <img src=\"";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.picture_large), {hash:{},inverse:self.program(5, program5, data),fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\" alt=\"";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n        </div>\n        <div class=\"username hidden-xs hidden-ms hidden-sm\">@";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n        <div class=\"identity-name hidden-xs hidden-ms hidden-sm\">";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n    </div>\n</a>\n";
  options={hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data}
  if (helper = helpers.isLoggedIn) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.isLoggedIn); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.isLoggedIn) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/list-edit":[function(require,module,exports){
module.exports=require('TDFRAI');
},{}],"TDFRAI":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  
  return "checked";
  }

  buffer += "<div class=\"list-edit-modal\">\n  <div class=\"list-edit\">\n    <div class=\"title\">Edit ";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n    <div class=\"options-container\">\n        <label for=\"list-name\">List Name</label>\n        <input data-id=\"list-name\" data-track=\"list-name\" name=\"list-name\" value=\"";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" />\n        <label for=\"private\">Private</label>\n        <div class=\"checkbox-container\">\n          <input class=\"private-checkbox\" type=\"checkbox\" name=\"private\" data-id=\"private-list\" data-track=\"private-list\" ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.visibility), "private", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.visibility), "private", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/>\n          <div class=\"private-checkbox-state\">\n            <div class='slider'>\n              <span></span>\n              <span></span>\n              <span></span>\n            </div>\n            <div class=\"slider-txt\">Yes</div>\n            <div class=\"slider-txt\">No</div>\n          </div>\n        </div>\n    </div>\n    <div class=\"edit-footer\">\n      <button class=\"delete-list btn btn-sulight\" data-id=\"delete-list\" data-track=\"delete-list\">Delete List</button>\n      <span class=\"right-btns\">\n        <button class=\"cancel-edit btn btn-sulight\" data-id=\"cancel-edit\" data-track=\"cancel-edit\">Cancel</button>\n        <button class=\"save-list btn btn-sublue\" data-id=\"save-list\" data-track=\"save-list\">Save</button>\n      </span>\n    </div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/list-item-tag":[function(require,module,exports){
module.exports=require('dGXMmo');
},{}],"dGXMmo":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  
  return "tag";
  }

function program3(depth0,data) {
  
  
  return "interest";
  }

  buffer += "<a href=\"/stumbler/";
  if (helper = helpers._username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.is_tag), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/";
  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</a>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/list-item-tags":[function(require,module,exports){
module.exports=require('+e+sDE');
},{}],"+e+sDE":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div id=\"list-item-tags\"></div>";
  });

},{"hbsfy/runtime":795}],"5XIoxk":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, blockHelperMissing=helpers.blockHelperMissing, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  var stack1, helper;
  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  }

function program3(depth0,data) {
  
  var stack1, helper;
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  }

function program5(depth0,data) {
  
  var buffer = "", stack1, helper, options;
  buffer += "\n  <div>\n      <div class=\"item-actions\">\n          <div class=\"main-buttons btn-group\">\n\n              <button class=\"btn\" data-id=\"item-share-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item-tile:item-share-btn\">\n                  <i class=\"fa fa-share-alt\"></i>\n              </button>\n              <button class=\"btn\" data-id=\"item-add-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item-tile:item-add-btn\">\n                  <i class=\"add-to-list-icon\"></i>\n              </button>\n              ";
  options={hash:{},inverse:self.noop,fn:self.program(6, program6, data),data:data}
  if (helper = helpers.viewingOwnProfile) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.viewingOwnProfile); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.viewingOwnProfile) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(6, program6, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n          </div>\n\n      </div>\n      <div class=\"addtolist-container\"> </div>\n      <div class=\"dropdown-container dropdown-share-container\"></div>\n  </div>\n  ";
  return buffer;
  }
function program6(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n                  ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._notHistory), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n              ";
  return buffer;
  }
function program7(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                      <button class=\"btn item-delete-btn\" data-id=\"item-delete-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item-tile:item-delete-btn\">\n                          <i class=\"fa fa-trash-o\"></i>\n                      </button>\n                  ";
  return buffer;
  }

  buffer += "<div class=\"list-item-tile-container\">\n\n  <a href=\"/su/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n      <div class=\"tile-top\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item-tile:top\" style=\"background: url('";
  if (helper = helpers._thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"></div>\n  </a>\n\n  <div class=\"tile-bottom\">\n    <div class=\"title\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item-tile:title\">\n      <a href=\"/su/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n        ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.title), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      </a>\n    </div>\n    <div class=\"domain\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item-tile:domain\">\n      "
    + escapeExpression((helper = helpers.getDomain || (depth0 && depth0.getDomain),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.url), options) : helperMissing.call(depth0, "getDomain", (depth0 && depth0.url), options)))
    + "\n    </div>\n    <div class=\"likes\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item-tile:likes\">\n        <a href=\"/content/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n            "
    + escapeExpression((helper = helpers.numberFormat || (depth0 && depth0.numberFormat),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.likes), options) : helperMissing.call(depth0, "numberFormat", (depth0 && depth0.likes), options)))
    + " likes\n        </a>\n    </div>\n  </div>\n  ";
  options={hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data}
  if (helper = helpers.isLoggedIn) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.isLoggedIn); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.isLoggedIn) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n</div>\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/list-item-tile":[function(require,module,exports){
module.exports=require('5XIoxk');
},{}],"Kxz49+":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, blockHelperMissing=helpers.blockHelperMissing, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  
  return "selected";
  }

function program3(depth0,data) {
  
  var stack1, helper;
  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  }

function program5(depth0,data) {
  
  var stack1, helper;
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  }

function program7(depth0,data) {
  
  var buffer = "", stack1, helper, options;
  buffer += "\n    <div class=\"col-xs-5 col-sm-4 col-md-3 text-right item-actions-container\">\n        <div class=\"item-actions\">\n            <div class=\"button\" data-id=\"item-share-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item:item-share-btn\">\n                 <i class=\"fa fa-share-alt\"></i>\n            </div>\n            <div class=\"button\" data-id=\"item-add-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item:item-add-btn\">\n              <i class=\"add-to-list-icon\"></i>\n            </div>\n            ";
  options={hash:{},inverse:self.noop,fn:self.program(8, program8, data),data:data}
  if (helper = helpers.viewingOwnProfile) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.viewingOwnProfile); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.viewingOwnProfile) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(8, program8, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n        </div>\n    </div>\n    <div class=\"addtolist-container\"></div>\n    <div class=\"dropdown-container dropdown-share-container\"></div>\n    ";
  return buffer;
  }
function program8(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n                ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._notHistory), {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n            ";
  return buffer;
  }
function program9(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                    <div class=\"button item-delete-btn\" data-id=\"item-delete-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item:item-delete-btn\">\n                      <i class=\"fa fa-trash-o\"></i>\n                    </div>\n                ";
  return buffer;
  }

  buffer += "<div class=\"list-item-container ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._selected), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n  <div class=\"row\">\n    <div class=\"col-xs-7 col-sm-8 col-md-9 item-description\">\n        <a href=\"/su/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n            <div class=\"list-thumb\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item:thumb\">\n                <div class=\"thumb\" style=\"background: url('";
  if (helper = helpers._thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"></div>\n            </div>\n        </a>\n            <div class='list-text'>\n                <div class=\"title\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item:title\">\n                    <a href=\"/su/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n                        ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.title), {hash:{},inverse:self.program(5, program5, data),fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n                    </a>\n                </div>\n                <div class=\"domain\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item:domain\">\n                    "
    + escapeExpression((helper = helpers.getDomain || (depth0 && depth0.getDomain),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.url), options) : helperMissing.call(depth0, "getDomain", (depth0 && depth0.url), options)))
    + "\n                </div>\n                <div class=\"likes\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-item:likes\">\n                    <a href=\"/content/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n                        "
    + escapeExpression((helper = helpers.numberFormat || (depth0 && depth0.numberFormat),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.likes), options) : helperMissing.call(depth0, "numberFormat", (depth0 && depth0.likes), options)))
    + " likes\n                    </a>\n                </div>\n                <div class=\"tag-list-container\"></div>\n            </div>\n\n    </div>\n\n    ";
  options={hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data}
  if (helper = helpers.isLoggedIn) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.isLoggedIn); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.isLoggedIn) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  </div>\n</div>\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/list-item":[function(require,module,exports){
module.exports=require('Kxz49+');
},{}],"../templates/profile/list":[function(require,module,exports){
module.exports=require('92Q5ld');
},{}],"92Q5ld":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, self=this, functionType="function", blockHelperMissing=helpers.blockHelperMissing;

function program1(depth0,data) {
  
  
  return "\n  <p>You don't have any pages in this list.</p>\n  <p>Add to this list by using the \"Add to List\" Button while on a page or from your likes.</p>\n  <a class=\"btn btn-default start-stumbling\" href=\"/\">Start Stumbling</a>\n  ";
  }

function program3(depth0,data) {
  
  
  return "\n  This user hasn't added to this list. Check back soon.\n  ";
  }

  buffer += "<div class=\"list-content\"></div>\n<div class=\"loading-container\"></div>\n<div class=\"empty-list-container\">\n  <span class=\"add-to-list-icon list-bookmark\"></span>\n  ";
  options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data}
  if (helper = helpers.viewingOwnProfile) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.viewingOwnProfile); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.viewingOwnProfile) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  ";
  options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data}
  if (helper = helpers.viewingOtherProfile) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.viewingOtherProfile); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.viewingOtherProfile) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n</div>\n<div class=\"pagination-container\">\n\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/lists-item-tile":[function(require,module,exports){
module.exports=require('uhDMwl');
},{}],"uhDMwl":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, blockHelperMissing=helpers.blockHelperMissing;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n    <div>\n        <div class=\"item-actions\">\n            <div class=\"main-buttons btn-group\">\n                    <button class=\"btn\" data-id=\"item-edit-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists-tile:item-edit-btn\">\n                        <i class=\"fa fa-pencil\"></i>\n                    </button>\n                    <button class=\"btn item-delete-btn\" data-id=\"item-delete-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists-tile:item-delete-btn\">\n                        <i class=\"fa fa-trash-o\"></i>\n                    </button>\n            </div>\n        </div>\n        <div class='edit-list-container'> </div>\n    </div>\n    ";
  return buffer;
  }

  buffer += "<div class=\"list-item-tile-container\">\n    <a href=\"/stumbler/";
  if (helper = helpers._username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/list/";
  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n        <div class=\"tile-top\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists-tile:top\" style=\"background: url('";
  if (helper = helpers._thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"></div>\n    </a>\n    <div class=\"tile-bottom\">\n        <div class=\"title\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists-tile:title\">\n            <a href=\"/stumbler/";
  if (helper = helpers._username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/list/";
  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n                ";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n            </a>\n        </div>\n        <div class=\"owner\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists-tile:owner\">\n            by: ";
  if (helper = helpers._owner_username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._owner_username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n        </div>\n    </div>\n    ";
  options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data}
  if (helper = helpers.viewingOwnProfile) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.viewingOwnProfile); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.viewingOwnProfile) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"3/QYti":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, blockHelperMissing=helpers.blockHelperMissing;

function program1(depth0,data) {
  
  
  return "selected";
  }

function program3(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                    <div class=\"button\" data-id=\"item-edit-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists-item:item-edit-btn\">\n                        <i class=\"fa fa-pencil\"></i>\n                    </div>\n                    <div class=\"button item-delete-btn\" data-id=\"item-delete-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists-item:item-delete-btn\">\n                        <i class=\"fa fa-trash-o\"></i>\n                    </div>\n                ";
  return buffer;
  }

  buffer += "<div class=\"list-item-container ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._selected), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n    <div class=\"row\">\n        <div class=\"col-xs-7 col-sm-8 col-md-9 item-description\">\n            <a href=\"/stumbler/";
  if (helper = helpers._username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/list/";
  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n                <div class=\"list-thumb\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists-item:thumb\">\n                    <div class=\"thumb\" style=\"background-image: url('";
  if (helper = helpers._thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"></div>\n                </div>\n                <div class='list-text'>\n                    <div class=\"title\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists-item:title\">\n                        ";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n                    </div>\n                    <div class=\"owner\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:lists-item:domain\">\n                        by: ";
  if (helper = helpers._owner_username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._owner_username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n                    </div>\n                </div>\n            </a>\n        </div>\n\n        <div class=\"col-xs-5 col-sm-4 col-md-3 text-right item-actions-container\">\n            <div class=\"item-actions\">\n                ";
  options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data}
  if (helper = helpers.viewingOwnProfile) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.viewingOwnProfile); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.viewingOwnProfile) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n            </div>\n        </div>\n        <div class='edit-list-container'> </div>\n    </div>\n</div>\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/lists-list-item":[function(require,module,exports){
module.exports=require('3/QYti');
},{}],"../templates/profile/pagination":[function(require,module,exports){
module.exports=require('9JAUXg');
},{}],"9JAUXg":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n      ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.ellipsis), {hash:{},inverse:self.program(4, program4, data),fn:self.program(2, program2, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    ";
  return buffer;
  }
function program2(depth0,data) {
  
  
  return "\n      <li class=\"periods\">...</li>\n      ";
  }

function program4(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n      <li>\n        <a data-id=\"page-num\" data-track=\"page-num\" data-pagenum=\"";
  if (helper = helpers.page) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.page); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.isActive), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += ">";
  if (helper = helpers.page) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.page); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</a>\n      </li>\n      ";
  return buffer;
  }
function program5(depth0,data) {
  
  
  return "class=\"isActive\"";
  }

  buffer += "<nav>\n  <ul id=\"profile-pagination\">\n    <li class=\"previous-btn skip-btn\">\n      <a aria-label=\"Previous\" data-id=\"previous-btn\" data-track=\"previous-btn\">\n        <span>Prev</span>\n      </a>\n    </li>\n    ";
  stack1 = helpers.each.call(depth0, (depth0 && depth0.pages), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    \n    <li class=\"next-btn skip-btn\">\n      <a aria-label=\"End\" data-id=\"next-btn\" data-track=\"next-btn\">\n        <span>Next</span>\n      </a>\n    </li>\n  </ul>\n</nav>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/profile-addtolist-item":[function(require,module,exports){
module.exports=require('0RNmO8');
},{}],"0RNmO8":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"list-title\">\n";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n</div>\n<span class=\"fa fa-check\"></span>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/profile-addtolist":[function(require,module,exports){
module.exports=require('3RW9j/');
},{}],"3RW9j/":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "";


  buffer += "<div class=\"add-to-list-body\">\n  <div class=\"add-to-list-header\">\n    <div class=\"search-list-txt\">CHOOSE A LIST</div>\n    <input class=\"search-list\" data-id=\"search-list\" data-track=\"search-list\" name=\"search-list\" type=\"text\" placeholder=\"Search\">\n  </div>\n\n  <div class=\"create-list\" data-id=\"create-list\" data-track=\"create-list\">\n    <span class=\"fa fa-plus-circle\"></span>\n    Create List \"<span class=\"create-list-name\"></span>\"\n  </div>\n  <div class=\"available-lists\">\n    <div class=\"loading-indicator-container\"></div>\n    <ul class=\"addtolist-item-container\"></ul>\n  </div>\n  <div class=\"action-btns text-right\">\n    <div class=\"btn btn-sulight\" data-id=\"addtolist-cancel\" data-track=\"addtolist-cancel\">Cancel</div>\n    <div class=\"btn btn-sublue disabled\" data-id=\"addtolist-save\" data-track=\"addtolist-save\">Save</div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/profile":[function(require,module,exports){
module.exports=require('nKeBKw');
},{}],"nKeBKw":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"profile-inner\">\n  <div class=\"right-profile\">\n    <div id=\"profilehead-container\"></div>\n    <div id=\"profile-container\"></div>\n  </div>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/profile/profilehead-follow":[function(require,module,exports){
module.exports=require('7zsOPi');
},{}],"7zsOPi":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;


  buffer += "<a class=\"following-profilehead\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:following\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/following\">Following <span class=\"hidden-xs hidden-ms hidden-sm hidden-md\">"
    + escapeExpression((helper = helpers.numberFormat || (depth0 && depth0.numberFormat),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.following_count), options) : helperMissing.call(depth0, "numberFormat", (depth0 && depth0.following_count), options)))
    + "</span></a>\n<span class=\"divider\"></span>\n<a class=\"followers-profilehead\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:followers\" href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/followers\"><span class=\"hidden-xs hidden-ms hidden-sm hidden-md\">"
    + escapeExpression((helper = helpers.numberFormat || (depth0 && depth0.numberFormat),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.followers_count), options) : helperMissing.call(depth0, "numberFormat", (depth0 && depth0.followers_count), options)))
    + "</span> Followers</a>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"UrF83T":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, blockHelperMissing=helpers.blockHelperMissing;

function program1(depth0,data) {
  
  
  return "suteam";
  }

function program3(depth0,data) {
  
  
  return "\n                <button class=\"btn btn-sublue add-page-btn hidden-xs hidden-ms\" data-id=\"add-page\" data-track=\"add-page\">\n                    Add a Page\n                </button>\n            ";
  }

function program5(depth0,data) {
  
  
  return "\n                <a href=\"/top-stumblers\" class=\"btn btn-sublue add-stumblers-btn hidden-xs hidden-ms\" data-id=\"profile:discover-stumblers\">\n                    Add Stumblers\n                </a>\n            ";
  }

function program7(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                <!--button class=\"btn btn-suorange stumble-like-btn hidden-xs hidden-ms\" data-id=\"stumble-like-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:stumble-likes\">\n                    Stumble Likes\n                </button-->\n            ";
  return buffer;
  }

function program9(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                <button class=\"btn btn-suorange stumble-list hidden-xs hidden-ms\" data-id=\"stumble-list\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:stumble-list\">\n                    Stumble List\n                </button>\n            ";
  return buffer;
  }

function program11(depth0,data) {
  
  var buffer = "";
  buffer += "\n                <div class=\"action-btns hidden-xs text-right\">\n                      <div class=\"spectator-actions\">\n                            <div class=\"following-container\"></div>\n                      </div>\n                </div>\n            ";
  return buffer;
  }

function program13(depth0,data) {
  
  
  return "\n                <div class=\"view-toggle hidden-xs hidden-ms hidden-sm\">\n                  <i class=\"fa fa-th-list list-view\" data-id=\"toggle-list-view\" data-track=\"toggle-list-view\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"View as List\"></i>\n                  <i class=\"fa fa-th tile-view\" data-id=\"toggle-tile-view\" data-track=\"toggle-tile-view\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\"View as Grid\"></i>\n                </div>\n            ";
  }

function program15(depth0,data) {
  
  var buffer = "", stack1, helper, options;
  buffer += "\n                ";
  options={hash:{},inverse:self.noop,fn:self.program(16, program16, data),data:data}
  if (helper = helpers.isLoggedIn) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.isLoggedIn); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.isLoggedIn) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(16, program16, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n            ";
  return buffer;
  }
function program16(depth0,data) {
  
  
  return "\n                    <div class=\"input-container hidden-xs hidden-ms hidden-sm hidden-md\">\n                        <div class=\"search-header-container\">\n                            <input class=\"search-header\" data-id=\"search-header\" type=\"text\" placeholder=\"Search Your Likes\"/>\n                            <span data-id=\"search-reset\" class=\"input-r-icon fa fa-times-circle\"></span>\n                            <span data-id=\"search-label\" class=\"input-r-icon search-label fa fa-search\"></span>\n                        </div>\n                    </div>\n                ";
  }

function program18(depth0,data) {
  
  
  return "\n                <a href=\"/discover/interests\" class=\"btn btn-sublue edit-interests-btn hidden-xs hidden-ms\" data-id=\"profile:discover-interests\">\n                    Edit Interests\n                </a>\n            ";
  }

function program20(depth0,data) {
  
  var buffer = "";
  buffer += "\n                <div class='add-page-container hidden-xs hidden-ms'></div>\n            ";
  return buffer;
  }

function program22(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n    <div class=\"list-info-container\">\n         <div class=\"row\">\n             <div class=\"col-xs-6 col-xs-offset-1 list-info\">\n                 <span class=\"list-name\">\n                     ";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n                 </span>\n                 ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._owner_username), {hash:{},inverse:self.noop,fn:self.program(23, program23, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n             </div>\n\n             ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._canEdit), {hash:{},inverse:self.noop,fn:self.program(25, program25, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n         </div>\n    </div>\n";
  return buffer;
  }
function program23(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                 <span class=\"owner-name\">\n                     By: ";
  if (helper = helpers._owner_username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._owner_username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n                 </span>\n                 ";
  return buffer;
  }

function program25(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                 <button class=\"btn btn-sulight edit-list-btn\" data-id=\"edit-list\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list-view:edit-list\">\n                     Edit\n                 </button>\n             ";
  return buffer;
  }

  buffer += "\n<div class=\"row align-to-content\">\n    <div id=\"identity-container\" class=\"col-xs-1 col-md-2 ";
  options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data}
  if (helper = helpers.isSuteamSession) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.isSuteamSession); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.isSuteamSession) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\"></div>\n    <div class=\"profilehead-right col-xs-11 col-md-10\">\n        <div class=\"left-side col-xs-12 col-sm-6 col-lg-6\">\n            <button class=\"list-title col-xs-12 col-ms-4 btn btn-sugrey\"  data-id=\"list-title\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:list:switcher\">\n                <span class=\"name\">";
  if (helper = helpers._selectorName) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._selectorName); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</span>\n                <span class=\"fa fa-angle-down\"></span>\n            </button>\n            <div class=\"profile-follow-container col-xs-8 col-ms-8\"></div>\n        </div>\n        <div id=\"dropdown-list-container\" class=\"dropdown-container\"></div>\n\n        <div class=\"col-sm-6 col-lg-6 text-right\">\n            ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._isSelf), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n            ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._canFollowMore), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n            ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._canStumbleLikes), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n            ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._canStumbleList), {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n            ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._canFollow), {hash:{},inverse:self.noop,fn:self.program(11, program11, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n            ";
  stack1 = helpers.unless.call(depth0, (depth0 && depth0.hideViewToggle), {hash:{},inverse:self.noop,fn:self.program(13, program13, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n            ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._showSearch), {hash:{},inverse:self.noop,fn:self.program(15, program15, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n            ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._showEditInterest), {hash:{},inverse:self.noop,fn:self.program(18, program18, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n            ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._isSelf), {hash:{},inverse:self.noop,fn:self.program(20, program20, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n        </div>\n        <div class='edit-list-container'> </div>\n    </div>\n</div>\n";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._isListDetailView), {hash:{},inverse:self.noop,fn:self.program(22, program22, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/profilehead":[function(require,module,exports){
module.exports=require('UrF83T');
},{}],"../templates/profile/summary":[function(require,module,exports){
module.exports=require('Ky7ppy');
},{}],"Ky7ppy":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n      <div class=\"image-container view-list\">\n        <img src=\"";
  if (helper = helpers._thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" alt=\"";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + " photo\">\n      </div>\n      ";
  return buffer;
  }

function program3(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n        <img class=\"owner-thumb\" src=\""
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.owner)),stack1 == null || stack1 === false ? stack1 : stack1.thumbnail)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "\" alt=\""
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.owner)),stack1 == null || stack1 === false ? stack1 : stack1.username)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "'s profile picture\">\n        ";
  return buffer;
  }

function program5(depth0,data) {
  
  var buffer = "";
  buffer += "\n        <div class=\"spectator-actions\">\n          <div class=\"following-container\">\n          \n          </div>\n        </div>\n      ";
  return buffer;
  }

function program7(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n        ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._canEdit), {hash:{},inverse:self.noop,fn:self.program(8, program8, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n      ";
  return buffer;
  }
function program8(depth0,data) {
  
  
  return "\n          <div class=\"owner-actions\">\n            <button><i class=\"fa fa-share\"></i>Share</button>\n            <button><i class=\"fa fa-pencil\"></i>Edit</button>\n          </div>\n        ";
  }

function program10(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "(";
  if (helper = helpers.itemCount) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.itemCount); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + ")";
  return buffer;
  }

  buffer += "<div class=\"row nomargin\">\n  <div class=\"list-head\">\n    <div class=\"left-header-container\">\n      <i class=\"fa fa-angle-down\"></i>\n      ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._thumbnail), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    </div>\n    <div class=\"description\">\n      <div class=\"name view-list\">";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n      <div class=\"owner\">by\n        ";
  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0.owner)),stack1 == null || stack1 === false ? stack1 : stack1.thumbnail), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n        <a href=\"/stumbler/"
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.owner)),stack1 == null || stack1 === false ? stack1 : stack1.username)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "\">\n          "
    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.owner)),stack1 == null || stack1 === false ? stack1 : stack1.username)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))
    + "\n        </a>\n      </div>\n    </div>\n    <div class=\"action-btns\">\n      ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._canFollow), {hash:{},inverse:self.program(7, program7, data),fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n    </div>\n  </div>\n  <div class=\"list-items\"></div>\n  <div class=\"view-all view-list\">\n    <div class=\"col-xs-12 view-all-btn\">\n      View All ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.itemCount), {hash:{},inverse:self.noop,fn:self.program(10, program10, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    </div>\n  </div>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/survey-monkey":[function(require,module,exports){
module.exports=require('fthgkn');
},{}],"fthgkn":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "";


  buffer += " \n<script>(function(t,e,s,o){var n,c,i;t.SMCX=t.SMCX||[],e.getElementById(o)||(n=e.getElementsByTagName(s),c=n[n.length-1],i=e.createElement(s),i.type=\"text/javascript\",i.async=!0,i.id=o,i.src=[\"https:\"===location.protocol?\"https://\":\"http://\",\"widget.surveymonkey.com/collect/website/js/wK8yJyrESUAZlCPtYA0Roaf0GH_2BlwF6K9TdiUs_2FhpslVlLigT0bzqmir2SghveyQ.js\"].join(\"\"),c.parentNode.insertBefore(i,c))})(window,document,\"script\",\"smcx-sdk\");\n</script>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/tag-cloud-item":[function(require,module,exports){
module.exports=require('dSMe6b');
},{}],"dSMe6b":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  
  return "tag";
  }

function program3(depth0,data) {
  
  
  return "interest";
  }

  buffer += "<a id=\"";
  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" class=\"";
  if (helper = helpers._class) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._class); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" href=\"/stumbler/";
  if (helper = helpers._username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._isTag), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/";
  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</a>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/tag-cloud":[function(require,module,exports){
module.exports=require('L5TBu7');
},{}],"L5TBu7":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div id=\"tag-cloud\"></div>";
  });

},{"hbsfy/runtime":795}],"../templates/profile/user-item-tile":[function(require,module,exports){
module.exports=require('wtMQFi');
},{}],"wtMQFi":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;

function program1(depth0,data) {
  
  
  return "\n                    <span class=\"fa-stack\" title=\"Expert Stumbler\">\n                        <i class=\"fa fa-certificate fa-stack-2x\"></i>\n                        <i class=\"fa fa-check fa-stack-1x fa-inverse\"></i>\n                    </span>\n                ";
  }

function program3(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                <div class=\"user-likes\">";
  if (helper = helpers.likes_count) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.likes_count); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + " Like</div>\n            ";
  return buffer;
  }

function program5(depth0,data) {
  
  var buffer = "", helper, options;
  buffer += "\n                <div class=\"user-likes\">"
    + escapeExpression((helper = helpers.numberFormat || (depth0 && depth0.numberFormat),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.likes_count), options) : helperMissing.call(depth0, "numberFormat", (depth0 && depth0.likes_count), options)))
    + " Likes</div>\n            ";
  return buffer;
  }

  buffer += "<div class=\"user-item-tile-container\">\n    <a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n        <div class=\"tile-top\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:user-item-tile:userthumb\" style=\"background-image: url('";
  if (helper = helpers._thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"></div>\n    </a>\n    <a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:user-item-tile:userInfo\">\n        <div class=\"tile-bottom\">\n            <div class=\"username\">\n                ";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n                ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.is_expert), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n            </div>\n\n            ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.program(5, program5, data),fn:self.program(3, program3, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.likes_count), "1", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.likes_count), "1", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n        </div>\n    </a>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/profile/user-item":[function(require,module,exports){
module.exports=require('0O1UkF');
},{}],"0O1UkF":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var stack1, helper;
  if (helper = helpers.picture_large) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.picture_large); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  }

function program3(depth0,data) {
  
  
  return "https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg";
  }

  buffer += "<div class=\"user-item-container\">\n  <div class=\"row\">\n    <div class=\"user-left col-xs-5\">\n      <div class=\"user-thumb\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:user-item:userthumb\" style=\"background-image: url('";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.picture_large), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "')\">\n      </div>\n      <div class=\"margin-spacer\"></div>\n      <div class=\"title-card\">\n        <div class=\"username\">\n          <a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:user-item:username\">";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</a>\n        </div>\n        <div class=\"name\">\n          <a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:user-item:name\">";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</a>\n        </div>\n      </div>\n    </div>\n    <div class=\"stats col-xs-5\">\n      <div class=\"likes text-right\">\n        <a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/likes\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:user-item:likes\">";
  if (helper = helpers.likes_count) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.likes_count); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + " Likes</a>\n      </div>\n      <div class=\"lists text-right\">\n        <a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/lists\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:user-item:lists\">";
  if (helper = helpers.owned_lists_count) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.owned_lists_count); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + " Lists</a>\n      </div>\n      <div class=\"followers text-right\">\n        <a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/followers\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "profile:user-item:followers\">";
  if (helper = helpers.followers_count) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.followers_count); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + " Followers</a>\n      </div>\n    </div>\n    <div class=\"follow-button-container col-xs-2\">\n    \n    </div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/progress-bar/bar":[function(require,module,exports){
module.exports=require('q3lpIL');
},{}],"q3lpIL":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"progress-content\">\n  <h1 class=\"progress-message animated fadeIn\"></h1>\n  <div class=\"progress-wrap\">\n    <div class=\"progress-wrap-inner\">\n      <div class=\"progress-bg\"></div>\n      <div class=\"progress-remain\" style=\"width: ";
  if (helper = helpers.percent) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.percent); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "%;\"></div>\n      <div class=\"progress-stops\">\n        \n        <span class=\"stop fa fa-star star\" style=\"left: 100%;\"></span>\n      </div>\n    </div>\n  </div>\n  <span class=\"footest\"></span>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"tiSUGe":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  if (helper = helpers.message) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.message); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  });

},{"hbsfy/runtime":795}],"../templates/progress-bar/message":[function(require,module,exports){
module.exports=require('tiSUGe');
},{}],"../templates/progress-bar/stop":[function(require,module,exports){
module.exports=require('1O6wZw');
},{}],"1O6wZw":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, self=this, helperMissing=helpers.helperMissing, functionType="function", escapeExpression=this.escapeExpression;

function program1(depth0,data) {
  
  
  return "passed";
  }

function program3(depth0,data) {
  
  
  return "active-stop animated fadeIn";
  }

function program5(depth0,data) {
  
  
  return "\nshowing-count\n";
  }

function program7(depth0,data) {
  
  var buffer = "", stack1, helper, options;
  buffer += "\n  fa fa-lg\n  ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(8, program8, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.thumb), "U", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.thumb), "U", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(10, program10, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.thumb), "D", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.thumb), "D", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n";
  return buffer;
  }
function program8(depth0,data) {
  
  
  return " fa-thumbs-up ";
  }

function program10(depth0,data) {
  
  
  return "fa-thumbs-down";
  }

function program12(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n    ";
  if (helper = helpers.count) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.count); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n  ";
  return buffer;
  }

function program14(depth0,data) {
  
  
  return "\n    -\n  ";
  }

  buffer += "<span class=\"stop ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.passed), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.active), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.showCount), {hash:{},inverse:self.program(7, program7, data),fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\" style=\"left: ";
  if (helper = helpers.percent) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.percent); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "%;\">\n  ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.showCount), {hash:{},inverse:self.noop,fn:self.program(12, program12, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n  ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(14, program14, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.thumb), "N", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.thumb), "N", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n</span>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"Luh4xE":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"report-stumbler-container\">\n    <div class=\"dialog-title\">Flag ";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + " User</div>\n    <form class=\"main-form form-horizontal\" onsubmit=\"return false\">\n        <div class=\"form-group rating-group\">\n            <label class=\"col-xs-5 control-label\">Suggested Rating</label>\n            <div class=\"col-xs-7\">\n                <select class=\"rating form-control\" id=\"rating\" name=\"rating\">\n                    <option disabled selected>Select</option>\n                    <option value=\"0\">Suitable for all users</option>\n                    <option value=\"1\">R-Rated (some nudity or graphic violence)</option>\n                    <option value=\"2\">X-Rate (pornography or excessive nudity)</option>\n                </select>\n            </div>\n        </div>\n        <div class=\"form-group flag-group\">\n            <label class=\"col-xs-5 control-label\">Additional Feedback</label>\n            <div class=\"col-xs-7\">\n                <select class=\"flag form-control\" id=\"flag\" name=\"flag\">\n                    <option disabled selected>Select</option>\n                    <option value=\"5\">Spammer</option>\n                    <option value=\"4\">Hostile</option>\n                    <option value=\"7\">Vulgar</option>\n                </select>\n            </div>\n        </div>\n        <div class=\"dialog-footer\">\n            <div class=\"btn btn-primary btn-sulight cancel\" data-track=\"report-stumbler:cancel\">Cancel</div>\n            <button type=\"submit\" class=\"btn btn-primary send-report btn-sublue disabled\" data-track=\"report-stumbler:send-report\"><i class=\"fa fa-spinner fa-spin send-spin hidden\"></i>Send</button>\n        </div>\n    </form>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/report-stumbler":[function(require,module,exports){
module.exports=require('Luh4xE');
},{}],"../templates/reset-password/base":[function(require,module,exports){
module.exports=require('34Eu8w');
},{}],"34Eu8w":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"header-container\">\n    <div class=\"container\">\n        <ul class=\"nav nav-tabs\">\n            <li id=\"nav-tab-text\" role=\"presentation\" class=\"active\"></li>\n        </ul>\n    </div>\n</div>\n<div class=\"sub-content-container container\">\n    <div id=\"sub-content-container\"></div>\n    <div class=\"quick-links col-xs-3\">\n        <div class=\"quick-links-title\">Quick Links</div>\n        <ul>\n            <li>\n                <a class=\"small\" target=\"_blank\" href=\"http://help.stumbleupon.com/customer/portal/articles/665202-account-settings#article7\">How To Change Your Password FAQ</a>\n            </li>\n            <li>\n                <a class=\"small\" target=\"_blank\" href=\"http://help.stumbleupon.com/customer/portal/articles/665213-login-issues\">Sign-in Issues FAQ</a>\n            </li>\n            <li>\n                <a class=\"small\" target=\"_blank\" href=\"/settings\">Account Settings</a>\n            </li>\n        </ul>\n    </div>\n    <div id=\"success-container\"></div>\n</div>\n<div class=\"feedback-container\">\n    <div class=\"container\">\n        <div class=\"row\">\n            <div class=\"col-xs-8\">\n                <div class=\"send-feedback\">Send Feedback</div>\n                <p class=\"info\">\n                    Your feedback is very important to us.<br/>\n                    Let us know how we can improve your experience.\n                </p>\n            </div>\n            <div class=\"col-xs-4\">\n                <a  href=\"/feedback\" rel=\"external\" target=\"_blank\" class=\"btn btn-default text-center\" data-track=\"settings:send-feedback\">Contact Us</a>\n            </div>\n        </div>\n    </div>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/reset-password/confirm":[function(require,module,exports){
module.exports=require('4p1x6f');
},{}],"4p1x6f":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, self=this;

function program1(depth0,data) {
  
  
  return "\n    <div class=\"form-group confirm-id-group has-feedback\">\n        <label for=\"confirm-id\" class=\"col-xs-3 control-label confirm-id-label\">Confirmation Code</label>\n        <div class=\"col-xs-6\">\n            <input type=\"text\" id=\"confirm-id\" class=\"form-control confirm-id\"/>\n            <span class=\"form-control-feedback\" id=\"confirm-id-feedback\"></span>\n        </div>\n    </div>\n    ";
  }

  buffer += "<form class=\"form-horizontal confirm-form\" onsubmit=\"return false\">\n    <div class=\"invalid-update\"></div>\n    ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._isConfirmIdEmpty), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    <div class=\"form-group new-password-group has-feedback\">\n        <label class=\"col-xs-3 new-password-label control-label\">New Password<br/>\n            <p class=\"small\">Max 16 Characters</p>\n        </label>\n        <div class=\"col-xs-6\">\n            <input class=\"form-control\" id=\"new-password\" type=\"password\" name=\"new-password\" maxlength=\"16\" />\n            <span class=\"form-control-feedback\" id=\"new-password-feedback\"></span>\n        </div>\n    </div>\n    <div class=\"form-group confirm-password-group has-feedback\">\n        <label class=\"col-xs-3 confirm-password-label control-label\">Confirm Password</label>\n        <div class=\"col-xs-6\">\n            <input class=\"form-control\" id=\"confirm-password\" type=\"password\" name=\"confirm-password\" maxlength=\"16\" />\n            <span class=\"form-control-feedback\" id=\"confirm-password-feedback\"></span>\n        </div>\n    </div>\n\n    <div class=\"form-group\">\n        <div class=\"col-xs-offset-3 col-xs-6\">\n            <button type=\"submit\" class=\"btn btn-primary save update-request\" data-track=\"reset-password:update-password-send\"><i class=\"fa fa-spinner fa-spin save-spin hidden\"></i>Update Password</button>\n        </div>\n    </div>\n</form>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/reset-password/request":[function(require,module,exports){
module.exports=require('uvkCgU');
},{}],"uvkCgU":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<form class=\"form-horizontal request-form\" onsubmit=\"return false\">\n    <div class=\"form-group\">\n        <label for=\"email\" class=\"col-xs-3 control-label email-label\">Username or Email<br/>\n            <p class=\"small\">Enter the username or email address associated with your StumbleUpon account</p>\n        </label>\n        <div class=\"col-xs-6\">\n            <input type=\"text\" class=\"form-control email\"/>\n        </div>\n    </div>\n    <div class=\"form-group\">\n        <div class=\"col-xs-offset-3 col-xs-6\">\n            <button type=\"submit\" class=\"btn btn-primary save send-request\" data-track=\"reset-password:reset-password-send\"><i class=\"fa fa-spinner fa-spin save-spin hidden\"></i>Reset Password</button>\n        </div>\n    </div>\n</form>\n\n";
  });

},{"hbsfy/runtime":795}],"../templates/reset-password/success-confirm":[function(require,module,exports){
module.exports=require('n/Xovh');
},{}],"n/Xovh":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"success-confirm-container\">\n    <div class=\"title\">Success!</div>\n    <form class=\"main-form\">\n        <label class=\"control-label\">Your password has been successfully changed.</label>\n    </form>\n    <div class=\"footer\">\n        <a href=\"/login\">\n            <div class=\"btn btn-primary btn-sublue\" data-track=\"reset-password:login-page\">Go To Login Page!</div>\n        </a>\n    </div>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/reset-password/success-request":[function(require,module,exports){
module.exports=require('Jz0bH1');
},{}],"Jz0bH1":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"success-request-container\">\n    <div class=\"title\">Almost Done...</div>\n    <form class=\"main-form\">\n        <label class=\"control-label\">An email has been sent to your email address containing a confirmation link and instructions to reset your password.\n            <br/>\n            <br/>\n            To ensure email delivery, please add <br/><b>no-reply@mail.stumblemail.net</b> to your address book.\n        </label>\n    </form>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/settings/account-delete":[function(require,module,exports){
module.exports=require('xs5UGO');
},{}],"xs5UGO":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"delete-account-container\">\n    <div class=\"title\">Are you sure you want to delete this account?</div>\n    <div class=\"invalid-update\"></div>\n    <div class=\"sub-title\">Please note: Your account will be deleted 2 weeks from the day you submit your request. Account deletion is permanent, and removes all account information including your Likes, Shares, and Inbox messages.</div>\n    <form class=\"main-form form-horizontal\" onsubmit=\"return false\">\n        <div class=\"form-group username-group\">\n            <label class=\"col-xs-4 control-label\">Your Username</label>\n            <div class=\"col-xs-8\">\n                <input class=\"form-control\" id=\"username\" type=\"text\" name=\"username\" placeholder=\"";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" disabled />\n            </div>\n        </div>\n        <div class=\"form-group password-group has-feedback\">\n            <label class=\"col-xs-4 control-label\">Confirm Password</label>\n            <div class=\"col-xs-8\">\n                <input class=\"form-control\" id=\"password\" type=\"password\" name=\"password\" maxlength=\"16\" />\n                <span class=\"form-control-feedback\" id=\"password-feedback\"></span>\n            </div>\n        </div>\n        <div class=\"footer\">\n            <div class=\"btn btn-primary btn-sulight cancel\" data-track=\"settings:account-delete:cancel\">Cancel</div>\n            <button type=\"submit\" class=\"btn btn-primary delete btn-sured\" data-track=\"settings:account-delete:delete\"><i class=\"fa fa-spinner fa-spin save-spin hidden\"></i>Delete</button>\n        </div>\n    </form>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"4dgVDP":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, self=this, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  
  return "selected=\"selected\"";
  }

function program3(depth0,data) {
  
  
  return "\n                    <a class=\"cancel-delete-account text-only\" data-track=\"settings:account:mark-delete\">Click here to Cancel Account Deletion!</a>\n                ";
  }

function program5(depth0,data) {
  
  
  return "\n                    <a class=\"delete-account text-only\" data-track=\"settings:account:unmark-delete\">Click here to initiate account deletion</a>\n                    <div class=\"account-delete-container\"></div>\n                ";
  }

function program7(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n            <div class=\"form-group\">\n                <label class=\"col-xs-2 control-label\">Beta:</label>\n                <div class=\"col-xs-6\">\n                    <div class=\"row\">\n                        <div class=\"checkbox-container col-xs-3 col-md-2\" data-track=\"settings:account:beta\">\n                            <input class=\"slider-checkbox\" name=\"beta\" type=\"checkbox\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._beta), {hash:{},inverse:self.noop,fn:self.program(8, program8, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/>\n                            <div class=\"slider-checkbox-state\">\n                                <div class=\"slider\"></div>\n                            </div>\n                        </div>\n                        <label class=\"col-xs-2= slider-label\" for=\"beta\">New Redesign</label>\n                    </div>\n                </div>\n            </div>\n        ";
  return buffer;
  }
function program8(depth0,data) {
  
  
  return "checked";
  }

  buffer += "<div class=\"row\">\n    <form class=\"form-horizontal\">\n        <div class=\"form-group\">\n            <label class=\"col-xs-2 control-label\">Password</label>\n            <div class=\"col-xs-6\">\n                <a class=\"change-password text-only\" data-track=\"settings:account:change-password\">Change Password</a>\n                <div class=\"change-password-container\"></div>\n            </div>\n        </div>\n        <div class=\"form-group birthday\">\n            <label class=\"col-xs-2 control-label\">Birthday</label>\n            <div class=\"col-xs-6\">\n                <select class=\"form-control month\" name=\"month\">\n                      <option disabled=\"disabled\">Month</option>\n                </select>\n                <select class=\"form-control day\" name=\"day\">\n                      <option disabled=\"disabled\">Day</option>\n                </select>\n                <select class=\"form-control year\" name=\"year\">\n                      <option disabled=\"disabled\">Year</option>\n                </select>\n          </div>\n        </div>\n        <div class=\"form-group\">\n            <label class=\"col-xs-2 control-label\">Gender</label>\n            <div class=\"col-xs-6\">\n                <select class=\"form-control gender\">\n                    <option disabled=\"disabled\" selected=\"selected\">Gender</option>\n                    <option ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.gender), "1", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.gender), "1", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += " value=\"1\">Male</option>\n                    <option ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.gender), "2", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.gender), "2", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += " value=\"2\">Female</option>\n                </select>\n            </div>\n        </div>\n        <div class=\"form-group\">\n            <label class=\"col-xs-2 control-label\">Likes &amp; interests</label>\n            <div class=\"col-xs-6\">\n                <select class=\"form-control likes-interests\">\n                  <option value=\"0\" ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.likesInterests), 0, options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.likesInterests), 0, options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += ">Only visible to me</option>\n                  <option value=\"1\" ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.likesInterests), 1, options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.likesInterests), 1, options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  stack1 = helpers.unless.call(depth0, (depth0 && depth0.likesInterests), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += ">Visible to Everyone, but hide any adult content</option>\n                  <option value=\"2\" ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.likesInterests), 2, options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.likesInterests), 2, options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += ">Visible to Everyone</option>\n                </select>\n            </div>\n        </div>\n        <div class=\"form-group\">\n            <label class=\"col-xs-2 control-label\">Delete Account</label>\n            <div class=\"col-xs-6\">\n                ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.markedForDeletion), {hash:{},inverse:self.program(5, program5, data),fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n            </div>\n        </div>\n        ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._shouldShowBeta), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n        <div class=\"form-group\">\n            <div class=\"col-xs-offset-2 col-xs-6\">\n                <div class=\"btn btn-primary save\" data-track=\"settings:account:save\"><i class=\"fa fa-spinner fa-spin save-spin hidden\"></i>Save Changes</div>\n            </div>\n        </div>\n    </form>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/settings/account":[function(require,module,exports){
module.exports=require('4dgVDP');
},{}],"yeeyow":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"header-container\">\n  <div class=\"container\">\n    <ul class=\"nav nav-tabs\">\n      <li role=\"presentation\" class=\"profile active\" data-track=\"settings:tab:profile\"><a href=\"/settings/profile\">Profile</a></li>\n      <li role=\"presentation\" class=\"account\" data-track=\"settings:tab:account\"><a href=\"/settings/account\">Account Info</a></li>\n      <li role=\"presentation\" class=\"personalization\" data-track=\"settings:tab:personalization\"><a href=\"/settings/personalization\">Personalization</a></li>\n      <li role=\"presentation\" class=\"notifications\" data-track=\"settings:tab:notifications\"><a href=\"/settings/notifications\">Notifications</a></li>\n      <li role=\"presentation\" class=\"connections\" data-track=\"settings:tab:connections\"><a href=\"/settings/connections\">Connections</a></li>\n    </ul>\n  </div>\n</div>\n<div class=\"sub-content-container\">\n  <div id=\"sub-content-container\" class=\"container\"></div>\n</div>\n<div class=\"feedback-container\">\n  <div class=\"container\">\n    <div class=\"row\">\n      <div class=\"col-xs-8\">\n        <div class=\"send-feedback\">Send Feedback</div>\n        <p class=\"info\">\n          Your feedback is very important to us.<br/>\n          Let us know how we can improve your experience.\n        </p>\n      </div>\n      <div class=\"col-xs-4\">\n        <a  href=\"/feedback\" rel=\"external\" target=\"_blank\" class=\"btn btn-default text-center\" data-track=\"settings:send-feedback\">Contact Us</a>\n      </div>\n    </div>\n  </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/settings/base":[function(require,module,exports){
module.exports=require('yeeyow');
},{}],"../templates/settings/change-password":[function(require,module,exports){
module.exports=require('kKoRAt');
},{}],"kKoRAt":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"change-password-container\">\n    <div class=\"title\">Change Your Password</div>\n    <div class=\"invalid-update\"></div>\n    <form class=\"main-form form-horizontal\" onsubmit=\"return false\">\n        <div class=\"form-group current-password-group has-feedback\">\n            <label class=\"col-xs-4 control-label\">Current Password</label>\n            <div class=\"col-xs-8\">\n                <input class=\"form-control\" id=\"current-password\" type=\"password\" name=\"current-password\" maxlength=\"16\" />\n                <span class=\"form-control-feedback\" id=\"current-password-feedback\"></span>\n            </div>\n        </div>\n        <div class=\"form-group new-password-group has-feedback\">\n            <label class=\"col-xs-4 control-label\">New Password</label>\n            <div class=\"col-xs-8\">\n                <input class=\"form-control\" id=\"new-password\" type=\"password\" name=\"new-password\" maxlength=\"16\" />\n                <span class=\"form-control-feedback\" id=\"new-password-feedback\"></span>\n            </div>\n        </div>\n        <div class=\"form-group confirm-password-group has-feedback\">\n            <label class=\"col-xs-4 control-label\">Confirm Password</label>\n            <div class=\"col-xs-8\">\n                <input class=\"form-control\" id=\"confirm-password\" type=\"password\" name=\"confirm-password\" maxlength=\"16\" />\n                <span class=\"form-control-feedback\" id=\"confirm-password-feedback\"></span>\n            </div>\n        </div>\n        <a class=\"forgot-password\" data-track=\"settings:change-password:forgot-password\" href=\"/reset-password\" target=\"_blank\">Forgot Password?</a>\n        <div class=\"footer\">\n            <div class=\"btn btn-primary btn-sulight cancel\" data-track=\"settings:change-password:cancel\">Cancel</div>\n            <button type=\"submit\" class=\"btn btn-primary save-password btn-sublue\" data-track=\"settings:change-password:save\"><i class=\"fa fa-spinner fa-spin save-spin hidden\"></i>Save</button>\n        </div>\n    </form>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/settings/connections":[function(require,module,exports){
module.exports=require('7N+aXr');
},{}],"7N+aXr":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, self=this;

function program1(depth0,data) {
  
  
  return "\n              <div class=\"btn btn-primary text-center facebook-disconnect disconnect\" data-track=\"settings:facebook:disconnect\">Disconnect</div>\n          ";
  }

function program3(depth0,data) {
  
  
  return "\n              <div class=\"btn btn-primary text-center facebook-connect-button\" data-track=\"settings:facebook:connect\">Connect</div>\n          ";
  }

function program5(depth0,data) {
  
  
  return "\n            <div class=\"btn btn-primary text-center google-disconnect disconnect\" data-track=\"settings:google:disconnect\">Disconnect</div>\n        ";
  }

function program7(depth0,data) {
  
  
  return "\n            <div class=\"btn btn-primary text-center google-connect-button\" id=\"google-connect-button\" data-track=\"settings:google:connect\">Connect</div>\n        ";
  }

function program9(depth0,data) {
  
  
  return "\n              <div class=\"btn btn-primary text-center twitter-disconnect disconnect\" data-track=\"settings:twitter:disconnect\">Disconnect</div>\n          ";
  }

function program11(depth0,data) {
  
  
  return "\n              <div class=\"btn btn-primary text-center twitter-connect-button\" data-track=\"settings:twitter:connect\">Connect</div>\n          ";
  }

  buffer += "<div class=\"row facebook-connect\">\n    <div class=\"col-xs-1 text-center\"><i class=\"fa fa-facebook-square\"></i></div>\n    <div class=\"col-xs-5\">\n        <strong>Facebook</strong>\n        <p class=\"info\">\n          Connect to your Facebook account and find your friends on StumbleUpon, see their activity and discover together.\n        </p>\n    </div>\n      <div class=\"col-xs-3 col-xs-offset-1\">\n          ";
  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0.facebook_account)),stack1 == null || stack1 === false ? stack1 : stack1.connected), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      </div>\n</div>\n<br/>\n\n<div class=\"row google-connect\">\n    <div class=\"col-xs-1 text-center\"><i class=\"fa fa-google-plus-square\"></i></div>\n    <div class=\"col-xs-5\">\n        <strong>Google</strong>\n        <p class=\"info\">\n          Connect to your Google account and people in your circles on StumbleUpon, see their activity and discover together.\n        </p>\n    </div>\n    <div class=\"col-xs-3 col-xs-offset-1\">\n        ";
  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0.google_account)),stack1 == null || stack1 === false ? stack1 : stack1.connected), {hash:{},inverse:self.program(7, program7, data),fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    </div>\n</div>\n<br/>\n\n<div class=\"row twitter-connect\">\n    <div class=\"col-xs-1 text-center\"><i class=\"fa fa-twitter-square\"></i></div>\n    <div class=\"col-xs-5\">\n        <strong>Twitter</strong>\n        <p class=\"info\">\n          Who doesn't have a Twitter account these days? Connect and find some buddies.\n        </p>\n    </div>\n      <div class=\"col-xs-3 col-xs-offset-1\">\n          ";
  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0.twitter_account)),stack1 == null || stack1 === false ? stack1 : stack1.connected), {hash:{},inverse:self.program(11, program11, data),fn:self.program(9, program9, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      </div>\n</div>\n<br/>\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"m/nrZl":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"crop-picture-container\">\n    <div class=\"title\">Crop Your Picture</div>\n    <form class=\"main-form form-horizontal\" onsubmit=\"return false\">\n        <div id=\"jcrop\"></div>\n        <div class=\"footer\">\n            <div class=\"btn btn-primary btn-sulight cancel\" data-track=\"settings:crop-picture:cancel\">Cancel</div>\n            <button type=\"submit\" class=\"btn btn-primary save-picture btn-sublue\" data-track=\"settings:crop-picture:save\"><i class=\"fa fa-spinner fa-spin save-spin hidden\"></i>Crop</button>\n        </div>\n        <canvas id=\"canvas\"></canvas>\n    </form>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/settings/crop-picture":[function(require,module,exports){
module.exports=require('m/nrZl');
},{}],"../templates/settings/heading-create-interests":[function(require,module,exports){
module.exports=require('Evosrg');
},{}],"Evosrg":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;


  buffer += "<div class=\"interests-incomplete\">\n  <div class=\"welcome text-center\">";
  stack1 = (helper = helpers.currentUser || (depth0 && depth0.currentUser),options={hash:{},data:data},helper ? helper.call(depth0, "name", options) : helperMissing.call(depth0, "currentUser", "name", options));
  buffer += escapeExpression((helper = helpers['i18n-replace'] || (depth0 && depth0['i18n-replace']),options={hash:{},data:data},helper ? helper.call(depth0, "SIGNUP_WELCOME", "Stumbler", stack1, options) : helperMissing.call(depth0, "i18n-replace", "SIGNUP_WELCOME", "Stumbler", stack1, options)))
    + "</div>\n  <div class=\"header text-center\" id=\"interests-countdown\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "CREATE_MY_INTERESTS", options) : helperMissing.call(depth0, "i18n", "CREATE_MY_INTERESTS", options)))
    + "</div>\n  <div class=\"explanation text-center\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "WHY_TEN_INTERESTS", options) : helperMissing.call(depth0, "i18n", "WHY_TEN_INTERESTS", options)))
    + "</div>\n</div>\n<div class=\"interests-complete\">\n  <div class=\"congratulations text-center\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "CONGRATULATIONS_YOU_ARE_READY_TO_STUMBLE", options) : helperMissing.call(depth0, "i18n", "CONGRATULATIONS_YOU_ARE_READY_TO_STUMBLE", options)))
    + "</div>\n  <div class=\"text-center\">\n    <span class=\"header\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "KEEP_GOING", options) : helperMissing.call(depth0, "i18n", "KEEP_GOING", options)))
    + "</span>\n    <span class=\"or\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "OR_ALL_CAPS", options) : helperMissing.call(depth0, "i18n", "OR_ALL_CAPS", options)))
    + "</span>\n    <span id=\"action-buttons-view-container\" class=\"action-buttons\"></span>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"nsisvZ":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;


  buffer += "<div id=\"settings-heading-edit-interests\" class=\"header\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "EDIT_MY_INTERESTS", options) : helperMissing.call(depth0, "i18n", "EDIT_MY_INTERESTS", options)))
    + "</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/settings/heading-edit-interests":[function(require,module,exports){
module.exports=require('nsisvZ');
},{}],"../templates/settings/heading-suggest-interests":[function(require,module,exports){
module.exports=require('RMVmwV');
},{}],"RMVmwV":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;


  buffer += "<div class=\"header text-center\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "YOU_MIGHT_LIKE", options) : helperMissing.call(depth0, "i18n", "YOU_MIGHT_LIKE", options)))
    + " &hellip;</div>\n<div class=\"text-center\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "WE_FOUND_SOME_GREAT_RECOMMENDATIONS", options) : helperMissing.call(depth0, "i18n", "WE_FOUND_SOME_GREAT_RECOMMENDATIONS", options)))
    + "</div>\n<div id=\"action-buttons-view-container\" class=\"action-buttons upper-right\"></div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/settings/interest":[function(require,module,exports){
module.exports=require('7FUspW');
},{}],"7FUspW":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;


  buffer += "<div class=\"interest\">\n  <div class=\"thumbnail\" style=\"background-image: url('";
  if (helper = helpers.pic_med) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.pic_med); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"></div>\n  <div class=\"description\">\n    <div class=\"name\">";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n    <div class=\"followers-count\">"
    + escapeExpression((helper = helpers.numberFormat || (depth0 && depth0.numberFormat),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.followers), options) : helperMissing.call(depth0, "numberFormat", (depth0 && depth0.followers), options)))
    + " followers</div>\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/settings/my-interests":[function(require,module,exports){
module.exports=require('hwHhgx');
},{}],"hwHhgx":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div id=\"heading-container\" class=\"heading-container container\"></div>\n<div id=\"tab-view-container\" class=\"tab-view-container\"></div>\n<div class=\"mask\"></div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/settings/notifications":[function(require,module,exports){
module.exports=require('DcknTu');
},{}],"DcknTu":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, self=this;

function program1(depth0,data) {
  
  
  return "checked";
  }

  buffer += "<div class=\"row\">\n  <form class=\"form-horizontal\">\n    <div class=\"form-group\">\n      <label class=\"col-xs-2 control-label\">Email Preferences:</label>\n      <div class=\"col-xs-6\">\n          <div class=\"row\">\n              <div class=\"checkbox-container col-xs-3 col-md-2\" data-track=\"settings:notifications:weekly-rec\">\n                  <input class=\"slider-checkbox\" name=\"weekly-rec\" type=\"checkbox\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.weeklyRecEmailGroupV2), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/>\n                  <div class=\"slider-checkbox-state\">\n                      <div class=\"slider\"></div>\n                  </div>\n              </div>\n              <label class=\"col-xs-8 col-md-6 slider-label\" for=\"weekly-rec\">Content Recommendations</label>\n          </div>\n\n          <div class=\"row\">\n              <div class=\"checkbox-container col-xs-3 col-md-2\" data-track=\"settings:notifications:social\">\n                  <input class=\"slider-checkbox\" name=\"social\" type=\"checkbox\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.socialEmailGroupV2), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/>\n                  <div class=\"slider-checkbox-state\">\n                      <div class=\"slider\"></div>\n                  </div>\n              </div>\n              <label class=\"col-xs-8 col-md-6 slider-label\" for=\"social\">Social Activity</label>\n          </div>\n\n          <div class=\"row\">\n              <div class=\"checkbox-container col-xs-3 col-md-2\" data-track=\"settings:notifications:personal\">\n                  <input class=\"slider-checkbox\" name=\"personal\" type=\"checkbox\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.personalEmailGroupV2), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/>\n                  <div class=\"slider-checkbox-state\">\n                      <div class=\"slider\"></div>\n                  </div>\n              </div>\n              <label class=\"col-xs-8 col-md-6 slider-label\" for=\"personal\">Email Messaging</label>\n          </div>\n      </div>\n    </div>\n    <div class=\"form-group\">\n      <div class=\"col-xs-offset-2 col-xs-6\">\n        <div class=\"btn btn-primary save\" data-track=\"settings:notifications:save\"><i class=\"fa fa-spinner fa-spin save-spin hidden\"></i>Save Changes</div>\n      </div>\n    </div>\n  </form>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"yiPzq7":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, self=this, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  
  return "checked";
  }

function program3(depth0,data) {
  
  
  return "checked=\"true\"";
  }

function program5(depth0,data) {
  
  
  return " checked=\"true\"";
  }

function program7(depth0,data) {
  
  
  return "\n                    <p class=\"no-blocked-domains\">No Blocked Domains</p>\n                ";
  }

function program9(depth0,data) {
  
  
  return "\n                    <div class=\"blocked-domains-container\">\n                    </div>\n                ";
  }

  buffer += "<div class=\"row\">\n    <form class=\"form-horizontal\">\n        <div class=\"form-group\">\n              <label class=\"col-xs-2 control-label\">Show Me:</label>\n              <div class=\"col-xs-6\">\n                 <div class=\"row\">\n                     <div class=\"checkbox-container col-xs-3 col-md-2\" data-track=\"settings:personalization:audio\">\n                         <input class=\"slider-checkbox\" name=\"audio\" type=\"checkbox\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.audio), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/>\n                         <div class=\"slider-checkbox-state\">\n                             <div class=\"slider\"></div>\n                         </div>\n                     </div>\n                     <label class=\"col-xs-2 slider-label\" for=\"audio\">Audio</label>\n                 </div>\n\n                  <div class=\"row\">\n                      <div class=\"checkbox-container col-xs-3 col-md-2\" data-track=\"settings:personalization:video\">\n                          <input class=\"slider-checkbox\" name=\"video\" type=\"checkbox\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.video), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/>\n                          <div class=\"slider-checkbox-state\">\n                              <div class=\"slider\"></div>\n                          </div>\n                      </div>\n                      <label class=\"col-xs-2 slider-label\" for=\"video\">Video</label>\n                  </div>\n\n                  <div class=\"row\">\n                      <div class=\"checkbox-container col-xs-3 col-md-2\" data-track=\"settings:personalization:flash\">\n                          <input class=\"slider-checkbox\" name=\"flash\" type=\"checkbox\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.flash), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/>\n                          <div class=\"slider-checkbox-state\">\n                              <div class=\"slider\"></div>\n                          </div>\n                      </div>\n                      <label class=\"col-xs-2 slider-label\" for=\"flash\">Flash</label>\n                  </div>\n\n                  <div class=\"row\">\n                      <div class=\"checkbox-container col-xs-3 col-md-2\" data-track=\"settings:personalization:images\">\n                          <input class=\"slider-checkbox\" name=\"images\" type=\"checkbox\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.images), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/>\n                          <div class=\"slider-checkbox-state\">\n                              <div class=\"slider\"></div>\n                          </div>\n                      </div>\n                      <label class=\"col-xs-2 slider-label\" for=\"images\">Images</label>\n                  </div>\n\n                  <div class=\"row\">\n                      <div class=\"checkbox-container col-xs-3 col-md-2\" data-track=\"settings:personalization:pdfs\">\n                          <input class=\"slider-checkbox\" name=\"pdfs\" type=\"checkbox\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.pdfs), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "/>\n                          <div class=\"slider-checkbox-state\">\n                              <div class=\"slider\"></div>\n                          </div>\n                      </div>\n                      <label class=\"col-xs-2 slider-label\" for=\"pdfs\">PDFs</label>\n                  </div>\n              </div>\n        </div>\n        <div class=\"form-group\">\n            <label class=\"col-xs-2 control-label\">Languages:</label>\n            <div class=\"col-xs-6 languages-container\">\n                <p class=\"info\">Select languages you speak. We'll include pages with those languages in your personalized stumbling sessions.</p>\n                <a class=\"add-language text-only\" id=\"add-new-language\" data-track=\"settings:personalization:add-language\">+ Add new language</a>\n            </div>\n        </div>\n        <div class=\"form-group\">\n            <label class=\"col-xs-2 control-label\">Interests:</label>\n            <div class=\"col-xs-6\">\n                <label><input type=\"radio\" name=\"interests\" value=\"all-ages\" ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.rating), "all-ages", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.rating), "all-ages", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  stack1 = helpers.unless.call(depth0, (depth0 && depth0.rating), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "  data-track=\"settings:personalization:all-ages\"/> Default Interests</label><br/>\n                <label><input type=\"radio\" name=\"interests\" value=\"r-rated\" ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.rating), "r-rated", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.rating), "r-rated", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "  data-track=\"settings:personalization:r-rated\"/> R-rated Interests</label><br/>\n                <p class=\"info interest-info\">Selecting this option allows you to select R-rated interests. In addition, your profile interaction is limited <span class=\"strictly\">strictly</span> to other R-rated users.</p>\n                <label><input type=\"radio\" name=\"interests\" value=\"x-rated\" ";
  stack1 = (helper = helpers.ifCond || (depth0 && depth0.ifCond),options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.rating), "x-rated", options) : helperMissing.call(depth0, "ifCond", (depth0 && depth0.rating), "x-rated", options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "  data-track=\"settings:personalization:x-rated\"/> X-rated Interests</label>\n                <p class=\"info interest-info\">Selecting this option allows you to select X-rated interests. In addition, your profile and interaction is limited <span class=\"strictly\">strictly</span> to other X-rated users.</p>\n            </div>\n        </div>\n        <div class=\"form-group\">\n            <label class=\"col-xs-2 control-label\">Blocked Domains:</label>\n            <div class=\"col-xs-6\">\n                <p class=\"info\">Select the domains to remove from your blocked list</p>\n                ";
  stack1 = helpers.unless.call(depth0, ((stack1 = (depth0 && depth0.blocked_domains)),stack1 == null || stack1 === false ? stack1 : stack1.length), {hash:{},inverse:self.program(9, program9, data),fn:self.program(7, program7, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n            </div>\n        </div>\n        <div class=\"form-group\">\n            <div class=\"col-xs-offset-2 col-xs-6\">\n                <div class=\"btn btn-primary save\" data-track=\"settings:personalization:save\"><i class=\"fa fa-spinner fa-spin save-spin hidden\"></i>Save Changes</div>\n            </div>\n        </div>\n    </form>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/settings/personalization":[function(require,module,exports){
module.exports=require('yiPzq7');
},{}],"../templates/settings/profile":[function(require,module,exports){
module.exports=require('4cyEb0');
},{}],"4cyEb0":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var buffer = "", stack1;
  buffer += "\n        <div class=\"row\">\n            <div class=\"alert alert-danger col-xs-8\">\n                <ul>\n                    ";
  stack1 = helpers.each.call(depth0, (depth0 && depth0._errors), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n                </ul>\n            </div>\n        </div>\n    ";
  return buffer;
  }
function program2(depth0,data) {
  
  var buffer = "";
  buffer += "<li>"
    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0))
    + "</li>";
  return buffer;
  }

function program4(depth0,data) {
  
  
  return "https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg";
  }

function program6(depth0,data) {
  
  var stack1, helper;
  if (helper = helpers.pictureUrl) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.pictureUrl); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  }

function program8(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n          <span class=\"form-control username-container\">\n            <input enabled=\"false\" class=\"dummy\" onclick=\"javascript:this.parentElement.children[1].click()\" value=\"www.stumbleupon.com/stumbler/\"/>\n            <input type=\"text\" name=\"username\" maxlength=\"16\" class=\"actual username\" onclick=\"this.setSelectionRange(0, this.value.length)\" placeholder=\"Your Username\" value=\"";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"/>\n          </span>\n        ";
  return buffer;
  }

function program10(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n            <input class=\"form-control username-container\" value=\"www.stumbleupon.com/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" disabled/>\n        ";
  return buffer;
  }

  buffer += "<div class=\"row\">\n  <form class=\"form-horizontal profile\">\n    ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._errors), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    <div class=\"verify-password-container\"></div>\n    <div class=\"form-group\">\n      <label for=\"name\" class=\"col-xs-2 control-label\">Full Name</label>\n      <div class=\"col-xs-6\">\n        <input type=\"text\" class=\"form-control name\" placeholder=\"Your Full Name\" value=\"";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"/>\n      </div>\n    </div>\n    <div class=\"form-group profile-picture\">\n      <label for=\"profile-picture\" class=\"col-xs-2 control-label\">Picture</label>\n      <div class=\"col-xs-6\">\n        <div class=\"row\">\n          <div class=\"col-xs-3 col-md-2\">\n            <img src=\"";
  stack1 = helpers.unless.call(depth0, (depth0 && depth0.pictureUrl), {hash:{},inverse:self.program(6, program6, data),fn:self.program(4, program4, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\" class=\"picture-preview\"/>\n          </div>\n          <div class=\"col-xs-5\">\n            <div class=\"btn btn-primary change-picture-container\" data-track=\"settings:profile:change-picture\">\n              <input type=\"file\" id=\"change-picture\"/>\n              <span>Change Picture</span>\n            </div>\n            <div class=\"crop-picture-container\"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"form-group\">\n      <label for=\"username\" class=\"col-xs-2 control-label\">Username <p class=\"small warning\">Can only be changed once.</p></label>\n      <div class=\"col-xs-6\">\n        ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.canChangeUsername), {hash:{},inverse:self.program(10, program10, data),fn:self.program(8, program8, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      </div>\n    </div>\n    <div class=\"form-group\">\n      <label for=\"email\" class=\"col-xs-2 control-label\">Email</label>\n      <div class=\"col-xs-6\">\n        <input type=\"email\" class=\"form-control email\" name=\"email\" placeholder=\"Your Email\" value=\"";
  if (helper = helpers.email) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.email); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"/>\n      </div>\n    </div>\n    <div class=\"form-group\">\n      <label for=\"city\" class=\"col-xs-2 control-label\">City</label>\n      <div class=\"col-xs-6\">\n        <input type=\"text\" class=\"form-control city\" name=\"city\" id=\"city\" placeholder=\"Your Current City\" value=\"";
  if (helper = helpers.city) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.city); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"/>\n      </div>\n    </div>\n    <div class=\"form-group\">\n      <label for=\"state\" class=\"col-xs-2 control-label\">State</label>\n      <div class=\"col-xs-6\">\n        <input type=\"text\" class=\"form-control state\" name=\"state\" id=\"state\" placeholder=\"Your Current State, if applicable\" value=\"";
  if (helper = helpers.state) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.state); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"/>\n      </div>\n    </div>\n    <div class=\"form-group\">\n      <label for=\"country\" class=\"col-xs-2 control-label\">Country</label>\n      <div class=\"col-xs-6\">\n        <select class=\"form-control country\">\n            <option value=\"\">Select Your Country</option>\n            <option value=\"USA\">USA</option>\n            <option value=\"UK\">UK</option>\n            <option value=\"Canada\">Canada</option>\n            <option value=\"Afghanistan\">Afghanistan</option>\n            <option value=\"Albania\">Albania</option>\n            <option value=\"Algeria\">Algeria</option>\n            <option value=\"American Samoa\">American Samoa</option>\n            <option value=\"Andorra\">Andorra</option>\n            <option value=\"Angola\">Angola</option>\n            <option value=\"Anguilla\">Anguilla</option>\n            <option value=\"Antigua and Barbuda\">Antigua and Barbuda</option>\n            <option value=\"Argentina\">Argentina</option>\n            <option value=\"Armenia\">Armenia</option>\n            <option value=\"Ascension Island\">Ascension Island</option>\n            <option value=\"Australia\">Australia</option>\n            <option value=\"Austria\">Austria</option>\n            <option value=\"Azerbaijan\">Azerbaijan</option>\n            <option value=\"Bahamas\">Bahamas</option>\n            <option value=\"Bahrain\">Bahrain</option>\n            <option value=\"Bangladesh\">Bangladesh</option>\n            <option value=\"Barbados\">Barbados</option>\n            <option value=\"Belarus\">Belarus</option>\n            <option value=\"Belgium\">Belgium</option>\n            <option value=\"Belize\">Belize</option>\n            <option value=\"Benin\">Benin</option>\n            <option value=\"Bermuda\">Bermuda</option>\n            <option value=\"Bhutan\">Bhutan</option>\n            <option value=\"Bolivia\">Bolivia</option>\n            <option value=\"Bosnia and Herzegovina\">Bosnia and Herzegovina</option>\n            <option value=\"Botswana\">Botswana</option>\n            <option value=\"Brazil\">Brazil</option>\n            <option value=\"British Indian Ocean Territory\">British Indian Ocean Territory</option>\n            <option value=\"Brunei\">Brunei</option>\n            <option value=\"Bulgaria\">Bulgaria</option>\n            <option value=\"Burkina Faso\">Burkina Faso</option>\n            <option value=\"Burma\">Burma</option>\n            <option value=\"Burundi\">Burundi</option>\n            <option value=\"Cambodia\">Cambodia</option>\n            <option value=\"Cameroon\">Cameroon</option>\n            <option value=\"Cape Verde\">Cape Verde</option>\n            <option value=\"Cayman Islands\">Cayman Islands</option>\n            <option value=\"Central African Republic\">Central African Republic</option>\n            <option value=\"Chad\">Chad</option>\n            <option value=\"Chile\">Chile</option>\n            <option value=\"China\">China</option>\n            <option value=\"Colombia\">Colombia</option>\n            <option value=\"Comoros\">Comoros</option>\n            <option value=\"Congo\">Congo</option>\n            <option value=\"Cook Islands\">Cook Islands</option>\n            <option value=\"Costa Rica\">Costa Rica</option>\n            <option value=\"Cote D Ivoire\">Cote D Ivoire</option>\n            <option value=\"Croatia\">Croatia</option>\n            <option value=\"Cuba\">Cuba</option>\n            <option value=\"Cyprus\">Cyprus</option>\n            <option value=\"Czech Republic\">Czech Republic</option>\n            <option value=\"Denmark\">Denmark</option>\n            <option value=\"Djibouti\">Djibouti</option>\n            <option value=\"Dominica\">Dominica</option>\n            <option value=\"Dominican Republic\">Dominican Republic</option>\n            <option value=\"Ecuador\">Ecuador</option>\n            <option value=\"Egypt\">Egypt</option>\n            <option value=\"El Salvador\">El Salvador</option>\n            <option value=\"Equatorial Guinea\">Equatorial Guinea</option>\n            <option value=\"Eritrea\">Eritrea</option>\n            <option value=\"Estonia\">Estonia</option>\n            <option value=\"Ethiopia\">Ethiopia</option>\n            <option value=\"Falkland Islands\">Falkland Islands</option>\n            <option value=\"Faroe Islands\">Faroe Islands</option>\n            <option value=\"Fed. States of Micronesia\">Fed. States of Micronesia</option>\n            <option value=\"Fiji\">Fiji</option>\n            <option value=\"Finland\">Finland</option>\n            <option value=\"France\">France</option>\n            <option value=\"French Guiana\">French Guiana</option>\n            <option value=\"French Polynesia\">French Polynesia</option>\n            <option value=\"Gabon\">Gabon</option>\n            <option value=\"Georgia\">Georgia</option>\n            <option value=\"Germany\">Germany</option>\n            <option value=\"Ghana\">Ghana</option>\n            <option value=\"Gibraltar\">Gibraltar</option>\n            <option value=\"Greece\">Greece</option>\n            <option value=\"Greenland\">Greenland</option>\n            <option value=\"Grenada\">Grenada</option>\n            <option value=\"Guadeloupe\">Guadeloupe</option>\n            <option value=\"Guam\">Guam</option>\n            <option value=\"Guatemala\">Guatemala</option>\n            <option value=\"Guinea\">Guinea</option>\n            <option value=\"Guinea Bissau\">Guinea Bissau</option>\n            <option value=\"Guyana\">Guyana</option>\n            <option value=\"Haiti\">Haiti</option>\n            <option value=\"Honduras\">Honduras</option>\n            <option value=\"Hong Kong\">Hong Kong</option>\n            <option value=\"Hungary\">Hungary</option>\n            <option value=\"Iceland\">Iceland</option>\n            <option value=\"India\">India</option>\n            <option value=\"Indonesia\">Indonesia</option>\n            <option value=\"Iran\">Iran</option>\n            <option value=\"Iraq\">Iraq</option>\n            <option value=\"Ireland\">Ireland</option>\n            <option value=\"Isle of Man\">Isle of Man</option>\n            <option value=\"Israel\">Israel</option>\n            <option value=\"Italy\">Italy</option>\n            <option value=\"Jamaica\">Jamaica</option>\n            <option value=\"Japan\">Japan</option>\n            <option value=\"Jordan\">Jordan</option>\n            <option value=\"Kazakhstan\">Kazakhstan</option>\n            <option value=\"Kenya\">Kenya</option>\n            <option value=\"Kiribati\">Kiribati</option>\n            <option value=\"Korea\">Korea</option>\n            <option value=\"Korea(North)\">Korea(North)</option>\n            <option value=\"Kuwait\">Kuwait</option>\n            <option value=\"Kyrgyzstan\">Kyrgyzstan</option>\n            <option value=\"Laos\">Laos</option>\n            <option value=\"Latvia\">Latvia</option>\n            <option value=\"Lebanon\">Lebanon</option>\n            <option value=\"Lesotho\">Lesotho</option>\n            <option value=\"Liberia\">Liberia</option>\n            <option value=\"Libya\">Libya</option>\n            <option value=\"Liechtenstein\">Liechtenstein</option>\n            <option value=\"Lithuania\">Lithuania</option>\n            <option value=\"Luxembourg\">Luxembourg</option>\n            <option value=\"Macau\">Macau</option>\n            <option value=\"Macedonia\">Macedonia</option>\n            <option value=\"Madagascar\">Madagascar</option>\n            <option value=\"Malawi\">Malawi</option>\n            <option value=\"Malaysia\">Malaysia</option>\n            <option value=\"Maldives\">Maldives</option>\n            <option value=\"Mali\">Mali</option>\n            <option value=\"Malta\">Malta</option>\n            <option value=\"Marshall Islands\">Marshall Islands</option>\n            <option value=\"Martinique\">Martinique</option>\n            <option value=\"Mauritius\">Mauritius</option>\n            <option value=\"Mayotte\">Mayotte</option>\n            <option value=\"Mexico\">Mexico</option>\n            <option value=\"Moldova\">Moldova</option>\n            <option value=\"Monaco\">Monaco</option>\n            <option value=\"Mongolia\">Mongolia</option>\n            <option value=\"Montenegro\">Montenegro</option>\n            <option value=\"Montserrat\">Montserrat</option>\n            <option value=\"Morocco\">Morocco</option>\n            <option value=\"Mozambique\">Mozambique</option>\n            <option value=\"Myanmar\">Myanmar</option>\n            <option value=\"Namibia\">Namibia</option>\n            <option value=\"Nauru\">Nauru</option>\n            <option value=\"Nepal\">Nepal</option>\n            <option value=\"Netherlands\">Netherlands</option>\n            <option value=\"Netherlands Antilles\">Netherlands Antilles</option>\n            <option value=\"New Caledonia\">New Caledonia</option>\n            <option value=\"New Zealand\">New Zealand</option>\n            <option value=\"Nicaragua\">Nicaragua</option>\n            <option value=\"Niger\">Niger</option>\n            <option value=\"Nigeria\">Nigeria</option>\n            <option value=\"Niue\">Niue</option>\n            <option value=\"Norfolk Island\">Norfolk Island</option>\n            <option value=\"Northern Mariana Islands\">Northern Mariana Islands</option>\n            <option value=\"Norway\">Norway</option>\n            <option value=\"Oman\">Oman</option>\n            <option value=\"Pakistan\">Pakistan</option>\n            <option value=\"Palau\">Palau</option>\n            <option value=\"Palestine\">Palestine</option>\n            <option value=\"Panama\">Panama</option>\n            <option value=\"Papua New Guinea\">Papua New Guinea</option>\n            <option value=\"Paraguay\">Paraguay</option>\n            <option value=\"Peru\">Peru</option>\n            <option value=\"Philippines\">Philippines</option>\n            <option value=\"Pitcairn\">Pitcairn</option>\n            <option value=\"Poland\">Poland</option>\n            <option value=\"Portugal\">Portugal</option>\n            <option value=\"Puerto Rico\">Puerto Rico</option>\n            <option value=\"Qatar\">Qatar</option>\n            <option value=\"Reunion\">Reunion</option>\n            <option value=\"Romania\">Romania</option>\n            <option value=\"Russia\">Russia</option>\n            <option value=\"Rwanda\">Rwanda</option>\n            <option value=\"San Marino\">San Marino</option>\n            <option value=\"Sao Tome and Principe\">Sao Tome and Principe</option>\n            <option value=\"Saudi Arabia\">Saudi Arabia</option>\n            <option value=\"Senegal\">Senegal</option>\n            <option value=\"Serbia\">Serbia</option>\n            <option value=\"Serbia and Montenegro\">Serbia and Montenegro</option>\n            <option value=\"Seychelles\">Seychelles</option>\n            <option value=\"Sierra Leone\">Sierra Leone</option>\n            <option value=\"Singapore\">Singapore</option>\n            <option value=\"Slovakia\">Slovakia</option>\n            <option value=\"Slovenia\">Slovenia</option>\n            <option value=\"Solomon Islands\">Solomon Islands</option>\n            <option value=\"Somalia\">Somalia</option>\n            <option value=\"South Africa\">South Africa</option>\n            <option value=\"South Georgia\">South Georgia</option>\n            <option value=\"Spain\">Spain</option>\n            <option value=\"Sri Lanka\">Sri Lanka</option>\n            <option value=\"St. Kitts and Nevis\">St. Kitts and Nevis</option>\n            <option value=\"St. Lucia\">St. Lucia</option>\n            <option value=\"St. Pierre and Miquelon\">St. Pierre and Miquelon</option>\n            <option value=\"St. Vincent and Grenadines\">St. Vincent and Grenadines</option>\n            <option value=\"Sudan\">Sudan</option>\n            <option value=\"Suriname\">Suriname</option>\n            <option value=\"Swaziland\">Swaziland</option>\n            <option value=\"Sweden\">Sweden</option>\n            <option value=\"Switzerland\">Switzerland</option>\n            <option value=\"Syria\">Syria</option>\n            <option value=\"Taiwan\">Taiwan</option>\n            <option value=\"Tajikistan\">Tajikistan</option>\n            <option value=\"Tanzania\">Tanzania</option>\n            <option value=\"Thailand\">Thailand</option>\n            <option value=\"The Gambia\">The Gambia</option>\n            <option value=\"Togo\">Togo</option>\n            <option value=\"Tokelau\">Tokelau</option>\n            <option value=\"Tonga\">Tonga</option>\n            <option value=\"Trinidad and Tobago\">Trinidad and Tobago</option>\n            <option value=\"Tunisia\">Tunisia</option>\n            <option value=\"Turkey\">Turkey</option>\n            <option value=\"Turkmenistan\">Turkmenistan</option>\n            <option value=\"Turks and Caicos Islands\">Turks and Caicos Islands</option>\n            <option value=\"Tuvalu\">Tuvalu</option>\n            <option value=\"Uganda\">Uganda</option>\n            <option value=\"Ukraine\">Ukraine</option>\n            <option value=\"United Arab Emirates\">United Arab Emirates</option>\n            <option value=\"Uruguay\">Uruguay</option>\n            <option value=\"Uzbekistan\">Uzbekistan</option>\n            <option value=\"Vanuatu\">Vanuatu</option>\n            <option value=\"Venezuela\">Venezuela</option>\n            <option value=\"Vietnam\">Vietnam</option>\n            <option value=\"Virgin Islands (U.K.)\">Virgin Islands (U.K.)</option>\n            <option value=\"Virgin Islands (U.S.)\">Virgin Islands (U.S.)</option>\n            <option value=\"Wallis and Futuna Islands\">Wallis and Futuna Islands</option>\n            <option value=\"Western Samoa\">Western Samoa</option>\n            <option value=\"Yemen\">Yemen</option>\n            <option value=\"Yugoslavia\">Yugoslavia</option>\n            <option value=\"Zaire\">Zaire</option>\n            <option value=\"Zambia\">Zambia</option>\n            <option value=\"Zimbabwe\">Zimbabwe</option>\n        </select>\n      </div>\n    </div>\n    <div class=\"form-group\">\n      <label class=\"col-xs-2 control-label\">TimeZone</label>\n      <div class=\"col-xs-6\">\n        <select class=\"form-control timezone\">\n            <option value=\"\">Select Your TimeZone</option>\n            <option value=\"Pacific/Kwajalein\">- 12:00 IDLW (Pacific/Kwajalein)</option>\n            <option value=\"Pacific/Midway\">- 11:00 NT (Pacific/Midway)</option>\n            <option value=\"Pacific/Honolulu\">- 10:00 HAST (Pacific/Honolulu)</option>\n            <option value=\"America/Anchorage\">- 09:00 AKSTAKDT (America/Anchorage)</option>\n            <option value=\"GMT-9\">- 09:00 AKST (GMT-9)</option>\n            <option value=\"PST8PDT\">- 08:00 PSTPDT (PST8PDT)</option>\n            <option value=\"MST\">- 07:00 MST (MST)</option>\n            <option value=\"MST7MDT\">- 07:00 MSTMDT (MST7MDT)</option>\n            <option value=\"CST6CDT\">- 06:00 CSTCDT (CST6CDT)</option>\n            <option value=\"EST\">- 05:00 EST (EST)</option>\n            <option value=\"EST5EDT\">- 05:00 ESTEDT (EST5EDT)</option>\n            <option value=\"America/Santiago\">- 04:00 ASTADT (America/Santiago)</option>\n            <option value=\"America/Caracas\">- 04:00 AST (America/Caracas)</option>\n            <option value=\"Canada/Newfoundland\">- 03:30 NST (Canada/Newfoundland)</option>\n            <option value=\"America/Godthab\">- 03:00 GSTGDT (America/Godthab)</option>\n            <option value=\"America/Guyana\">- 03:00 GST (America/Guyana)</option>\n            <option value=\"Atlantic/Azores\">- 01:00 WAT (Atlantic/Azores)</option>\n            <option value=\"GMT\">+ 00:00 GMT (GMT)</option>\n            <option value=\"WET\">+ 00:00 WET (WET)</option>\n            <option value=\"CET\">+ 01:00 CET (CET)</option>\n            <option value=\"Israel\">+ 02:00 EET (Israel)</option>\n            <option value=\"Asia/Baghdad\">+ 03:00 BT (Asia/Baghdad)</option>\n            <option value=\"Iran\">+ 03:30 IT (Iran)</option>\n            <option value=\"Asia/Tbilisi\">+ 04:00 ZP4 (Asia/Tbilisi)</option>\n            <option value=\"Asia/Karachi\">+ 05:00 ZP5 (Asia/Karachi)</option>\n            <option value=\"Asia/Calcutta\">+ 05:30 IST (Asia/Calcutta)</option>\n            <option value=\"Asia/Dhaka\">+ 06:00 ZP6 (Asia/Dhaka)</option>\n            <option value=\"Asia/Bangkok\">+ 07:00 ZP7 (Asia/Bangkok)</option>\n            <option value=\"Australia/West\">+ 08:00 CCT (Australia/West)</option>\n            <option value=\"Japan\">+ 09:00 JST (Japan)</option>\n            <option value=\"Australia/South\">+ 09:30 ACST (Australia/South)</option>\n            <option value=\"Australia/NSW\">+ 10:00 AEST (Australia/NSW)</option>\n            <option value=\"Australia/LHI\">+ 10:30 LHI (Australia/LHI)</option>\n            <option value=\"Pacific/Ponape\">+ 11:00 MAGS (Pacific/Ponape)</option>\n            <option value=\"Pacific/Norfolk\">+ 11:30 NRFK (Pacific/Norfolk)</option>\n            <option value=\"NZ\">+ 12:00 NZ (NZ)</option>\n        </select>\n      </div>\n    </div>\n    <div class=\"form-group\">\n      <div class=\"col-xs-offset-2 col-xs-6\">\n        <div class=\"btn btn-primary save\" data-track=\"settings:profile:save\"><i class=\"fa fa-spinner fa-spin save-spin hidden\"></i>Save Changes</div>\n      </div>\n    </div>\n  </form>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"C38HGo":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"verify-password-container\">\n    <div class=\"title\">Save Your Changes</div>\n    <div class=\"sub-title\">To save the changes please enter your StumbleUpon Password.</div>\n    <div class=\"invalid-update\"></div>\n    <form class=\"main-form form-horizontal\" onsubmit=\"return false\">\n        <div class=\"form-group password-group has-feedback\">\n            <label class=\"col-xs-4 control-label\">Confirm Password</label>\n            <div class=\"col-xs-8\">\n                <input class=\"form-control\" id=\"password\" type=\"password\" name=\"password\" maxlength=\"16\" />\n                <span class=\"form-control-feedback\" id=\"password-feedback\"></span>\n            </div>\n        </div>\n        <a class=\"forgot-password\" data-track=\"settings:verify-password:forgot-password\" href=\"/reset-password\" target=\"_blank\">Forgot Password?</a>\n        <div class=\"footer\">\n            <div class=\"btn btn-primary btn-sulight cancel\" data-track=\"settings:verify-password:cancel\">Cancel</div>\n            <button type=\"submit\" class=\"btn btn-primary verify-password btn-sublue\" data-track=\"settings:verify-password:save\"><i class=\"fa fa-spinner fa-spin save-spin hidden\"></i>Save Settings</button>\n        </div>\n    </form>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/settings/verify-password":[function(require,module,exports){
module.exports=require('C38HGo');
},{}],"../templates/share-social":[function(require,module,exports){
module.exports=require('bGgEdN');
},{}],"bGgEdN":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"contact-item\">\n    <div class=\"col-xs-12 enable\">\n        <div class=\"icn-source\">\n            <span class=\"fa fa-twitter\"></span>\n        </div>\n        <div class=\"name\">Twitter Timeline</div>\n\n        <div class=\"chk-container social-button\">\n            <div class=\"chk-circle text-center\" data-id=\"share-tw\" data-track=\"share-tw\">\n                <span class=\"fa fa-check\"></span>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div class=\"contact-item\">\n    <div class=\"col-xs-12 enable\">\n        <div class=\"icn-source\">\n            <span class=\"fa fa-facebook\"></span>\n        </div>\n        <div class=\"name\">Facebook Timeline</div>\n\n        <div class=\"chk-container social-button\"></div>\n        <div class=\"chk-circle text-center\" data-id=\"share-fb\" data-track=\"share-fb\">\n          <span class=\"fa fa-check\"></span>\n        </div>\n    </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"UGUm2P":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "\n<div class=\"row hidden-xs\">\n  <div class=\"col-ms-12 \">\n    <div class=\"title\">Share this Page</div>\n  </div>\n</div>\n\n<div class=\"row\">\n  <div class=\"col-xs-12 col-ms-6 invite-container\"></div>\n\n  <div class=\"hidden-xs col-ms-6\">\n    <div class=\"row\">\n      <div class=\"col-ms-12\">\n        <div class=\"message-wrapper\">\n          <textarea class=\"share-message\" data-id=\"share-message-desktop\" data-track=\"share-message-desktop\" placeholder='Check this out' tabindex=\"2\"></textarea>\n          <div class=\"share-content col-ms-7\">\n            <div class=\"share-thumb\" data-thumb=\"";
  if (helper = helpers._thumb) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumb); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" style=\"background-image:url(";
  if (helper = helpers._thumb) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumb); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + ")\"></div>\n            <div class=\"share-stats\">\n              <div class=\"share-title\">";
  if (helper = helpers._title) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n              <div class=\"share-views\"><span class=\"fa fa-eye\"></span>";
  if (helper = helpers.views) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.views); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n            </div>\n          </div>\n          <div class=\"col-ms-5 text-right share-btns\">\n            <div class=\"btn btn30 btn-nobutton cancel-btn\" data-id=\"share-cancel\" data-track=\"share-cancel\">Cancel</div>\n            <div class=\"btn btn30 btn-primary sharesend disabled\" data-id=\"share-send-desktop\" data-track=\"share-send-desktop\" tabindex=\"3\" >Send</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"visible-xs\">\n    <div class=\"input-bottom\">\n      <textarea class=\"col-xs-9 text-input share-message\" type='text' data-id='share-message' data-track='share-message' placeholder='Check this out'></textarea>\n      <div class=\"col-xs-3 panel-action disabled text-center sharesend\" data-id=\"share-send\" data-track=\"share-send\">Send</div>\n    </div>\n  </div>\n\n</div>\n\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/share":[function(require,module,exports){
module.exports=require('UGUm2P');
},{}],"../templates/stumblebar-addon":[function(require,module,exports){
module.exports=require('kSD+R2');
},{}],"kSD+R2":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"row\">\n    <div class=\"su-logo col-xs-6\"></div>\n</div>\n<div class=\"row\">\n    <div class=\"col-xs-6\">\n        <h1>Keep StumbleUpon at your fingertips.</h1>\n    </div>\n</div>\n<div class=\"row stumblebar-info\">\n    <div class=\"column right col-xs-6\">\n        <h2>Hey Stumblers,</h2>\n        <p>Due to changes in Firefox, our current toolbars will no longer work after the next version of Firefox,\n            version 57 due out November 2017. You can read more about those changes\n            <a href=\"https://blog.mozilla.org/addons/2017/02/16/the-road-to-firefox-57-compatibility-milestones/\" target=\"_blank\">here</a>.</p>\n        <p>We've been working on a new browser extension that will allow you to Stumble, Share, and Submit from anywhere, just like before, and we want you to be the first to check it out.</p>\n        <p>The StumbleBar extension allows you to discover pages from anywhere your Stumbling takes you.\n            The extension also allows you to submit pages from outside of StumbleUpon with just one click so you can collect your favorite sites on your profile.</p>\n        <a class=\"btn btn-primary btn-sublue\" id=\"install-chrome-extension-button\" href=\"https://addons.mozilla.org/en-US/firefox/addon/stumblebar-by-stumbleupon/\" target=\"_blank\">Get the Extension</a>\n    </div>\n    <div class=\"bookmark-info col-xs-3\">\n        <h2>Or, bookmark our Stumble! button</h2>\n        <a class=\"bookmarklet\" href=\"http://www.stumbleupon.com/to/stumble/go/?clientid=73cf54a33e6d6c7733e75f6ec9e7f392&amp;client_type=bookmark&amp;version=1.0\" title=\"StumbleUpon\">\n            <img src=\"http://nb9.stumbleupon.netdna-cdn.com/ccHkx997JfxJPT4YrSIlvg\" alt=\"Stumble!\">\n        </a>\n        <p>\n            Not ready to download the StumbleBar, but want easy access? Drag the button above to your browser so you can still Stumble whenever you please.\n        </p>\n    </div>\n</div>\n<div class=\"extra-info row\">\n    <div class=\"col-xs-6\">\n        <p>Please note you must uninstall any previous version of the Firefox addon before installing the new version.\n            Instructions on how to do that can be found <a href=\"http://help.stumbleupon.com/customer/portal/articles/665208-firefox#article2\" target=\"_blank\">here</a>.\n        </p>\n        <p>If you would rather use the current Firefox addon, do not update from your current version of Firefox.</p>\n        <p>\n            You can also get the StumbleBar for <a href=\"https://chrome.google.com/extensions/detail/kcahibnffhnnjcedflmchmokndkjnhpg\" target=\"_blank\">Google Chrome</a>, as well as StumbleUpon mobile applications for\n            <a href=\"http://www.stumbleupon.com/to/event/redir/?url=https://market.android.com/details?id=com.stumbleupon.android.app&source=suMobile\" target=\"_blank\">Android</a> and\n            <a href=\"http://www.stumbleupon.com/to/event/redir/?url=http://itunes.apple.com/us/app/stumbleupon/id386244833&source=suMobile\" target=\"_blank\">iOS</a>.\n            Visit our <a href=\"/downloads\" target=\"_blank\">Download Page</a> for more info.\n        </p>\n    </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"../templates/stumbler-item":[function(require,module,exports){
module.exports=require('w8x+Vh');
},{}],"w8x+Vh":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  
  return "target=\"_blank\"";
  }

function program3(depth0,data) {
  
  
  return "\n                    <span class=\"fa-stack\" title=\"Expert Stumbler\">\n                        <i class=\"fa fa-certificate fa-stack-2x\"></i>\n                        <i class=\"fa fa-check fa-stack-1x fa-inverse\"></i>\n                    </span>\n                ";
  }

  buffer += "<div class=\"stumbler-item-tile-container\">\n    <a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._openNewTab), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += " >\n        <div class=\"tile-top\" data-track=\"";
  if (helper = helpers._dataPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._dataPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + ":liker:thumb\" style=\"background-image: url('";
  if (helper = helpers._thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"></div>\n    </a>\n    <a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" data-track=\"";
  if (helper = helpers._dataPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._dataPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + ":liker:userInfo\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._openNewTab), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += ">\n        <div class=\"tile-bottom\">\n            <div class=\"username\">\n                ";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n                ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.is_expert), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n            </div>\n            <div class=\"user-likes\">"
    + escapeExpression((helper = helpers.numberFormat || (depth0 && depth0.numberFormat),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.likes_count), options) : helperMissing.call(depth0, "numberFormat", (depth0 && depth0.likes_count), options)))
    + " Likes</div>\n        </div>\n    </a>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumblers":[function(require,module,exports){
module.exports=require('kb3pIP');
},{}],"kb3pIP":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "";


  buffer += "<div class=\"stumbler-content\"></div>\n<div class=\"loading-container\"></div>\n<div class=\"pagination-container\">\n    \n</div>\n<div class=\"empty-list-container\">\n  1 or more people liked this, but they may not be visible due to their privacy settings.\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/dailymotion":[function(require,module,exports){
module.exports=require('vm4Js2');
},{}],"vm4Js2":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<iframe class=\"stumble-frame dailymotion video\" src=\"http://www.dailymotion.com/embed/video/";
  if (helper = helpers._dailymotionid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._dailymotionid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "?autoPlay=1&loadRelatedInPlace=1&utm_source=stumbleupon\" allowFullScreen></iframe>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"nS+p/4":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div id=\"fb-root\"></div>\n<script>(function(d, s, id) {\n  var js, fjs = d.getElementsByTagName(s)[0];\n  if (d.getElementById(id)) return;\n  js = d.createElement(s); js.id = id;\n  js.src = \"//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0\";\n  fjs.parentNode.insertBefore(js, fjs);\n}(document, 'script', 'facebook-jssdk'));</script>\n\n<div class=\"facebook-stumble-container\">\n  <div class=\"fb-post\" data-href=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" data-width=\"500\"></div>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/facebook":[function(require,module,exports){
module.exports=require('nS+p/4');
},{}],"../templates/stumbles/flickr":[function(require,module,exports){
module.exports=require('3BMWhH');
},{}],"3BMWhH":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<iframe class=\"flickr-frame\" src=\"https://www.flickr.com/photos/";
  if (helper = helpers._flickruser) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._flickruser); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/";
  if (helper = helpers._flickrid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._flickrid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/player/\" allowfullscreen scrolling=\"no\" frameborder=\"no\"></iframe>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/framebreak":[function(require,module,exports){
module.exports=require('dbnpZQ');
},{}],"dbnpZQ":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<iframe sandbox=\"allow-forms allow-scripts allow-same-origin\" class=\"stumble-frame\" src=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"></iframe>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"5En4+Q":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"image-viewer\">\n  <div class=\"image\" style=\"background-image: url('";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\">\n    <img class=\"image-save\" src=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" alt=\"";
  if (helper = helpers._title) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/image":[function(require,module,exports){
module.exports=require('5En4+Q');
},{}],"../templates/stumbles/instagram":[function(require,module,exports){
module.exports=require('gdZoxc');
},{}],"gdZoxc":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"instagram\">\n  <iframe src=\"//instagram.com/p/";
  if (helper = helpers._instagramid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._instagramid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/embed/\" frameborder=\"0\" scrolling=\"no\">\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"m9/vGu":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<iframe class=\"stumble-frame metacafe video\" src=\"http://www.metacafe.com/embed/";
  if (helper = helpers._metacafeid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._metacafeid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/?ap=1&utm_source=stumbleupon\" allowFullScreen frameborder=0></iframe>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/metacafe":[function(require,module,exports){
module.exports=require('m9/vGu');
},{}],"../templates/stumbles/pinterest-board":[function(require,module,exports){
module.exports=require('YTHXpB');
},{}],"YTHXpB":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"pinterest\">\n  <a data-pin-do=\"embedBoard\" href=\"http://www.pinterest.com/";
  if (helper = helpers._pinterestboardid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._pinterestboardid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "?utm_source=stumbleupon\" data-pin-scale-width=\"200\" data-pin-board-width=\"1280\" data-pin-scale-height=\"1280\"></a>\n  <script type=\"text/javascript\" src=\"//assets.pinterest.com/js/pinit.js\"></script>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/pinterest":[function(require,module,exports){
module.exports=require('BzgELe');
},{}],"BzgELe":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"pinterest\">\n  <a data-pin-do=\"embedPin\" href=\"http://www.pinterest.com/pin/";
  if (helper = helpers._pinterestid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._pinterestid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "?utm_source=stumbleupon\"></a>\n  <script type=\"text/javascript\" src=\"//assets.pinterest.com/js/pinit.js\"></script>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"btUDe3":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, self=this, functionType="function", escapeExpression=this.escapeExpression;

function program1(depth0,data) {
  
  
  return " dd-stumble-frame";
  }

  buffer += "<iframe class=\"stumble-frame";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._legacy), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\" src=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" scrolling=\"no\"></iframe>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/site-ios":[function(require,module,exports){
module.exports=require('btUDe3');
},{}],"../templates/stumbles/site-sandbox":[function(require,module,exports){
module.exports=require('gd5aiD');
},{}],"gd5aiD":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, self=this, functionType="function", escapeExpression=this.escapeExpression;

function program1(depth0,data) {
  
  
  return " dd-stumble-frame";
  }

  buffer += "<iframe sandbox=\"allow-same-origin allow-scripts allow-forms allow-popups\" class=\"stumble-frame";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._legacy), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\" src=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"></iframe>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/site":[function(require,module,exports){
module.exports=require('ekJUze');
},{}],"ekJUze":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, self=this, functionType="function", escapeExpression=this.escapeExpression;

function program1(depth0,data) {
  
  
  return " dd-stumble-frame";
  }

  buffer += "<iframe class=\"stumble-frame";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._legacy), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\" src=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"></iframe>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"NhB93R":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"soundcloud\">\n  <iframe class=\"soundcloud-frame\" scrolling=\"no\" frameborder=\"no\" src=\"https://w.soundcloud.com/player/?url=http%3A%2F%2Fapi.soundcloud.com";
  if (helper = helpers._soundcloudpath) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._soundcloudpath); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "&auto_play=true&auto_advance=true&buying=true&liking=false&download=true&sharing=false&show_artwork=true&show_comments=false&show_playcount=true&show_user=true&utm_source=stumbleupon\"></iframe>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/soundcloud":[function(require,module,exports){
module.exports=require('NhB93R');
},{}],"BpQ4rp":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"ted\">\n  <iframe src=\"//embed-ssl.ted.com/talks/";
  if (helper = helpers._tedtalkid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._tedtalkid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + ".html\" frameborder=\"0\" scrolling=\"no\" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/ted":[function(require,module,exports){
module.exports=require('BpQ4rp');
},{}],"../templates/stumbles/tweet":[function(require,module,exports){
module.exports=require('gdA3gc');
},{}],"gdA3gc":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"tweet-container embed-target\"></div>";
  });

},{"hbsfy/runtime":795}],"S4IyE7":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<iframe class=\"stumble-frame vimeo video\" src=\"//player.vimeo.com/video/";
  if (helper = helpers._vimeoid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._vimeoid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "?autoplay=1&utm_source=stumbleupon\" allowfullscreen></iframe>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/vimeo":[function(require,module,exports){
module.exports=require('S4IyE7');
},{}],"xlwKNq":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<iframe class=\"stumble-frame vine-embed\" src=\"https://vine.co/v/";
  if (helper = helpers._vineid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._vineid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "/embed/simple?audio=1\" frameborder=\"0\"></iframe>\n\n<script async src=\"//platform.vine.co/static/scripts/embed.js\" charset=\"utf-8\"></script>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/vine":[function(require,module,exports){
module.exports=require('xlwKNq');
},{}],"XEVIu8":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<iframe class=\"stumble-frame youtube video\" src=\"//www.youtube.com/embed/";
  if (helper = helpers._youtubeid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._youtubeid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "?autoplay=1&utm_source=stumbleupon&html5=1\" frameborder=\"0\" allowfullscreen></iframe>\n\n\n<div class=\"youtube-hidetop\"></div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/stumbles/youtube":[function(require,module,exports){
module.exports=require('XEVIu8');
},{}],"89VASx":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;


  buffer += "<div class=\"container-fluid\">\n  <div class=\"row plain-gray\">\n    <div class=\"gutter col-xs-1\"></div>\n    <div class=\"col-xs-10\">\n      <div class=\"header-image\"></div>\n      <div class=\"header-text\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "BADGE_HEADER_TEXT", options) : helperMissing.call(depth0, "i18n", "BADGE_HEADER_TEXT", options)))
    + "</div>\n      <div id=\"url-view-container\" class=\"url-view-container\"></div>\n    </div>\n    <div class=\"gutter col-xs-1\"></div>\n  </div>\n  <div class=\"row gradient-white classification\">\n    <div class=\"gutter col-xs-1\"></div>\n    <div class=\"col-xs-10\">\n      <div class=\"prompt\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "WHAT_IS_THIS_PAGE_ABOUT", options) : helperMissing.call(depth0, "i18n", "WHAT_IS_THIS_PAGE_ABOUT", options)))
    + "</div>\n      <div id=\"new-interests-view-container\" class=\"new-interests-view-container\">\n        <div id=\"interest-search-input-container\" class=\"autofilter-container input-container\"></div>\n      </div>\n      <div class=\"loading suggested-interests-loading\">\n        "
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "LOADING_INTERESTS", options) : helperMissing.call(depth0, "i18n", "LOADING_INTERESTS", options)))
    + "\n        <div class=\"spinner-bar\"><div class=\"spinner-bar-spinner\"></div></div>\n      </div>\n      <div id=\"suggested-interests-view-container\" class=\"suggested-interests-view-container\"></div>\n      <div class=\"prompt\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TAG_THIS_PAGE", options) : helperMissing.call(depth0, "i18n", "TAG_THIS_PAGE", options)))
    + "</div>\n      <div id=\"new-tags-view-container\" class=\"new-interests-view-container\">\n        <div id=\"tag-search-input-container\" class=\"autofilter-container input-container\"></div>\n      </div>\n      <div id=\"suggested-tags-view-container\" class=\"suggested-interests-view-container\"></div>\n      <div id=\"action-buttons-view-container\" class=\"action-buttons-view-container\"></div>\n    </div>\n    <div class=\"gutter col-xs-1\"></div>\n  </div>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/submit/badge":[function(require,module,exports){
module.exports=require('89VASx');
},{}],"LF3J/5":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"interests-container two-column\"></div>";
  });

},{"hbsfy/runtime":795}],"../templates/submit/category-selection":[function(require,module,exports){
module.exports=require('LF3J/5');
},{}],"K+Jvgp":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;


  buffer += "<div class=\"container-fluid\">\n  <div class=\"row plain-gray\">\n    <div class=\"gutter col-xs-1\"></div>\n    <div class=\"col-xs-10\">\n      <div class=\"header-image\"></div>\n      <div class=\"header-text\">";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n      <div id=\"url-view-container\" class=\"url-view-container\"></div>\n    </div>\n    <div class=\"gutter col-xs-1\"></div>\n  </div>\n  <div class=\"row gradient-white classification\">\n    <div class=\"gutter col-xs-1\"></div>\n    <div class=\"col-xs-10\">\n      <div class=\"prompt\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "ADDED_TO_YOUR_LIKES", options) : helperMissing.call(depth0, "i18n", "ADDED_TO_YOUR_LIKES", options)))
    + "</div>\n      <div id=\"action-buttons-view-container\" class=\"action-buttons-view-container\"></div>\n    </div>\n    <div class=\"gutter col-xs-1\"></div>\n  </div>\n  <div class=\"row gradient-white rc-announcement\">\n    <div class=\"gutter col-xs-1\"></div>\n    <div class=\"col-xs-10\">\n      <div class=\"title\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TRANSITION_TITLE", options) : helperMissing.call(depth0, "i18n", "TRANSITION_TITLE", options)))
    + "</div>\n      <div class=\"mix-logo\"></div>\n      <div class=\"description\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TRANSITION_DESCRIPTION", options) : helperMissing.call(depth0, "i18n", "TRANSITION_DESCRIPTION", options)))
    + "</div>\n    </div>\n    <div class=\"mix-onboard-button-container\">\n      <div class=\"mix-onboard-button btn-mix btn-mix-primary\"\n         id=\"mix-onboard-button\"\n         data-track=\"badge:mix-onboard\">\n         <span class=\"connect-text\">Join Mix</span>\n      </div>\n      <a class=\"learn-more-link\" id=\"mix-learn-more-button\" target=\"_blank\"\n         href=\"https://mix.com/learn-more\" data-track=\"badge:learn-more\">\n         Learn More\n      </a>\n      <div class=\"footnote\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TRANSITION_FOOTNOTE", options) : helperMissing.call(depth0, "i18n", "TRANSITION_FOOTNOTE", options)))
    + "<a href=\"https://mix.com/tos\" target=\"_blank\">Mix Terms of Service</a>.</div>\n    </div>\n    <div class=\"gutter col-xs-1\"></div>\n  </div>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/submit/like-confirmation":[function(require,module,exports){
module.exports=require('K+Jvgp');
},{}],"QssV0E":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;


  buffer += "<div class=\"container-fluid\">\n  <div class=\"row plain-gray\">\n    <div class=\"gutter col-xs-1\"></div>\n    <div class=\"col-xs-10\">\n      <div class=\"header-image\"></div>\n      <div class=\"header-text\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "BADGE_HEADER_TEXT", options) : helperMissing.call(depth0, "i18n", "BADGE_HEADER_TEXT", options)))
    + "</div>\n      <div id=\"url-view-container\" class=\"url-view-container\"></div>\n    </div>\n    <div class=\"gutter col-xs-1\"></div>\n  </div>\n  <div class=\"row gradient-white classification\">\n    <div class=\"gutter col-xs-1\"></div>\n    <div class=\"col-xs-10\">\n      <div class=\"prompt\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "WHAT_IS_THIS_PAGE_ABOUT", options) : helperMissing.call(depth0, "i18n", "WHAT_IS_THIS_PAGE_ABOUT", options)))
    + "</div>\n      <div id=\"new-interests-view-container\" class=\"new-interests-view-container\">\n        <div id=\"interest-search-input-container\" class=\"autofilter-container input-container\"></div>\n      </div>\n      <div id=\"suggested-interests-view-container\" class=\"suggested-interests-view-container\"></div>\n      <div class=\"prompt\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TAG_THIS_PAGE", options) : helperMissing.call(depth0, "i18n", "TAG_THIS_PAGE", options)))
    + "</div>\n      <div id=\"new-tags-view-container\" class=\"new-interests-view-container\">\n        <div id=\"tag-search-input-container\" class=\"autofilter-container input-container\"></div>\n      </div>\n      <div id=\"suggested-tags-view-container\" class=\"suggested-interests-view-container\"></div>\n      <div id=\"action-buttons-view-container\" class=\"action-buttons-view-container\"></div>\n    </div>\n    <div class=\"gutter col-xs-1\"></div>\n  </div>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/submit/submit":[function(require,module,exports){
module.exports=require('QssV0E');
},{}],"zPE/Ad":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, self=this, functionType="function", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  
  return " disabled";
  }

  buffer += "<form>\n  <div class=\"url\">\n    <input required type=\"text\"";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._locked), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += " name=\"url\" autofocus=\"true\" placeholder=\"http://\" value=\"";
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n  </div>\n  <div class=\"nsfw\">\n    <span class=\"prompt nsfw_prompt\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "SAFE_FOR_WORK", options) : helperMissing.call(depth0, "i18n", "SAFE_FOR_WORK", options)))
    + "</span>\n    <input required type=\"radio\" name=\"nsfw\" id=\"safe-for-work\" value=\"no\"><label for=\"safe-for-work\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "YES", options) : helperMissing.call(depth0, "i18n", "YES", options)))
    + "</label>\n    <input required type=\"radio\" name=\"nsfw\" id=\"not-safe-for-work\" value=\"yes\"><label for=\"not-safe-for-work\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "NO", options) : helperMissing.call(depth0, "i18n", "NO", options)))
    + "</label>\n  </div>\n</form>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/submit/url":[function(require,module,exports){
module.exports=require('zPE/Ad');
},{}],"ibXKH5":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += " style=\"background-image: url('";
  if (helper = helpers._thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"";
  return buffer;
  }

function program3(depth0,data) {
  
  
  return "<span class=\"fa fa-picture-o\"></span>";
  }

  buffer += " <div class=\"thumbnail-bg\"\n";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._thumbnail), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += ">";
  stack1 = (helper = helpers.without || (depth0 && depth0.without),options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data},helper ? helper.call(depth0, (depth0 && depth0._thumbnail), options) : helperMissing.call(depth0, "without", (depth0 && depth0._thumbnail), options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/thumbnail":[function(require,module,exports){
module.exports=require('ibXKH5');
},{}],"../templates/toolbar/static-toolbar":[function(require,module,exports){
module.exports=require('nTShuv');
},{}],"nTShuv":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"static-toolbar-container\">\n    <div class=\"inner-container\">\n        <div class=\"row\">\n            <div class=\"col-xs-4 col-md-5\">\n                <div class=\"button stumble noscript\">\n                    <div class=\"icon stumble\" data-touchclick=\"true\" data-track=\"static:stumble\">\n                        <div class=\"loader\"></div>\n                        <div class=\"text\">\n                            Stumble\n                        </div>\n                    </div>\n                </div>\n                <div class=\"visible-md visible-lg text-left discover-text\">to discover the best of the web.</div>\n            </div>\n\n            <div class=\"col-xs-8 col-md-7 text-right\">\n            </div>\n        </div>\n    </div>\n</div>\n";
  });

},{"hbsfy/runtime":795}],"JW/nJo":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType="function", self=this;

function program1(depth0,data) {
  
  
  return "loading";
  }

function program3(depth0,data) {
  
  
  return "\n                    <div class=\"button-tutorial-container stumble-info tutorial\">\n                        <div class=\"up-arrow\"></div>\n                        <div class=\"button-name\">Stumble Button</div>\n                        <div class=\"button-info\">Hit Stumble and we'll show you great websites based on your interests.</div>\n                    </div>\n                ";
  }

function program5(depth0,data) {
  
  
  return "\n                    <div class=\"button-tutorial-container thumb-up-info tutorial\">\n                        <div class=\"side-up-arrow\"></div>\n                        <div class=\"button-name\">Thumb Up</div>\n                        <div class=\"button-info\">Thumb Up or \"Like\" saves the page to your profile and improves your recommendations</div>\n                    </div>\n                ";
  }

function program7(depth0,data) {
  
  
  return "\n                    <div class=\"got-it-tutorial-container button-tutorial-container tutorial\">\n                        <span class=\"better-design\"><span class=\"improved-text better-design\">Welcome to the Improved StumbleUpon, with </span>Modern Design, Better Navigation, Simplified Sharing and Profile</span>\n                        <span class=\"button got-it\" data-track=\"tutorial:got-it\">Got It!</span>\n                    </div>\n                ";
  }

function program9(depth0,data) {
  
  var buffer = "", helper, options;
  buffer += "\n                    <a href=\"http://ads.stumbleupon.com/\" class=\"sponsored noscript\" target=\"_blank\" data-id=\"sponsored\" data-track=\"sponsored\">\n                        <div class=\"sponsored-text\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "SPONSORED", options) : helperMissing.call(depth0, "i18n", "SPONSORED", options)))
    + "</div>\n                    </a>\n                ";
  return buffer;
  }

function program11(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                    <a class=\"hidden-xs\" href=\"/content/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" data-track=\"toolbar-likers\">\n                        <div class=\"likers-toolbar-view\"></div>\n                    </a>\n                ";
  return buffer;
  }

function program13(depth0,data) {
  
  
  return "\n                    <div class=\"button-tutorial-container profile-info tutorial\">\n                        <div class=\"up-arrow\"></div>\n                        <div class=\"button-name\">Your Profile</div>\n                        <div class=\"button-info\">Find your Likes, Lists, and Friends all in your personal Profile.</div>\n                    </div>\n                ";
  }

function program15(depth0,data) {
  
  
  return "\n    <div class=\"toolbar-tutorial-background tutorial\"></div>\n";
  }

  buffer += "<div class=\"mix-toolbar-banner\">\n  <div class=\"rc-invite-container\">\n    <div class=\"mix-onboard-message\">\n      <div class=\"title\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TRANSITION_TITLE", options) : helperMissing.call(depth0, "i18n", "TRANSITION_TITLE", options)))
    + "</div>\n      <div class=\"description\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TRANSITION_DESCRIPTION", options) : helperMissing.call(depth0, "i18n", "TRANSITION_DESCRIPTION", options)))
    + "</div>\n    </div>\n    <div class=\"mix-onboard-button-container\">\n      <div class=\" btn-mix btn-mix-primary\"\n         id=\"mix-onboard-button\"\n         data-track=\"banner:mix-onboard\">\n         <span class=\"connect-text\">Join Mix</span>\n      </div>\n      <a class=\"learn-more-link\" id=\"mix-learn-more-button\"\n         href=\"https://mix.com/learn-more\" data-track=\"banner:learn-more\">\n         Learn More\n      </a>\n      <div class=\"footnote\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "TRANSITION_FOOTNOTE", options) : helperMissing.call(depth0, "i18n", "TRANSITION_FOOTNOTE", options)))
    + "<a href=\"https://mix.com/tos\">Mix Terms of Service</a>.</div>\n    </div>\n  </div>\n  <div class=\"mix-branding\"></div>\n</div>\n<div class=\"inner-container wrapper\">\n    <div class=\"toolbar-tutorial\">\n        <div class=\"inner-container\">\n            <div class=\"toolbar-left\">\n                <a class=\"button stumble noscript\" data-id=\"stumble\" data-track=\"stumble\" href=\"http://www.stumbleupon.com/to/stumble/go/?clientid=4544d41498a10a385d3e4a8a43dfc6b1&client_type=bookmark&version=1.0\">\n                    <div class=\"icon stumble ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.url), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\" data-touchclick=\"true\">\n                        <div class=\"loader\"></div>\n                        <div class=\"text\">\n                            Stumble\n                        </div>\n                    </div>\n                </a>\n                ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._tutorial), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n                <div class=\"button up hidden-xs\" data-touchclick=\"true\" data-id=\"thumbup\" data-track=\"thumbup\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\""
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "LIKE_PAGES", options) : helperMissing.call(depth0, "i18n", "LIKE_PAGES", options)))
    + "\">\n                    <span class=\"fa fa-thumbs-up\"></span>\n                </div>\n                ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._tutorial), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n                <div class=\"pull-left\">\n                    <div class=\"button share\" data-id=\"share\" data-track=\"share\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\""
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "SHARE_TO_ANYONE", options) : helperMissing.call(depth0, "i18n", "SHARE_TO_ANYONE", options)))
    + "\">\n                        <span class=\"fa fa-share-alt share-icn\"></span>\n                        <div class=\"text visible-md visible-lg\">Share</div>\n                    </div>\n                    <div id=\"dropdown-share-container\" class=\"dropdown-container\"></div>\n                </div>\n                <a class=\"button addtolist noscript\" data-id=\"addtolist\" data-track=\"addtolist\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\""
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "CLICK_ADD_TO_LIST", options) : helperMissing.call(depth0, "i18n", "CLICK_ADD_TO_LIST", options)))
    + "\" href=\"javascript:void((function(d)%7Bvar%20e%3Dd.createElement(%27script%27)%3Be.setAttribute(%27type%27,%27text/javascript%27)%3Be.setAttribute(%27charset%27,%27UTF-8%27)%3Be.setAttribute(%27src%27,%27https://www.stumbleupon.com/bookmarkletclient/bookmarklet.js%3Fr%3D%27%2BMath.random())%3Bd.body.appendChild(e)%7D)(document))%3B\">\n                    <span class=\"add-to-list-icon\"><span style=\"display: none\">"
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "ADD_TO_LIST", options) : helperMissing.call(depth0, "i18n", "ADD_TO_LIST", options)))
    + "</span></span>\n                </a>\n                <div class=\"pull-left\">\n                    <div class=\"button down hidden-xs\" data-touchclick=\"true\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\""
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "DISLIKE_PAGES", options) : helperMissing.call(depth0, "i18n", "DISLIKE_PAGES", options)))
    + "\">\n                        <span class=\"fa fa-thumbs-down down\" data-id=\"thumbdown\" data-track=\"thumbdown\"></span>\n                        <span class=\"fa fa-angle-down down-options\" data-id=\"thumbdownoptions\" data-track=\"thumbdownoptions\"></span>\n                    </div>\n                    <div id=\"dropdown-thumbdown-container\" class=\"dropdown-container\"></div>\n                </div>\n                <div class=\"button info\" data-id=\"interests\" data-track=\"interests\" data-touchclick=\"true\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\""
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "STUMBLE_INTEREST", options) : helperMissing.call(depth0, "i18n", "STUMBLE_INTEREST", options)))
    + "\">\n                    <div class=\"mode\">"
    + escapeExpression((helper = helpers.currentMode || (depth0 && depth0.currentMode),options={hash:{},data:data},helper ? helper.call(depth0, "name", options) : helperMissing.call(depth0, "currentMode", "name", options)))
    + "</div>\n                    <span class=\"fa fa-angle-down\"></span>\n                </div>\n                ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._tutorial), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n            </div>\n\n            <div class=\"toolbar-right\">\n                ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.sponsored), {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n                ";
  stack1 = (helper = helpers.isGreater || (depth0 && depth0.isGreater),options={hash:{},inverse:self.noop,fn:self.program(11, program11, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.likes), 0, options) : helperMissing.call(depth0, "isGreater", (depth0 && depth0.likes), 0, options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n                <div class=\"pull-right\">\n                    <div class=\"button menu\" data-touchclick=\"true\" data-id=\"menu\" data-track=\"menu\" data-toggle=\"tooltip\" data-placement=\"bottom\" title=\""
    + escapeExpression((helper = helpers.i18n || (depth0 && depth0.i18n),options={hash:{},data:data},helper ? helper.call(depth0, "MENU_HINT", options) : helperMissing.call(depth0, "i18n", "MENU_HINT", options)))
    + "\">\n                        <img class=\"profile-thumb\" src=\""
    + escapeExpression((helper = helpers.currentUser || (depth0 && depth0.currentUser),options={hash:{},data:data},helper ? helper.call(depth0, "picture_small", options) : helperMissing.call(depth0, "currentUser", "picture_small", options)))
    + "\"/>\n                        <div class=\"menu-notification\"></div>\n                        <div class=\"username\">"
    + escapeExpression((helper = helpers.currentUser || (depth0 && depth0.currentUser),options={hash:{},data:data},helper ? helper.call(depth0, "username", options) : helperMissing.call(depth0, "currentUser", "username", options)))
    + "</div>\n                        <span class=\"fa fa-angle-down\"></span>\n                    </div>\n                    <div id=\"dropdown-menu-container\" class=\"dropdown-container\"></div>\n                </div>\n                ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._tutorial), {hash:{},inverse:self.noop,fn:self.program(13, program13, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n            </div>\n        </div>\n    </div>\n</div>\n";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._tutorial), {hash:{},inverse:self.noop,fn:self.program(15, program15, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/toolbar/toolbar":[function(require,module,exports){
module.exports=require('JW/nJo');
},{}],"cSFr39":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  
  return "loading";
  }

function program3(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                        <a href=\"/content/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" data-track=\"visitor:toolbar-likers\">\n                            <div class=\"likers-toolbar-view\"></div>\n                        </a>\n                    ";
  return buffer;
  }

  buffer += "<div class=\"vtb-container\">\n    <div class=\"inner-container\">\n        <div class=\"row\">\n            <div class=\"col-xs-4 col-md-5\">\n                <div class=\"button stumble noscript\">\n                    <div class=\"icon stumble ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.url), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\" data-touchclick=\"true\" data-track=\"visitor:stumble\">\n                        <div class=\"loader\"></div>\n                        <div class=\"text\">\n                            Stumble\n                        </div>\n                    </div>\n                </div>\n                <div class=\"visible-md visible-lg text-left discover-text\">to discover the best of the web.</div>\n            </div>\n\n            <div class=\"col-xs-8 col-md-7 text-right\">\n                <div class=\"pull-right\">\n                    <div class=\"fb-connect\" data-track=\"visitor:facebook-connect\">\n                        <span class=\"fa fa-facebook\"></span>\n                        <span class=\"connect-text hidden-xs hidden-ms hidden-sm\">Connect with Facebook</span>\n                        <span class=\"connect-text hidden-md hidden-lg\">Connect</span>\n                    </div>\n                    <div class=\"get-app-btn button hidden\" data-touchclick=\"true\" data-track=\"visitor:get-app\"><i class=\"fa fa-spinner fa-spin get-app-spin hidden\"></i> Get App</div>\n                </div>\n                <span class=\"visible-md visible-lg pull-right join-free-text\"> Join for free:</span>\n                <div class=\"visitor-likers pull-right\">\n                    ";
  stack1 = (helper = helpers.isGreater || (depth0 && depth0.isGreater),options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.likes), 0, options) : helperMissing.call(depth0, "isGreater", (depth0 && depth0.likes), 0, options));
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/toolbar/visitor-toolbar":[function(require,module,exports){
module.exports=require('cSFr39');
},{}],"../templates/url-heading":[function(require,module,exports){
module.exports=require('jMtiWN');
},{}],"jMtiWN":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var buffer = "";
  buffer += "\n            <div class=\"action-btns hidden-xs text-right\">\n                <div class=\"following-container\"></div>\n            </div>\n        ";
  return buffer;
  }

  buffer += "<div class=\"heading-wrapper\">\n  <div class=\"row align-to-content\">\n    <div class=\"col-xs-7\">\n      <span class=\"description\">\n        Recommended from ";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n      </span>\n    </div>\n    <div class=\"col-xs-5 text-right\">\n        ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0._canFollow), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n        <button class=\"btn btn-suorange stumble-interest-btn hidden-xs\" data-id=\"stumble-interest-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "url:stumble-interest\">\n            Stumble ";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n        </button>\n    </div>\n  </div>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/url-info-identity":[function(require,module,exports){
module.exports=require('gR/Mei');
},{}],"gR/Mei":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  
  return "\n            <span class=\"fa-stack\" title=\"Expert Stumbler\">\n                <i class=\"fa fa-certificate fa-stack-2x\"></i>\n                <i class=\"fa fa-check fa-stack-1x fa-inverse\"></i>\n            </span>\n        ";
  }

  buffer += "<a href=\"/stumbler/";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n    <div class=\"discovered-by\">Discovered by:</div>\n    <div class=\"user-thumb\" style=\"background-image:url('";
  if (helper = helpers._thumbnail) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumbnail); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"></div>\n    <div class=\"username\">\n        ";
  if (helper = helpers.username) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.username); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n        ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.is_expert), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n    </div>\n    <div class=\"name\">";
  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n</a>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"3++Z21":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, blockHelperMissing=helpers.blockHelperMissing, helperMissing=helpers.helperMissing;

function program1(depth0,data) {
  
  
  return " suteam";
  }

function program3(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n                    <div class=\"suteam fa fa-stumbleupon dropdown-container\">\n                        <div class=\"admin-actions action-dropdown dropdown-menu\">\n                            <a class=\"dropdown-item\" target=\"_blank\" href=\"http://www.stumbleupon.com/dump/dump.php?url=";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">Url Dump</a>\n                            <a class=\"dropdown-item\" target=\"_blank\" href=\"http://www.stumbleupon.com/thumb/pid/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "?_notoolbar=true\">View Thumbs</a>\n                            <a class=\"dropdown-item\" target=\"_blank\" href=\"http://www.stumbleupon.com/suteam/urladmin/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "?_notoolbar=true\" id=\"admin-panel-toggle\">Admin Panel</a>\n                            <a class=\"dropdown-item\" target=\"_blank\" href=\"http://www.stumbleupon.com/thumb/enqueue/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "?_notoolbar=true\">Enqueue New Thumb</a>\n                            <a class=\"dropdown-item\" href=\"#\" id=\"requeue-for-surveyor\">Requeue For Surveying</a>\n                        </div>\n                    </div>\n                    ";
  return buffer;
  }

  buffer += "<div class=\"url-info-inner\">\n    <div id=\"url-info-header-container\">\n        <div class=\"url-info-header-view\">\n            <div class=\"row\">\n                <div class=\"url-details col-xs-9";
  options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data}
  if (helper = helpers.isSuteamSession) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.isSuteamSession); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.isSuteamSession) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n                    <a href=\"";
  if (helper = helpers._route) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._route); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n                        <div class=\"thumb\" data-track=\"urlInfo:url-thumb\" style=\"background-image:url('";
  if (helper = helpers._thumb) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._thumb); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"></div>\n                    </a>\n                    ";
  options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data}
  if (helper = helpers.isSuteamSession) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.isSuteamSession); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.isSuteamSession) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n                    <div class=\"title\" data-track=\"urlInfo:title\">\n                        <a href=\"";
  if (helper = helpers._route) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._route); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">";
  if (helper = helpers._title) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</a>\n                    </div>\n                    <div class=\"actions hidden-xs hidden-ms\">\n                        <a class=\"interest\" href=\"/interest/";
  if (helper = helpers._interestslug) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._interestslug); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" data-track=\"urlInfo:interest\">";
  if (helper = helpers._interest) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._interest); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</a>\n                        <a class=\"domain\" href=\"http://";
  if (helper = helpers._domain) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._domain); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" target=\"_blank\" data-track=\"urlInfo:domain\">";
  if (helper = helpers._domain) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._domain); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</a>\n                        <span class=\"report btn btn-sublue\" data-track=\"urlInfo:report\">Report</span>\n                    </div>\n                    <div class=\"stats\">\n                        <span class=\"likes\">"
    + escapeExpression((helper = helpers.numberFormatCommas || (depth0 && depth0.numberFormatCommas),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.likes), options) : helperMissing.call(depth0, "numberFormatCommas", (depth0 && depth0.likes), options)))
    + " Likes</span>\n                        <span class=\"views\">"
    + escapeExpression((helper = helpers.numberFormatCommas || (depth0 && depth0.numberFormatCommas),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.views), options) : helperMissing.call(depth0, "numberFormatCommas", (depth0 && depth0.views), options)))
    + " Stumbles</span>\n                    </div>\n                </div>\n                <div id=\"url-info-identity\" data-track=\"urlInfo:identity\" class=\"col-xs-3 hidden-xs hidden-ms hidden-sm\"></div>\n            </div>\n        </div>\n    </div>\n    <div id=\"stumblers-container\"></div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/url-info":[function(require,module,exports){
module.exports=require('3++Z21');
},{}],"../templates/url-list":[function(require,module,exports){
module.exports=require('791uzM');
},{}],"791uzM":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "";


  buffer += "<div class=\"list-heading heading-container\"></div>\n<div class=\"list-content\"></div>\n<div class=\"loading-container\"></div>\n<div class=\"empty-list-container\">\n  <span class=\"add-to-list-icon list-bookmark\"></span>\n  <p>There are no pages in this list.</p>\n</div>\n<div class=\"pagination-container\">\n\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/url-tile":[function(require,module,exports){
module.exports=require('v+GOEy');
},{}],"v+GOEy":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, options, functionType="function", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing, blockHelperMissing=helpers.blockHelperMissing;

function program1(depth0,data) {
  
  var stack1, helper;
  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  }

function program3(depth0,data) {
  
  var stack1, helper;
  if (helper = helpers.url) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.url); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  return escapeExpression(stack1);
  }

function program5(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += "\n  <div>\n      <div class=\"item-actions\">\n          <div class=\"main-buttons btn-group\">\n\n              <button class=\"btn\" data-id=\"item-share-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "url-tile:item-share-btn\">\n                  <i class=\"fa fa-share-alt\"></i>\n              </button>\n              <button class=\"btn\" data-id=\"item-add-btn\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "url-tile:item-add-btn\">\n                  <i class=\"add-to-list-icon\"></i>\n              </button>\n          </div>\n\n      </div>\n      <div class=\"addtolist-container\"> </div>\n      <div class=\"dropdown-container dropdown-share-container\"></div>\n  </div>\n  ";
  return buffer;
  }

  buffer += "<div class=\"list-item-tile-container\">\n\n  <a href=\"/su/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n      <div class=\"tile-top\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "url-tile:top\" style=\"background: url('";
  if (helper = helpers.thumbnail_b) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.thumbnail_b); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "')\"></div>\n  </a>\n\n  <div class=\"tile-bottom\">\n    <div class=\"title\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "url-tile:title\">\n      <a href=\"/su/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n        ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.title), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n      </a>\n    </div>\n    <div class=\"domain\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "url-tile:domain\">\n      "
    + escapeExpression((helper = helpers.getDomain || (depth0 && depth0.getDomain),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.url), options) : helperMissing.call(depth0, "getDomain", (depth0 && depth0.url), options)))
    + "\n    </div>\n    <div class=\"likes\" data-track=\"";
  if (helper = helpers._trackingPrefix) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0._trackingPrefix); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "url-tile:likes\">\n        <a href=\"/content/";
  if (helper = helpers.urlid) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.urlid); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n            "
    + escapeExpression((helper = helpers.numberFormat || (depth0 && depth0.numberFormat),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.likes), options) : helperMissing.call(depth0, "numberFormat", (depth0 && depth0.likes), options)))
    + " likes\n        </a>\n    </div>\n  </div>\n  ";
  options={hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data}
  if (helper = helpers.isLoggedIn) { stack1 = helper.call(depth0, options); }
  else { helper = (depth0 && depth0.isLoggedIn); stack1 = typeof helper === functionType ? helper.call(depth0, options) : helper; }
  if (!helpers.isLoggedIn) { stack1 = blockHelperMissing.call(depth0, stack1, {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data}); }
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/widgets/action-button":[function(require,module,exports){
module.exports=require('nq9eAH');
},{}],"nq9eAH":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += " data-toggle=\"tooltip\" data-placement=\"bottom\" data-original-title=\"";
  if (helper = helpers.tooltip) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.tooltip); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"";
  return buffer;
  }

function program3(depth0,data) {
  
  var buffer = "";
  buffer += " "
    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0));
  return buffer;
  }

function program5(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += " id=\"";
  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"";
  return buffer;
  }

function program7(depth0,data) {
  
  
  return " disabled";
  }

  buffer += "<div class='tooltip-wrapper'";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.tooltip), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += ">\n  <div class=\"btn";
  stack1 = helpers.each.call(depth0, (depth0 && depth0.classNames), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\"\n    ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.id), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.disabled), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += ">\n      ";
  if (helper = helpers.buttonText) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.buttonText); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n  </div>\n</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"b5bLFN":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"action-btns text-right\"></div>";
  });

},{"hbsfy/runtime":795}],"../templates/widgets/action-buttons":[function(require,module,exports){
module.exports=require('b5bLFN');
},{}],"../templates/widgets/checkable-item":[function(require,module,exports){
module.exports=require('cwmSEi');
},{}],"cwmSEi":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, self=this, functionType="function", escapeExpression=this.escapeExpression;

function program1(depth0,data) {
  
  
  return " checked";
  }

  buffer += "<div class=\"list-title";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.checked), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n";
  if (helper = helpers.widgetText) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.widgetText); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n</div>\n<span class=\"fa fa-check\"></span>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/widgets/droplist-option":[function(require,module,exports){
module.exports=require('B5PV0U');
},{}],"B5PV0U":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  
  return "style=\"display:none;\"";
  }

  buffer += "<a href=\"#\" class=\"selectableOption\" data-name=\"";
  if (helper = helpers.widgetText) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.widgetText); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" id=\"";
  if (helper = helpers.widgetDataId) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.widgetDataId); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" ";
  stack1 = helpers.unless.call(depth0, (depth0 && depth0._selectable), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += ">\n  ";
  if (helper = helpers.widgetText) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.widgetText); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\n</a>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/widgets/droplist":[function(require,module,exports){
module.exports=require('RCUi24');
},{}],"RCUi24":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<ul id=\"";
  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" data-view-id=\"autofilter-droplist\" class=\"droplist dropdown-menu\"><!-- the list of all interests gets injected here --></ul>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"7YrkBc":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"items-container clearfix\"></div>";
  });

},{"hbsfy/runtime":795}],"../templates/widgets/item-selection":[function(require,module,exports){
module.exports=require('7YrkBc');
},{}],"../templates/widgets/nav-button":[function(require,module,exports){
module.exports=require('tvO3BP');
},{}],"tvO3BP":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"click-target\">";
  if (helper = helpers.buttonText) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.buttonText); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/widgets/nav-buttons":[function(require,module,exports){
module.exports=require('txn0ZT');
},{}],"txn0ZT":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "";


  buffer += "\n<div class=\"scroller scroller-left\" data-track=\"nav-buttons-scroll-left\"><i class=\"fa fa-chevron-left\"></i></div>\n<div class=\"scroller scroller-right\" data-track=\"nav-buttons-scroll-right\"><i class=\"fa fa-chevron-right\"></i></div>\n<div class=\"wrapper\">\n  <ul class=\"nav-btns nav nav-tabs list\"></ul>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"yJ+Woq":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression, self=this;

function program1(depth0,data) {
  
  var buffer = "";
  buffer += " "
    + escapeExpression((typeof depth0 === functionType ? depth0.apply(depth0) : depth0));
  return buffer;
  }

function program3(depth0,data) {
  
  var buffer = "", stack1, helper;
  buffer += " id=\"";
  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\"";
  return buffer;
  }

function program5(depth0,data) {
  
  
  return " disabled";
  }

function program7(depth0,data) {
  
  
  return "style=\"display:none;\"";
  }

  buffer += "<div class=\"search-input";
  stack1 = helpers.each.call(depth0, (depth0 && depth0.classNames), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "\">\n  <input class=\"search-text\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.id), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.disabled), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += " type=\"text\" placeholder=\"";
  if (helper = helpers.placeholderText) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.placeholderText); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" value=\"";
  if (helper = helpers.searchText) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.searchText); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\">\n  <span data-icon-id=\"search-reset\" class=\"input-r-icon fa fa-times-circle\" ";
  stack1 = helpers.unless.call(depth0, (depth0 && depth0.searchOpen), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "></span>\n  <span data-icon-id=\"search-label\" class=\"input-r-icon search-label fa fa-search\" ";
  stack1 = helpers['if'].call(depth0, (depth0 && depth0.searchOpen), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});
  if(stack1 || stack1 === 0) { buffer += stack1; }
  buffer += "></span>\n  <div id=\"";
  if (helper = helpers.dropviewId) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.dropviewId); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "\" class=\"dropview-container dropdown\"></div>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/widgets/search-input":[function(require,module,exports){
module.exports=require('yJ+Woq');
},{}],"JtT1E7":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"nav-buttons-view-background\">\n  <div id=\"nav-buttons-view-container\" class=\"nav-buttons-view-container container\"></div>\n</div>\n<div class=\"tab-content-view-background\">\n  <div id=\"tab-content-view-container\" class=\"list-container container\"></div>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/widgets/tab-view":[function(require,module,exports){
module.exports=require('JtT1E7');
},{}],"/vDAbC":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  


  return "<div class=\"wrong-stumble-container\">\n    <div id=\"subview-container\"></div>\n</div>";
  });

},{"hbsfy/runtime":795}],"../templates/wrong-stumble/base":[function(require,module,exports){
module.exports=require('/vDAbC');
},{}],"b8XC8z":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"dialog-title\">Report a Misclassified Page</div>\n<form class=\"main-form form-horizontal\" onsubmit=\"return false\">\n    <div class=\"form-group current-interest-group\">\n        <label class=\"col-xs-5 control-label\">Current Interest</label>\n        <div class=\"col-xs-7\">\n           <div class=\"current\">";
  if (helper = helpers.current_category) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.current_category); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n        </div>\n    </div>\n    <div class=\"form-group suggest-interest-group\">\n        <label class=\"col-xs-5 control-label\">Suggested Interest</label>\n        <div class=\"col-xs-7\">\n            <select class=\"suggest-interest form-control\" id=\"suggest-interest\" name=\"suggest-interest\"></select>\n        </div>\n    </div>\n    <div class=\"form-group note-group\">\n        <label class=\"col-xs-5 control-label\">Optional Details</label>\n        <div class=\"col-xs-7\">\n            <input class=\"form-control\" id=\"note\" type=\"text\" name=\"note\" />\n        </div>\n    </div>\n    <div class=\"dialog-footer\">\n        <div class=\"btn btn-primary btn-sulight cancel\" data-track=\"wrong-stumble:misclassified:cancel\">Cancel</div>\n        <button type=\"submit\" class=\"btn btn-primary send-report btn-sublue\" data-track=\"wrong-stumble:misclassified:send-report\"><i class=\"fa fa-spinner fa-spin send-spin hidden\"></i>Send Report</button>\n    </div>\n</form>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/wrong-stumble/misclassified":[function(require,module,exports){
module.exports=require('b8XC8z');
},{}],"../templates/wrong-stumble/options":[function(require,module,exports){
module.exports=require('j9k2Ez');
},{}],"j9k2Ez":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"dialog-title\">Something Wrong?</div>\n<div class=\"options text-left\">\n    <div class=\"misclassified option\" data-track=\"wrong-stumble:options:misclassified\">Is this page not about ";
  if (helper = helpers.current_category) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.current_category); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "?</div>\n    <div class=\"notAvailable option\" data-track=\"wrong-stumble:options:notAvailable\">Is this page not available?</div>\n    <div class=\"wrongLanguage option\" data-track=\"wrong-stumble:options:wrongLanguage\">Is this page not in ";
  if (helper = helpers.current_language) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.current_language); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "?</div>\n</div>\n<div class=\"dialog-footer options-footer\">\n    <div class=\"btn btn-primary btn-sulight cancel\" data-track=\"wrong-stumble:options:cancel\">Cancel</div>\n</div>";
  return buffer;
  });

},{"hbsfy/runtime":795}],"blWMNz":[function(require,module,exports){
// hbsfy compiled Handlebars template
var Handlebars = require('hbsfy/runtime');
module.exports = Handlebars.template(function (Handlebars,depth0,helpers,partials,data) {
  this.compilerInfo = [4,'>= 1.0.0'];
helpers = this.merge(helpers, Handlebars.helpers); data = data || {};
  var buffer = "", stack1, helper, functionType="function", escapeExpression=this.escapeExpression;


  buffer += "<div class=\"dialog-title\">Suggest the Correct Language for this Page</div>\n<form class=\"main-form form-horizontal\" onsubmit=\"return false\">\n    <div class=\"form-group current-language-group\">\n        <label class=\"col-xs-5 control-label\">Current Language</label>\n        <div class=\"col-xs-7\">\n            <div class=\"current\">";
  if (helper = helpers.current_language) { stack1 = helper.call(depth0, {hash:{},data:data}); }
  else { helper = (depth0 && depth0.current_language); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }
  buffer += escapeExpression(stack1)
    + "</div>\n        </div>\n    </div>\n    <div class=\"form-group suggest-interest-group\">\n        <label class=\"col-xs-5 control-label\">Suggested Language</label>\n        <div class=\"col-xs-7\">\n            <select class=\"suggest-interest form-control\" id=\"suggest-language\" name=\"suggest-language\"></select>\n        </div>\n    </div>\n    <div class=\"info\">\n        When choosing the correct language for the page, please indicate the language necessary to appreciate the page. If no language is necessary to appreciate the page (e.g. it is visual), select No Language.\n    </div>\n    <div class=\"dialog-footer language-footer\">\n        <div class=\"btn btn-primary btn-sulight cancel\" data-track=\"wrong-stumble:language:cancel\">Cancel</div>\n        <button type=\"submit\" class=\"btn btn-primary send-report btn-sublue\" data-track=\"wrong-stumble:language:send-report\"><i class=\"fa fa-spinner fa-spin send-spin hidden\"></i>Send Report</button>\n    </div>\n</form>\n";
  return buffer;
  });

},{"hbsfy/runtime":795}],"../templates/wrong-stumble/wrong-language":[function(require,module,exports){
module.exports=require('blWMNz');
},{}],596:[function(require,module,exports){
module.exports = ["html/busting/addineyeV2.html"];


},{}],597:[function(require,module,exports){
var $, ActivityCenterView, ActivityItemView, CollectionView, LoadingActivitiesView, mediator, moment, panel, template, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('../base/collection-view');

ActivityItemView = require('./activity-item-view');

LoadingActivitiesView = require('./loading-activities-view');

template = require('../../templates/activity-center/activity-center');

moment = require('moment');

mediator = require('chaplin').mediator;

$ = require('jquery');

_ = require('lodash');

utils = require('../../lib/utils');

panel = require('../../lib/panel');

module.exports = ActivityCenterView = (function(_super) {
  __extends(ActivityCenterView, _super);

  function ActivityCenterView() {
    this.onBodyClick = __bind(this.onBodyClick, this);
    return ActivityCenterView.__super__.constructor.apply(this, arguments);
  }

  ActivityCenterView.prototype.autoRender = true;

  ActivityCenterView.prototype.itemView = ActivityItemView;

  ActivityCenterView.prototype.listSelector = '.activity-center-list';

  ActivityCenterView.prototype.template = template;

  ActivityCenterView.prototype.loadingSelector = '.loading-ac-items';

  ActivityCenterView.prototype.fetchLimit = 25;

  ActivityCenterView.prototype.fetching = false;

  ActivityCenterView.prototype.events = {
    'scroll': 'onActivitiesScroll',
    'click .tabs-container>div': 'onSelectTab'
  };

  ActivityCenterView.prototype.initialize = function(options) {
    ActivityCenterView.__super__.initialize.apply(this, arguments);
    this.conversationCollection = options.conversationCollection || (function() {
      throw new Error('I need conversationCollection but you didn\'t give me.');
    })();
    this.followCollection = options.followCollection || (function() {
      throw new Error('I need followCollection but you didn\'t give me.');
    })();
    this.fetchCollectection();
    mediator.activityNotificationM.set({
      last_checked: moment().format()
    });
    return mediator.activityNotificationM.save();
  };

  ActivityCenterView.prototype.attach = function() {
    ActivityCenterView.__super__.attach.apply(this, arguments);
    $('body').on('click', this.onBodyClick);
    this.subview('loading-activities', new LoadingActivitiesView({
      collection: this.collection,
      container: this.$el
    }));
    if (utils.contentScrolledNearBottomEdge(this.$el, 1.5) && this.collection.lastFetchedCount !== 0) {
      return this.getMoreActivities();
    }
  };

  ActivityCenterView.prototype.onBodyClick = function(event) {
    var dataId, parentElement, targetEl, _ref, _ref1, _ref2;
    targetEl = event.target;
    dataId = (_ref = targetEl.attributes["data-id"]) != null ? _ref.value : void 0;
    parentElement = document.getElementById('activity-center-data');
    if (!((dataId === "menu-notifications") || (dataId === "conversation-back") || (dataId === "conversation-back-inner") || ((_ref1 = targetEl.attributes) != null ? (_ref2 = _ref1["class"]) != null ? _ref2.value.includes("activity-center-container") : void 0 : void 0) || utils.isCurrentOrChildElement(parentElement, targetEl))) {
      return panel.close();
    }
  };

  ActivityCenterView.prototype.onSelectTab = function(event) {
    var selectedScope;
    selectedScope = $(event.target).attr("data-scope");
    return this.setCurrentCollection(selectedScope);
  };

  ActivityCenterView.prototype.setCurrentCollection = function(newScope) {
    this.removeCollectionListeners();
    if (this.collection.currentScope === newScope) {
      return;
    }
    switch (newScope) {
      case 'conversation':
        this.collection = this.conversationCollection;
        break;
      case 'follow':
        this.collection = this.followCollection;
        break;
      default:
        throw new Error(newScope + ' unexpected.');
    }
    this.addCollectionListeners();
    if (this.collection.length === 0) {
      return this.fetchCollectection();
    } else {
      this.render();
      return this.$el.find(this.loadingSelector).addClass('loaded');
    }
  };

  ActivityCenterView.prototype.fetchCollectection = function() {
    var options;
    options = {
      remove: false
    };
    options.data = {
      start: 0,
      limit: this.fetchLimit
    };
    return this.fetchCollection(options);
  };

  ActivityCenterView.prototype.fetchCollection = function(options) {
    if (!this.fetching) {
      this.fetching = true;
      this.$el.find(this.loadingSelector).removeClass('loaded');
      return this.collection.fetch(options);
    }
  };

  ActivityCenterView.prototype.addCollectionListeners = function() {
    ActivityCenterView.__super__.addCollectionListeners.apply(this, arguments);
    this.listenTo(this.collection, 'add', this.onNewActivity);
    this.listenTo(this.collection, 'sync', this.onSync);
    return this.listenTo(this.collection, 'error', this.onError);
  };

  ActivityCenterView.prototype.onError = function() {
    return this.$el.find(this.loadingSelector).addClass('loaded');
  };

  ActivityCenterView.prototype.removeCollectionListeners = function() {
    this.stopListening(this.collection, 'add', this.itemAdded);
    this.stopListening(this.collection, 'remove', this.itemRemoved);
    this.stopListening(this.collection, 'reset sort', this.itemReset);
    this.stopListening(this.collection, 'add', this.onNewActivity);
    return this.stopListening(this.collection, 'sync', this.onNewActivity);
  };

  ActivityCenterView.prototype.onNewActivity = function(model, collection) {
    var incomingConvoId, incomingId, _ref;
    if (collection !== this.collection || this.collection.currentScope !== 'conversation') {
      return;
    }
    incomingId = model.get('id');
    incomingConvoId = (_ref = model.get('conversationDetails')) != null ? _ref.id : void 0;
    return this.collection.remove(this.collection.filter(function(activityM) {
      var _ref1;
      return ((_ref1 = activityM.get('conversationDetails')) != null ? _ref1.id : void 0) === incomingConvoId && (activityM != null ? activityM.get('id') : void 0) !== incomingId;
    }));
  };

  ActivityCenterView.prototype.onActivitiesScroll = function() {
    var buffer, innerHeight, scrollHeight, scrollTop;
    innerHeight = this.$el.innerHeight();
    scrollTop = this.$el.scrollTop();
    scrollHeight = this.$el[0].scrollHeight;
    buffer = 250;
    if (utils.contentScrolledNearBottomEdge(this.$el, 1.5)) {
      return this.getMoreActivities();
    }
  };

  ActivityCenterView.prototype.getMoreActivities = _.debounce(function() {
    var offset, options;
    if (this.fetching || this.collection.lastFetchedCount === 0) {
      return;
    }
    offset = utils.getNextCollectionOffset(this.collection);
    options = {
      remove: false
    };
    options.data = {
      start: offset,
      limit: this.fetchLimit
    };
    this.$el.find(this.loadingSelector).removeClass('loaded');
    return this.fetchCollection(options);
  }, 200);

  ActivityCenterView.prototype.onSync = function(collection, response, options) {
    if (collection !== this.collection) {
      return;
    }
    this.fetching = false;
    this.resetView();
    this.$el.find(this.loadingSelector).addClass('loaded');
    if (utils.contentScrolledNearBottomEdge(this.$el, 1.5) && this.collection.lastFetchedCount !== 0) {
      return this.getMoreActivities();
    }
  };

  ActivityCenterView.prototype.render = function() {
    ActivityCenterView.__super__.render.apply(this, arguments);
    return this.resetView();
  };

  ActivityCenterView.prototype.resetView = function() {
    utils.verticalPush(this.$el);
    _.defer((function(_this) {
      return function() {
        return utils.verticalPush(_this.$el, 0);
      };
    })(this));
    this.$el.find(".tabs-container").find(".active").removeClass("active");
    return this.$el.find(".tabs-container").find("." + this.collection.currentScope).addClass("active");
  };

  ActivityCenterView.prototype.dispose = function() {
    $('body').off('click', this.onBodyClick);
    utils.verticalPush(this.$el);
    return setTimeout((function(_this) {
      return function() {
        return ActivityCenterView.__super__.dispose.apply(_this, arguments);
      };
    })(this), 1000);
  };

  return ActivityCenterView;

})(CollectionView);


},{"../../lib/panel":125,"../../lib/utils":156,"../../templates/activity-center/activity-center":"v9Hzkf","../base/collection-view":606,"./activity-item-view":598,"./loading-activities-view":600,"chaplin":773,"jquery":774,"lodash":776,"moment":778}],598:[function(require,module,exports){
var ActivityItemView, FollowModel, SeenModel, View, analytics, panel, request, stumble,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

panel = require('../../lib/panel');

FollowModel = require('../../models/follow-model');

SeenModel = require('../../models/seen-model');

request = require('../../lib/request');

stumble = require('../../lib/stumble');

analytics = require('../../lib/analytics');

module.exports = ActivityItemView = (function(_super) {
  __extends(ActivityItemView, _super);

  function ActivityItemView() {
    return ActivityItemView.__super__.constructor.apply(this, arguments);
  }

  ActivityItemView.prototype.className = 'activity-item';

  ActivityItemView.prototype.events = {
    'click': 'onClick',
    'click .follow-user': 'onFollowClick'
  };

  ActivityItemView.prototype.listen = {
    'change:_userM model': 'render',
    'change:_urlM model': 'render'
  };

  ActivityItemView.prototype.getTemplate = function() {
    var group;
    group = this.model.get('group');
    return require("../templates/activity-center/activity-item-" + group);
  };

  ActivityItemView.prototype.onClick = function() {
    var conversationDetails, conversationId, currentStumbleConvoM, group, seenM, source, _ref;
    group = this.model.get('group');
    conversationDetails = this.model.get('conversationDetails');
    conversationId = conversationDetails != null ? conversationDetails.id : void 0;
    currentStumbleConvoM = (_ref = stumble.getCollection().getActive()) != null ? _ref.get('_conversationM') : void 0;
    source = null;
    if (group === 'share') {
      source = 'ac_share';
    } else if (group === 'conversation') {
      source = 'ac_conversation';
    }
    if (source) {
      seenM = new SeenModel({
        urlid: this.model.get('urlId'),
        source: source
      });
      seenM.save();
    }
    if (!this.model.get('read')) {
      this.model.set({
        'read': true
      });
      this.model.save();
    }
    if (group === 'conversation') {
      if (conversationId === (currentStumbleConvoM != null ? currentStumbleConvoM.get('conversationId') : void 0)) {
        panel.open('conversation', {
          conversationM: currentStumbleConvoM,
          position: 'right'
        });
      } else {
        Chaplin.utils.redirectTo({
          url: 'convo/' + conversationId,
          model: this.model
        });
      }
      return analytics.trackEvent('activity:conversation:clickConversation');
    } else if (group === 'follow') {
      Chaplin.utils.redirectTo({
        url: 'stumbler/' + this.model.get('_userM').username
      });
      return analytics.trackEvent('activity:follow:clickProfile');
    }
  };

  ActivityItemView.prototype.onFollowClick = function(e) {
    var followM, userM;
    e.stopPropagation();
    if (this.model.get('_userM')) {
      userM = this.model.get('_userM');
      followM = new FollowModel({
        userid: userM.userid
      });
      this.$el.find('.fa-user-plus').removeClass('fa-user-plus').addClass('fa-spin fa-circle-o-notch');
      userM.is_followed = true;
      this.model.set('_userM', userM);
      followM.save().then((function(_this) {
        return function(resp) {
          if (resp._success) {
            return _this.$el.find('.follow-user').addClass('followed').find('.fa-spin').removeClass('fa-spin fa-circle-o-notch').addClass('fa-check');
          } else {
            return _this.$el.find('.fa-spin').removeClass('fa-spin fa-circle-o-notch').addClass('fa-user-plus');
          }
        };
      })(this));
      return analytics.trackEvent('activity:follow:clickFollow');
    }
  };

  ActivityItemView.prototype.render = function() {
    ActivityItemView.__super__.render.apply(this, arguments);
    this.$el.addClass(this.model.get('group'));
    if (this.model.get('read')) {
      return this.$el.addClass('read');
    }
  };

  return ActivityItemView;

})(View);


},{"../../lib/analytics":116,"../../lib/panel":125,"../../lib/request":128,"../../lib/stumble":130,"../../models/follow-model":180,"../../models/seen-model":228,"../base/view":608}],599:[function(require,module,exports){
var ActivityNotificationView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/activity-center/activity-notification');

module.exports = ActivityNotificationView = (function(_super) {
  __extends(ActivityNotificationView, _super);

  function ActivityNotificationView() {
    return ActivityNotificationView.__super__.constructor.apply(this, arguments);
  }

  ActivityNotificationView.prototype.template = template;

  ActivityNotificationView.prototype.className = 'activity-notification';

  ActivityNotificationView.prototype.containerMethod = 'html';

  ActivityNotificationView.prototype.listen = {
    'change model': 'render'
  };

  return ActivityNotificationView;

})(View);


},{"../../templates/activity-center/activity-notification":"62Mg0q","../base/view":608}],600:[function(require,module,exports){
var $, LoadingActivitiesView, LoadingIndicatorView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

LoadingIndicatorView = require('../loading-indicator-view');

template = require('../../templates/activity-center/loading-activities');

$ = require('jquery');

module.exports = LoadingActivitiesView = (function(_super) {
  __extends(LoadingActivitiesView, _super);

  function LoadingActivitiesView() {
    return LoadingActivitiesView.__super__.constructor.apply(this, arguments);
  }

  LoadingActivitiesView.prototype.disposeOnAdd = true;

  LoadingActivitiesView.prototype.template = template;

  LoadingActivitiesView.prototype.showView = function() {
    $('#app-container').addClass('empty-activities');
    return LoadingActivitiesView.__super__.showView.apply(this, arguments);
  };

  LoadingActivitiesView.prototype.hideView = function() {
    $('#app-container').removeClass('empty-activities');
    return LoadingActivitiesView.__super__.hideView.apply(this, arguments);
  };

  LoadingActivitiesView.prototype.dispose = function() {
    $('#app-container').removeClass('empty-activities');
    return LoadingActivitiesView.__super__.dispose.apply(this, arguments);
  };

  return LoadingActivitiesView;

})(LoadingIndicatorView);


},{"../../templates/activity-center/loading-activities":"45cXq2","../loading-indicator-view":659,"jquery":774}],601:[function(require,module,exports){
var $, AddToListView, CreateListItemEntryView, ListsView, View, i18n, panel, template, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

View = require('./base/view');

ListsView = require('./lists-view');

CreateListItemEntryView = require('./create-list-item-entry');

template = require('../templates/add-to-list');

i18n = require('../lib/i18n');

_ = require('lodash');

panel = require('../lib/panel');

module.exports = AddToListView = (function(_super) {
  __extends(AddToListView, _super);

  function AddToListView() {
    this.afterCollectionComplete = __bind(this.afterCollectionComplete, this);
    return AddToListView.__super__.constructor.apply(this, arguments);
  }

  AddToListView.prototype.autoRender = true;

  AddToListView.prototype.className = 'addtolist-container';

  AddToListView.prototype.id = 'addtolist';

  AddToListView.prototype.template = template;

  AddToListView.prototype.region = 'panel';

  AddToListView.prototype.events = {
    'click .modal-close': function() {
      return panel.close();
    },
    'keyup .dropdown-search': 'onKeyUp',
    'click .dropdown-create-new': 'displayCreate',
    'click .dropdown-create-list-item-entry .list-item-text': 'displayCreate',
    'mouseenter .dropdown-items': 'clearActive',
    'mouseleave .dropdown-items': 'clearActive',
    'focus .modal-body input': 'onInputFocus',
    'blur .modal-body input': 'onInputBlur'
  };

  AddToListView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM',
    'list:itemadded mediator': 'onItemAdded',
    'list:itemadded:error mediator': 'onItemAddedError',
    'model:sync:start mediator': 'onLoadingStart'
  };

  AddToListView.prototype.displayCreate = function() {
    return this.publishEvent('list:displaycreate', this.$el.find('.dropdown-search').val());
  };

  AddToListView.prototype.onAddedToDOM = function() {
    var _ref;
    this.subview('listsV', new ListsView({
      collection: this.collection
    }));
    this.collection.whenPopulated().then(this.afterCollectionComplete);
    if (((_ref = this.collection) != null ? _ref._total : void 0) === 0 && this.collection.length === 0) {
      this.afterCollectionComplete();
    }
    this.resetList();
    return this.setTimeout((function(_this) {
      return function() {
        var _ref1;
        return (_ref1 = _this.$el) != null ? _ref1.find('.dropdown-search').focus() : void 0;
      };
    })(this), 250);
  };

  AddToListView.prototype.afterCollectionComplete = function() {
    this.toggleLoading(false);
    return $('#addtolist .dropdown-item').attr('data-track', 'list-addedtolist');
  };

  AddToListView.prototype.onInputFocus = function() {
    return this.$el.find('.modal-body .dropdown').addClass('focus-outline');
  };

  AddToListView.prototype.onInputBlur = function() {
    return this.$el.find('.modal-body .dropdown').removeClass('focus-outline');
  };

  AddToListView.prototype.clearActive = function() {
    var _ref;
    return (_ref = this.$el) != null ? _ref.find('.dropdown-item.touchactive').removeClass('touchactive') : void 0;
  };

  AddToListView.prototype.resetList = function() {
    $("li.dropdown-item").addClass('visible');
    return this.collection.invoke("set", {
      "_visible": true
    });
  };

  AddToListView.prototype.onKeyUp = function(e) {
    var matched, str;
    str = $(e.currentTarget).val();
    if (!str) {
      this.resetList();
      return this.$el.find('.dropdown-create-new').addClass('disabled');
    } else {
      matched = this.filterSearch(str, this.collection);
      if (matched.indexOf(str.toLowerCase()) === -1) {
        return this.$el.find('.dropdown-create-new').removeClass('disabled');
      } else {
        return this.$el.find('.dropdown-create-new').addClass('disabled');
      }
    }
  };

  AddToListView.prototype.filterSearch = function(str, collection) {
    var matched;
    this.collection = collection;
    matched = [];
    this.collection.forEach(function(model) {
      var isVisible, name;
      name = model.get('name').toLowerCase();
      isVisible = name.indexOf(str.toLowerCase()) > -1;
      if (isVisible) {
        matched.push(name);
      }
      return model.set('_visible', isVisible);
    });
    if ((matched.length === 0) && str.length) {
      if (!this.createItemEntryView) {
        this.createItemEntryView = new CreateListItemEntryView({
          autoRender: true,
          container: '.dropdown-items'
        });
      }
      this.$el.find('.dropdown-create-list-item-entry').css('display', 'inline');
      this.$el.find('.create-list-item-entry-name').text(str);
    } else {
      this.$el.find('.dropdown-create-list-item-entry').css('display', 'none');
    }
    return matched;
  };

  AddToListView.prototype.onLoadingStart = function(model) {
    var _ref;
    if (model === this.collection.get(model) || model === true) {
      return (_ref = this.$el) != null ? _ref.find('.spinner').removeClass('hidden') : void 0;
    }
  };

  AddToListView.prototype.toggleLoading = function(force) {
    var _ref;
    if (force == null) {
      force = false;
    }
    return (_ref = this.$el) != null ? _ref.find('.spinner').toggleClass('hidden', !force) : void 0;
  };

  AddToListView.prototype.onItemAdded = function(listM) {
    var msg;
    this.toggleLoading(false);
    msg = 'Added to ' + listM.get('name');
    return this.displayMsg(msg);
  };

  AddToListView.prototype.onItemAddedError = function(listM, legacy) {
    this.toggleLoading(false);
    if (legacy) {
      return this.displayMsg(i18n('CANNOT_ADD_TO_LIST'));
    } else {
      return this.displayMsg(i18n('ALREADY_IN_LIST'));
    }
  };

  AddToListView.prototype.displayMsg = _.debounce(function(msg) {
    return panel.open('alert', {
      type: 'success',
      text: msg
    });
  }, 1000);

  return AddToListView;

})(View);


},{"../lib/i18n":121,"../lib/panel":125,"../templates/add-to-list":"1wKSJJ","./base/view":608,"./create-list-item-entry":625,"./lists-view":658,"jquery":774,"lodash":776}],602:[function(require,module,exports){
var $, AddonView, View, templateChrome, templateNotChrome, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

templateChrome = require('../templates/addon-chrome');

templateNotChrome = require('../templates/addon-not-chrome');

utils = require('../lib/utils');

$ = require('jquery');

module.exports = AddonView = (function(_super) {
  __extends(AddonView, _super);

  function AddonView() {
    return AddonView.__super__.constructor.apply(this, arguments);
  }

  AddonView.prototype.autoRender = true;

  AddonView.prototype.className = 'addon';

  AddonView.prototype.region = 'content';

  AddonView.prototype.events = {
    'click #install-chrome-extension-button': 'handleInlineInstall'
  };

  AddonView.prototype.handleInlineInstall = function(event) {
    var _ref;
    if (((_ref = chrome.app) != null ? _ref.isInstalled : void 0) || !$('link[rel="chrome-webstore-item"]').length) {
      return true;
    }
    chrome.webstore.install($('link[rel="chrome-webstore-item"]').attr('href'), this.handleInlineInstallSuccess.bind(this), this.handleInlineInstallFailure.bind(this));
    event.stopPropagation();
    return event.preventDefault();
  };

  AddonView.prototype.handleInlineInstallSuccess = function(msg) {};

  AddonView.prototype.handleInlineInstallFailure = function(msg) {
    return this.openChromeStoreInNewWindow();
  };

  AddonView.prototype.openChromeStoreInNewWindow = function() {
    var options;
    options = 'height=768,width=1024,toolbar=0,location=0,menubar=0,directories=0,scrollbars=0';
    return window.open($('link[rel="chrome-webstore-item"]').attr('href'), 'stumblebar-chrome-window', options);
  };

  AddonView.prototype.initialize = function() {
    AddonView.__super__.initialize.apply(this, arguments);
    if (utils.isChrome()) {
      this.template = templateChrome;
    } else {
      this.template = templateNotChrome;
    }
    return $('body').css('overflow-x', 'scroll');
  };

  AddonView.prototype.dispose = function() {
    $('body').css('overflow-x', '');
    return AddonView.__super__.dispose.apply(this, arguments);
  };

  return AddonView;

})(View);


},{"../lib/utils":156,"../templates/addon-chrome":"qVK48r","../templates/addon-not-chrome":"KdOu1R","./base/view":608,"jquery":774}],603:[function(require,module,exports){
var AlertView, View, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/alert');

View = require('./base/view');

panel = require('../lib/panel');

module.exports = AlertView = (function(_super) {
  __extends(AlertView, _super);

  function AlertView() {
    return AlertView.__super__.constructor.apply(this, arguments);
  }

  AlertView.prototype.autoRender = true;

  AlertView.prototype.className = 'alert-container container';

  AlertView.prototype.id = 'stumble-alert';

  AlertView.prototype.template = template;

  AlertView.prototype.region = 'panel';

  AlertView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  AlertView.prototype.initialize = function() {
    AlertView.__super__.initialize.apply(this, arguments);
    return this.$el.addClass(this.model.get('type'));
  };

  AlertView.prototype.onAddedToDOM = function() {
    this.publishEvent('panel:alert:open');
    return this.setTimeout((function(_this) {
      return function() {
        return panel.close();
      };
    })(this), '4s');
  };

  return AlertView;

})(View);


},{"../lib/panel":125,"../templates/alert":"huS0dS","./base/view":608}],604:[function(require,module,exports){
var $, ApiErrorView, View, analytics, root, storage, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

template = require('../templates/api-error');

View = require('./base/view');

storage = require('simple-storage');

root = require('../lib/root');

analytics = require('../lib/analytics');

module.exports = ApiErrorView = (function(_super) {
  __extends(ApiErrorView, _super);

  function ApiErrorView() {
    return ApiErrorView.__super__.constructor.apply(this, arguments);
  }

  ApiErrorView.prototype.autoRender = true;

  ApiErrorView.prototype.className = 'api-error';

  ApiErrorView.prototype.container = 'body';

  ApiErrorView.prototype.containerMethod = 'html';

  ApiErrorView.prototype.template = template;

  ApiErrorView.prototype.events = {
    'click [data-link-id=report-link]': 'onReportLinkClick'
  };

  ApiErrorView.prototype.onReportLinkClick = function(evnt) {
    return analytics.trackEvent('api-error-report-click', 1, {
      action: 'click',
      label: 'api-error'
    });
  };

  return ApiErrorView;

})(View);


},{"../lib/analytics":116,"../lib/root":129,"../templates/api-error":"Pg+1ZR","./base/view":608,"jquery":774,"simple-storage":780}],605:[function(require,module,exports){
var $, AppView, ClickTracking, View, abTracking, mediator, template, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

_ = require('lodash');

template = require('../templates/app');

View = require('./base/view');

utils = require('../lib/utils');

mediator = require('chaplin').mediator;

ClickTracking = require('../lib/click-tracking');

abTracking = require('../lib/ab-tracking');

module.exports = AppView = (function(_super) {
  __extends(AppView, _super);

  function AppView() {
    return AppView.__super__.constructor.apply(this, arguments);
  }

  AppView.prototype.announceEvents = 'app';

  AppView.prototype.autoRender = true;

  AppView.prototype.container = 'body';

  AppView.prototype.containerMethod = 'html';

  AppView.prototype.id = 'app-container';

  AppView.prototype.regions = {
    'toolbar': '#toolbar-container',
    'panel': '#panel-container',
    'panel-right': '#panel-right-container',
    'content': '#content-container',
    'slide-left': '#slide-left-container',
    'slide-right': '#slide-right-container'
  };

  AppView.prototype.template = template;

  AppView.prototype.events = {
    'click [data-toggle=tooltip]': 'destroyTooltip'
  };

  AppView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  AppView.prototype.initialize = function() {
    AppView.__super__.initialize.apply(this, arguments);
    $(window).on('resize orientationchange', _.debounce((function(_this) {
      return function(e) {
        return _this.publishEvent('window:resize', e);
      };
    })(this), 500, {
      leading: true
    }));
    $(window).on('orientationchange', _.debounce((function(_this) {
      return function(e) {
        return _this.publishEvent('window:orientationchange', e);
      };
    })(this), 500, {
      leading: true
    }));
    $(window).on('keydown', _.throttle((function(_this) {
      return function(e) {
        return _this.publishEvent('window:keydown', e);
      };
    })(this), 100));
    $(window).on('popstate', (function(_this) {
      return function(e) {
        return _this.publishEvent('window:popstate', e);
      };
    })(this));
    new ClickTracking;
    $("body").tooltip({
      selector: '[data-toggle="tooltip"]',
      container: 'body'
    }).on('hide.bs.tooltip', (function(_this) {
      return function() {
        return _this.destroyTooltip();
      };
    })(this));
    return abTracking.trackAppInit(24);
  };

  AppView.prototype.destroyTooltip = function() {
    return $('body').find('> .tooltip').remove();
  };

  AppView.prototype.onAddedToDOM = function() {
    return $('#panel-right-container').on('transitionend', (function(_this) {
      return function(e) {
        return _this.publishEvent('panel-right:transitionend', e);
      };
    })(this));
  };

  return AppView;

})(View);


},{"../lib/ab-tracking":114,"../lib/click-tracking":118,"../lib/utils":156,"../templates/app":"fo3zxY","./base/view":608,"chaplin":773,"jquery":774,"lodash":776}],606:[function(require,module,exports){
var AnnounceEvents, Chaplin, CollectionView, Mixin, OldBrowser, StopTimers, Truncate, View, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Mixin = require('mixen');

Chaplin = require('chaplin');

View = require('./view');

StopTimers = require('../../lib/mixins/stop-timers');

AnnounceEvents = require('../../lib/mixins/announce-events');

OldBrowser = require('../mixins/old-browser');

_ = require('lodash');

Truncate = require('../mixins/truncate');

module.exports = CollectionView = (function(_super) {
  __extends(CollectionView, _super);

  function CollectionView() {
    return CollectionView.__super__.constructor.apply(this, arguments);
  }

  CollectionView.prototype.getTemplateFunction = View.prototype.getTemplateFunction;

  CollectionView.prototype.useCssAnimation = false;

  CollectionView.prototype.render = function() {
    CollectionView.__super__.render.apply(this, arguments);
    return _.defer((function(_this) {
      return function() {
        var _ref;
        return (_ref = _this.$el) != null ? _ref.addClass('rendered') : void 0;
      };
    })(this));
  };

  return CollectionView;

})(Mixin(AnnounceEvents, StopTimers, Truncate, Chaplin.CollectionView));


},{"../../lib/mixins/announce-events":123,"../../lib/mixins/stop-timers":124,"../mixins/old-browser":662,"../mixins/truncate":663,"./view":608,"chaplin":773,"lodash":776,"mixen":777}],607:[function(require,module,exports){
var $, InputPanelView, View, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

utils = require('../../lib/utils');

View = require('./view');

module.exports = InputPanelView = (function(_super) {
  __extends(InputPanelView, _super);

  function InputPanelView() {
    return InputPanelView.__super__.constructor.apply(this, arguments);
  }

  InputPanelView.prototype.uncoverAndroidInput = function($input) {
    var $el, diff, elBottom, elOffset, elTop, winBottom, winScrollTop;
    if (utils.isAndroid()) {
      if ($input.is(':focus')) {
        $el = $input.parent('div');
        if ($el.length) {
          $el.css('bottom', '');
          elOffset = $el.offset();
          if (elOffset != null ? elOffset.top : void 0) {
            elTop = elOffset.top;
            elBottom = elTop + $el.height();
            winScrollTop = $(window).scrollTop();
            winBottom = winScrollTop + $(window).height();
            diff = winBottom - elBottom;
            if (diff < 0) {
              return $el.css('bottom', -diff);
            }
          }
        }
      }
    }
  };

  return InputPanelView;

})(View);


},{"../../lib/utils":156,"./view":608,"jquery":774}],608:[function(require,module,exports){
var $, AnnounceEvents, Backbone, Chaplin, Mixin, OldBrowser, StopTimers, Truncate, View, globalConfig, guid, lunaTemplate, mediator, panel, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = window.jQuery = require('jquery');

utils = require('../../lib/utils');

Backbone = require('backbone');

Backbone.$ = $;

Mixin = require('mixen');

Chaplin = require('chaplin');

StopTimers = require('../../lib/mixins/stop-timers');

AnnounceEvents = require('../../lib/mixins/announce-events');

OldBrowser = require('../mixins/old-browser');

mediator = require('chaplin').mediator;

require('../../lib/view-helper');

_ = require('lodash');

Truncate = require('../mixins/truncate');

panel = require('../../lib/panel');

lunaTemplate = require('../../templates/luna');

guid = require('../../lib/guid');

globalConfig = require('../../config');

module.exports = View = (function(_super) {
  __extends(View, _super);

  function View() {
    return View.__super__.constructor.apply(this, arguments);
  }

  View.prototype.initialize = function() {
    View.__super__.initialize.apply(this, arguments);
    if (typeof this.getTemplate === "function" ? this.getTemplate() : void 0) {
      return this.template = this.getTemplate();
    }
  };

  View.prototype.subview = function(name, view) {
    if (!this.disposed) {
      return View.__super__.subview.apply(this, arguments);
    }
  };

  View.prototype.getTemplateFunction = function() {
    return (function(_this) {
      return function() {
        var html, _ref;
        html = (_ref = _this.template) != null ? _ref.apply(_this, arguments) : void 0;
        if (_this.container === 'body' && _this.containerMethod === 'html') {
          html += lunaTemplate.apply(_this, arguments);
        }
        return html;
      };
    })(this);
  };

  View.prototype.render = function() {
    View.__super__.render.apply(this, arguments);
    return _.defer((function(_this) {
      return function() {
        var _ref;
        return (_ref = _this.$el) != null ? _ref.addClass('rendered') : void 0;
      };
    })(this));
  };

  View.prototype.resizeFrame = function(closed, smartbannerClosed) {
    return _.defer((function(_this) {
      return function() {
        var bodyHeight, progressBarHeight, resizeHeight, toolbarHeight, _ref;
        bodyHeight = $(window).height();
        toolbarHeight = $('.toolbar').outerHeight();
        if ($('#panel-container').outerHeight() > 0 && !closed || panel.getCurrentPanel() === "activity-center") {
          progressBarHeight = 0;
        } else {
          progressBarHeight = $('#progress-bar-container').outerHeight();
        }
        resizeHeight = bodyHeight - toolbarHeight - progressBarHeight;
        if ((_ref = _this.$el) != null) {
          _ref.css('height', resizeHeight + 'px');
        }
        $('#content-container .stopscroll, .swipe, .profile-container').css({
          'height': resizeHeight + 'px'
        });
        return _this.translatePosition(closed, smartbannerClosed, resizeHeight);
      };
    })(this));
  };

  View.prototype.translatePosition = function(closed, smartbannerClosed, resizeHeight) {
    var newHeight, offsetY, panelHeight, smartBannerHeight, toolbarTranslate, translate, _ref;
    panelHeight = closed === true ? 0 : $('#panel-container').outerHeight();
    smartBannerHeight = smartbannerClosed === true ? 0 : $('#smartbanner').outerHeight();
    offsetY = panelHeight + smartBannerHeight;
    newHeight = resizeHeight - offsetY;
    translate = 'translate3d(0,' + offsetY + 'px, 0)';
    toolbarTranslate = 'translate3d(0,' + smartBannerHeight + 'px, 0)';
    if ((_ref = this.$el) != null) {
      _ref.css({
        'height': newHeight + 'px'
      });
    }
    $('#content-container .stopscroll, .swipe').css({
      '-webkit-transform': translate,
      'transform': translate
    });
    return $('.toolbar').css({
      '-webkit-transform': toolbarTranslate,
      'transform': toolbarTranslate
    });
  };

  View.prototype.goMixOnboard = function(from, context) {
    var url;
    url = 'https://' + document.location.host + '/api/v2_0/user/transitionToMix?from=' + (from || 'spa') + '&userid=' + utils.getRecognizedVisitorUserid();
    context = context || utils.getCurrentQueryParamValue('context');
    if (context) {
      url += '&context=' + context;
    }
    return $.ajax({
      method: 'GET',
      url: url,
      xhrFields: {
        withCredentials: true
      },
      headers: _.assign({}, globalConfig.headers, {
        'X-Su-ClientId': guid.get(),
        'X-Su-AccessTokenKey': utils.getDoubleDownToken()
      }),
      success: function(transitionToMixResult) {
        var redir;
        redir = transitionToMixResult != null ? transitionToMixResult.redir : void 0;
        if (redir) {
          return window.location.href = redir;
        }
      },
      error: function(err) {
        return window.location.href = 'https://mix.com/auth/stumbleupon';
      }
    });
  };

  return View;

})(Mixin(AnnounceEvents, StopTimers, Truncate, OldBrowser, Chaplin.View));


},{"../../config":2,"../../lib/guid":119,"../../lib/mixins/announce-events":123,"../../lib/mixins/stop-timers":124,"../../lib/panel":125,"../../lib/utils":156,"../../lib/view-helper":157,"../../templates/luna":"0bWuty","../mixins/old-browser":662,"../mixins/truncate":663,"backbone":772,"chaplin":773,"jquery":774,"lodash":776,"mixen":777}],609:[function(require,module,exports){
var $, BetaOptInView, PopupView, analytics, betaManager, template, utils,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/beta-opt-in');

PopupView = require('./widgets/popup-view');

betaManager = require('../lib/beta-manager');

utils = require('../lib/utils');

analytics = require('../lib/analytics');

$ = require('jquery');

module.exports = BetaOptInView = (function(_super) {
  __extends(BetaOptInView, _super);

  function BetaOptInView() {
    this.onBodyClick = __bind(this.onBodyClick, this);
    return BetaOptInView.__super__.constructor.apply(this, arguments);
  }

  BetaOptInView.prototype.autoRender = true;

  BetaOptInView.prototype.className = 'beta-view';

  BetaOptInView.prototype.template = template;

  BetaOptInView.prototype.region = 'content';

  BetaOptInView.prototype.events = {
    'click .opt-in': 'onOptIn',
    'click .opt-out': 'onOptOut'
  };

  BetaOptInView.prototype.initialize = function() {
    return analytics.trackEvent('beta:opt-in-view', 1, {
      action: 'view',
      label: 'optin'
    });
  };

  BetaOptInView.prototype.onBodyClick = function(event) {
    var parentElement, targetEl;
    targetEl = event.target;
    parentElement = document.getElementById('beta-opt-in-box');
    if (!utils.isCurrentOrChildElement(parentElement, targetEl)) {
      return this.onOptIn();
    }
  };

  BetaOptInView.prototype.render = function() {
    if (!betaManager.isOptedIn() && !betaManager.isOptedOut()) {
      $('body').on('click', this.onBodyClick);
      return BetaOptInView.__super__.render.apply(this, arguments);
    }
  };

  BetaOptInView.prototype.onOptIn = function() {
    analytics.trackEvent('beta:user-optin');
    this.closePopup();
    return betaManager.optIn();
  };

  BetaOptInView.prototype.onOptOut = function() {
    analytics.trackEvent('beta:user-optout');
    this.closePopup();
    return betaManager.optOut(betaManager.optOutDays);
  };

  BetaOptInView.prototype.dispose = function() {
    $('body').off('click', this.onBodyClick);
    return BetaOptInView.__super__.dispose.apply(this, arguments);
  };

  return BetaOptInView;

})(PopupView);


},{"../lib/analytics":116,"../lib/beta-manager":117,"../lib/utils":156,"../templates/beta-opt-in":"U9Rbn5","./widgets/popup-view":745,"jquery":774}],610:[function(require,module,exports){
var $, BlockView, View, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/conversations/block.hbs');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = BlockView = (function(_super) {
  __extends(BlockView, _super);

  function BlockView() {
    return BlockView.__super__.constructor.apply(this, arguments);
  }

  BlockView.prototype.template = template;

  BlockView.prototype.container = '.block-container';

  BlockView.prototype.className = 'block-inner-container';

  BlockView.prototype.autoRender = true;

  BlockView.prototype.events = {
    'click [data-id=block-mobile]': 'openConfirmView',
    'click [data-id=confirm-block-mobile]': 'blockUser',
    'click [data-id=close-block]': 'dispose'
  };

  BlockView.prototype.blockUser = function() {
    mediator.blockedParticipantsC.create(this.model.toJSON());
    return this.dispose();
  };

  BlockView.prototype.openConfirmView = function() {
    return this.$el.find('.block-box').addClass('view-confirm');
  };

  return BlockView;

})(View);


},{"../../templates/conversations/block.hbs":"JK9IfS","../base/view":608,"chaplin":773,"jquery":774}],611:[function(require,module,exports){
var $, ContactView, ParticipantThumbnailView, View, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

View = require('../base/view');

mediator = require('chaplin').mediator;

template = require('../../templates/conversations/contact');

ParticipantThumbnailView = require('./participant-thumbnail-view');

module.exports = ContactView = (function(_super) {
  __extends(ContactView, _super);

  function ContactView() {
    return ContactView.__super__.constructor.apply(this, arguments);
  }

  ContactView.prototype.template = template;

  ContactView.prototype.autoRender = true;

  ContactView.prototype.className = 'contact-item col-ms-6';

  ContactView.prototype.listen = {
    'change:_queued model': 'render',
    'change:_isParticipant model': 'render'
  };

  ContactView.prototype.events = {
    'click .enable': function() {
      return this.model.toggle('_queued');
    }
  };

  ContactView.prototype.render = function() {
    ContactView.__super__.render.apply(this, arguments);
    return this.subview('thumbnail', new ParticipantThumbnailView({
      container: this.$el.find('.contact-thumbnail'),
      model: this.model,
      hideDefaultThumbnail: false
    }));
  };

  return ContactView;

})(View);


},{"../../templates/conversations/contact":"LKkC8l","../base/view":608,"./participant-thumbnail-view":621,"chaplin":773,"jquery":774}],612:[function(require,module,exports){
var $, BlockView, ConversationView, ConvoAppBannerV, InputPanelView, InvitesMobileView, ParticipantsView, mediator, panel, template, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

InputPanelView = require('../base/input-panel-view');

template = require('../../templates/conversations/conversation.hbs');

mediator = require('chaplin').mediator;

$ = require('jquery');

panel = require('../../lib/panel');

utils = require('../../lib/utils');

BlockView = require('./block-view');

ParticipantsView = require('./participants-view');

ConvoAppBannerV = require('../convo-app-banner-view');

InvitesMobileView = require('./invites-mobile-view');

_ = require('lodash');

module.exports = ConversationView = (function(_super) {
  __extends(ConversationView, _super);

  function ConversationView() {
    this.onMessageCompositionEnd = __bind(this.onMessageCompositionEnd, this);
    this.onMessageCompositionStart = __bind(this.onMessageCompositionStart, this);
    this.attachBanner = __bind(this.attachBanner, this);
    this.onWindowResize = __bind(this.onWindowResize, this);
    this.onParticipantAdded = __bind(this.onParticipantAdded, this);
    return ConversationView.__super__.constructor.apply(this, arguments);
  }

  ConversationView.prototype.template = template;

  ConversationView.prototype.events = {
    'touchclick [data-id=message-send]:not(.disabled)': 'sendMessage',
    'keydown [data-id=convo-message]': 'onMessageKeyDown',
    'keyup [data-id=convo-message]': 'onMessageKeyUp',
    'click [data-id=conversation-back]': 'onClickBack',
    'touchclick [data-id=conversation-close]': 'collapseMobileConvo',
    'touchclick [data-id=conversation-open]': 'openMobileConvo',
    'touchclick .minimized-bar': 'openMobileConvo',
    'click [data-id=conversation-more]': 'onClickMore',
    'touchclick [data-id=more-invite]': 'onInviteMore',
    'click [data-id=invite-mobile-cancel]': 'resetMobile',
    'click [data-id=more-leave]': 'onClickMute',
    'click [data-id=invite-mobile-send]:not(.disabled)': 'resetMobile',
    'click [data-id=participant-list]': 'openParticipants',
    'compositionstart [data-id=convo-message]': 'onMessageCompositionStart',
    'compositionend [data-id=convo-message]': 'onMessageCompositionEnd'
  };

  ConversationView.prototype.listen = {
    'window:resize mediator': 'onWindowResize',
    'panel-right:transitionend mediator': 'onPanelTransitionEnd',
    'addedToDOM': 'onAddedToDOM'
  };

  ConversationView.prototype.initialize = function(options) {
    var participantsC;
    if (options == null) {
      options = {};
    }
    ConversationView.__super__.initialize.apply(this, arguments);
    participantsC = this.model.get('participantsC');
    this.participantNames = participantsC.map(function(participant) {
      return participant.getParticipantDisplayName();
    });
    mediator.subscribe('invitemore:clicked', this.onInviteMore, this);
    return this.listenTo(participantsC, 'add', this.onParticipantAdded);
  };

  ConversationView.prototype.onAddedToDOM = function() {
    var maxInputHeight;
    this.renderParticipantsList();
    if (this.isRightPanelOpen()) {
      this.focusConvoInput();
    }
    this.subview('participants', new ParticipantsView({
      collection: this.model.get('participantsC')
    }));
    if (utils.isMobile()) {
      this.attachBanner();
    }
    this.$el.find('.convo-message').autogrow();
    maxInputHeight = Math.min(200, this.$el.outerHeight() - this.$el.find('.input-top').outerHeight() - 100);
    return this.$el.find('.convo-message').css('max-height', maxInputHeight);
  };

  ConversationView.prototype.createMobileInvite = function() {
    var invitesMobileView, oldMobileInviteV;
    oldMobileInviteV = this.subview('invite-mobile', invitesMobileView);
    if (oldMobileInviteV != null) {
      oldMobileInviteV.dispose();
    }
    invitesMobileView = new InvitesMobileView({
      autoRender: true,
      container: '.invites-container',
      collection: this.model.get('invitesC'),
      showSocial: false
    });
    invitesMobileView.on('invite-more-closed', this.resetMobile, this);
    return this.subview('invite-mobile', invitesMobileView);
  };

  ConversationView.prototype.collapseMobileConvo = function() {
    this.$el.find('.convo-input-bottom').hide();
    if (utils.isMobile() && $(window).width() < 768) {
      this.$el.animate({
        height: '90'
      });
    } else {
      this.$el.animate({
        height: '45'
      });
    }
    this.$el.find('.conversation-close').hide();
    this.$el.find('.conversation-open').show();
    this.$el.find('.input-top').addClass('minimized-bar');
    return this.publishEvent('convo-mobile:minimized');
  };

  ConversationView.prototype.openMobileConvo = function() {
    var convoHeight;
    this.$el.find('.convo-input-bottom').show();
    convoHeight = $(window).height() - 100;
    this.$el.animate({
      height: convoHeight
    });
    this.$el.find('.conversation-close').show();
    this.$el.find('.conversation-open').hide();
    this.$el.find('.input-top').removeClass('minimized-bar');
    return this.publishEvent('convo-mobile:maximized');
  };

  ConversationView.prototype.focusConvoInput = function() {
    if (!utils.isMobile()) {
      return this.$el.find('#convo-message').focus();
    }
  };

  ConversationView.prototype.onParticipantAdded = function(participant) {
    this.participantNames.unshift(participant.getParticipantDisplayName());
    return this.renderParticipantsList();
  };

  ConversationView.prototype.renderParticipantsList = function() {
    return this.setParticipantText(this.participantNames.join(', '));
  };

  ConversationView.prototype.setParticipantText = function(text) {
    return this.$el.find('.participant-list').html(text);
  };

  ConversationView.prototype.isRightPanelOpen = function() {
    return $('#panel-right-container').css('right') === '0px';
  };


  /*
    * invoke the events collection to create a new message
   */

  ConversationView.prototype.sendMessage = function() {
    var message;
    message = $.trim($('#convo-message').val());
    message = utils.stripHtml(message || "");
    if (message) {
      this.model.get('eventsC').addMessage(message);
      $('#convo-message').val('');
      return this.$el.find('[data-id=message-send]').addClass('disabled');
    }
  };

  ConversationView.prototype.onClickMute = function() {
    this.model.mute();
    return panel.open('alert', {
      type: 'success',
      text: 'Conversation Muted'
    });
  };

  ConversationView.prototype.onMessageKeyUp = function(e) {
    if ($.trim($(e.currentTarget).val()) === '') {
      return this.$el.find('[data-id=message-send]').addClass('disabled');
    } else {
      return this.$el.find('[data-id=message-send]').removeClass('disabled');
    }
  };

  ConversationView.prototype.onMessageKeyDown = function(e) {
    if (e.keyCode === 13 && !this.composing) {
      return this.sendMessage();
    }
  };

  ConversationView.prototype.onClickBack = function() {
    if (this.$el.attr('data-mobileview') === 'participants' || this.$el.attr('data-mobileview') === 'more') {
      return this.closeMobileParticipants();
    } else {
      return panel.open('activity-center', {
        position: 'right'
      });
    }
  };

  ConversationView.prototype.onPanelTransitionEnd = function(e) {
    if (!this.$el.attr('data-mobileview') && this.isRightPanelOpen()) {
      return this.focusConvoInput();
    }
  };

  ConversationView.prototype.openParticipants = function() {
    var participantsV;
    if (this.$el.attr('data-mobileview') !== 'participants') {
      participantsV = this.subview('participants');
      this.setParticipantText('People in Conversation');
      return this.$el.attr('data-mobileview', 'participants');
    } else {
      return this.closeMobileParticipants();
    }
  };

  ConversationView.prototype.closeMobileParticipants = function() {
    var participantsV, view;
    participantsV = this.subview('participants');
    this.renderParticipantsList();
    this.$el.removeAttr('data-mobileview');
    this.focusConvoInput();
    view = this.subview('mobile-participants');
    return view != null ? view.dispose() : void 0;
  };

  ConversationView.prototype.resetMobile = function() {
    this.$el.removeAttr('data-mobileview');
    this.$el.find('.invitesend').addClass('disabled');
    return this.focusConvoInput();
  };

  ConversationView.prototype.onClickMore = function() {
    if (this.$el.attr('data-mobileview') !== 'more') {
      return this.$el.attr('data-mobileview', 'more');
    } else {
      return this.closeMobileParticipants();
    }
  };

  ConversationView.prototype.onInviteMore = function() {
    this.closeMobileParticipants();
    this.$el.attr('data-mobileview', 'invitemore');
    return this.createMobileInvite();
  };

  ConversationView.prototype.onInviteMobileCancel = function() {
    return this.resetMobile();
  };

  ConversationView.prototype.onWindowResize = function() {
    this.uncoverAndroidInput(this.$el.find('.convo-input-bottom input, .convo-input-bottom textarea'));
    if (this.convoAppBannerView) {
      this.convoAppBannerView.dispose();
      this.attachBanner();
      return this.openMobileConvo();
    }
  };

  ConversationView.prototype.attachBanner = function() {
    var subviewContainer, subviewContainerMethod;
    subviewContainer = $(window).width() <= 768 ? $('.convo-banner') : $('#app-container');
    subviewContainerMethod = $(window).width() <= 768 ? 'html' : 'append';
    this.convoAppBannerView = new ConvoAppBannerV({
      autoRender: true,
      container: subviewContainer,
      containerMethod: subviewContainerMethod
    });
    return this.subview('banner', this.convoAppBannerView);
  };

  ConversationView.prototype.onMessageCompositionStart = function(e) {
    return this.composing = true;
  };

  ConversationView.prototype.onMessageCompositionEnd = function(e) {
    return this.composing = false;
  };

  ConversationView.prototype.render = function() {
    ConversationView.__super__.render.apply(this, arguments);
    utils.verticalPush(this.$el);
    return _.defer((function(_this) {
      return function() {
        return utils.verticalPush(_this.$el, 0);
      };
    })(this));
  };

  ConversationView.prototype.dispose = function() {
    utils.verticalPush(this.$el);
    return setTimeout((function(_this) {
      return function() {
        return ConversationView.__super__.dispose.apply(_this, arguments);
      };
    })(this), 1000);
  };

  return ConversationView;

})(InputPanelView);


},{"../../lib/panel":125,"../../lib/utils":156,"../../templates/conversations/conversation.hbs":"wS2lun","../base/input-panel-view":607,"../convo-app-banner-view":624,"./block-view":610,"./invites-mobile-view":615,"./participants-view":623,"chaplin":773,"jquery":774,"lodash":776}],613:[function(require,module,exports){
var EventView, ParticipantThumbnailView, View, autolinker, mediator, storeTotal, total, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

mediator = require('chaplin').mediator;

ParticipantThumbnailView = require('./participant-thumbnail-view');

autolinker = require('autolinker');

utils = require('../../lib/utils');

_ = require('lodash');

total = 1;

storeTotal = _.once(function(num) {
  return total = num;
});

module.exports = EventView = (function(_super) {
  __extends(EventView, _super);

  function EventView() {
    return EventView.__super__.constructor.apply(this, arguments);
  }

  EventView.prototype.className = 'col-xs-12 event-item';

  EventView.prototype.listen = {
    'addedToParent': 'onAddedToParent'
  };

  EventView.prototype.commentLink = function() {
    var $msgText, linkedText, text;
    if (this.model.get('type') === 'comment') {
      $msgText = this.$el.find('.message-text');
      text = utils.stripHtml($msgText.text());
      linkedText = autolinker.link(text);
      return $msgText.html(linkedText);
    }
  };

  EventView.prototype.getTemplate = function() {
    var type;
    type = this.model.get('type');
    if (type === 'invite') {
      return require("../../templates/conversations/event-invite");
    } else if (type === 'comment') {
      return require("../../templates/conversations/event-comment");
    } else if (type === 'create') {
      return require("../../templates/conversations/event-create");
    }
  };

  EventView.prototype.render = function() {
    var type;
    EventView.__super__.render.apply(this, arguments);
    type = this.model.get('type');
    if (type === 'comment' || type === 'create') {
      return this.subview('participant-thumbnail', new ParticipantThumbnailView({
        container: this.$el.find('.user-thumbnail'),
        model: this.model.get('_createdByParticipantM')
      }));
    }
  };

  EventView.prototype.onAddedToParent = function() {
    var delay, index, _ref, _ref1, _ref2, _ref3, _ref4;
    storeTotal((_ref = this.model) != null ? (_ref1 = _ref.collection) != null ? _ref1.length : void 0 : void 0);
    index = (_ref2 = this.$el) != null ? _ref2.index() : void 0;
    delay = utils.isAndroid() ? 1000 : 300;
    if (index >= total) {
      if ((_ref3 = this.$el) != null) {
        if ((_ref4 = _ref3.find('.message-row')) != null) {
          _ref4.addClass('popable');
        }
      }
      return this.setTimeout((function(_this) {
        return function() {
          var _ref5, _ref6;
          return (_ref5 = _this.$el) != null ? (_ref6 = _ref5.find('.message-row')) != null ? _ref6.addClass('pop') : void 0 : void 0;
        };
      })(this), delay);
    }
  };

  return EventView;

})(View);


},{"../../lib/utils":156,"../../templates/conversations/event-comment":"GDieB0","../../templates/conversations/event-create":"gSF+Uz","../../templates/conversations/event-invite":"XRA0Mh","../base/view":608,"./participant-thumbnail-view":621,"autolinker":771,"chaplin":773,"lodash":776}],614:[function(require,module,exports){
var $, CollectionView, EventV, EventsView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('../base/collection-view');

EventV = require('./event-view');

$ = require('jquery');

module.exports = EventsView = (function(_super) {
  __extends(EventsView, _super);

  function EventsView() {
    return EventsView.__super__.constructor.apply(this, arguments);
  }

  EventsView.prototype.itemView = EventV;

  EventsView.prototype.template = function() {
    return '';
  };

  EventsView.prototype.listen = {
    'add collection': 'delayScroll',
    'window:resize mediator': 'scrollToChatBottom'
  };

  EventsView.prototype.delayScroll = function() {
    return this.setTimeout((function(_this) {
      return function() {
        if (!_this.disposed) {
          return _this.scrollToChatBottom();
        }
      };
    })(this), 25);
  };

  EventsView.prototype.attach = function() {
    EventsView.__super__.attach.apply(this, arguments);
    return this.delayScroll();
  };

  EventsView.prototype.scrollToChatBottom = function() {
    return $('.event-list').scrollTop(999999);
  };

  return EventsView;

})(CollectionView);


},{"../base/collection-view":606,"./event-view":613,"jquery":774}],615:[function(require,module,exports){
var $, InvitesView, InvitesViewMobile, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

InvitesView = require('./invites-view');

template = require('../../templates/conversations/invite-mobile');

module.exports = InvitesViewMobile = (function(_super) {
  __extends(InvitesViewMobile, _super);

  function InvitesViewMobile() {
    return InvitesViewMobile.__super__.constructor.apply(this, arguments);
  }

  InvitesViewMobile.prototype.template = template;

  InvitesViewMobile.prototype.listSelector = '.invite-list';

  InvitesViewMobile.prototype.getTaggleID = function() {
    return 'invite-to-mobile';
  };

  return InvitesViewMobile;

})(InvitesView);


},{"../../templates/conversations/invite-mobile":"wGBM6u","./invites-view":616,"jquery":774}],616:[function(require,module,exports){
var $, CollectionView, ContactV, InvitesView, LoadingInvitesView, ShareSocialModel, ShareSocialView, TagView, mediator, panel, template, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

_ = require('lodash');

CollectionView = require('../base/collection-view');

template = require('../../templates/conversations/invite');

mediator = require('chaplin').mediator;

utils = require('../../lib/utils');

ContactV = require('./contact-view');

panel = require('../../lib/panel');

LoadingInvitesView = require('./loading-invites-view');

ShareSocialModel = require('../../models/share-social-model');

ShareSocialView = require('../share-social-view');

TagView = require('../tags-view');

module.exports = InvitesView = (function(_super) {
  __extends(InvitesView, _super);

  function InvitesView() {
    return InvitesView.__super__.constructor.apply(this, arguments);
  }

  InvitesView.prototype.autoRender = true;

  InvitesView.prototype.renderItems = true;

  InvitesView.prototype.template = template;

  InvitesView.prototype.itemView = ContactV;

  InvitesView.prototype.listSelector = '.invites-container';

  InvitesView.prototype.showSocial = false;

  InvitesView.prototype.events = {
    'click [data-id=convo-send-invite]:not(.disabled)': 'onClickInvite',
    'click [data-id=convo-cancel-invite]': 'onCancelInvite',
    'click [data-id=invite-mobile-send]:not(.disabled)': 'onClickInvite',
    'click #invite-to': 'onInviteFocus'
  };

  InvitesView.prototype.listen = {
    'dispatcher:dispatch mediator': 'onDispatch',
    'add collection': 'onCollectionAdd',
    'change collection': 'onCollectionChange',
    'invites-tag-view:tag-added mediator': 'onTagAdded',
    'invites-tag-view:tag-removed mediator': 'onTagRemoved',
    'invites-tag-view:new-text mediator': 'onNewText',
    'invites-tag-view:redraw mediator': 'onNewText',
    'invites-tag-view:delete-key mediator': 'onNewText',
    'invites-tag-view:arrow-right mediator': 'onArrowRight',
    'invites-tag-view:arrow-down mediator': 'onArrowDown',
    'invites-tag-view:arrow-up mediator': 'onArrowUp',
    'invites-tag-view:tab-key mediator': 'onTabKey',
    'invites-tag-view:enter-key mediator': 'onEnterKey',
    'invites-tag-view:escape-key mediator': 'onEscapeKey'
  };

  InvitesView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    InvitesView.__super__.initialize.apply(this, arguments);
    this.filter();
    if (typeof options.showSocial !== 'undefined') {
      return this.showSocial = options.showSocial;
    }
  };

  InvitesView.prototype.attach = function() {
    var eventPrefix, placeholder, shareSocialM, tagExtractorFn;
    InvitesView.__super__.attach.apply(this, arguments);
    eventPrefix = 'invites-tag-view';
    placeholder = 'Invite a Stumbler or email address';
    tagExtractorFn = function(models) {
      var tags;
      tags = _.filter(models, function(model) {
        return model.isQueuedForInvite() || false;
      });
      tags = _.sortBy(tags, function(participant) {
        return participant.get('_tagSortIndex');
      });
      tags = _.map(tags, function(model) {
        return model.get('_name') || model.get('_email');
      });
      return tags;
    };
    this.subview('tag-view', new TagView({
      container: this.getTaggleID(),
      collection: this.collection,
      eventPrefix: 'invites-tag-view',
      placeholder: placeholder,
      tagExtractorFn: tagExtractorFn
    }));
    if (this.showSocial) {
      shareSocialM = new ShareSocialModel();
      return this.subview('social-share', new ShareSocialView({
        container: '.social-container',
        model: shareSocialM,
        containerMethod: 'prepend'
      }));
    }
  };

  InvitesView.prototype.onTagAdded = function(data) {
    if (!this.commitSelected()) {
      if (data.emailTag) {
        return this.collection.queueForInvite(data.newTag);
      } else {
        return this.select();
      }
    }
  };

  InvitesView.prototype.onTagRemoved = function(data) {
    return this.collection.dequeueForInvite(data.oldTag);
  };

  InvitesView.prototype.onNewText = function(data) {
    return this.filter(data.newText);
  };

  InvitesView.prototype.onArrowRight = function(data) {
    return this.commitSelected();
  };

  InvitesView.prototype.onArrowDown = function(data) {
    return this.select(1);
  };

  InvitesView.prototype.onArrowUp = function(data) {
    return this.select(-1);
  };

  InvitesView.prototype.onTabKey = function(data) {
    return this.commitSelected();
  };

  InvitesView.prototype.onEnterKey = function(data) {
    return this.commitSelected();
  };

  InvitesView.prototype.onEscapeKey = function(data) {
    return this.clearSelection();
  };

  InvitesView.prototype.onDispatch = function(data) {
    return this.collection.dequeueAll();
  };

  InvitesView.prototype.onCollectionAdd = function(model) {
    if (model.isInvitable()) {
      this.invitableCount++;
    }
    this.onCollectionChange();
    return this.showAll();
  };

  InvitesView.prototype.onCollectionChange = function(model) {
    if (panel.getCurrentPanel() === 'conversation') {
      if (this.collection.findWhere({
        '_queued': true
      })) {
        this.$el.find('[data-id=convo-send-invite]').removeClass('disabled');
        this.$el.find('.invitesend').removeClass('disabled');
      } else {
        this.$el.find('[data-id=convo-send-invite]').addClass('disabled');
        this.$el.find('.invitesend').addClass('disabled');
      }
    }
    return this.scrollToLastUser();
  };

  InvitesView.prototype.scrollToLastUser = function() {
    this.$el.find('.input-top').scrollTop(Infinity);
    if (utils.isiOS()) {
      return this.$el.find('.taggle_list').scrollLeft(Infinity);
    }
  };

  InvitesView.prototype.hideInviteMore = function() {
    this.trigger('invite-more-closed');
    $('.invite-container').addClass('hidden');
    $('.participant-container').removeClass('hidden');
    return this.$el.find('[data-id=convo-send-invite]').addClass('hidden');
  };

  InvitesView.prototype.onCancelInvite = function() {
    this.hideInviteMore();
    return this.collection.dequeueAll();
  };

  InvitesView.prototype.onClickInvite = function() {
    this.hideInviteMore();
    this.collection.inviteQueuedToConversation();
    return this.collection.dequeueAll();
  };

  InvitesView.prototype.onInviteFocus = function() {
    if (utils.isiOS()) {
      return setTimeout(function() {
        return $(window).scrollLeft(0);
      }, 100);
    }
  };

  InvitesView.prototype.showAll = function() {
    return this.subviews.forEach((function(_this) {
      return function(view) {
        var _ref;
        return view != null ? (_ref = view.$el) != null ? _ref.show() : void 0 : void 0;
      };
    })(this));
  };

  InvitesView.prototype.filter = function(value) {
    this.invitableCount = 0;
    this.selectedIndex = 0;
    if (value) {
      return this.subviews.forEach((function(_this) {
        return function(view) {
          var found, invitable, name, re, username, _ref, _ref1, _ref2, _ref3, _ref4;
          re = new RegExp(value, 'i');
          name = ((_ref = view.model) != null ? _ref.get('_name') : void 0) || '';
          username = ((_ref1 = view.model) != null ? _ref1.get('suUserName') : void 0) || '';
          invitable = (_ref2 = view.model) != null ? typeof _ref2.isInvitable === "function" ? _ref2.isInvitable() : void 0 : void 0;
          found = re.test(name) || re.test(username);
          if (view != null) {
            if ((_ref3 = view.$el) != null) {
              _ref3.toggle(found);
            }
          }
          if (view != null) {
            if ((_ref4 = view.$el) != null) {
              _ref4.removeClass('selected');
            }
          }
          if (found && invitable) {
            return _this.invitableCount++;
          }
        };
      })(this));
    } else {
      return this.subviews.forEach((function(_this) {
        return function(view) {
          var invitable, _ref, _ref1, _ref2;
          if (view != null) {
            if ((_ref = view.$el) != null) {
              _ref.toggle(true);
            }
          }
          if (view != null) {
            if ((_ref1 = view.$el) != null) {
              _ref1.removeClass('selected');
            }
          }
          invitable = (_ref2 = view.model) != null ? typeof _ref2.isInvitable === "function" ? _ref2.isInvitable() : void 0 : void 0;
          if (invitable) {
            return _this.invitableCount++;
          }
        };
      })(this));
    }
  };

  InvitesView.prototype.select = function(relativeIndex) {
    var index, invitableCount, visibleIndex;
    index = this.selectedIndex || 0;
    index += relativeIndex;
    invitableCount = this.invitableCount || this.collection.length;
    index = Math.min(invitableCount, index);
    index = Math.max(1, index);
    this.selectedIndex = index;
    visibleIndex = 0;
    return this.subviews.forEach((function(_this) {
      return function(view) {
        var $el, isVisible, _ref, _ref1;
        if (!(view instanceof ContactV)) {
          return;
        }
        $el = view.$el;
        if (!$el) {
          return;
        }
        if (!((_ref = view.model) != null ? _ref.isInvitable() : void 0)) {
          return;
        }
        isVisible = $el.is(':visible');
        if (isVisible) {
          visibleIndex++;
        }
        if (isVisible && index === visibleIndex) {
          _this.selectedView = view;
          $el.addClass('selected');
          return (_ref1 = $el.get(0)) != null ? typeof _ref1.scrollIntoView === "function" ? _ref1.scrollIntoView(false) : void 0 : void 0;
        } else {
          return $el.removeClass('selected');
        }
      };
    })(this));
  };

  InvitesView.prototype.commitSelected = function() {
    var model, tagSortIndex, _ref;
    if (this.invitableCount === 1) {
      this.select(1);
    }
    if (!this.selectedView) {
      return false;
    }
    model = (_ref = this.selectedView) != null ? _ref.model : void 0;
    if (model != null) {
      model.queueForInvite();
    }
    tagSortIndex = this.selectedCount || 0;
    this.selectedCount = tagSortIndex + 1;
    if (model != null) {
      model.set('_tagSortIndex', tagSortIndex);
    }
    this.selectedView = null;
    return true;
  };

  InvitesView.prototype.clearSelection = function() {
    this.selectedView = null;
    this.selectedIndex = 0;
    return this.subviews.forEach((function(_this) {
      return function(view) {
        var _ref;
        return view != null ? (_ref = view.$el) != null ? _ref.removeClass('selected') : void 0 : void 0;
      };
    })(this));
  };

  InvitesView.prototype.getTaggleID = function() {
    return 'invite-to';
  };

  InvitesView.prototype.getRequestMixin = function(options) {
    var _ref;
    options = options || {};
    options.data = options.data || {};
    options.data.userid = (_ref = mediator.userM) != null ? _ref.get('userid') : void 0;
    return options;
  };

  InvitesView.prototype.getScrollElement = function() {
    return this.$el.find(this.listSelector).parent();
  };

  return InvitesView;

})(CollectionView);


},{"../../lib/panel":125,"../../lib/utils":156,"../../models/share-social-model":237,"../../templates/conversations/invite":"eWqpRj","../base/collection-view":606,"../share-social-view":716,"../tags-view":726,"./contact-view":611,"./loading-invites-view":617,"chaplin":773,"jquery":774,"lodash":776}],617:[function(require,module,exports){
var LoadingIndicatorView, LoadingInvitesView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

LoadingIndicatorView = require('../loading-indicator-view');

template = require('../../templates/conversations/loading-invites');

module.exports = LoadingInvitesView = (function(_super) {
  __extends(LoadingInvitesView, _super);

  function LoadingInvitesView() {
    return LoadingInvitesView.__super__.constructor.apply(this, arguments);
  }

  LoadingInvitesView.prototype.template = template;

  LoadingInvitesView.prototype.disposeOnAdd = true;

  return LoadingInvitesView;

})(LoadingIndicatorView);


},{"../../templates/conversations/loading-invites":"jni7cJ","../loading-indicator-view":659}],618:[function(require,module,exports){
var LoadingIndicatorView, LoadingParticipantsView, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

LoadingIndicatorView = require('../loading-indicator-view');

mediator = require('chaplin').mediator;

module.exports = LoadingParticipantsView = (function(_super) {
  __extends(LoadingParticipantsView, _super);

  function LoadingParticipantsView() {
    return LoadingParticipantsView.__super__.constructor.apply(this, arguments);
  }

  LoadingParticipantsView.prototype.initialize = function() {
    LoadingParticipantsView.__super__.initialize.apply(this, arguments);
    return mediator.subscribe('participants:blocked', this.onBlockedParticpants, this);
  };

  LoadingParticipantsView.prototype.onBlockedParticpants = function() {
    if (this.collection.length === 0) {
      this.hideView();
      return this.dispose();
    }
  };

  LoadingParticipantsView.prototype.dispose = function() {
    LoadingParticipantsView.__super__.dispose.apply(this, arguments);
    return mediator.unsubscribe('participants:blocked', this.onBlockedParticpants, this);
  };

  return LoadingParticipantsView;

})(LoadingIndicatorView);


},{"../loading-indicator-view":659,"chaplin":773}],619:[function(require,module,exports){
var $, MobileParticipant, ParticipantThumbnailView, View, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

View = require('../base/view');

mediator = require('chaplin').mediator;

template = require('../../templates/conversations/mobile-participant');

ParticipantThumbnailView = require('./participant-thumbnail-view');

module.exports = MobileParticipant = (function(_super) {
  __extends(MobileParticipant, _super);

  function MobileParticipant() {
    return MobileParticipant.__super__.constructor.apply(this, arguments);
  }

  MobileParticipant.prototype.template = template;

  MobileParticipant.prototype.autoRender = true;

  MobileParticipant.prototype.className = 'participant-item';

  MobileParticipant.prototype.render = function() {
    MobileParticipant.__super__.render.apply(this, arguments);
    return this.subview('user-thumbnail', new ParticipantThumbnailView({
      container: this.$el.find('.user-thumbnail'),
      model: this.model
    }));
  };

  return MobileParticipant;

})(View);


},{"../../templates/conversations/mobile-participant":"AeJ6AV","../base/view":608,"./participant-thumbnail-view":621,"chaplin":773,"jquery":774}],620:[function(require,module,exports){
var $, CollectionView, MobileParticipantView, MobileParticipantsView, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('../base/collection-view');

mediator = require('chaplin').mediator;

$ = require('jquery');

MobileParticipantView = require('./mobile-participant-view');

module.exports = MobileParticipantsView = (function(_super) {
  __extends(MobileParticipantsView, _super);

  function MobileParticipantsView() {
    return MobileParticipantsView.__super__.constructor.apply(this, arguments);
  }

  MobileParticipantsView.prototype.autoRender = true;

  MobileParticipantsView.prototype.container = '.mobile-participants';

  MobileParticipantsView.prototype.itemView = MobileParticipantView;

  return MobileParticipantsView;

})(CollectionView);


},{"../base/collection-view":606,"./mobile-participant-view":619,"chaplin":773,"jquery":774}],621:[function(require,module,exports){
var $, ParticipantThumbnail, View, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

View = require('../base/view');

mediator = require('chaplin').mediator;

template = require('../../templates/conversations/participant-thumbnail');

module.exports = ParticipantThumbnail = (function(_super) {
  __extends(ParticipantThumbnail, _super);

  function ParticipantThumbnail() {
    return ParticipantThumbnail.__super__.constructor.apply(this, arguments);
  }

  ParticipantThumbnail.prototype.template = template;

  ParticipantThumbnail.prototype.autoRender = true;

  ParticipantThumbnail.prototype.defaultThumbnail = "WcjiEMsHQiBUV9Q-ZK4lDg";

  ParticipantThumbnail.prototype.hideDefaultThumbnail = true;

  ParticipantThumbnail.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    if (typeof options.hideDefaultThumbnail !== 'undefined') {
      this.hideDefaultThumbnail = options.hideDefaultThumbnail;
    }
    this.setThumbnail();
    return ParticipantThumbnail.__super__.initialize.apply(this, arguments);
  };

  ParticipantThumbnail.prototype.setThumbnail = function() {
    var thumbnail, _ref, _ref1;
    thumbnail = ((_ref = this.model) != null ? _ref.get('thumbnail') : void 0) || this.defaultThumbnail;
    if (this.hideDefaultThumbnail && thumbnail.indexOf(this.defaultThumbnail) !== -1) {
      thumbnail = null;
    }
    if (!this.hideDefaultThumbnail && !thumbnail) {
      thumbnail = 'https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg';
    }
    return (_ref1 = this.model) != null ? _ref1.set('_thumbnail', thumbnail) : void 0;
  };

  return ParticipantThumbnail;

})(View);


},{"../../templates/conversations/participant-thumbnail":"aqcPfP","../base/view":608,"chaplin":773,"jquery":774}],622:[function(require,module,exports){
var $, FollowModel, ParticipantThumbnailView, ParticipantView, View, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

View = require('../base/view');

mediator = require('chaplin').mediator;

template = require('../../templates/conversations/participant');

ParticipantThumbnailView = require('./participant-thumbnail-view');

FollowModel = require('../../models/follow-model');

module.exports = ParticipantView = (function(_super) {
  __extends(ParticipantView, _super);

  function ParticipantView() {
    return ParticipantView.__super__.constructor.apply(this, arguments);
  }

  ParticipantView.prototype.template = template;

  ParticipantView.prototype.autoRender = true;

  ParticipantView.prototype.className = 'participant-item';

  ParticipantView.prototype.events = {
    'click .follow-user': 'onFollowClick'
  };

  ParticipantView.prototype.listen = {
    'change:_queued model': 'render',
    'change:_notFollowed': 'render'
  };

  ParticipantView.prototype.onFollowClick = function() {
    var followM, userid;
    if (this.model.get('suUserId')) {
      userid = this.model.get('suUserId');
      followM = new FollowModel({
        userid: userid
      });
      this.$el.find('.fa-user-plus').removeClass('fa-user-plus').addClass('fa-spin fa-circle-o-notch');
      this.model.set('_notFollowed', false);
      return followM.save().then((function(_this) {
        return function(resp) {
          if (resp._success) {
            return _this.$el.find('.follow-user').addClass('followed').find('.fa-spin').removeClass('fa-spin fa-circle-o-notch').addClass('fa-check');
          } else {
            return _this.$el.find('.fa-spin').removeClass('fa-spin fa-circle-o-notch').addClass('fa-user-plus');
          }
        };
      })(this));
    }
  };

  ParticipantView.prototype.render = function() {
    ParticipantView.__super__.render.apply(this, arguments);
    return this.subview('user-thumbnail', new ParticipantThumbnailView({
      container: this.$el.find('.user-thumbnail'),
      model: this.model
    }));
  };

  return ParticipantView;

})(View);


},{"../../models/follow-model":180,"../../templates/conversations/participant":"chmTLy","../base/view":608,"./participant-thumbnail-view":621,"chaplin":773,"jquery":774}],623:[function(require,module,exports){
var $, CollectionView, ParticipantV, ParticipantsView, mediator, template, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

_ = require('lodash');

CollectionView = require('../base/collection-view');

template = require('../../templates/conversations/participants');

ParticipantV = require('./participant-view');

mediator = require('chaplin').mediator;

module.exports = ParticipantsView = (function(_super) {
  __extends(ParticipantsView, _super);

  function ParticipantsView() {
    return ParticipantsView.__super__.constructor.apply(this, arguments);
  }

  ParticipantsView.prototype.autoRender = true;

  ParticipantsView.prototype.renderItems = true;

  ParticipantsView.prototype.template = template;

  ParticipantsView.prototype.itemView = ParticipantV;

  ParticipantsView.prototype.listSelector = '.participant-items';

  ParticipantsView.prototype.container = '.mobile-participants';

  ParticipantsView.prototype.events = {
    'click [data-id=invite-more]': 'onClickInviteMore'
  };

  ParticipantsView.prototype.listen = {
    'participants:invited mediator': 'onParticipantsInvited'
  };

  ParticipantsView.prototype.onClickInviteMore = function() {
    $('.participant-container').addClass('hidden');
    $('.invite-container').removeClass('hidden');
    return mediator.publish('invitemore:clicked');
  };

  ParticipantsView.prototype.onParticipantsInvited = function(participants) {
    var participant, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = participants.length; _i < _len; _i++) {
      participant = participants[_i];
      _results.push(this.collection.add(participant));
    }
    return _results;
  };

  return ParticipantsView;

})(CollectionView);


},{"../../templates/conversations/participants":"ELjGRo","../base/collection-view":606,"./participant-view":622,"chaplin":773,"jquery":774,"lodash":776}],624:[function(require,module,exports){
var $, ConvoAppView, View, mediator, template, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/convo-app-banner');

View = require('./base/view');

utils = require('../lib/utils');

$ = require('jquery');

mediator = require('chaplin').mediator;

module.exports = ConvoAppView = (function(_super) {
  __extends(ConvoAppView, _super);

  function ConvoAppView() {
    return ConvoAppView.__super__.constructor.apply(this, arguments);
  }

  ConvoAppView.prototype.template = template;

  ConvoAppView.prototype.autoRender = true;

  ConvoAppView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  ConvoAppView.prototype.onAddedToDOM = function() {
    if (utils.isiOS()) {
      this.$el.find('.download-url').attr("href", utils.getMobileDownloadLink('ios', 'convo'));
    }
    if (utils.isAndroid()) {
      return this.$el.find('.download-url').attr("href", utils.getMobileDownloadLink('android', 'convo'));
    }
  };

  return ConvoAppView;

})(View);


},{"../lib/utils":156,"../templates/convo-app-banner":"Y9MR1R","./base/view":608,"chaplin":773,"jquery":774}],625:[function(require,module,exports){
var CreateListItemEntryView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/create-list-item-entry');

module.exports = CreateListItemEntryView = (function(_super) {
  __extends(CreateListItemEntryView, _super);

  function CreateListItemEntryView() {
    return CreateListItemEntryView.__super__.constructor.apply(this, arguments);
  }

  CreateListItemEntryView.prototype.tagName = 'li';

  CreateListItemEntryView.prototype.className = 'dropdown-item dropdown-create-list-item-entry';

  CreateListItemEntryView.prototype.template = template;

  CreateListItemEntryView.prototype.containerMethod = 'prepend';

  return CreateListItemEntryView;

})(View);


},{"../templates/create-list-item-entry":"yF4o8J","./base/view":608}],626:[function(require,module,exports){
var $, CreateListView, View, i18n, mediator, panel, template, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/create-list');

mediator = require('chaplin').mediator;

i18n = require('../lib/i18n');

$ = require('jquery');

_ = require('lodash');

panel = require('../lib/panel');

module.exports = CreateListView = (function(_super) {
  __extends(CreateListView, _super);

  function CreateListView() {
    return CreateListView.__super__.constructor.apply(this, arguments);
  }

  CreateListView.prototype.autoRender = true;

  CreateListView.prototype.className = 'createlist-wrapper';

  CreateListView.prototype.template = template;

  CreateListView.prototype.region = 'panel';

  CreateListView.prototype.events = {
    'click .modal-close': function() {
      return panel.close();
    },
    'click #list-cancel': function() {
      return this.publishEvent('list:displayadd');
    },
    'click #list-save': 'saveNewList'
  };

  CreateListView.prototype.listen = {
    'list:itemadded mediator': 'onItemAdded',
    'list:itemadded:error mediator': 'onItemAddedError',
    'list:itemadded:error mediator': 'onLoadingEnd',
    'list:loading:end mediator': 'onLoadingEnd',
    'model:sync:start mediator': 'onLoadingStart'
  };

  CreateListView.prototype.saveNewList = function() {
    this.model.set({
      name: $.trim($('#list-edit-name').val()),
      description: $.trim($('#list-edit-description').val()),
      visibility: $('input:radio[name=visibility]:checked').val(),
      userid: mediator.userM.get('userid')
    });
    if (this.model.get('name')) {
      return this.model.save().error((function(_this) {
        return function() {
          _this.publishEvent('list:loading:end');
          return _this.onListCreateError(_this.model);
        };
      })(this));
    } else {
      return this.displayMsg(i18n('LIST_NAME_EMPTY'));
    }
  };

  CreateListView.prototype.onLoadingStart = function(model) {
    var _ref;
    if (model === this.model) {
      return (_ref = this.$el) != null ? _ref.find('.spinner').removeClass('hidden') : void 0;
    }
  };

  CreateListView.prototype.onLoadingEnd = function() {
    var _ref;
    return (_ref = this.$el) != null ? _ref.find('.spinner').addClass('hidden') : void 0;
  };

  CreateListView.prototype.onItemAdded = function(listM) {
    var msg;
    msg = i18n('ADDED_TO') + ' ' + (listM != null ? listM.get('name') : void 0);
    return this.displayMsg(msg);
  };

  CreateListView.prototype.onListCreateError = function(listM) {
    var msg;
    msg = (listM != null ? listM.get('name') : void 0) + ' ' + i18n('ALREADY_EXISTS');
    return this.displayMsg(msg);
  };

  CreateListView.prototype.onItemAddedError = function(listM) {
    return this.displayMsg(i18n('ALREADY_IN_LIST'));
  };

  CreateListView.prototype.displayMsg = _.debounce(function(msg) {
    return panel.open('alert', {
      type: 'success',
      text: msg
    });
  }, 1000);

  return CreateListView;

})(View);


},{"../lib/i18n":121,"../lib/panel":125,"../templates/create-list":"gyUW2M","./base/view":608,"chaplin":773,"jquery":774,"lodash":776}],627:[function(require,module,exports){
var BaseViewDecorator, CheckableItemViewDecorator, props, template, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

BaseViewDecorator = require('./decorator');

template = require('../../templates/widgets/checkable-item');

_ = require('lodash');


/*
 * This props object is a collection of methods defined here and exported as the 'static' @props property of the constructor (NOT
 * the prototype.) to be used at construction of a decorated object.
 */

props = {
  checkable: function() {
    return true;
  },
  template: function(decoratedTemplate) {
    return decoratedTemplate || template;
  },
  className: function(decoratedClassName) {
    var className;
    className = decoratedClassName || '';
    return className + ' item checkable-item';
  },
  events: function(decoratedEvents) {
    return _.merge({}, decoratedEvents, {
      'click': 'onClickItem'
    });
  },
  listen: function(decoratedListeners) {
    return _.merge({}, decoratedListeners, {
      'change:checked model': 'setCheckedState'
    });
  },
  onClickItem: function(decoratedMethod) {
    return function(e) {
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      return this.model.toggleChecked();
    };
  },
  setCheckedState: function(decoratedMethod) {
    return function(e) {
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      if (!this.disposed) {
        this.$el.toggleClass('checked', this.model.getChecked() || false);
        if (this.$el.find('span.fa-check').length === 0) {
          return this.$el.append('<span class="fa fa-check"></span>');
        }
      }
    };
  },
  render: function(decoratedMethod) {
    return function(e) {
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      return this.setCheckedState();
    };
  }
};

module.exports = CheckableItemViewDecorator = (function(_super) {
  __extends(CheckableItemViewDecorator, _super);

  function CheckableItemViewDecorator() {
    return CheckableItemViewDecorator.__super__.constructor.apply(this, arguments);
  }

  CheckableItemViewDecorator.props = props;

  return CheckableItemViewDecorator;

})(BaseViewDecorator);


},{"../../templates/widgets/checkable-item":"cwmSEi","./decorator":629,"lodash":776}],628:[function(require,module,exports){
var $, BaseViewDecorator, ContinuousScrollListViewDecorator, config, props, utils, waitspinnertemplate, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

BaseViewDecorator = require('./decorator');

$ = require('jquery');

_ = require('lodash');

waitspinnertemplate = require('../../templates/decorators/wait-spinner.hbs');

config = require('../../config');

utils = require('../../lib/utils');


/*
 * This props object is a collection of methods defined here and exported as the 'static' @props property of the constructor (NOT
 * the prototype.) to be used at construction of a decorated object.
 */

props = {
  continuouslyScrollable: function() {
    return true;
  },
  pageSize: function(decoratedPageSize) {
    return decoratedPageSize || 10;
  },
  fillFactor: function(decoratedFillFactor) {
    return decoratedFillFactor || 1.5;
  },
  _exhausted: function() {
    return function() {
      if (!this.collection) {
        return false;
      }
      return this.collection.isExhausted || (this.collection.lastFetchedCount === 0);
    };
  },
  _atMaxItems: function() {
    return function() {
      return (this.collection.lastFetchedOffset || 0) + this.collection.lastFetchedCount >= config.continuousScrollMaxItems;
    };
  },
  className: function(decoratedClassName) {
    var className;
    className = decoratedClassName || '';
    return className + ' continuous-scroll';
  },
  attach: function(decoratedMethod) {
    return function() {
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      this._scrollEl = this.getScrollElement();
      this._scrollEl.on('scroll', this.onScroll);
      this._loadingEl = $(waitspinnertemplate()).appendTo(this._scrollEl);
      return this.beginFetching();
    };
  },
  beginFetching: function(decoratedMethod) {
    return function() {
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      this._fetching(true);
      this.listenTo(this.collection, 'sync', this.onSync);
      this.listenTo(this.collection, 'error', this.onSyncError);
      if (this.collection.length || (this.collection.length === 0 && this.collection.hasFetched())) {
        this._fetching(false);
        return this.continueFetching();
      }
    };
  },
  dispose: function(decoratedMethod) {
    return function() {
      var _ref, _ref1;
      if ((_ref = this._scrollEl) != null) {
        _ref.off('scroll', this.onScroll);
      }
      if ((_ref1 = this._loadingEl) != null) {
        _ref1.remove();
      }
      delete this._scrollEl;
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      return this.constructor.__super__.dispose.apply(this, arguments);
    };
  },
  getScrollElement: function(decoratedMethod) {
    return function() {
      var _ref;
      if (decoratedMethod) {
        return decoratedMethod.apply(this, arguments);
      } else {
        return (_ref = this.$el) != null ? _ref.parent() : void 0;
      }
    };
  },
  onScroll: function(decoratedMethod) {
    return function(e) {
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      if (!this.disposed) {
        if (this.shouldFetchNext()) {
          return this.fetchNext();
        }
      }
    };
  },
  nearTheBottom: function(decoratedMethod) {
    return function() {
      var scrollEl;
      if (decoratedMethod) {
        return decoratedMethod.apply(this, arguments);
      } else {
        scrollEl = this._scrollEl;
        if (!scrollEl) {
          return false;
        }
        return utils.contentScrolledNearBottomEdge(scrollEl, this.fillFactor);
      }
    };
  },
  _fetching: function(decoratedMethod) {
    return function(newValue) {
      if (newValue == null) {
        newValue = null;
      }
      if (newValue === null) {
        return this._busy;
      } else {
        this._loadingEl.toggleClass('spinner-bar', newValue);
        if (newValue) {
          this.publishEvent('continuous-scroll-view:fetch-start');
        } else {
          this.publishEvent('continuous-scroll-view:fetch-end');
        }
        this.$el.toggleClass('fetching', newValue);
        return this._busy = newValue;
      }
    };
  },
  shouldFetchNext: function(decoratedMethod) {
    return function() {
      if (decoratedMethod) {
        return decoratedMethod.apply(this, arguments);
      } else {
        if (this._atMaxItems()) {
          Chaplin.mediator.publish('scroll-view:maxed-out');
        }
        return this.nearTheBottom() && !this._exhausted() && !this._fetching();
      }
    };
  },
  fetchNext: function(decoratedMethod) {
    return function() {
      var offset, options;
      if (decoratedMethod) {
        return decoratedMethod.apply(this, arguments);
      } else {
        this._fetching(true);
        offset = utils.getNextCollectionOffset(this.collection);
        options = {
          reset: false,
          remove: false,
          error: (function(_this) {
            return function() {
              _this.collection.isExhausted = true;
              return _this._exhausted();
            };
          })(this),
          data: {
            offset: offset,
            limit: this.pageSize
          }
        };
        options.data = _.extend({}, options.data, this.getRequestMixin(options));
        return this.collection.fetch(options);
      }
    };
  },
  shouldContinueFetching: function(decoratedMethod) {
    return function() {
      if (decoratedMethod) {
        return decoratedMethod.apply(this, arguments);
      } else {
        return this.nearTheBottom() && !this._exhausted() && !this._fetching();
      }
    };
  },
  continueFetching: function(decoratedMethod) {
    return function() {
      if (decoratedMethod) {
        return decoratedMethod.apply(this, arguments);
      } else {
        if (this.shouldContinueFetching()) {
          return this.fetchNext();
        }
      }
    };
  },
  onSync: function(decoratedMethod) {
    return function() {
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      this._fetching(false);
      return this.continueFetching();
    };
  },
  onSyncError: function(decoratedMethod) {
    return function() {
      var attempts;
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      this._fetching(false);
      attempts = this._failedSyncAttempts || 0;
      if (++attempts < 5) {
        this.continueFetching();
      }
      return this._failedSyncAttempts = attempts;
    };
  },
  getRequestMixin: function(decoratedMethod) {
    return function(options) {
      if (decoratedMethod) {
        return decoratedMethod.apply(this, arguments);
      } else {
        throw new Error("Class '" + this._decoratedConstructor.name + "' must define method 'getRequestMixin' to receive the pagination parameters and mix in api endpoint required parameters");
      }
    };
  }
};

module.exports = ContinuousScrollListViewDecorator = (function(_super) {
  __extends(ContinuousScrollListViewDecorator, _super);

  function ContinuousScrollListViewDecorator() {
    return ContinuousScrollListViewDecorator.__super__.constructor.apply(this, arguments);
  }

  ContinuousScrollListViewDecorator.props = props;

  return ContinuousScrollListViewDecorator;

})(BaseViewDecorator);


},{"../../config":2,"../../lib/utils":156,"../../templates/decorators/wait-spinner.hbs":"jLYzvb","./decorator":629,"jquery":774,"lodash":776}],629:[function(require,module,exports){

/*
 * base class for view decorators
 *
 * implement @props as a collection of methods that will override the decorated class
 * properties by receiving the decorated class property and returning a suitable
 * value. see checkable-item-decorator for example.
 *
 */
var BaseViewDecorator, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

module.exports = BaseViewDecorator = (function() {
  BaseViewDecorator.props = {};


  /*
   * Return a new view constructor, extended by checkable-item decorator
   */

  BaseViewDecorator.makeCheckable = function(viewConstructor) {
    var CheckableView;
    CheckableView = require('../decorators/checkable-item-decorator');
    return this.decorate(viewConstructor, CheckableView);
  };


  /*
   * Return a new view constructor, extended by continuous-scroll-list decorator
   */

  BaseViewDecorator.makeContinuouslyScrollable = function(viewConstructor) {
    var ContinuouslyScrollableView;
    ContinuouslyScrollableView = require('../decorators/continuous-scroll-list-decorator');
    return this.decorate(viewConstructor, ContinuouslyScrollableView);
  };


  /*
   * Return a new view constructor, extended by paginated-list decorator
   */

  BaseViewDecorator.makePaginated = function(viewConstructor) {
    var PaginatedView;
    PaginatedView = require('../decorators/paginated-list-decorator');
    return this.decorate(viewConstructor, PaginatedView);
  };


  /*
   * A factory method to produce a view augmented by one of the decorators here
   */

  BaseViewDecorator.decorate = function(viewConstructor, decorator) {
    var decoratedView;
    decoratedView = new decorator(viewConstructor);
    return decoratedView.constructor;
  };

  function BaseViewDecorator(viewConstructor) {
    var DecoratorView, DecoratorViewConstructor, decorate, decoratedView, decoratedViewConstructor, props, proto;
    decoratedView = this;
    decoratedViewConstructor = this.constructor;
    DecoratorViewConstructor = DecoratorView = (function(_super) {
      __extends(DecoratorView, _super);

      function DecoratorView() {
        var bind;
        bind = (function(_this) {
          return function(existingProp, key, proto) {
            if (typeof existingProp === 'function' && props.hasOwnProperty(key)) {
              return _this[key] = _.bind(existingProp, _this);
            }
          };
        })(this);
        _.forOwn(this.constructor.prototype, bind);
        DecoratorView.__super__.constructor.apply(this, arguments);
      }

      return DecoratorView;

    })(viewConstructor);
    proto = DecoratorViewConstructor.prototype;
    props = this.constructor.props;
    decorate = (function(_this) {
      return function(value, key, object) {
        var protoProp;
        protoProp = proto[key];
        return proto[key] = value.call(_this, protoProp);
      };
    })(this);
    _.forOwn(props, decorate);
    proto._decoratedConstructor = viewConstructor;
    proto.constructor = DecoratorViewConstructor;
    this.constructor = DecoratorViewConstructor;
  }

  return BaseViewDecorator;

})();


},{"../decorators/checkable-item-decorator":627,"../decorators/continuous-scroll-list-decorator":628,"../decorators/paginated-list-decorator":630,"lodash":776}],630:[function(require,module,exports){
var $, BaseViewDecorator, ContinuousScrollListViewDecorator, LoadingListView, PaginationView, mediator, props, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

BaseViewDecorator = require('./decorator');

$ = require('jquery');

_ = require('lodash');

LoadingListView = require('../loading-list-view');

PaginationView = require('../pagination-view');

mediator = require('chaplin').mediator;


/*
 * This props object is a collection of methods defined here and exported as the 'static' @props property of the constructor (NOT
 * the prototype.) to be used at construction of a decorated object.
 */

props = {
  paginated: function() {
    return true;
  },
  pageSize: function(decoratedPageSize) {
    var pageSize;
    return pageSize = decoratedPageSize || 10;
  },
  className: function(decoratedClassName) {
    var className;
    className = decoratedClassName || '';
    return className + ' paginated';
  },
  renderAllItems: function(decoratedMethod) {
    return function() {
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      this.constructor.__super__.renderAllItems.apply(this, arguments);
      if (!this.subview('loading-indicator')) {
        this.subview('loading-indicator', new LoadingListView({
          collection: this.collection,
          container: this.$el.find('.loading-container')
        }));
      }
      if (this.collection._total && this.collection._total > mediator.profileItemsPerPage) {
        this.subview('pagination-view', new PaginationView({
          container: this.$el.find('.pagination-container'),
          totalItems: this.collection._total || 0,
          itemsPerPage: mediator.profileItemsPerPage,
          currentPage: this.currentPage
        })).on('change:page', _.debounce(this.onPageChange, 250), this);
        return this.paginationModel = this.subview('pagination-view').model;
      }
    };
  },
  onPageChange: function(decoratedMethod) {
    return function(newPageNum) {
      var identityM, options, _ref, _ref1;
      if (decoratedMethod) {
        decoratedMethod.apply(this, arguments);
      }
      this.publishEvent('profile:currentPageNumber', newPageNum);
      if ((_ref = this.$el) != null) {
        if ((_ref1 = _ref.parent()) != null) {
          _ref1[0].scrollTop = 0;
        }
      }
      _.values(this.getItemViews()).forEach(function(view) {
        return view.$el.css({
          'visibility': 'hidden'
        });
      });
      identityM = mediator.currentProfileM.get('identityM');
      this.currentPage = newPageNum;
      newPageNum -= 1;
      options = {
        reset: true,
        data: {
          offset: newPageNum * mediator.profileItemsPerPage,
          limit: mediator.profileItemsPerPage,
          userid: identityM.get('userid')
        }
      };
      options.data = _.extend({}, options.data, this.getRequestMixin());
      return this.collection.fetch(options);
    };
  }
};

module.exports = ContinuousScrollListViewDecorator = (function(_super) {
  __extends(ContinuousScrollListViewDecorator, _super);

  function ContinuousScrollListViewDecorator() {
    return ContinuousScrollListViewDecorator.__super__.constructor.apply(this, arguments);
  }

  ContinuousScrollListViewDecorator.props = props;

  return ContinuousScrollListViewDecorator;

})(BaseViewDecorator);


},{"../loading-list-view":660,"../pagination-view":668,"./decorator":629,"chaplin":773,"jquery":774,"lodash":776}],631:[function(require,module,exports){
var DropdownMenuView, View, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/dropdown-list');

View = require('./base/view');

mediator = require('chaplin').mediator;

module.exports = DropdownMenuView = (function(_super) {
  __extends(DropdownMenuView, _super);

  function DropdownMenuView() {
    return DropdownMenuView.__super__.constructor.apply(this, arguments);
  }

  DropdownMenuView.prototype.autoRender = true;

  DropdownMenuView.prototype.container = '#dropdown-list-container';

  DropdownMenuView.prototype.className = 'dropdown-menu';

  DropdownMenuView.prototype.template = template;

  return DropdownMenuView;

})(View);


},{"../templates/dropdown-list":"q0Wl2K","./base/view":608,"chaplin":773}],632:[function(require,module,exports){
var DropdownMenuView, View, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/dropdown-menu');

View = require('./base/view');

mediator = require('chaplin').mediator;

module.exports = DropdownMenuView = (function(_super) {
  __extends(DropdownMenuView, _super);

  function DropdownMenuView() {
    return DropdownMenuView.__super__.constructor.apply(this, arguments);
  }

  DropdownMenuView.prototype.autoRender = true;

  DropdownMenuView.prototype.container = '#dropdown-menu-container';

  DropdownMenuView.prototype.className = 'dropdown-menu';

  DropdownMenuView.prototype.template = template;

  DropdownMenuView.prototype.events = {
    'click .profile': 'routeToProfile',
    'click .notifications': 'onNotificationClicked'
  };

  DropdownMenuView.prototype.routeToProfile = function() {
    return Chaplin.utils.redirectTo({
      url: 'stumbler/' + mediator.userM.get('username')
    });
  };

  DropdownMenuView.prototype.onNotificationClicked = function() {
    return this.publishEvent('menu:notification:click');
  };

  return DropdownMenuView;

})(View);


},{"../templates/dropdown-menu":"6YMx7Y","./base/view":608,"chaplin":773}],633:[function(require,module,exports){
var DropdownShareView, Relate, ReportExternalM, View, panel, template, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

utils = require('../lib/utils');

template = require('../templates/dropdown-share');

View = require('./base/view');

panel = require('../lib/panel');

Relate = require('../lib/relate');

ReportExternalM = require('../models/report-external-share-model');

module.exports = DropdownShareView = (function(_super) {
  __extends(DropdownShareView, _super);

  function DropdownShareView() {
    return DropdownShareView.__super__.constructor.apply(this, arguments);
  }

  DropdownShareView.prototype.autoRender = true;

  DropdownShareView.prototype.className = 'dropdown-menu';

  DropdownShareView.prototype.template = template;

  DropdownShareView.prototype.id = 'shareitem';

  DropdownShareView.prototype.events = {
    'click .share-facebook': 'shareFacebook',
    'click .share-twitter': 'shareTwitter',
    'click .share-mix': 'shareMix',
    'click .share-email:not(.disabled)': 'shareEmail',
    'click .share-stumbleupon:not(.disabled)': 'shareStumbleUpon'
  };

  DropdownShareView.prototype.listen = {
    'share-view:opened mediator': 'onNewShare',
    'addedToDOM': 'onAddedToDOM'
  };

  DropdownShareView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    DropdownShareView.__super__.initialize.apply(this, arguments);
    utils.facebookInitialize();
    return this.publishEvent('share-view:opened', this);
  };

  DropdownShareView.prototype.onAddedToDOM = function() {
    if (this.model == null) {
      return this.disableSUShare();
    }
  };

  DropdownShareView.prototype.disableSUShare = function() {
    this.$el.find('.share-email').addClass('disabled');
    return this.$el.find('.share-stumbleupon').addClass('disabled');
  };

  DropdownShareView.prototype.shareStumbleUpon = function() {
    panel.open('share', {
      stumbleM: this.model
    });
    return this.dispose();
  };

  DropdownShareView.prototype.shareEmail = function() {
    panel.open('email-share', {
      stumbleM: this.model
    });
    return this.dispose();
  };

  DropdownShareView.prototype.shareMix = function() {
    var options, url, _ref, _ref1;
    options = 'height=800,width=550,toolbar=0,location=0,menubar=0,directories=0,scrollbars=0';
    url = 'https://mix.com/mixit?url=' + encodeURIComponent((_ref = this.model) != null ? _ref.get('url') : void 0) + '&title=' + encodeURIComponent((_ref1 = this.model) != null ? _ref1.get('title') : void 0);
    window.open(url, 'mixwindow', options);
    return this.dispose();
  };

  DropdownShareView.prototype.shareTwitter = function() {
    var data, options, reportExternalModel, shareUrl, title, titleAllowedLength, url, _ref, _ref1, _ref2;
    panel.close();
    shareUrl = ((_ref = this.model) != null ? _ref.get('_shareUrl') : void 0) || document.location.href;
    titleAllowedLength = 140 - shareUrl.length - " via @Stumbleupon".length - 2;
    title = ((_ref1 = this.model) != null ? _ref1.get('_title') : void 0) || "";
    if (title.length > titleAllowedLength) {
      title = title.substring(0, titleAllowedLength - 1);
      title = title + '…';
    }
    if (title !== "") {
      title = title + ": ";
    }
    data = title + shareUrl;
    options = 'height=320,width=550,toolbar=0,location=0,menubar=0,directories=0,scrollbars=0';
    url = 'http://twitter.com/intent/tweet?text=' + encodeURIComponent(data) + '&via=Stumbleupon';
    window.open(url, 'twitterwindow', options);
    if (this.model != null) {
      reportExternalModel = new ReportExternalM({
        services: ['twitter'],
        urlid: (_ref2 = this.model) != null ? _ref2.get('urlid') : void 0
      });
    } else {
      reportExternalModel = new ReportExternalM({
        services: ['twitter'],
        url: utils.convertDevToProdUrl(shareUrl)
      });
    }
    reportExternalModel.save();
    return this.dispose();
  };

  DropdownShareView.prototype.shareFacebook = function() {
    var reportExternalModel, shareUrl, _ref, _ref1;
    panel.close();
    shareUrl = ((_ref = this.model) != null ? _ref.get('_shareUrl') : void 0) || document.location.href;
    FB.ui({
      method: 'feed',
      link: shareUrl,
      caption: 'Share to Facebook'
    });
    if (this.model != null) {
      reportExternalModel = new ReportExternalM({
        services: ['facebook'],
        urlid: (_ref1 = this.model) != null ? _ref1.get('urlid') : void 0
      });
    } else {
      reportExternalModel = new ReportExternalM({
        services: ['facebook'],
        url: utils.convertDevToProdUrl(shareUrl)
      });
    }
    reportExternalModel.save();
    return this.dispose();
  };

  DropdownShareView.prototype.onNewShare = function(view) {
    if (view !== this) {
      return this.dispose();
    }
  };

  return DropdownShareView;

})(View);


},{"../lib/panel":125,"../lib/relate":127,"../lib/utils":156,"../models/report-external-share-model":222,"../templates/dropdown-share":"x+VomS","./base/view":608}],634:[function(require,module,exports){
var $, DropdownThumbDownView, View, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/dropdown-thumbdown');

View = require('./base/view');

$ = require('jquery');

panel = require('../lib/panel');

module.exports = DropdownThumbDownView = (function(_super) {
  __extends(DropdownThumbDownView, _super);

  function DropdownThumbDownView() {
    return DropdownThumbDownView.__super__.constructor.apply(this, arguments);
  }

  DropdownThumbDownView.prototype.autoRender = true;

  DropdownThumbDownView.prototype.container = '#dropdown-thumbdown-container';

  DropdownThumbDownView.prototype.className = 'dropdown-menu';

  DropdownThumbDownView.prototype.template = template;

  DropdownThumbDownView.prototype.events = {
    'click .withSubtype': 'onItemSelect',
    'click .wrong-topic': 'onWrongTopicClick',
    'click [data-blockdomain]': 'onBlockDomain'
  };

  DropdownThumbDownView.prototype.onItemSelect = function(e) {
    this.publishEvent('stumble:thumbdown', {
      force: true,
      subrating: $(e.target).data('subtype')
    });
    return panel.close();
  };

  DropdownThumbDownView.prototype.onWrongTopicClick = function() {
    this.publishEvent('stumble:wrongTopic');
    return panel.close();
  };

  DropdownThumbDownView.prototype.onBlockDomain = function() {
    this.publishEvent('stumble:blockdomain');
    return panel.close();
  };

  return DropdownThumbDownView;

})(View);


},{"../lib/panel":125,"../templates/dropdown-thumbdown":"EJ14Jg","./base/view":608,"jquery":774}],635:[function(require,module,exports){
var $, EmailShareView, InputPanelView, panel, template,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

template = require('../templates/email-share');

panel = require('../lib/panel');

InputPanelView = require('./base/input-panel-view');

module.exports = EmailShareView = (function(_super) {
  __extends(EmailShareView, _super);

  function EmailShareView() {
    this.clearErrors = __bind(this.clearErrors, this);
    this.displayGeneralError = __bind(this.displayGeneralError, this);
    this.shareStart = __bind(this.shareStart, this);
    return EmailShareView.__super__.constructor.apply(this, arguments);
  }

  EmailShareView.prototype.template = template;

  EmailShareView.prototype.events = {
    'click .send:not(disabled)': 'onClickSend',
    'click [data-id=email-send-cancel]': 'onClickCancel'
  };

  EmailShareView.prototype.listen = {
    'email-share:model:email:error mediator': 'displayEmailFail',
    'email-share:model:share:sent mediator': 'shareSuccess',
    'email-share:model:share:failed mediator': 'shareFail',
    'email-share:model:share:start mediator': 'shareStart'
  };

  EmailShareView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    EmailShareView.__super__.initialize.apply(this, arguments);
    return this.stumbleM = options.stumbleM;
  };

  EmailShareView.prototype.onClickSend = function() {
    var emailEl, messageEl;
    this.clearErrors();
    messageEl = this.$el.find('.email-text');
    emailEl = this.$el.find('.email-list');
    this.model.set({
      urlid: this.stumbleM.get('urlid'),
      emails: emailEl.val(),
      message: messageEl.val()
    });
    return this.model.save();
  };

  EmailShareView.prototype.onClickCancel = function() {
    return panel.close();
  };

  EmailShareView.prototype.shareStart = function() {
    this.$el.find('.email-send .fa-spinner').removeClass('hidden');
    return this.$el.find('.email-send').addClass('disabled');
  };

  EmailShareView.prototype.shareDone = function() {
    this.$el.find('.email-send').removeClass('disabled');
    return this.$el.find('.email-send .fa-spinner').addClass('hidden');
  };

  EmailShareView.prototype.shareSuccess = function() {
    this.$el.find('email-text').val('');
    this.$el.find('email-list').val('');
    this.shareDone();
    return panel.open('alert', {
      type: 'success',
      text: 'The share was sent'
    });
  };

  EmailShareView.prototype.shareFail = function(res) {
    this.displayGeneralError('Failed to send the share');
    return this.shareDone();
  };

  EmailShareView.prototype.displayEmailFail = function(message) {
    return this.displayTooltip('.email-list', message);
  };

  EmailShareView.prototype.displayGeneralError = function(message) {
    return this.displayTooltip('button.email-send', message);
  };

  EmailShareView.prototype.displayTooltip = function(selector, message) {
    return $(selector).attr('container', 'body').attr('title', message).tooltip({
      trigger: 'manual',
      placement: 'right'
    }).tooltip('fixTitle').tooltip('show');
  };

  EmailShareView.prototype.clearErrors = function() {
    $('.email-list').tooltip('destroy');
    return $('button.email-send').tooltip('destroy');
  };

  return EmailShareView;

})(InputPanelView);


},{"../lib/panel":125,"../templates/email-share":"cxTEmX","./base/input-panel-view":607,"jquery":774}],636:[function(require,module,exports){
var $, EmailVerifyView, View, mediator, template,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/email-verify');

$ = require('jquery');

mediator = require('chaplin').mediator;

module.exports = EmailVerifyView = (function(_super) {
  __extends(EmailVerifyView, _super);

  function EmailVerifyView() {
    this.redirectAfter = __bind(this.redirectAfter, this);
    return EmailVerifyView.__super__.constructor.apply(this, arguments);
  }

  EmailVerifyView.prototype.autoRender = true;

  EmailVerifyView.prototype.className = 'email-verify';

  EmailVerifyView.prototype.template = template;

  EmailVerifyView.prototype.container = 'body';

  EmailVerifyView.prototype.containerMethod = 'html';

  EmailVerifyView.prototype.listen = {
    'email-verify:model:success mediator': 'onVerifySuccess',
    'email-verify:model:failure mediator': 'onVerifyFailure',
    'email-verify:model:error mediator': 'onVerifyError'
  };

  EmailVerifyView.prototype.initialize = function() {
    EmailVerifyView.__super__.initialize.apply(this, arguments);
    this.delayFailure = 30000;
    return this.delaySuccess = 10000;
  };

  EmailVerifyView.prototype.onVerifySuccess = function() {
    this.showEmail();
    $('#verify-success').removeClass('hidden');
    return setTimeout(this.redirectAfter, this.delaySuccess);
  };

  EmailVerifyView.prototype.onVerifyFailure = function() {
    this.showEmail();
    $('#verify-failure').removeClass('hidden');
    return setTimeout(this.redirectAfter, this.delayFailure);
  };

  EmailVerifyView.prototype.onVerifyError = function() {
    $('#verify-error').removeClass('hidden');
    return setTimeout(this.redirectAfter, this.delayFailure);
  };

  EmailVerifyView.prototype.showEmail = function() {
    return $('.email-display').text(this.model.get('email'));
  };

  EmailVerifyView.prototype.redirectAfter = function() {
    return Chaplin.utils.redirectTo('homepage#home');
  };

  return EmailVerifyView;

})(View);


},{"../templates/email-verify":"nbBTjM","./base/view":608,"chaplin":773,"jquery":774}],637:[function(require,module,exports){
var AppStartView, BaseErrorView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/errors/app-start');

BaseErrorView = require('./base-error-view');

module.exports = AppStartView = (function(_super) {
  __extends(AppStartView, _super);

  function AppStartView() {
    return AppStartView.__super__.constructor.apply(this, arguments);
  }

  AppStartView.prototype.className = 'error-page app-start';

  AppStartView.prototype.template = template;

  AppStartView.prototype.trackingCategory = 'app-start-fail:view';

  AppStartView.prototype.trackingLabel = 'app-start#fail';

  AppStartView.prototype.events = {
    'click .error-page-retry': 'onRetryClick'
  };

  AppStartView.prototype.onRetryClick = function(evnt) {
    var retryUrl;
    console.log('RETRY CLICK', this.model, arguments);
    retryUrl = this.model.get('source');
    return document.location.href = retryUrl;
  };

  return AppStartView;

})(BaseErrorView);


},{"../../templates/errors/app-start":"9Wl2XC","./base-error-view":639}],638:[function(require,module,exports){
var BadgeSubmitView, BaseErrorView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/errors/badge-submit');

BaseErrorView = require('./base-error-view');

module.exports = BadgeSubmitView = (function(_super) {
  __extends(BadgeSubmitView, _super);

  function BadgeSubmitView() {
    return BadgeSubmitView.__super__.constructor.apply(this, arguments);
  }

  BadgeSubmitView.prototype.className = 'error-page badge-submit';

  BadgeSubmitView.prototype.template = template;

  BadgeSubmitView.prototype.trackingCategory = 'badge-submit:view';

  BadgeSubmitView.prototype.trackingLabel = 'badge-submit#api';

  BadgeSubmitView.prototype.events = {
    'click .error-page-retry': 'onRetryClick'
  };

  BadgeSubmitView.prototype.onRetryClick = function(evnt) {
    return Chaplin.utils.redirectTo({
      url: '/submit?url=' + this.model.get('encodedUrl')
    }, {}, {
      replace: true
    });
  };

  return BadgeSubmitView;

})(BaseErrorView);


},{"../../templates/errors/badge-submit":"3mMLj9","./base-error-view":639}],639:[function(require,module,exports){
var BaseErrorView, View, analytics, stumble,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

stumble = require('../../lib/stumble');

analytics = require('../../lib/analytics');

module.exports = BaseErrorView = (function(_super) {
  __extends(BaseErrorView, _super);

  function BaseErrorView() {
    return BaseErrorView.__super__.constructor.apply(this, arguments);
  }

  BaseErrorView.prototype.autoRender = true;

  BaseErrorView.prototype.region = 'content';

  BaseErrorView.prototype.className = 'error-page';

  BaseErrorView.prototype.trackingCategory = 'error:view';

  BaseErrorView.prototype.trackingLabel = 'error#baseError';

  BaseErrorView.prototype.events = {
    'click .error-page-stumble': 'onStumbleClick'
  };

  BaseErrorView.prototype.initialize = function() {
    BaseErrorView.__super__.initialize.apply(this, arguments);
    return analytics.trackEvent(this.trackingCategory, 1, {
      action: 'view',
      label: this.trackingLabel
    });
  };

  BaseErrorView.prototype.onStumbleClick = function() {
    return stumble.stumbleNext();
  };

  return BaseErrorView;

})(View);


},{"../../lib/analytics":116,"../../lib/stumble":130,"../base/view":608}],640:[function(require,module,exports){
var BaseErrorView, ForbiddenView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/errors/forbidden');

BaseErrorView = require('./base-error-view');

module.exports = ForbiddenView = (function(_super) {
  __extends(ForbiddenView, _super);

  function ForbiddenView() {
    return ForbiddenView.__super__.constructor.apply(this, arguments);
  }

  ForbiddenView.prototype.className = 'error-page forbidden';

  ForbiddenView.prototype.template = template;

  ForbiddenView.prototype.trackingCategory = 'forbidden:view';

  ForbiddenView.prototype.trackingLabel = 'errors/forbidden#forbidden';

  return ForbiddenView;

})(BaseErrorView);


},{"../../templates/errors/forbidden":"R0qHUj","./base-error-view":639}],641:[function(require,module,exports){
var BaseErrorView, ImpossibleUrlView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/errors/impossible-url');

BaseErrorView = require('./base-error-view');

module.exports = ImpossibleUrlView = (function(_super) {
  __extends(ImpossibleUrlView, _super);

  function ImpossibleUrlView() {
    return ImpossibleUrlView.__super__.constructor.apply(this, arguments);
  }

  ImpossibleUrlView.prototype.className = 'error-page impossible-url';

  ImpossibleUrlView.prototype.template = template;

  ImpossibleUrlView.prototype.trackingCategory = 'not-found:view';

  ImpossibleUrlView.prototype.trackingLabel = 'not-found#impossibleUrl';

  return ImpossibleUrlView;

})(BaseErrorView);


},{"../../templates/errors/impossible-url":"+XkjfT","./base-error-view":639}],642:[function(require,module,exports){
var BaseErrorView, InternalServerView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/errors/internal-server');

BaseErrorView = require('./base-error-view');

module.exports = InternalServerView = (function(_super) {
  __extends(InternalServerView, _super);

  function InternalServerView() {
    return InternalServerView.__super__.constructor.apply(this, arguments);
  }

  InternalServerView.prototype.className = 'error-page forbidden';

  InternalServerView.prototype.template = template;

  InternalServerView.prototype.trackingCategory = 'internal-server:view';

  InternalServerView.prototype.trackingLabel = 'errors/internal-server#api';

  return InternalServerView;

})(BaseErrorView);


},{"../../templates/errors/internal-server":"4V7FHU","./base-error-view":639}],643:[function(require,module,exports){
var BaseErrorView, NotFoundView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/errors/not-found');

BaseErrorView = require('./base-error-view');

module.exports = NotFoundView = (function(_super) {
  __extends(NotFoundView, _super);

  function NotFoundView() {
    return NotFoundView.__super__.constructor.apply(this, arguments);
  }

  NotFoundView.prototype.className = 'error-page not-found';

  NotFoundView.prototype.template = template;

  NotFoundView.prototype.trackingCategory = 'not-found:view';

  NotFoundView.prototype.trackingLabel = 'not-found#notFound';

  return NotFoundView;

})(BaseErrorView);


},{"../../templates/errors/not-found":"OdnYj5","./base-error-view":639}],644:[function(require,module,exports){
var FollowButtonView, FollowModel, UnfollowModel, View, analytics, profile, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/follow-button');

FollowModel = require('../models/follow-model');

UnfollowModel = require('../models/unfollow-model');

analytics = require('../lib/analytics');

profile = require('../lib/profile');

module.exports = FollowButtonView = (function(_super) {
  __extends(FollowButtonView, _super);

  function FollowButtonView() {
    return FollowButtonView.__super__.constructor.apply(this, arguments);
  }

  FollowButtonView.prototype.template = template;

  FollowButtonView.prototype.autoRender = true;

  FollowButtonView.prototype.events = {
    'click [data-id="unfollow"]': 'onUnfollowClick',
    'click [data-id="follow"]': 'onFollowClick'
  };

  FollowButtonView.prototype.listen = {
    'change:is_followed model': 'render'
  };

  FollowButtonView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    FollowButtonView.__super__.initialize.apply(this, arguments);
    this.trackingPrefix = (options != null ? options.trackingPrefix : void 0) || '';
    return this.onlyHeaderReset = !!options._onlyHeaderReset;
  };

  FollowButtonView.prototype.onUnfollowClick = function() {
    var unfollowM;
    if (this.syncing) {
      return;
    }
    unfollowM = new UnfollowModel({
      userid: this.model.get('userid')
    });
    this.model.set('is_followed', false);
    this.syncing = true;
    unfollowM.save().then((function(_this) {
      return function(resp) {
        _this.syncing = false;
        return profile.setIdentityModel({
          username: _this.model.get('username'),
          reset: true,
          onlyHeaderReset: _this.onlyHeaderReset
        });
      };
    })(this));
    return analytics.trackEvent(this.trackingPrefix + 'clickUnfollow');
  };

  FollowButtonView.prototype.onFollowClick = function() {
    var followM;
    if (this.syncing) {
      return;
    }
    followM = new FollowModel({
      userid: this.model.get('userid')
    });
    this.model.set('is_followed', true);
    this.syncing = true;
    followM.save().then((function(_this) {
      return function(resp) {
        _this.syncing = false;
        return profile.setIdentityModel({
          username: _this.model.get('username'),
          reset: true,
          onlyHeaderReset: _this.onlyHeaderReset
        });
      };
    })(this));
    return analytics.trackEvent(this.trackingPrefix + 'clickFollow');
  };

  return FollowButtonView;

})(View);


},{"../lib/analytics":116,"../lib/profile":126,"../models/follow-model":180,"../models/unfollow-model":251,"../templates/follow-button":"Msiax0","./base/view":608}],645:[function(require,module,exports){
var FollowInterestButtonView, View, analytics, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/follow-button');

analytics = require('../lib/analytics');

module.exports = FollowInterestButtonView = (function(_super) {
  __extends(FollowInterestButtonView, _super);

  function FollowInterestButtonView() {
    return FollowInterestButtonView.__super__.constructor.apply(this, arguments);
  }

  FollowInterestButtonView.prototype.template = template;

  FollowInterestButtonView.prototype.autoRender = true;

  FollowInterestButtonView.prototype.events = {
    'click [data-id="unfollow"]': 'onUnfollowClick',
    'click [data-id="follow"]': 'onFollowClick'
  };

  FollowInterestButtonView.prototype.listen = {
    'change:is_followed model': 'render'
  };

  FollowInterestButtonView.prototype.initialize = function(options) {
    var isFollowingInterest;
    FollowInterestButtonView.__super__.initialize.apply(this, arguments);
    this.myInterestsModel = options != null ? options.myInterestsModel : void 0;
    isFollowingInterest = this.myInterestsModel.isFollowingInterestById(this.model.get('id'));
    return this.model.set('is_followed', isFollowingInterest);
  };

  FollowInterestButtonView.prototype.onUnfollowClick = function() {
    analytics.trackEvent('interest-info', 0, {
      action: 'delete-interest',
      label: this.model.get('id')
    });
    this.model.set('is_followed', false);
    this.myInterestsModel.getMyInterestsCollection().remove(this.model.get('id'));
    return this.myInterestsModel.save();
  };

  FollowInterestButtonView.prototype.onFollowClick = function() {
    analytics.trackEvent('interest-info', 1, {
      action: 'add-interest',
      label: this.model.get('id')
    });
    this.model.set('is_followed', true);
    this.myInterestsModel.getMyInterestsCollection().add(this.model.attributes);
    return this.myInterestsModel.save();
  };

  return FollowInterestButtonView;

})(View);


},{"../lib/analytics":116,"../templates/follow-button":"Msiax0","./base/view":608}],646:[function(require,module,exports){
var FollowListButtonView, FollowListModel, UnfollowListModel, View, analytics, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/follow-list-button');

FollowListModel = require('../models/follow-list-model');

UnfollowListModel = require('../models/unfollow-list-model');

mediator = require('chaplin').mediator;

analytics = require('../lib/analytics');

module.exports = FollowListButtonView = (function(_super) {
  __extends(FollowListButtonView, _super);

  function FollowListButtonView() {
    return FollowListButtonView.__super__.constructor.apply(this, arguments);
  }

  FollowListButtonView.prototype.template = template;

  FollowListButtonView.prototype.autoRender = true;

  FollowListButtonView.prototype.events = {
    'click [data-id="unfollow"]': 'onUnfollowClick',
    'click [data-id="follow"]': 'onFollowClick'
  };

  FollowListButtonView.prototype.listen = {
    'change:isFollowing model': 'render'
  };

  FollowListButtonView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    FollowListButtonView.__super__.initialize.apply(this, arguments);
    return this.trackingPrefix = (options != null ? options.trackingPrefix : void 0) || '';
  };

  FollowListButtonView.prototype.onUnfollowClick = function() {
    var unfollowM;
    if (this.syncing) {
      return;
    }
    unfollowM = new UnfollowListModel({
      userid: mediator.userM.get('userid'),
      listid: this.model.get('id')
    });
    this.model.set('isFollowing', false);
    this.syncing = true;
    unfollowM.save().then((function(_this) {
      return function(resp) {
        return _this.syncing = false;
      };
    })(this));
    return analytics.trackEvent(this.trackingPrefix + 'clickUnfollow');
  };

  FollowListButtonView.prototype.onFollowClick = function() {
    var followM;
    if (this.syncing) {
      return;
    }
    followM = new FollowListModel({
      userid: mediator.userM.get('userid'),
      listid: this.model.get('id')
    });
    this.model.set('isFollowing', true);
    this.syncing = true;
    followM.save().then((function(_this) {
      return function(resp) {
        return _this.syncing = false;
      };
    })(this));
    return analytics.trackEvent(this.trackingPrefix + 'clickFollow');
  };

  return FollowListButtonView;

})(View);


},{"../lib/analytics":116,"../models/follow-list-model":179,"../models/unfollow-list-model":250,"../templates/follow-list-button":"HAzkOi","./base/view":608,"chaplin":773}],647:[function(require,module,exports){
var $, FollowingRunoutView, RecommendFollowersC, RecommendFollowersView, View, ViewDecorator, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/following-runout');

ViewDecorator = require('../views/decorators/decorator');

RecommendFollowersC = require('../models/recommend-followers-collection');

RecommendFollowersView = require('./recommend-followers-view');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = FollowingRunoutView = (function(_super) {
  __extends(FollowingRunoutView, _super);

  function FollowingRunoutView() {
    return FollowingRunoutView.__super__.constructor.apply(this, arguments);
  }

  FollowingRunoutView.prototype.autoRender = true;

  FollowingRunoutView.prototype.className = 'following-runout fluid-container';

  FollowingRunoutView.prototype.template = template;

  FollowingRunoutView.prototype.region = 'content';

  FollowingRunoutView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  FollowingRunoutView.prototype.onAddedToDOM = function() {
    return this.displayStumblersView();
  };

  FollowingRunoutView.prototype.displayStumblersView = function() {
    var options, recommendFollowersCollection;
    options = {};
    options.data = {
      userid: mediator.userM.get('userid')
    };
    recommendFollowersCollection = new RecommendFollowersC;
    return recommendFollowersCollection.fetch(options).then((function(_this) {
      return function() {
        var recommendFollowersConstructor, _ref;
        recommendFollowersConstructor = ViewDecorator.makeContinuouslyScrollable(RecommendFollowersView);
        return _this.subview('recommend-followers', new recommendFollowersConstructor({
          container: (_ref = _this.$el) != null ? _ref.find('#stumblers-container') : void 0,
          collection: recommendFollowersCollection
        }));
      };
    })(this));
  };

  return FollowingRunoutView;

})(View);


},{"../models/recommend-followers-collection":221,"../templates/following-runout":"8uvyxu","../views/decorators/decorator":629,"./base/view":608,"./recommend-followers-view":693,"chaplin":773,"jquery":774}],648:[function(require,module,exports){
var $, GeneralErrorView, View, root, storage, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

template = require('../templates/general-error');

View = require('./base/view');

storage = require('simple-storage');

root = require('../lib/root');

module.exports = GeneralErrorView = (function(_super) {
  __extends(GeneralErrorView, _super);

  function GeneralErrorView() {
    return GeneralErrorView.__super__.constructor.apply(this, arguments);
  }

  GeneralErrorView.prototype.autoRender = true;

  GeneralErrorView.prototype.className = 'general-error';

  GeneralErrorView.prototype.container = 'body';

  GeneralErrorView.prototype.containerMethod = 'html';

  GeneralErrorView.prototype.template = template;

  GeneralErrorView.prototype.getTemplateData = function() {
    var diagnostic, e, _ref;
    try {
      diagnostic = {
        date: new Date,
        location: root().location,
        ua: root().navigator.userAgent,
        userid: (_ref = storage.get('user')) != null ? _ref.userid : void 0,
        cookies: $.cookie(),
        assets: root().SUassets
      };
    } catch (_error) {
      e = _error;
      diagnostic = {
        date: new Date,
        location: root().location,
        ua: root().navigator.userAgent
      };
    }
    return {
      email: 'engagement@stumbleupon.com',
      diagnostic: JSON.stringify(diagnostic)
    };
  };

  GeneralErrorView.prototype.events = {
    'click textarea': function(e) {
      return e.target.select();
    }
  };

  return GeneralErrorView;

})(View);


},{"../lib/root":129,"../templates/general-error":"v//HrN","./base/view":608,"jquery":774,"simple-storage":780}],649:[function(require,module,exports){
var $, GlassView, View, panel, template, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

_ = require('lodash');

template = require('../templates/glass');

View = require('./base/view');

utils = require('../lib/utils');

panel = require('../lib/panel');

module.exports = GlassView = (function(_super) {
  __extends(GlassView, _super);

  function GlassView() {
    return GlassView.__super__.constructor.apply(this, arguments);
  }

  GlassView.prototype.autoRender = true;

  GlassView.prototype.className = 'glass';

  GlassView.prototype.region = 'content';

  GlassView.prototype.template = template;

  GlassView.prototype.events = {
    'click .stopscroll': 'announceClose',
    'touchmove .stopscroll': 'announceClose'
  };

  GlassView.prototype.listen = {
    'panel:opened mediator': 'onPanelOpened',
    'panel:closed mediator': 'onPanelClosed',
    'convo-mobile:maximized mediator': 'onConvoMaximized',
    'convo-mobile:minimized mediator': 'onConvoMinimized'
  };

  GlassView.prototype.onPanelOpened = function(name) {
    var _ref;
    return (_ref = this.$el) != null ? _ref.attr('data-panel', name) : void 0;
  };

  GlassView.prototype.onPanelClosed = function() {
    var _ref;
    return (_ref = this.$el) != null ? _ref.removeAttr('data-panel') : void 0;
  };

  GlassView.prototype.onConvoMaximized = function() {
    var _ref;
    return (_ref = this.$el) != null ? _ref.find('.stopscroll').removeClass('collapsed-convo') : void 0;
  };

  GlassView.prototype.onConvoMinimized = function() {
    var _ref;
    return (_ref = this.$el) != null ? _ref.find('.stopscroll').addClass('collapsed-convo') : void 0;
  };

  GlassView.prototype.announceClose = _.debounce(function(e) {
    e.preventDefault();
    return panel.close();
  }, 300, true);

  GlassView.prototype.render = function() {
    GlassView.__super__.render.apply(this, arguments);
    return this.onPanelOpened(panel.getCurrentPanel());
  };

  return GlassView;

})(View);


},{"../lib/panel":125,"../lib/utils":156,"../templates/glass":"EFUzNh","./base/view":608,"jquery":774,"lodash":776}],650:[function(require,module,exports){
var $, HomepageAgeView, PopupView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

PopupView = require('./widgets/popup-view');

template = require('../templates/homepage-age');

$ = require('jquery');

module.exports = HomepageAgeView = (function(_super) {
  __extends(HomepageAgeView, _super);

  function HomepageAgeView() {
    return HomepageAgeView.__super__.constructor.apply(this, arguments);
  }

  HomepageAgeView.prototype.className = 'homepage-age-view';

  HomepageAgeView.prototype.template = template;

  HomepageAgeView.prototype.container = 'body';

  HomepageAgeView.prototype.containerMethod = 'html';

  HomepageAgeView.prototype.events = {
    'click .save-age': 'onClickSave',
    'click .cancel': 'onClickCancel'
  };

  HomepageAgeView.prototype.onAddedToDOM = function() {
    HomepageAgeView.__super__.onAddedToDOM.apply(this, arguments);
    return this.prefillAge();
  };

  HomepageAgeView.prototype.prefillAge = function() {
    var age, ageSelect, maxAge, option, _results;
    ageSelect = document.getElementById('age');
    maxAge = 100;
    age = 1;
    _results = [];
    while (age <= maxAge) {
      option = document.createElement('option');
      option.innerHTML = age;
      option.value = age;
      ageSelect.appendChild(option);
      _results.push(age++);
    }
    return _results;
  };

  HomepageAgeView.prototype.onClickSave = function() {
    var _ref;
    this.model.set({
      _age: $('#age').val()
    });
    if ((_ref = this.model) != null) {
      _ref.googleSignup();
    }
    return this.closePopup();
  };

  return HomepageAgeView;

})(PopupView);


},{"../templates/homepage-age":"1MVWwf","./widgets/popup-view":745,"jquery":774}],651:[function(require,module,exports){
var $, ClickTracking, HomepageMobileView, SU, View, analytics, request, template, utils,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

utils = require('../lib/utils');

template = require('../templates/homepage-mobile');

$ = require('jquery');

request = require('../lib/request');

SU = require('../lib/su');

analytics = require('../lib/analytics');

ClickTracking = require('../lib/click-tracking');

module.exports = HomepageMobileView = (function(_super) {
  __extends(HomepageMobileView, _super);

  function HomepageMobileView() {
    this.launch_app_or_alt_url = __bind(this.launch_app_or_alt_url, this);
    this.intervalHeartbeat = __bind(this.intervalHeartbeat, this);
    this.clearTimers = __bind(this.clearTimers, this);
    return HomepageMobileView.__super__.constructor.apply(this, arguments);
  }

  HomepageMobileView.prototype.autoRender = true;

  HomepageMobileView.prototype.className = 'homepage-mobile';

  HomepageMobileView.prototype.template = template;

  HomepageMobileView.prototype.container = 'body';

  HomepageMobileView.prototype.containerMethod = 'html';

  HomepageMobileView.prototype.timer = void 0;

  HomepageMobileView.prototype.heartbeat = void 0;

  HomepageMobileView.prototype.lastInterval = void 0;

  HomepageMobileView.prototype.events = {
    'click .mobile-link': 'onclickTarget',
    'pageshow': 'clearTimers',
    'pagehide': 'clearTimers'
  };

  HomepageMobileView.prototype.initialize = function() {
    HomepageMobileView.__super__.initialize.apply(this, arguments);
    $('body').css('overflow', 'scroll');
    analytics.trackEvent('home:mobile-view', 1, {
      action: 'view',
      label: 'home#showMobileHome'
    });
    return new ClickTracking;
  };

  HomepageMobileView.prototype.dispose = function() {
    $('body').css('overflow', '');
    return HomepageMobileView.__super__.dispose.apply(this, arguments);
  };

  HomepageMobileView.prototype.getTime = function() {
    return (new Date()).getTime();
  };

  HomepageMobileView.prototype.clearTimers = function() {
    var _ref;
    if ((_ref = this.$el) != null) {
      _ref.find('.get-app-spin').addClass('hidden');
    }
    clearTimeout(this.timer);
    return clearTimeout(this.heartbeat);
  };

  HomepageMobileView.prototype.intervalHeartbeat = function() {
    var diff, now;
    now = this.getTime();
    diff = now - this.lastInterval - 200;
    this.lastInterval = now;
    if (diff > 500) {
      return this.clearTimers();
    }
  };

  HomepageMobileView.prototype.launch_app_or_alt_url = function() {
    this.lastInterval = this.getTime();
    this.heartbeat = setInterval(this.intervalHeartbeat, 200);
    this.timer = setTimeout(((function(_this) {
      return function() {
        if (!(document.hidden || document.webkitHidden)) {
          document.location = utils.getAppStoreLink();
        }
        return _this.clearTimers();
      };
    })(this)), 1500);
    return document.location = utils.getAppLink();
  };

  HomepageMobileView.prototype.onclickTarget = function(event) {
    var _ref;
    if ((_ref = this.$el) != null) {
      _ref.find('.get-app-spin').removeClass('hidden');
    }
    this.launch_app_or_alt_url();
    return event.preventDefault();
  };

  return HomepageMobileView;

})(View);


},{"../lib/analytics":116,"../lib/click-tracking":118,"../lib/request":128,"../lib/su":153,"../lib/utils":156,"../templates/homepage-mobile":"/irXeG","./base/view":608,"jquery":774}],652:[function(require,module,exports){
var $, ClickTracking, FacebookConnectModel, GoogleConnectModel, HomepageAgeView, HomepageView, LoginModel, SU, UserTokenModel, View, analytics, config, mediator, request, stumble, template, utils,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

utils = require('../lib/utils');

template = require('../templates/homepage');

$ = require('jquery');

request = require('../lib/request');

SU = require('../lib/su');

mediator = require('chaplin').mediator;

stumble = require('../lib/stumble');

LoginModel = require('../models/login-model');

UserTokenModel = require('../models/user-token-model');

FacebookConnectModel = require('../models/facebook-connect-model');

GoogleConnectModel = require('../models/google-connect-model');

analytics = require('../lib/analytics');

ClickTracking = require('../lib/click-tracking');

HomepageAgeView = require('./homepage-age-view');

config = require('../config');

module.exports = HomepageView = (function(_super) {
  __extends(HomepageView, _super);

  function HomepageView() {
    this.onSetupRecaptcha = __bind(this.onSetupRecaptcha, this);
    this.signup = __bind(this.signup, this);
    this.onSignupLoadEnd = __bind(this.onSignupLoadEnd, this);
    this.onLoginError = __bind(this.onLoginError, this);
    return HomepageView.__super__.constructor.apply(this, arguments);
  }

  HomepageView.prototype.autoRender = true;

  HomepageView.prototype.className = 'homepage';

  HomepageView.prototype.template = template;

  HomepageView.prototype.container = 'body';

  HomepageView.prototype.containerMethod = 'html';

  HomepageView.prototype.events = {
    'click .login-btn': 'showLogin',
    'submit .login-main-form': 'onLoginClick',
    'submit .signup-main-form': 'requestToken',
    'click .birthday-exp': 'showBirthdayInformation',
    'click .okay-button': 'hideBirthdayInformation',
    'click .fb-connect': 'onFbConnect',
    'change .email-group': 'validateEmail',
    'change .username-group': 'validateUsername',
    'change .password-group': 'validatePassword',
    'click #mix-onboard-button': function() {
      return this.goMixOnboard('spa-homepage');
    }
  };

  HomepageView.prototype.listen = {
    'login:model:sync:start mediator': 'onLoginStart',
    'login:model:error mediator': 'onLoginError',
    'login:validiation mediator': 'checkValidation',
    'user-token:request:success mediator': 'signup',
    'signup:model:sync:start mediator': 'onSignupStart',
    'signup:model:sync:end mediator': 'onSignupSyncEnd',
    'signup:model:error mediator': 'onSignupLoadEnd',
    'signup:model:email:error mediator': 'displayEmailFail',
    'signup:model:email:valid mediator': 'displayValidEmail',
    'signup:model:username:error mediator': 'displayUsernameFail',
    'signup:model:username:valid mediator': 'displayValidUsername',
    'signup:model:password:error mediator': 'displayPasswordFail',
    'signup:model:password:valid mediator': 'displayValidPassword',
    'signup:model:birthday:error mediator': 'displayBirthdayFail',
    'signup:model:birthday:valid mediator': 'displayValidBirthday',
    'signup:model:gender:error mediator': 'displayGenderFail',
    'signup:model:gender:valid mediator': 'displayValidGender',
    'signup:model:recaptch:error mediator': 'displayRecaptchaFail',
    'fb:model:signup:error mediator': 'displayFacebookFail',
    'google:model:askAge mediator': 'displayAskAge',
    'google:model:error mediator': 'displayGoogleFail',
    'setup:recaptcha mediator': 'onSetupRecaptcha',
    'login:model:sync:end mediator': 'onLoginSyncEnd'
  };

  HomepageView.prototype.facebookRerequest = false;

  HomepageView.prototype.recaptchaLogin = null;

  HomepageView.prototype.recaptchaSignup = null;

  HomepageView.prototype.initialize = function() {
    HomepageView.__super__.initialize.apply(this, arguments);
    this.model.set({
      isEmailSignupVisible: this.model.getIsEmailSignupVisible()
    });
    $('body').css('overflow', 'scroll');
    if (!this.model.get('isEmailSignupVisible')) {
      analytics.trackEvent('home:desktop-view-fb-connect-test' + this.model.get('_track_postfix'), 1, {
        action: 'view',
        label: 'home#showDesktopHome'
      });
    }
    analytics.trackEvent('home:desktop-view' + this.model.get('_track_postfix'), 1, {
      action: 'view',
      label: 'home#showDesktopHome'
    });
    return new ClickTracking;
  };

  HomepageView.prototype.dispose = function() {
    $('body').css('overflow', '');
    return HomepageView.__super__.dispose.apply(this, arguments);
  };

  HomepageView.prototype.showLogin = function() {
    if ($('.login-home-container').css('display') === "none") {
      $('.login-home-container').show();
    } else {
      $('.login-home-container').hide();
    }
  };

  HomepageView.prototype.onLoginClick = function() {
    return grecaptcha.execute();
  };

  HomepageView.prototype.onLoginStart = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.login-spin').removeClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.login-submit').addClass('disabled') : void 0;
  };

  HomepageView.prototype.onLoginSyncEnd = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.login-spin').addClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.login-submit').removeClass('disabled') : void 0;
  };

  HomepageView.prototype.onLoginError = function(error) {
    $('.invalid-login').text(error.message);
    if (error.attribute === "username") {
      $('.email-username-group').addClass('has-error');
      $('.password-login-group').removeClass('has-error');
      this.displayFeedbackError('#email-username-feedback');
    } else if (error.attribute === "password") {
      $('.email-username-group').removeClass('has-error');
      $('.email-username-group').addClass('has-success');
      $('.password-login-group').addClass('has-error');
      this.displayFeedbackSuccess('#email-username-feedback');
      this.displayFeedbackError('#password-feedback');
    } else if (error.attribute === "general") {
      $('.email-username-group').addClass('has-error');
      $('.password-login-group').addClass('has-error');
      this.displayFeedbackError('#password-feedback');
      this.displayFeedbackError('#email-username-feedback');
    }
    if (this.recaptchaLogin !== null) {
      grecaptcha.reset(this.recaptchaLogin);
    }
    return this.onLoginSyncEnd();
  };

  HomepageView.prototype.displayFeedbackError = function(attrId) {
    $(attrId).addClass('fa');
    $(attrId).addClass('fa-exclamation-triangle');
    $(attrId).removeClass('fa-check');
    return $(attrId).css('visibility', 'visible');
  };

  HomepageView.prototype.displayFeedbackSuccess = function(attrId) {
    $(attrId).addClass('fa');
    $(attrId).addClass('fa-check');
    $(attrId).removeClass('fa-exclamation-triangle');
    return $(attrId).css('visibility', 'visible');
  };

  HomepageView.prototype.displayTooltip = function(attrId, message) {
    $(attrId).attr('container', 'body');
    $(attrId).attr('title', message).tooltip({
      trigger: 'manual',
      placement: 'right'
    }).tooltip('fixTitle').tooltip('show');
  };

  HomepageView.prototype.displayTooltipAndEndSync = function(attrId, message) {
    $(attrId).addClass('has-error');
    $(attrId).removeClass('has-success');
    this.displayTooltip(attrId, message);
    this.onSignupSyncEnd();
  };

  HomepageView.prototype.hideTooltip = function(attrId) {
    $(attrId).addClass('has-success');
    $(attrId).removeClass('has-error');
    return $(attrId).tooltip('destroy');
  };

  HomepageView.prototype.displayFacebookFail = function(message) {
    this.facebookRerequest = true;
    this.displayTooltip('.fb-connect', message);
  };

  HomepageView.prototype.displayGoogleFail = function(message) {
    this.displayTooltip('.google-connect', message);
  };

  HomepageView.prototype.displayRecaptchaFail = function(message) {
    this.displayTooltip('.g-recaptcha', message);
    this.onSignupSyncEnd();
  };

  HomepageView.prototype.displayAskAge = function(googleModel) {
    return this.subview('homepage-age-view', new HomepageAgeView({
      container: this.$el.find('.homepage-age-container'),
      model: googleModel
    }));
  };

  HomepageView.prototype.onSignupStart = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.signup-spin').removeClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.join').addClass('disabled') : void 0;
  };

  HomepageView.prototype.onSignupSyncEnd = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.signup-spin').addClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.join').removeClass('disabled') : void 0;
  };

  HomepageView.prototype.onSignupLoadEnd = function(message) {
    this.displayTooltipAndEndSync('.join', message);
    if (this.recaptchaSignup !== null) {
      return grecaptcha.reset(this.recaptchaSignup);
    }
  };

  HomepageView.prototype.requestToken = function() {
    var userTokenM;
    userTokenM = new UserTokenModel;
    return userTokenM.fetch();
  };

  HomepageView.prototype.signup = function(token) {
    var day, email, gender, month, password, recaptcha, username, year;
    recaptcha = grecaptcha.getResponse(this.recaptchaSignup);
    email = $('#email').val();
    username = $('#username').val();
    password = $('#password-signup').val();
    month = $('#month').val();
    day = $('#day').val();
    year = $('#year').val();
    gender = $('input[name=gender]:checked').val();
    this.model.set({
      captchapassed: '1',
      byear: year,
      bmonth: month,
      bday: day,
      password: password,
      username: username,
      findfriends: '0',
      email: email,
      gender: gender,
      token: token,
      recaptcha: recaptcha
    });
    return this.model.save();
  };

  HomepageView.prototype.onFbConnect = function() {
    var facebookConnectM;
    facebookConnectM = new FacebookConnectModel({
      rerequest: this.facebookRerequest
    });
    return facebookConnectM.save();
  };

  HomepageView.prototype.onGoogleConnect = function(clickEvent) {
    var googleConnectM;
    googleConnectM = new GoogleConnectModel({
      clickEvent: clickEvent
    });
    return googleConnectM.save();
  };

  HomepageView.prototype.showBirthdayInformation = function() {
    return $('.birthday-info-container').css('visibility', 'visible');
  };

  HomepageView.prototype.hideBirthdayInformation = function() {
    return $('.birthday-info-container').css('visibility', 'hidden');
  };

  HomepageView.prototype.checkValidation = function() {
    $('.join').addClass('active');
    return $('.join').removeClass('disabled');
  };

  HomepageView.prototype.displayEmailFail = function(message) {
    this.displayTooltipAndEndSync('.email-group', message);
    return this.displayFeedbackError('#email-signup-feedback');
  };

  HomepageView.prototype.displayValidEmail = function() {
    this.hideTooltip('.email-group');
    return this.displayFeedbackSuccess('#email-signup-feedback');
  };

  HomepageView.prototype.validateEmail = function() {
    var email;
    email = $('#email').val();
    return this.model.validateEmail(email);
  };

  HomepageView.prototype.displayUsernameFail = function(message) {
    this.displayTooltipAndEndSync('.username-group', message);
    return this.displayFeedbackError('#username-signup-feedback');
  };

  HomepageView.prototype.displayValidUsername = function() {
    this.hideTooltip('.username-group');
    return this.displayFeedbackSuccess('#username-signup-feedback');
  };

  HomepageView.prototype.validateUsername = function() {
    var username;
    username = $('#username').val();
    return this.model.validateUsername(username);
  };

  HomepageView.prototype.displayPasswordFail = function(message) {
    this.displayTooltipAndEndSync('.password-group', message);
    return this.displayFeedbackError('#password-signup-feedback');
  };

  HomepageView.prototype.displayValidPassword = function() {
    this.hideTooltip('.password-group');
    return this.displayFeedbackSuccess('#password-signup-feedback');
  };

  HomepageView.prototype.validatePassword = function() {
    var password;
    password = $('#password-signup').val();
    return this.model.validatePassword(password);
  };

  HomepageView.prototype.displayBirthdayFail = function(message) {
    return this.displayTooltipAndEndSync('.birthday-group', message);
  };

  HomepageView.prototype.displayValidBirthday = function() {
    return this.hideTooltip('.birthday-group');
  };

  HomepageView.prototype.displayGenderFail = function(message) {
    return this.displayTooltipAndEndSync('.gender-group', message);
  };

  HomepageView.prototype.displayValidGender = function() {
    return this.hideTooltip('.gender-group');
  };

  HomepageView.prototype.showEmailSignupForm = function() {
    return true;
  };

  HomepageView.prototype.onSetupRecaptcha = function() {
    this.recaptchaLogin = grecaptcha.render(document.getElementById('g-recaptcha-login'), {
      'sitekey': config.invisibleRecaptchaSiteKey,
      'size': 'invisible',
      'badge': 'inline',
      'callback': (function(_this) {
        return function(token) {
          var loginM;
          loginM = new LoginModel({
            username: $('#email-username').val(),
            password: $('#password-login').val(),
            recaptcha: token
          });
          return loginM.save();
        };
      })(this)
    });
    return this.recaptchaSignup = grecaptcha.render(document.getElementById('g-recaptcha-signup'), {
      'sitekey': config.recaptchaSiteKey
    });
  };

  return HomepageView;

})(View);


},{"../config":2,"../lib/analytics":116,"../lib/click-tracking":118,"../lib/request":128,"../lib/stumble":130,"../lib/su":153,"../lib/utils":156,"../models/facebook-connect-model":178,"../models/google-connect-model":184,"../models/login-model":203,"../models/user-token-model":260,"../templates/homepage":"wRua1N","./base/view":608,"./homepage-age-view":650,"chaplin":773,"jquery":774}],653:[function(require,module,exports){
var $, InfoView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

View = require('./base/view');

template = require('../templates/info');

module.exports = InfoView = (function(_super) {
  __extends(InfoView, _super);

  function InfoView() {
    return InfoView.__super__.constructor.apply(this, arguments);
  }

  InfoView.prototype.autoRender = true;

  InfoView.prototype.className = 'info large';

  InfoView.prototype.template = template;

  InfoView.prototype.region = 'panel';

  InfoView.prototype.events = {
    'click .info-button.share': function() {
      return $('.info-share-dropdown').toggle();
    }
  };

  return InfoView;

})(View);


},{"../templates/info":"5Wf+xl","./base/view":608,"jquery":774}],654:[function(require,module,exports){
var $, LikerView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

template = require('../templates/liker');

View = require('./base/view');

module.exports = LikerView = (function(_super) {
  __extends(LikerView, _super);

  function LikerView() {
    return LikerView.__super__.constructor.apply(this, arguments);
  }

  LikerView.prototype.autoRender = true;

  LikerView.prototype.className = 'liker';

  LikerView.prototype.template = template;

  return LikerView;

})(View);


},{"../templates/liker":"smv2ra","./base/view":608,"jquery":774}],655:[function(require,module,exports){
var LikersPreviewView, LikersView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/likers-preview');

LikersView = require('./likers-view');

module.exports = LikersPreviewView = (function(_super) {
  __extends(LikersPreviewView, _super);

  function LikersPreviewView() {
    return LikersPreviewView.__super__.constructor.apply(this, arguments);
  }

  LikersPreviewView.prototype.autoRender = true;

  LikersPreviewView.prototype.template = template;

  LikersPreviewView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  LikersPreviewView.prototype.onAddedToDOM = function() {
    return this.subview('likers-view', new LikersView({
      container: this.$el.find('.likers'),
      collection: this.model.get('likersC')
    }));
  };

  return LikersPreviewView;

})(View);


},{"../templates/likers-preview":"GVOLL+","./base/view":608,"./likers-view":656}],656:[function(require,module,exports){
var CollectionView, LikerView, LikersView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('./base/collection-view');

LikerView = require('./liker-view');

template = require('../templates/likers');

module.exports = LikersView = (function(_super) {
  __extends(LikersView, _super);

  function LikersView() {
    return LikersView.__super__.constructor.apply(this, arguments);
  }

  LikersView.prototype.autoRender = true;

  LikersView.prototype.itemView = LikerView;

  LikersView.prototype.listSelector = '.likers-row';

  LikersView.prototype.template = template;

  LikersView.prototype.onLikersSync = function() {
    var total;
    total = this.collection.getTotal();
    if (total) {
      if (total === 1) {
        this.$el.find('.animation-likes').addClass('one-liker');
      }
      return this.$el.find('.real-likers').show();
    }
  };

  LikersView.prototype.render = function() {
    LikersView.__super__.render.apply(this, arguments);
    return this.collection.whenPopulated().then((function(_this) {
      return function() {
        if (!_this.disposed) {
          return _this.onLikersSync();
        }
      };
    })(this));
  };

  return LikersView;

})(CollectionView);


},{"../templates/likers":"G46BbM","./base/collection-view":606,"./liker-view":654}],657:[function(require,module,exports){
var ListView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/list-item');

View = require('./base/view');

module.exports = ListView = (function(_super) {
  __extends(ListView, _super);

  function ListView() {
    return ListView.__super__.constructor.apply(this, arguments);
  }

  ListView.prototype.template = template;

  ListView.prototype.className = 'dropdown-item';

  ListView.prototype.tagName = 'li';

  ListView.prototype.events = {
    'click': function() {
      return this.publishEvent('list:itemadd', this.model);
    }
  };

  ListView.prototype.initialize = function() {
    ListView.__super__.initialize.apply(this, arguments);
    return this.model.on("change", this.render);
  };

  ListView.prototype.render = function() {
    ListView.__super__.render.apply(this, arguments);
    return this.$el.toggleClass("visible", this.model.get('_visible'));
  };

  return ListView;

})(View);


},{"../templates/list-item":"/qq0tH","./base/view":608}],658:[function(require,module,exports){
var CollectionView, ListV, ListsView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('./base/collection-view');

ListV = require('./list-view');

module.exports = ListsView = (function(_super) {
  __extends(ListsView, _super);

  function ListsView() {
    return ListsView.__super__.constructor.apply(this, arguments);
  }

  ListsView.prototype.autoRender = true;

  ListsView.prototype.className = 'dropdown-items';

  ListsView.prototype.container = '.addtolist-items';

  ListsView.prototype.tagName = 'ul';

  ListsView.prototype.itemView = ListV;

  return ListsView;

})(CollectionView);


},{"./base/collection-view":606,"./list-view":657}],659:[function(require,module,exports){
var $, LoadingIndicatorView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

$ = require('jquery');

template = require('../templates/loading-indicator');

module.exports = LoadingIndicatorView = (function(_super) {
  __extends(LoadingIndicatorView, _super);

  function LoadingIndicatorView() {
    return LoadingIndicatorView.__super__.constructor.apply(this, arguments);
  }

  LoadingIndicatorView.prototype.autoRender = true;

  LoadingIndicatorView.prototype.disposeOnAdd = false;

  LoadingIndicatorView.prototype.template = template;

  LoadingIndicatorView.prototype.className = 'hidden loading-indicator-container';

  LoadingIndicatorView.prototype.emptyDataText = '';

  LoadingIndicatorView.prototype.listen = {
    'add collection': 'onCollectionChange',
    'syncing collection': 'showView',
    'sync collection': 'onCollectionChange',
    'error collection': 'onCollectionChange',
    'sync:finished collection': 'onSyncFinished'
  };

  LoadingIndicatorView.prototype.initialize = function(options) {
    var key;
    if (options == null) {
      options = {};
    }
    for (key in options) {
      if (!__hasProp.call(options, key)) continue;
      this[key] = options[key];
    }
    return LoadingIndicatorView.__super__.initialize.apply(this, arguments);
  };

  LoadingIndicatorView.prototype.attach = function() {
    LoadingIndicatorView.__super__.attach.apply(this, arguments);
    this.$el.hide();
    this.setTimeout((function(_this) {
      return function() {
        return _this.$el.show();
      };
    })(this), '1s');
    return this.onCollectionChange();
  };

  LoadingIndicatorView.prototype.onCollectionChange = function() {
    var _ref;
    if (this.disposed) {
      return;
    }
    if ((_ref = this.collection) != null ? _ref.length : void 0) {
      return this.hideView();
    } else {
      return this.showView();
    }
  };

  LoadingIndicatorView.prototype.onSyncFinished = function() {
    if (this.collection.length === 0) {
      return this.$el.find('.js-text-container').text(this.emptyDataText);
    }
  };

  LoadingIndicatorView.prototype.hideView = function() {
    this.$el.addClass('hidden');
    if (this.disposeOnAdd) {
      return this.dispose();
    }
  };

  LoadingIndicatorView.prototype.showView = function() {
    return this.$el.removeClass('hidden');
  };

  return LoadingIndicatorView;

})(View);


},{"../templates/loading-indicator":"AeNRLl","./base/view":608,"jquery":774}],660:[function(require,module,exports){
var $, LoadingIndicatorView, LoadingListView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

LoadingIndicatorView = require('./loading-indicator-view');

template = require('../templates/loading-indicator');

$ = require('jquery');

module.exports = LoadingListView = (function(_super) {
  __extends(LoadingListView, _super);

  function LoadingListView() {
    return LoadingListView.__super__.constructor.apply(this, arguments);
  }

  LoadingListView.prototype.disposeOnAdd = true;

  LoadingListView.prototype.template = template;

  LoadingListView.prototype.listen = {
    'sync collection': 'onCollectionSync'
  };

  LoadingListView.prototype.onCollectionSync = function() {
    if (this.collection.length === 0) {
      $('.empty-list-container').show();
      return this.$el.find('.loading-indicator').hide();
    }
  };

  return LoadingListView;

})(LoadingIndicatorView);


},{"../templates/loading-indicator":"AeNRLl","./loading-indicator-view":659,"jquery":774}],661:[function(require,module,exports){
var $, AddonView, View, template, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/mix-rc');

utils = require('../lib/utils');

$ = require('jquery');

module.exports = AddonView = (function(_super) {
  __extends(AddonView, _super);

  function AddonView() {
    return AddonView.__super__.constructor.apply(this, arguments);
  }

  AddonView.prototype.autoRender = true;

  AddonView.prototype.className = 'mix-rc';

  AddonView.prototype.region = 'content';

  AddonView.prototype.template = template;

  AddonView.prototype.events = {
    'click #mix-onboard-button': function() {
      return this.goMixOnboard('spa-mix-rc');
    }
  };

  return AddonView;

})(View);


},{"../lib/utils":156,"../templates/mix-rc":"f6CcVt","./base/view":608,"jquery":774}],662:[function(require,module,exports){
var $, OldBrowser, attach, mediator;

mediator = require('chaplin').mediator;

$ = require('jquery');

attach = (function() {
  if ($) {
    return function(view) {
      var actual;
      actual = $(view.container);
      if (typeof view.containerMethod === 'function') {
        return view.containerMethod(actual, view.el);
      } else {
        return actual[view.containerMethod](view.el);
      }
    };
  } else {
    return function(view) {
      var actual;
      actual = typeof view.container === 'string' ? document.querySelector(view.container) : view.container;
      if (typeof view.containerMethod === 'function') {
        return view.containerMethod(actual, view.el);
      } else {
        return actual[view.containerMethod](view.el);
      }
    };
  }
})();

module.exports = OldBrowser = (function() {
  function OldBrowser() {}

  OldBrowser.prototype.attach = function() {
    if (this.region != null) {
      mediator.execute('region:show', this.region, this);
    }
    if (this.container && !$.contains(document.body, this.el)) {
      attach(this);
      return this.trigger('addedToDOM');
    }
  };

  return OldBrowser;

})();


},{"chaplin":773,"jquery":774}],663:[function(require,module,exports){
var $, Truncate;

$ = require('jquery');

module.exports = Truncate = (function() {
  function Truncate() {}

  Truncate.prototype.attach = function() {
    var truncateEls, _ref;
    truncateEls = (_ref = this.$el) != null ? _ref.find('.truncate') : void 0;
    Truncate.__super__.attach.apply(this, arguments);
    return truncateEls != null ? truncateEls.each(function(i, el) {
      return $(el).trigger('update');
    }) : void 0;
  };

  return Truncate;

})();


},{"jquery":774}],664:[function(require,module,exports){
var $, ModalView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/modal-overlay');

$ = require('jquery');

module.exports = ModalView = (function(_super) {
  __extends(ModalView, _super);

  function ModalView() {
    return ModalView.__super__.constructor.apply(this, arguments);
  }

  ModalView.prototype.autoRender = true;

  ModalView.prototype.className = 'modal-dialog-box';

  ModalView.prototype.template = template;

  ModalView.prototype.listen = {
    'window:resize mediator': 'onWindowResize',
    'addedToDOM': 'onAddedToDOM'
  };

  ModalView.prototype.events = {
    'click [data-id="confirmAction"]': 'confirmAction',
    'click [data-id="cancel"]': 'destroyModal'
  };

  ModalView.prototype.initialize = function() {
    ModalView.__super__.initialize.apply(this, arguments);
    return this.$el.find('#myModal').modal('hide');
  };

  ModalView.prototype.onAddedToDOM = function() {
    this.$el.find('#myModal').modal('show');
    return this.repositionModal();
  };

  ModalView.prototype.confirmAction = function() {
    this.$el.find('#myModal').modal('hide');
    return this.trigger('confirmAction');
  };

  ModalView.prototype.onWindowResize = function() {
    return this.repositionModal();
  };

  ModalView.prototype.repositionModal = function() {
    var dialog, marginTop, modal;
    modal = this.$el.find('#myModal');
    dialog = modal.find('.modal-dialog');
    marginTop = Math.max(0, ($(window).height() - dialog.height()) / 2);
    return dialog.css("margin-top", marginTop);
  };

  ModalView.prototype.destroyModal = function() {
    this.trigger('cancelAction');
    return this.dispose();
  };

  return ModalView;

})(View);


},{"../templates/modal-overlay":"IssChc","./base/view":608,"jquery":774}],665:[function(require,module,exports){
var ModeView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/mode');

View = require('./base/view');

module.exports = ModeView = (function(_super) {
  __extends(ModeView, _super);

  function ModeView() {
    return ModeView.__super__.constructor.apply(this, arguments);
  }

  ModeView.prototype.events = {
    'click .interest': function() {
      return this.model.collection.setActive(this.model.get('name'));
    }
  };

  ModeView.prototype.autoRender = true;

  ModeView.prototype.className = 'mode-item';

  ModeView.prototype.template = template;

  return ModeView;

})(View);


},{"../templates/mode":"VHyB0o","./base/view":608}],666:[function(require,module,exports){
var $, ActionButtonM, ActionButtonsC, ActionButtonsV, CollectionView, ModeView, ModesView, SearchM, SearchView, i18n, panel, storage, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('./base/collection-view');

ModeView = require('./mode-view');

template = require('../templates/modes');

$ = require('jquery');

storage = require('simple-storage');

SearchM = require('../models/search-input-model');

ActionButtonsV = require('./widgets/action-buttons-view');

ActionButtonsC = require('../models/action-buttons-collection');

ActionButtonM = require('../models/action-button-model');

SearchView = require('./widgets/search-input-view');

i18n = require('../lib/i18n');

panel = require('../lib/panel');

module.exports = ModesView = (function(_super) {
  __extends(ModesView, _super);

  function ModesView() {
    return ModesView.__super__.constructor.apply(this, arguments);
  }

  ModesView.prototype.autoRender = true;

  ModesView.prototype.itemView = ModeView;

  ModesView.prototype.useCssAnimation = true;

  ModesView.prototype.listSelector = '.modes';

  ModesView.prototype.template = template;

  ModesView.prototype.eventPrefix = 'stumbleModeSelection';

  ModesView.prototype.events = {
    'click .category': 'onClickCategory'
  };

  ModesView.prototype.listen = {
    'change:_active collection': function() {
      return this.filter(this.filterer);
    },
    'addedToDOM': 'onAddedToDOM'
  };

  ModesView.prototype.initialize = function(options) {
    ModesView.__super__.initialize.apply(this, arguments);
    this.actionButtonsCollection = this._createActionButtonsCollection(this.trackingLabel);
    this.listenTo(this.actionButtonsCollection, 'change:clicked', this.onActionButtonClicked);
    this.searchModel = this._createSearchModel(this.collection);
    return this.listenTo(this.searchModel, 'change:selectedModel', this.onSelectedModelChange);
  };

  ModesView.prototype.onAddedToDOM = function() {
    var activeMode;
    activeMode = storage.get('activeMode') || 'All Interests';
    switch (activeMode) {
      case 'All Interests':
        this.$el.find('.mode-all').addClass('selected');
        break;
      case 'Following':
        this.$el.find('.mode-following').addClass('selected');
        break;
      case 'Trending':
        this.$el.find('.mode-trending').addClass('selected');
        break;
      case 'Photos':
        this.$el.find('.mode-photos').addClass('selected');
        break;
      case 'Videos':
        this.$el.find('.mode-videos').addClass('selected');
    }
    this.subview('search-input-view', new SearchView({
      container: this.$el.find('.search-input-container'),
      containerMethod: 'html',
      model: this.searchModel,
      eventPrefix: this.eventPrefix + ':search-input-view',
      id: this.viewId
    }));
    return this.subview('action-buttons-view', new ActionButtonsV({
      collection: this.actionButtonsCollection,
      container: this.$el.find('.action-buttons-view-container'),
      containerMethod: 'html',
      id: 'action-buttons'
    }));
  };

  ModesView.prototype.onClickCategory = function(e) {
    return this.collection.setActive($(e.target).data('mode'));
  };

  ModesView.prototype.filterCallback = function(view, included) {
    var _ref, _ref1;
    if ((_ref = view.$el) != null) {
      _ref.toggleClass('selected', (_ref1 = view.model) != null ? _ref1.get('_active') : void 0);
    }
    if (!included) {
      return view.dispose();
    }
  };

  ModesView.prototype._createActionButtonsCollection = function(trackingLabel) {
    var actionButtonsC;
    return actionButtonsC = new ActionButtonsC([
      new ActionButtonM({
        id: this.eventPrefix + '-edit',
        action: 'edit',
        disabled: false,
        classNames: ['btn-sublue'],
        trackingCategory: this.eventPrefix + '-edit',
        trackingLabel: trackingLabel,
        buttonText: i18n('EDIT_INTERESTS')
      })
    ]);
  };

  ModesView.prototype.onActionButtonClicked = function(buttonModel, options) {
    switch (buttonModel.getAction()) {
      case 'edit':
        return this.editInterests();
    }
  };

  ModesView.prototype.onSelectedModelChange = function(model, value, options) {
    var newModeModel;
    if (value) {
      newModeModel = value;
      return this.collection.setActive(newModeModel.get('name'));
    }
  };

  ModesView.prototype.editInterests = function() {
    panel.close();
    return Chaplin.utils.redirectTo('interests#editMyInterests');
  };

  ModesView.prototype._createSearchModel = function(searchListProvider) {
    var searchM;
    searchM = new SearchM();
    searchM.setId('submit-search-interests');
    searchM.setSearchText('');
    searchM.setPlaceholderText(i18n('SEARCH_INTERESTS'));
    searchM.setSearchOpen(false);
    searchM.setSearchListProvider(searchListProvider);
    return searchM;
  };

  return ModesView;

})(CollectionView);


},{"../lib/i18n":121,"../lib/panel":125,"../models/action-button-model":159,"../models/action-buttons-collection":160,"../models/search-input-model":227,"../templates/modes":"jBDgCO","./base/collection-view":606,"./mode-view":665,"./widgets/action-buttons-view":739,"./widgets/search-input-view":746,"jquery":774,"simple-storage":780}],667:[function(require,module,exports){
var NotificationDomainView, View, mediator, template, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/notification-domain');

mediator = require('chaplin').mediator;

utils = require('../lib/utils');

module.exports = NotificationDomainView = (function(_super) {
  __extends(NotificationDomainView, _super);

  function NotificationDomainView() {
    return NotificationDomainView.__super__.constructor.apply(this, arguments);
  }

  NotificationDomainView.prototype.autoRender = true;

  NotificationDomainView.prototype.autoAttach = false;

  NotificationDomainView.prototype.template = template;

  NotificationDomainView.prototype.containerMethod = 'prepend';

  NotificationDomainView.prototype.className = 'domain-mode-notification';

  NotificationDomainView.prototype.initialize = function() {
    return NotificationDomainView.__super__.initialize.apply(this, arguments);
  };

  NotificationDomainView.prototype.render = function() {
    if (this.detectAndClearDomainChange()) {
      NotificationDomainView.__super__.render.apply(this, arguments);
      return this.attach();
    }
  };

  NotificationDomainView.prototype.detectAndClearDomainChange = function() {
    var isDomain;
    isDomain = mediator.modesC.getDomainParamFlag();
    if (isDomain && this.model.get('_mode') === 'domain') {
      mediator.modesC.clearDomainParamFlag();
      return isDomain;
    }
  };

  return NotificationDomainView;

})(View);


},{"../lib/utils":156,"../templates/notification-domain":"pb5Xon","./base/view":608,"chaplin":773}],668:[function(require,module,exports){
var $, Model, PaginationView, View, mediator, template, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/profile/pagination');

View = require('./base/view');

$ = require('jquery');

Model = require('../models/base/model');

_ = require('lodash');

mediator = require('chaplin').mediator;

module.exports = PaginationView = (function(_super) {
  __extends(PaginationView, _super);

  function PaginationView() {
    return PaginationView.__super__.constructor.apply(this, arguments);
  }

  PaginationView.prototype.template = template;

  PaginationView.prototype.autoRender = true;

  PaginationView.prototype.events = {
    'click [data-id=page-num]': 'onPageClicked',
    'click [data-id=next-btn]': 'onNextClicked',
    'click [data-id=previous-btn]': 'onPreviousClicked'
  };

  PaginationView.prototype.listen = {
    'change:startPage model': 'render',
    'change:activePage model': 'render'
  };

  PaginationView.prototype.intervalSize = 5;

  PaginationView.prototype.initialize = function(options) {
    var activePage;
    if (options == null) {
      options = {};
    }
    activePage = options.currentPage || options.startPage || 1;
    this.model = new Model({
      startPage: options.startPage || activePage,
      activePage: activePage,
      totalItems: options.totalItems
    });
    this.totalItems = options.totalItems;
    this.maxPageNumber = Math.ceil(options.totalItems / options.itemsPerPage);
    return PaginationView.__super__.initialize.apply(this, arguments);
  };

  PaginationView.prototype.createPages = function() {
    var activePage, distanceToEnd, distanceToZero, max, min, pages;
    min = this.model.get('startPage');
    max = min + this.intervalSize;
    if (max > this.maxPageNumber) {
      max = this.maxPageNumber + 1;
      min = this.maxPageNumber - this.intervalSize;
    }
    if (min < 1) {
      min = 1;
    }
    activePage = this.model.get('activePage');
    pages = _.range(min, max);
    if (typeof activePage !== 'undefined' && pages.indexOf(activePage) === -1) {
      return this.model.set('startPage', activePage);
    }
    pages = _.map(pages, (function(_this) {
      return function(page) {
        return {
          page: page,
          isActive: page === activePage
        };
      };
    })(this));
    distanceToZero = max - 1;
    distanceToEnd = this.maxPageNumber - min;
    if (this.maxPageNumber > pages.length) {
      if (distanceToZero > distanceToEnd) {
        pages.unshift({
          page: 1,
          isActive: false,
          setAsStart: true
        }, {
          ellipsis: true
        });
      } else {
        pages.push({
          ellipsis: true
        }, {
          page: this.maxPageNumber,
          isActive: false,
          setAsStart: true
        });
      }
    }
    return this.model.set('pages', pages);
  };

  PaginationView.prototype.render = function() {
    this.createPages();
    return PaginationView.__super__.render.apply(this, arguments);
  };

  PaginationView.prototype.onPageClicked = function(e) {
    var activePage, initialValue, page, pageNum, pages;
    pageNum = Number($(e.target).attr('data-pagenum'));
    initialValue = this.model.get('startPage');
    pages = this.model.get('pages');
    page = _.find(pages, function(page) {
      return page.page === pageNum;
    });
    if (pageNum) {
      activePage = Number(pageNum);
      this.model.set('activePage', activePage);
      if (page.setAsStart) {
        this.model.set('startPage', pageNum);
      }
      return this.trigger('change:page', activePage);
    }
  };

  PaginationView.prototype.adjustActivePage = function(amount, setTo) {
    var activePage, pages, thisPage;
    activePage = this.model.get('activePage') + amount;
    if (setTo) {
      activePage = setTo;
    }
    if (activePage < 1) {
      activePage = 1;
    } else if (activePage >= this.maxPageNumber) {
      activePage = this.maxPageNumber;
    }
    pages = this.model.get('pages');
    thisPage = _.findWhere(pages, function(pageObj) {
      return pageObj.page === activePage;
    });
    if (!thisPage) {
      this.model.set('startPage', activePage);
    }
    this.model.set('activePage', activePage);
    return this.trigger('change:page', activePage);
  };

  PaginationView.prototype.onNextClicked = function() {
    return this.adjustActivePage(1);
  };

  PaginationView.prototype.onPreviousClicked = function() {
    return this.adjustActivePage(-1);
  };

  return PaginationView;

})(View);


},{"../models/base/model":168,"../templates/profile/pagination":"9JAUXg","./base/view":608,"chaplin":773,"jquery":774,"lodash":776}],669:[function(require,module,exports){
var LikersPreviewView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/placeholder-likers');

module.exports = LikersPreviewView = (function(_super) {
  __extends(LikersPreviewView, _super);

  function LikersPreviewView() {
    return LikersPreviewView.__super__.constructor.apply(this, arguments);
  }

  LikersPreviewView.prototype.autoRender = true;

  LikersPreviewView.prototype.template = template;

  return LikersPreviewView;

})(View);


},{"../templates/placeholder-likers":"gxkJ4E","./base/view":608}],670:[function(require,module,exports){
var PrerenderView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/prerender');

View = require('./base/view');

module.exports = PrerenderView = (function(_super) {
  __extends(PrerenderView, _super);

  function PrerenderView() {
    return PrerenderView.__super__.constructor.apply(this, arguments);
  }

  PrerenderView.prototype.autoRender = true;

  PrerenderView.prototype.className = 'stumble-prerender';

  PrerenderView.prototype.template = template;

  PrerenderView.prototype.region = 'content';

  PrerenderView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    this.nextGuessUrl = options.nextGuessUrl;
    return PrerenderView.__super__.initialize.apply(this, arguments);
  };

  PrerenderView.prototype.getTemplateData = function() {
    return {
      url: this.nextGuessUrl
    };
  };

  return PrerenderView;

})(View);


},{"../templates/prerender":"DuMpgn","./base/view":608}],671:[function(require,module,exports){
var AddPageView, Relate, View, lists, template,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/profile/add-page');

lists = require('../../lib/lists');

Relate = require('../../lib/relate');

module.exports = AddPageView = (function(_super) {
  __extends(AddPageView, _super);

  function AddPageView() {
    this.onSubmitFrameMessage = __bind(this.onSubmitFrameMessage, this);
    return AddPageView.__super__.constructor.apply(this, arguments);
  }

  AddPageView.prototype.autoRender = true;

  AddPageView.prototype.template = template;

  AddPageView.prototype.listen = {
    'profile:url:submitted mediator': 'onUrlSubmitted'
  };

  AddPageView.prototype.initialize = function(options) {
    AddPageView.__super__.initialize.apply(this, arguments);
    return this.relateToSelector = options != null ? options.relateToSelector : void 0;
  };

  AddPageView.prototype.onUrlSubmitted = function(urlId) {
    return this.saveToList(urlId);
  };

  AddPageView.prototype.saveToList = function(urlId) {
    var listId;
    listId = this.getList();
    if (urlId && listId) {
      return lists.addItemToList(urlId, listId);
    }
  };

  AddPageView.prototype.getList = function() {
    if (this.model.get('listName')) {
      return this.model.id;
    } else {
      return null;
    }
  };

  AddPageView.prototype.render = function() {
    AddPageView.__super__.render.apply(this, arguments);
    if (this.relate) {
      this.relate.dispose();
    }
    this.relate = new Relate(this.container, {
      position: 'rightedge-bottomright',
      offsetTop: 4
    });
    return this.relate.to(this.relateToSelector);
  };

  AddPageView.prototype.attach = function() {
    AddPageView.__super__.attach.apply(this, arguments);
    return window.addEventListener('message', this.onSubmitFrameMessage, false);
  };

  AddPageView.prototype.onSubmitFrameMessage = function(e) {
    if (e.source.location.hostname === window.location.hostname && e.source.location.protocol === window.location.protocol && e.source.location.pathname === '/submit' && e.data.match(/submitform:canceled|submitform:saved/)) {
      return this.closeThis();
    }
  };

  AddPageView.prototype.closeThis = function() {
    Chaplin.mediator.publish('addpageview:close');
    return this.dispose();
  };

  AddPageView.prototype.dispose = function() {
    this.relate.dispose();
    window.removeEventListener('message', this.onSubmitFrameMessage, false);
    return AddPageView.__super__.dispose.apply(this, arguments);
  };

  return AddPageView;

})(View);


},{"../../lib/lists":122,"../../lib/relate":127,"../../templates/profile/add-page":"LyXdyy","../base/view":608}],672:[function(require,module,exports){
var $, DropdownShareProfileView, DropdownShareView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

DropdownShareView = require('../dropdown-share-view');

$ = require('jquery');

module.exports = DropdownShareProfileView = (function(_super) {
  __extends(DropdownShareProfileView, _super);

  function DropdownShareProfileView() {
    return DropdownShareProfileView.__super__.constructor.apply(this, arguments);
  }

  DropdownShareProfileView.prototype.listen = {
    'onClickDocument mediator': 'closeDropdown'
  };

  DropdownShareProfileView.prototype.clickEventCallback = function(event) {
    return Chaplin.mediator.publish("onClickDocument", event);
  };

  DropdownShareProfileView.prototype.onAddedToDOM = function() {
    DropdownShareProfileView.__super__.onAddedToDOM.apply(this, arguments);
    return $("body").on('click', this.clickEventCallback);
  };

  DropdownShareProfileView.prototype.dispose = function() {
    DropdownShareProfileView.__super__.dispose.apply(this, arguments);
    return $("body").off('click', this.clickEventCallback);
  };

  DropdownShareProfileView.prototype.closeDropdown = function(event) {
    var eventAttributes, _ref;
    eventAttributes = event.target.attributes;
    if (!((eventAttributes["class"].value === "fa fa-share-alt") || (((_ref = eventAttributes["data-id"]) != null ? _ref.value : void 0) === "item-share-btn"))) {
      return this.dispose();
    }
  };

  return DropdownShareProfileView;

})(DropdownShareView);


},{"../dropdown-share-view":633,"jquery":774}],673:[function(require,module,exports){
var HistoryListView, ProfileListView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileListView = require('./list-view');

module.exports = HistoryListView = (function(_super) {
  __extends(HistoryListView, _super);

  function HistoryListView() {
    return HistoryListView.__super__.constructor.apply(this, arguments);
  }

  HistoryListView.prototype.pageSize = 100;

  return HistoryListView;

})(ProfileListView);


},{"./list-view":679}],674:[function(require,module,exports){
var Chaplin, FollowButtonView, IdentityM, IdentityView, View, mediator, template, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

IdentityM = require('../../models/identity-model');

template = require('../../templates/profile/identity');

FollowButtonView = require('../follow-button-view');

Chaplin = require('chaplin');

mediator = Chaplin.mediator;

utils = require('../../lib/utils');

module.exports = IdentityView = (function(_super) {
  __extends(IdentityView, _super);

  function IdentityView() {
    return IdentityView.__super__.constructor.apply(this, arguments);
  }

  IdentityView.prototype.autoRender = true;

  IdentityView.prototype.template = template;

  IdentityView.prototype.className = 'identity-view';

  IdentityView.prototype.listen = {
    'change model': 'render'
  };

  IdentityView.prototype.initialize = function() {
    IdentityView.__super__.initialize.apply(this, arguments);
    this.model = mediator.currentProfileM.get('identityM');
    return this.model.set('_trackingPrefix', utils.isVisitor() ? 'visitor:' : '');
  };

  IdentityView.prototype.attach = function() {
    var _ref;
    IdentityView.__super__.attach.apply(this, arguments);
    if (!utils.isVisitor() && ((_ref = mediator.userM) != null ? _ref.get('userid') : void 0) !== this.model.get('userid')) {
      return this.subview('follow-btn', new FollowButtonView({
        model: this.model,
        container: this.$el.find('.follow-container'),
        trackingPrefix: 'profile:identity-view:',
        _onlyHeaderReset: false
      }));
    }
  };

  IdentityView.prototype.onHoverUserImg = function() {};

  return IdentityView;

})(View);


},{"../../lib/utils":156,"../../models/identity-model":186,"../../templates/profile/identity":"e5FUOS","../base/view":608,"../follow-button-view":644,"chaplin":773}],675:[function(require,module,exports){
var $, Chaplin, ListEditView, ModalView, Model, Relate, View, mediator, panel, template, user,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/profile/list-edit');

panel = require('../../lib/panel');

user = require('../../lib/user');

ModalView = require('../modal-view');

Model = require('../../models/base/model');

Chaplin = require('chaplin');

mediator = Chaplin.mediator;

$ = require('jquery');

Relate = require('../../lib/relate');

module.exports = ListEditView = (function(_super) {
  __extends(ListEditView, _super);

  function ListEditView() {
    return ListEditView.__super__.constructor.apply(this, arguments);
  }

  ListEditView.prototype.template = template;

  ListEditView.prototype.autoRender = true;

  ListEditView.prototype.className = 'list-edit-view';

  ListEditView.prototype.noWrap = true;

  ListEditView.prototype.events = {
    'click [data-id="delete-list"]': 'onClickDelete',
    'click [data-id="cancel-edit"]': 'dispose',
    'click [data-id="save-list"]': 'onClickSave',
    'keydown [data-id="list-name"]': 'onKeyDown',
    'click': 'onClick'
  };

  ListEditView.prototype.listen = {
    'profile:list-edit:opened mediator': 'onNewEditList'
  };

  ListEditView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    ListEditView.__super__.initialize.apply(this, arguments);
    this.relateToSelector = options.relateToSelector;
    return this.publishEvent('profile:list-edit:opened', this);
  };

  ListEditView.prototype.onClickSave = function() {
    var listName, visibility;
    listName = this.$el.find('[data-id="list-name"]').val();
    if (this.$el.find('[data-id="private-list"]').is(":checked")) {
      visibility = 'private';
    } else {
      visibility = 'public';
    }
    this.model.set({
      'visibility': visibility,
      'name': listName
    });
    return this.model.save().then(function() {
      return user.getCurrentUserLists(true);
    });
  };

  ListEditView.prototype.onClick = function(e) {
    if (this.el === e.target) {
      return this.dispose();
    }
  };

  ListEditView.prototype.onKeyDown = function(e) {
    if (e.keyCode === 13) {
      return this.onClickSave();
    }
  };

  ListEditView.prototype.onClickDelete = function() {
    var modalV, modelM;
    $(this.el).hide();
    modelM = new Model({
      _message: 'Are you sure you want to delete this list?',
      _actionName: 'Delete',
      _trackingPrefix: 'profile:list-delete:'
    });
    modalV = new ModalView({
      container: 'body',
      model: modelM
    });
    this.subview('modal-view', modalV);
    this.listenTo(modalV, 'confirmAction', this.onDeleteConfirm);
    return this.listenTo(modalV, 'cancelAction', this.onCancelConfirm);
  };

  ListEditView.prototype.onCancelConfirm = function() {
    return $(this.el).show();
  };

  ListEditView.prototype.onDeleteConfirm = function() {
    var model, options;
    options = {
      wait: true
    };
    model = this.model;
    this.model.destroy(options).then((function(_this) {
      return function() {
        return Chaplin.utils.redirectTo({
          url: "/stumbler/" + (model.get("_owner_username")) + "/lists"
        });
      };
    })(this));
    return this.dispose();
  };

  ListEditView.prototype.onNewEditList = function(view) {
    if (view !== this) {
      return this.dispose();
    }
  };

  ListEditView.prototype.setPosition = function() {
    if (this.relate) {
      this.relate.dispose();
    }
    this.relate = new Relate(this.$el, {
      position: 'bottomleft'
    });
    return this.relate.to(this.relateToSelector);
  };

  ListEditView.prototype.attach = function() {
    ListEditView.__super__.attach.apply(this, arguments);
    if (this.relateToSelector) {
      return this.setPosition();
    }
  };

  ListEditView.prototype.dispose = function() {
    ListEditView.__super__.dispose.apply(this, arguments);
    if (this.relate) {
      return this.relate.dispose();
    }
  };

  return ListEditView;

})(View);


},{"../../lib/panel":125,"../../lib/relate":127,"../../lib/user":155,"../../models/base/model":168,"../../templates/profile/list-edit":"TDFRAI","../base/view":608,"../modal-view":664,"chaplin":773,"jquery":774}],676:[function(require,module,exports){
var TagCloudItemView, View, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/profile/list-item-tag');

mediator = require('chaplin').mediator;

module.exports = TagCloudItemView = (function(_super) {
  __extends(TagCloudItemView, _super);

  function TagCloudItemView() {
    return TagCloudItemView.__super__.constructor.apply(this, arguments);
  }

  TagCloudItemView.prototype.className = 'list-item-tag';

  TagCloudItemView.prototype.template = template;

  TagCloudItemView.prototype.initialize = function() {
    var identityM;
    TagCloudItemView.__super__.initialize.apply(this, arguments);
    identityM = mediator.currentProfileM.get('identityM');
    return this.model.set('_username', identityM.get('username'));
  };

  return TagCloudItemView;

})(View);


},{"../../templates/profile/list-item-tag":"dGXMmo","../base/view":608,"chaplin":773}],677:[function(require,module,exports){
var CollectionView, ListItemTagView, ListItemTagsView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('../base/collection-view');

template = require('../../templates/profile/list-item-tags');

ListItemTagView = require('./list-item-tag-view');

module.exports = ListItemTagsView = (function(_super) {
  __extends(ListItemTagsView, _super);

  function ListItemTagsView() {
    return ListItemTagsView.__super__.constructor.apply(this, arguments);
  }

  ListItemTagsView.prototype.autoRender = true;

  ListItemTagsView.prototype.className = 'list-item-tags';

  ListItemTagsView.prototype.template = template;

  ListItemTagsView.prototype.itemView = ListItemTagView;

  return ListItemTagsView;

})(CollectionView);


},{"../../templates/profile/list-item-tags":"+e+sDE","../base/collection-view":606,"./list-item-tag-view":676}],678:[function(require,module,exports){
var DropdownShareView, ListEditView, ListItemTagsView, ModalView, Model, ProfileAddToListView, ProfileListItemView, SeenModel, TagItemCollection, View, mediator, panel, profile, user, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

Model = require('../../models/base/model');

panel = require('../../lib/panel');

user = require('../../lib/user');

utils = require('../../lib/utils');

profile = require('../../lib/profile');

mediator = require('chaplin').mediator;

ProfileAddToListView = require('./profile-addtolist-view');

ModalView = require('../modal-view');

SeenModel = require('../../models/seen-model');

ListEditView = require('./list-edit-view');

DropdownShareView = require('../profile/dropdown-share-profile-view');

TagItemCollection = require('../../models/tag-item-collection');

ListItemTagsView = require('./list-item-tags-view');

module.exports = ProfileListItemView = (function(_super) {
  __extends(ProfileListItemView, _super);

  function ProfileListItemView() {
    return ProfileListItemView.__super__.constructor.apply(this, arguments);
  }

  ProfileListItemView.prototype.className = 'list-item';

  ProfileListItemView.prototype.events = {
    'click [data-id="item-share-btn"]': 'onShareClick',
    'click [data-id="item-like-btn"]': 'onLikeClick',
    'click [data-id="item-add-btn"]': 'onAddClick',
    'click [data-id="item-delete-btn"]': 'onDeleteClick',
    'click [data-id="item-edit-btn"]': 'onEditClick',
    'click .list-text .title': 'reportSeen',
    'click .list-thumb': 'reportSeen',
    'click .tile-top': 'reportSeen',
    'click .tile-bottom .title': 'reportSeen'
  };

  ProfileListItemView.prototype.listen = {
    'change model': 'render'
  };

  ProfileListItemView.prototype.viewLists = false;

  ProfileListItemView.prototype.getTemplate = function() {
    var currentList, currentProfileM, identityM;
    currentProfileM = mediator.currentProfileM;
    identityM = currentProfileM.get('identityM');
    currentList = identityM.get('_currentList');
    this.viewLists = currentList === 'lists' || currentList === 'following-lists';
    this.model.set("_notHistory", currentList !== 'history');
    if (this.viewLists) {
      if (currentProfileM.get('listv') === 'tile') {
        return require('../../templates/profile/lists-item-tile');
      } else {
        return require('../../templates/profile/lists-list-item');
      }
    } else if (currentProfileM.get('listv') === 'tile') {
      return require('../../templates/profile/list-item-tile');
    } else {
      return require('../../templates/profile/list-item');
    }
  };

  ProfileListItemView.prototype.onEditClick = function() {
    if (this.subview('editlist') && !this.subview('editlist').disposed) {
      return this.removeEditList();
    } else {
      this.removeSubviews();
      return this.subview('editlist', new ListEditView({
        container: this.$el.find('.edit-list-container'),
        model: this.model,
        relateToSelector: this.$el.find("[data-id=item-edit-btn]")
      }));
    }
  };

  ProfileListItemView.prototype.removeEditList = function() {
    if (this.subview('editlist')) {
      return this.removeSubview('editlist');
    }
  };

  ProfileListItemView.prototype.removeShare = function() {
    if (this.subview('shareitem')) {
      return this.removeSubview('shareitem');
    }
  };

  ProfileListItemView.prototype.removeSubviews = function() {
    this.removeAddToList();
    this.removeEditList();
    return this.removeShare();
  };

  ProfileListItemView.prototype.onShareClick = function() {
    if (this.subview('shareitem') && !this.subview('shareitem').disposed) {
      return this.removeShare();
    } else {
      this.removeSubviews();
      return this.subview('shareitem', new DropdownShareView({
        container: this.$el.find('.dropdown-container'),
        model: this.model
      }));
    }
  };

  ProfileListItemView.prototype.onLikeClick = function() {
    var rating;
    this.removeSubviews();
    rating = this.model.get('rating');
    if (rating === null) {
      this.model.set('rating', 1);
    } else if (rating === 0 || rating === -1) {
      this.model.set('rating', 1);
    } else if (rating === 1) {
      this.model.set('rating', 0);
    }
    return this.model.save();
  };

  ProfileListItemView.prototype.removeAddToList = function() {
    if (this.subview('addtolist')) {
      return this.removeSubview('addtolist');
    }
  };

  ProfileListItemView.prototype.onAddClick = function(e) {
    if (this.subview('addtolist') && !this.subview('addtolist').disposed) {
      return this.removeAddToList();
    } else {
      this.removeSubviews();
      return this.subview('addtolist', new ProfileAddToListView({
        container: this.$el.find('.addtolist-container'),
        collection: user.getCurrentUserLists(),
        model: this.model,
        relateToSelector: this.$el.find("[data-id=item-add-btn]")
      }));
    }
  };

  ProfileListItemView.prototype.onDeleteClick = function() {
    var modalV, modelM;
    modelM = new Model({
      _message: 'Are you sure you want to remove this page from the list?',
      _actionName: 'Delete',
      _trackingPrefix: 'profile:list-item-delete:'
    });
    modalV = new ModalView({
      container: 'body',
      model: modelM
    });
    this.subview('modal-view', modalV);
    return this.listenTo(modalV, 'confirmAction', this.onDeleteConfirm);
  };

  ProfileListItemView.prototype.onDeleteConfirm = function() {
    var id, modelTemp, options, promise, _ref;
    modelTemp = this.model;
    id = this.model.get('_id');
    if (id === 'likes' || ((_ref = this.model.collection) != null ? _ref.constructor.name : void 0) === 'LikesCollection') {
      this.model.set('rating', 0);
      promise = this.model.save();
      this.model.collection.remove(this.model);
      this.dispose();
    } else {
      options = {};
      options.data = {
        id: id,
        listId: this.model.collection.listId
      };
      this.model.collection.remove(this.model);
      promise = modelTemp.destroy(options);
    }
    return promise.then(function() {
      mediator.publish('profile:itemremovedfromlist');
      return panel.displaySuccessMsg("Item has been removed.");
    }, function() {
      return panel.displayErrorMsg("There was an error removing that item.");
    });
  };

  ProfileListItemView.prototype.reportSeen = function() {
    var seenM;
    seenM = new SeenModel({
      urlid: this.model.get('urlid'),
      source: 'single_list'
    });
    return seenM.save();
  };

  ProfileListItemView.prototype.render = function() {
    var isSelf, thumbnail_b, _ref;
    thumbnail_b = this.model.get('thumbnail_b') || this.model.get('picture_med') || 'https://nb9-stumbleupon.netdna-ssl.com/qd2XW2ApGssxAW0J-XD3Ag';
    if (!this.model.get('_thumbnail')) {
      this.model.set('_thumbnail', thumbnail_b);
    }
    this.model.set('_trackingPrefix', utils.isVisitor() ? 'visitor:' : '');
    ProfileListItemView.__super__.render.apply(this, arguments);
    isSelf = (_ref = mediator.currentProfileM.get('identityM')) != null ? _ref.get('_isSelf') : void 0;
    if (isSelf) {
      return this.createTagsSubview();
    }
  };

  ProfileListItemView.prototype.createTagsSubview = function() {
    var tagsCollection, _ref;
    tagsCollection = new TagItemCollection((_ref = this.model.get('tags')) != null ? _ref.values : void 0);
    return this.subview('tags-list', new ListItemTagsView({
      container: this.$el.find('.tag-list-container'),
      collection: tagsCollection
    }));
  };

  return ProfileListItemView;

})(View);


},{"../../lib/panel":125,"../../lib/profile":126,"../../lib/user":155,"../../lib/utils":156,"../../models/base/model":168,"../../models/seen-model":228,"../../models/tag-item-collection":245,"../../templates/profile/list-item":"Kxz49+","../../templates/profile/list-item-tile":"5XIoxk","../../templates/profile/lists-item-tile":"uhDMwl","../../templates/profile/lists-list-item":"3/QYti","../base/view":608,"../modal-view":664,"../profile/dropdown-share-profile-view":672,"./list-edit-view":675,"./list-item-tags-view":677,"./profile-addtolist-view":683,"chaplin":773}],679:[function(require,module,exports){
var CollectionView, ListItemV, ProfileListView, StumbleM, mediator, template, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/profile/list');

CollectionView = require('../base/collection-view');

ListItemV = require('./list-item-view');

utils = require('../../lib/utils');

StumbleM = require('../../models/stumble-model');

mediator = require('chaplin').mediator;

_ = require('lodash');

module.exports = ProfileListView = (function(_super) {
  __extends(ProfileListView, _super);

  function ProfileListView() {
    return ProfileListView.__super__.constructor.apply(this, arguments);
  }

  ProfileListView.prototype.itemView = ListItemV;

  ProfileListView.prototype.className = 'list-view';

  ProfileListView.prototype.template = template;

  ProfileListView.prototype.listSelector = '.list-content';

  ProfileListView.prototype.listen = {
    'profile:itemaddedtolist mediator': 'onItemAddedToList',
    'profile:itemremovedfromlist mediator': 'onItemRemovedFromList'
  };

  ProfileListView.prototype.initialize = function(options) {
    ProfileListView.__super__.initialize.apply(this, arguments);
    this.currentPage = options.pageNumber;
    return this.listId = options.listId;
  };

  ProfileListView.prototype.itemAdded = function(model, collection, response) {
    var collectionName, _ref;
    ProfileListView.__super__.itemAdded.apply(this, arguments);
    collectionName = (_ref = this.collection) != null ? _ref.constructor.name : void 0;
    if ((model != null) && (collectionName === "ProfileListItemsCollection" || collectionName === "LikesCollection") && utils.isVisitor()) {
      if (mediator.stumblesC.currentExternalCollection !== collectionName) {
        mediator.stumblesC.reset();
        mediator.stumblesC.currentExternalCollection = collectionName;
      }
      return mediator.stumblesC.add(new StumbleM(model.attributes));
    }
  };

  ProfileListView.prototype.onItemAddedToList = function(url, listId) {
    if (this.listId === listId || listId === 'likes') {
      if (this.collection.length === 0) {
        this.$el.find('.empty-list-container').hide();
      }
      if (this.listId === 'likes') {
        return this.collection.unshift(url);
      } else {
        return this.collection.fetch({
          reset: true
        });
      }
    }
  };

  ProfileListView.prototype.onItemRemovedFromList = function() {
    if (this.collection.length === 0) {
      return this.$el.find('.empty-list-container').show();
    }
  };

  ProfileListView.prototype.getRequestMixin = function() {
    var identityM;
    identityM = mediator.currentProfileM.get('identityM');
    return {
      userid: identityM.get('userid'),
      listId: this.listId
    };
  };

  return ProfileListView;

})(CollectionView);


},{"../../lib/utils":156,"../../models/stumble-model":239,"../../templates/profile/list":"92Q5ld","../base/collection-view":606,"./list-item-view":678,"chaplin":773,"lodash":776}],680:[function(require,module,exports){
var ProfileListView, ProfileListsView, mediator,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ProfileListView = require('./list-view');

mediator = require('chaplin').mediator;

module.exports = ProfileListsView = (function(_super) {
  __extends(ProfileListsView, _super);

  function ProfileListsView() {
    return ProfileListsView.__super__.constructor.apply(this, arguments);
  }

  ProfileListsView.prototype.getRequestMixin = function() {
    var identityM;
    identityM = mediator.currentProfileM.get('identityM');
    return {
      userid: identityM.get('userid'),
      sorted: true
    };
  };

  return ProfileListsView;

})(ProfileListView);


},{"./list-view":679,"chaplin":773}],681:[function(require,module,exports){
var CollectionView, ListItemV, LoadingListView, PaginatedListView, PaginationView, mediator, template, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/profile/list');

CollectionView = require('../base/collection-view');

ListItemV = require('./list-item-view');

LoadingListView = require('../loading-list-view');

PaginationView = require('../pagination-view');

mediator = require('chaplin').mediator;

_ = require('lodash');

module.exports = PaginatedListView = (function(_super) {
  __extends(PaginatedListView, _super);

  function PaginatedListView() {
    return PaginatedListView.__super__.constructor.apply(this, arguments);
  }

  PaginatedListView.prototype.getRequestMixin = function() {
    return {};
  };

  PaginatedListView.prototype.renderAllItems = function() {
    PaginatedListView.__super__.renderAllItems.apply(this, arguments);
    if (!this.subview('loading-indicator')) {
      this.subview('loading-indicator', new LoadingListView({
        collection: this.collection,
        container: this.$el.find('.loading-container')
      }));
    }
    if (this.collection._total && this.collection._total > mediator.profileItemsPerPage) {
      return this.subview('pagination-view', new PaginationView({
        container: this.$el.find('.pagination-container'),
        totalItems: this.collection._total || 0,
        itemsPerPage: mediator.profileItemsPerPage,
        currentPage: this.currentPage
      })).on('change:page', _.debounce(this.onPageChange, 250), this);
    }
  };

  PaginatedListView.prototype.onPageChange = function(newPageNum) {
    var identityM, options, _ref, _ref1;
    this.publishEvent('profile:currentPageNumber', newPageNum);
    if ((_ref = this.$el) != null) {
      if ((_ref1 = _ref.parent()) != null) {
        _ref1[0].scrollTop = 0;
      }
    }
    _.values(this.getItemViews()).forEach(function(view) {
      return view.$el.css({
        'visibility': 'hidden'
      });
    });
    identityM = mediator.currentProfileM.get('identityM');
    this.currentPage = newPageNum;
    newPageNum -= 1;
    options = {
      reset: true,
      data: {
        offset: newPageNum * mediator.profileItemsPerPage,
        limit: mediator.profileItemsPerPage,
        userid: identityM.get('userid')
      }
    };
    options.data = _.extend({}, options.data, this.getRequestMixin());
    return this.collection.fetch(options);
  };

  return PaginatedListView;

})(CollectionView);


},{"../../templates/profile/list":"92Q5ld","../base/collection-view":606,"../loading-list-view":660,"../pagination-view":668,"./list-item-view":678,"chaplin":773,"lodash":776}],682:[function(require,module,exports){
var ProfileAddToListItemView, View, lists, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/profile/profile-addtolist-item');

lists = require('../../lib/lists');

module.exports = ProfileAddToListItemView = (function(_super) {
  __extends(ProfileAddToListItemView, _super);

  function ProfileAddToListItemView() {
    return ProfileAddToListItemView.__super__.constructor.apply(this, arguments);
  }

  ProfileAddToListItemView.prototype.template = template;

  ProfileAddToListItemView.prototype.className = 'addtolist-item';

  ProfileAddToListItemView.prototype.events = {
    'click': 'onClickItem'
  };

  ProfileAddToListItemView.prototype.listen = {
    'change:_queued model': 'setSelectedState'
  };

  ProfileAddToListItemView.prototype.onClickItem = function(e) {
    this.model.set('_queued', !this.model.get('_queued'));
    return this.setSelectedState();
  };

  ProfileAddToListItemView.prototype.setSelectedState = function() {
    return this.$el.toggleClass('selected', this.model.get('_queued') || false);
  };

  ProfileAddToListItemView.prototype.render = function() {
    ProfileAddToListItemView.__super__.render.apply(this, arguments);
    return this.setSelectedState();
  };

  return ProfileAddToListItemView;

})(View);


},{"../../lib/lists":122,"../../templates/profile/profile-addtolist-item":"0RNmO8","../base/view":608}],683:[function(require,module,exports){
var $, CollectionView, LoadingIndicatorView, ProfileAddToListItemV, ProfileAddToListView, Relate, lists, mediator, template, user, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('../base/collection-view');

template = require('../../templates/profile/profile-addtolist');

ProfileAddToListItemV = require('./profile-addtolist-item-view');

LoadingIndicatorView = require('../loading-indicator-view');

mediator = require('chaplin').mediator;

lists = require('../../lib/lists');

user = require('../../lib/user');

_ = require('lodash');

$ = require('jquery');

Relate = require('../../lib/relate');

module.exports = ProfileAddToListView = (function(_super) {
  __extends(ProfileAddToListView, _super);

  function ProfileAddToListView() {
    return ProfileAddToListView.__super__.constructor.apply(this, arguments);
  }

  ProfileAddToListView.prototype.itemView = ProfileAddToListItemV;

  ProfileAddToListView.prototype.className = 'addtolist-view';

  ProfileAddToListView.prototype.template = template;

  ProfileAddToListView.prototype.listSelector = '.addtolist-item-container';

  ProfileAddToListView.prototype.events = {
    'keyup [data-id=search-list]': 'onSearchKeyUp',
    'click [data-id=create-list]': 'onCreateList',
    'click [data-id=addtolist-save]:not(.disabled)': 'onClickSave',
    'click [data-id=addtolist-cancel]': 'onClickCancel'
  };

  ProfileAddToListView.prototype.listen = {
    'profile:addtolists:opened mediator': 'onNewAddToList',
    'profile:list:created mediator': 'onListCreated',
    'profile:url:submitted mediator': 'onUrlSubmitted',
    'change:_queued collection': 'onQueueChange'
  };

  ProfileAddToListView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    ProfileAddToListView.__super__.initialize.apply(this, arguments);
    this.mouseCoords = options.mouseCoords;
    this.publishEvent('profile:addtolists:opened', this);
    this.relateToSelector = options.relateToSelector;
    return this.urlM = options.urlM;
  };

  ProfileAddToListView.prototype.onUrlSubmitted = function(urlid) {
    this.urlM.set('urlid', urlid);
    if (urlid) {
      return this.saveToLists(urlid);
    }
  };

  ProfileAddToListView.prototype.onClickSave = function() {
    var url, urlid, _ref, _ref1;
    url = (_ref = this.urlM) != null ? _ref.get('url') : void 0;
    urlid = (_ref1 = this.model) != null ? _ref1.get('urlid') : void 0;
    this.$el.hide();
    this.announceClosed();
    if (url) {
      return lists.submitUrl(url);
    } else if (urlid) {
      return this.saveToLists(urlid);
    }
  };

  ProfileAddToListView.prototype.saveToLists = function(urlid) {
    _.each(this.getQueued(), function(listM) {
      var listId, listName;
      listId = listM.get('id');
      listName = listM.get('name');
      if (!listId && listName) {
        return lists.createList(listName);
      } else if (listId && urlid) {
        return lists.addItemToList(urlid, listId);
      } else if (!urlid) {
        return console.error('Url ID required');
      }
    });
    return this.dequeueAll();
  };

  ProfileAddToListView.prototype.onListCreated = function(listM) {
    var listId, urlid, _ref;
    listId = listM.get('id');
    urlid = ((_ref = this.model) != null ? _ref.get('urlid') : void 0) || this.urlM.get('urlid');
    user.getCurrentUserLists().add(listM.toJSON());
    return lists.addItemToList(urlid, listId);
  };

  ProfileAddToListView.prototype.onClickCancel = function() {
    this.announceClosed();
    this.dequeueAll();
    return this.dispose();
  };

  ProfileAddToListView.prototype.getQueued = function() {
    return this.collection.where({
      '_queued': true
    });
  };

  ProfileAddToListView.prototype.dequeueAll = function() {
    this.collection.remove(this.collection.where({
      '_fake': true
    }));
    this.collection.invoke('unset', '_queued');
    return this.collection.invoke('unset', '_sortOrder');
  };

  ProfileAddToListView.prototype.announceClosed = function() {
    return this.publishEvent('profile:addtolists:closed');
  };

  ProfileAddToListView.prototype.getSearchString = function() {
    return $.trim(this.$el.find('[data-id=search-list]').val());
  };

  ProfileAddToListView.prototype.resetInput = function() {
    this.$el.find('[data-id=search-list]').val('');
    this.filter(this.filterLists);
    return this.toggleCreateList();
  };

  ProfileAddToListView.prototype.onQueueChange = function() {
    var $saveBtn;
    $saveBtn = this.$el.find('[data-id=addtolist-save]');
    this.resetInput();
    if (this.getQueued().length) {
      return $saveBtn.removeClass('disabled');
    } else {
      return $saveBtn.addClass('disabled');
    }
  };

  ProfileAddToListView.prototype.onSearchKeyUp = function(e) {
    var listMatchId, listMatchM, listMatchName, str;
    str = this.getSearchString();
    listMatchM = this.collection.find(function(item) {
      return item.get('name').toLowerCase() === str.toLowerCase();
    });
    listMatchId = listMatchM != null ? listMatchM.get('id') : void 0;
    listMatchName = listMatchM != null ? listMatchM.get('name') : void 0;
    if (e.keyCode === 13) {
      if (str) {
        if (str && listMatchId) {
          return listMatchM.set('_queued', true);
        } else if (str !== listMatchName) {
          return this.onCreateList();
        }
      }
    } else {
      if (listMatchId) {
        this.toggleCreateList();
      } else {
        this.toggleCreateList(str);
      }
      return this.filter(this.filterLists);
    }
  };

  ProfileAddToListView.prototype.filterLists = function(item, index) {
    var listname, str;
    str = this.getSearchString();
    listname = item.get('name').toLowerCase();
    if (str) {
      return _(listname).contains(str.toLowerCase());
    } else {
      return true;
    }
  };

  ProfileAddToListView.prototype.toggleCreateList = function(str) {
    if (str) {
      return this.$el.find('.create-list').show().find('.create-list-name').html(str);
    } else {
      return this.$el.find('.create-list').hide();
    }
  };

  ProfileAddToListView.prototype.onCreateList = function() {
    var listname;
    listname = this.getSearchString();
    this.collection.add({
      '_queued': true,
      '_fake': true,
      '_sortOrder': 0,
      'name': listname
    });
    this.onQueueChange();
    return this.resetInput();
  };

  ProfileAddToListView.prototype.onNewAddToList = function(view) {
    if (view !== this) {
      return this.dispose();
    }
  };

  ProfileAddToListView.prototype.setPosition = function() {
    if (this.relate) {
      this.relate.dispose();
    }
    this.relate = new Relate(this.$el, {
      position: 'bottomcenter'
    });
    return this.relate.to(this.relateToSelector);
  };

  ProfileAddToListView.prototype.attach = function() {
    ProfileAddToListView.__super__.attach.apply(this, arguments);
    if (this.relateToSelector) {
      return this.setPosition();
    }
  };

  ProfileAddToListView.prototype.render = function() {
    var urlid;
    ProfileAddToListView.__super__.render.apply(this, arguments);
    this.onQueueChange();
    if (this.model) {
      urlid = this.model.get('publicid') || this.model.get('urlid');
      this.$el.attr("data-urlid", urlid);
    }
    return this.subview('loading-indicator', new LoadingIndicatorView({
      collection: this.collection,
      container: this.$el.find('.loading-indicator-container')
    }));
  };

  ProfileAddToListView.prototype.dispose = function() {
    ProfileAddToListView.__super__.dispose.apply(this, arguments);
    if (this.relate) {
      return this.relate.dispose();
    }
  };

  return ProfileAddToListView;

})(CollectionView);


},{"../../lib/lists":122,"../../lib/relate":127,"../../lib/user":155,"../../templates/profile/profile-addtolist":"3RW9j/","../base/collection-view":606,"../loading-indicator-view":659,"./profile-addtolist-item-view":682,"chaplin":773,"jquery":774,"lodash":776}],684:[function(require,module,exports){
var ProfileView, View, template, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

utils = require('../../lib/utils');

template = require('../../templates/profile/profile');

module.exports = ProfileView = (function(_super) {
  __extends(ProfileView, _super);

  function ProfileView() {
    return ProfileView.__super__.constructor.apply(this, arguments);
  }

  ProfileView.prototype.template = template;

  ProfileView.prototype.className = 'profile-view fluid-container';

  ProfileView.prototype.regions = {
    'profilehead': '#profilehead-container',
    'profile': '#profile-container'
  };

  ProfileView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM',
    'window:resize mediator': 'resizeFrame',
    'smartbanner:closed mediator': function() {
      return this.resizeFrame(false, true);
    },
    'panel:opened mediator': 'onPanelOpen',
    'panel:closed mediator': 'onPanelClose',
    'progressbar:close mediator': function() {
      return this.resizeFrame(false);
    }
  };

  ProfileView.prototype.onAddedToDOM = function() {
    return utils.onContentLoaded();
  };

  ProfileView.prototype.onPanelClose = function() {
    return this.resizeFrame(true);
  };

  ProfileView.prototype.onPanelOpen = function() {
    return this.resizeFrame();
  };

  return ProfileView;

})(View);


},{"../../lib/utils":156,"../../templates/profile/profile":"nKeBKw","../base/view":608}],685:[function(require,module,exports){
var ProfileHeadFollowView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/profile/profilehead-follow');

module.exports = ProfileHeadFollowView = (function(_super) {
  __extends(ProfileHeadFollowView, _super);

  function ProfileHeadFollowView() {
    return ProfileHeadFollowView.__super__.constructor.apply(this, arguments);
  }

  ProfileHeadFollowView.prototype.autoRender = true;

  ProfileHeadFollowView.prototype.template = template;

  ProfileHeadFollowView.prototype.className = 'profilehead-follow-view';

  ProfileHeadFollowView.prototype.listen = {
    'change model': 'render'
  };

  return ProfileHeadFollowView;

})(View);


},{"../../templates/profile/profilehead-follow":"7zsOPi","../base/view":608}],686:[function(require,module,exports){
var $, AddPageView, DropdownListView, FollowButtonV, IdentityView, ListEditView, ProfileHeadFollowView, ProfileHeadView, ReportStumblerM, ReportStumblerView, View, mediator, panel, template, user, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/profile/profilehead');

AddPageView = require('./add-page-view');

ListEditView = require('./list-edit-view');

DropdownListView = require('../dropdown-list-view');

FollowButtonV = require('../follow-button-view');

IdentityView = require('./identity-view');

ProfileHeadFollowView = require('./profilehead-follow-view');

ReportStumblerView = require('../report-stumbler-view');

ReportStumblerM = require('../../models/report-stumbler-model');

panel = require('../../lib/panel');

utils = require('../../lib/utils');

user = require('../../lib/user');

_ = require('lodash');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = ProfileHeadView = (function(_super) {
  __extends(ProfileHeadView, _super);

  function ProfileHeadView() {
    return ProfileHeadView.__super__.constructor.apply(this, arguments);
  }

  ProfileHeadView.prototype.autoRender = true;

  ProfileHeadView.prototype.template = template;

  ProfileHeadView.prototype.className = 'profilehead-view';

  ProfileHeadView.prototype.events = {
    'click [data-id=find-friends]': 'onClickFindFriends',
    'click [data-id=stumble-like-btn]': 'onClickStumbleLikes',
    'click [data-id=stumble-list]': 'onClickStumbleList',
    'click [data-id=stumble-photos]': 'onClickStumblePhotos',
    'click [data-id=stumble-videos]': 'onClickStumbleVideos',
    'click [data-id=add-page]': 'onClickAddPage',
    'click [data-id=edit-list]': 'onClickEditList',
    'click [data-id=toggle-list-view]': 'onToggleListView',
    'click [data-id=toggle-tile-view]': 'onToggleTileView',
    'keyup [data-id=search-header]': 'onSearchKeyup',
    'click [data-id=search-reset]': 'resetSearch',
    'click [data-id=list-title]': 'onClickListTitle',
    'click [data-id=search-label]': 'onClickSearchIcon',
    'click [data-id=report-user]': 'onClickReportStumbler'
  };

  ProfileHeadView.prototype.listen = {
    'change model': 'render',
    'profile:refresh:header mediator': 'render',
    'panel:opened mediator': 'onPanelOpened',
    'addpageview:close mediator': 'removeModal'
  };

  ProfileHeadView.prototype.attach = function() {
    var currentProfileM, identityM, listType, trackingPrefix;
    ProfileHeadView.__super__.attach.apply(this, arguments);
    currentProfileM = mediator.currentProfileM;
    identityM = currentProfileM.get('identityM');
    listType = currentProfileM.get('listv') || 'tile';
    this.$el.find('[data-id=toggle-' + listType + '-view]').hide();
    trackingPrefix = utils.isVisitor() ? 'visitor:' : '';
    if (this.model.get('_canFollow')) {
      this.subview('follow-btn', new FollowButtonV({
        container: this.$el.find('.following-container'),
        model: identityM,
        trackingPrefix: 'profile:list-header:',
        _textPostfix: 'User',
        _onlyHeaderReset: (this.model.get('_selectorName') !== 'Following') && (this.model.get('_selectorName') !== 'Followers')
      }));
    }
    this.subview('identity', new IdentityView({
      container: this.$el.find('#identity-container'),
      _trackingPrefix: trackingPrefix
    }));
    this.subview('profilehead-follow', new ProfileHeadFollowView({
      container: this.$el.find('.profile-follow-container'),
      model: identityM,
      _trackingPrefix: trackingPrefix
    }));
    return this.subview('dropdown-list', new DropdownListView({
      container: this.$el.find('#dropdown-list-container'),
      model: identityM,
      _trackingPrefix: trackingPrefix
    }));
  };

  ProfileHeadView.prototype.onClickFindFriends = function() {
    return Chaplin.utils.redirectTo({
      url: "invite/confirm"
    });
  };

  ProfileHeadView.prototype.removeModal = function() {
    return this.removeSubview('modal');
  };

  ProfileHeadView.prototype.onClickAddPage = function() {
    var modal;
    modal = this.subview('modal');
    this.removeModal();
    if (!(modal instanceof AddPageView)) {
      return this.subview('modal', new AddPageView({
        container: this.$el.find('.add-page-container'),
        model: this.model,
        relateToSelector: this.$el.find('[data-id=add-page]')
      }));
    }
  };

  ProfileHeadView.prototype.onClickListTitle = function() {
    if ($('.dropdown-visible')[0]) {
      return $('#dropdown-list-container').removeClass('dropdown-visible');
    } else {
      if (_.indexOf(["dropdown-thumbdown", "dropdown-share", "dropdown-menu"], panel.getCurrentPanel()) !== -1) {
        panel.close();
      }
      return $('#dropdown-list-container').addClass('dropdown-visible');
    }
  };

  ProfileHeadView.prototype.onPanelOpened = function() {
    return $('#dropdown-list-container').removeClass('dropdown-visible');
  };

  ProfileHeadView.prototype.onClickEditList = function() {
    var modal;
    modal = this.subview('modal');
    this.removeModal();
    if (!(modal instanceof ListEditView) || modal.disposed) {
      return this.subview('modal', new ListEditView({
        container: this.$el.find('.edit-list-container'),
        model: this.model,
        relateToSelector: this.$el.find("[data-id=edit-list]")
      }));
    }
  };

  ProfileHeadView.prototype.resetSearch = function() {
    this.$el.find('[data-id=search-header]').val('');
    this.$el.find('[data-id=search-reset]').hide();
    this.$el.find('[data-id=search-label]').show();
    return this.publishSearchEvent(false);
  };

  ProfileHeadView.prototype.onClickStumbleLikes = function() {
    var identityM, modeInfo, name;
    if (utils.isVisitor()) {
      return this.publishEvent('stumble:next');
    } else {
      identityM = mediator.currentProfileM.get('identityM');
      name = identityM.get('username') + "'s Likes";
      modeInfo = {
        name: name,
        _mode: 'user',
        _hide: true,
        userids: [identityM.get('userid')],
        stumblername: identityM.get('username'),
        stumblerId: identityM.get('userid')
      };
      mediator.modesC.add(_.extend(modeInfo));
      return mediator.modesC.setActive(name);
    }
  };

  ProfileHeadView.prototype.onClickStumblePhotos = function() {};

  ProfileHeadView.prototype.onClickStumbleVideos = function() {};

  ProfileHeadView.prototype.onClickStumbleList = function() {
    var modeInfo, name;
    if (utils.isVisitor()) {
      return this.publishEvent('stumble:next');
    } else {
      name = this.model.get('name');
      modeInfo = {
        name: name,
        _mode: 'list',
        _hide: true,
        listId: this.model.get('id')
      };
      mediator.modesC.add(_.extend(modeInfo));
      return mediator.modesC.setActive(name);
    }
  };

  ProfileHeadView.prototype.onSearchKeyup = function(e) {
    var value;
    value = this.$el.find('[data-id=search-header]').val();
    if (!value || e.keyCode === 27) {
      this.resetSearch();
    } else if (value) {
      this.$el.find('[data-id=search-reset]').show();
      this.$el.find('[data-id=search-label]').hide();
    }
    if (e.keyCode === 13) {
      return this.publishSearchEvent(value);
    }
  };

  ProfileHeadView.prototype.onToggleTileView = function() {
    this.$el.find('[data-id=toggle-list-view]').show();
    this.$el.find('[data-id=toggle-tile-view]').hide();
    return this.setListView('tile');
  };

  ProfileHeadView.prototype.onToggleListView = function() {
    this.$el.find('[data-id=toggle-list-view]').hide();
    this.$el.find('[data-id=toggle-tile-view]').show();
    return this.setListView('list');
  };

  ProfileHeadView.prototype.publishSearchEvent = function(value) {
    return this.publishEvent('profile:searchfromheader', value);
  };

  ProfileHeadView.prototype.setListView = function(type) {
    var currentProfile;
    currentProfile = mediator.currentProfileM;
    if (currentProfile.get('listv') !== type) {
      currentProfile.set('listv', type);
      $.cookie('listv', type);
      return this.publishEvent('profile:viewtype:changed', type);
    }
  };

  ProfileHeadView.prototype.onClickSearchIcon = function() {
    var isOpen;
    isOpen = $('.input-container').hasClass('open');
    if (isOpen) {
      return $('.search-header').animate({
        width: '0',
        opacity: '0'
      }, 300, (function(_this) {
        return function() {
          return $('.input-container').removeClass('open');
        };
      })(this));
    } else {
      $('.input-container').addClass('open');
      return $('.search-header').animate({
        width: '160px',
        opacity: '1'
      }, 300, (function(_this) {
        return function() {
          return $('.search-header').focus();
        };
      })(this));
    }
  };

  ProfileHeadView.prototype.onClickReportStumbler = function() {
    var div, identityM, reportModel;
    if (!this.model.get('_isSelf')) {
      identityM = mediator.currentProfileM.get('identityM');
      reportModel = new ReportStumblerM({
        userid: identityM.get('userid'),
        username: identityM.get('username')
      });
      div = document.createElement("div");
      div.id = "report-stumbler-container";
      document.body.appendChild(div);
      return this.subview('report-stumble', new ReportStumblerView({
        container: $(document).find('#report-stumbler-container'),
        model: reportModel
      }));
    }
  };

  ProfileHeadView.prototype.dispose = function() {
    ProfileHeadView.__super__.dispose.apply(this, arguments);
    return $('#app-container .selectable').off('click', this.onSelectedClick);
  };

  return ProfileHeadView;

})(View);


},{"../../lib/panel":125,"../../lib/user":155,"../../lib/utils":156,"../../models/report-stumbler-model":223,"../../templates/profile/profilehead":"UrF83T","../base/view":608,"../dropdown-list-view":631,"../follow-button-view":644,"../report-stumbler-view":694,"./add-page-view":671,"./identity-view":674,"./list-edit-view":675,"./profilehead-follow-view":685,"chaplin":773,"jquery":774,"lodash":776}],687:[function(require,module,exports){
var SurveyMonkey, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/profile/survey-monkey');

module.exports = SurveyMonkey = (function(_super) {
  __extends(SurveyMonkey, _super);

  function SurveyMonkey() {
    return SurveyMonkey.__super__.constructor.apply(this, arguments);
  }

  SurveyMonkey.prototype.template = template;

  SurveyMonkey.prototype.autoRender = true;

  SurveyMonkey.prototype.container = '.survey-monkey-container';

  return SurveyMonkey;

})(View);


},{"../../templates/profile/survey-monkey":"fthgkn","../base/view":608}],688:[function(require,module,exports){
var $, TagCloudItemView, View, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/profile/tag-cloud-item');

mediator = require('chaplin').mediator;

$ = require('jquery');

module.exports = TagCloudItemView = (function(_super) {
  __extends(TagCloudItemView, _super);

  function TagCloudItemView() {
    return TagCloudItemView.__super__.constructor.apply(this, arguments);
  }

  TagCloudItemView.prototype.className = 'tag-item';

  TagCloudItemView.prototype.template = template;

  TagCloudItemView.prototype.initialize = function() {
    var identityM;
    TagCloudItemView.__super__.initialize.apply(this, arguments);
    identityM = mediator.currentProfileM.get('identityM');
    this.model.set('_username', identityM.get('username'));
    return this.setAppropriateClass(this.model.get('size'));
  };

  TagCloudItemView.prototype.setAppropriateClass = function(size) {
    switch (size) {
      case 11:
        return this.model.set('_class', 'size-1');
      case 17:
        return this.model.set('_class', 'size-2');
      case 21:
        return this.model.set('_class', 'size-3');
      case 26:
        return this.model.set('_class', 'size-4');
      case 30:
        return this.model.set('_class', 'size-5');
      case 38:
        return this.model.set('_class', 'size-6');
      default:
        return this.model.set('_class', 'size-1');
    }
  };

  return TagCloudItemView;

})(View);


},{"../../templates/profile/tag-cloud-item":"dSMe6b","../base/view":608,"chaplin":773,"jquery":774}],689:[function(require,module,exports){
var CollectionView, TagCloudItemView, TagCloudView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('../base/collection-view');

template = require('../../templates/profile/tag-cloud');

TagCloudItemView = require('./tag-cloud-item-view');

module.exports = TagCloudView = (function(_super) {
  __extends(TagCloudView, _super);

  function TagCloudView() {
    return TagCloudView.__super__.constructor.apply(this, arguments);
  }

  TagCloudView.prototype.autoRender = true;

  TagCloudView.prototype.className = 'tag-cloud col-xs-8 col-xs-offset-2';

  TagCloudView.prototype.template = template;

  TagCloudView.prototype.itemView = TagCloudItemView;

  TagCloudView.prototype.region = 'profile';

  return TagCloudView;

})(CollectionView);


},{"../../templates/profile/tag-cloud":"L5TBu7","../base/collection-view":606,"./tag-cloud-item-view":688}],690:[function(require,module,exports){
var UserItemView, View, mediator, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

utils = require('../../lib/utils');

mediator = require('chaplin').mediator;

module.exports = UserItemView = (function(_super) {
  __extends(UserItemView, _super);

  function UserItemView() {
    return UserItemView.__super__.constructor.apply(this, arguments);
  }

  UserItemView.prototype.className = 'user-item';

  UserItemView.prototype.initialize = function() {
    UserItemView.__super__.initialize.apply(this, arguments);
    this.setThumbnail();
    return this.model.set('_trackingPrefix', utils.isVisitor() ? 'visitor:' : '');
  };

  UserItemView.prototype.getTemplate = function() {
    var currentProfileM;
    currentProfileM = mediator.currentProfileM;
    if (currentProfileM.get('listv') === 'tile') {
      return require('../../templates/profile/user-item-tile');
    } else {
      return require('../../templates/profile/user-item');
    }
  };

  UserItemView.prototype.setThumbnail = function() {
    var thumbnail;
    thumbnail = this.model.get('picture_large') || "";
    if (!thumbnail) {
      thumbnail = 'https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg';
    }
    return this.model.set('_thumbnail', thumbnail);
  };

  return UserItemView;

})(View);


},{"../../lib/utils":156,"../../templates/profile/user-item":"0O1UkF","../../templates/profile/user-item-tile":"wtMQFi","../base/view":608,"chaplin":773}],691:[function(require,module,exports){
var CollectionView, LoadingIndicatorView, UserItemV, UsersView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('../base/collection-view');

UserItemV = require('./user-item-view');

LoadingIndicatorView = require('../loading-indicator-view');

template = require('../../templates/profile/list');

module.exports = UsersView = (function(_super) {
  __extends(UsersView, _super);

  function UsersView() {
    return UsersView.__super__.constructor.apply(this, arguments);
  }

  UsersView.prototype.itemView = UserItemV;

  UsersView.prototype.className = 'users-view';

  UsersView.prototype.template = template;

  UsersView.prototype.listSelector = '.list-content';

  UsersView.prototype.getRequestMixin = function() {
    var identityM;
    identityM = Chaplin.mediator.currentProfileM.get('identityM');
    return {
      userid: identityM.get('userid'),
      listId: this.listId
    };
  };

  return UsersView;

})(CollectionView);


},{"../../templates/profile/list":"92Q5ld","../base/collection-view":606,"../loading-indicator-view":659,"./user-item-view":690}],692:[function(require,module,exports){
var RecommendFollowersItemView, StumblerItemView,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

StumblerItemView = require('./stumbler-item-view');

module.exports = RecommendFollowersItemView = (function(_super) {
  __extends(RecommendFollowersItemView, _super);

  function RecommendFollowersItemView() {
    return RecommendFollowersItemView.__super__.constructor.apply(this, arguments);
  }

  RecommendFollowersItemView.prototype.initialize = function() {
    RecommendFollowersItemView.__super__.initialize.apply(this, arguments);
    this.model.set('_dataPrefix', 'recommendFollowers');
    return this.model.set('_openNewTab', true);
  };

  return RecommendFollowersItemView;

})(StumblerItemView);


},{"./stumbler-item-view":720}],693:[function(require,module,exports){
var CollectionView, LoadingListView, RecommendFollowersItemView, RecommendFollowersView, mediator, template, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('./base/collection-view');

mediator = require('chaplin').mediator;

LoadingListView = require('./loading-list-view');

RecommendFollowersItemView = require('./recommend-followers-item-view');

template = require('../templates/stumblers');

_ = require('lodash');

module.exports = RecommendFollowersView = (function(_super) {
  __extends(RecommendFollowersView, _super);

  function RecommendFollowersView() {
    return RecommendFollowersView.__super__.constructor.apply(this, arguments);
  }

  RecommendFollowersView.prototype.autoRender = true;

  RecommendFollowersView.prototype.itemView = RecommendFollowersItemView;

  RecommendFollowersView.prototype.className = 'stumblers-view';

  RecommendFollowersView.prototype.template = template;

  RecommendFollowersView.prototype.pageSize = 25;

  RecommendFollowersView.prototype.initialize = function(options) {
    RecommendFollowersView.__super__.initialize.apply(this, arguments);
    return this.pageSize = mediator.profileItemsPerPage;
  };

  RecommendFollowersView.prototype.renderAllItems = function() {
    RecommendFollowersView.__super__.renderAllItems.apply(this, arguments);
    if (!this.subview('loading-indicator')) {
      return this.subview('loading-indicator', new LoadingListView({
        collection: this.collection,
        container: this.$el.find('.loading-container')
      }));
    }
  };

  RecommendFollowersView.prototype.getScrollElement = function() {
    return this.$el.parent();
  };

  RecommendFollowersView.prototype.getRequestMixin = function() {
    return {
      userid: mediator.userM.get('userid')
    };
  };

  return RecommendFollowersView;

})(CollectionView);


},{"../templates/stumblers":"kb3pIP","./base/collection-view":606,"./loading-list-view":660,"./recommend-followers-item-view":692,"chaplin":773,"lodash":776}],694:[function(require,module,exports){
var $, PopupView, ReportStumblerView, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

PopupView = require('./widgets/popup-view');

template = require('../templates/report-stumbler');

panel = require('../lib/panel');

$ = require('jquery');

module.exports = ReportStumblerView = (function(_super) {
  __extends(ReportStumblerView, _super);

  function ReportStumblerView() {
    return ReportStumblerView.__super__.constructor.apply(this, arguments);
  }

  ReportStumblerView.prototype.template = template;

  ReportStumblerView.prototype.className = 'report-stumbler-view';

  ReportStumblerView.prototype.events = {
    'click .cancel': 'onClickCancel',
    'click .send-report': 'onClickSendReport',
    'change #rating': 'onChangeSelection',
    'change #flag': 'onChangeSelection'
  };

  ReportStumblerView.prototype.listen = {
    'report-stumbler:model:success mediator': 'onSuccess',
    'report-stumbler:model:error mediator': 'onError'
  };

  ReportStumblerView.prototype.onClickSendReport = function() {
    if ($('#rating').val() != null) {
      this.model.set({
        'rating': $('#rating').val()
      });
    }
    if ($('#flag').val() != null) {
      this.model.set({
        'flag': $('#flag').val()
      });
    }
    return this.model.save();
  };

  ReportStumblerView.prototype.onChangeSelection = function() {
    if ($('.send-report').hasClass('disabled')) {
      return $('.send-report').removeClass('disabled');
    }
  };

  ReportStumblerView.prototype.onSuccess = function() {
    this.closePopup();
    return panel.displaySuccessMsg("Thanks for your feedback! Feedback from members like you helps keep StumbleUpon great!");
  };

  ReportStumblerView.prototype.onError = function() {
    this.closePopup();
    return panel.displayErrorMsg("Couldn't flag Stumbler at this time, please try again later");
  };

  return ReportStumblerView;

})(PopupView);


},{"../lib/panel":125,"../templates/report-stumbler":"Luh4xE","./widgets/popup-view":745,"jquery":774}],695:[function(require,module,exports){
var $, ResetPasswordBaseView, View, analytics, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/reset-password/base');

View = require('../base/view');

$ = require('jquery');

panel = require('../../lib/panel');

analytics = require('../../lib/analytics');

module.exports = ResetPasswordBaseView = (function(_super) {
  __extends(ResetPasswordBaseView, _super);

  function ResetPasswordBaseView() {
    return ResetPasswordBaseView.__super__.constructor.apply(this, arguments);
  }

  ResetPasswordBaseView.prototype.autoRender = true;

  ResetPasswordBaseView.prototype.template = template;

  ResetPasswordBaseView.prototype.className = 'reset-password';

  ResetPasswordBaseView.prototype.region = 'content';

  ResetPasswordBaseView.prototype.regions = {
    'sub-content': '#sub-content-container'
  };

  ResetPasswordBaseView.prototype.initialize = function() {
    ResetPasswordBaseView.__super__.initialize.apply(this, arguments);
    panel.close();
    $("#content-container").css({
      overflow: 'scroll'
    });
    return analytics.trackEvent('reset-password:view', 1, {
      action: 'view',
      label: 'reset-password'
    });
  };

  return ResetPasswordBaseView;

})(View);


},{"../../lib/analytics":116,"../../lib/panel":125,"../../templates/reset-password/base":"34Eu8w","../base/view":608,"jquery":774}],696:[function(require,module,exports){
var $, ResetPasswordConfirmView, SuccessConfirmView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../templates/reset-password/confirm');

SuccessConfirmView = require('./success-confirm-view');

$ = require('jquery');

module.exports = ResetPasswordConfirmView = (function(_super) {
  __extends(ResetPasswordConfirmView, _super);

  function ResetPasswordConfirmView() {
    return ResetPasswordConfirmView.__super__.constructor.apply(this, arguments);
  }

  ResetPasswordConfirmView.prototype.autoRender = true;

  ResetPasswordConfirmView.prototype.className = 'reset-password reset-password-confirm col-xs-9';

  ResetPasswordConfirmView.prototype.template = template;

  ResetPasswordConfirmView.prototype.region = 'sub-content';

  ResetPasswordConfirmView.prototype.events = {
    'click .update-request': 'onClickUpdate'
  };

  ResetPasswordConfirmView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM',
    'reset-password:confirm:model:success mediator': 'onSuccess',
    'reset-password:confirm:model:error mediator': 'onError',
    'reset-password:confirm:model:sync:start mediator': 'onResetConfirmStart'
  };

  ResetPasswordConfirmView.prototype.onAddedToDOM = function() {
    return document.getElementById('nav-tab-text').innerHTML = "Create Your New Password";
  };

  ResetPasswordConfirmView.prototype.onClickUpdate = function() {
    var confirmId, _ref;
    if (this.model.get('_isConfirmIdEmpty')) {
      confirmId = (_ref = $('#confirm-id')) != null ? _ref.val() : void 0;
    } else {
      confirmId = this.model.get('confirmId');
    }
    this.model.set({
      confirmId: confirmId,
      newPassword: $('#new-password').val(),
      confirmPassword: $('#confirm-password').val()
    });
    return this.model.save();
  };

  ResetPasswordConfirmView.prototype.onResetConfirmStart = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.save-spin').removeClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.update-request').addClass('disabled') : void 0;
  };

  ResetPasswordConfirmView.prototype.onSuccess = function() {
    this.enableButton();
    return this.subview('success-confirm-container', new SuccessConfirmView);
  };

  ResetPasswordConfirmView.prototype.onError = function(error) {
    this.resetError();
    $('.invalid-update').text(error.message);
    switch (error.attribute) {
      case "confirm-id":
        $('.confirm-id-group').addClass('has-error');
        this.displayFeedbackError('#confirm-id-feedback');
        break;
      case "new-password":
        $('.new-password-group').addClass('has-error');
        this.displayFeedbackError('#new-password-feedback');
        break;
      case "confirm-password":
        $('.confirm-password-group').addClass('has-error');
        this.displayFeedbackError('#confirm-password-feedback');
        break;
      case "no-match":
        $('.new-password-group').addClass('has-error');
        $('.confirm-password-group').addClass('has-error');
        this.displayFeedbackError('#new-password-feedback');
        this.displayFeedbackError('#confirm-password-feedback');
        break;
      case "general":
        $('.confirm-id-group').addClass('has-error');
        $('.new-password-group').addClass('has-error');
        $('.confirm-password-group').addClass('has-error');
        this.displayFeedbackError('#confirm-id-feedback');
        this.displayFeedbackError('#new-password-feedback');
        this.displayFeedbackError('#confirm-password-feedback');
    }
    return this.enableButton();
  };

  ResetPasswordConfirmView.prototype.resetError = function() {
    $('.confirm-id-group').removeClass('has-error');
    this.resetFeedbackError('#confirm-id-feedback');
    $('.new-password-group').removeClass('has-error');
    this.resetFeedbackError('#new-password-feedback');
    $('.confirm-password-group').removeClass('has-error');
    return this.resetFeedbackError('#confirm-password-feedback');
  };

  ResetPasswordConfirmView.prototype.displayFeedbackError = function(attrId) {
    $(attrId).addClass('fa');
    $(attrId).addClass('fa-exclamation-triangle');
    return $(attrId).css('visibility', 'visible');
  };

  ResetPasswordConfirmView.prototype.resetFeedbackError = function(attrId) {
    $(attrId).removeClass('fa');
    $(attrId).removeClass('fa-exclamation-triangle');
    return $(attrId).css('visibility', 'hidden');
  };

  ResetPasswordConfirmView.prototype.enableButton = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.save-spin').addClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.update-request').removeClass('disabled') : void 0;
  };

  return ResetPasswordConfirmView;

})(View);


},{"../base/view":608,"../templates/reset-password/confirm":"4p1x6f","./success-confirm-view":698,"jquery":774}],697:[function(require,module,exports){
var ResetPasswordRequestView, SuccessRequestView, View, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../templates/reset-password/request');

SuccessRequestView = require('./success-request-view');

panel = require('../../lib/panel');

module.exports = ResetPasswordRequestView = (function(_super) {
  __extends(ResetPasswordRequestView, _super);

  function ResetPasswordRequestView() {
    return ResetPasswordRequestView.__super__.constructor.apply(this, arguments);
  }

  ResetPasswordRequestView.prototype.autoRender = true;

  ResetPasswordRequestView.prototype.className = 'reset-password reset-password-request col-xs-9';

  ResetPasswordRequestView.prototype.template = template;

  ResetPasswordRequestView.prototype.region = 'sub-content';

  ResetPasswordRequestView.prototype.events = {
    'submit .request-form': 'onClickSendRequest'
  };

  ResetPasswordRequestView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM',
    'reset-password:request:model:sync:start mediator': 'onResetPasswordSend',
    'reset-password:request:success mediator': 'onSuccess',
    'reset-password:request:error mediator': 'onError'
  };

  ResetPasswordRequestView.prototype.onAddedToDOM = function() {
    return document.getElementById('nav-tab-text').innerHTML = "Reset Your Password";
  };

  ResetPasswordRequestView.prototype.onClickSendRequest = function() {
    this.model.set({
      email: this.$el.find('.email').val().trim()
    });
    return this.model.save();
  };

  ResetPasswordRequestView.prototype.onSuccess = function() {
    this.enableButton();
    return this.subview('success-request-container', new SuccessRequestView);
  };

  ResetPasswordRequestView.prototype.onError = function(errorMessage) {
    panel.displayErrorMsg(errorMessage);
    return this.enableButton();
  };

  ResetPasswordRequestView.prototype.onResetPasswordSend = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.save-spin').removeClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.send-request').addClass('disabled') : void 0;
  };

  ResetPasswordRequestView.prototype.enableButton = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.save-spin').addClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.send-request').removeClass('disabled') : void 0;
  };

  return ResetPasswordRequestView;

})(View);


},{"../../lib/panel":125,"../base/view":608,"../templates/reset-password/request":"uvkCgU","./success-request-view":699}],698:[function(require,module,exports){
var PopupView, SuccessRequestView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

PopupView = require('../widgets/popup-view');

template = require('../../templates/reset-password/success-confirm');

module.exports = SuccessRequestView = (function(_super) {
  __extends(SuccessRequestView, _super);

  function SuccessRequestView() {
    return SuccessRequestView.__super__.constructor.apply(this, arguments);
  }

  SuccessRequestView.prototype.template = template;

  SuccessRequestView.prototype.className = 'success-confirm su-popup';

  SuccessRequestView.prototype.container = '#success-container';

  return SuccessRequestView;

})(PopupView);


},{"../../templates/reset-password/success-confirm":"n/Xovh","../widgets/popup-view":745}],699:[function(require,module,exports){
var PopupView, SuccessRequestView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

PopupView = require('../widgets/popup-view');

template = require('../../templates/reset-password/success-request');

module.exports = SuccessRequestView = (function(_super) {
  __extends(SuccessRequestView, _super);

  function SuccessRequestView() {
    return SuccessRequestView.__super__.constructor.apply(this, arguments);
  }

  SuccessRequestView.prototype.template = template;

  SuccessRequestView.prototype.className = 'success-view su-popup';

  SuccessRequestView.prototype.container = '#success-container';

  return SuccessRequestView;

})(PopupView);


},{"../../templates/reset-password/success-request":"Jz0bH1","../widgets/popup-view":745}],700:[function(require,module,exports){
var $, AccountDeleteView, PopupView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

PopupView = require('../widgets/popup-view');

template = require('../../templates/settings/account-delete');

$ = require('jquery');

module.exports = AccountDeleteView = (function(_super) {
  __extends(AccountDeleteView, _super);

  function AccountDeleteView() {
    return AccountDeleteView.__super__.constructor.apply(this, arguments);
  }

  AccountDeleteView.prototype.template = template;

  AccountDeleteView.prototype.autoRender = true;

  AccountDeleteView.prototype.className = 'account-delete-view su-popup';

  AccountDeleteView.prototype.events = {
    'click .delete': 'onDeleteClick',
    'click .cancel': 'onClickCancel'
  };

  AccountDeleteView.prototype.listen = {
    'accountDeletion:model:sync:start mediator': 'onDeleteStart',
    'accountDeletion:model:success mediator': 'onSuccess',
    'accountDeletion:model:error mediator': 'onError'
  };

  AccountDeleteView.prototype.onDeleteClick = function() {
    this.model.set({
      password: $('#password').val()
    });
    return this.model.save();
  };

  AccountDeleteView.prototype.onDeleteStart = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.save-spin').removeClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.delete').addClass('disabled') : void 0;
  };

  AccountDeleteView.prototype.onSuccess = function() {
    this.publishEvent('accountDeletion:view:success');
    return this.closePopup();
  };

  AccountDeleteView.prototype.onError = function(error) {
    var _ref, _ref1;
    $('.invalid-update').text(error.message);
    switch (error.attribute) {
      case "password":
        $(".password-group").addClass('has-error');
        this.displayFeedbackError('#password-feedback');
        break;
      case "general":
        $(".password-group").addClass('has-error');
        this.displayFeedbackError('#password-feedback');
    }
    if ((_ref = this.$el) != null) {
      _ref.find('.save-spin').addClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.delete').removeClass('disabled') : void 0;
  };

  AccountDeleteView.prototype.displayFeedbackError = function(attrId) {
    $(attrId).addClass('fa');
    $(attrId).addClass('fa-exclamation-triangle');
    $(attrId).removeClass('fa-check');
    return $(attrId).css('visibility', 'visible');
  };

  return AccountDeleteView;

})(PopupView);


},{"../../templates/settings/account-delete":"xs5UGO","../widgets/popup-view":745,"jquery":774}],701:[function(require,module,exports){
var $, AccountDeleteModel, AccountDeleteView, ChangePasswordModel, ChangePasswordView, Chaplin, SettingsAccountView, View, config, mediator, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./settings-tab-view');

template = require('../../templates/settings/account');

$ = require('jquery');

mediator = require('chaplin').mediator;

panel = require('../../lib/panel');

config = require('../../config');

ChangePasswordModel = require('../../models/settings/change-password-model');

ChangePasswordView = require('./change-password-view');

AccountDeleteModel = require('../../models/settings/account-delete-model');

AccountDeleteView = require('./account-delete-view');

Chaplin = require('chaplin');

module.exports = SettingsAccountView = (function(_super) {
  __extends(SettingsAccountView, _super);

  function SettingsAccountView() {
    return SettingsAccountView.__super__.constructor.apply(this, arguments);
  }

  SettingsAccountView.prototype.className = 'settings-account';

  SettingsAccountView.prototype.template = template;

  SettingsAccountView.prototype.listen = {
    'change model': 'render',
    'changePassword:view:success mediator': 'onChangePasswordSuccess',
    'accountDeletion:view:success mediator': 'onAccountDeletionSuccess',
    'settings:account:sync:start mediator': 'onSaveStart'
  };

  SettingsAccountView.prototype.events = {
    'click .save': 'onClickSave',
    'click .change-password': 'onClickChangePassword',
    'click .delete-account': 'onClickDelete',
    'click .cancel-delete-account': 'onClickCancelDelete'
  };

  SettingsAccountView.prototype.initialize = function() {
    SettingsAccountView.__super__.initialize.apply(this, arguments);
    return this.render();
  };

  SettingsAccountView.prototype.render = function() {
    SettingsAccountView.__super__.render.apply(this, arguments);
    return this.updateForms();
  };

  SettingsAccountView.prototype.onClickSave = function() {
    this.model.set({
      bday: this.$el.find('.day').val(),
      bmonth: this.$el.find('.month').val(),
      byear: this.$el.find('.year').val(),
      gender: this.$el.find('.gender').val(),
      likesInterests: this.$el.find('.likes-interests').val()
    });
    return this.model.save().then((function(_this) {
      return function(response) {
        if (response._success === true) {
          return _this.onSaveSuccess();
        } else {
          return _this.onSaveFailure(response._reason);
        }
      };
    })(this), (function(_this) {
      return function(response) {
        return _this.onSaveFailure(response._reason);
      };
    })(this));
  };

  SettingsAccountView.prototype.updateForms = function() {
    this.prefillMonth();
    this.prefillDay();
    this.prefillYear();
    if ((this.model.get('bmonth') != null) && (this.model.get('bday') != null) && (this.model.get('byear') != null)) {
      this.$el.find('.month').val(this.model.get('bmonth')).change();
      this.$el.find('.day').val(this.model.get('bday')).change();
      this.$el.find('.year').val(this.model.get('byear')).change();
    }
    if (this.model.get('likesInterests') != null) {
      return this.$el.find('.likes-interests').val(this.model.get('likesInterests')).change();
    }
  };

  SettingsAccountView.prototype.onClickChangePassword = function() {
    var changePasswordM;
    changePasswordM = new ChangePasswordModel;
    return this.subview('change-password-view', new ChangePasswordView({
      container: this.$el.find('.change-password-container'),
      model: changePasswordM
    }));
  };

  SettingsAccountView.prototype.onChangePasswordSuccess = function() {
    return panel.displaySuccessMsg("Your Password has saved successfully!");
  };

  SettingsAccountView.prototype.onClickDelete = function() {
    var accountDeleteM, _ref;
    accountDeleteM = new AccountDeleteModel({
      username: (_ref = Chaplin.mediator.userM) != null ? _ref.get('username') : void 0
    });
    return this.subview('account-delete-view', new AccountDeleteView({
      container: this.$el.find('.account-delete-container'),
      model: accountDeleteM
    }));
  };

  SettingsAccountView.prototype.onAccountDeletionSuccess = function() {
    this.model.set({
      markedForDeletion: true
    });
    return panel.displaySuccessMsg("Your account is scheduled for deletion! You've also been opted out of emails from StumbleUpon.");
  };

  SettingsAccountView.prototype.onClickCancelDelete = function() {
    var accountDeleteM;
    accountDeleteM = new AccountDeleteModel;
    return accountDeleteM.unmarkDeletion().then((function(_this) {
      return function(response) {
        if (response._success === true) {
          return _this.onCancelDeleteSuccess();
        } else {
          return _this.onCancelDeleteFailure();
        }
      };
    })(this), (function(_this) {
      return function(response) {
        return _this.onCancelDeleteFailure();
      };
    })(this));
  };

  SettingsAccountView.prototype.onCancelDeleteSuccess = function() {
    this.model.set({
      markedForDeletion: false
    });
    return panel.displaySuccessMsg("Your account is no longer scheduled for deletion! Keep on Stumbling!");
  };

  SettingsAccountView.prototype.onCancelDeleteFailure = function() {
    return panel.displayErrorMsg("Could not cancel deletion! Please try again later!");
  };

  SettingsAccountView.prototype.prefillMonth = function() {
    var i, monthSelect, months, option, _results;
    months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    monthSelect = this.$el.find('.month')[0];
    i = 0;
    _results = [];
    while (i < months.length) {
      option = document.createElement('option');
      option.innerHTML = months[i];
      option.value = i + 1;
      monthSelect.appendChild(option);
      _results.push(i++);
    }
    return _results;
  };

  SettingsAccountView.prototype.prefillDay = function() {
    var currentDay, daySelect, maxDays, option, _results;
    daySelect = this.$el.find('.day')[0];
    maxDays = 31;
    currentDay = 1;
    _results = [];
    while (currentDay <= maxDays) {
      option = document.createElement('option');
      option.innerHTML = currentDay;
      option.value = currentDay;
      daySelect.appendChild(option);
      _results.push(currentDay++);
    }
    return _results;
  };

  SettingsAccountView.prototype.prefillYear = function() {
    var currentYear, minYear, option, year, yearSelect, _results;
    yearSelect = this.$el.find('.year')[0];
    currentYear = (new Date()).getYear() - 100;
    minYear = currentYear - 100;
    _results = [];
    while (currentYear >= minYear) {
      year = 2000 + currentYear;
      option = document.createElement('option');
      option.innerHTML = year;
      option.value = year;
      yearSelect.appendChild(option);
      _results.push(--currentYear);
    }
    return _results;
  };

  return SettingsAccountView;

})(View);


},{"../../config":2,"../../lib/panel":125,"../../models/settings/account-delete-model":229,"../../models/settings/change-password-model":231,"../../templates/settings/account":"4dgVDP","./account-delete-view":700,"./change-password-view":703,"./settings-tab-view":714,"chaplin":773,"jquery":774}],702:[function(require,module,exports){
var $, SettingsBaseView, View, analytics, chaplin, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/settings/base');

View = require('../base/view');

chaplin = require('chaplin');

$ = require('jquery');

panel = require('../../lib/panel');

analytics = require('../../lib/analytics');

module.exports = SettingsBaseView = (function(_super) {
  __extends(SettingsBaseView, _super);

  function SettingsBaseView() {
    return SettingsBaseView.__super__.constructor.apply(this, arguments);
  }

  SettingsBaseView.prototype.autoRender = true;

  SettingsBaseView.prototype.template = template;

  SettingsBaseView.prototype.className = 'settings';

  SettingsBaseView.prototype.region = 'content';

  SettingsBaseView.prototype.regions = {
    'sub-content': '#sub-content-container'
  };

  SettingsBaseView.prototype.initialize = function() {
    SettingsBaseView.__super__.initialize.apply(this, arguments);
    panel.close();
    $("#content-container").css({
      overflow: 'scroll'
    });
    return analytics.trackEvent('settings:view', 1, {
      action: 'view',
      label: 'settings'
    });
  };

  SettingsBaseView.prototype.setActiveTab = function(tabName) {
    this.$el.find(".header-container .active").removeClass("active");
    this.$el.find(".header-container ." + tabName).addClass("active");
    if (tabName === "profile" || tabName === "personalization") {
      this.$el.css("min-height", "820px");
    }
    if (tabName === "account" || tabName === "connections") {
      this.$el.css("min-height", "700px");
    }
    if (tabName === "notifications") {
      return this.$el.css("min-height", "500px");
    }
  };

  return SettingsBaseView;

})(View);


},{"../../lib/analytics":116,"../../lib/panel":125,"../../templates/settings/base":"yeeyow","../base/view":608,"chaplin":773,"jquery":774}],703:[function(require,module,exports){
var $, ChangePasswordView, PopupView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

PopupView = require('../widgets/popup-view');

template = require('../../templates/settings/change-password');

$ = require('jquery');

module.exports = ChangePasswordView = (function(_super) {
  __extends(ChangePasswordView, _super);

  function ChangePasswordView() {
    return ChangePasswordView.__super__.constructor.apply(this, arguments);
  }

  ChangePasswordView.prototype.template = template;

  ChangePasswordView.prototype.className = 'change-password-view su-popup';

  ChangePasswordView.prototype.events = {
    'click .save-password': 'onClickSave',
    'click .cancel': 'onClickCancel'
  };

  ChangePasswordView.prototype.listen = {
    'changePassword:model:sync:start mediator': 'onChangePasswordStart',
    'changePassword:model:error mediator': 'onError',
    'changePassword:model:success mediator': 'onSuccess'
  };

  ChangePasswordView.prototype.onClickSave = function() {
    this.model.set({
      currentPassword: $('#current-password').val(),
      newPassword: $('#new-password').val(),
      confirmPassword: $('#confirm-password').val()
    });
    return this.model.save();
  };

  ChangePasswordView.prototype.onChangePasswordStart = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.save-spin').removeClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.save-password').addClass('disabled') : void 0;
  };

  ChangePasswordView.prototype.onSuccess = function() {
    this.publishEvent('changePassword:view:success');
    return this.closePopup();
  };

  ChangePasswordView.prototype.onError = function(error) {
    var _ref, _ref1;
    this.resetError();
    $('.invalid-update').text(error.message);
    switch (error.attribute) {
      case "current-password":
        $('.current-password-group').addClass('has-error');
        this.displayFeedbackError('#current-password-feedback');
        break;
      case "new-password":
        $('.new-password-group').addClass('has-error');
        this.displayFeedbackError('#new-password-feedback');
        break;
      case "confirm-password":
        $('.confirm-password-group').addClass('has-error');
        this.displayFeedbackError('#confirm-password-feedback');
        break;
      case "no-match":
        $('.new-password-group').addClass('has-error');
        $('.confirm-password-group').addClass('has-error');
        this.displayFeedbackError('#new-password-feedback');
        this.displayFeedbackError('#confirm-password-feedback');
        break;
      case "general":
        $('.current-password-group').addClass('has-error');
        $('.new-password-group').addClass('has-error');
        $('.confirm-password-group').addClass('has-error');
        this.displayFeedbackError('#current-password-feedback');
        this.displayFeedbackError('#new-password-feedback');
        this.displayFeedbackError('#confirm-password-feedback');
    }
    if ((_ref = this.$el) != null) {
      _ref.find('.save-spin').addClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.save-password').removeClass('disabled') : void 0;
  };

  ChangePasswordView.prototype.resetError = function() {
    $('.current-password-group').removeClass('has-error');
    $('.new-password-group').removeClass('has-error');
    return $('.confirm-password-group').removeClass('has-error');
  };

  ChangePasswordView.prototype.displayFeedbackError = function(attrId) {
    $(attrId).addClass('fa');
    $(attrId).addClass('fa-exclamation-triangle');
    $(attrId).removeClass('fa-check');
    return $(attrId).css('visibility', 'visible');
  };

  return ChangePasswordView;

})(PopupView);


},{"../../templates/settings/change-password":"kKoRAt","../widgets/popup-view":745,"jquery":774}],704:[function(require,module,exports){
var FacebookConnectModel, SettingsConnectionsView, TwitterConnectModel, View, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/settings/connections');

panel = require('../../lib/panel');

FacebookConnectModel = require('../../models/facebook-connect-model');

TwitterConnectModel = require('../../models/twitter-connect-model');

module.exports = SettingsConnectionsView = (function(_super) {
  __extends(SettingsConnectionsView, _super);

  function SettingsConnectionsView() {
    return SettingsConnectionsView.__super__.constructor.apply(this, arguments);
  }

  SettingsConnectionsView.prototype.autoRender = true;

  SettingsConnectionsView.prototype.className = 'settings-connections';

  SettingsConnectionsView.prototype.template = template;

  SettingsConnectionsView.prototype.region = 'sub-content';

  SettingsConnectionsView.prototype.events = {
    'click .facebook-connect-button': 'onFacebookConnect',
    'click .facebook-disconnect': 'onFacebookDisconnect',
    'click .twitter-connect-button': 'onTwitterConnect',
    'click .twitter-disconnect': 'onTwitterDisconnect',
    'click .google-disconnect': 'onGoogleDisconnect'
  };

  SettingsConnectionsView.prototype.listen = {
    'fb:model:unlink:success mediator': 'onFacebookDisconnectSuccess',
    'fb:model:link:success mediator': 'onFacebookConnectSuccess',
    'fb:model:signup:error mediator': 'onFacebookFailure',
    'google:model:error mediator': 'onConnectFailure',
    'google:model:success mediator': 'onGoogleConnectSuccess',
    'twitter:model:error mediator': 'onConnectFailure',
    'twitter:model:link:success mediator': 'onTwitterConnectSuccess',
    'change model': 'render'
  };

  SettingsConnectionsView.prototype.render = function() {
    SettingsConnectionsView.__super__.render.apply(this, arguments);
    if (this.googleConnectM) {
      return this.googleConnectM.bindConnectButton();
    }
  };

  SettingsConnectionsView.prototype.onFacebookDisconnect = function() {
    var fbModel;
    fbModel = new FacebookConnectModel;
    return fbModel.fbUnlink();
  };

  SettingsConnectionsView.prototype.onFacebookDisconnectSuccess = function() {
    this.model.set({
      facebook_account: {
        connected: false
      }
    });
    return panel.displaySuccessMsg("Successfully Disconnected from Facebook.");
  };

  SettingsConnectionsView.prototype.onFacebookConnect = function() {
    var fbModel;
    fbModel = new FacebookConnectModel({
      link: true
    });
    return fbModel.save();
  };

  SettingsConnectionsView.prototype.onFacebookConnectSuccess = function() {
    this.model.set({
      facebook_account: {
        connected: true
      }
    });
    return panel.displaySuccessMsg("Your StumbleUpon account is connected to Facebook!");
  };

  SettingsConnectionsView.prototype.onFacebookFailure = function(message) {
    return panel.displayErrorMsg(message);
  };

  SettingsConnectionsView.prototype.onTwitterConnect = function() {
    var twitterModel;
    twitterModel = new TwitterConnectModel;
    return twitterModel.fetch().then((function(_this) {
      return function(response) {
        if (response._success === false) {
          return _this.onConnectFailure(response._reason);
        }
      };
    })(this), (function(_this) {
      return function(response) {
        return _this.onConnectFailure(response._reason);
      };
    })(this));
  };

  SettingsConnectionsView.prototype.onTwitterConnectSuccess = function() {
    this.model.set({
      twitter_account: {
        connected: true
      }
    });
    return panel.displaySuccessMsg("Your StumbleUpon account is connected to Twitter!");
  };

  SettingsConnectionsView.prototype.onTwitterDisconnect = function() {
    var twitterModel;
    twitterModel = new TwitterConnectModel;
    return twitterModel.twitterUnlink().then((function(_this) {
      return function(response) {
        if (response._success === true) {
          return _this.onTwitterDisconnectSuccess();
        } else {
          return _this.onDisconnectFailure(response._reason);
        }
      };
    })(this), (function(_this) {
      return function(response) {
        return _this.onDisconnectFailure(response._reason);
      };
    })(this));
  };

  SettingsConnectionsView.prototype.onTwitterDisconnectSuccess = function() {
    this.model.set({
      twitter_account: {
        connected: false
      }
    });
    return panel.displaySuccessMsg("Your StumbleUpon account has been disconnected from Twitter.");
  };

  SettingsConnectionsView.prototype.onGoogleConnectSuccess = function() {
    this.model.set({
      google_account: {
        connected: true
      }
    });
    return panel.displaySuccessMsg("Your StumbleUpon account is connected to Google!");
  };

  SettingsConnectionsView.prototype.onGoogleDisconnect = function() {
    return this.googleConnectM.googleUnlink().then((function(_this) {
      return function(response) {
        if (response._success === true) {
          return _this.onGoogleDisconnectSuccess();
        } else {
          return _this.onDisconnectFailure(response._reason);
        }
      };
    })(this), (function(_this) {
      return function(response) {
        return _this.onDisconnectFailure(response._reason);
      };
    })(this));
  };

  SettingsConnectionsView.prototype.onGoogleDisconnectSuccess = function() {
    this.model.set({
      google_account: {
        connected: false
      }
    });
    return panel.displaySuccessMsg("Your StumbleUpon account has been disconnected from Google.");
  };

  SettingsConnectionsView.prototype.onDisconnectFailure = function(reason) {
    return panel.displayErrorMsg("Sorry, couldn't disconnect, try again later.");
  };

  SettingsConnectionsView.prototype.onConnectFailure = function(reason) {
    return panel.displayErrorMsg("Sorry, couldn't connect, try again later.");
  };

  return SettingsConnectionsView;

})(View);


},{"../../lib/panel":125,"../../models/facebook-connect-model":178,"../../models/twitter-connect-model":249,"../../templates/settings/connections":"7N+aXr","../base/view":608}],705:[function(require,module,exports){
var $, CropPictureView, PopupView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

PopupView = require('../widgets/popup-view');

template = require('../../templates/settings/crop-picture');

$ = require('jquery');

module.exports = CropPictureView = (function(_super) {
  var crop_max_height, crop_max_width, jcrop_api;

  __extends(CropPictureView, _super);

  function CropPictureView() {
    return CropPictureView.__super__.constructor.apply(this, arguments);
  }

  CropPictureView.prototype.template = template;

  CropPictureView.prototype.className = 'crop-picture-view su-popup';

  CropPictureView.prototype.events = {
    'click .save-picture': 'onClickSave',
    'click .cancel': 'onClickCancel'
  };

  crop_max_width = 300;

  crop_max_height = 300;

  jcrop_api = void 0;

  CropPictureView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    CropPictureView.__super__.initialize.apply(this, arguments);
    return this.getPicture(options.inputElement);
  };

  CropPictureView.prototype.getPicture = function(inputElement) {
    var oFReader, rFilter;
    if (window.FileReader) {
      oFReader = new window.FileReader;
      rFilter = /^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i;
      oFReader.onload = (function(_this) {
        return function(oFREvent) {
          return _this.onDataLoad(oFREvent.target.result);
        };
      })(this);
      if (inputElement.files.length === 0 || !rFilter.test(inputElement.files[0].type)) {
        this.failureCrop();
      } else {
        oFReader.readAsDataURL(inputElement.files[0]);
      }
    }
    if (navigator.appName === 'Microsoft Internet Explorer') {
      return this.onDataLoad(inputElement.value);
    }
  };

  CropPictureView.prototype.onDataLoad = function(dataUrl) {
    var img, jCropElement;
    img = document.createElement('img');
    img.src = dataUrl;
    img.id = 'jcropImg';
    jCropElement = document.getElementById('jcrop');
    jCropElement.appendChild(img);
    return $("#jcrop img").Jcrop({
      boxWidth: crop_max_width,
      boxHeight: crop_max_height
    }, function() {
      return jcrop_api = this;
    });
  };

  CropPictureView.prototype.onClickSave = function() {
    var canvas, coords, ctx, dataUrl, heightRatio, imgElement, newH, newW, newX, newY, widthRatio;
    imgElement = document.getElementById('jcropImg');
    try {
      coords = jcrop_api.getSelection();
      canvas = document.getElementById('canvas');
      canvas.style.display = 'none';
      ctx = canvas.getContext('2d');
      heightRatio = imgElement.height / jcrop_api.container.height();
      newH = coords.h * heightRatio;
      newY = coords.y * heightRatio;
      widthRatio = imgElement.width / jcrop_api.container.width();
      newW = coords.w * widthRatio;
      newX = coords.x * widthRatio;
      canvas.width = newW;
      canvas.height = newH;
      ctx.drawImage(imgElement, newX, newY, newW, newH, 0, 0, newW, newH);
      dataUrl = canvas.toDataURL();
    } catch (_error) {
      dataUrl = imgElement.src;
    }
    this.publishEvent('crop-picture:success', dataUrl);
    return this.closePopup();
  };

  CropPictureView.prototype.failureCrop = function() {
    this.publishEvent('crop-picture:failure');
    return this.closePopup();
  };

  return CropPictureView;

})(PopupView);


},{"../../templates/settings/crop-picture":"m/nrZl","../widgets/popup-view":745,"jquery":774}],706:[function(require,module,exports){
var ActionButtonM, ActionButtonsC, ActionButtonsV, HeadingCreateView, View, eventPrefix, i18n, mediator, template, trackingLabel,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/settings/heading-create-interests');

View = require('../base/view');

ActionButtonsV = require('../widgets/action-buttons-view');

ActionButtonsC = require('../../models/action-buttons-collection');

ActionButtonM = require('../../models/action-button-model');

mediator = require('chaplin').mediator;

i18n = require('../../lib/i18n');

trackingLabel = 'create-interests';

eventPrefix = 'heading-create-interests-view';


/*
 * A view to render the heading for edit-interests
 */

module.exports = HeadingCreateView = (function(_super) {
  __extends(HeadingCreateView, _super);

  function HeadingCreateView() {
    return HeadingCreateView.__super__.constructor.apply(this, arguments);
  }

  HeadingCreateView.prototype.autoRender = true;

  HeadingCreateView.prototype.className = 'heading-create-interests-view-container';

  HeadingCreateView.prototype.containerMethod = 'html';

  HeadingCreateView.prototype.template = template;

  HeadingCreateView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  HeadingCreateView.prototype.initialize = function(options) {
    HeadingCreateView.__super__.initialize.apply(this, arguments);
    this.actionButtonsCollection = this._createActionButtonsCollection((options != null ? options.trackingLabel : void 0) || trackingLabel);
    this.listenTo(this.actionButtonsCollection, 'change:clicked', this.onActionButtonClicked);
    this.myInterestsC = (options != null ? options.myInterestsC : void 0) || new Chaplin.Collection();
    return this.listenTo(this.myInterestsC, 'sync', this.onCollectionSync);
  };

  HeadingCreateView.prototype.onCollectionSync = function(myInterestsC, resp, options) {
    var nInterests;
    nInterests = myInterestsC.length;
    mediator.userM.set('interests_count', nInterests);
    this.$el.toggleClass('interests-complete', nInterests > 9);
    return this.updateInterestsCountdown();
  };

  HeadingCreateView.prototype.updateInterestsCountdown = function() {
    var iPhrase, msg, nInterestsRemaining;
    nInterestsRemaining = Math.max(0, 10 - mediator.userM.get('interests_count'));
    iPhrase = '10 Interests';
    if (nInterestsRemaining === 10) {
      msg = i18n('CREATE_MY_INTERESTS');
    } else if (nInterestsRemaining === 1) {
      msg = i18n('CREATE_MY_INTERESTS').replace(iPhrase, nInterestsRemaining + ' More Interest');
    } else if (nInterestsRemaining === 0) {
      msg = '';
    } else {
      msg = i18n('CREATE_MY_INTERESTS').replace(iPhrase, nInterestsRemaining + ' More Interests');
    }
    return this.$("#interests-countdown").text(msg);
  };

  HeadingCreateView.prototype.onAddedToDOM = function(evnt) {
    this.subview('action-buttons-view', new ActionButtonsV({
      collection: this.actionButtonsCollection,
      container: this.$el.find('#action-buttons-view-container'),
      containerMethod: 'html',
      id: 'action-buttons',
      className: 'action-buttons-container'
    }));
    return this.updateInterestsCountdown();
  };

  HeadingCreateView.prototype.onActionButtonClicked = function(buttonModel, options) {
    switch (buttonModel.getAction()) {
      case 'stumble':
        return this.stumble();
    }
  };

  HeadingCreateView.prototype.stumble = function() {
    return this.publishEvent('stumble:next');
  };

  HeadingCreateView.prototype._createActionButtonsCollection = function(trackingLabel) {
    var actionButtonsC;
    return actionButtonsC = new ActionButtonsC([
      new ActionButtonM({
        id: eventPrefix + '-stumble',
        action: 'stumble',
        disabled: false,
        classNames: ['btn-suorange'],
        trackingCategory: eventPrefix + '-stumble',
        trackingLabel: trackingLabel,
        buttonText: i18n('START_STUMBLING')
      })
    ]);
  };

  return HeadingCreateView;

})(View);


},{"../../lib/i18n":121,"../../models/action-button-model":159,"../../models/action-buttons-collection":160,"../../templates/settings/heading-create-interests":"Evosrg","../base/view":608,"../widgets/action-buttons-view":739,"chaplin":773}],707:[function(require,module,exports){
var HeadingEditView, View, i18n, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/settings/heading-edit-interests');

View = require('../base/view');

i18n = require('../../lib/i18n');


/*
 * A view to render the heading for edit-interests
 */

module.exports = HeadingEditView = (function(_super) {
  __extends(HeadingEditView, _super);

  function HeadingEditView() {
    return HeadingEditView.__super__.constructor.apply(this, arguments);
  }

  HeadingEditView.prototype.autoRender = true;

  HeadingEditView.prototype.className = 'heading-edit-interests-view-container';

  HeadingEditView.prototype.containerMethod = 'html';

  HeadingEditView.prototype.template = template;

  HeadingEditView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  HeadingEditView.prototype.initialize = function(options) {
    HeadingEditView.__super__.initialize.apply(this, arguments);
    this.myInterestsC = (options != null ? options.myInterestsC : void 0) || new Chaplin.Collection();
    return this.listenTo(this.myInterestsC, 'sync', this.onCollectionSync);
  };

  HeadingEditView.prototype.onAddedToDOM = function() {
    return this.adjustHeading(this.myInterestsC);
  };

  HeadingEditView.prototype.onCollectionSync = function(myInterestsC, resp, options) {
    return this.adjustHeading(myInterestsC);
  };

  HeadingEditView.prototype.adjustHeading = function(myInterestsC) {
    var msg, nInterests;
    nInterests = myInterestsC.length;
    Chaplin.mediator.userM.set('interests_count', nInterests);
    msg = i18n('EDIT_MY_INTERESTS') + ' (' + nInterests + ')';
    return this.$el.find('#settings-heading-edit-interests').html(msg);
  };

  return HeadingEditView;

})(View);


},{"../../lib/i18n":121,"../../templates/settings/heading-edit-interests":"nsisvZ","../base/view":608}],708:[function(require,module,exports){
var ActionButtonM, ActionButtonsC, ActionButtonsV, HeadingSuggestView, View, eventPrefix, i18n, template, trackingLabel,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/settings/heading-suggest-interests');

View = require('../base/view');

ActionButtonsV = require('../widgets/action-buttons-view');

ActionButtonsC = require('../../models/action-buttons-collection');

ActionButtonM = require('../../models/action-button-model');

i18n = require('../../lib/i18n');

trackingLabel = 'suggest-interests';

eventPrefix = 'heading-suggest-interests-view';


/*
 * A view to render the heading for edit-interests
 */

module.exports = HeadingSuggestView = (function(_super) {
  __extends(HeadingSuggestView, _super);

  function HeadingSuggestView() {
    return HeadingSuggestView.__super__.constructor.apply(this, arguments);
  }

  HeadingSuggestView.prototype.autoRender = true;

  HeadingSuggestView.prototype.className = 'heading-suggest-interests-view-container';

  HeadingSuggestView.prototype.containerMethod = 'html';

  HeadingSuggestView.prototype.template = template;

  HeadingSuggestView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  HeadingSuggestView.prototype.initialize = function(options) {
    HeadingSuggestView.__super__.initialize.apply(this, arguments);
    this.actionButtonsCollection = this._createActionButtonsCollection((options != null ? options.trackingLabel : void 0) || trackingLabel);
    return this.listenTo(this.actionButtonsCollection, 'change:clicked', this.onActionButtonClicked);
  };

  HeadingSuggestView.prototype.onAddedToDOM = function(evnt) {
    return this.subview('action-buttons-view', new ActionButtonsV({
      collection: this.actionButtonsCollection,
      container: this.$el.find('#action-buttons-view-container'),
      containerMethod: 'html',
      id: 'action-buttons',
      className: 'action-buttons-container'
    }));
  };

  HeadingSuggestView.prototype.onActionButtonClicked = function(buttonModel, options) {
    switch (buttonModel.getAction()) {
      case 'done':
        return this.stumble();
    }
  };

  HeadingSuggestView.prototype.stumble = function() {
    return this.publishEvent('stumble:next');
  };

  HeadingSuggestView.prototype._createActionButtonsCollection = function(trackingLabel) {
    var actionButtonsC;
    return actionButtonsC = new ActionButtonsC([
      new ActionButtonM({
        id: eventPrefix + '-done',
        action: 'done',
        disabled: false,
        classNames: ['btn-suwhite'],
        trackingCategory: eventPrefix + '-done',
        trackingLabel: trackingLabel,
        buttonText: i18n('DONE')
      })
    ]);
  };

  return HeadingSuggestView;

})(View);


},{"../../lib/i18n":121,"../../models/action-button-model":159,"../../models/action-buttons-collection":160,"../../templates/settings/heading-suggest-interests":"RMVmwV","../base/view":608,"../widgets/action-buttons-view":739}],709:[function(require,module,exports){
var InterestView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/settings/interest');

View = require('../base/view');

module.exports = InterestView = (function(_super) {
  __extends(InterestView, _super);

  function InterestView() {
    return InterestView.__super__.constructor.apply(this, arguments);
  }

  InterestView.prototype.autoRender = true;

  InterestView.prototype.className = 'interest-view-container item';

  InterestView.prototype.containerMethod = 'html';

  InterestView.prototype.template = template;

  InterestView.prototype.trackingLabel = 'interest-view';

  InterestView.prototype.events = {
    'click': 'onClick'
  };

  InterestView.prototype.onClick = function() {
    return this.publishEvent('interest-view:clicked', {
      model: this.model
    });
  };

  return InterestView;

})(View);


},{"../../templates/settings/interest":"7FUspW","../base/view":608}],710:[function(require,module,exports){
var $, MyInterestsView, View, analytics, template, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

View = require('../base/view');

utils = require('../../lib/utils');

$ = require('jquery');

template = require('../../templates/settings/my-interests');

analytics = require('../../lib/analytics');

module.exports = MyInterestsView = (function(_super) {
  __extends(MyInterestsView, _super);

  function MyInterestsView() {
    return MyInterestsView.__super__.constructor.apply(this, arguments);
  }

  MyInterestsView.prototype.autoRender = true;

  MyInterestsView.prototype.className = 'my-interests-edit-view-container';

  MyInterestsView.prototype.region = 'content';

  MyInterestsView.prototype.template = template;

  MyInterestsView.prototype.trackingCategory = 'my-interests-edit-view';

  MyInterestsView.prototype.trackingLabel = 'my-interests-edit';

  MyInterestsView.prototype.eventPrefix = 'my-interests-edit';

  MyInterestsView.prototype.showToolbar = true;

  MyInterestsView.prototype.listen = {
    'window:resize mediator': 'resizeFrame',
    'panel:closed mediator': 'onPanelClose',
    'smartbanner:closed mediator': function() {
      return this.resizeFrame(false, true);
    },
    'progressbar:close mediator': function() {
      return this.resizeFrame(false);
    },
    'addedToDOM': 'onAddedToDOM',
    'request model': 'onModelRequest',
    'sync model': 'onModelSync'
  };

  MyInterestsView.prototype.announcedLoaded = false;

  MyInterestsView.prototype.announceEvents = 'my-interests-view';


  /*
   * options:
   *    showToolbar: <Boolean> -- whether or not to show the toolbar -- default true
   */

  MyInterestsView.prototype.initialize = function(options) {
    MyInterestsView.__super__.initialize.apply(this, arguments);
    this.trackingCategory = (options != null ? options.trackingCategory : void 0) || this.trackingCategory;
    this.trackingLabel = (options != null ? options.trackingLabel : void 0) || this.trackingLabel;
    this.showToolbar = (options != null ? options.showToolbar : void 0) || false;
    if (!this.showToolbar) {
      return $('#toolbar-container').hide();
    }
  };

  MyInterestsView.prototype.dispose = function() {
    $('#toolbar-container').show();
    $('#app-container').toggleClass('no-toolbar', false);
    return MyInterestsView.__super__.dispose.apply(this, arguments);
  };

  MyInterestsView.prototype.onAddedToDOM = function() {
    utils.onContentLoaded();
    $('#app-container').toggleClass('no-toolbar', !this.showToolbar);
    return this.resizeFrame(true);
  };

  MyInterestsView.prototype.onModelRequest = function(model, xhr, options) {
    return this.disable();
  };

  MyInterestsView.prototype.onModelSync = function(model, resp, options) {
    this.resizeFrame();
    return _.defer((function(_this) {
      return function() {
        return _this.enable();
      };
    })(this));
  };

  MyInterestsView.prototype.resizeFrame = function() {
    MyInterestsView.__super__.resizeFrame.apply(this, arguments);
    return _.defer((function(_this) {
      return function() {
        var $tabContentBackgroundEl, bodyHeight, newHeight, _ref;
        if (!_this.disposed) {
          bodyHeight = $(window).height();
          $tabContentBackgroundEl = _this.$el.find('.tab-content-view-background');
          newHeight = bodyHeight - ((_ref = $tabContentBackgroundEl.position()) != null ? _ref.top : void 0);
          if (newHeight) {
            return $tabContentBackgroundEl.css('height', newHeight + 'px');
          }
        }
      };
    })(this));
  };

  MyInterestsView.prototype.onPanelClose = function() {
    return this.resizeFrame();
  };

  MyInterestsView.prototype.disable = function() {
    return this.$el.toggleClass('disabled', true);
  };

  MyInterestsView.prototype.enable = function() {
    return this.$el.toggleClass('disabled', false);
  };

  return MyInterestsView;

})(View);


},{"../../lib/analytics":116,"../../lib/utils":156,"../../templates/settings/my-interests":"hwHhgx","../base/view":608,"jquery":774,"lodash":776}],711:[function(require,module,exports){
var $, SettingsNotificationsView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./settings-tab-view');

template = require('../../templates/settings/notifications');

$ = require('jquery');

module.exports = SettingsNotificationsView = (function(_super) {
  __extends(SettingsNotificationsView, _super);

  function SettingsNotificationsView() {
    return SettingsNotificationsView.__super__.constructor.apply(this, arguments);
  }

  SettingsNotificationsView.prototype.className = 'settings-notifications';

  SettingsNotificationsView.prototype.template = template;

  SettingsNotificationsView.prototype.listen = {
    'settings:notifications:sync:start mediator': 'onSaveStart'
  };

  SettingsNotificationsView.prototype.events = {
    'click .save': 'onClickSave'
  };

  SettingsNotificationsView.prototype.onClickSave = function() {
    this.model.set({
      weeklyRecEmailGroupV2: this.$el.find("[name=weekly-rec]").is(":checked"),
      socialEmailGroupV2: this.$el.find("[name=social]").is(":checked"),
      personalEmailGroupV2: this.$el.find("[name=personal]").is(":checked")
    });
    return this.model.save().then((function(_this) {
      return function(response) {
        if (response._success === true) {
          return _this.onSaveSuccess();
        } else {
          return _this.onSaveFailure(response._reason);
        }
      };
    })(this), (function(_this) {
      return function(response) {
        return _this.onSaveFailure(response._reason);
      };
    })(this));
  };

  return SettingsNotificationsView;

})(View);


},{"../../templates/settings/notifications":"DcknTu","./settings-tab-view":714,"jquery":774}],712:[function(require,module,exports){
var $, SettingsPersonalizationView, View, template, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./settings-tab-view');

template = require('../../templates/settings/personalization');

$ = require('jquery');

_ = require('underscore');

module.exports = SettingsPersonalizationView = (function(_super) {
  __extends(SettingsPersonalizationView, _super);

  function SettingsPersonalizationView() {
    return SettingsPersonalizationView.__super__.constructor.apply(this, arguments);
  }

  SettingsPersonalizationView.prototype.className = 'settings-personalization';

  SettingsPersonalizationView.prototype.template = template;

  SettingsPersonalizationView.prototype.unblockDomains = [];

  SettingsPersonalizationView.prototype.listen = {
    'change model': 'render',
    'settings:personalization:sync:start mediator': 'onSaveStart'
  };

  SettingsPersonalizationView.prototype.events = {
    'click .add-language': 'addNewLanguage',
    'click .save': 'onClickSave',
    'click .blocked-domain': 'onClickBlockedDomain'
  };

  SettingsPersonalizationView.prototype.initialize = function() {
    SettingsPersonalizationView.__super__.initialize.apply(this, arguments);
    return this.unblockDomains = [];
  };

  SettingsPersonalizationView.prototype.render = function() {
    SettingsPersonalizationView.__super__.render.apply(this, arguments);
    this.updateLanguagesManually();
    return this.updateBlockedDomains();
  };

  SettingsPersonalizationView.prototype.onClickSave = function() {
    var languages;
    languages = [];
    _.each(this.$el.find(".languages"), function(current, index, all) {
      return languages.push(current.value);
    });
    this.model.set({
      languages: languages,
      audio: this.$el.find("[name=audio]").is(":checked"),
      video: this.$el.find("[name=video]").is(":checked"),
      flash: this.$el.find("[name=flash]").is(":checked"),
      images: this.$el.find("[name=images]").is(":checked"),
      pdfs: this.$el.find("[name=pdfs]").is(":checked"),
      rating: this.$el.find("input[name=interests]:checked").val()
    });
    if (this.unblockDomains.length > 0) {
      this.model.set({
        unblock_domains: this.unblockDomains
      });
    }
    return this.model.save().then((function(_this) {
      return function(response) {
        if (response._success === true) {
          return _this.onSaveSuccess(response);
        } else {
          return _this.onSaveFailure(response._reason);
        }
      };
    })(this), (function(_this) {
      return function(response) {
        return _this.onSaveFailure(response._reason);
      };
    })(this));
  };

  SettingsPersonalizationView.prototype.onSaveSuccess = function(response) {
    SettingsPersonalizationView.__super__.onSaveSuccess.apply(this, arguments);
    if ((response != null ? response.blocked_domains : void 0) != null) {
      this.model.set({
        blocked_domains: response.blocked_domains
      });
      this.model.unset('unblock_domains');
      return this.unblock_domains = [];
    }
  };

  SettingsPersonalizationView.prototype.updateLanguagesManually = function() {
    var selectedLanguages;
    selectedLanguages = this.model.get('languages');
    return selectedLanguages != null ? selectedLanguages.forEach((function(_this) {
      return function(current, index, all) {
        var newLanguageView;
        newLanguageView = _this.addNewLanguage();
        return newLanguageView.value = current;
      };
    })(this)) : void 0;
  };

  SettingsPersonalizationView.prototype.addNewLanguage = function() {
    var addLink, initialHeight, languageOptions, newLanguage;
    initialHeight = this.$el.height();
    newLanguage = document.createElement("select");
    newLanguage.classList.add("languages");
    newLanguage.classList.add("form-control");
    languageOptions = this.model.get('langselect');
    _.each(languageOptions, (function(_this) {
      return function(value, key, list) {
        var option;
        option = document.createElement('option');
        option.innerHTML = value;
        option.value = key;
        return newLanguage.appendChild(option);
      };
    })(this));
    addLink = document.getElementById("add-new-language");
    if (addLink) {
      addLink.parentElement.insertBefore(document.createElement("br"), addLink);
      addLink.parentElement.insertBefore(newLanguage, addLink);
    }
    $(".settings").css("min-height", $(".settings").height() + (this.$el.height() - initialHeight) + 50);
    return newLanguage;
  };

  SettingsPersonalizationView.prototype.updateBlockedDomains = function() {
    var blockedDomains, blockedDomainsContainer;
    blockedDomains = this.model.get('blocked_domains');
    blockedDomainsContainer = this.$el.find(".blocked-domains-container");
    return blockedDomains != null ? blockedDomains.forEach((function(_this) {
      return function(current, index, all) {
        var newBlockedDomain;
        newBlockedDomain = document.createElement("div");
        newBlockedDomain.classList.add("blocked-domain");
        newBlockedDomain.innerHTML = current + '<i class="fa fa-close"></i>';
        newBlockedDomain.value = current;
        return blockedDomainsContainer.append(newBlockedDomain);
      };
    })(this)) : void 0;
  };

  SettingsPersonalizationView.prototype.onClickBlockedDomain = function(event) {
    var element;
    element = event.currentTarget;
    if (element.classList.contains("selected")) {
      element.classList.remove("selected");
      return this.unblockDomains.splice(element.value, 1);
    } else {
      element.classList.add("selected");
      return this.unblockDomains.push(element.value);
    }
  };

  return SettingsPersonalizationView;

})(View);


},{"../../templates/settings/personalization":"yiPzq7","./settings-tab-view":714,"jquery":774,"underscore":783}],713:[function(require,module,exports){
var $, CropPictureView, SettingsProfileView, VerifyPasswordView, View, mediator, panel, template, utils,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./settings-tab-view');

VerifyPasswordView = require('./verify-password-view');

CropPictureView = require('./crop-picture-view');

template = require('../../templates/settings/profile');

$ = require('jquery');

utils = require('../../lib/utils');

panel = require('../../lib/panel');

mediator = require('chaplin').mediator;

module.exports = SettingsProfileView = (function(_super) {
  __extends(SettingsProfileView, _super);

  function SettingsProfileView() {
    return SettingsProfileView.__super__.constructor.apply(this, arguments);
  }

  SettingsProfileView.prototype.autoRender = true;

  SettingsProfileView.prototype.className = 'settings-profile';

  SettingsProfileView.prototype.template = template;

  SettingsProfileView.prototype.region = 'sub-content';

  SettingsProfileView.prototype.events = {
    'click .save': 'onSubmit',
    'change #change-picture': 'onChangePicture'
  };

  SettingsProfileView.prototype.listen = {
    'settings:profile:picture-save:fail mediator': 'onSaveFailure',
    'settings:profile:sync:start mediator': 'onSaveStart',
    'verify-password:save mediator': 'saveModel',
    'crop-picture:success mediator': 'onSuccessCroppedPicture',
    'settings:profile:picture-save:success mediator': 'onSuccessPictureSave'
  };

  SettingsProfileView.prototype.initialize = function() {
    SettingsProfileView.__super__.initialize.apply(this, arguments);
    this.model.set('_errors', void 0);
    this.model.set('_initialEmail', this.model.get('email'));
    return this.model.set('_initialUsername', this.model.get('username'));
  };

  SettingsProfileView.prototype.render = function() {
    SettingsProfileView.__super__.render.apply(this, arguments);
    return this.setManualLocationAndTimezone();
  };

  SettingsProfileView.prototype.setManualLocationAndTimezone = function() {
    this.$el.find(".timezone").val(this.model.get('timezone'));
    return this.$el.find(".country").val(this.model.get('country'));
  };

  SettingsProfileView.prototype.onSaveSuccess = function() {
    this.model.set('_errors', void 0);
    panel.displaySuccessMsg("Your settings have been saved.");
    return this.model.fetch().then((function(_this) {
      return function() {
        _this.model.set('_initialEmail', _this.model.get('email'));
        _this.model.set('_initialUsername', _this.model.get('username'));
        _this.enableSaveButton();
        Chaplin.mediator.currentProfileM.unset('identityM');
        _this.publishEvent('settings:profile:save:success', _this.model.toJSON());
        return _this.render();
      };
    })(this));
  };

  SettingsProfileView.prototype.onSaveFailure = function(response) {
    var errorMessages, _ref;
    this.enableSaveButton();
    errorMessages = [];
    if (response._reason) {
      panel.displayErrorMsg("Sorry, couldn't save these settings.");
      response._reason.forEach(function(reason) {
        return errorMessages.push(reason.message);
      });
      this.model.set('_errors', errorMessages);
      return this.render();
    } else {
      return panel.displayErrorMsg((_ref = JSON.parse(response != null ? response.responseText : void 0)) != null ? _ref._error : void 0);
    }
  };

  SettingsProfileView.prototype.onSubmit = function() {
    this.setAllCurrentModelValues();
    if ((this.model.get('email') !== this.model.get('_initialEmail')) || (this.model.get('username') !== this.model.get('_initialUsername'))) {
      return this.subview('verify-password-view', new VerifyPasswordView({
        container: this.$el.find('.verify-password-container'),
        model: this.model
      }));
    } else {
      return this.saveModel();
    }
  };

  SettingsProfileView.prototype.saveModel = function() {
    return this.model.save().then((function(_this) {
      return function(response) {
        if (response._success === true) {
          return _this.onSaveSuccess();
        } else {
          return _this.onSaveFailure(response);
        }
      };
    })(this), (function(_this) {
      return function(response) {
        return _this.onSaveFailure(response);
      };
    })(this));
  };

  SettingsProfileView.prototype.onChangePicture = function(event) {
    return this.subview('crop-picture-view', new CropPictureView({
      container: this.$el.find('.crop-picture-container'),
      inputElement: event.target
    }));
  };

  SettingsProfileView.prototype.onSuccessCroppedPicture = function(dataUrl) {
    this.setAllCurrentModelValues();
    this.model.set('pictureUrl', dataUrl);
    this.model.set('changePicture', true);
    return this.render();
  };

  SettingsProfileView.prototype.onErrorCroppedPicture = function() {
    return panel.displayErrorMsg("Please select a valid picture.");
  };

  SettingsProfileView.prototype.onSuccessPictureSave = function() {
    this.model.set('pictureUrl', mediator.userM.get('picture_med') || "https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg");
    return this.render();
  };

  SettingsProfileView.prototype.setAllCurrentModelValues = function() {
    var _ref;
    return this.model.set({
      name: this.$el.find('.name').val().trim(),
      username: ((_ref = this.$el.find('.username').val()) != null ? _ref.trim() : void 0) || this.model.get('username'),
      email: this.$el.find('.email').val().trim(),
      timezone: this.$el.find('.timezone').val(),
      city: this.$el.find('.city').val(),
      state: this.$el.find('.state').val(),
      country: this.$el.find('.country').val()
    });
  };

  return SettingsProfileView;

})(View);


},{"../../lib/panel":125,"../../lib/utils":156,"../../templates/settings/profile":"4cyEb0","./crop-picture-view":705,"./settings-tab-view":714,"./verify-password-view":715,"chaplin":773,"jquery":774}],714:[function(require,module,exports){
var $, SettingsTabView, View, panel,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

$ = require('jquery');

panel = require('../../lib/panel');

module.exports = SettingsTabView = (function(_super) {
  __extends(SettingsTabView, _super);

  function SettingsTabView() {
    return SettingsTabView.__super__.constructor.apply(this, arguments);
  }

  SettingsTabView.prototype.autoRender = true;

  SettingsTabView.prototype.region = 'sub-content';

  SettingsTabView.prototype.initialize = function() {
    SettingsTabView.__super__.initialize.apply(this, arguments);
    return $('#app-container').addClass('settings-page');
  };

  SettingsTabView.prototype.dispose = function() {
    $('#app-container').removeClass('settings-page');
    return SettingsTabView.__super__.dispose.apply(this, arguments);
  };

  SettingsTabView.prototype.onSaveSuccess = function() {
    this.enableSaveButton();
    return panel.displaySuccessMsg("Your settings have been saved.");
  };

  SettingsTabView.prototype.onSaveFailure = function() {
    this.enableSaveButton();
    return panel.displayErrorMsg("Sorry, couldn't save these settings.");
  };

  SettingsTabView.prototype.onSaveStart = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.save-spin').removeClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.save').addClass('disabled') : void 0;
  };

  SettingsTabView.prototype.enableSaveButton = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.save-spin').addClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.save').removeClass('disabled') : void 0;
  };

  return SettingsTabView;

})(View);


},{"../../lib/panel":125,"../base/view":608,"jquery":774}],715:[function(require,module,exports){
var $, PopupView, VerifyPasswordView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

PopupView = require('../widgets/popup-view');

template = require('../../templates/settings/verify-password');

$ = require('jquery');

module.exports = VerifyPasswordView = (function(_super) {
  __extends(VerifyPasswordView, _super);

  function VerifyPasswordView() {
    return VerifyPasswordView.__super__.constructor.apply(this, arguments);
  }

  VerifyPasswordView.prototype.template = template;

  VerifyPasswordView.prototype.autoRender = true;

  VerifyPasswordView.prototype.className = 'verify-password-view su-popup';

  VerifyPasswordView.prototype.events = {
    'click .verify-password': 'onVerifyClick',
    'click .cancel': 'onClickCancel'
  };

  VerifyPasswordView.prototype.onVerifyClick = function() {
    var password;
    password = $('#password').val();
    if (password === '') {
      $('.invalid-update').text("Please enter your current password.");
      $(".password-group").addClass('has-error');
      return this.displayFeedbackError('#password-feedback');
    } else {
      this.model.set({
        password: password
      });
      this.closePopup();
      return this.publishEvent('verify-password:save');
    }
  };

  VerifyPasswordView.prototype.displayFeedbackError = function(attrId) {
    $(attrId).addClass('fa');
    $(attrId).addClass('fa-exclamation-triangle');
    $(attrId).removeClass('fa-check');
    return $(attrId).css('visibility', 'visible');
  };

  return VerifyPasswordView;

})(PopupView);


},{"../../templates/settings/verify-password":"C38HGo","../widgets/popup-view":745,"jquery":774}],716:[function(require,module,exports){
var $, ShareSocialView, View, mediator, stumble, template, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/share-social');

View = require('./base/view');

stumble = require('../lib/stumble');

$ = require('jquery');

_ = require('lodash');

mediator = require('chaplin').mediator;

module.exports = ShareSocialView = (function(_super) {
  __extends(ShareSocialView, _super);

  function ShareSocialView() {
    return ShareSocialView.__super__.constructor.apply(this, arguments);
  }

  ShareSocialView.prototype.template = template;

  ShareSocialView.prototype.autoRender = true;

  ShareSocialView.prototype.events = {
    'click .contact-item': 'onClickSocial'
  };

  ShareSocialView.prototype.listen = {
    'share:sent mediator': 'createShareSocial',
    'share:sendsocial mediator': 'createShareSocial'
  };

  ShareSocialView.prototype.onClickSocial = function(e) {
    $(e.currentTarget).find('.chk-circle').toggleClass('active');
    if (this.$el.find('.active').length) {
      return mediator.publish('sharesocial:status', true, this);
    } else {
      return mediator.publish('sharesocial:status', false, this);
    }
  };

  ShareSocialView.prototype.createShareSocial = function(message, view) {
    var services, _ref;
    services = [];
    if ($('.social-button').find('[data-id=share-fb]').hasClass('active')) {
      services.push('facebook');
    }
    if ($('.social-button').find('[data-id=share-tw]').hasClass('active')) {
      services.push('twitter');
    }
    services = _.uniq(services);
    if (services.length > 0) {
      this.model.set({
        'url': (_ref = stumble.getCollection().getActive()) != null ? _ref.get('url') : void 0,
        'type': 'external',
        'services': services
      });
      if (message) {
        this.model.set({
          'message': message
        });
      }
      this.model.save();
      return this.$el.find('.active').removeClass('active');
    }
  };

  return ShareSocialView;

})(View);


},{"../lib/stumble":130,"../templates/share-social":"bGgEdN","./base/view":608,"chaplin":773,"jquery":774,"lodash":776}],717:[function(require,module,exports){
var $, InputPanelView, InvitesView, ShareView, ViewDecorator, i18n, mediator, panel, template, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

InputPanelView = require('./base/input-panel-view');

utils = require('../lib/utils');

mediator = require('chaplin').mediator;

template = require('../templates/share');

_ = require('lodash');

panel = require('../lib/panel');

InvitesView = require('./conversations/invites-view');

i18n = require('../lib/i18n');

ViewDecorator = require('./decorators/decorator');

module.exports = ShareView = (function(_super) {
  __extends(ShareView, _super);

  function ShareView() {
    this.onWindowResize = __bind(this.onWindowResize, this);
    return ShareView.__super__.constructor.apply(this, arguments);
  }

  ShareView.prototype.template = template;

  ShareView.prototype.events = {
    'click [data-id=share-send]:not(.disabled)': 'onClickSend',
    'keyup [data-id=share-message]': 'onKeyUpSend',
    'click [data-id=share-cancel]': 'onCancelClick',
    'click [data-id=share-send-desktop]:not(.disabled)': 'onClickSend',
    'keyup [data-id=share-send-desktop]:not(.disabled)': 'onKeyUpSend',
    'blur input,textArea': 'onInputBlur'
  };

  ShareView.prototype.listen = {
    'participants:queued mediator': 'onParticipantsQueued',
    'sharesocial:status mediator': 'onSocialShareChange',
    'window:resize mediator': 'onWindowResize'
  };

  ShareView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    ShareView.__super__.initialize.apply(this, arguments);
    this.shareM = options.shareM;
    return this.contactsC = mediator.contactsC;
  };

  ShareView.prototype.render = function() {
    var $shareThumb;
    ShareView.__super__.render.apply(this, arguments);
    $shareThumb = this.$el.find('.share-thumb');
    if (!$shareThumb.attr('data-thumb')) {
      return $shareThumb.addClass('hidden');
    }
  };

  ShareView.prototype.attach = function() {
    var ViewConstructor;
    ShareView.__super__.attach.apply(this, arguments);
    ViewConstructor = ViewDecorator.makeContinuouslyScrollable(InvitesView);
    return this.subview('invites', new ViewConstructor({
      autoRender: true,
      container: '.invite-container',
      collection: this.contactsC
    }));
  };

  ShareView.prototype.onCancelClick = function() {
    this.clearInviteQueue();
    return panel.close();
  };

  ShareView.prototype.clearInviteQueue = function() {
    return this.contactsC.dequeueAll();
  };

  ShareView.prototype.onClickSend = function() {
    var invitesCount, message, queuedParticipants, requestData, urlId;
    urlId = this.model.get('urlid');
    if (this.$el.find('[data-id=share-message]').is(':visible')) {
      this.messageEl = this.$el.find('[data-id=share-message]');
    } else {
      this.messageEl = this.$el.find('[data-id=share-message-desktop]');
    }
    message = $.trim(this.messageEl.val()) || this.messageEl.attr('placeholder') || null;
    message = utils.stripHtml(message);
    requestData = {
      contentType: 'url',
      contentId: urlId
    };
    queuedParticipants = this.contactsC.getQueuedParticipants();
    invitesCount = queuedParticipants.length;
    requestData = _.extend(requestData, this.contactsC.splitQueuedParticipants(queuedParticipants));
    if (message) {
      requestData.initialMessage = message;
    }
    if (invitesCount) {
      if (invitesCount <= mediator.maxConvoParticipants) {
        this.shareM.set('data', requestData);
        this.shareM.on('sync', (function(_this) {
          return function(conversationM, resp, options) {
            var conversationId;
            if (resp.statusText === "error") {
              return panel.open('alert', {
                type: 'error',
                text: i18n('NETWORK_ERROR_PREVENTS_ACTION')
              });
            } else {
              conversationId = conversationM.get('id');
              _this.contactsC.saveContacts(conversationM.get('participants'));
              return panel.open('alert', {
                type: 'success',
                text: i18n('YOUR_MESSAGE_SENT')
              });
            }
          };
        })(this));
        this.shareM.on('error', (function(_this) {
          return function(conversationM, resp, options) {
            return panel.open('alert', {
              type: 'error',
              text: i18n('NETWORK_ERROR_PREVENTS_ACTION')
            });
          };
        })(this));
        this.shareM.save();
        mediator.publish('share:sent', message, this);
      }
    } else if (this.socialShareState) {
      mediator.publish('share:sendsocial', message, this);
    }
    this.messageEl.val('');
    return this.clearInviteQueue();
  };

  ShareView.prototype.onKeyUpSend = function(e) {
    if (e.keyCode === 13 && !this.$el.find('[data-id=share-send-desktop]').hasClass('disabled')) {
      return this.onClickSend();
    }
  };

  ShareView.prototype.onInputBlur = function() {
    if (utils.isiOS()) {
      return $(window).scrollTop(0);
    }
  };

  ShareView.prototype.onSocialShareChange = function(state) {
    this.socialShareState = state;
    if (this.socialShareState) {
      return this.$el.find('.sharesend').removeClass('disabled');
    } else if (!this.contactsC.findWhere({
      '_queued': true
    })) {
      return this.$el.find('.sharesend').addClass('disabled');
    }
  };

  ShareView.prototype.onParticipantsQueued = function(data) {
    var isDisabled;
    if (!data && !this.socialShareState) {
      isDisabled = true;
    } else {
      isDisabled = false;
    }
    return this.$el.find('.sharesend').toggleClass('disabled', isDisabled);
  };

  ShareView.prototype.onWindowResize = function() {
    return this.uncoverAndroidInput(this.$el.find('.input-bottom input, .input-bottom textarea'));
  };

  return ShareView;

})(InputPanelView);


},{"../lib/i18n":121,"../lib/panel":125,"../lib/utils":156,"../templates/share":"UGUm2P","./base/input-panel-view":607,"./conversations/invites-view":616,"./decorators/decorator":629,"chaplin":773,"jquery":774,"lodash":776}],718:[function(require,module,exports){
var $, Chaplin, StumbleView, View, analytics, mediator, panel, root, storage, stumble, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

Chaplin = require('chaplin');

View = require('./base/view');

utils = require('../lib/utils');

mediator = require('chaplin').mediator;

root = require('../lib/root');

stumble = require('../lib/stumble');

analytics = require('../lib/analytics');

storage = require('simple-storage');

$ = require('jquery');

panel = require('../lib/panel');

module.exports = StumbleView = (function(_super) {
  __extends(StumbleView, _super);

  function StumbleView() {
    return StumbleView.__super__.constructor.apply(this, arguments);
  }

  StumbleView.prototype.autoRender = true;

  StumbleView.prototype.className = 'stumble';

  StumbleView.prototype.region = 'content';

  StumbleView.prototype.events = {
    'click .image-viewer': 'toggleZoom'
  };

  StumbleView.prototype.listen = {
    'window:resize mediator': 'resizeFrame',
    'smartbanner:closed mediator': function() {
      return this.resizeFrame(false, true);
    },
    'panel:opened mediator': 'onPanelOpen',
    'panel:closed mediator': 'onPanelClose',
    'progressbar:close mediator': function() {
      return this.resizeFrame(false);
    },
    'addedToDOM': 'onAddedToDOM',
    'startloading': function(data) {
      return this.startedLoading = _.now();
    },
    'loaded': 'onLoaded',
    'stumble:loaded mediator': 'displayCurrentOnly',
    'stumble:prepainttimeout mediator': 'displayCurrentOnly',
    'mode:activechanged mediator': function() {
      return mediator.loadTimes = [];
    },
    'dd:pageloaded mediator': 'onDDPageload',
    'stumble:resizeFrame mediator': 'resizeFrame'
  };

  StumbleView.prototype.announcedLoaded = false;

  StumbleView.prototype.announceEvents = 'stumble';

  StumbleView.prototype.maxWait = 2000;

  StumbleView.prototype.minWait = 400;

  StumbleView.prototype.initialize = function() {
    StumbleView.__super__.initialize.apply(this, arguments);
    mediator.sessionStumbleViews += 1;
    return this.model.on('change:rating', (function(_this) {
      return function() {
        var event;
        event = ['stumble:rating'].concat(arguments);
        return _this.publishEvent.apply(_this, event);
      };
    })(this));
  };

  StumbleView.prototype.getTemplate = function() {
    var template;
    template = this.model.get('_template');
    return require("../templates/stumbles/" + template);
  };

  StumbleView.prototype.toggleZoom = function() {
    var _ref;
    return (_ref = this.$el) != null ? _ref.find('.image-viewer').toggleClass('zoomed-in') : void 0;
  };

  StumbleView.prototype.displayCurrentOnly = function(urlid) {
    var currentUrlid, _ref, _ref1;
    currentUrlid = stumble.getCollection().getActive().get('urlid');
    if (((_ref = this.model) != null ? _ref.get('urlid') : void 0) !== currentUrlid) {
      return this.dispose();
    } else {
      return (_ref1 = this.$el) != null ? _ref1.addClass('loaded') : void 0;
    }
  };

  StumbleView.prototype.getPaintTimeout = function() {
    var median, waitTime;
    median = utils.getMedian(mediator.loadTimes) || 2000;
    waitTime = median * 0.3;
    if (waitTime > this.maxWait) {
      return this.maxWait;
    } else if (waitTime < this.minWait) {
      return this.minWait;
    } else {
      return waitTime;
    }
  };

  StumbleView.prototype.onPanelClose = function() {
    var _ref;
    this.resizeFrame(true);
    return (_ref = this.$el) != null ? _ref.find('.stumble-frame').addClass('panel-closing') : void 0;
  };

  StumbleView.prototype.onPanelOpen = function() {
    var _ref;
    this.resizeFrame();
    return (_ref = this.$el) != null ? _ref.find('.stumble-frame').removeClass('panel-closing') : void 0;
  };

  StumbleView.prototype.isLoaded = function() {
    return this.announcedLoaded;
  };

  StumbleView.prototype.announceLoaded = function(name) {
    if (name == null) {
      name = 'loaded';
    }
    if (!this.announcedLoaded) {
      this.trigger(name, {
        urlid: this.model.get('urlid'),
        timestamp: utils.unix(),
        duration: _.now() - this.startedLoading
      });
    }
    if (name === 'loaded') {
      return this.announcedLoaded = true;
    }
  };

  StumbleView.prototype.getDDFrame = function() {
    var $ddFrame, _ref;
    $ddFrame = (_ref = this.$el) != null ? _ref.find('.dd-stumble-frame') : void 0;
    if (!_.isEmpty($ddFrame)) {
      return $ddFrame;
    }
  };

  StumbleView.prototype.stripNoSpaFromTiles = function() {
    var $ddFrame, interval;
    $ddFrame = this.getDDFrame();
    if ($ddFrame != null) {
      return interval = this.setInterval((function(_this) {
        return function() {
          var e, _ref;
          try {
            return $ddFrame != null ? (_ref = $ddFrame.contents()) != null ? _ref.find('a[href^="/to/s/"],a[href*="/su/share"],a[href^="/interest/"],a[href*="/stumbler/"]').not('[data-spa-replaced]').each(function() {
              var href, route, urlid;
              href = this.getAttribute('href');
              urlid = href.split('?').shift().split('/to/s/').pop().split('/su/').pop();
              if (urlid.match('/interest/') || urlid.match('/stumbler/')) {
                route = urlid;
              } else {
                route = "/su/" + urlid + "?from=" + (encodeURIComponent(href));
              }
              return $(this).attr('href', route).attr('data-spa-replaced', true).attr('target', '_top').css({
                'cursor': 'pointer'
              }).one('click', function(e) {
                if (!(e.which > 1)) {
                  e.preventDefault();
                  clearInterval(interval);
                  if (!($(e.target).hasClass('make-cover') || $(e.target).hasClass('current-cover'))) {
                    Chaplin.utils.redirectTo({
                      url: route
                    });
                  }
                  return false;
                }
              });
            }) : void 0 : void 0;
          } catch (_error) {
            e = _error;
            return clearInterval(interval);
          }
        };
      })(this), 500);
    }
  };

  StumbleView.prototype.overrideShareLinks = function() {
    var $ddFrame;
    $ddFrame = this.getDDFrame();
    if ($ddFrame != null) {
      return window.__shareLinkFromDD = function(id) {
        return Chaplin.utils.redirectTo({
          'url': "/su/" + id + '/panel/share'
        });
      };
    }
  };

  StumbleView.prototype.overrideOnPageStumble = function() {
    var $ddFrame, interval;
    $ddFrame = this.getDDFrame();
    if ($ddFrame != null) {
      return interval = this.setInterval((function(_this) {
        return function() {
          var $doubleDownStumbleButton, e, mode, stumbleButtonData, _ref, _ref1;
          try {
            $doubleDownStumbleButton = $ddFrame != null ? (_ref = $ddFrame.contents()) != null ? _ref.find('.stumble-button').not('[data-spa-replaced]').clone() : void 0 : void 0;
            if (!_.isEmpty($doubleDownStumbleButton)) {
              if ($ddFrame != null) {
                if ((_ref1 = $ddFrame.contents()) != null) {
                  _ref1.find('.stumble-button').replaceWith($doubleDownStumbleButton);
                }
              }
              $doubleDownStumbleButton.attr('data-spa-replaced', true);
              stumbleButtonData = $doubleDownStumbleButton.data();
              mode = stumbleButtonData != null ? stumbleButtonData.mode : void 0;
              return $doubleDownStumbleButton.on('click', function(e) {
                var modeInfo;
                e.stopImmediatePropagation();
                e.preventDefault();
                modeInfo = {};
                if (mode) {
                  switch (mode) {
                    case 'all':
                      stumbleButtonData.contextual = 'All Interests';
                      break;
                    case 'instumbler':
                      modeInfo = {
                        _mode: 'user',
                        userids: [stumbleButtonData.stumbler]
                      };
                      break;
                    case 'topic':
                      modeInfo = {
                        _mode: 'topic',
                        id: stumbleButtonData.topic
                      };
                      break;
                    case 'tag':
                      modeInfo = {
                        _mode: 'keyword',
                        name: stumbleButtonData.contextual,
                        keyword: stumbleButtonData.q
                      };
                      break;
                    case 'stumblelist':
                      modeInfo = {
                        _mode: 'list',
                        listId: stumbleButtonData.s_prefixed_listid.slice(1)
                      };
                  }
                  modeInfo.name = _.capitalize(stumbleButtonData.contextual);
                  modeInfo._hide = true;
                  storage.set('modeInfo', modeInfo);
                  mediator.modesC.add(_.extend(modeInfo));
                  return mediator.modesC.setActive(stumbleButtonData.contextual);
                } else {
                  return this.trigger('next');
                }
              });
            }
          } catch (_error) {
            e = _error;
            return clearInterval(interval);
          }
        };
      })(this), 500);
    }
  };

  StumbleView.prototype.stripDDPushState = function() {
    var $ddFrame, interval;
    $ddFrame = this.getDDFrame();
    if ($ddFrame != null) {
      return interval = this.setInterval((function(_this) {
        return function() {
          var e, _ref;
          try {
            return $ddFrame != null ? (_ref = $ddFrame.contents()) != null ? _ref.find('.nav-homepage-links .pushState').not('[data-spa-replaced]').each(function() {
              var $el, updatedHref;
              $el = $(this);
              updatedHref = $el.attr('href').replace('&_nospa=true', '');
              return $el.removeClass('pushState').attr('href', updatedHref).attr('data-spa-replaced', true);
            }) : void 0 : void 0;
          } catch (_error) {
            e = _error;
            return clearInterval(interval);
          }
        };
      })(this), 500);
    }
  };

  StumbleView.prototype.triggerDeepLink = function() {
    var currentTime, currentUrl, deepLinkUrl, expireDate, postfix, prefix, urlid;
    prefix = 'stumbleupon://urlid/';
    urlid = this.model.get('urlid');
    postfix = window.location.search;
    deepLinkUrl = prefix + urlid + postfix;
    mediator.triedDeepLinking = true;
    currentUrl = window.location.href;
    window.location.href = deepLinkUrl;
    currentTime = (new Date()).getTime();
    expireDate = new Date(currentTime + 60000);
    $.cookie('deeplink_try', 1, {
      expires: expireDate
    });
    return setTimeout(function() {
      return window.location.href = currentUrl;
    }, 200);
  };

  StumbleView.prototype.onAddedToDOM = function() {
    var _ref;
    utils.onContentLoaded();
    this.trigger('startloading', {
      urlid: this.model.get('urlid'),
      timestamp: utils.unix()
    });
    this.resizeFrame(true);
    this.model.getEmbedCode().then(this.appendEmbedCode.bind(this));
    if ((_ref = this.$el) != null) {
      _ref.find('iframe, img').on('load error', (function(_this) {
        return function() {
          return _this.announceLoaded();
        };
      })(this)).each(function() {
        if (this.complete) {
          return $(this).trigger('load');
        }
      });
    }
    this.setTimeout((function(_this) {
      return function() {
        return _this.announceLoaded('prepainttimeout');
      };
    })(this), this.getPaintTimeout());
    if (this.canDeepLink()) {
      this.triggerDeepLink();
    }
    if (panel.getCurrentPanel() !== 'conversation') {
      return this.$el.find('iframe').focus();
    }
  };

  StumbleView.prototype.appendEmbedCode = function(data) {
    if (data != null ? data.html : void 0) {
      return this.$el.find('.embed-target').html(data.html);
    }
  };

  StumbleView.prototype.canDeepLink = function() {
    return !utils.isLoggedIn() && utils.canHandleDeeplink() && !mediator.triedDeepLinking && !$.cookie('deeplink_try');
  };

  StumbleView.prototype.onDDPageload = function() {
    if (window.top.location.pathname === '/submit/complete') {
      return analytics.trackEvent('dd-submitpage-complete');
    }
  };

  StumbleView.prototype.onLoaded = function(data) {
    var _ref, _ref1, _ref2;
    mediator.loadTimes.push(data.duration);
    if (panel.getCurrentPanel() !== 'conversation') {
      if ((_ref = this.$el) != null) {
        if ((_ref1 = _ref.find('.stumble-frame')[0]) != null) {
          if ((_ref2 = _ref1.contentWindow) != null) {
            _ref2.focus();
          }
        }
      }
    }
    this.stripNoSpaFromTiles();
    this.overrideOnPageStumble();
    this.overrideShareLinks();
    return this.stripDDPushState();
  };

  StumbleView.prototype.attach = function() {
    StumbleView.__super__.attach.apply(this, arguments);
    if (!mediator.timeToFirstStumble) {
      mediator.timeToFirstStumble = utils.secondsSincePageStart();
      analytics.trackEvent('timeToFirstStumble', mediator.timeToFirstStumble);
    }
    if (panel.isOpen()) {
      return this.onPanelOpen({});
    }
  };

  StumbleView.prototype.dispose = function() {
    window.__shareLinkFromDD = null;
    return StumbleView.__super__.dispose.apply(this, arguments);
  };

  return StumbleView;

})(View);


},{"../lib/analytics":116,"../lib/panel":125,"../lib/root":129,"../lib/stumble":130,"../lib/utils":156,"./base/view":608,"chaplin":773,"jquery":774,"lodash":776,"simple-storage":780}],719:[function(require,module,exports){
var $, StumbleBarAddonView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/stumblebar-addon');

$ = require('jquery');

module.exports = StumbleBarAddonView = (function(_super) {
  __extends(StumbleBarAddonView, _super);

  function StumbleBarAddonView() {
    return StumbleBarAddonView.__super__.constructor.apply(this, arguments);
  }

  StumbleBarAddonView.prototype.autoRender = true;

  StumbleBarAddonView.prototype.className = 'addon container-fluid';

  StumbleBarAddonView.prototype.region = 'content';

  StumbleBarAddonView.prototype.template = template;

  StumbleBarAddonView.prototype.initialize = function() {
    StumbleBarAddonView.__super__.initialize.apply(this, arguments);
    $('body').css('overflow-x', 'scroll');
    return $('body').css('overflow-y', 'scroll');
  };

  StumbleBarAddonView.prototype.dispose = function() {
    $('body').css('overflow-x', '');
    $('body').css('overflow-y', '');
    return StumbleBarAddonView.__super__.dispose.apply(this, arguments);
  };

  return StumbleBarAddonView;

})(View);


},{"../templates/stumblebar-addon":"kSD+R2","./base/view":608,"jquery":774}],720:[function(require,module,exports){
var StumblerItemView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/stumbler-item');

module.exports = StumblerItemView = (function(_super) {
  __extends(StumblerItemView, _super);

  function StumblerItemView() {
    return StumblerItemView.__super__.constructor.apply(this, arguments);
  }

  StumblerItemView.prototype.autoRender = true;

  StumblerItemView.prototype.className = 'stumbler-item';

  StumblerItemView.prototype.template = template;

  StumblerItemView.prototype.initialize = function() {
    StumblerItemView.__super__.initialize.apply(this, arguments);
    this.model.set('_dataPrefix', 'urlInfo');
    return this.setThumbnail();
  };

  StumblerItemView.prototype.setThumbnail = function() {
    var thumbnail;
    thumbnail = this.model.get('picture_large') || this.model.get('picture_full') || this.model.get('picture') || this.model.get('thumbnail') || "";
    if (!thumbnail) {
      thumbnail = 'https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg';
    }
    return this.model.set('_thumbnail', thumbnail);
  };

  return StumblerItemView;

})(View);


},{"../templates/stumbler-item":"w8x+Vh","./base/view":608}],721:[function(require,module,exports){
var $, ActionButtonM, ActionButtonsC, ActionButtonsV, BadgeView, CategorySelectionV, SearchView, UrlV, View, i18n, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

template = require('../../templates/submit/badge');

View = require('../base/view');

UrlV = require('./url-view');

CategorySelectionV = require('./category-selection-view');

ActionButtonsV = require('../widgets/action-buttons-view');

ActionButtonsC = require('../../models/action-buttons-collection');

ActionButtonM = require('../../models/action-button-model');

SearchView = require('../widgets/search-input-view');

i18n = require('../../lib/i18n');


/**
In this view there three subviews:

  1. a subview to manage posting of an url to the submit endpoint
  2. a subview to manage selection of interests for posting category
  3. an interest search

To facilitate this, inject a complex model:

  {
    url: an empty url model to be populated and saved to the submit endpoint
    allInterests: a list of all the interests, in their hierarchy
    flattenedInterests: a collection of all the leaf-level interests, flattened
    suggestedInterests: a collection of interests as returned from the classification endpoint
  }

The flattened interests will drive an autofilter subview.  It should not display the items that
are in the suggestedInterests list, so that view will use both collections

The suggested interests depends on having an url.
 */

module.exports = BadgeView = (function(_super) {
  __extends(BadgeView, _super);

  function BadgeView() {
    return BadgeView.__super__.constructor.apply(this, arguments);
  }

  BadgeView.prototype.autoRender = true;

  BadgeView.prototype.className = 'badge-view-container';

  BadgeView.prototype.container = 'body';

  BadgeView.prototype.containerMethod = 'html';

  BadgeView.prototype.template = template;

  BadgeView.prototype.listSelector = '.interests-container';

  BadgeView.prototype.trackingLabel = 'badge';

  BadgeView.prototype.eventPrefix = 'submit-view';

  BadgeView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  BadgeView.prototype.initialize = function(options) {
    BadgeView.__super__.initialize.apply(this, arguments);
    this.actionButtonsCollection = this._createActionButtonsCollection(this.trackingLabel);
    this.interestSearchModel = this.model.getInterestSearchModel();
    this.tagSearchModel = this.model.getTagSearchModel();
    this.urlModel = this.model.getUrlModel();
    this.allInterestsCollection = this.model.getAllInterestsCollection();
    this.suggestedInterestsCollection = this.model.getSuggestedInterestsCollection();
    this.tagsToSubmitCollection = this.model.getTagsToSubmitCollection();
    this.flattenedInterestsCollection = this.model.getFlattenedInterestsCollection();
    this.listenTo(this.actionButtonsCollection, 'change:clicked', this.onActionButtonClicked);
    this.listenTo(this.interestSearchModel, 'change:selectedModel', this.onSelectedInterestChange);
    this.listenTo(this.interestSearchModel, 'change:searchText', this.manageButtonState);
    this.listenTo(this.tagSearchModel, 'change:selectedModel', this.onSelectedTagChange);
    this.listenTo(this.suggestedInterestsCollection, 'all', this.manageButtonState);
    this.listenTo(this.suggestedInterestsCollection, 'sync', this.onSuggestedInterestsSync);
    this.listenTo(this.urlModel, 'change:nsfw', this.changeNsfw);
    this.listenTo(this.urlModel, 'change:url', this.changeUrl);
    this.listenTo(this.urlModel, 'all', this.manageButtonState);
    Chaplin.mediator.subscribe(this.eventPrefix + ':tag:search-input-view:enter-key', this.onTagSearchInputEnterKey, this);
    this.changeNsfw();
    return this.changeUrl();
  };

  BadgeView.prototype.dispose = function() {
    BadgeView.__super__.dispose.apply(this, arguments);
    return Chaplin.mediator.unsubscribe(this.eventPrefix + ':tag:search-input-view:enter-key', this.onTagSearchInputEnterKey, this);
  };

  BadgeView.prototype.onAddedToDOM = function(evnt) {
    $('body').css('overflow', 'auto');
    this.subview('url-input-view', new UrlV({
      el: this.$el.find('#url-view-container'),
      model: this.urlModel
    }));
    this.subview('interest-search-input-view', new SearchView({
      container: this.$el.find('#interest-search-input-container'),
      containerMethod: 'html',
      model: this.interestSearchModel,
      eventPrefix: this.eventPrefix + ':search-input-view',
      id: this.viewId
    }));
    this.subview('tag-search-input-view', new SearchView({
      container: this.$el.find('#tag-search-input-container'),
      containerMethod: 'html',
      model: this.tagSearchModel,
      eventPrefix: this.eventPrefix + ':tag:search-input-view',
      id: this.viewId
    }));
    this.subview('action-buttons-view', new ActionButtonsV({
      collection: this.actionButtonsCollection,
      container: this.$el.find('#action-buttons-view-container'),
      containerMethod: 'html',
      id: 'action-buttons'
    }));
    this._createSuggestedInterestsView();
    return this._createUserTagsView();
  };

  BadgeView.prototype.onSuggestedInterestsSync = function() {
    return this.$el.find('.suggested-interests-loading').hide();
  };

  BadgeView.prototype._createSuggestedInterestsView = function() {
    var view;
    view = this.subview('suggested-interests-view');
    if (view != null) {
      view.dispose();
    }
    return this.subview('suggested-interests-view', new CategorySelectionV({
      collection: this.suggestedInterestsCollection,
      container: this.$el.find('#suggested-interests-view-container'),
      containerMethod: 'html',
      id: 'new-interests'
    }));
  };

  BadgeView.prototype._createUserTagsView = function() {
    var view;
    view = this.subview('suggested-tags-view');
    if (view != null) {
      view.dispose();
    }
    return this.subview('suggested-tags-view', new CategorySelectionV({
      collection: this.tagsToSubmitCollection,
      container: this.$el.find('#suggested-tags-view-container'),
      containerMethod: 'html',
      id: 'new-tags'
    }));
  };

  BadgeView.prototype._createActionButtonsCollection = function(trackingLabel) {
    var actionButtonsC;
    return actionButtonsC = new ActionButtonsC([
      new ActionButtonM({
        id: this.eventPrefix + '-cancel',
        action: 'cancel',
        disabled: false,
        classNames: ['btn-sulight'],
        trackingCategory: this.eventPrefix + '-cancel',
        trackingLabel: trackingLabel,
        buttonText: i18n('CANCEL')
      }), new ActionButtonM({
        id: this.eventPrefix + '-save',
        action: 'save',
        disabled: true,
        classNames: ['btn-sublue'],
        trackingCategory: this.eventPrefix + '-save',
        trackingLabel: trackingLabel,
        buttonText: i18n('SAVE')
      })
    ]);
  };

  BadgeView.prototype.onActionButtonClicked = function(buttonModel, options) {
    switch (buttonModel.getAction()) {
      case 'cancel':
        return this.cancel();
      case 'save':
        return this.save();
    }
  };

  BadgeView.prototype.save = function() {
    return this.model.save().then(function() {
      try {
        return window.close();
      } catch (_error) {}
    });
  };

  BadgeView.prototype.cancel = function() {
    try {
      return window.close();
    } catch (_error) {}
  };

  BadgeView.prototype.manageButtonState = function() {
    var saveButtonModel, valid, validationError;
    validationError = this.model.validate();
    valid = !validationError;
    saveButtonModel = this.actionButtonsCollection.findWhere({
      action: 'save'
    });
    saveButtonModel.setTooltip(validationError);
    return saveButtonModel.setDisabled(!valid);
  };

  BadgeView.prototype.changeUrl = function() {
    return this.model.setUrl(this.urlModel.getUrl());
  };

  BadgeView.prototype.changeNsfw = function() {
    return this.model.setNsfw(this.urlModel.getNsfw());
  };

  BadgeView.prototype.onSelectedInterestChange = function(model, value, options) {
    var interestModel;
    if (value) {
      interestModel = value.clone();
      interestModel.setChecked(true);
      this.suggestedInterestsCollection.unshift(interestModel, {
        merge: true
      });
      this._createSuggestedInterestsView();
      return model.setSelectedModel(null);
    }
  };

  BadgeView.prototype.onSelectedTagChange = function(model, value, options) {
    var userTagModel;
    if (value) {
      userTagModel = value.clone();
      userTagModel.setChecked(true);
      this.tagsToSubmitCollection.unshift(userTagModel, {
        merge: true
      });
      return model.setSelectedModel(null);
    }
  };

  BadgeView.prototype.onTagSearchInputEnterKey = function(data) {
    if (!data.handled) {
      this.model.addTag(data.searchText);
      this.interestSearchModel.setSearchText('');
      return this.tagSearchModel.setSearchText('');
    }
  };

  return BadgeView;

})(View);


},{"../../lib/i18n":121,"../../models/action-button-model":159,"../../models/action-buttons-collection":160,"../../templates/submit/badge":"89VASx","../base/view":608,"../widgets/action-buttons-view":739,"../widgets/search-input-view":746,"./category-selection-view":722,"./url-view":725,"jquery":774}],722:[function(require,module,exports){
var CategorySelectionView, CollectionView, ItemView, ViewDecorator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/submit/category-selection');

CollectionView = require('../base/collection-view');

ItemView = require('../base/view');

ViewDecorator = require('../decorators/decorator');


/**
This is a subview to manage selection of interests for posting category

The flattened interests will drive an autofilter subview.  It should not contain the items that
are in the suggestedInterests list, so those two collections need to be kept in sync

The suggested interests depends on having an url.
 */

module.exports = CategorySelectionView = (function(_super) {
  __extends(CategorySelectionView, _super);

  function CategorySelectionView() {
    return CategorySelectionView.__super__.constructor.apply(this, arguments);
  }

  CategorySelectionView.prototype.autoRender = true;

  CategorySelectionView.prototype.className = 'submit-form';

  CategorySelectionView.prototype.container = 'body';

  CategorySelectionView.prototype.containerMethod = 'html';

  CategorySelectionView.prototype.itemView = ViewDecorator.makeCheckable(ItemView);

  CategorySelectionView.prototype.listSelector = '.interests-container';

  CategorySelectionView.prototype.template = template;

  CategorySelectionView.prototype.events = {
    'click textarea': function(e) {
      return e.target.select();
    }
  };

  return CategorySelectionView;

})(CollectionView);


},{"../../templates/submit/category-selection":"LF3J/5","../base/collection-view":606,"../base/view":608,"../decorators/decorator":629}],723:[function(require,module,exports){
var $, ActionButtonM, ActionButtonsC, ActionButtonsV, LikeConfirmationView, View, eventPrefix, i18n, template, trackingLabel,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/submit/like-confirmation');

$ = require('jquery');

View = require('../base/view');

eventPrefix = 'like-confirmation-view';

ActionButtonsV = require('../widgets/action-buttons-view');

ActionButtonsC = require('../../models/action-buttons-collection');

ActionButtonM = require('../../models/action-button-model');

i18n = require('../../lib/i18n');

trackingLabel = 'likecontent';

module.exports = LikeConfirmationView = (function(_super) {
  __extends(LikeConfirmationView, _super);

  function LikeConfirmationView() {
    return LikeConfirmationView.__super__.constructor.apply(this, arguments);
  }

  LikeConfirmationView.prototype.autoRender = true;

  LikeConfirmationView.prototype.className = 'like-confirmation-view-container';

  LikeConfirmationView.prototype.container = 'body';

  LikeConfirmationView.prototype.containerMethod = 'html';

  LikeConfirmationView.prototype.template = template;

  LikeConfirmationView.prototype.events = {
    'click #mix-onboard-button': function() {
      return this.goMixOnboard('spa-like-confirmation', this.model.attributes.url);
    }
  };

  LikeConfirmationView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  LikeConfirmationView.prototype.initialize = function(options) {
    LikeConfirmationView.__super__.initialize.apply(this, arguments);
    this.actionButtonsCollection = this._createActionButtonsCollection(trackingLabel);
    return this.listenTo(this.actionButtonsCollection, 'change:clicked', this.onActionButtonClicked);
  };

  LikeConfirmationView.prototype.onAddedToDOM = function(evnt) {
    $('body').css('overflow', 'auto');
    $('.header-text').dotdotdot();
    this.subview('action-buttons-view', new ActionButtonsV({
      collection: this.actionButtonsCollection,
      container: this.$el.find('#action-buttons-view-container'),
      containerMethod: 'html',
      id: 'action-buttons'
    }));
    return this.resizeWindow();
  };

  LikeConfirmationView.prototype.onActionButtonClicked = function(buttonModel, options) {
    switch (buttonModel.getAction()) {
      case 'close':
        return this.close();
      case 'stumble':
        return this.stumble();
    }
  };

  LikeConfirmationView.prototype.close = function() {
    return window.close();
  };

  LikeConfirmationView.prototype.stumble = function() {
    return window.location.href = '/su/';
  };

  LikeConfirmationView.prototype._createActionButtonsCollection = function(trackingLabel) {
    var actionButtonsC;
    return actionButtonsC = new ActionButtonsC([
      new ActionButtonM({
        id: eventPrefix + '-stumble',
        action: 'stumble',
        disabled: false,
        classNames: ['btn-suorange'],
        trackingCategory: eventPrefix + '-stumble',
        trackingLabel: trackingLabel,
        buttonText: i18n('STUMBLE')
      })
    ]);
  };

  LikeConfirmationView.prototype.resizeWindow = function() {
    return window.resizeTo(document.body.scrollWidth, document.body.scrollHeight + 100);
  };

  return LikeConfirmationView;

})(View);


},{"../../lib/i18n":121,"../../models/action-button-model":159,"../../models/action-buttons-collection":160,"../../templates/submit/like-confirmation":"K+Jvgp","../base/view":608,"../widgets/action-buttons-view":739,"jquery":774}],724:[function(require,module,exports){
var BadgeView, SubmitView, template,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/submit/submit');

BadgeView = require('./badge-view');

module.exports = SubmitView = (function(_super) {
  __extends(SubmitView, _super);

  function SubmitView() {
    this.save = __bind(this.save, this);
    return SubmitView.__super__.constructor.apply(this, arguments);
  }

  SubmitView.prototype.autoRender = true;

  SubmitView.prototype.className = 'submit-view-container';

  SubmitView.prototype.container = 'body';

  SubmitView.prototype.containerMethod = 'html';

  SubmitView.prototype.template = template;

  SubmitView.prototype.trackingLabel = 'submit';

  SubmitView.prototype.save = function() {
    var submitModel;
    submitModel = this.model;
    return submitModel.save().then((function(_this) {
      return function(success) {
        var message, urlid;
        message = JSON.stringify({
          type: 'submitform:saved',
          urlM: submitModel.get('urlM')
        });
        urlid = submitModel.getUrlModel().getUrlId();
        return window.parent.postMessage(message, document.location.protocol + '//' + document.location.hostname);
      };
    })(this));
  };

  SubmitView.prototype.cancel = function() {
    var message;
    message = JSON.stringify({
      type: 'submitform:canceled',
      submitModel: this.model
    });
    return window.parent.postMessage(message, document.location.protocol + '//' + document.location.hostname);
  };

  return SubmitView;

})(BadgeView);


},{"../../templates/submit/submit":"QssV0E","./badge-view":721}],725:[function(require,module,exports){
var SearchView, UrlView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/submit/url');

View = require('../base/view');

SearchView = require('../widgets/search-input-view');

module.exports = UrlView = (function(_super) {
  __extends(UrlView, _super);

  function UrlView() {
    return UrlView.__super__.constructor.apply(this, arguments);
  }

  UrlView.prototype.autoRender = true;

  UrlView.prototype.className = 'url-view';

  UrlView.prototype.template = template;

  UrlView.prototype.events = {
    'input input[name=url]': 'onUrlInput',
    'change input[name=nsfw]': 'onNsfwChange'
  };

  UrlView.prototype.onUrlInput = function(evnt) {
    var url;
    url = this.$el.find('input[name=url]').val();
    return this.model.setUrl(url);
  };

  UrlView.prototype.onNsfwChange = function(evnt) {
    var nsfw;
    nsfw = this.$el.find('input[name=nsfw]:checked').val();
    if (nsfw === "no") {
      return this.model.setNsfw(false);
    } else {
      return this.model.setNsfw(true);
    }
  };

  return UrlView;

})(View);


},{"../../templates/submit/url":"zPE/Ad","../base/view":608,"../widgets/search-input-view":746}],726:[function(require,module,exports){

/*
 A view to wrap the taggle object -- the view uses a taggle.js object to render a collection.  In
 this implementation, the collection is populated by tags extracted using the tagExtractorFn option
 passed in the options to the constructor.  Every collection change results in a complete redraw of the
 collection using the same extractor function on the collection items.  This is designed to be used as
 a subview where the containing view knows what the models in the collection are and how to extract tags
 from those models.

 options:
   standard chaplin/backbone view options
   placeholder: string - placeholder text
   eventPrefix: string - a prefix for events raised on the mediator (default 'tag-view')
   tagExtractorFn: function - a function that receives an array of models as sole argument and returns a list of tags
                              when creating this view, the creator knows what the collection items look like, and how
                              to extract tags from them, so pass that in a lambda here that will receive an array of models.

 events:  these events will be published via the mediator
   event-prefix:escape-key
   event-prefix:tab-key
   event-prefix:delete-key
   event-prefix:enter-key
   event-prefix:arrow-left
   event-prefix:arrow-right
   event-prefix:arrow-down
   event-prefix:arrow-up
   event-prefix:new-text
   event-prefix:tag-added
   event-prefix:tag-removed
   event-prefix:tag-selected
   event-prefix:redraw

 notes:
   when creating the view, the container option should represent an id of the container
 */
var $, ARROW_MODES, CollectionView, ENTERKEY_MODES, TagView, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('./base/collection-view');

utils = require('../lib/utils');

_ = require('lodash');

$ = require('jquery');

ARROW_MODES = {
  TYPING: 0,
  SELECTING: 1
};

ENTERKEY_MODES = {
  DEFAULT: 0,
  SUBMITTING: 1
};

module.exports = TagView = (function(_super) {
  __extends(TagView, _super);

  function TagView() {
    this.clearSelection = __bind(this.clearSelection, this);
    this.select = __bind(this.select, this);
    this.getBufferText = __bind(this.getBufferText, this);
    this.commitBuffer = __bind(this.commitBuffer, this);
    this.bufferChange = __bind(this.bufferChange, this);
    this.onTargetChange = __bind(this.onTargetChange, this);
    this.onKeyUp = __bind(this.onKeyUp, this);
    this.getTag = __bind(this.getTag, this);
    this.getTags = __bind(this.getTags, this);
    this.getEnterKeyMode = __bind(this.getEnterKeyMode, this);
    this.getArrowMode = __bind(this.getArrowMode, this);
    this.onKeyDown = __bind(this.onKeyDown, this);
    this.onInviteRejected = __bind(this.onInviteRejected, this);
    this.onCollectionChange = __bind(this.onCollectionChange, this);
    this.newTaggle = __bind(this.newTaggle, this);
    this.clearTaggle = __bind(this.clearTaggle, this);
    this.initialize = __bind(this.initialize, this);
    return TagView.__super__.constructor.apply(this, arguments);
  }

  TagView.prototype.autoRender = false;

  TagView.prototype.renderItems = false;

  TagView.prototype.listen = {
    'change collection': 'onCollectionChange',
    'participants:invite-rejected mediator': 'onInviteRejected'
  };

  TagView.prototype.initialize = function(options) {
    TagView.__super__.initialize.apply(this, arguments);
    this.eventPrefix = options.eventPrefix || 'tag-view';
    this.placeholder = options.placeholder;
    this.tagExtractorFn = options.tagExtractorFn;
    this.$targetEl = $("#" + this.container);
    this.newTaggle();
    return this.addDomListeners();
  };

  TagView.prototype.dispose = function() {
    TagView.__super__.dispose.apply(this, arguments);
    this.clearDomListeners();
    return this.clearTaggle();
  };

  TagView.prototype.clearTaggle = function() {
    if (this.taggle) {
      $(this.taggle.getInput()).off('change', this.onTargetChange);
      $('body').off('click', this.commitBuffer);
      this.taggle = null;
    }
    return this.$targetEl.html('');
  };

  TagView.prototype.newTaggle = function(tags) {
    this.clearTaggle();
    tags = this.tagExtractorFn(this.collection.models);
    this.taggle = new Taggle(this.container, {
      placeholder: this.placeholder,
      submitKeys: [188],
      onTagAdd: (function(_this) {
        return function(event, tag) {
          var inputValue, isTagAnEmail;
          inputValue = _this.taggle.getInput().value;
          isTagAnEmail = inputValue && utils.isEmail(inputValue);
          if ($('.contact-item:visible').length === 1 || isTagAnEmail) {
            return _this.publishEvent(_this.eventPrefix + ":tag-added", {
              newTag: tag,
              collection: _this.collection,
              emailTag: isTagAnEmail
            });
          } else {
            return _this.taggle.remove(tag);
          }
        };
      })(this),
      onTagRemove: (function(_this) {
        return function(event, tag) {
          return _this.publishEvent(_this.eventPrefix + ":tag-removed", {
            oldTag: tag,
            collection: _this.collection
          });
        };
      })(this),
      duplicateTagClass: 'bounce',
      tags: tags
    });
    $('body').on('click', this.commitBuffer);
    $(this.taggle.getInput()).on('change', this.onTargetChange);
    return this.publishEvent(this.eventPrefix + ":redraw", {
      newText: '',
      collection: this.collection
    });
  };

  TagView.prototype.onCollectionChange = function() {
    this.newTaggle();
    return $(this.taggle.getInput()).focus();
  };

  TagView.prototype.onInviteRejected = function(data) {
    this.newTaggle();
    return $(this.taggle.getInput()).focus();
  };

  TagView.prototype.addDomListeners = function() {
    this.$targetEl.on('keydown', this.onKeyDown);
    return this.$targetEl.on('keyup', this.onKeyUp);
  };

  TagView.prototype.clearDomListeners = function() {
    this.$targetEl.off('keydown', this.onKeyDown);
    return this.$targetEl.off('keyup', this.onKeyUp);
  };

  TagView.prototype.onKeyDown = function(evnt) {
    var arrowMode, keycode, selectedTag;
    keycode = evnt.keyCode;
    arrowMode = this.getArrowMode();
    switch (keycode) {
      case 9:
        if (arrowMode === ARROW_MODES.TYPING) {
          this.taggle.add(this.getBufferText());
          evnt.stopImmediatePropagation();
          evnt.preventDefault();
          return false;
        } else {
          this.publishEvent(this.eventPrefix + ":tab-key", {
            jqEvent: evnt,
            tagView: this
          });
          return true;
        }
        break;
      case 13:
        if (this.getEnterKeyMode() === ENTERKEY_MODES.SUBMITTING) {
          this.taggle.add(this.getBufferText());
          evnt.stopImmediatePropagation();
          evnt.preventDefault();
          return false;
        } else {
          this.publishEvent(this.eventPrefix + ":enter-key", {
            jqEvent: evnt,
            tagView: this
          });
          return true;
        }
        break;
      case 27:
        this.publishEvent(this.eventPrefix + ":escape-key", {
          jqEvent: evnt,
          tagView: this
        });
        evnt.preventDefault();
        return false;
      case 32:
        this.taggle.add(this.getBufferText());
        return this.publishEvent(this.eventPrefix + ":space-bar", {
          jqEvent: evnt,
          tagView: this
        });
      case 37:
        if (arrowMode === ARROW_MODES.TYPING) {
          this.publishEvent(this.eventPrefix + ":arrow-left", {
            jqEvent: evnt,
            tagView: this
          });
          return true;
        } else {
          selectedTag = this.select(-1);
          this.publishEvent(this.eventPrefix + ":tag-selected", {
            jqEvent: evnt,
            tagText: selectedTag,
            tagView: this
          });
          evnt.preventDefault();
          return false;
        }
        break;
      case 38:
        this.publishEvent(this.eventPrefix + ":arrow-up", {
          jqEvent: evnt,
          tagView: this
        });
        evnt.preventDefault();
        return false;
      case 39:
        if (arrowMode === ARROW_MODES.TYPING) {
          this.publishEvent(this.eventPrefix + ":arrow-right", {
            jqEvent: evnt,
            tagView: this
          });
          return true;
        } else {
          selectedTag = this.select(1);
          this.publishEvent(this.eventPrefix + ":tag-selected", {
            jqEvent: evnt,
            tagText: selectedTag,
            tagView: this
          });
          evnt.preventDefault();
          return false;
        }
        break;
      case 40:
        this.publishEvent(this.eventPrefix + ":arrow-down", {
          jqEvent: evnt,
          tagView: this
        });
        evnt.preventDefault();
        return false;
    }
  };

  TagView.prototype.getArrowMode = function() {
    if (!!this.getBufferText() || (this.$targetEl.find("li").length === 1)) {
      return ARROW_MODES.TYPING;
    } else {
      return ARROW_MODES.SELECTING;
    }
  };

  TagView.prototype.getEnterKeyMode = function() {
    if (!this.getBufferText()) {
      return ENTERKEY_MODES.DEFAULT;
    } else {
      return ENTERKEY_MODES.SUBMITTING;
    }
  };

  TagView.prototype.getTags = function() {
    return this.taggle.getTags().values;
  };

  TagView.prototype.getTag = function(index) {
    var tags;
    tags = this.getTags();
    if (tags.length > index && index > 0) {
      return tags[index];
    } else {
      return null;
    }
  };

  TagView.prototype.onKeyUp = function(evnt) {
    var arrowMode, keycode;
    keycode = evnt.keyCode;
    arrowMode = this.getArrowMode();
    switch (keycode) {
      case 8:
        this.publishEvent(this.eventPrefix + ":delete-key", {
          jqEvent: evnt,
          tagView: this,
          inputValue: this.taggle.getInput().value
        });
        if (arrowMode === ARROW_MODES.TYPING) {
          return true;
        } else {
          evnt.stopImmediatePropagation();
          evnt.preventDefault();
          if (this.selectedTag) {
            this.taggle.remove(this.selectedTag);
            this.clearSelection();
          }
        }
        return false;
      case 9:
      case 13:
      case 27:
      case 37:
      case 38:
      case 39:
      case 40:
        return null;
      default:
        return this.bufferChange();
    }
  };

  TagView.prototype.onTargetChange = function(evnt) {
    return this.commitBuffer();
  };

  TagView.prototype.bufferChange = function() {
    var bufferText;
    bufferText = this.getBufferText();
    if (bufferText) {
      this.clearSelection();
    }
    return this.publishEvent(this.eventPrefix + ":new-text", {
      newText: bufferText,
      collection: this.collection
    });
  };

  TagView.prototype.commitBuffer = function() {
    var bufferText, tags;
    bufferText = this.getBufferText();
    tags = bufferText.split(' ');
    return tags.forEach((function(_this) {
      return function(tag) {
        return _this.taggle.add(tag);
      };
    })(this));
  };

  TagView.prototype.getBufferText = function() {
    var input;
    input = this.taggle.getInput();
    return $(input).val();
  };

  TagView.prototype.select = function(relativeIndex) {
    var index, tags, _base;
    tags = this.getTags();
    index = this.selectedIndex || tags.length + 1;
    index += relativeIndex;
    if (index >= (tags.length + 1)) {
      this.clearSelection();
      return null;
    }
    index = Math.max(1, index);
    this.$targetEl.find("li").removeClass('taggle_hot');
    this.selectedIndex = index;
    if (typeof (_base = this.$targetEl.find("li:nth-child(" + index + ")").addClass('taggle_hot').get(0)).scrollIntoView === "function") {
      _base.scrollIntoView(false);
    }
    return this.selectedTag = tags[index - 1];
  };

  TagView.prototype.clearSelection = function() {
    this.$targetEl.find("li").removeClass('taggle_hot');
    return this.selectedTag = this.selectedIndex = null;
  };

  TagView.prototype.renderAllItems = function() {
    return null;
  };

  TagView.prototype.renderItem = function() {
    return null;
  };

  TagView.prototype.initItemView = function() {
    return null;
  };

  TagView.prototype.itemAdded = function() {
    return null;
  };

  TagView.prototype.itemRemoved = function() {
    return null;
  };

  return TagView;

})(CollectionView);


},{"../lib/utils":156,"./base/collection-view":606,"jquery":774,"lodash":776}],727:[function(require,module,exports){
var ThumbnailView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../templates/thumbnail');

View = require('./base/view');

module.exports = ThumbnailView = (function(_super) {
  __extends(ThumbnailView, _super);

  function ThumbnailView() {
    return ThumbnailView.__super__.constructor.apply(this, arguments);
  }

  ThumbnailView.prototype.template = template;

  ThumbnailView.prototype.className = 'url-info-img';

  ThumbnailView.prototype.autoRender = true;

  ThumbnailView.prototype.listen = {
    'change model': 'render'
  };

  return ThumbnailView;

})(View);


},{"../templates/thumbnail":"ibXKH5","./base/view":608}],728:[function(require,module,exports){
var $, ActivityNotificationV, AuthToolbarView, BetaOptInView, DismissedTutorialM, NotificationDomainV, PrerenderView, ReportM, ToolbarView, WrongStumbleView, analytics, config, mediator, panel, profile, stumble, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

utils = require('../../lib/utils');

mediator = require('chaplin').mediator;

config = require('../../config');

ToolbarView = require('./toolbar-view');

$ = require('jquery');

stumble = require('../../lib/stumble');

panel = require('../../lib/panel');

PrerenderView = require('../prerender-view');

ActivityNotificationV = require('../activity-center/activity-notification-view');

NotificationDomainV = require('../notification-domain-view');

WrongStumbleView = require('../wrong-stumble/base-view');

ReportM = require('../../models/report-wrong-stumble-model');

DismissedTutorialM = require('../../models/dismissed-tutorial-model');

analytics = require('../../lib/analytics');

profile = require('../../lib/profile');

BetaOptInView = require('../beta-opt-in-view');

module.exports = AuthToolbarView = (function(_super) {
  __extends(AuthToolbarView, _super);

  function AuthToolbarView() {
    this.onReportDialogClosed = __bind(this.onReportDialogClosed, this);
    return AuthToolbarView.__super__.constructor.apply(this, arguments);
  }

  AuthToolbarView.prototype.canOpenReport = true;

  AuthToolbarView.prototype.events = {
    'click .stumble.button': 'stumble',
    'click .up.button:not(.disabled)': 'thumbUp',
    'click .down.button .down:not(.disabled)': 'thumbDown',
    'click .down.button .down-options:not(.disabled)': function(e) {
      return this.togglePanel(e, 'dropdown-thumbdown');
    },
    'touchclick .menu.button': function(e) {
      return this.togglePanel(e, 'dropdown-menu');
    },
    'touchclick .profile-arrow': 'routeToProfile',
    'touchclick .info.button:not(.disabled)': function(e) {
      return this.togglePanel(e, 'modes');
    },
    'touchclick .share.button:not(.disabled)': 'share',
    'click .addtolist.button:not(.disabled)': 'onAddToList',
    'click .got-it': 'onClickGotIt'
  };

  AuthToolbarView.prototype.listen = {
    'mode:activechanged mediator': 'onModeActiveChanged',
    'change:rating model': 'markRating',
    'stumble:thumbdown mediator': 'thumbDown',
    'stumble:wrongTopic mediator': 'wrongTopic',
    'stumble:blockdomain mediator': 'blockDomain',
    'stumble:activechanged mediator': 'onStumbleActiveChanged',
    'toolbar:rendered mediator': 'dispose',
    'menu:notification:click mediator': 'onActivityCenterClicked',
    'disable-toolbar-buttons mediator': 'onDisableButtons',
    'wrong-stumble:close:dialog mediator': 'onReportDialogClosed',
    'stumble:model:domain:success mediator': 'onDomainBlockSuccess',
    'login:model:domain:error mediator': 'onDomainBlockError'
  };

  AuthToolbarView.prototype.initialize = function() {
    var _ref;
    AuthToolbarView.__super__.initialize.apply(this, arguments);
    return (_ref = this.model) != null ? _ref.set('_tutorial', this.canLaunchTutorial()) : void 0;
  };

  AuthToolbarView.prototype.share = function(e) {
    if ($(e.target).parents('#dropdown-share-container').length === 0) {
      return this.togglePanel(e, ['dropdown-share', 'email-share', 'share']);
    }
  };

  AuthToolbarView.prototype.onDisableButtons = function() {
    $('.up.button').addClass('disabled');
    $('.up.button').tooltip();
    $('.up.button').tooltip('disable');
    $('.down.button').addClass('disabled');
    $('.down.button .down').addClass('disabled');
    $('.down.button .down-options').addClass('disabled');
    $('.down.button').tooltip();
    $('.down.button').tooltip('disable');
    $('.share.button').addClass('disabled');
    $('.share.button').tooltip();
    $('.share.button').tooltip('disable');
    $('.addtolist.button').addClass('disabled');
    $('.addtolist.button').tooltip();
    $('.addtolist.button').tooltip('disable');
    $('.info.button').addClass('disabled');
    $('.info.button').tooltip();
    return $('.info.button').tooltip('disable');
  };

  AuthToolbarView.prototype.onStumbleActiveChanged = function(activeStumble) {
    if (activeStumble == null) {
      return this.onDisableButtons();
    }
  };

  AuthToolbarView.prototype.initSubviews = function() {
    var nextM, _ref;
    AuthToolbarView.__super__.initSubviews.apply(this, arguments);
    nextM = (_ref = stumble.whereUnseen()) != null ? _ref.shift() : void 0;
    if (nextM && nextM.get('sponsored') !== true && !utils.isMobile()) {
      this.subview('prerender', new PrerenderView({
        nextGuessUrl: nextM.get('url')
      }));
    }
    this.subview('notification-domain', new NotificationDomainV({
      container: '#app-container',
      model: mediator.modesC.getActive()
    }));
    this.subview('activity-notification', new ActivityNotificationV({
      container: '.menu-notification',
      autoRender: true,
      model: mediator.activityNotificationM
    }));
    if (config.showBetaOptinView) {
      return this.subview = new BetaOptInView;
    }
  };

  AuthToolbarView.prototype.stumble = function(e) {
    var _ref;
    if (!(utils.isMobile() && !utils.isIpad())) {
      if (e != null) {
        if (typeof e.preventDefault === "function") {
          e.preventDefault();
        }
      }
      this.publishEvent('stumble:next', (_ref = this.model) != null ? _ref.get('urlid') : void 0);
      return this.hideMixOnboarding();
    }
  };

  AuthToolbarView.prototype.markRating = function() {
    var rating;
    if (this.model) {
      rating = this.model.get('rating');
      this.$el.find('.up').toggleClass('active', rating === 1);
      return this.$el.find('.down').toggleClass('active', rating === -1);
    }
  };

  AuthToolbarView.prototype.blockDomain = function() {
    if (this.model) {
      this.model.set('_domainBlocked', true);
      this.$el.find('.up').toggleClass('active', false);
      return this.$el.find('.down').toggleClass('active', true);
    }
  };

  AuthToolbarView.prototype.onDomainBlockSuccess = function() {
    return panel.displaySuccessMsg("You successfully blocked the domain! To unblock go to the Personalization tab in Settings.");
  };

  AuthToolbarView.prototype.onDomainBlockError = function(msg) {
    return panel.displayErrorMsg(msg);
  };

  AuthToolbarView.prototype.onModeActiveChanged = function() {
    this.render();
    return this.stumble();
  };

  AuthToolbarView.prototype.onAddToList = function(e) {
    var stumbleM;
    stumbleM = stumble.getCollection().getActive();
    if (stumbleM) {
      this.togglePanel(e, 'list');
    } else {
      panel.displayErrorMsg('Cannot add this page to a list');
    }
    return e.preventDefault();
  };

  AuthToolbarView.prototype.onAddedToDOM = function() {
    AuthToolbarView.__super__.onAddedToDOM.apply(this, arguments);
    if (this.model) {
      this.markRating();
      if ((this.model.get('_tutorial') === true) && (!utils.isSUBrowserAddonEnabled())) {
        return this.displayTutorial();
      } else {
        return this.displayMixOnboarding();
      }
    } else if (!utils.isSUBrowserAddonEnabled()) {
      return this.hideTutorial();
    }
  };

  AuthToolbarView.prototype.displayMixOnboarding = function() {
    return true;
  };

  AuthToolbarView.prototype.hideMixOnboarding = function() {
    $('.toolbar').removeClass('rc-invite');
    return $('body').addClass('rc-invite-hidden');
  };

  AuthToolbarView.prototype.canLaunchTutorial = function() {
    var dismissedTutorialModel;
    dismissedTutorialModel = new DismissedTutorialM;
    return !utils.isMobile() && (dismissedTutorialModel.getDismissedTutorial() === false);
  };

  AuthToolbarView.prototype.displayTutorial = function() {
    this.trackTutorialView();
    $('.toolbar').css('padding', 0);
    $('.toolbar').css('height', '215px');
    return $('#app-container').css('padding-top', '215px');
  };

  AuthToolbarView.prototype.trackTutorialView = _.once(function() {
    return analytics.trackEvent('tutorial:desktop-view', 1, {
      action: 'view'
    });
  });

  AuthToolbarView.prototype.hideTutorial = function() {
    $('.toolbar').css('height', '45px');
    $('#app-container').css('padding-top', '45px');
    $('.tutorial').css('display', 'none');
    return this.publishEvent('window:resize');
  };

  AuthToolbarView.prototype.onClickGotIt = function() {
    var dismissedTutorialModel, _ref;
    this.hideTutorial();
    if ((_ref = this.model) != null) {
      _ref.set('_tutorial', false);
    }
    dismissedTutorialModel = new DismissedTutorialM({
      userid: mediator.userM.get('userid'),
      dismissed_onboarding_tutorial: true
    });
    return dismissedTutorialModel.save();
  };

  AuthToolbarView.prototype.routeToProfile = function() {
    return Chaplin.utils.redirectTo({
      url: 'stumbler/' + mediator.userM.get('username')
    });
  };

  AuthToolbarView.prototype.wrongTopic = function() {
    var options, reportModel, urlid, _ref;
    if (this.canOpenReport) {
      this.canOpenReport = false;
      reportModel = new ReportM;
      urlid = (_ref = this.model) != null ? _ref.get('urlid') : void 0;
      options = {};
      options.data = {
        urlid: urlid
      };
      return reportModel.fetch(options).then((function(_this) {
        return function() {
          var div;
          reportModel.set('urlid', urlid);
          div = document.createElement("div");
          div.id = "wrong-stumble-container";
          document.body.appendChild(div);
          return _this.subview('wrong-stumble', new WrongStumbleView({
            container: $(document).find('#wrong-stumble-container'),
            model: reportModel
          }));
        };
      })(this));
    }
  };

  AuthToolbarView.prototype.onReportDialogClosed = function() {
    return this.canOpenReport = true;
  };

  AuthToolbarView.prototype.thumbUp = _.debounce(function() {
    if (!this.model) {
      return;
    }
    if (!$('body').hasClass('onboarding')) {
      panel.close();
    }
    if (this.model.get('rating') === 1) {
      this.model.set('rating', 0);
    } else {
      this.model.set('rating', 1);
    }
    return profile.setIdentityModel({
      username: mediator.userM.get('username'),
      reset: true
    });
  }, 1000, {
    leading: true,
    trailing: false
  });

  AuthToolbarView.prototype.thumbDown = _.debounce(function(options) {
    if (options == null) {
      options = {};
    }
    if (!this.model) {
      return;
    }
    if (this.model.get('rating') === -1 && options.force !== true) {
      this.model.set('rating', 0);
    } else {
      if (options.subrating) {
        this.model.set('subrating', options.subrating);
      } else {
        this.model.set('subrating', null);
      }
      this.model.set('rating', -1);
    }
    return profile.setIdentityModel({
      username: mediator.userM.get('username'),
      reset: true
    });
  }, 1000, {
    leading: true,
    trailing: false
  });

  return AuthToolbarView;

})(ToolbarView);


},{"../../config":2,"../../lib/analytics":116,"../../lib/panel":125,"../../lib/profile":126,"../../lib/stumble":130,"../../lib/utils":156,"../../models/dismissed-tutorial-model":173,"../../models/report-wrong-stumble-model":224,"../activity-center/activity-notification-view":599,"../beta-opt-in-view":609,"../notification-domain-view":667,"../prerender-view":670,"../wrong-stumble/base-view":748,"./toolbar-view":730,"chaplin":773,"jquery":774,"lodash":776}],729:[function(require,module,exports){
var $, StaticToolbarView, ToolbarView, mediator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

mediator = require('chaplin').mediator;

ToolbarView = require('./toolbar-view');

template = require('../../templates/toolbar/static-toolbar');

module.exports = StaticToolbarView = (function(_super) {
  __extends(StaticToolbarView, _super);

  function StaticToolbarView() {
    return StaticToolbarView.__super__.constructor.apply(this, arguments);
  }

  StaticToolbarView.prototype.template = template;

  StaticToolbarView.prototype.className = 'toolbar static-toolbar';

  StaticToolbarView.prototype.events = {
    'click .stumble.button': 'stumble'
  };

  StaticToolbarView.prototype.initialize = function(params) {
    StaticToolbarView.__super__.initialize.apply(this, arguments);
    if (!(params != null ? params.noScroll : void 0)) {
      return $('body').css('overflow-y', 'scroll');
    }
  };

  StaticToolbarView.prototype.dispose = function() {
    $('body').css('overflow', '');
    return StaticToolbarView.__super__.dispose.apply(this, arguments);
  };

  StaticToolbarView.prototype.stumble = function() {
    return window.location.href = '/su/';
  };

  return StaticToolbarView;

})(ToolbarView);


},{"../../templates/toolbar/static-toolbar":"nTShuv","./toolbar-view":730,"chaplin":773,"jquery":774}],730:[function(require,module,exports){
var $, GlassView, LikersCollection, LikersPreviewModel, LikersPreviewView, PlaceholderLikersView, StumbleView, ToolbarView, View, analytics, mediator, panel, root, storage, template, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

View = require('../base/view');

StumbleView = require('../stumble-view');

storage = require('simple-storage');

utils = require('../../lib/utils');

mediator = require('chaplin').mediator;

template = require('../../templates/toolbar/toolbar');

root = require('../../lib/root');

analytics = require('../../lib/analytics');

$ = require('jquery');

panel = require('../../lib/panel');

GlassView = require('../glass-view');

LikersCollection = require('../../models/likers-collection');

LikersPreviewModel = require('../../models/likers-preview-model');

LikersPreviewView = require('../likers-preview-view');

PlaceholderLikersView = require('../placeholder-likers-view');

module.exports = ToolbarView = (function(_super) {
  __extends(ToolbarView, _super);

  function ToolbarView() {
    return ToolbarView.__super__.constructor.apply(this, arguments);
  }

  ToolbarView.prototype.events = {
    'click #mix-onboard-button': function() {
      return this.goMixOnboard('spa-toolbar');
    }
  };

  ToolbarView.prototype.listen = {
    'stumble:next mediator': function() {
      return this.toggleLoading(true);
    },
    'stumble:loaded mediator': function() {
      return this.toggleLoading(false, 0);
    },
    'stumble:prepainttimeout mediator': function() {
      return this.toggleLoading(false, 0);
    },
    'settings:profile:save:success mediator': 'profileChanged',
    'addedToDOM': 'onAddedToDOM'
  };

  ToolbarView.prototype.autoRender = true;

  ToolbarView.prototype.region = 'toolbar';

  ToolbarView.prototype.className = 'toolbar container';

  ToolbarView.prototype.template = template;

  ToolbarView.prototype.announceEvents = 'toolbar';

  ToolbarView.prototype.togglePanel = function(e, name, options) {
    if (e != null) {
      if (typeof e.preventDefault === "function") {
        e.preventDefault();
      }
    }
    return panel.toggle(name, options);
  };

  ToolbarView.prototype.initSubviews = function() {
    this.createStumbleView();
    this.subview('glass', new GlassView);
    return this.initializeLikersSubview();
  };

  ToolbarView.prototype.createStumbleView = function() {
    return this.subview('stumble', new StumbleView({
      model: this.model
    }));
  };

  ToolbarView.prototype.initializeLikersSubview = function() {
    var likersC, options, _ref;
    this.subview('placeholder-liker', new PlaceholderLikersView({
      container: this.$el.find('.likers-toolbar-view')
    }));
    options = {};
    options.data = {
      urlid: (_ref = this.model) != null ? _ref.get('urlid') : void 0
    };
    likersC = new LikersCollection;
    return likersC.fetch(options).then((function(_this) {
      return function() {
        var likersPreviewM, placeholderView, total, _ref1;
        total = (_ref1 = _this.model) != null ? _ref1.get('likes') : void 0;
        if (total) {
          likersC.set(likersC.spliceFirst(5));
          likersPreviewM = new LikersPreviewModel({
            likersC: likersC,
            remainder: likersC.getTotalRemainder(total)
          });
          placeholderView = _this.subview('placeholder-liker');
          if (placeholderView) {
            _this.removeSubview(placeholderView);
          }
          return _this.subview('likers-toolbar-view', new LikersPreviewView({
            container: _this.$el.find('.likers-toolbar-view'),
            model: likersPreviewM
          }));
        }
      };
    })(this));
  };

  ToolbarView.prototype.toggleLoading = function(force, delay) {
    if (delay == null) {
      delay = 250;
    }
    return this.setTimeout((function(_this) {
      return function() {
        var _ref;
        return (_ref = _this.$el) != null ? _ref.find('.icon.stumble').toggleClass('loading', force) : void 0;
      };
    })(this), delay);
  };

  ToolbarView.prototype.onAddedToDOM = function() {
    if (utils.isSUBrowserAddonEnabled() && (!mediator.overrideBrowserAddonEnabled)) {
      $('body').addClass('extension-enabled');
    }
    if (this.model) {
      this.initSubviews();
      return this.setTimeout((function(_this) {
        return function() {
          return _this.toggleLoading(false);
        };
      })(this), '1s');
    }
  };

  ToolbarView.prototype.onActivityCenterClicked = function() {
    var _ref;
    if ((_ref = this.model) != null ? _ref.get('_conversationM') : void 0) {
      return panel.open('conversation', {
        conversationM: this.model.get('_conversationM'),
        position: 'right'
      });
    } else {
      return panel.open('activity-center', {
        position: 'right'
      });
    }
  };

  ToolbarView.prototype.render = function() {
    var stumbleView;
    ToolbarView.__super__.render.apply(this, arguments);
    stumbleView = this.subview('stumble');
    if (stumbleView && stumbleView.isLoaded()) {
      return this.toggleLoading(false);
    }
  };

  ToolbarView.prototype.profileChanged = function(profileModel) {
    this.$el.find(".profile-thumb").attr('src', profileModel.pictureUrl);
    return this.$el.find(".username").text(profileModel.username);
  };

  return ToolbarView;

})(View);


},{"../../lib/analytics":116,"../../lib/panel":125,"../../lib/root":129,"../../lib/utils":156,"../../models/likers-collection":190,"../../models/likers-preview-model":191,"../../templates/toolbar/toolbar":"JW/nJo","../base/view":608,"../glass-view":649,"../likers-preview-view":655,"../placeholder-likers-view":669,"../stumble-view":718,"chaplin":773,"jquery":774,"lodash":776,"simple-storage":780}],731:[function(require,module,exports){
var $, FacebookConnectModel, ToolbarView, VisitorToolbarView, analytics, mediator, template, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

_ = require('lodash');

analytics = require('../../lib/analytics');

utils = require('../../lib/utils');

mediator = require('chaplin').mediator;

ToolbarView = require('./toolbar-view');

template = require('../../templates/toolbar/visitor-toolbar');

FacebookConnectModel = require('../../models/facebook-connect-model');

module.exports = VisitorToolbarView = (function(_super) {
  __extends(VisitorToolbarView, _super);

  function VisitorToolbarView() {
    this.launch_app_or_alt_url = __bind(this.launch_app_or_alt_url, this);
    this.intervalHeartbeat = __bind(this.intervalHeartbeat, this);
    this.clearTimers = __bind(this.clearTimers, this);
    return VisitorToolbarView.__super__.constructor.apply(this, arguments);
  }

  VisitorToolbarView.prototype.template = template;

  VisitorToolbarView.prototype.className = 'toolbar visitor-toolbar';

  VisitorToolbarView.prototype.timer = void 0;

  VisitorToolbarView.prototype.heartbeat = void 0;

  VisitorToolbarView.prototype.lastInterval = void 0;

  VisitorToolbarView.prototype.events = {
    'click .stumble.button': 'nextStumble',
    'click .fb-connect': 'onFbConnect',
    'click .get-app-btn': 'onClickGetApp',
    'pageshow': 'clearTimers',
    'pagehide': 'clearTimers'
  };

  VisitorToolbarView.prototype.listen = {
    'fb:model:signup:error mediator': 'displayFacebookFail'
  };

  VisitorToolbarView.prototype.facebookRerequest = false;

  VisitorToolbarView.prototype.initialize = function(params) {
    VisitorToolbarView.__super__.initialize.apply(this, arguments);
    if (!(params != null ? params.noScroll : void 0)) {
      $('body').css('overflow-y', 'scroll');
    }
    if (!(params != null ? params.skipStumbleIncrement : void 0)) {
      mediator.visitorStumbleCount++;
    }
    $('#app-container').addClass('visitor-stumble');
    utils.facebookInitialize();
    if (mediator.visitorStumbleCount === 0) {
      return analytics.trackEvent('visitor:toolbar-view', 1, {
        action: 'view',
        label: 'visitor#showToolbar'
      });
    }
  };

  VisitorToolbarView.prototype.dispose = function() {
    $('body').css('overflow', '');
    return VisitorToolbarView.__super__.dispose.apply(this, arguments);
  };

  VisitorToolbarView.prototype.render = function() {
    var _ref, _ref1, _ref2;
    VisitorToolbarView.__super__.render.apply(this, arguments);
    if (utils.isMobile()) {
      if ((_ref = this.$el) != null) {
        _ref.find('.fb-connect').addClass('hidden');
      }
      if ((_ref1 = this.$el) != null) {
        _ref1.find('.get-app-btn').removeClass('hidden');
      }
      return (_ref2 = this.$el) != null ? _ref2.find('.inner-container').css('margin', '0 0 0 10px') : void 0;
    }
  };

  VisitorToolbarView.prototype.attach = function() {
    VisitorToolbarView.__super__.attach.apply(this, arguments);
    this.showStumble();
    return this.hidePageContainer();
  };

  VisitorToolbarView.prototype.hidePageContainer = function() {
    return this.setTimeout((function(_this) {
      return function() {
        return $('.page-container').remove();
      };
    })(this), 1200);
  };

  VisitorToolbarView.prototype.showStumble = function() {
    return this.setTimeout((function(_this) {
      return function() {
        $('.stumble-mask').css('opacity', '0');
        $('.loading-container').css('opacity', '0');
        return $('.pulse-logo').removeClass('animated pulse');
      };
    })(this), 2000);
  };

  VisitorToolbarView.prototype.nextStumble = function() {
    if (mediator.visitorStumbleCount < mediator.visitorStumbleCountMax) {
      return this.publishEvent('stumble:next', this);
    } else {
      return window.location.href = "/home?next=" + encodeURIComponent(window.location.href) + "&isVisitor=true";
    }
  };

  VisitorToolbarView.prototype.onFbConnect = function() {
    var facebookConnectM;
    facebookConnectM = new FacebookConnectModel({
      rerequest: this.facebookRerequest
    });
    return facebookConnectM.save();
  };

  VisitorToolbarView.prototype.displayFacebookFail = function(message) {
    this.facebookRerequest = true;
    this.displayTooltip('.fb-connect', message);
  };

  VisitorToolbarView.prototype.displayTooltip = function(attrId, message) {
    $(attrId).attr('container', 'body');
    $(attrId).attr('title', message).tooltip({
      trigger: 'manual',
      placement: 'bottom'
    }).tooltip('fixTitle').tooltip('show');
    $('#app-container .toolbar .inner-container').css('overflow', 'initial');
  };

  VisitorToolbarView.prototype.getTime = function() {
    return (new Date()).getTime();
  };

  VisitorToolbarView.prototype.clearTimers = function() {
    var _ref;
    if ((_ref = this.$el) != null) {
      _ref.find('.get-app-spin').addClass('hidden');
    }
    clearTimeout(this.timer);
    return clearTimeout(this.heartbeat);
  };

  VisitorToolbarView.prototype.intervalHeartbeat = function() {
    var diff, now;
    now = this.getTime();
    diff = now - this.lastInterval - 200;
    this.lastInterval = now;
    if (diff > 500) {
      return this.clearTimers();
    }
  };

  VisitorToolbarView.prototype.launch_app_or_alt_url = function() {
    var _ref, _ref1;
    this.lastInterval = this.getTime();
    this.heartbeat = setInterval(this.intervalHeartbeat, 200);
    this.timer = setTimeout(((function(_this) {
      return function() {
        if (!(document.hidden || document.webkitHidden)) {
          document.location = utils.getAppStoreLink();
        }
        return _this.clearTimers();
      };
    })(this)), 1500);
    return document.location = utils.getAppLink((_ref = this.model) != null ? (_ref1 = _ref.attributes) != null ? _ref1.urlid : void 0 : void 0);
  };

  VisitorToolbarView.prototype.onClickGetApp = function(event) {
    var _ref;
    if ((_ref = this.$el) != null) {
      _ref.find('.get-app-spin').removeClass('hidden');
    }
    this.launch_app_or_alt_url();
    return event.preventDefault();
  };

  return VisitorToolbarView;

})(ToolbarView);


},{"../../lib/analytics":116,"../../lib/utils":156,"../../models/facebook-connect-model":178,"../../templates/toolbar/visitor-toolbar":"cSFr39","./toolbar-view":730,"chaplin":773,"jquery":774,"lodash":776}],732:[function(require,module,exports){
var FollowInterestButtonView, UrlHeadingView, View, template, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/url-heading');

FollowInterestButtonView = require('./follow-interest-button-view');

utils = require('../lib/utils');

_ = require('lodash');

module.exports = UrlHeadingView = (function(_super) {
  __extends(UrlHeadingView, _super);

  function UrlHeadingView() {
    return UrlHeadingView.__super__.constructor.apply(this, arguments);
  }

  UrlHeadingView.prototype.autoRender = true;

  UrlHeadingView.prototype.template = template;

  UrlHeadingView.prototype.className = 'url-heading-view';

  UrlHeadingView.prototype.events = {
    'click [data-id=stumble-interest-btn]': 'onClickStumbleInterest'
  };

  UrlHeadingView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  UrlHeadingView.prototype.initialize = function(options) {
    UrlHeadingView.__super__.initialize.apply(this, arguments);
    this.model.set('_canFollow', !utils.isVisitor());
    return this.myInterestsModel = options != null ? options.myInterestsModel : void 0;
  };

  UrlHeadingView.prototype.onClickStumbleInterest = function() {
    var modeInfo;
    if (utils.isVisitor()) {
      return this.publishEvent('stumble:next');
    } else {
      modeInfo = {
        name: name,
        _mode: 'topic',
        id: this.model.get('id')
      };
      Chaplin.mediator.modesC.add(_.extend(modeInfo));
      return Chaplin.mediator.modesC.setActive(this.model.get('name'));
    }
  };

  UrlHeadingView.prototype.onAddedToDOM = function() {
    if (this.model.get('_canFollow')) {
      return this.subview('follow-btn', new FollowInterestButtonView({
        container: this.$el.find('.following-container'),
        model: this.model,
        myInterestsModel: this.myInterestsModel,
        _onlyHeaderReset: false
      }));
    }
  };

  return UrlHeadingView;

})(View);


},{"../lib/utils":156,"../templates/url-heading":"jMtiWN","./base/view":608,"./follow-interest-button-view":645,"lodash":776}],733:[function(require,module,exports){
var UrlInfoIdentityView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/url-info-identity');

module.exports = UrlInfoIdentityView = (function(_super) {
  __extends(UrlInfoIdentityView, _super);

  function UrlInfoIdentityView() {
    return UrlInfoIdentityView.__super__.constructor.apply(this, arguments);
  }

  UrlInfoIdentityView.prototype.autoRender = true;

  UrlInfoIdentityView.prototype.template = template;

  UrlInfoIdentityView.prototype.className = 'url-info-identity-view';

  UrlInfoIdentityView.prototype.initialize = function() {
    UrlInfoIdentityView.__super__.initialize.apply(this, arguments);
    return this.setThumbnail();
  };

  UrlInfoIdentityView.prototype.setThumbnail = function() {
    var thumbnail;
    thumbnail = this.model.get('thumbnail') || "";
    if (!thumbnail) {
      thumbnail = 'https://nb9-stumbleupon.netdna-ssl.com/WcjiEMsHQiBUV9Q-ZK4lDg';
    }
    return this.model.set('_thumbnail', thumbnail);
  };

  return UrlInfoIdentityView;

})(View);


},{"../templates/url-info-identity":"gR/Mei","./base/view":608}],734:[function(require,module,exports){
var $, CollectionView, LikersItemView, LoadingListView, UrlInfoLikersView, mediator, template, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('./base/collection-view');

mediator = require('chaplin').mediator;

LoadingListView = require('./loading-list-view');

LikersItemView = require('./stumbler-item-view');

template = require('../templates/stumblers');

_ = require('lodash');

$ = require('jquery');

module.exports = UrlInfoLikersView = (function(_super) {
  __extends(UrlInfoLikersView, _super);

  function UrlInfoLikersView() {
    return UrlInfoLikersView.__super__.constructor.apply(this, arguments);
  }

  UrlInfoLikersView.prototype.autoRender = true;

  UrlInfoLikersView.prototype.itemView = LikersItemView;

  UrlInfoLikersView.prototype.className = 'stumblers-view';

  UrlInfoLikersView.prototype.template = template;

  UrlInfoLikersView.prototype.listSelector = '.stumbler-content';

  UrlInfoLikersView.prototype.urlid = '';

  UrlInfoLikersView.prototype.pageSize = 25;

  UrlInfoLikersView.prototype.initialize = function(options) {
    UrlInfoLikersView.__super__.initialize.apply(this, arguments);
    this.pageSize = mediator.profileItemsPerPage;
    return this.urlid = options != null ? options.urlid : void 0;
  };

  UrlInfoLikersView.prototype.renderAllItems = function() {
    UrlInfoLikersView.__super__.renderAllItems.apply(this, arguments);
    if (!this.subview('loading-indicator')) {
      this.subview('loading-indicator', new LoadingListView({
        collection: this.collection,
        container: this.$el.find('.loading-container')
      }));
    }
    if (this.collection._fetchedOnce) {
      this.$el.find('.loading-indicator').hide();
      if (this.collection.length === 0) {
        return this.$el.find('.empty-list-container').show();
      }
    }
  };

  UrlInfoLikersView.prototype.getScrollElement = function() {
    return this.$el.parent();
  };

  UrlInfoLikersView.prototype.getRequestMixin = function() {
    return {
      urlid: this.urlid
    };
  };

  return UrlInfoLikersView;

})(CollectionView);


},{"../templates/stumblers":"kb3pIP","./base/collection-view":606,"./loading-list-view":660,"./stumbler-item-view":720,"chaplin":773,"jquery":774,"lodash":776}],735:[function(require,module,exports){
var $, IdentityM, LikersCollection, ReportM, UrlInfoIdentityView, UrlInfoLikersView, UrlInfoView, UrlRequeueM, View, ViewDecorator, WrongStumbleView, template,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/url-info');

UrlInfoIdentityView = require('./url-info-identity-view');

UrlInfoLikersView = require('./url-info-likers-view');

WrongStumbleView = require('./wrong-stumble/base-view');

IdentityM = require('../models/identity-model');

ReportM = require('../models/report-wrong-stumble-model');

LikersCollection = require('../models/likers-collection');

ViewDecorator = require('../views/decorators/decorator');

UrlRequeueM = require('../models/url-requeue-model');

$ = require('jquery');

module.exports = UrlInfoView = (function(_super) {
  __extends(UrlInfoView, _super);

  function UrlInfoView() {
    this.requeueForSurveyor = __bind(this.requeueForSurveyor, this);
    this.onReportDialogClosed = __bind(this.onReportDialogClosed, this);
    return UrlInfoView.__super__.constructor.apply(this, arguments);
  }

  UrlInfoView.prototype.autoRender = true;

  UrlInfoView.prototype.className = 'url-info fluid-container';

  UrlInfoView.prototype.template = template;

  UrlInfoView.prototype.region = 'content';

  UrlInfoView.prototype.canOpenReport = true;

  UrlInfoView.prototype.events = {
    'click .report': 'onClickReport',
    'click #requeue-for-surveyor': 'requeueForSurveyor'
  };

  UrlInfoView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM',
    'wrong-stumble:close:dialog mediator': 'onReportDialogClosed'
  };

  UrlInfoView.prototype.initialize = function() {
    var discovererId, identityM, options, _ref;
    UrlInfoView.__super__.initialize.apply(this, arguments);
    identityM = new IdentityM;
    discovererId = (_ref = this.model) != null ? _ref.get('discoverer_id') : void 0;
    if (discovererId > 0) {
      options = {};
      options.data = {
        id: discovererId
      };
      return identityM.fetch(options).then((function(_this) {
        return function(data) {
          var _ref1;
          identityM.set(data);
          return _this.subview('url-info-identity', new UrlInfoIdentityView({
            container: (_ref1 = _this.$el) != null ? _ref1.find('#url-info-identity') : void 0,
            model: identityM
          }));
        };
      })(this));
    }
  };

  UrlInfoView.prototype.onAddedToDOM = function() {
    return this.displayLikersView();
  };

  UrlInfoView.prototype.displayLikersView = function() {
    var likersC, options, urlid, _ref;
    urlid = (_ref = this.model) != null ? _ref.get('urlid') : void 0;
    options = {};
    options.data = {
      urlid: urlid
    };
    likersC = new LikersCollection;
    return likersC.fetch(options).then((function(_this) {
      return function() {
        var LikersViewConstructor, _ref1;
        LikersViewConstructor = ViewDecorator.makeContinuouslyScrollable(UrlInfoLikersView);
        return _this.subview('info-likers', new LikersViewConstructor({
          container: (_ref1 = _this.$el) != null ? _ref1.find('#stumblers-container') : void 0,
          collection: likersC,
          urlid: urlid
        }));
      };
    })(this));
  };

  UrlInfoView.prototype.onClickReport = function() {
    var options, reportModel, urlid, _ref;
    if (this.canOpenReport) {
      this.canOpenReport = false;
      reportModel = new ReportM;
      urlid = (_ref = this.model) != null ? _ref.get('urlid') : void 0;
      options = {};
      options.data = {
        urlid: urlid
      };
      return reportModel.fetch(options).then((function(_this) {
        return function() {
          var div;
          reportModel.set('urlid', urlid);
          div = document.createElement("div");
          div.id = "wrong-stumble-container";
          document.body.appendChild(div);
          return _this.subview('wrong-stumble', new WrongStumbleView({
            container: $(document).find('#wrong-stumble-container'),
            model: reportModel
          }));
        };
      })(this));
    }
  };

  UrlInfoView.prototype.onReportDialogClosed = function() {
    return this.canOpenReport = true;
  };

  UrlInfoView.prototype.requeueForSurveyor = function(jqEvent) {
    var urlRequeueModel, urlid, _ref;
    jqEvent.preventDefault();
    urlid = (_ref = this.model) != null ? _ref.get('urlid') : void 0;
    urlRequeueModel = new UrlRequeueM({
      urlid: urlid
    });
    urlRequeueModel.save();
    return false;
  };

  return UrlInfoView;

})(View);


},{"../models/identity-model":186,"../models/likers-collection":190,"../models/report-wrong-stumble-model":224,"../models/url-requeue-model":253,"../templates/url-info":"3++Z21","../views/decorators/decorator":629,"./base/view":608,"./url-info-identity-view":733,"./url-info-likers-view":734,"./wrong-stumble/base-view":748,"jquery":774}],736:[function(require,module,exports){
var AddToListView, DropdownShareView, UrlItemView, View, template, user,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('./base/view');

template = require('../templates/url-tile');

DropdownShareView = require('./dropdown-share-view');

AddToListView = require('./profile/profile-addtolist-view');

user = require('../lib/user');

module.exports = UrlItemView = (function(_super) {
  __extends(UrlItemView, _super);

  function UrlItemView() {
    return UrlItemView.__super__.constructor.apply(this, arguments);
  }

  UrlItemView.prototype.className = 'list-item';

  UrlItemView.prototype.template = template;

  UrlItemView.prototype.listen = {
    'change model': 'render'
  };

  UrlItemView.prototype.events = {
    'click [data-id="item-share-btn"]': 'onShareClick',
    'click [data-id="item-add-btn"]': 'onAddClick'
  };

  UrlItemView.prototype.removeAddToList = function() {
    if (this.subview('addtolist')) {
      return this.removeSubview('addtolist');
    }
  };

  UrlItemView.prototype.removeShare = function() {
    if (this.subview('shareitem')) {
      return this.removeSubview('shareitem');
    }
  };

  UrlItemView.prototype.removeSubviews = function() {
    this.removeAddToList();
    return this.removeShare();
  };

  UrlItemView.prototype.onShareClick = function() {
    if (this.subview('shareitem') && !this.subview('shareitem').disposed) {
      return this.removeShare();
    } else {
      this.removeSubviews();
      return this.subview('shareitem', new DropdownShareView({
        container: this.$el.find('.dropdown-container'),
        model: this.model
      }));
    }
  };

  UrlItemView.prototype.onAddClick = function(e) {
    if (this.subview('addtolist') && !this.subview('addtolist').disposed) {
      return this.removeAddToList();
    } else {
      this.removeSubviews();
      return this.subview('addtolist', new AddToListView({
        container: this.$el.find('.addtolist-container'),
        collection: user.getCurrentUserLists(),
        model: this.model,
        relateToSelector: this.$el.find("[data-id=item-add-btn]")
      }));
    }
  };

  return UrlItemView;

})(View);


},{"../lib/user":155,"../templates/url-tile":"v+GOEy","./base/view":608,"./dropdown-share-view":633,"./profile/profile-addtolist-view":683}],737:[function(require,module,exports){
var $, CollectionView, HeadingV, ListItemV, UrlsView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('./base/collection-view');

HeadingV = require('./url-heading-view');

ListItemV = require('./url-view');

template = require('../templates/url-list');

$ = require('jquery');

module.exports = UrlsView = (function(_super) {
  __extends(UrlsView, _super);

  function UrlsView() {
    return UrlsView.__super__.constructor.apply(this, arguments);
  }

  UrlsView.prototype.itemView = ListItemV;

  UrlsView.prototype.autoRender = true;

  UrlsView.prototype.renderItems = true;

  UrlsView.prototype.className = 'urls-view';

  UrlsView.prototype.template = template;

  UrlsView.prototype.listSelector = '.list-content';

  UrlsView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  UrlsView.prototype.initialize = function(options) {
    UrlsView.__super__.initialize.apply(this, arguments);
    this.interestId = this.model.get('id');
    this.myInterestsModel = options != null ? options.myInterestsModel : void 0;
    return $("#content-container").addClass('urls-view-container');
  };

  UrlsView.prototype.dispose = function() {
    $("#content-container").removeClass('urls-view-container');
    return UrlsView.__super__.dispose.apply(this, arguments);
  };

  UrlsView.prototype.onAddedToDOM = function(evnt) {
    this.subview('heading-view', new HeadingV({
      model: this.model,
      container: this.$el.find('.list-heading.heading-container'),
      containerMethod: 'append',
      myInterestsModel: this.myInterestsModel
    }));
    return this.subview();
  };

  return UrlsView;

})(CollectionView);


},{"../templates/url-list":"791uzM","./base/collection-view":606,"./url-heading-view":732,"./url-view":736,"jquery":774}],738:[function(require,module,exports){
var $, ActionButtonView, View, template, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

$ = require('jquery');

template = require('../../templates/widgets/action-button');

View = require('../base/view');


/**
a widget view for action buttons

the consumer should pass an ActionButtonModel and listen for changes to it's 'clicked' property.
 */

module.exports = ActionButtonView = (function(_super) {
  __extends(ActionButtonView, _super);

  function ActionButtonView() {
    return ActionButtonView.__super__.constructor.apply(this, arguments);
  }

  ActionButtonView.prototype.autoRender = true;

  ActionButtonView.prototype.className = 'action-button-view';

  ActionButtonView.prototype.template = template;

  ActionButtonView.prototype.events = {
    'click .btn': 'onBtnClick'
  };

  ActionButtonView.prototype.listen = {
    'change model': 'render'
  };

  ActionButtonView.prototype.render = function(evnt) {
    ActionButtonView.__super__.render.apply(this, arguments);
    if (this.model.getTooltip()) {
      return this.$el.find('[data-toggle=tooltip]').tooltip();
    }
  };

  ActionButtonView.prototype.dispose = function() {
    return this.$el.find('[data-toggle=tooltip]').tooltip('destroy');
  };

  ActionButtonView.prototype.onBtnClick = function(evnt) {
    return this.model.setClicked(true);
  };

  return ActionButtonView;

})(View);


},{"../../templates/widgets/action-button":"nq9eAH","../base/view":608,"jquery":774,"lodash":776}],739:[function(require,module,exports){
var $, ActionButtonView, ActionButtonsView, CollectionView, storage, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

CollectionView = require('../base/collection-view');

ActionButtonView = require('./action-button-view');

template = require('../../templates/widgets/action-buttons');

$ = require('jquery');

storage = require('simple-storage');

module.exports = ActionButtonsView = (function(_super) {
  __extends(ActionButtonsView, _super);

  function ActionButtonsView() {
    return ActionButtonsView.__super__.constructor.apply(this, arguments);
  }

  ActionButtonsView.prototype.autoRender = true;

  ActionButtonsView.prototype.itemView = ActionButtonView;

  ActionButtonsView.prototype.listSelector = '.action-btns';

  ActionButtonsView.prototype.template = template;

  return ActionButtonsView;

})(CollectionView);


},{"../../templates/widgets/action-buttons":"b5bLFN","../base/collection-view":606,"./action-button-view":738,"jquery":774,"simple-storage":780}],740:[function(require,module,exports){
var DroplistOptionView, View, template,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/widgets/droplist-option');

module.exports = DroplistOptionView = (function(_super) {
  __extends(DroplistOptionView, _super);

  function DroplistOptionView() {
    this.onSelectableOptionClick = __bind(this.onSelectableOptionClick, this);
    this.onModelChange = __bind(this.onModelChange, this);
    return DroplistOptionView.__super__.constructor.apply(this, arguments);
  }

  DroplistOptionView.prototype.autoRender = true;

  DroplistOptionView.prototype.template = template;

  DroplistOptionView.prototype.tagName = 'li';

  DroplistOptionView.prototype.listen = {
    'change model': 'onModelChange'
  };

  DroplistOptionView.prototype.events = {
    'click .selectableOption': 'onSelectableOptionClick'
  };

  DroplistOptionView.prototype.initialize = function(options) {
    DroplistOptionView.__super__.initialize.apply(this, arguments);
    return this.eventPrefix = options.eventPrefix || 'autofilter';
  };

  DroplistOptionView.prototype.onModelChange = function() {
    this.render();
    if (this.model.get('_highlighted')) {
      return this.$el.find('a').focus();
    }
  };

  DroplistOptionView.prototype.onSelectableOptionClick = function(evnt) {
    return this.model.setSelected(true);
  };

  return DroplistOptionView;

})(View);


},{"../../templates/widgets/droplist-option":"B5PV0U","../base/view":608}],741:[function(require,module,exports){
var CollectionView, DroplistView, ItemV, template, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = require('lodash');

template = require('../../templates/widgets/droplist');

CollectionView = require('../base/collection-view');

ItemV = require('./droplist-option-view');


/** a class designed to be used as a subview of the autofilter view */

module.exports = DroplistView = (function(_super) {
  __extends(DroplistView, _super);

  function DroplistView() {
    this.onCollectionSync = __bind(this.onCollectionSync, this);
    return DroplistView.__super__.constructor.apply(this, arguments);
  }

  DroplistView.prototype.autoRender = true;

  DroplistView.prototype.itemView = ItemV;

  DroplistView.prototype.template = template;

  DroplistView.prototype.listSelector = '.dropdown-menu';

  DroplistView.prototype.listen = {
    'sync collection': 'onCollectionSync',
    'set collection': 'onCollectionSync'
  };

  DroplistView.prototype.initialize = function(options) {
    DroplistView.__super__.initialize.apply(this, arguments);
    this.datalistId = options.id + "-datalist";
    return this.eventPrefix = options.eventPrefix || 'autofilter';
  };

  DroplistView.prototype.initItemView = function(model) {
    return new this.itemView({
      model: model,
      eventPrefix: this.eventPrefix
    });
  };

  DroplistView.prototype.getTemplateData = function() {
    return {
      id: this.datalistId
    };
  };

  DroplistView.prototype.getFilterText = function() {
    return this._filterText || '';
  };

  DroplistView.prototype.open = function() {
    return this.$el.addClass('open');
  };

  DroplistView.prototype.close = function() {
    this.collection.unhighlightAll();
    return this.$el.removeClass('open');
  };

  DroplistView.prototype.onCollectionSync = function() {
    return this.render();
  };

  return DroplistView;

})(CollectionView);


},{"../../templates/widgets/droplist":"RCUi24","../base/collection-view":606,"./droplist-option-view":740,"lodash":776}],742:[function(require,module,exports){
var CollectionView, ItemSelectionView, ItemView, ViewDecorator, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

template = require('../../templates/widgets/item-selection');

CollectionView = require('../base/collection-view');

ItemView = require('../base/view');

ViewDecorator = require('../decorators/decorator');


/*
 * This is a generic view to manage selection of items.
 */

module.exports = ItemSelectionView = (function(_super) {
  __extends(ItemSelectionView, _super);

  function ItemSelectionView() {
    return ItemSelectionView.__super__.constructor.apply(this, arguments);
  }

  ItemSelectionView.prototype.autoRender = true;

  ItemSelectionView.prototype.className = 'item-selection three-column';

  ItemSelectionView.prototype.containerMethod = 'html';

  ItemSelectionView.prototype.itemView = ViewDecorator.makeCheckable(ItemView);

  ItemSelectionView.prototype.listSelector = '.items-container';

  ItemSelectionView.prototype.template = template;

  return ItemSelectionView;

})(CollectionView);


},{"../../templates/widgets/item-selection":"7YrkBc","../base/collection-view":606,"../base/view":608,"../decorators/decorator":629}],743:[function(require,module,exports){
var ActionButtonView, NavButtonView, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ActionButtonView = require('./action-button-view');

template = require('../../templates/widgets/nav-button');

module.exports = NavButtonView = (function(_super) {
  __extends(NavButtonView, _super);

  function NavButtonView() {
    return NavButtonView.__super__.constructor.apply(this, arguments);
  }

  NavButtonView.prototype.tagName = 'li';

  NavButtonView.prototype.className = 'btn';

  NavButtonView.prototype.template = template;

  NavButtonView.prototype.events = {
    'click': 'onBtnClick'
  };

  NavButtonView.prototype.render = function() {
    NavButtonView.__super__.render.apply(this, arguments);
    if (this.model.getId()) {
      this.$el.attr('id', this.model.getId());
    }
    this.$el.addClass((function(_this) {
      return function(index, currentClassName) {
        return currentClassName + " " + _this.model.getClassNames().join(" ");
      };
    })(this));
    this.$el.attr('disabled', this.model.getDisabled());
    return this.$el.toggleClass('selected', this.model.getSelected());
  };

  return NavButtonView;

})(ActionButtonView);


},{"../../templates/widgets/nav-button":"tvO3BP","./action-button-view":738}],744:[function(require,module,exports){
var $, ActionButtonsView, NavButtonView, NavButtonsView, template,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

ActionButtonsView = require('./action-buttons-view');

NavButtonView = require('./nav-button-view');

template = require('../../templates/widgets/nav-buttons');

$ = require('jquery');

module.exports = NavButtonsView = (function(_super) {
  __extends(NavButtonsView, _super);

  function NavButtonsView() {
    this.processNextScrollEvent = __bind(this.processNextScrollEvent, this);
    this.unlockScrolling = __bind(this.unlockScrolling, this);
    this.lockScrolling = __bind(this.lockScrolling, this);
    this.onScrollAttempt = __bind(this.onScrollAttempt, this);
    this.onWindowResize = __bind(this.onWindowResize, this);
    return NavButtonsView.__super__.constructor.apply(this, arguments);
  }

  NavButtonsView.prototype.autoRender = true;

  NavButtonsView.prototype.itemView = NavButtonView;

  NavButtonsView.prototype.className = 'nav-buttons-view';

  NavButtonsView.prototype.listSelector = '.nav-btns';

  NavButtonsView.prototype.template = template;

  NavButtonsView.prototype.scrollBarWidths = 40;

  NavButtonsView.prototype.events = {
    'click .scroller-right': 'onScrollAttempt',
    'click .scroller-left': 'onScrollAttempt'
  };

  NavButtonsView.prototype.listen = {
    'window:resize mediator': 'onWindowResize',
    'addedToDOM': 'onAddedToDOM',
    'change:clicked collection': 'onModelClicked'
  };

  NavButtonsView.prototype.initialize = function() {
    NavButtonsView.__super__.initialize.apply(this, arguments);
    this.scrollQ = [];
    return this.scrollLocked = false;
  };

  NavButtonsView.prototype.onAddedToDOM = function(evnt) {
    return this.reAdjust();
  };

  NavButtonsView.prototype.widthOfList = function() {
    var itemsWidth;
    itemsWidth = 0;
    this.$el.find('.list li').each(function() {
      var itemWidth;
      itemWidth = $(this).outerWidth();
      return itemsWidth += itemWidth;
    });
    return itemsWidth;
  };

  NavButtonsView.prototype.widthOfHidden = function() {
    return Math.abs(this.widthOfList() - this.widthOfContainer() - this.getLeftPosition());
  };

  NavButtonsView.prototype.widthOfContainer = function() {
    return this.$el.find('.wrapper').outerWidth() - this.scrollBarWidths;
  };

  NavButtonsView.prototype.getLeftPosition = function() {
    var _ref;
    return Math.abs(((_ref = this.$el.find('.list').position()) != null ? _ref.left : void 0) || 0);
  };

  NavButtonsView.prototype.reAdjust = function() {
    if ((this.$el.find('.wrapper').outerWidth()) < this.widthOfList()) {
      this.$el.find('.scroller-right').show();
    }
    if (this.getLeftPosition() < 0) {
      this.$el.find('.scroller-left').show();
    } else {
      this.$el.find('.item').animate({
        left: "-=" + this.getLeftPosition() + "px"
      }, 'slow');
    }
    return this.manageScrollButtonState();
  };

  NavButtonsView.prototype.onWindowResize = function() {
    return this.reAdjust();
  };

  NavButtonsView.prototype.onClickScrollerRight = function(evnt) {
    var diff, widthOfHidden;
    widthOfHidden = this.widthOfHidden();
    if (widthOfHidden > 0) {
      diff = Math.min(widthOfHidden, this.widthOfContainer());
      this.manageScrollButtonState(-diff);
      this.$el.find('.scroller-left').fadeIn('slow');
      return this.$el.find('.list').animate({
        left: "-=" + diff + "px"
      }, 'slow', function() {}).promise();
    } else {
      return this.$().promise();
    }
  };

  NavButtonsView.prototype.onClickScrollerLeft = function(evnt) {
    var diff, left;
    left = this.getLeftPosition();
    if (left > 0) {
      diff = Math.min(left, this.widthOfContainer());
      this.manageScrollButtonState(diff);
      this.$el.find('.scroller-right').fadeIn('slow');
      return this.$el.find('.list').animate({
        left: "+=" + diff + "px"
      }, 'slow', function() {}).promise();
    } else {
      return this.$().promise();
    }
  };

  NavButtonsView.prototype.onScrollAttempt = function(evnt) {
    this.scrollQ.push(evnt);
    return this.processNextScrollEvent();
  };

  NavButtonsView.prototype.lockScrolling = function() {
    return this.scrollLocked = true;
  };

  NavButtonsView.prototype.unlockScrolling = function() {
    return this.scrollLocked = false;
  };

  NavButtonsView.prototype.processNextScrollEvent = function() {
    var classes, ev;
    if (this.scrollQ.length > 0 && !this.scrollLocked) {
      ev = this.scrollQ.pop();
      classes = ev.currentTarget.classList;
      if (classes.contains('scroller-left')) {
        this.lockScrolling();
        return this.onClickScrollerLeft(ev).done(this.unlockScrolling).then(this.processNextScrollEvent);
      } else if (classes.contains('scroller-right')) {
        this.lockScrolling();
        return this.onClickScrollerRight(ev).done(this.unlockScrolling).then(this.processNextScrollEvent);
      }
    }
  };

  NavButtonsView.prototype.manageScrollButtonState = function(diff) {
    var leftPosition, widthOfHidden;
    if (diff == null) {
      diff = 0;
    }
    widthOfHidden = this.widthOfHidden() + diff;
    leftPosition = this.getLeftPosition() - diff;
    this.$el.find('.scroller-right').toggleClass('disabled', widthOfHidden <= 0);
    return this.$el.find('.scroller-left').toggleClass('disabled', leftPosition <= 0);
  };

  NavButtonsView.prototype.onModelClicked = function(model, newValue, options) {
    var lastSelectedModel;
    if (newValue) {
      lastSelectedModel = this.lastSelectedModel;
      if (lastSelectedModel) {
        lastSelectedModel.reset();
      }
      model.setSelected(true);
      return this.lastSelectedModel = model;
    }
  };

  return NavButtonsView;

})(ActionButtonsView);


},{"../../templates/widgets/nav-buttons":"txn0ZT","./action-buttons-view":739,"./nav-button-view":743,"jquery":774}],745:[function(require,module,exports){
var $, SettingsPopup, View,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

$ = require('jquery');

module.exports = SettingsPopup = (function(_super) {
  __extends(SettingsPopup, _super);

  function SettingsPopup() {
    return SettingsPopup.__super__.constructor.apply(this, arguments);
  }

  SettingsPopup.prototype.autoRender = true;

  SettingsPopup.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  SettingsPopup.prototype.onAddedToDOM = function() {
    return this.initializeBackgroundOverlay();
  };

  SettingsPopup.prototype.onClickCancel = function() {
    return this.closePopup();
  };

  SettingsPopup.prototype.initializeBackgroundOverlay = function() {
    var div;
    $(document.body).addClass("popup-overlay");
    div = document.createElement("div");
    div.id = "background-overlay";
    return document.body.appendChild(div);
  };

  SettingsPopup.prototype.closePopup = function() {
    this.dispose();
    $("#background-overlay").remove();
    return $(document.body).removeClass("popup-overlay");
  };

  return SettingsPopup;

})(View);


},{"../base/view":608,"jquery":774}],746:[function(require,module,exports){
var $, DroplistV, SearchInputView, View, template, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$ = require('jquery');

_ = require('lodash');

template = require('../../templates/widgets/search-input');

View = require('../base/view');

DroplistV = require('./droplist-view');

module.exports = SearchInputView = (function(_super) {
  __extends(SearchInputView, _super);

  function SearchInputView() {
    this.onBodyClick = __bind(this.onBodyClick, this);
    this.onKeyDown = __bind(this.onKeyDown, this);
    this.onInputInput = __bind(this.onInputInput, this);
    return SearchInputView.__super__.constructor.apply(this, arguments);
  }

  SearchInputView.prototype.autoRender = true;

  SearchInputView.prototype.className = 'search-input-view';

  SearchInputView.prototype.container = 'body';

  SearchInputView.prototype.containerMethod = 'html';

  SearchInputView.prototype.template = template;

  SearchInputView.prototype.events = {
    'input input': 'onInputInput',
    'click [data-icon-id=search-label]': 'onLabelClick',
    'click [data-icon-id=search-reset]': 'onResetClick',
    'keydown input': 'onKeyDown',
    'keydown [data-view-id=autofilter-droplist]': 'onKeyDown'
  };

  SearchInputView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM',
    'change:searchOpen model': 'onSearchOpenChange',
    'change:searchText model': 'onSearchTextChange'
  };

  SearchInputView.prototype.initialize = function(options) {
    var viewId;
    SearchInputView.__super__.initialize.apply(this, arguments);
    this.eventPrefix = options.eventPrefix || 'autofilter';
    viewId = options != null ? options.id : void 0;
    return $(document).on('click', this.onBodyClick);
  };

  SearchInputView.prototype.dispose = function() {
    $(document).off('click', this.onBodyClick);
    return this.$input = this.$resetIcon = this.$labelIcon = null;
  };

  SearchInputView.prototype.onAddedToDOM = function(evnt) {
    var dropviewId;
    dropviewId = this.model.getDropviewId();
    this.$input = this.$el.find('input[type=text]');
    this.$resetIcon = this.$el.find('[data-icon-id=search-reset]');
    this.$labelIcon = this.$el.find('[data-icon-id=search-label]');
    return this.subview('droplistview', new DroplistV({
      collection: this.model.getSearchListProvider(),
      el: this.$el.find('#' + dropviewId),
      containerMethod: 'html',
      id: dropviewId,
      eventPrefix: this.eventPrefix
    }));
  };

  SearchInputView.prototype.onInputInput = function(evnt) {
    var val;
    val = this.$input.val();
    return this.model.setSearchText(val);
  };

  SearchInputView.prototype.onLabelClick = function(evnt) {
    return this.model.setSearchOpen(true);
  };

  SearchInputView.prototype.onResetClick = function(evnt) {
    this.model.setSearchText('');
    return this.model.setSearchOpen(false);
  };

  SearchInputView.prototype.onSearchOpenChange = function(model, value, options) {
    if (value) {
      this.$resetIcon.show();
      this.$labelIcon.hide();
    } else {
      this.$resetIcon.hide();
      this.$labelIcon.show();
    }
    if (value) {
      return this.subview('droplistview').open();
    } else {
      return this.subview('droplistview').close();
    }
  };

  SearchInputView.prototype.onSearchTextChange = function(model, value, options) {
    this.model.setSearchOpen(!!value.length);
    if (value !== this.$input.val()) {
      return this.$input.val(value);
    }
  };

  SearchInputView.prototype._closeDroplist = function(focusOnInput) {
    this.model.setSearchText('');
    this.model.setSearchOpen(false);
    if (focusOnInput) {
      return this.$input.focus();
    }
  };

  SearchInputView.prototype.onKeyDown = function(evnt) {
    var handled, keycode, searchText;
    keycode = evnt.keyCode;
    switch (keycode) {
      case 9:
        this.publishEvent(this.eventPrefix + ":tab-key", {
          jqEvent: evnt,
          view: this
        });
        return true;
      case 13:
        searchText = this.$input.val();
        handled = this.model.select();
        this.publishEvent(this.eventPrefix + ":enter-key", {
          jqEvent: evnt,
          view: this,
          handled: handled,
          searchText: searchText
        });
        return true;
      case 27:
        this._closeDroplist(true);
        this.publishEvent(this.eventPrefix + ":escape-key", {
          jqEvent: evnt,
          view: this
        });
        return true;
      case 32:
        this.publishEvent(this.eventPrefix + ":space-bar", {
          jqEvent: evnt,
          view: this
        });
        return true;
      case 37:
        this.publishEvent(this.eventPrefix + ":arrow-left", {
          jqEvent: evnt,
          view: this
        });
        return true;
      case 38:
        this.model.highlightPrevious();
        this.publishEvent(this.eventPrefix + ":arrow-up", {
          jqEvent: evnt,
          view: this
        });
        evnt.preventDefault();
        return false;
      case 39:
        this.publishEvent(this.eventPrefix + ":arrow-right", {
          jqEvent: evnt,
          view: this
        });
        return true;
      case 40:
        this.model.highlightNext();
        this.publishEvent(this.eventPrefix + ":arrow-down", {
          jqEvent: evnt,
          view: this
        });
        evnt.preventDefault();
        return false;
    }
  };

  SearchInputView.prototype.onBodyClick = function($evnt) {
    var targetEl;
    targetEl = $evnt.target;
    if (!$.contains(this.$el.get(0), targetEl)) {
      return this._closeDroplist(false);
    }
  };

  return SearchInputView;

})(View);


},{"../../templates/widgets/search-input":"yJ+Woq","../base/view":608,"./droplist-view":741,"jquery":774,"lodash":776}],747:[function(require,module,exports){
var ActionButtonM, ActionButtonsC, NavButtonsV, TabView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/widgets/tab-view');

NavButtonsV = require('../widgets/nav-buttons-view');

ActionButtonsC = require('../../models/action-buttons-collection');

ActionButtonM = require('../../models/action-button-model');


/*
 * a reusable view to tab contents.
 * pass these options to the constructor
 * options = {
 *             columnLayoutClassName: <String> -- optional, default='three-column' -- a classname to add to the tabContent subview
 *             tabViewProvider: <TabViewProvider> -- will be used to construct a navbar view at the top
 *           }
 */

module.exports = TabView = (function(_super) {
  __extends(TabView, _super);

  function TabView() {
    return TabView.__super__.constructor.apply(this, arguments);
  }

  TabView.prototype.template = template;

  TabView.prototype.autoRender = true;

  TabView.prototype.className = 'tab-view';

  TabView.prototype.trackingLabel = 'tab-view';

  TabView.prototype.columnLayoutClassName = 'three-column';

  TabView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM'
  };

  TabView.prototype.initialize = function(options) {
    if (options != null ? options.columnLayoutClassName : void 0) {
      this.columnLayoutClassName = options.columnLayoutClassName;
    }
    this.hideNavBar = options != null ? options.hideNavBar : void 0;
    this.tabViewProvider = options != null ? options.tabViewProvider : void 0;
    this.tabViewProvider.initializeTabViewProvider();
    this.actionToButtonTextMap = this.tabViewProvider.getActionToButtonTextMap();
    this.actionButtonsCollection = this.tabViewProvider.getActionButtonsCollection();
    this.listenTo(this.tabViewProvider, 'add remove', this.updateActionButtons);
    return this.listenTo(this.actionButtonsCollection, 'change:selected', this.onActionButtonsChange);
  };

  TabView.prototype.onAddedToDOM = function() {
    var _ref;
    this.subview('category-nav-view', new NavButtonsV({
      collection: this.actionButtonsCollection,
      container: this.$el.find('#nav-buttons-view-container'),
      containerMethod: 'html',
      id: 'category-nav'
    })).$el.hide();
    if (!this.hideNavBar) {
      this.subview('category-nav-view').$el.show();
    }
    return (_ref = this.actionButtonsCollection.first()) != null ? _ref.setClicked(true) : void 0;
  };

  TabView.prototype.onActionButtonsChange = function(model, value, options) {
    var action, contentViewConstructor, contentViewOptions, dataObject, _ref;
    if (value) {
      action = model.getAction();
      if (action) {
        contentViewConstructor = this.tabViewProvider.getTabViewConstructorForAction(action);
        dataObject = this.tabViewProvider.getDataForAction(action);
        contentViewOptions = {
          className: this.columnLayoutClassName
        };
        if (dataObject instanceof Chaplin.Collection) {
          contentViewOptions.collection = dataObject;
        } else {
          contentViewOptions.model = dataObject;
        }
        contentViewOptions.container = this.$el.find('#tab-content-view-container');
        contentViewOptions.containerMethod = 'html';
        if ((_ref = this.subview('tab-content-view')) != null) {
          _ref.dispose();
        }
        return this.subview('tab-content-view', new contentViewConstructor(contentViewOptions));
      }
    }
  };

  TabView.prototype.updateActionButtons = function() {
    return this.actionButtonsCollection.set(this.tabViewProvider.getActionButtonsCollection().models);
  };

  return TabView;

})(View);


},{"../../models/action-button-model":159,"../../models/action-buttons-collection":160,"../../templates/widgets/tab-view":"JtT1E7","../base/view":608,"../widgets/nav-buttons-view":744}],748:[function(require,module,exports){
var $, MisclassifiedView, OptionsView, PopupView, WrongLanguageView, WrongStumbleBaseView, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

PopupView = require('../widgets/popup-view');

template = require('../../templates/wrong-stumble/base');

OptionsView = require('./options-view');

MisclassifiedView = require('./misclassified-view');

WrongLanguageView = require('./wrong-language-view');

panel = require('../../lib/panel');

$ = require('jquery');

module.exports = WrongStumbleBaseView = (function(_super) {
  __extends(WrongStumbleBaseView, _super);

  function WrongStumbleBaseView() {
    return WrongStumbleBaseView.__super__.constructor.apply(this, arguments);
  }

  WrongStumbleBaseView.prototype.template = template;

  WrongStumbleBaseView.prototype.className = 'wrong-stumble-view';

  WrongStumbleBaseView.prototype.listen = {
    'wrong-stumble:cancel:click mediator': 'onClickCancel',
    'wrong-stumble:close mediator': 'closePopup',
    'options:misclassified:click mediator': 'onMisclassified',
    'options:notAvailable:click mediator': 'onNotAvailable',
    'options:wrongLanguage:click mediator': 'onWrongLanguage',
    'wrong-stumble:model:success mediator': 'onNotAvailableSuccess',
    'wrong-stumble:model:error mediator': 'onNotAvailableError'
  };

  WrongStumbleBaseView.prototype.onAddedToDOM = function() {
    WrongStumbleBaseView.__super__.onAddedToDOM.apply(this, arguments);
    return this.subview('options-container', new OptionsView({
      container: this.$el.find('#subview-container'),
      model: this.model
    }));
  };

  WrongStumbleBaseView.prototype.onMisclassified = function() {
    return this.subview('misclassified-container', new MisclassifiedView({
      container: this.$el.find('#subview-container'),
      model: this.model
    }));
  };

  WrongStumbleBaseView.prototype.onNotAvailable = function() {
    return this.model.reportNotAvailable();
  };

  WrongStumbleBaseView.prototype.onNotAvailableSuccess = function() {
    this.closePopup();
    return panel.displaySuccessMsg("Thanks for your feedback!");
  };

  WrongStumbleBaseView.prototype.onNotAvailableError = function() {
    this.closePopup();
    return panel.displayErrorMsg("Couldn't report not available, please try again later!");
  };

  WrongStumbleBaseView.prototype.onWrongLanguage = function() {
    return this.subview('wrong-language-container', new WrongLanguageView({
      container: this.$el.find('#subview-container'),
      model: this.model
    }));
  };

  WrongStumbleBaseView.prototype.onClickCancel = function() {
    this.publishEvent('wrong-stumble:close:dialog');
    return WrongStumbleBaseView.__super__.onClickCancel.apply(this, arguments);
  };

  WrongStumbleBaseView.prototype.closePopup = function() {
    this.publishEvent('wrong-stumble:close:dialog');
    return WrongStumbleBaseView.__super__.closePopup.apply(this, arguments);
  };

  return WrongStumbleBaseView;

})(PopupView);


},{"../../lib/panel":125,"../../templates/wrong-stumble/base":"/vDAbC","../widgets/popup-view":745,"./misclassified-view":749,"./options-view":750,"./wrong-language-view":751,"jquery":774}],749:[function(require,module,exports){
var $, MisclassifiedView, View, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/wrong-stumble/misclassified');

panel = require('../../lib/panel');

$ = require('jquery');

module.exports = MisclassifiedView = (function(_super) {
  __extends(MisclassifiedView, _super);

  function MisclassifiedView() {
    return MisclassifiedView.__super__.constructor.apply(this, arguments);
  }

  MisclassifiedView.prototype.autoRender = true;

  MisclassifiedView.prototype.template = template;

  MisclassifiedView.prototype.events = {
    'click .cancel': 'onClickCancel',
    'click .send-report': 'onClickSendReport'
  };

  MisclassifiedView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM',
    'wrong-stumble:model:success mediator': 'onSuccess',
    'wrong-stumble:model:error mediator': 'onError'
  };

  MisclassifiedView.prototype.onAddedToDOM = function() {
    return this.prefillSuggestInterest();
  };

  MisclassifiedView.prototype.prefillSuggestInterest = function() {
    var categoryList, suggestInterestSelect, _ref;
    categoryList = (_ref = this.model) != null ? _ref.get('category_list') : void 0;
    if (categoryList) {
      suggestInterestSelect = document.getElementById('suggest-interest');
      return categoryList.forEach(function(category) {
        var option;
        if ((category.tag != null) && (category.tagid != null)) {
          option = document.createElement('option');
          option.innerHTML = category.tag;
          option.value = category.tagid;
          return suggestInterestSelect.appendChild(option);
        }
      });
    }
  };

  MisclassifiedView.prototype.onClickSendReport = function() {
    this.startSpin();
    this.model.set({
      catid: $('#suggest-interest').val(),
      note: $('#note').val()
    });
    return this.model.reportMisclassified();
  };

  MisclassifiedView.prototype.onClickCancel = function() {
    return this.publishEvent('wrong-stumble:cancel:click');
  };

  MisclassifiedView.prototype.startSpin = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.send-spin').removeClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.send-report').addClass('disabled') : void 0;
  };

  MisclassifiedView.prototype.onSuccess = function() {
    this.publishEvent('wrong-stumble:close');
    return panel.displaySuccessMsg("Thanks for your feedback!");
  };

  MisclassifiedView.prototype.onError = function() {
    this.publishEvent('wrong-stumble:close');
    return panel.displayErrorMsg("Couldn't report misclassified, please try again later!");
  };

  return MisclassifiedView;

})(View);


},{"../../lib/panel":125,"../../templates/wrong-stumble/misclassified":"b8XC8z","../base/view":608,"jquery":774}],750:[function(require,module,exports){
var OptionsView, View, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/wrong-stumble/options');

module.exports = OptionsView = (function(_super) {
  __extends(OptionsView, _super);

  function OptionsView() {
    return OptionsView.__super__.constructor.apply(this, arguments);
  }

  OptionsView.prototype.autoRender = true;

  OptionsView.prototype.template = template;

  OptionsView.prototype.events = {
    'click .misclassified': 'onClickMisclassified',
    'click .notAvailable': 'onClickNotAvailable',
    'click .wrongLanguage': 'onClickWrongLanguage',
    'click .cancel': 'onClickCancel'
  };

  OptionsView.prototype.onClickMisclassified = function() {
    this.publishEvent('options:misclassified:click');
    return this.dispose();
  };

  OptionsView.prototype.onClickNotAvailable = function() {
    return this.publishEvent('options:notAvailable:click');
  };

  OptionsView.prototype.onClickWrongLanguage = function() {
    this.publishEvent('options:wrongLanguage:click');
    return this.dispose();
  };

  OptionsView.prototype.onClickCancel = function() {
    return this.publishEvent('wrong-stumble:cancel:click');
  };

  return OptionsView;

})(View);


},{"../../templates/wrong-stumble/options":"j9k2Ez","../base/view":608}],751:[function(require,module,exports){
var $, View, WrongLanguageView, panel, template,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

View = require('../base/view');

template = require('../../templates/wrong-stumble/wrong-language');

panel = require('../../lib/panel');

$ = require('jquery');

module.exports = WrongLanguageView = (function(_super) {
  __extends(WrongLanguageView, _super);

  function WrongLanguageView() {
    return WrongLanguageView.__super__.constructor.apply(this, arguments);
  }

  WrongLanguageView.prototype.autoRender = true;

  WrongLanguageView.prototype.template = template;

  WrongLanguageView.prototype.events = {
    'click .cancel': 'onClickCancel',
    'click .send-report': 'onClickSendReport'
  };

  WrongLanguageView.prototype.listen = {
    'addedToDOM': 'onAddedToDOM',
    'wrong-stumble:model:success mediator': 'onSuccess',
    'wrong-stumble:model:error mediator': 'onError'
  };

  WrongLanguageView.prototype.onAddedToDOM = function() {
    return this.prefillLanguages();
  };

  WrongLanguageView.prototype.prefillLanguages = function() {
    var key, languagesList, languagesSelect, option, _ref, _results;
    languagesList = (_ref = this.model) != null ? _ref.get('languages') : void 0;
    if (languagesList) {
      languagesSelect = document.getElementById('suggest-language');
    }
    _results = [];
    for (key in languagesList) {
      if (languagesList.hasOwnProperty(key)) {
        option = document.createElement('option');
        option.innerHTML = languagesList[key];
        option.value = key;
        _results.push(languagesSelect.appendChild(option));
      } else {
        _results.push(void 0);
      }
    }
    return _results;
  };

  WrongLanguageView.prototype.onClickSendReport = function() {
    this.startSpin();
    this.model.set({
      langid: $('#suggest-language').val()
    });
    return this.model.reportWrongLanguage();
  };

  WrongLanguageView.prototype.startSpin = function() {
    var _ref, _ref1;
    if ((_ref = this.$el) != null) {
      _ref.find('.send-spin').removeClass('hidden');
    }
    return (_ref1 = this.$el) != null ? _ref1.find('.send-report').addClass('disabled') : void 0;
  };

  WrongLanguageView.prototype.onClickCancel = function() {
    return this.publishEvent('wrong-stumble:cancel:click');
  };

  WrongLanguageView.prototype.onSuccess = function() {
    this.publishEvent('wrong-stumble:close');
    return panel.displaySuccessMsg("Thanks for your feedback!");
  };

  WrongLanguageView.prototype.onError = function() {
    this.publishEvent('wrong-stumble:close');
    return panel.displayErrorMsg("Couldn't correct language, please try again later!");
  };

  return WrongLanguageView;

})(View);


},{"../../lib/panel":125,"../../templates/wrong-stumble/wrong-language":"blWMNz","../base/view":608,"jquery":774}],752:[function(require,module,exports){
/*! Jcrop.js v2.0.4 - build: 20151117
 *  @copyright 2008-2015 Tapmodo Interactive LLC
 *  @license Free software under MIT License
 *  @website http://jcrop.org/
 **/
(function($){
  'use strict';

  // Jcrop constructor
  var Jcrop = function(element,opt){
    var _ua = navigator.userAgent.toLowerCase();

    this.opt = $.extend({},Jcrop.defaults,opt || {});

    this.container = $(element);

    this.opt.is_msie = /msie/.test(_ua);
    this.opt.is_ie_lt9 = /msie [1-8]\./.test(_ua);

    this.container.addClass(this.opt.css_container);

    this.ui = {};
    this.state = null;
    this.ui.multi = [];
    this.ui.selection = null;
    this.filter = {};

    this.init();
    this.setOptions(opt);
    this.applySizeConstraints();
    this.container.trigger('cropinit',this);
      
    // IE<9 doesn't work if mouse events are attached to window
    if (this.opt.is_ie_lt9)
      this.opt.dragEventTarget = document.body;
  };


  // Jcrop static functions
  $.extend(Jcrop,{
    component: { },
    filter: { },
    stage: { },
    registerComponent: function(name,component){
      Jcrop.component[name] = component;
    },
    registerFilter: function(name,filter){
      Jcrop.filter[name] = filter;
    },
    registerStageType: function(name,stage){
      Jcrop.stage[name] = stage;
    },
    // attach: function(element,opt){{{
    attach: function(element,opt){
      var obj = new $.Jcrop(element,opt);
      return obj;
    },
    // }}}
    // imgCopy: function(imgel){{{
    imgCopy: function(imgel){
      var img = new Image;
      img.src = imgel.src;
      return img;
    },
    // }}}
    // imageClone: function(imgel){{{
    imageClone: function(imgel){
      return $.Jcrop.supportsCanvas?
        Jcrop.canvasClone(imgel):
        Jcrop.imgCopy(imgel);
    },
    // }}}
    // canvasClone: function(imgel){{{
    canvasClone: function(imgel){
      var canvas = document.createElement('canvas'),
          ctx = canvas.getContext('2d');

      $(canvas).width(imgel.width).height(imgel.height),
      canvas.width = imgel.naturalWidth;
      canvas.height = imgel.naturalHeight;
      ctx.drawImage(imgel,0,0,imgel.naturalWidth,imgel.naturalHeight);
      return canvas;
    },
    // }}}
    // propagate: function(plist,config,obj){{{
    propagate: function(plist,config,obj){
      for(var i=0,l=plist.length;i<l;i++)
        if (config.hasOwnProperty(plist[i]))
          obj[plist[i]] = config[plist[i]];
    },
    // }}}
    // getLargestBox: function(ratio,w,h){{{
    getLargestBox: function(ratio,w,h){
      if ((w/h) > ratio)
        return [ h * ratio, h ];
          else return [ w, w / ratio ];
    },
    // }}}
    // stageConstructor: function(el,options,callback){{{
    stageConstructor: function(el,options,callback){

      // Get a priority-ordered list of available stages
      var stages = [];
      $.each(Jcrop.stage,function(i,e){
        stages.push(e);
      });
      stages.sort(function(a,b){ return a.priority - b.priority; });

      // Find the first one that supports this element
      for(var i=0,l=stages.length;i<l;i++){
        if (stages[i].isSupported(el,options)){
          stages[i].create(el,options,function(obj,opt){
            if (typeof callback == 'function') callback(obj,opt);
          });
          break;
        }
      }
    },
    // }}}
    // supportsColorFade: function(){{{
    supportsColorFade: function(){
      return $.fx.step.hasOwnProperty('backgroundColor');
    },
    // }}}
    // wrapFromXywh: function(xywh){{{
    wrapFromXywh: function(xywh){
      var b = { x: xywh[0], y: xywh[1], w: xywh[2], h: xywh[3] };
      b.x2 = b.x + b.w;
      b.y2 = b.y + b.h;
      return b;
    }
    // }}}
  });

var AbstractStage = function(){
};

$.extend(AbstractStage,{
  isSupported: function(el,o){
    // @todo: should actually check if it's an HTML element
    return true;
  },
  // A higher priority means less desirable
  // AbstractStage is the last one we want to use
  priority: 100,
  create: function(el,options,callback){
    var obj = new AbstractStage;
    obj.element = el;
    callback.call(this,obj,options);
  },
  prototype: {
    attach: function(core){
      this.init(core);
      core.ui.stage = this;
    },
    triggerEvent: function(ev){
      $(this.element).trigger(ev);
      return this;
    },
    getElement: function(){
      return this.element;
    }
  }
});
Jcrop.registerStageType('Block',AbstractStage);


var ImageStage = function(){
};

ImageStage.prototype = new AbstractStage();

$.extend(ImageStage,{
  isSupported: function(el,o){
    if (el.tagName == 'IMG') return true;
  },
  priority: 90,
  create: function(el,options,callback){
    $.Jcrop.component.ImageLoader.attach(el,function(w,h){
      var obj = new ImageStage;
      obj.element = $(el).wrap('<div />').parent();

      obj.element.width(w).height(h);
      obj.imgsrc = el;

      if (typeof callback == 'function')
        callback.call(this,obj,options);
    });
  }
});
Jcrop.registerStageType('Image',ImageStage);


var CanvasStage = function(){
  this.angle = 0;
  this.scale = 1;
  this.scaleMin = 0.2;
  this.scaleMax = 1.25;
  this.offset = [0,0];
};

CanvasStage.prototype = new ImageStage();

$.extend(CanvasStage,{
  isSupported: function(el,o){
    if ($.Jcrop.supportsCanvas && (el.tagName == 'IMG')) return true;
  },
  priority: 60,
  create: function(el,options,callback){
    var $el = $(el);
    var opt = $.extend({},options);
    $.Jcrop.component.ImageLoader.attach(el,function(w,h){
      var obj = new CanvasStage;
      $el.hide();
      obj.createCanvas(el,w,h);
      $el.before(obj.element);
      obj.imgsrc = el;
      opt.imgsrc = el;

      if (typeof callback == 'function'){
        callback(obj,opt);
        obj.redraw();
      }
    });
  }
});

$.extend(CanvasStage.prototype,{
  init: function(core){
    this.core = core;
  },
  // setOffset: function(x,y) {{{
  setOffset: function(x,y) {
    this.offset = [x,y];
    return this;
  },
  // }}}
  // setAngle: function(v) {{{
  setAngle: function(v) {
    this.angle = v;
    return this;
  },
  // }}}
  // setScale: function(v) {{{
  setScale: function(v) {
    this.scale = this.boundScale(v);
    return this;
  },
  // }}}
  boundScale: function(v){
    if (v<this.scaleMin) v = this.scaleMin;
    else if (v>this.scaleMax) v = this.scaleMax;
    return v;
  },
  createCanvas: function(img,w,h){
    this.width = w;
    this.height = h;
    this.canvas = document.createElement('canvas');
    this.canvas.width = w;
    this.canvas.height = h;
    this.$canvas = $(this.canvas).width('100%').height('100%');
    this.context = this.canvas.getContext('2d');
    this.fillstyle = "rgb(0,0,0)";
    this.element = this.$canvas.wrap('<div />').parent().width(w).height(h);
  },
  triggerEvent: function(ev){
    this.$canvas.trigger(ev);
    return this;
  },
  // clear: function() {{{
  clear: function() {
    this.context.fillStyle = this.fillstyle;
    this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);
    return this;
  },
  // }}}
  // redraw: function() {{{
  redraw: function() {
    // Save the current context
    this.context.save();
    this.clear();

    // Translate to the center point of our image
    this.context.translate(parseInt(this.width * 0.5), parseInt(this.height * 0.5));
    // Perform the rotation and scaling
    this.context.translate(this.offset[0]/this.core.opt.xscale,this.offset[1]/this.core.opt.yscale);
    this.context.rotate(this.angle * (Math.PI/180));
    this.context.scale(this.scale,this.scale);
    // Translate back to the top left of our image
    this.context.translate(-parseInt(this.width * 0.5), -parseInt(this.height * 0.5));
    // Finally we draw the image
    this.context.drawImage(this.imgsrc,0,0,this.width,this.height);

    // And restore the updated context
    this.context.restore();
    this.$canvas.trigger('cropredraw');
    return this;
  },
  // }}}
  // setFillStyle: function(v) {{{
  setFillStyle: function(v) {
    this.fillstyle = v;
    return this;
  }
  // }}}
});

Jcrop.registerStageType('Canvas',CanvasStage);


  /**
   *  BackoffFilter
   *  move out-of-bounds selection into allowed position at same size
   */
  var BackoffFilter = function(){
    this.minw = 40;
    this.minh = 40;
    this.maxw = 0;
    this.maxh = 0;
    this.core = null;
  };
  $.extend(BackoffFilter.prototype,{
    tag: 'backoff',
    priority: 22,
    filter: function(b){
      var r = this.bound;

      if (b.x < r.minx) { b.x = r.minx; b.x2 = b.w + b.x; }
      if (b.y < r.miny) { b.y = r.miny; b.y2 = b.h + b.y; }
      if (b.x2 > r.maxx) { b.x2 = r.maxx; b.x = b.x2 - b.w; }
      if (b.y2 > r.maxy) { b.y2 = r.maxy; b.y = b.y2 - b.h; }

      return b;
    },
    refresh: function(sel){
      this.elw = sel.core.container.width();
      this.elh = sel.core.container.height();
      this.bound = {
        minx: 0 + sel.edge.w,
        miny: 0 + sel.edge.n,
        maxx: this.elw + sel.edge.e,
        maxy: this.elh + sel.edge.s
      };
    }
  });
  Jcrop.registerFilter('backoff',BackoffFilter);

  /**
   *  ConstrainFilter
   *  a filter to constrain crop selection to bounding element
   */
  var ConstrainFilter = function(){
    this.core = null;
  };
  $.extend(ConstrainFilter.prototype,{
    tag: 'constrain',
    priority: 5,
    filter: function(b,ord){
      if (ord == 'move') {
        if (b.x < this.minx) { b.x = this.minx; b.x2 = b.w + b.x; }
        if (b.y < this.miny) { b.y = this.miny; b.y2 = b.h + b.y; }
        if (b.x2 > this.maxx) { b.x2 = this.maxx; b.x = b.x2 - b.w; }
        if (b.y2 > this.maxy) { b.y2 = this.maxy; b.y = b.y2 - b.h; }
      } else {
        if (b.x < this.minx) { b.x = this.minx; }
        if (b.y < this.miny) { b.y = this.miny; }
        if (b.x2 > this.maxx) { b.x2 = this.maxx; }
        if (b.y2 > this.maxy) { b.y2 = this.maxy; }
      }
      b.w = b.x2 - b.x;
      b.h = b.y2 - b.y;
      return b;
    },
    refresh: function(sel){
      this.elw = sel.core.container.width();
      this.elh = sel.core.container.height();
      this.minx = 0 + sel.edge.w;
      this.miny = 0 + sel.edge.n;
      this.maxx = this.elw + sel.edge.e;
      this.maxy = this.elh + sel.edge.s;
    }
  });
  Jcrop.registerFilter('constrain',ConstrainFilter);

  /**
   *  ExtentFilter
   *  a filter to implement minimum or maximum size
   */
  var ExtentFilter = function(){
    this.core = null;
  };
  $.extend(ExtentFilter.prototype,{
    tag: 'extent',
    priority: 12,
    offsetFromCorner: function(corner,box,b){
      var w = box[0], h = box[1];
      switch(corner){
        case 'bl': return [ b.x2 - w, b.y, w, h ];
        case 'tl': return [ b.x2 - w , b.y2 - h, w, h ];
        case 'br': return [ b.x, b.y, w, h ];
        case 'tr': return [ b.x, b.y2 - h, w, h ];
      }
    },
    getQuadrant: function(s){
      var relx = s.opposite[0]-s.offsetx
      var rely = s.opposite[1]-s.offsety;

      if ((relx < 0) && (rely < 0)) return 'br';
        else if ((relx >= 0) && (rely >= 0)) return 'tl';
        else if ((relx < 0) && (rely >= 0)) return 'tr';
        return 'bl';
    },
    filter: function(b,ord,sel){

      if (ord == 'move') return b;

      var w = b.w, h = b.h, st = sel.state, r = this.limits;
      var quad = st? this.getQuadrant(st): 'br';

      if (r.minw && (w < r.minw)) w = r.minw;
      if (r.minh && (h < r.minh)) h = r.minh;
      if (r.maxw && (w > r.maxw)) w = r.maxw;
      if (r.maxh && (h > r.maxh)) h = r.maxh;

      if ((w == b.w) && (h == b.h)) return b;

      return Jcrop.wrapFromXywh(this.offsetFromCorner(quad,[w,h],b));
    },
    refresh: function(sel){
      this.elw = sel.core.container.width();
      this.elh = sel.core.container.height();

      this.limits = {
        minw: sel.minSize[0],
        minh: sel.minSize[1],
        maxw: sel.maxSize[0],
        maxh: sel.maxSize[1]
      };
    }
  });
  Jcrop.registerFilter('extent',ExtentFilter);


  /**
   *  GridFilter
   *  a rudimentary grid effect
   */
  var GridFilter = function(){
    this.stepx = 1;
    this.stepy = 1;
    this.core = null;
  };
  $.extend(GridFilter.prototype,{
    tag: 'grid',
    priority: 19,
    filter: function(b){
      
      var n = {
        x: Math.round(b.x / this.stepx) * this.stepx,
        y: Math.round(b.y / this.stepy) * this.stepy,
        x2: Math.round(b.x2 / this.stepx) * this.stepx,
        y2: Math.round(b.y2 / this.stepy) * this.stepy
      };
      
      n.w = n.x2 - n.x;
      n.h = n.y2 - n.y;

      return n;
    }
  });
  Jcrop.registerFilter('grid',GridFilter);


  /**
   *  RatioFilter
   *  implements aspectRatio locking
   */
  var RatioFilter = function(){
    this.ratio = 0;
    this.core = null;
  };
  $.extend(RatioFilter.prototype,{
    tag: 'ratio',
    priority: 15,
    offsetFromCorner: function(corner,box,b){
      var w = box[0], h = box[1];
      switch(corner){
        case 'bl': return [ b.x2 - w, b.y, w, h ];
        case 'tl': return [ b.x2 - w , b.y2 - h, w, h ];
        case 'br': return [ b.x, b.y, w, h ];
        case 'tr': return [ b.x, b.y2 - h, w, h ];
      }
    },
    getBoundRatio: function(b,quad){
      var box = Jcrop.getLargestBox(this.ratio,b.w,b.h);
      return Jcrop.wrapFromXywh(this.offsetFromCorner(quad,box,b));
    },
    getQuadrant: function(s){
      var relx = s.opposite[0]-s.offsetx
      var rely = s.opposite[1]-s.offsety;

      if ((relx < 0) && (rely < 0)) return 'br';
        else if ((relx >= 0) && (rely >= 0)) return 'tl';
        else if ((relx < 0) && (rely >= 0)) return 'tr';
        return 'bl';
    },
    filter: function(b,ord,sel){

      if (!this.ratio) return b;

      var rt = b.w / b.h;
      var st = sel.state;

      var quad = st? this.getQuadrant(st): 'br';
      ord = ord || 'se';

      if (ord == 'move') return b;

      switch(ord) {
        case 'n':
          b.x2 = this.elw;
          b.w = b.x2 - b.x;
          quad = 'tr';
          break;
        case 's':
          b.x2 = this.elw;
          b.w = b.x2 - b.x;
          quad = 'br';
          break;
        case 'e':
          b.y2 = this.elh;
          b.h = b.y2 - b.y;
          quad = 'br';
          break;
        case 'w':
          b.y2 = this.elh;
          b.h = b.y2 - b.y;
          quad = 'bl';
          break;
      }

      return this.getBoundRatio(b,quad);
    },
    refresh: function(sel){
      this.ratio = sel.aspectRatio;
      this.elw = sel.core.container.width();
      this.elh = sel.core.container.height();
    }
  });
  Jcrop.registerFilter('ratio',RatioFilter);


  /**
   *  RoundFilter
   *  rounds coordinate values to integers
   */
  var RoundFilter = function(){
    this.core = null;
  };
  $.extend(RoundFilter.prototype,{
    tag: 'round',
    priority: 90,
    filter: function(b){
      
      var n = {
        x: Math.round(b.x),
        y: Math.round(b.y),
        x2: Math.round(b.x2),
        y2: Math.round(b.y2)
      };
      
      n.w = n.x2 - n.x;
      n.h = n.y2 - n.y;

      return n;
    }
  });
  Jcrop.registerFilter('round',RoundFilter);


  /**
   *  ShadeFilter
   *  A filter that implements div-based shading on any element
   *
   *  The shading you see is actually four semi-opaque divs
   *  positioned inside the container, around the selection
   */
  var ShadeFilter = function(opacity,color){
    this.color = color || 'black';
    this.opacity = opacity || 0.5;
    this.core = null;
    this.shades = {};
  };
  $.extend(ShadeFilter.prototype,{
    tag: 'shader',
    fade: true,
    fadeEasing: 'swing',
    fadeSpeed: 320,
    priority: 95,
    init: function(){
      var t = this;

      if (!t.attached) {
        t.visible = false;

        t.container = $('<div />').addClass(t.core.opt.css_shades)
          .prependTo(this.core.container).hide();

        t.elh = this.core.container.height();
        t.elw = this.core.container.width();

        t.shades = {
          top: t.createShade(),
          right: t.createShade(),
          left: t.createShade(),
          bottom: t.createShade()
        };

        t.attached = true;
      }
    },
    destroy: function(){
      this.container.remove();
    },
    setColor: function(color,instant){
      var t = this;

      if (color == t.color) return t;

      this.color = color;
      var colorfade = Jcrop.supportsColorFade();
      $.each(t.shades,function(u,i){
        if (!t.fade || instant || !colorfade) i.css('backgroundColor',color);
          else i.animate({backgroundColor:color},{queue:false,duration:t.fadeSpeed,easing:t.fadeEasing});
      });
      return t;
    },
    setOpacity: function(opacity,instant){
      var t = this;

      if (opacity == t.opacity) return t;

      t.opacity = opacity;
      $.each(t.shades,function(u,i){
        if (!t.fade || instant) i.css({opacity:opacity});
          else i.animate({opacity:opacity},{queue:false,duration:t.fadeSpeed,easing:t.fadeEasing});
      });
      return t;
    },
    createShade: function(){
      return $('<div />').css({
        position: 'absolute',
        backgroundColor: this.color,
        opacity: this.opacity
      }).appendTo(this.container);
    },
    refresh: function(sel){
      var m = this.core, s = this.shades;

      this.setColor(sel.bgColor?sel.bgColor:this.core.opt.bgColor);
      this.setOpacity(sel.bgOpacity?sel.bgOpacity:this.core.opt.bgOpacity);
        
      this.elh = m.container.height();
      this.elw = m.container.width();
      s.right.css('height',this.elh+'px');
      s.left.css('height',this.elh+'px');
    },
    filter: function(b,ord,sel){

      if (!sel.active) return b;

      var t = this,
        s = t.shades;
      
      s.top.css({
        left: Math.round(b.x)+'px',
        width: Math.round(b.w)+'px',
        height: Math.round(b.y)+'px'
      });
      s.bottom.css({
        top: Math.round(b.y2)+'px',
        left: Math.round(b.x)+'px',
        width: Math.round(b.w)+'px',
        height: (t.elh-Math.round(b.y2))+'px'
      });
      s.right.css({
        left: Math.round(b.x2)+'px',
        width: (t.elw-Math.round(b.x2))+'px'
      });
      s.left.css({
        width: Math.round(b.x)+'px'
      });

      if (!t.visible) {
        t.container.show();
        t.visible = true;
      }

      return b;
    }
  });
  Jcrop.registerFilter('shader',ShadeFilter);
  

  /**
   *  CanvasAnimator
   *  manages smooth cropping animation
   *
   *  This object is called internally to manage animation.
   *  An in-memory div is animated and a progress callback
   *  is used to update the selection coordinates of the
   *  visible selection in realtime.
   */
  var CanvasAnimator = function(stage){
    this.stage = stage;
    this.core = stage.core;
    this.cloneStagePosition();
  };

  CanvasAnimator.prototype = {

    cloneStagePosition: function(){
      var s = this.stage;
      this.angle = s.angle;
      this.scale = s.scale;
      this.offset = s.offset;
    },

    getElement: function(){
      var s = this.stage;

      return $('<div />')
        .css({
          position: 'absolute',
          top: s.offset[0]+'px',
          left: s.offset[1]+'px',
          width: s.angle+'px',
          height: s.scale+'px'
        });
    },

    animate: function(cb){
      var t = this;

      this.scale = this.stage.boundScale(this.scale);
      t.stage.triggerEvent('croprotstart');

      t.getElement().animate({
        top: t.offset[0]+'px',
        left: t.offset[1]+'px',
        width: t.angle+'px',
        height: t.scale+'px'
      },{
        easing: t.core.opt.animEasing,
        duration: t.core.opt.animDuration,
        complete: function(){
          t.stage.triggerEvent('croprotend');
          (typeof cb == 'function') && cb.call(this);
        },
        progress: function(anim){
          var props = {}, i, tw = anim.tweens;

          for(i=0;i<tw.length;i++){
            props[tw[i].prop] = tw[i].now; }

          t.stage.setAngle(props.width)
            .setScale(props.height)
            .setOffset(props.top,props.left)
            .redraw();
        }
      });
    }

  };
  Jcrop.stage.Canvas.prototype.getAnimator = function(){
    return new CanvasAnimator(this);
  };
  Jcrop.registerComponent('CanvasAnimator',CanvasAnimator);


  /**
   *  CropAnimator
   *  manages smooth cropping animation
   *
   *  This object is called internally to manage animation.
   *  An in-memory div is animated and a progress callback
   *  is used to update the selection coordinates of the
   *  visible selection in realtime.
   */
  // var CropAnimator = function(selection){{{
  var CropAnimator = function(selection){
    this.selection = selection;
    this.core = selection.core;
  };
  // }}}

  CropAnimator.prototype = {

    getElement: function(){
      var b = this.selection.get();

      return $('<div />')
        .css({
          position: 'absolute',
          top: b.y+'px',
          left: b.x+'px',
          width: b.w+'px',
          height: b.h+'px'
        });
    },

    animate: function(x,y,w,h,cb){
      var t = this;

      t.selection.allowResize(false);

      t.getElement().animate({
        top: y+'px',
        left: x+'px',
        width: w+'px',
        height: h+'px'
      },{
        easing: t.core.opt.animEasing,
        duration: t.core.opt.animDuration,
        complete: function(){
          t.selection.allowResize(true);
          cb && cb.call(this);
        },
        progress: function(anim){
          var props = {}, i, tw = anim.tweens;

          for(i=0;i<tw.length;i++){
            props[tw[i].prop] = tw[i].now; }

          var b = {
            x: parseInt(props.left),
            y: parseInt(props.top),
            w: parseInt(props.width),
            h: parseInt(props.height)
          };

          b.x2 = b.x + b.w;
          b.y2 = b.y + b.h;

          t.selection.updateRaw(b,'se');
        }
      });
    }

  };
  Jcrop.registerComponent('Animator',CropAnimator);


  /**
   *  DragState
   *  an object that handles dragging events
   *
   *  This object is used by the built-in selection object to
   *  track a dragging operation on a selection
   */
  // var DragState = function(e,selection,ord){{{
  var DragState = function(e,selection,ord){
    var t = this;

    t.x = e.pageX;
    t.y = e.pageY;

    t.selection = selection;
    t.eventTarget = selection.core.opt.dragEventTarget;
    t.orig = selection.get();

    selection.callFilterFunction('refresh');

    var p = selection.core.container.position();
    t.elx = p.left;
    t.ely = p.top;

    t.offsetx = 0;
    t.offsety = 0;
    t.ord = ord;
    t.opposite = t.getOppositeCornerOffset();

    t.initEvents(e);

  };
  // }}}

  DragState.prototype = {
    // getOppositeCornerOffset: function(){{{
    // Calculate relative offset of locked corner
    getOppositeCornerOffset: function(){

      var o = this.orig;
      var relx = this.x - this.elx - o.x;
      var rely = this.y - this.ely - o.y;

      switch(this.ord){
        case 'nw':
        case 'w':
          return [ o.w - relx, o.h - rely ];
          return [ o.x + o.w, o.y + o.h ];

        case 'sw':
          return [ o.w - relx, -rely ];
          return [ o.x + o.w, o.y ];

        case 'se':
        case 's':
        case 'e':
          return [ -relx, -rely ];
          return [ o.x, o.y ];

        case 'ne':
        case 'n':
          return [ -relx, o.h - rely ];
          return [ o.w, o.y + o.h ];
      }

      return [ null, null ];
    },
    // }}}
    // initEvents: function(e){{{
    initEvents: function(e){
      $(this.eventTarget)
        .on('mousemove.jcrop',this.createDragHandler())
        .on('mouseup.jcrop',this.createStopHandler());
    },
    // }}}
    // dragEvent: function(e){{{
    dragEvent: function(e){
      this.offsetx = e.pageX - this.x;
      this.offsety = e.pageY - this.y;
      this.selection.updateRaw(this.getBox(),this.ord);
    },
    // }}}
    // endDragEvent: function(e){{{
    endDragEvent: function(e){
      var sel = this.selection;
      sel.core.container.removeClass('jcrop-dragging');
      sel.element.trigger('cropend',[sel,sel.core.unscale(sel.get())]);
      sel.focus();
    },
    // }}}
    // createStopHandler: function(){{{
    createStopHandler: function(){
      var t = this;
      return function(e){
        $(t.eventTarget).off('.jcrop');
        t.endDragEvent(e);
        return false;
      };
    },
    // }}}
    // createDragHandler: function(){{{
    createDragHandler: function(){
      var t = this;
      return function(e){
        t.dragEvent(e);
        return false;
      };
    },
    // }}}
    //update: function(x,y){{{
    update: function(x,y){
      var t = this;
      t.offsetx = x - t.x;
      t.offsety = y - t.y;
    },
    //}}}
    //resultWrap: function(d){{{
    resultWrap: function(d){
      var b = {
          x: Math.min(d[0],d[2]),
          y: Math.min(d[1],d[3]),
          x2: Math.max(d[0],d[2]),
          y2: Math.max(d[1],d[3])
        };

      b.w = b.x2 - b.x;
      b.h = b.y2 - b.y;

      return b;
    },
    //}}}
    //getBox: function(){{{
    getBox: function(){
      var t = this;
      var o = t.orig;
      var _c = { x2: o.x + o.w, y2: o.y + o.h };
      switch(t.ord){
        case 'n': return t.resultWrap([ o.x, t.offsety + o.y, _c.x2, _c.y2 ]);
        case 's': return t.resultWrap([ o.x, o.y, _c.x2, t.offsety + _c.y2 ]);
        case 'e': return t.resultWrap([ o.x, o.y, t.offsetx + _c.x2, _c.y2 ]);
        case 'w': return t.resultWrap([ o.x + t.offsetx, o.y, _c.x2, _c.y2 ]);
        case 'sw': return t.resultWrap([ t.offsetx + o.x, o.y, _c.x2, t.offsety + _c.y2 ]);
        case 'se': return t.resultWrap([ o.x, o.y, t.offsetx + _c.x2, t.offsety + _c.y2 ]);
        case 'ne': return t.resultWrap([ o.x, t.offsety + o.y, t.offsetx + _c.x2, _c.y2 ]);
        case 'nw': return t.resultWrap([ t.offsetx + o.x, t.offsety + o.y, _c.x2, _c.y2 ]);
        case 'move':
          _c.nx = o.x + t.offsetx;
          _c.ny = o.y + t.offsety;
          return t.resultWrap([ _c.nx, _c.ny, _c.nx + o.w, _c.ny + o.h ]);
      }
    }
    //}}}
  };
  Jcrop.registerComponent('DragState',DragState);


  /**
   *  EventManager
   *  provides internal event support
   */
  var EventManager = function(core){
    this.core = core;
  };
  EventManager.prototype = {
      on: function(n,cb){ $(this).on(n,cb); },
      off: function(n){ $(this).off(n); },
      trigger: function(n){ $(this).trigger(n); }
  };
  Jcrop.registerComponent('EventManager',EventManager);


  /**
   * Image Loader
   * Reliably pre-loads images
   */
  // var ImageLoader = function(src,element,cb){{{
  var ImageLoader = function(src,element,cb){
    this.src = src;
    if (!element) element = new Image;
    this.element = element;
    this.callback = cb;
    this.load();
  };
  // }}}

  $.extend(ImageLoader,{
    // attach: function(el,cb){{{
    attach: function(el,cb){
      return new ImageLoader(el.src,el,cb);
    },
    // }}}
    // prototype: {{{
    prototype: {
      getDimensions: function(){
        var el = this.element;

        if (el.naturalWidth)
          return [ el.naturalWidth, el. naturalHeight ];

        if (el.width)
          return [ el.width, el.height ];

        return null;
      },
      fireCallback: function(){
        this.element.onload = null;
        if (typeof this.callback == 'function')
          this.callback.apply(this,this.getDimensions());
      },
      isLoaded: function(){
        return this.element.complete;
      },
      load: function(){
        var t = this;
        var el = t.element;

        el.src = t.src;

        if (t.isLoaded()) t.fireCallback();
          else t.element.onload = function(e){
            t.fireCallback();
          };
      }
    }
    // }}}
  });
  Jcrop.registerComponent('ImageLoader',ImageLoader);


  /**
   * JcropTouch
   * Detects and enables mobile touch support
   */
  // var JcropTouch = function(core){{{
  var JcropTouch = function(core){
    this.core = core;
    this.init();
  };
  // }}}

  $.extend(JcropTouch,{
    // support: function(){{{
    support: function(){
      if(('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch)
        return true;
    },
    // }}}
    prototype: {
      // init: function(){{{
      init: function(){
        var t = this,
          p = $.Jcrop.component.DragState.prototype;

        // A bit of an ugly hack to make sure we modify prototype
        // only once, store a key on the prototype
        if (!p.touch) {
          t.initEvents();
          t.shimDragState();
          t.shimStageDrag();
          p.touch = true;
        }
      },
      // }}}
      // shimDragState: function(){{{
      shimDragState: function(){
        var t = this;
        $.Jcrop.component.DragState.prototype.initEvents = function(e){
          
          // Attach subsequent drag event handlers based on initial
          // event type - avoids collecting "pseudo-mouse" events
          // generated by some mobile browsers in some circumstances
          if (e.type.substr(0,5) == 'touch') {

            $(this.eventTarget)
              .on('touchmove.jcrop.jcrop-touch',t.dragWrap(this.createDragHandler()))
              .on('touchend.jcrop.jcrop-touch',this.createStopHandler());

          }
          
          // For other events, use the mouse handlers that
          // the default DragState.initEvents() method sets...
          else {

            $(this.eventTarget)
              .on('mousemove.jcrop',this.createDragHandler())
              .on('mouseup.jcrop',this.createStopHandler());

          }

        };
      },
      // }}}
      // shimStageDrag: function(){{{
      shimStageDrag: function(){
        this.core.container
          .addClass('jcrop-touch')
          .on('touchstart.jcrop.jcrop-stage',this.dragWrap(this.core.ui.manager.startDragHandler()));
      },
      // }}}
      // dragWrap: function(cb){{{
      dragWrap: function(cb){
        return function(e){
          e.preventDefault();
          e.stopPropagation();
          if (e.type.substr(0,5) == 'touch') {
            e.pageX = e.originalEvent.changedTouches[0].pageX;
            e.pageY = e.originalEvent.changedTouches[0].pageY;
            return cb(e);
          }
          return false;
        };
      },
      // }}}
      // initEvents: function(){{{
      initEvents: function(){
        var t = this, c = t.core;

        c.container.on(
          'touchstart.jcrop.jcrop-touch',
          '.'+c.opt.css_drag,
          t.dragWrap(c.startDrag())
        );
      }
      // }}}
    }
  });
  Jcrop.registerComponent('Touch',JcropTouch);


  /**
   *  KeyWatcher
   *  provides keyboard support
   */
  // var KeyWatcher = function(core){{{
  var KeyWatcher = function(core){
    this.core = core;
    this.init();
  };
  // }}}
  $.extend(KeyWatcher,{
    // defaults: {{{
    defaults: {
      eventName: 'keydown.jcrop',
      passthru: [ 9 ],
      debug: false
    },
    // }}}
    prototype: {
      // init: function(){{{
      init: function(){
        $.extend(this,KeyWatcher.defaults);
        this.enable();
      },
      // }}}
      // disable: function(){{{
      disable: function(){
        this.core.container.off(this.eventName);
      },
      // }}}
      // enable: function(){{{
      enable: function(){
        var t = this, m = t.core;
        m.container.on(t.eventName,function(e){
          var nudge = e.shiftKey? 16: 2;

          if ($.inArray(e.keyCode,t.passthru) >= 0)
            return true;

          switch(e.keyCode){
            case 37: m.nudge(-nudge,0); break;
            case 38: m.nudge(0,-nudge); break;
            case 39: m.nudge(nudge,0); break;
            case 40: m.nudge(0,nudge); break;

            case 46:
            case 8:
              m.requestDelete();
              return false;
              break;

            default:
              if (t.debug) console.log('keycode: ' + e.keyCode);
              break;
          }

          if (!e.metaKey && !e.ctrlKey)
            e.preventDefault();
        });
      }
      // }}}
    }
  });
  Jcrop.registerComponent('Keyboard',KeyWatcher);


  /**
   * Selection
   * Built-in selection object
   */
  var Selection = function(){};

  $.extend(Selection,{
    // defaults: {{{
    defaults: {
      minSize: [ 8, 8 ],
      maxSize: [ 0, 0 ],
      aspectRatio: 0,
      edge: { n: 0, s: 0, e: 0, w: 0 },
      bgColor: null,
      bgOpacity: null,
      last: null,

      state: null,
      active: true,
      linked: true,
      canDelete: true,
      canDrag: true,
      canResize: true,
      canSelect: true
    },
    // }}}
    prototype: {
      // init: function(core){{{
      init: function(core){
        this.core = core;
        this.startup();
        this.linked = this.core.opt.linked;
        this.attach();
        this.setOptions(this.core.opt);
        core.container.trigger('cropcreate',[this]);
      },
      // }}}
      // attach: function(){{{
      attach: function(){
        // For extending init() sequence
      },
      // }}}
      // startup: function(){{{
      startup: function(){
        var t = this, o = t.core.opt;
        $.extend(t,Selection.defaults);
        t.filter = t.core.getDefaultFilters();

        t.element = $('<div />').addClass(o.css_selection).data({ selection: t });
        t.frame = $('<button />').addClass(o.css_button).data('ord','move').attr('type','button');
        t.element.append(t.frame).appendTo(t.core.container);

        // IE background/draggable hack
        if (t.core.opt.is_msie) t.frame.css({
          opacity: 0,
          backgroundColor: 'white'
        });

        t.insertElements();

        // Bind focus and blur events for this selection
        t.frame.on('focus.jcrop',function(e){
          t.core.setSelection(t);
          t.element.trigger('cropfocus',t);
          t.element.addClass('jcrop-focus');
        }).on('blur.jcrop',function(e){
          t.element.removeClass('jcrop-focus');
          t.element.trigger('cropblur',t);
        });
      },
      // }}}
      // propagate: [{{{
      propagate: [
        'canDelete', 'canDrag', 'canResize', 'canSelect',
        'minSize', 'maxSize', 'aspectRatio', 'edge'
      ],
      // }}}
      // setOptions: function(opt){{{
      setOptions: function(opt){
        Jcrop.propagate(this.propagate,opt,this);
        this.refresh();
        return this;
      },
      // }}}
      // refresh: function(){{{
      refresh: function(){
        this.allowResize();
        this.allowDrag();
        this.allowSelect();
        this.callFilterFunction('refresh');
        this.updateRaw(this.get(),'se');
      },
      // }}}
      // callFilterFunction: function(f,args){{{
      callFilterFunction: function(f,args){
        for(var i=0;i<this.filter.length;i++)
          if (this.filter[i][f]) this.filter[i][f](this);
        return this;
      },
      // }}}
      //addFilter: function(filter){{{
      addFilter: function(filter){
        filter.core = this.core;
        if (!this.hasFilter(filter)) {
          this.filter.push(filter);
          this.sortFilters();
          if (filter.init) filter.init();
          this.refresh();
        }
      },
      //}}}
      // hasFilter: function(filter){{{
      hasFilter: function(filter){
        var i, f = this.filter, n = [];
        for(i=0;i<f.length;i++) if (f[i] === filter) return true;
      },
      // }}}
      // sortFilters: function(){{{
      sortFilters: function(){
        this.filter.sort(
          function(x,y){ return x.priority - y.priority; }
        );
      },
      // }}}
      //clearFilters: function(){{{
      clearFilters: function(){
        var i, f = this.filter;

        for(var i=0;i<f.length;i++)
          if (f[i].destroy) f[i].destroy();

        this.filter = [];
      },
      //}}}
      // removeFiltersByTag: function(tag){{{
      removeFilter: function(tag){
        var i, f = this.filter, n = [];

        for(var i=0;i<f.length;i++)
          if ((f[i].tag && (f[i].tag == tag)) || (tag === f[i])){
            if (f[i].destroy) f[i].destroy();
          }
          else n.push(f[i]);

        this.filter = n;
      },
      // }}}
      // runFilters: function(b,ord){{{
      runFilters: function(b,ord){
        for(var i=0;i<this.filter.length;i++)
          b = this.filter[i].filter(b,ord,this);
        return b;
      },
      // }}}
      //endDrag: function(){{{
      endDrag: function(){
        if (this.state) {
          $(document.body).off('.jcrop');
          this.focus();
          this.state = null;
        }
      },
      //}}}
      // startDrag: function(e,ord){{{
      startDrag: function(e,ord){
        var t = this;
        var m = t.core;

        ord = ord || $(e.target).data('ord');

        this.focus();

        if ((ord == 'move') && t.element.hasClass(t.core.opt.css_nodrag))
          return false;

        this.state = new Jcrop.component.DragState(e,this,ord);
        return false;
      },
      // }}}
      // allowSelect: function(v){{{
      allowSelect: function(v){
        if (v === undefined) v = this.canSelect;

        if (v && this.canSelect) this.frame.attr('disabled',false);
          else this.frame.attr('disabled','disabled');

        return this;
      },
      // }}}
      // allowDrag: function(v){{{
      allowDrag: function(v){
        var t = this, o = t.core.opt;
        if (v == undefined) v = t.canDrag;

        if (v && t.canDrag) t.element.removeClass(o.css_nodrag);
          else t.element.addClass(o.css_nodrag);

        return this;
      },
      // }}}
      // allowResize: function(v){{{
      allowResize: function(v){
        var t = this, o = t.core.opt;
        if (v == undefined) v = t.canResize;

        if (v && t.canResize) t.element.removeClass(o.css_noresize);
          else t.element.addClass(o.css_noresize);

        return this;
      },
      // }}}
      // remove: function(){{{
      remove: function(){
        this.element.trigger('cropremove',this);
        this.element.remove();
      },
      // }}}
      // toBack: function(){{{
      toBack: function(){
        this.active = false;
        this.element.removeClass('jcrop-current jcrop-focus');
      },
      // }}}
      // toFront: function(){{{
      toFront: function(){
        this.active = true;
        this.element.addClass('jcrop-current');
        this.callFilterFunction('refresh');
        this.refresh();
      },
      // }}}
      // redraw: function(b){{{
      redraw: function(b){
        this.moveTo(b.x,b.y);
        this.resize(b.w,b.h);
        this.last = b;
        return this;
      },
      // }}}
      // update: function(b,ord){{{
      update: function(b,ord){
        return this.updateRaw(this.core.scale(b),ord);
      },
      // }}}
      // update: function(b,ord){{{
      updateRaw: function(b,ord){
        b = this.runFilters(b,ord);
        this.redraw(b);
        this.element.trigger('cropmove',[this,this.core.unscale(b)]);
        return this;
      },
      // }}}
      // animateTo: function(box,cb){{{
      animateTo: function(box,cb){
        var ca = new Jcrop.component.Animator(this),
            b = this.core.scale(Jcrop.wrapFromXywh(box));

        ca.animate(b.x,b.y,b.w,b.h,cb);
      },
      // }}}
      // center: function(instant){{{
      center: function(instant){
        var b = this.get(), m = this.core;
        var elw = m.container.width(), elh = m.container.height();
        var box = [ (elw-b.w)/2, (elh-b.h)/2, b.w, b.h ];
        return this[instant?'setSelect':'animateTo'](box);
      },
      // }}}
      //createElement: function(type,ord){{{
      createElement: function(type,ord){
        return $('<div />').addClass(type+' ord-'+ord).data('ord',ord);
      },
      //}}}
      //moveTo: function(x,y){{{
      moveTo: function(x,y){
        this.element.css({top: y+'px', left: x+'px'});
      },
      //}}}
      // blur: function(){{{
      blur: function(){
        this.element.blur();
        return this;
      },
      // }}}
      // focus: function(){{{
      focus: function(){
        this.core.setSelection(this);
        this.frame.focus();
        return this;
      },
      // }}}
      //resize: function(w,h){{{
      resize: function(w,h){
        this.element.css({width: w+'px', height: h+'px'});
      },
      //}}}
      //get: function(){{{
      get: function(){
        var b = this.element,
          o = b.position(),
          w = b.width(),
          h = b.height(),
          rv = { x: o.left, y: o.top };

        rv.x2 = rv.x + w;
        rv.y2 = rv.y + h;
        rv.w = w;
        rv.h = h;

        return rv;
      },
      //}}}
      //insertElements: function(){{{
      insertElements: function(){
        var t = this, i,
          m = t.core,
          fr = t.element,
          o = t.core.opt,
          b = o.borders,
          h = o.handles,
          d = o.dragbars;

        for(i=0; i<d.length; i++)
          fr.append(t.createElement(o.css_dragbars,d[i]));

        for(i=0; i<h.length; i++)
          fr.append(t.createElement(o.css_handles,h[i]));

        for(i=0; i<b.length; i++)
          fr.append(t.createElement(o.css_borders,b[i]));
      }
      //}}}
    }
  });
  Jcrop.registerComponent('Selection',Selection);


  /**
   * StageDrag
   * Facilitates dragging
   */
  // var StageDrag = function(manager,opt){{{
  var StageDrag = function(manager,opt){
    $.extend(this,StageDrag.defaults,opt || {});
    this.manager = manager;
    this.core = manager.core;
  };
  // }}}
  // StageDrag.defaults = {{{
  StageDrag.defaults = {
    offset: [ -8, -8 ],
    active: true,
    minsize: [ 20, 20 ]
  };
  // }}}

  $.extend(StageDrag.prototype,{
    // start: function(e){{{
    start: function(e){
      var c = this.core;

      // Do nothing if allowSelect is off
      if (!c.opt.allowSelect) return;

      // Also do nothing if we can't draw any more selections
      if (c.opt.multi && c.opt.multiMax && (c.ui.multi.length >= c.opt.multiMax)) return false;

      // calculate a few variables for this drag operation
      var o = $(e.currentTarget).offset();
      var origx = e.pageX - o.left + this.offset[0];
      var origy = e.pageY - o.top + this.offset[1];
      var m = c.ui.multi;

      // Determine newly dragged crop behavior if multi disabled
      if (!c.opt.multi) {
        // For multiCleaanup true, remove all existing selections
        if (c.opt.multiCleanup){
          for(var i=0;i<m.length;i++) m[i].remove();
          c.ui.multi = [];
        }
        // If not, only remove the currently active selection
        else {
          c.removeSelection(c.ui.selection);
        }
      }

      c.container.addClass('jcrop-dragging');

      // Create the new selection
      var sel = c.newSelection()
        // and position it
        .updateRaw(Jcrop.wrapFromXywh([origx,origy,1,1]));

      sel.element.trigger('cropstart',[sel,this.core.unscale(sel.get())]);
      
      return sel.startDrag(e,'se');
    },
    // }}}
    // end: function(x,y){{{
    end: function(x,y){
      this.drag(x,y);
      var b = this.sel.get();

      this.core.container.removeClass('jcrop-dragging');

      if ((b.w < this.minsize[0]) || (b.h < this.minsize[1]))
        this.core.requestDelete();

        else this.sel.focus();
    }
    // }}}
  });
  Jcrop.registerComponent('StageDrag',StageDrag);


  /**
   * StageManager
   * Provides basic stage-specific functionality
   */
  // var StageManager = function(core){{{
  var StageManager = function(core){
    this.core = core;
    this.ui = core.ui;
    this.init();
  };
  // }}}

  $.extend(StageManager.prototype,{
    // init: function(){{{
    init: function(){
      this.setupEvents();
      this.dragger = new StageDrag(this);
    },
    // }}}
    // tellConfigUpdate: function(options){{{
    tellConfigUpdate: function(options){
      for(var i=0,m=this.ui.multi,l=m.length;i<l;i++)
        if (m[i].setOptions && (m[i].linked || (this.core.opt.linkCurrent && m[i] == this.ui.selection)))
          m[i].setOptions(options);
    },
    // }}}
    // startDragHandler: function(){{{
    startDragHandler: function(){
      var t = this;
      return function(e){
        if (!e.button || t.core.opt.is_ie_lt9) return t.dragger.start(e);
      };
    },
    // }}}
    // removeEvents: function(){{{
    removeEvents: function(){
      this.core.event.off('.jcrop-stage');
      this.core.container.off('.jcrop-stage');
    },
    // }}}
    // shimLegacyHandlers: function(options){{{
    // This method uses the legacyHandlers configuration object to
    // gracefully wrap old-style Jcrop events with new ones
    shimLegacyHandlers: function(options){
      var _x = {}, core = this.core, tmp;

      $.each(core.opt.legacyHandlers,function(k,i){
        if (k in options) {
          tmp = options[k];
          core.container.off('.jcrop-'+k)
            .on(i+'.jcrop.jcrop-'+k,function(e,s,c){
              tmp.call(core,c);
            });
          delete options[k];
        }
      });
    },
    // }}}
    // setupEvents: function(){{{
    setupEvents: function(){
      var t = this, c = t.core;

      c.event.on('configupdate.jcrop-stage',function(e){
        t.shimLegacyHandlers(c.opt);
        t.tellConfigUpdate(c.opt)
        c.container.trigger('cropconfig',[c,c.opt]);
      });

      this.core.container
        .on('mousedown.jcrop.jcrop-stage',this.startDragHandler());
    }
    // }}}
  });
  Jcrop.registerComponent('StageManager',StageManager);


  var Thumbnailer = function(){
  };

  $.extend(Thumbnailer,{
    defaults: {
      // Set to a specific Selection object
      // If this value is set, the preview will only track that Selection
      selection: null,

      fading: true,
      fadeDelay: 1000,
      fadeDuration: 1000,
      autoHide: false,
      width: 80,
      height: 80,
      _hiding: null
    },

    prototype: {
      recopyCanvas: function(){
        var s = this.core.ui.stage, cxt = s.context;
        this.context.putImageData(cxt.getImageData(0,0,s.canvas.width,s.canvas.height),0,0);
      },
      init: function(core,options){
        var t = this;
        this.core = core;
        $.extend(this,Thumbnailer.defaults,options);
        t.initEvents();
        t.refresh();
        t.insertElements();
        if (t.selection) {
          t.renderSelection(t.selection);
          t.selectionTarget = t.selection.element[0];
        } else if (t.core.ui.selection) {
          t.renderSelection(t.core.ui.selection);
        }

        if (t.core.ui.stage.canvas) {
          t.context = t.preview[0].getContext('2d');
          t.core.container.on('cropredraw',function(e){
            t.recopyCanvas();
            t.refresh();
          });
        }
      },
      updateImage: function(imgel){
        this.preview.remove();
        this.preview = $($.Jcrop.imageClone(imgel));
        this.element.append(this.preview);
        this.refresh();
        return this;
      },
      insertElements: function(){
        this.preview = $($.Jcrop.imageClone(this.core.ui.stage.imgsrc));

        this.element = $('<div />').addClass('jcrop-thumb')
          .width(this.width).height(this.height)
          .append(this.preview)
          .appendTo(this.core.container);
      },
      resize: function(w,h){
        this.width = w;
        this.height = h;
        this.element.width(w).height(h);
        this.renderCoords(this.last);
      },
      refresh: function(){
        this.cw = (this.core.opt.xscale * this.core.container.width());
        this.ch = (this.core.opt.yscale * this.core.container.height());
        if (this.last) {
          this.renderCoords(this.last);
        }
      },
      renderCoords: function(c){
        var rx = this.width / c.w;
        var ry = this.height / c.h;

        this.preview.css({
          width: Math.round(rx * this.cw) + 'px',
          height: Math.round(ry * this.ch) + 'px',
          marginLeft: '-' + Math.round(rx * c.x) + 'px',
          marginTop: '-' + Math.round(ry * c.y) + 'px'
        });

        this.last = c;
        return this;
      },
      renderSelection: function(s){
        return this.renderCoords(s.core.unscale(s.get()));
      },
      selectionStart: function(s){
        this.renderSelection(s);
      },
      show: function(){
        if (this._hiding) clearTimeout(this._hiding);

        if (!this.fading) this.element.stop().css({ opacity: 1 });
        else this.element.stop().animate({ opacity: 1 },{ duration: 80, queue: false });
      },
      hide: function(){
        var t = this;
        if (!t.fading) t.element.hide();
        else t._hiding = setTimeout(function(){
          t._hiding = null;
          t.element.stop().animate({ opacity: 0 },{ duration: t.fadeDuration, queue: false });
        },t.fadeDelay);
      },
      initEvents: function(){
        var t = this;
        t.core.container.on('croprotstart croprotend cropimage cropstart cropmove cropend',function(e,s,c){
          if (t.selectionTarget && (t.selectionTarget !== e.target)) return false;

          switch(e.type){

            case 'cropimage':
              t.updateImage(c);
              break;

            case 'cropstart':
              t.selectionStart(s);
            case 'croprotstart':
              t.show();
              break;

            case 'cropend':
              t.renderCoords(c);
            case 'croprotend':
              if (t.autoHide) t.hide();
              break;

            case 'cropmove':
              t.renderCoords(c);
              break;
          }
        });
      }
    }
  });
  Jcrop.registerComponent('Thumbnailer',Thumbnailer);


  /**
   * DialDrag component
   * This is a little hacky, it was adapted from some previous/old code
   * Plan to update this API in the future
   */
  var DialDrag = function() { };

  DialDrag.prototype = {

    init: function(core,actuator,callback){
      var that = this;

      if (!actuator) actuator = core.container;
      this.$btn = $(actuator);
      this.$targ = $(actuator);
      this.core = core;

      this.$btn
        .addClass('dialdrag')
        .on('mousedown.dialdrag',this.mousedown())
        .data('dialdrag',this);

      if (!$.isFunction(callback)) callback = function(){ };
      this.callback = callback;
      this.ondone = callback;
    },

    remove: function(){
      this.$btn
        .removeClass('dialdrag')
        .off('.dialdrag')
        .data('dialdrag',null);
      return this;
    },

    setTarget: function(obj){
      this.$targ = $(obj);
      return this;
    },

    getOffset: function(){
      var targ = this.$targ, pos = targ.offset();
      return [
        pos.left + (targ.width()/2),
        pos.top + (targ.height()/2)
      ];
    },

    relMouse: function(e){
      var x = e.pageX - this.offset[0],
          y = e.pageY - this.offset[1],
          ang = Math.atan2(y,x) * (180 / Math.PI),
          vec = Math.sqrt(Math.pow(x,2)+Math.pow(y,2));
      return [ x, y, ang, vec ];
    },

    mousedown: function(){
      var that = this;

      function mouseUp(e){
        $(window).off('.dialdrag');
        that.ondone.call(that,that.relMouse(e));
        that.core.container.trigger('croprotend');
      }

      function mouseMove(e){
        that.callback.call(that,that.relMouse(e));
      }

      return function(e) {
        that.offset = that.getOffset();
        var rel = that.relMouse(e);
        that.angleOffset = -that.core.ui.stage.angle+rel[2];
        that.distOffset = rel[3];
        that.dragOffset = [rel[0],rel[1]];
        that.core.container.trigger('croprotstart');

        $(window)
          .on('mousemove.dialdrag',mouseMove)
          .on('mouseup.dialdrag',mouseUp);

        that.callback.call(that,that.relMouse(e));

        return false;
      };
    }
    
  };
  Jcrop.registerComponent('DialDrag',DialDrag);


    /////////////////////////////////
    // DEFAULT SETTINGS

    Jcrop.defaults = {

      // Selection Behavior
      edge: { n: 0, s: 0, e: 0, w: 0 },
      setSelect: null,
      linked: true,
      linkCurrent: true,
      canDelete: true,
      canSelect: true,
      canDrag: true,
      canResize: true,

      // Component constructors
      eventManagerComponent:  Jcrop.component.EventManager,
      keyboardComponent:      Jcrop.component.Keyboard,
      dragstateComponent:     Jcrop.component.DragState,
      stagemanagerComponent:  Jcrop.component.StageManager,
      animatorComponent:      Jcrop.component.Animator,
      selectionComponent:     Jcrop.component.Selection,

      // This is a function that is called, which returns a stage object
      stageConstructor:       Jcrop.stageConstructor,

      // Stage Behavior
      allowSelect: true,
      multi: false,
      multiMax: false,
      multiCleanup: true,
      animation: true,
      animEasing: 'swing',
      animDuration: 400,
      fading: true,
      fadeDuration: 300,
      fadeEasing: 'swing',
      bgColor: 'black',
      bgOpacity: .5,

      // Startup options
      applyFilters: [ 'constrain', 'extent', 'backoff', 'ratio', 'shader', 'round' ],
      borders:  [ 'e', 'w', 's', 'n' ],
      handles:  [ 'n', 's', 'e', 'w', 'sw', 'ne', 'nw', 'se' ],
      dragbars: [ 'n', 'e', 'w', 's' ],

      dragEventTarget: window,

      xscale: 1,
      yscale: 1,

      boxWidth: null,
      boxHeight: null,

      // CSS Classes
      // @todo: These need to be moved to top-level object keys
      // for better customization. Currently if you try to extend one
      // via an options object to Jcrop, it will wipe out all
      // the others you don't specify. Be careful for now!
      css_nodrag: 'jcrop-nodrag',
      css_drag: 'jcrop-drag',
      css_container: 'jcrop-active',
      css_shades: 'jcrop-shades',
      css_selection: 'jcrop-selection',
      css_borders: 'jcrop-border',
      css_handles: 'jcrop-handle jcrop-drag',
      css_button: 'jcrop-box jcrop-drag',
      css_noresize: 'jcrop-noresize',
      css_dragbars: 'jcrop-dragbar jcrop-drag',

      legacyHandlers: {
        onChange: 'cropmove',
        onSelect: 'cropend'
      }

    };


  // Jcrop API methods
  $.extend(Jcrop.prototype,{
    //init: function(){{{
    init: function(){
      this.event = new this.opt.eventManagerComponent(this);
      this.ui.keyboard = new this.opt.keyboardComponent(this);
      this.ui.manager = new this.opt.stagemanagerComponent(this);
      this.applyFilters();

      if ($.Jcrop.supportsTouch)
        new $.Jcrop.component.Touch(this);

      this.initEvents();
    },
    //}}}
    // applySizeConstraints: function(){{{
    applySizeConstraints: function(){
      var o = this.opt,
          img = this.opt.imgsrc;

      if (img){

        var iw = img.naturalWidth || img.width,
            ih = img.naturalHeight || img.height,
            bw = o.boxWidth || iw,
            bh = o.boxHeight || ih;

        if (img && ((iw > bw) || (ih > bh))){
          var bx = Jcrop.getLargestBox(iw/ih,bw,bh);
          $(img).width(bx[0]).height(bx[1]);
          this.resizeContainer(bx[0],bx[1]);
          this.opt.xscale = iw / bx[0];
          this.opt.yscale = ih / bx[1];
        }
          
      }

      if (this.opt.trueSize){
        var dw = this.opt.trueSize[0];
        var dh = this.opt.trueSize[1];
        var cs = this.getContainerSize();
        this.opt.xscale = dw / cs[0];
        this.opt.yscale = dh / cs[1];
      }
    },
    // }}}
    initComponent: function(name){
      if (Jcrop.component[name]) {
        var args = Array.prototype.slice.call(arguments);
        var obj = new Jcrop.component[name];
        args.shift();
        args.unshift(this);
        obj.init.apply(obj,args);
        return obj;
      }
    },
    // setOptions: function(opt){{{
    setOptions: function(opt,proptype){

      if (!$.isPlainObject(opt)) opt = {};

      $.extend(this.opt,opt);

      // Handle a setSelect value
      if (this.opt.setSelect) {

        // If there is no current selection
        // passing setSelect will create one
        if (!this.ui.multi.length)
          this.newSelection();

        // Use these values to update the current selection
        this.setSelect(this.opt.setSelect);

        // Set to null so it doesn't get called again
        this.opt.setSelect = null;
      }

      this.event.trigger('configupdate');
      return this;
    },
    // }}}
    //destroy: function(){{{
    destroy: function(){
      if (this.opt.imgsrc) {
        this.container.before(this.opt.imgsrc);
        this.container.remove();
        $(this.opt.imgsrc).removeData('Jcrop').show();
      } else {
        // @todo: more elegant destroy() process for non-image containers
        this.container.remove();
      }
    },
    // }}}
    // applyFilters: function(){{{
    applyFilters: function(){
      var obj;
      for(var i=0,f=this.opt.applyFilters,l=f.length; i<l; i++){
        if ($.Jcrop.filter[f[i]])
          obj = new $.Jcrop.filter[f[i]];
          obj.core = this;
          if (obj.init) obj.init();
          this.filter[f[i]] = obj;
      }
    },
    // }}}
    // getDefaultFilters: function(){{{
    getDefaultFilters: function(){
      var rv = [];

      for(var i=0,f=this.opt.applyFilters,l=f.length; i<l; i++)
        if(this.filter.hasOwnProperty(f[i]))
          rv.push(this.filter[f[i]]);

      rv.sort(function(x,y){ return x.priority - y.priority; });
      return rv;
    },
    // }}}
    // setSelection: function(sel){{{
    setSelection: function(sel){
      var m = this.ui.multi;
      var n = [];
      for(var i=0;i<m.length;i++) {
        if (m[i] !== sel) n.push(m[i]);
        m[i].toBack();
      }
      n.unshift(sel);
      this.ui.multi = n;
      this.ui.selection = sel;
      sel.toFront();
      return sel;
    },
    // }}}
    // getSelection: function(raw){{{
    getSelection: function(raw){
      var b = this.ui.selection.get();
      return b;
    },
    // }}}
    // newSelection: function(){{{
    newSelection: function(sel){
      if (!sel)
        sel = new this.opt.selectionComponent();

      sel.init(this);
      this.setSelection(sel);

      return sel;
    },
    // }}}
    // hasSelection: function(sel){{{
    hasSelection: function(sel){
      for(var i=0;i<this.ui.multi;i++)
        if (sel === this.ui.multi[i]) return true;
    },
    // }}}
    // removeSelection: function(sel){{{
    removeSelection: function(sel){
      var i, n = [], m = this.ui.multi;
      for(var i=0;i<m.length;i++){
        if (sel !== m[i])
          n.push(m[i]);
        else m[i].remove();
      }
      return this.ui.multi = n;
    },
    // }}}
    //addFilter: function(filter){{{
    addFilter: function(filter){
      for(var i=0,m=this.ui.multi,l=m.length; i<l; i++)
        m[i].addFilter(filter);

      return this;
    },
    //}}}
    // removeFiltersByTag: function(tag){{{
    removeFilter: function(filter){
      for(var i=0,m=this.ui.multi,l=m.length; i<l; i++)
        m[i].removeFilter(filter);

      return this;
    },
    // }}}
    // blur: function(){{{
    blur: function(){
      this.ui.selection.blur();
      return this;
    },
    // }}}
    // focus: function(){{{
    focus: function(){
      this.ui.selection.focus();
      return this;
    },
    // }}}
    //initEvents: function(){{{
    initEvents: function(){
      var t = this;
      t.container.on('selectstart',function(e){ return false; })
        .on('mousedown','.'+t.opt.css_drag,t.startDrag());
    },
    //}}}
    // maxSelect: function(){{{
    maxSelect: function(){
      this.setSelect([0,0,this.elw,this.elh]);
    },
    // }}}
    // nudge: function(x,y){{{
    nudge: function(x,y){
      var s = this.ui.selection, b = s.get();

      b.x += x;
      b.x2 += x;
      b.y += y;
      b.y2 += y;

      if (b.x < 0) { b.x2 = b.w; b.x = 0; }
        else if (b.x2 > this.elw) { b.x2 = this.elw; b.x = b.x2 - b.w; }

      if (b.y < 0) { b.y2 = b.h; b.y = 0; }
        else if (b.y2 > this.elh) { b.y2 = this.elh; b.y = b.y2 - b.h; }
      
      s.element.trigger('cropstart',[s,this.unscale(b)]);
      s.updateRaw(b,'move');
      s.element.trigger('cropend',[s,this.unscale(b)]);
    },
    // }}}
    // refresh: function(){{{
    refresh: function(){
      for(var i=0,s=this.ui.multi,l=s.length;i<l;i++)
        s[i].refresh();
    },
    // }}}
    // blurAll: function(){{{
    blurAll: function(){
      var m = this.ui.multi;
      for(var i=0;i<m.length;i++) {
        if (m[i] !== sel) n.push(m[i]);
        m[i].toBack();
      }
    },
    // }}}
    // scale: function(b){{{
    scale: function(b){
      var xs = this.opt.xscale,
          ys = this.opt.yscale;

      return {
        x: b.x / xs,
        y: b.y / ys,
        x2: b.x2 / xs,
        y2: b.y2 / ys,
        w: b.w / xs,
        h: b.h / ys
      };
    },
    // }}}
    // unscale: function(b){{{
    unscale: function(b){
      var xs = this.opt.xscale,
          ys = this.opt.yscale;

      return {
        x: b.x * xs,
        y: b.y * ys,
        x2: b.x2 * xs,
        y2: b.y2 * ys,
        w: b.w * xs,
        h: b.h * ys
      };
    },
    // }}}
    // requestDelete: function(){{{
    requestDelete: function(){
      if ((this.ui.multi.length > 1) && (this.ui.selection.canDelete))
        return this.deleteSelection();
    },
    // }}}
    // deleteSelection: function(){{{
    deleteSelection: function(){
      if (this.ui.selection) {
        this.removeSelection(this.ui.selection);
        if (this.ui.multi.length) this.ui.multi[0].focus();
        this.ui.selection.refresh();
      }
    },
    // }}}
    // animateTo: function(box){{{
    animateTo: function(box){
      if (this.ui.selection)
        this.ui.selection.animateTo(box);
      return this;
    },
    // }}}
    // setselect: function(box){{{
    setSelect: function(box){
      if (this.ui.selection)
        this.ui.selection.update(Jcrop.wrapFromXywh(box));
      return this;
    },
    // }}}
    //startDrag: function(){{{
    startDrag: function(){
      var t = this;
      return function(e){
        var $targ = $(e.target);
        var selection = $targ.closest('.'+t.opt.css_selection).data('selection');
        var ord = $targ.data('ord');
        t.container.trigger('cropstart',[selection,t.unscale(selection.get())]);
        selection.startDrag(e,ord);
        return false;
      };
    },
    //}}}
    // getContainerSize: function(){{{
    getContainerSize: function(){
      return [ this.container.width(), this.container.height() ];
    },
    // }}}
    // resizeContainer: function(w,h){{{
    resizeContainer: function(w,h){
      this.container.width(w).height(h);
      this.refresh();
    },
    // }}}
    // setImage: function(src,cb){{{
    setImage: function(src,cb){
      var t = this, targ = t.opt.imgsrc;

      if (!targ) return false;

      new $.Jcrop.component.ImageLoader(src,null,function(w,h){
        t.resizeContainer(w,h);

        targ.src = src;
        $(targ).width(w).height(h);
        t.applySizeConstraints();
        t.refresh();
        t.container.trigger('cropimage',[t,targ]);

        if (typeof cb == 'function')
          cb.call(t,w,h);
      });
    },
    // }}}
    // update: function(b){{{
    update: function(b){
      if (this.ui.selection)
        this.ui.selection.update(b);
    }
    // }}}
  });

  // Jcrop jQuery plugin function
  $.fn.Jcrop = function(options,callback){
    options = options || {};

    var first = this.eq(0).data('Jcrop');
    var args = Array.prototype.slice.call(arguments);

    // Return API if requested
    if (options == 'api') { return first; }

    // Allow calling API methods (with arguments)
    else if (first && (typeof options == 'string')) {

      // Call method if it exists
      if (first[options]) {
        args.shift();
        first[options].apply(first,args);
        return first;
      }

      // Unknown input/method does not exist
      return false;
    }

    // Otherwise, loop over selected elements
    this.each(function(){
      var t = this, $t = $(this);
      var exists = $t.data('Jcrop');
      var obj;

      // If Jcrop already exists on this element only setOptions()
      if (exists)
        exists.setOptions(options);

      else {

        if (!options.stageConstructor)
          options.stageConstructor = $.Jcrop.stageConstructor;

        options.stageConstructor(this,options,function(stage,options){
          var selection = options.setSelect;
          if (selection) delete(options.setSelect);

          var obj = $.Jcrop.attach(stage.element,options);

          if (typeof stage.attach == 'function')
            stage.attach(obj);

          $t.data('Jcrop',obj);

          if (selection) {
            obj.newSelection();
            obj.setSelect(selection);
          }

          if (typeof callback == 'function')
            callback.call(obj);
        });
      }

      return this;
    });
  };

/* Modernizr 2.7.1 (Custom Build) | MIT & BSD
 * Build: http://modernizr.com/download/#-csstransforms-canvas-canvastext-draganddrop-inlinesvg-svg-svgclippaths-touch-teststyles-testprop-testallprops-hasevent-prefixes-domprefixes-url_data_uri
 */
;

var Modernizr = (function( window, document, undefined ) {

    var version = '2.7.1',

    Modernizr = {},


    docElement = document.documentElement,

    mod = 'modernizr',
    modElem = document.createElement(mod),
    mStyle = modElem.style,

    inputElem  ,


    toString = {}.toString,

    prefixes = ' -webkit- -moz- -o- -ms- '.split(' '),



    omPrefixes = 'Webkit Moz O ms',

    cssomPrefixes = omPrefixes.split(' '),

    domPrefixes = omPrefixes.toLowerCase().split(' '),

    ns = {'svg': 'http://www.w3.org/2000/svg'},

    tests = {},
    inputs = {},
    attrs = {},

    classes = [],

    slice = classes.slice,

    featureName, 


    injectElementWithStyles = function( rule, callback, nodes, testnames ) {

      var style, ret, node, docOverflow,
          div = document.createElement('div'),
                body = document.body,
                fakeBody = body || document.createElement('body');

      if ( parseInt(nodes, 10) ) {
                      while ( nodes-- ) {
              node = document.createElement('div');
              node.id = testnames ? testnames[nodes] : mod + (nodes + 1);
              div.appendChild(node);
          }
      }

                style = ['&#173;','<style id="s', mod, '">', rule, '</style>'].join('');
      div.id = mod;
          (body ? div : fakeBody).innerHTML += style;
      fakeBody.appendChild(div);
      if ( !body ) {
                fakeBody.style.background = '';
                fakeBody.style.overflow = 'hidden';
          docOverflow = docElement.style.overflow;
          docElement.style.overflow = 'hidden';
          docElement.appendChild(fakeBody);
      }

      ret = callback(div, rule);
        if ( !body ) {
          fakeBody.parentNode.removeChild(fakeBody);
          docElement.style.overflow = docOverflow;
      } else {
          div.parentNode.removeChild(div);
      }

      return !!ret;

    },



    isEventSupported = (function() {

      var TAGNAMES = {
        'select': 'input', 'change': 'input',
        'submit': 'form', 'reset': 'form',
        'error': 'img', 'load': 'img', 'abort': 'img'
      };

      function isEventSupported( eventName, element ) {

        element = element || document.createElement(TAGNAMES[eventName] || 'div');
        eventName = 'on' + eventName;

            var isSupported = eventName in element;

        if ( !isSupported ) {
                if ( !element.setAttribute ) {
            element = document.createElement('div');
          }
          if ( element.setAttribute && element.removeAttribute ) {
            element.setAttribute(eventName, '');
            isSupported = is(element[eventName], 'function');

                    if ( !is(element[eventName], 'undefined') ) {
              element[eventName] = undefined;
            }
            element.removeAttribute(eventName);
          }
        }

        element = null;
        return isSupported;
      }
      return isEventSupported;
    })(),


    _hasOwnProperty = ({}).hasOwnProperty, hasOwnProp;

    if ( !is(_hasOwnProperty, 'undefined') && !is(_hasOwnProperty.call, 'undefined') ) {
      hasOwnProp = function (object, property) {
        return _hasOwnProperty.call(object, property);
      };
    }
    else {
      hasOwnProp = function (object, property) { 
        return ((property in object) && is(object.constructor.prototype[property], 'undefined'));
      };
    }


    if (!Function.prototype.bind) {
      Function.prototype.bind = function bind(that) {

        var target = this;

        if (typeof target != "function") {
            throw new TypeError();
        }

        var args = slice.call(arguments, 1),
            bound = function () {

            if (this instanceof bound) {

              var F = function(){};
              F.prototype = target.prototype;
              var self = new F();

              var result = target.apply(
                  self,
                  args.concat(slice.call(arguments))
              );
              if (Object(result) === result) {
                  return result;
              }
              return self;

            } else {

              return target.apply(
                  that,
                  args.concat(slice.call(arguments))
              );

            }

        };

        return bound;
      };
    }

    function setCss( str ) {
        mStyle.cssText = str;
    }

    function setCssAll( str1, str2 ) {
        return setCss(prefixes.join(str1 + ';') + ( str2 || '' ));
    }

    function is( obj, type ) {
        return typeof obj === type;
    }

    function contains( str, substr ) {
        return !!~('' + str).indexOf(substr);
    }

    function testProps( props, prefixed ) {
        for ( var i in props ) {
            var prop = props[i];
            if ( !contains(prop, "-") && mStyle[prop] !== undefined ) {
                return prefixed == 'pfx' ? prop : true;
            }
        }
        return false;
    }

    function testDOMProps( props, obj, elem ) {
        for ( var i in props ) {
            var item = obj[props[i]];
            if ( item !== undefined) {

                            if (elem === false) return props[i];

                            if (is(item, 'function')){
                                return item.bind(elem || obj);
                }

                            return item;
            }
        }
        return false;
    }

    function testPropsAll( prop, prefixed, elem ) {

        var ucProp  = prop.charAt(0).toUpperCase() + prop.slice(1),
            props   = (prop + ' ' + cssomPrefixes.join(ucProp + ' ') + ucProp).split(' ');

            if(is(prefixed, "string") || is(prefixed, "undefined")) {
          return testProps(props, prefixed);

            } else {
          props = (prop + ' ' + (domPrefixes).join(ucProp + ' ') + ucProp).split(' ');
          return testDOMProps(props, prefixed, elem);
        }
    }



    tests['canvas'] = function() {
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    };

    tests['canvastext'] = function() {
        return !!(Modernizr['canvas'] && is(document.createElement('canvas').getContext('2d').fillText, 'function'));
    };
    tests['touch'] = function() {
        var bool;

        if(('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {
          bool = true;
        } else {
          injectElementWithStyles(['@media (',prefixes.join('touch-enabled),('),mod,')','{#modernizr{top:9px;position:absolute}}'].join(''), function( node ) {
            bool = node.offsetTop === 9;
          });
        }

        return bool;
    };

    tests['draganddrop'] = function() {
        var div = document.createElement('div');
        return ('draggable' in div) || ('ondragstart' in div && 'ondrop' in div);
    };


    tests['csstransforms'] = function() {
        return !!testPropsAll('transform');
    };


    tests['svg'] = function() {
        return !!document.createElementNS && !!document.createElementNS(ns.svg, 'svg').createSVGRect;
    };

    tests['inlinesvg'] = function() {
      var div = document.createElement('div');
      div.innerHTML = '<svg/>';
      return (div.firstChild && div.firstChild.namespaceURI) == ns.svg;
    };



    tests['svgclippaths'] = function() {
        return !!document.createElementNS && /SVGClipPath/.test(toString.call(document.createElementNS(ns.svg, 'clipPath')));
    };

    for ( var feature in tests ) {
        if ( hasOwnProp(tests, feature) ) {
                                    featureName  = feature.toLowerCase();
            Modernizr[featureName] = tests[feature]();

            classes.push((Modernizr[featureName] ? '' : 'no-') + featureName);
        }
    }



     Modernizr.addTest = function ( feature, test ) {
       if ( typeof feature == 'object' ) {
         for ( var key in feature ) {
           if ( hasOwnProp( feature, key ) ) {
             Modernizr.addTest( key, feature[ key ] );
           }
         }
       } else {

         feature = feature.toLowerCase();

         if ( Modernizr[feature] !== undefined ) {
                                              return Modernizr;
         }

         test = typeof test == 'function' ? test() : test;

         if (typeof enableClasses !== "undefined" && enableClasses) {
           docElement.className += ' ' + (test ? '' : 'no-') + feature;
         }
         Modernizr[feature] = test;

       }

       return Modernizr; 
     };


    setCss('');
    modElem = inputElem = null;


    Modernizr._version      = version;

    Modernizr._prefixes     = prefixes;
    Modernizr._domPrefixes  = domPrefixes;
    Modernizr._cssomPrefixes  = cssomPrefixes;


    Modernizr.hasEvent      = isEventSupported;

    Modernizr.testProp      = function(prop){
        return testProps([prop]);
    };

    Modernizr.testAllProps  = testPropsAll;


    Modernizr.testStyles    = injectElementWithStyles;
    return Modernizr;

})(window, window.document);
// data uri test.
// https://github.com/Modernizr/Modernizr/issues/14

// This test is asynchronous. Watch out.


// in IE7 in HTTPS this can cause a Mixed Content security popup. 
//  github.com/Modernizr/Modernizr/issues/362
// To avoid that you can create a new iframe and inject this.. perhaps..


(function(){

  var datauri = new Image();


  datauri.onerror = function() {
      Modernizr.addTest('datauri', function () { return false; });
  };  
  datauri.onload = function() {
      Modernizr.addTest('datauri', function () { return (datauri.width == 1 && datauri.height == 1); });
  };

  datauri.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";

})();
;

  // Attach to jQuery object
  $.Jcrop = Jcrop;

  $.Jcrop.supportsCanvas = Modernizr.canvas;
  $.Jcrop.supportsCanvasText = Modernizr.canvastext;
  $.Jcrop.supportsDragAndDrop = Modernizr.draganddrop;
  $.Jcrop.supportsDataURI = Modernizr.datauri;
  $.Jcrop.supportsSVG = Modernizr.svg;
  $.Jcrop.supportsInlineSVG = Modernizr.inlinesvg;
  $.Jcrop.supportsSVGClipPaths = Modernizr.svgclippaths;
  $.Jcrop.supportsCSSTransforms = Modernizr.csstransforms;
  $.Jcrop.supportsTouch = Modernizr.touch;

})(jQuery);

},{}],753:[function(require,module,exports){
/* ========================================================================
 * Bootstrap: modal.js v3.2.0
 * http://getbootstrap.com/javascript/#modals
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // MODAL CLASS DEFINITION
  // ======================

  var Modal = function (element, options) {
    this.options        = options
    this.$body          = $(document.body)
    this.$element       = $(element)
    this.$backdrop      =
    this.isShown        = null
    this.scrollbarWidth = 0

    if (this.options.remote) {
      this.$element
        .find('.modal-content')
        .load(this.options.remote, $.proxy(function () {
          this.$element.trigger('loaded.bs.modal')
        }, this))
    }
  }

  Modal.VERSION  = '3.2.0'

  Modal.DEFAULTS = {
    backdrop: true,
    keyboard: true,
    show: true
  }

  Modal.prototype.toggle = function (_relatedTarget) {
    return this.isShown ? this.hide() : this.show(_relatedTarget)
  }

  Modal.prototype.show = function (_relatedTarget) {
    var that = this
    var e    = $.Event('show.bs.modal', { relatedTarget: _relatedTarget })

    this.$element.trigger(e)

    if (this.isShown || e.isDefaultPrevented()) return

    this.isShown = true

    this.checkScrollbar()
    this.$body.addClass('modal-open')

    this.setScrollbar()
    this.escape()

    this.$element.on('click.dismiss.bs.modal', '[data-dismiss="modal"]', $.proxy(this.hide, this))

    this.backdrop(function () {
      var transition = $.support.transition && that.$element.hasClass('fade')

      if (!that.$element.parent().length) {
        that.$element.appendTo(that.$body) // don't move modals dom position
      }

      that.$element
        .show()
        .scrollTop(0)

      if (transition) {
        that.$element[0].offsetWidth // force reflow
      }

      that.$element
        .addClass('in')
        .attr('aria-hidden', false)

      that.enforceFocus()

      var e = $.Event('shown.bs.modal', { relatedTarget: _relatedTarget })

      transition ?
        that.$element.find('.modal-dialog') // wait for modal to slide in
          .one('bsTransitionEnd', function () {
            that.$element.trigger('focus').trigger(e)
          })
          .emulateTransitionEnd(300) :
        that.$element.trigger('focus').trigger(e)
    })
  }

  Modal.prototype.hide = function (e) {
    if (e) e.preventDefault()

    e = $.Event('hide.bs.modal')

    this.$element.trigger(e)

    if (!this.isShown || e.isDefaultPrevented()) return

    this.isShown = false

    this.$body.removeClass('modal-open')

    this.resetScrollbar()
    this.escape()

    $(document).off('focusin.bs.modal')

    this.$element
      .removeClass('in')
      .attr('aria-hidden', true)
      .off('click.dismiss.bs.modal')

    $.support.transition && this.$element.hasClass('fade') ?
      this.$element
        .one('bsTransitionEnd', $.proxy(this.hideModal, this))
        .emulateTransitionEnd(300) :
      this.hideModal()
  }

  Modal.prototype.enforceFocus = function () {
    $(document)
      .off('focusin.bs.modal') // guard against infinite focus loop
      .on('focusin.bs.modal', $.proxy(function (e) {
        if (this.$element[0] !== e.target && !this.$element.has(e.target).length) {
          this.$element.trigger('focus')
        }
      }, this))
  }

  Modal.prototype.escape = function () {
    if (this.isShown && this.options.keyboard) {
      this.$element.on('keyup.dismiss.bs.modal', $.proxy(function (e) {
        e.which == 27 && this.hide()
      }, this))
    } else if (!this.isShown) {
      this.$element.off('keyup.dismiss.bs.modal')
    }
  }

  Modal.prototype.hideModal = function () {
    var that = this
    this.$element.hide()
    this.backdrop(function () {
      that.$element.trigger('hidden.bs.modal')
    })
  }

  Modal.prototype.removeBackdrop = function () {
    this.$backdrop && this.$backdrop.remove()
    this.$backdrop = null
  }

  Modal.prototype.backdrop = function (callback) {
    var that = this
    var animate = this.$element.hasClass('fade') ? 'fade' : ''

    if (this.isShown && this.options.backdrop) {
      var doAnimate = $.support.transition && animate

      this.$backdrop = $('<div class="modal-backdrop ' + animate + '" />')
        .appendTo(this.$body)

      this.$element.on('click.dismiss.bs.modal', $.proxy(function (e) {
        if (e.target !== e.currentTarget) return
        this.options.backdrop == 'static'
          ? this.$element[0].focus.call(this.$element[0])
          : this.hide.call(this)
      }, this))

      if (doAnimate) this.$backdrop[0].offsetWidth // force reflow

      this.$backdrop.addClass('in')

      if (!callback) return

      doAnimate ?
        this.$backdrop
          .one('bsTransitionEnd', callback)
          .emulateTransitionEnd(150) :
        callback()

    } else if (!this.isShown && this.$backdrop) {
      this.$backdrop.removeClass('in')

      var callbackRemove = function () {
        that.removeBackdrop()
        callback && callback()
      }
      $.support.transition && this.$element.hasClass('fade') ?
        this.$backdrop
          .one('bsTransitionEnd', callbackRemove)
          .emulateTransitionEnd(150) :
        callbackRemove()

    } else if (callback) {
      callback()
    }
  }

  Modal.prototype.checkScrollbar = function () {
    if (document.body.clientWidth >= window.innerWidth) return
    this.scrollbarWidth = this.scrollbarWidth || this.measureScrollbar()
  }

  Modal.prototype.setScrollbar = function () {
    var bodyPad = parseInt((this.$body.css('padding-right') || 0), 10)
    if (this.scrollbarWidth) this.$body.css('padding-right', bodyPad + this.scrollbarWidth)
  }

  Modal.prototype.resetScrollbar = function () {
    this.$body.css('padding-right', '')
  }

  Modal.prototype.measureScrollbar = function () { // thx walsh
    var scrollDiv = document.createElement('div')
    scrollDiv.className = 'modal-scrollbar-measure'
    this.$body.append(scrollDiv)
    var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth
    this.$body[0].removeChild(scrollDiv)
    return scrollbarWidth
  }


  // MODAL PLUGIN DEFINITION
  // =======================

  function Plugin(option, _relatedTarget) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.modal')
      var options = $.extend({}, Modal.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data) $this.data('bs.modal', (data = new Modal(this, options)))
      if (typeof option == 'string') data[option](_relatedTarget)
      else if (options.show) data.show(_relatedTarget)
    })
  }

  var old = $.fn.modal

  $.fn.modal             = Plugin
  $.fn.modal.Constructor = Modal


  // MODAL NO CONFLICT
  // =================

  $.fn.modal.noConflict = function () {
    $.fn.modal = old
    return this
  }


  // MODAL DATA-API
  // ==============

  $(document).on('click.bs.modal.data-api', '[data-toggle="modal"]', function (e) {
    var $this   = $(this)
    var href    = $this.attr('href')
    var $target = $($this.attr('data-target') || (href && href.replace(/.*(?=#[^\s]+$)/, ''))) // strip for ie7
    var option  = $target.data('bs.modal') ? 'toggle' : $.extend({ remote: !/#/.test(href) && href }, $target.data(), $this.data())

    if ($this.is('a')) e.preventDefault()

    $target.one('show.bs.modal', function (showEvent) {
      if (showEvent.isDefaultPrevented()) return // only register focus restorer if modal will actually get shown
      $target.one('hidden.bs.modal', function () {
        $this.is(':visible') && $this.trigger('focus')
      })
    })
    Plugin.call($target, option, this)
  })

}(jQuery);

},{}],754:[function(require,module,exports){
/* ========================================================================
 * Bootstrap: tooltip.js v3.2.0
 * http://getbootstrap.com/javascript/#tooltip
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // TOOLTIP PUBLIC CLASS DEFINITION
  // ===============================

  var Tooltip = function (element, options) {
    this.type       =
    this.options    =
    this.enabled    =
    this.timeout    =
    this.hoverState =
    this.$element   = null

    this.init('tooltip', element, options)
  }

  Tooltip.VERSION  = '3.2.0'

  Tooltip.DEFAULTS = {
    animation: true,
    placement: 'top',
    selector: false,
    template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
    trigger: 'hover focus',
    title: '',
    delay: 0,
    html: false,
    container: false,
    viewport: {
      selector: 'body',
      padding: 0
    }
  }

  Tooltip.prototype.init = function (type, element, options) {
    this.enabled   = true
    this.type      = type
    this.$element  = $(element)
    this.options   = this.getOptions(options)
    this.$viewport = this.options.viewport && $(this.options.viewport.selector || this.options.viewport)

    var triggers = this.options.trigger.split(' ')

    for (var i = triggers.length; i--;) {
      var trigger = triggers[i]

      if (trigger == 'click') {
        this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this))
      } else if (trigger != 'manual') {
        var eventIn  = trigger == 'hover' ? 'mouseenter' : 'focusin'
        var eventOut = trigger == 'hover' ? 'mouseleave' : 'focusout'

        this.$element.on(eventIn  + '.' + this.type, this.options.selector, $.proxy(this.enter, this))
        this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this))
      }
    }

    this.options.selector ?
      (this._options = $.extend({}, this.options, { trigger: 'manual', selector: '' })) :
      this.fixTitle()
  }

  Tooltip.prototype.getDefaults = function () {
    return Tooltip.DEFAULTS
  }

  Tooltip.prototype.getOptions = function (options) {
    options = $.extend({}, this.getDefaults(), this.$element.data(), options)

    if (options.delay && typeof options.delay == 'number') {
      options.delay = {
        show: options.delay,
        hide: options.delay
      }
    }

    return options
  }

  Tooltip.prototype.getDelegateOptions = function () {
    var options  = {}
    var defaults = this.getDefaults()

    this._options && $.each(this._options, function (key, value) {
      if (defaults[key] != value) options[key] = value
    })

    return options
  }

  Tooltip.prototype.enter = function (obj) {
    var self = obj instanceof this.constructor ?
      obj : $(obj.currentTarget).data('bs.' + this.type)

    if (!self) {
      self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
      $(obj.currentTarget).data('bs.' + this.type, self)
    }

    clearTimeout(self.timeout)

    self.hoverState = 'in'

    if (!self.options.delay || !self.options.delay.show) return self.show()

    self.timeout = setTimeout(function () {
      if (self.hoverState == 'in') self.show()
    }, self.options.delay.show)
  }

  Tooltip.prototype.leave = function (obj) {
    var self = obj instanceof this.constructor ?
      obj : $(obj.currentTarget).data('bs.' + this.type)

    if (!self) {
      self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
      $(obj.currentTarget).data('bs.' + this.type, self)
    }

    clearTimeout(self.timeout)

    self.hoverState = 'out'

    if (!self.options.delay || !self.options.delay.hide) return self.hide()

    self.timeout = setTimeout(function () {
      if (self.hoverState == 'out') self.hide()
    }, self.options.delay.hide)
  }

  Tooltip.prototype.show = function () {
    var e = $.Event('show.bs.' + this.type)

    if (this.hasContent() && this.enabled) {
      this.$element.trigger(e)

      var inDom = $.contains(document.documentElement, this.$element[0])
      if (e.isDefaultPrevented() || !inDom) return
      var that = this

      var $tip = this.tip()

      var tipId = this.getUID(this.type)

      this.setContent()
      $tip.attr('id', tipId)
      this.$element.attr('aria-describedby', tipId)

      if (this.options.animation) $tip.addClass('fade')

      var placement = typeof this.options.placement == 'function' ?
        this.options.placement.call(this, $tip[0], this.$element[0]) :
        this.options.placement

      var autoToken = /\s?auto?\s?/i
      var autoPlace = autoToken.test(placement)
      if (autoPlace) placement = placement.replace(autoToken, '') || 'top'

      $tip
        .detach()
        .css({ top: 0, left: 0, display: 'block' })
        .addClass(placement)
        .data('bs.' + this.type, this)

      this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)

      var pos          = this.getPosition()
      var actualWidth  = $tip[0].offsetWidth
      var actualHeight = $tip[0].offsetHeight

      if (autoPlace) {
        var orgPlacement = placement
        var $parent      = this.$element.parent()
        var parentDim    = this.getPosition($parent)

        placement = placement == 'bottom' && pos.top   + pos.height       + actualHeight - parentDim.scroll > parentDim.height ? 'top'    :
                    placement == 'top'    && pos.top   - parentDim.scroll - actualHeight < 0                                   ? 'bottom' :
                    placement == 'right'  && pos.right + actualWidth      > parentDim.width                                    ? 'left'   :
                    placement == 'left'   && pos.left  - actualWidth      < parentDim.left                                     ? 'right'  :
                    placement

        $tip
          .removeClass(orgPlacement)
          .addClass(placement)
      }

      var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight)

      this.applyPlacement(calculatedOffset, placement)

      var complete = function () {
        that.$element.trigger('shown.bs.' + that.type)
        that.hoverState = null
      }

      $.support.transition && this.$tip.hasClass('fade') ?
        $tip
          .one('bsTransitionEnd', complete)
          .emulateTransitionEnd(150) :
        complete()
    }
  }

  Tooltip.prototype.applyPlacement = function (offset, placement) {
    var $tip   = this.tip()
    var width  = $tip[0].offsetWidth
    var height = $tip[0].offsetHeight

    // manually read margins because getBoundingClientRect includes difference
    var marginTop = parseInt($tip.css('margin-top'), 10)
    var marginLeft = parseInt($tip.css('margin-left'), 10)

    // we must check for NaN for ie 8/9
    if (isNaN(marginTop))  marginTop  = 0
    if (isNaN(marginLeft)) marginLeft = 0

    offset.top  = offset.top  + marginTop
    offset.left = offset.left + marginLeft

    // $.fn.offset doesn't round pixel values
    // so we use setOffset directly with our own function B-0
    $.offset.setOffset($tip[0], $.extend({
      using: function (props) {
        $tip.css({
          top: Math.round(props.top),
          left: Math.round(props.left)
        })
      }
    }, offset), 0)

    $tip.addClass('in')

    // check to see if placing tip in new offset caused the tip to resize itself
    var actualWidth  = $tip[0].offsetWidth
    var actualHeight = $tip[0].offsetHeight

    if (placement == 'top' && actualHeight != height) {
      offset.top = offset.top + height - actualHeight
    }

    var delta = this.getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight)

    if (delta.left) offset.left += delta.left
    else offset.top += delta.top

    var arrowDelta          = delta.left ? delta.left * 2 - width + actualWidth : delta.top * 2 - height + actualHeight
    var arrowPosition       = delta.left ? 'left'        : 'top'
    var arrowOffsetPosition = delta.left ? 'offsetWidth' : 'offsetHeight'

    $tip.offset(offset)
    this.replaceArrow(arrowDelta, $tip[0][arrowOffsetPosition], arrowPosition)
  }

  Tooltip.prototype.replaceArrow = function (delta, dimension, position) {
    this.arrow().css(position, delta ? (50 * (1 - delta / dimension) + '%') : '')
  }

  Tooltip.prototype.setContent = function () {
    var $tip  = this.tip()
    var title = this.getTitle()

    $tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title)
    $tip.removeClass('fade in top bottom left right')
  }

  Tooltip.prototype.hide = function () {
    var that = this
    var $tip = this.tip()
    var e    = $.Event('hide.bs.' + this.type)

    this.$element.removeAttr('aria-describedby')

    function complete() {
      if (that.hoverState != 'in') $tip.detach()
      that.$element.trigger('hidden.bs.' + that.type)
    }

    this.$element.trigger(e)

    if (e.isDefaultPrevented()) return

    $tip.removeClass('in')

    $.support.transition && this.$tip.hasClass('fade') ?
      $tip
        .one('bsTransitionEnd', complete)
        .emulateTransitionEnd(150) :
      complete()

    this.hoverState = null

    return this
  }

  Tooltip.prototype.fixTitle = function () {
    var $e = this.$element
    if ($e.attr('title') || typeof ($e.attr('data-original-title')) != 'string') {
      $e.attr('data-original-title', $e.attr('title') || '').attr('title', '')
    }
  }

  Tooltip.prototype.hasContent = function () {
    return this.getTitle()
  }

  Tooltip.prototype.getPosition = function ($element) {
    $element   = $element || this.$element
    var el     = $element[0]
    var isBody = el.tagName == 'BODY'
    return $.extend({}, (typeof el.getBoundingClientRect == 'function') ? el.getBoundingClientRect() : null, {
      scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.scrollTop(),
      width:  isBody ? $(window).width()  : $element.outerWidth(),
      height: isBody ? $(window).height() : $element.outerHeight()
    }, isBody ? { top: 0, left: 0 } : $element.offset())
  }

  Tooltip.prototype.getCalculatedOffset = function (placement, pos, actualWidth, actualHeight) {
    return placement == 'bottom' ? { top: pos.top + pos.height,   left: pos.left + pos.width / 2 - actualWidth / 2  } :
           placement == 'top'    ? { top: pos.top - actualHeight, left: pos.left + pos.width / 2 - actualWidth / 2  } :
           placement == 'left'   ? { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth } :
        /* placement == 'right' */ { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width   }

  }

  Tooltip.prototype.getViewportAdjustedDelta = function (placement, pos, actualWidth, actualHeight) {
    var delta = { top: 0, left: 0 }
    if (!this.$viewport) return delta

    var viewportPadding = this.options.viewport && this.options.viewport.padding || 0
    var viewportDimensions = this.getPosition(this.$viewport)

    if (/right|left/.test(placement)) {
      var topEdgeOffset    = pos.top - viewportPadding - viewportDimensions.scroll
      var bottomEdgeOffset = pos.top + viewportPadding - viewportDimensions.scroll + actualHeight
      if (topEdgeOffset < viewportDimensions.top) { // top overflow
        delta.top = viewportDimensions.top - topEdgeOffset
      } else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) { // bottom overflow
        delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset
      }
    } else {
      var leftEdgeOffset  = pos.left - viewportPadding
      var rightEdgeOffset = pos.left + viewportPadding + actualWidth
      if (leftEdgeOffset < viewportDimensions.left) { // left overflow
        delta.left = viewportDimensions.left - leftEdgeOffset
      } else if (rightEdgeOffset > viewportDimensions.width) { // right overflow
        delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset
      }
    }

    return delta
  }

  Tooltip.prototype.getTitle = function () {
    var title
    var $e = this.$element
    var o  = this.options

    title = $e.attr('data-original-title')
      || (typeof o.title == 'function' ? o.title.call($e[0]) :  o.title)

    return title
  }

  Tooltip.prototype.getUID = function (prefix) {
    do prefix += ~~(Math.random() * 1000000)
    while (document.getElementById(prefix))
    return prefix
  }

  Tooltip.prototype.tip = function () {
    return (this.$tip = this.$tip || $(this.options.template))
  }

  Tooltip.prototype.arrow = function () {
    return (this.$arrow = this.$arrow || this.tip().find('.tooltip-arrow'))
  }

  Tooltip.prototype.validate = function () {
    if (!this.$element[0].parentNode) {
      this.hide()
      this.$element = null
      this.options  = null
    }
  }

  Tooltip.prototype.enable = function () {
    this.enabled = true
  }

  Tooltip.prototype.disable = function () {
    this.enabled = false
  }

  Tooltip.prototype.toggleEnabled = function () {
    this.enabled = !this.enabled
  }

  Tooltip.prototype.toggle = function (e) {
    var self = this
    if (e) {
      self = $(e.currentTarget).data('bs.' + this.type)
      if (!self) {
        self = new this.constructor(e.currentTarget, this.getDelegateOptions())
        $(e.currentTarget).data('bs.' + this.type, self)
      }
    }

    self.tip().hasClass('in') ? self.leave(self) : self.enter(self)
  }

  Tooltip.prototype.destroy = function () {
    clearTimeout(this.timeout)
    this.hide().$element.off('.' + this.type).removeData('bs.' + this.type)
  }


  // TOOLTIP PLUGIN DEFINITION
  // =========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.tooltip')
      var options = typeof option == 'object' && option

      if (!data && option == 'destroy') return
      if (!data) $this.data('bs.tooltip', (data = new Tooltip(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.tooltip

  $.fn.tooltip             = Plugin
  $.fn.tooltip.Constructor = Tooltip


  // TOOLTIP NO CONFLICT
  // ===================

  $.fn.tooltip.noConflict = function () {
    $.fn.tooltip = old
    return this
  }

}(jQuery);

},{}],755:[function(require,module,exports){
/*
 *	jQuery dotdotdot 1.7.4
 *
 *	Copyright (c) Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	dotdotdot.frebsite.nl
 *
 *	Licensed under the MIT license.
 *	http://en.wikipedia.org/wiki/MIT_License
 */

(function( $, undef )
{
	if ( $.fn.dotdotdot )
	{
		return;
	}

	$.fn.dotdotdot = function( o )
	{
		if ( this.length == 0 )
		{
			$.fn.dotdotdot.debug( 'No element found for "' + this.selector + '".' );
			return this;
		}
		if ( this.length > 1 )
		{
			return this.each(
				function()
				{
					$(this).dotdotdot( o );
				}
			);
		}


		var $dot = this;

		if ( $dot.data( 'dotdotdot' ) )
		{
			$dot.trigger( 'destroy.dot' );
		}

		$dot.data( 'dotdotdot-style', $dot.attr( 'style' ) || '' );
		$dot.css( 'word-wrap', 'break-word' );
		if ($dot.css( 'white-space' ) === 'nowrap')
		{
			$dot.css( 'white-space', 'normal' );
		}

		$dot.bind_events = function()
		{
			$dot.bind(
				'update.dot',
				function( e, c )
				{
					$dot.removeClass("is-truncated");
					e.preventDefault();
					e.stopPropagation();

					switch( typeof opts.height )
					{
						case 'number':
							opts.maxHeight = opts.height;
							break;

						case 'function':
							opts.maxHeight = opts.height.call( $dot[ 0 ] );
							break;

						default:
							opts.maxHeight = getTrueInnerHeight( $dot );
							break;
					}

					opts.maxHeight += opts.tolerance;

					if ( typeof c != 'undefined' )
					{
						if ( typeof c == 'string' || ('nodeType' in c && c.nodeType === 1) )
						{
					 		c = $('<div />').append( c ).contents();
						}
						if ( c instanceof $ )
						{
							orgContent = c;
						}
					}

					$inr = $dot.wrapInner( '<div class="dotdotdot" />' ).children();
					$inr.contents()
						.detach()
						.end()
						.append( orgContent.clone( true ) )
						.find( 'br' )
						.replaceWith( '  <br />  ' )
						.end()
						.css({
							'height'	: 'auto',
							'width'		: 'auto',
							'border'	: 'none',
							'padding'	: 0,
							'margin'	: 0
						});

					var after = false,
						trunc = false;

					if ( conf.afterElement )
					{
						after = conf.afterElement.clone( true );
					    after.show();
						conf.afterElement.detach();
					}

					if ( test( $inr, opts ) )
					{
						if ( opts.wrap == 'children' )
						{
							trunc = children( $inr, opts, after );
						}
						else
						{
							trunc = ellipsis( $inr, $dot, $inr, opts, after );
						}
					}
					$inr.replaceWith( $inr.contents() );
					$inr = null;

					if ( $.isFunction( opts.callback ) )
					{
						opts.callback.call( $dot[ 0 ], trunc, orgContent );
					}

					conf.isTruncated = trunc;
					return trunc;
				}

			).bind(
				'isTruncated.dot',
				function( e, fn )
				{
					e.preventDefault();
					e.stopPropagation();

					if ( typeof fn == 'function' )
					{
						fn.call( $dot[ 0 ], conf.isTruncated );
					}
					return conf.isTruncated;
				}

			).bind(
				'originalContent.dot',
				function( e, fn )
				{
					e.preventDefault();
					e.stopPropagation();

					if ( typeof fn == 'function' )
					{
						fn.call( $dot[ 0 ], orgContent );
					}
					return orgContent;
				}

			).bind(
				'destroy.dot',
				function( e )
				{
					e.preventDefault();
					e.stopPropagation();

					$dot.unwatch()
						.unbind_events()
						.contents()
						.detach()
						.end()
						.append( orgContent )
						.attr( 'style', $dot.data( 'dotdotdot-style' ) || '' )
						.data( 'dotdotdot', false );
				}
			);
			return $dot;
		};	//	/bind_events

		$dot.unbind_events = function()
		{
			$dot.unbind('.dot');
			return $dot;
		};	//	/unbind_events

		$dot.watch = function()
		{
			$dot.unwatch();
			if ( opts.watch == 'window' )
			{
				var $window = $(window),
					_wWidth = $window.width(),
					_wHeight = $window.height();

				$window.bind(
					'resize.dot' + conf.dotId,
					function()
					{
						if ( _wWidth != $window.width() || _wHeight != $window.height() || !opts.windowResizeFix )
						{
							_wWidth = $window.width();
							_wHeight = $window.height();

							if ( watchInt )
							{
								clearInterval( watchInt );
							}
							watchInt = setTimeout(
								function()
								{
									$dot.trigger( 'update.dot' );
								}, 100
							);
						}
					}
				);
			}
			else
			{
				watchOrg = getSizes( $dot );
				watchInt = setInterval(
					function()
					{
						if ( $dot.is( ':visible' ) )
						{
							var watchNew = getSizes( $dot );
							if ( watchOrg.width  != watchNew.width ||
								 watchOrg.height != watchNew.height )
							{
								$dot.trigger( 'update.dot' );
								watchOrg = watchNew;
							}
						}
					}, 500
				);
			}
			return $dot;
		};
		$dot.unwatch = function()
		{
			$(window).unbind( 'resize.dot' + conf.dotId );
			if ( watchInt )
			{
				clearInterval( watchInt );
			}
			return $dot;
		};

		var	orgContent	= $dot.contents(),
			opts 		= $.extend( true, {}, $.fn.dotdotdot.defaults, o ),
			conf		= {},
			watchOrg	= {},
			watchInt	= null,
			$inr		= null;


		if ( !( opts.lastCharacter.remove instanceof Array ) )
		{
			opts.lastCharacter.remove = $.fn.dotdotdot.defaultArrays.lastCharacter.remove;
		}
		if ( !( opts.lastCharacter.noEllipsis instanceof Array ) )
		{
			opts.lastCharacter.noEllipsis = $.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis;
		}


		conf.afterElement	= getElement( opts.after, $dot );
		conf.isTruncated	= false;
		conf.dotId			= dotId++;


		$dot.data( 'dotdotdot', true )
			.bind_events()
			.trigger( 'update.dot' );

		if ( opts.watch )
		{
			$dot.watch();
		}

		return $dot;
	};


	//	public
	$.fn.dotdotdot.defaults = {
		'ellipsis'			: '... ',
		'wrap'				: 'word',
		'fallbackToLetter'	: true,
		'lastCharacter'		: {},
		'tolerance'			: 0,
		'callback'			: null,
		'after'				: null,
		'height'			: null,
		'watch'				: false,
		'windowResizeFix'	: true
	};
	$.fn.dotdotdot.defaultArrays = {
		'lastCharacter'		: {
			'remove'			: [ ' ', '\u3000', ',', ';', '.', '!', '?' ],
			'noEllipsis'		: []
		}
	};
	$.fn.dotdotdot.debug = function( msg ) {};


	//	private
	var dotId = 1;

	function children( $elem, o, after )
	{
		var $elements 	= $elem.children(),
			isTruncated	= false;

		$elem.empty();

		for ( var a = 0, l = $elements.length; a < l; a++ )
		{
			var $e = $elements.eq( a );
			$elem.append( $e );
			if ( after )
			{
				$elem.append( after );
			}
			if ( test( $elem, o ) )
			{
				$e.remove();
				isTruncated = true;
				break;
			}
			else
			{
				if ( after )
				{
					after.detach();
				}
			}
		}
		return isTruncated;
	}
	function ellipsis( $elem, $d, $i, o, after )
	{
		var isTruncated	= false;

		//	Don't put the ellipsis directly inside these elements
		var notx = 'a, table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style';

		//	Don't remove these elements even if they are after the ellipsis
		var noty = 'script, .dotdotdot-keep';

		$elem
			.contents()
			.detach()
			.each(
				function()
				{

					var e	= this,
						$e	= $(e);

					if ( typeof e == 'undefined' )
					{
						return true;
					}
					else if ( $e.is( noty ) )
					{
						$elem.append( $e );
					}
					else if ( isTruncated )
					{
						return true;
					}
					else
					{
						$elem.append( $e );
						if ( after && !$e.is( o.after ) && !$e.find( o.after ).length  )
						{
							$elem[ $elem.is( notx ) ? 'after' : 'append' ]( after );
						}
						if ( test( $i, o ) )
						{
							if ( e.nodeType == 3 ) // node is TEXT
							{
								isTruncated = ellipsisElement( $e, $d, $i, o, after );
							}
							else
							{
								isTruncated = ellipsis( $e, $d, $i, o, after );
							}

							if ( !isTruncated )
							{
								$e.detach();
								isTruncated = true;
							}
						}

						if ( !isTruncated )
						{
							if ( after )
							{
								after.detach();
							}
						}
					}
				}
			);
		$d.addClass("is-truncated");
		return isTruncated;
	}
	function ellipsisElement( $e, $d, $i, o, after )
	{
		var e = $e[ 0 ];

		if ( !e )
		{
			return false;
		}

		var txt			= getTextContent( e ),
			space		= ( txt.indexOf(' ') !== -1 ) ? ' ' : '\u3000',
			separator	= ( o.wrap == 'letter' ) ? '' : space,
			textArr		= txt.split( separator ),
			position 	= -1,
			midPos		= -1,
			startPos	= 0,
			endPos		= textArr.length - 1;


		//	Only one word
		if ( o.fallbackToLetter && startPos == 0 && endPos == 0 )
		{
			separator	= '';
			textArr		= txt.split( separator );
			endPos		= textArr.length - 1;
		}

		while ( startPos <= endPos && !( startPos == 0 && endPos == 0 ) )
		{
			var m = Math.floor( ( startPos + endPos ) / 2 );
			if ( m == midPos )
			{
				break;
			}
			midPos = m;

			setTextContent( e, textArr.slice( 0, midPos + 1 ).join( separator ) + o.ellipsis );
			$i.children()
				.each(
					function()
					{
						$(this).toggle().toggle();
					}
				);

			if ( !test( $i, o ) )
			{
				position = midPos;
				startPos = midPos;
			}
			else
			{
				endPos = midPos;

				//	Fallback to letter
				if (o.fallbackToLetter && startPos == 0 && endPos == 0 )
				{
					separator	= '';
					textArr		= textArr[ 0 ].split( separator );
					position	= -1;
					midPos		= -1;
					startPos	= 0;
					endPos		= textArr.length - 1;
				}
			}
		}

		if ( position != -1 && !( textArr.length == 1 && textArr[ 0 ].length == 0 ) )
		{
			txt = addEllipsis( textArr.slice( 0, position + 1 ).join( separator ), o );
			setTextContent( e, txt );
		}
		else
		{
			var $w = $e.parent();
			$e.detach();

			var afterLength = ( after && after.closest($w).length ) ? after.length : 0;

			if ( $w.contents().length > afterLength )
			{
				e = findLastTextNode( $w.contents().eq( -1 - afterLength ), $d );
			}
			else
			{
				e = findLastTextNode( $w, $d, true );
				if ( !afterLength )
				{
					$w.detach();
				}
			}
			if ( e )
			{
				txt = addEllipsis( getTextContent( e ), o );
				setTextContent( e, txt );
				if ( afterLength && after )
				{
					$(e).parent().append( after );
				}
			}
		}

		return true;
	}
	function test( $i, o )
	{
		return $i.innerHeight() > o.maxHeight;
	}
	function addEllipsis( txt, o )
	{
		while( $.inArray( txt.slice( -1 ), o.lastCharacter.remove ) > -1 )
		{
			txt = txt.slice( 0, -1 );
		}
		if ( $.inArray( txt.slice( -1 ), o.lastCharacter.noEllipsis ) < 0 )
		{
			txt += o.ellipsis;
		}
		return txt;
	}
	function getSizes( $d )
	{
		return {
			'width'	: $d.innerWidth(),
			'height': $d.innerHeight()
		};
	}
	function setTextContent( e, content )
	{
		if ( e.innerText )
		{
			e.innerText = content;
		}
		else if ( e.nodeValue )
		{
			e.nodeValue = content;
		}
		else if (e.textContent)
		{
			e.textContent = content;
		}

	}
	function getTextContent( e )
	{
		if ( e.innerText )
		{
			return e.innerText;
		}
		else if ( e.nodeValue )
		{
			return e.nodeValue;
		}
		else if ( e.textContent )
		{
			return e.textContent;
		}
		else
		{
			return "";
		}
	}
	function getPrevNode( n )
	{
		do
		{
			n = n.previousSibling;
		}
		while ( n && n.nodeType !== 1 && n.nodeType !== 3 );

		return n;
	}
	function findLastTextNode( $el, $top, excludeCurrent )
	{
		var e = $el && $el[ 0 ], p;
		if ( e )
		{
			if ( !excludeCurrent )
			{
				if ( e.nodeType === 3 )
				{
					return e;
				}
				if ( $.trim( $el.text() ) )
				{
					return findLastTextNode( $el.contents().last(), $top );
				}
			}
			p = getPrevNode( e );
			while ( !p )
			{
				$el = $el.parent();
				if ( $el.is( $top ) || !$el.length )
				{
					return false;
				}
				p = getPrevNode( $el[0] );
			}
			if ( p )
			{
				return findLastTextNode( $(p), $top );
			}
		}
		return false;
	}
	function getElement( e, $i )
	{
		if ( !e )
		{
			return false;
		}
		if ( typeof e === 'string' )
		{
			e = $(e, $i);
			return ( e.length )
				? e
				: false;
		}
		return !e.jquery
			? false
			: e;
	}
	function getTrueInnerHeight( $el )
	{
		var h = $el.innerHeight(),
			a = [ 'paddingTop', 'paddingBottom' ];

		for ( var z = 0, l = a.length; z < l; z++ )
		{
			var m = parseInt( $el.css( a[ z ] ), 10 );
			if ( isNaN( m ) )
			{
				m = 0;
			}
			h -= m;
		}
		return h;
	}


	//	override jQuery.html
	var _orgHtml = $.fn.html;
	$.fn.html = function( str )
	{
		if ( str != undef && !$.isFunction( str ) && this.data( 'dotdotdot' ) )
		{
			return this.trigger( 'update', [ str ] );
		}
		return _orgHtml.apply( this, arguments );
	};


	//	override jQuery.text
	var _orgText = $.fn.text;
	$.fn.text = function( str )
	{
		if ( str != undef && !$.isFunction( str ) && this.data( 'dotdotdot' ) )
		{
			str = $( '<div />' ).text( str ).html();
			return this.trigger( 'update', [ str ] );
		}
		return _orgText.apply( this, arguments );
	};


})( jQuery );

},{}],756:[function(require,module,exports){
/*!
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD. Register as anonymous module.
		define(['jquery'], factory);
	} else {
		// Browser globals.
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function encode(s) {
		return config.raw ? s : encodeURIComponent(s);
	}

	function decode(s) {
		return config.raw ? s : decodeURIComponent(s);
	}

	function stringifyCookieValue(value) {
		return encode(config.json ? JSON.stringify(value) : String(value));
	}

	function parseCookieValue(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape...
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}

		try {
			// Replace server-side written pluses with spaces.
			// If we can't decode the cookie, ignore it, it's unusable.
			s = decodeURIComponent(s.replace(pluses, ' '));
		} catch(e) {
			return;
		}

		try {
			// If we can't parse the cookie, ignore it, it's unusable.
			return config.json ? JSON.parse(s) : s;
		} catch(e) {}
	}

	function read(s, converter) {
		var value = config.raw ? s : parseCookieValue(s);
		return $.isFunction(converter) ? converter(value) : value;
	}

	var config = $.cookie = function (key, value, options) {

		// Write
		if (value !== undefined && !$.isFunction(value)) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setDate(t.getDate() + days);
			}

			return (document.cookie = [
				encode(key), '=', stringifyCookieValue(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// Read

		var result = key ? undefined : {};

		// To prevent the for loop in the first place assign an empty array
		// in case there are no cookies at all. Also prevents odd result when
		// calling $.cookie().
		var cookies = document.cookie ? document.cookie.split('; ') : [];

		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = parts.join('=');

			if (key && key === name) {
				// If second argument (value) is a function it's a converter...
				result = read(cookie, value);
				break;
			}

			// Prevent storing a cookie that we couldn't decode.
			if (!key && (cookie = read(cookie)) !== undefined) {
				result[name] = cookie;
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) !== undefined) {
			// Must not alter options, thus extending a fresh object...
			$.cookie(key, '', $.extend({}, options, { expires: -1 }));
			return true;
		}
		return false;
	};

}));

},{}],757:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * polyfill / shim plugin for AMD loaders
 *
 * @author Brian Cavalier
 * @author John Hann
 */
(function (define) {
define(function (require) {

	var object = require('./object');
	var string = require('./string');
	var date = require('./date');
	require('./array');
	require('./function');
	require('./json');
	require('./xhr');
	require('./setImmediate');
	require('./array-es6');

	return {
		failIfShimmed: object.failIfShimmed,
		setWhitespaceChars: string.setWhitespaceChars,
		setIsoCompatTest: date.setIsoCompatTest
	};

});
}(
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

},{"./array":759,"./array-es6":758,"./date":760,"./function":761,"./json":762,"./object":765,"./setImmediate":766,"./string":767,"./xhr":769}],758:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * Array -- a stand-alone module for using ES6 array features.
 *
 * @author Jared Cacurak
 * @author Brian Cavalier
 * @author John Hann
 *
 * Huge thanks to Rick Waldron:
 * https://gist.github.com/rwldrn/5079436
 * https://gist.github.com/rwldrn/5079427
 * https://gist.github.com/rwldrn/1074126
 */
(function (define) {
define(function (require) {
"use strict";

	var base = require('./lib/_base');
	var array = require('./lib/_array');

	var ctor = Array,
		proto = ctor.prototype,
		slice = proto.slice,
		protoFeatureMap,
		ctorFeatureMap,
		_findIndex;

	protoFeatureMap = {
		'array-find': 'find',
		'array-findIndex': 'findIndex'
	};

	ctorFeatureMap = {
		'array-from': 'from',
		'array-of': 'of'
	};

	function has (feature) {
		var prop = protoFeatureMap[feature];
		if (prop) {
			return base.isFunction(proto[prop]);
		}
		prop = ctorFeatureMap[feature];
		return base.isFunction(ctor[prop]);
	}

	if (!has('array-from')) {
		Array.from = function (thing) {
			var ctor, k, o;
			// sniff if we're being applied to some other constructor
			ctor = base.isFunction(this) ? this : Array;
			if (Array === ctor) return slice.call(thing);
			k = thing.length;
			o = new ctor(k);
			o.length = k;
			while (--k >= 0) o[k] = thing[k];
			return o;
		};
	}

	if (!has('array-of')) {
		Array.of = function () { return slice.call(arguments); };
	}

	if (!has('array-findIndex') || !has('array-find')) {
		_findIndex = function findIndexImpl (lambda /*, thisArg */) {

			var foundAt = -1;

			array.iterate(this, function (val, i, arr) {
				if (lambda.call(this, val, i, arr)) {
					foundAt = i;
				}
				return foundAt == -1;
			// arguments[+1] is to fool google closure compiler into NOT adding a function argument!
			}, array.returnValue, arguments[+1]);
			return foundAt;
		};

		if (!has('array-findIndex')) {
			proto.findIndex = function findIndex (lambda) {
				// arguments[+1] is to fool google closure compiler into NOT adding a function argument!
				return _findIndex.call(this, lambda, arguments[+1]);
			};
		}

		if (!has('array-find')) {
			proto.find = function find (lambda) {
				// arguments[+1] is to fool google closure compiler into NOT adding a function argument!
				return this[_findIndex.call(this, lambda, arguments[+1])];
			}
		}
	}
});
}(
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

},{"./lib/_array":763,"./lib/_base":764}],759:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * Array -- a stand-alone module for using Javascript 1.6 array features
 * in lame-o browsers that don't support Javascript 1.6
 *
 * @author Jared Cacurak
 * @author Brian Cavalier
 * @author John Hann
 */
/*
	define(['poly!poly/array'], function () {
		var items = [1, 2, 3];
		items.forEach(function (item) {
			console.log(item);
		};
	});

	All of the wrapper API methods are shimmed and are reasonably close to
	the ES5 specification, but may vary slightly in unforeseen edge cases:

	var array = [1, 2, 3];

	array.forEach(lambda [, context]);
	array.every(lambda [, context]);
	array.some(lambda [, context]);
	array.filter(lambda [, context]);
	array.map(lambda [, context]);
	array.indexOf(item [, fromIndex]);
	array.lastIndexOf(item [, fromIndex]);
	array.reduce(reduceFunc [, initialValue]);
	array.reduceRight(reduceFunc [, initialValue]);
	Array.isArray(object)

 */
(function (define) {
define(function (require) {
"use strict";

	var base = require('./lib/_base');
	var array = require('./lib/_array');

	var proto = Array.prototype,
		featureMap,
		_reduce,
		_find;

	featureMap = {
		'array-foreach': 'forEach',
		'array-every': 'every',
		'array-some': 'some',
		'array-map': 'map',
		'array-filter': 'filter',
		'array-reduce': 'reduce',
		'array-reduceright': 'reduceRight',
		'array-indexof': 'indexOf',
		'array-lastindexof': 'lastIndexOf'
	};

	function has (feature) {
		var prop = featureMap[feature];
		return base.isFunction(proto[prop]);
	}

	function returnTruthy () {
		return 1;
	}

	/***** iterators *****/

	if (!has('array-foreach')) {
		proto.forEach = function forEach (lambda) {
			// arguments[+1] is to fool google closure compiler into NOT adding a function argument!
			array.iterate(this, lambda, returnTruthy, arguments[+1]);
		};
	}

	if (!has('array-every')) {
		proto.every = function every (lambda) {
			// arguments[+1] is to fool google closure compiler into NOT adding a function argument!
			return array.iterate(this, lambda, array.returnValue, arguments[+1]);
		};
	}

	if (!has('array-some')) {
		proto.some = function some (lambda) {
			// arguments[+1] is to fool google closure compiler into NOT adding a function argument!
			return array.iterate(this, lambda, function (val) { return !val; }, arguments[+1]);
		};
	}

	/***** mutators *****/

	if(!has('array-map')) {
		proto.map = function map (lambda) {
			var arr, result;

			arr = this;
			result = new Array(arr.length);

			// arguments[+1] is to fool google closure compiler into NOT adding a function argument!
			array.iterate(arr, lambda, function (val, i) { result[i] = val; return 1; }, arguments[+1]);

			return result;
		};
	}

	if (!has('array-filter')) {
		proto.filter = function filter (lambda) {
			var arr, result;

			arr = this;
			result = [];

			array.iterate(arr, lambda, function (val, i, orig) {
				// use a copy of the original value in case
				// the lambda function changed it
				if (val) {
					result.push(orig);
				}
				return 1;
			}, arguments[1]);

			return result;
		};
	}

	/***** reducers *****/

	if (!has('array-reduce') || !has('array-reduceright')) {

		_reduce = function _reduce (reduceFunc, inc, initialValue, hasInitialValue) {
			var reduced, startPos, initialValuePos;

			startPos = initialValuePos = inc > 0 ? -1 : array.toArrayLike(this).length >>> 0;

			// If no initialValue, use first item of array (we know length !== 0 here)
			// and adjust i to start at second item
			if (!hasInitialValue) {
				array.iterate(this, array.returnValue, function (val, i) {
					reduced = val;
					initialValuePos = i;
				}, null, startPos + inc, inc);
				if (initialValuePos == startPos) {
					// no intial value and no items in array!
					throw new TypeError();
				}
			}
			else {
				// If initialValue provided, use it
				reduced = initialValue;
			}

			// Do the actual reduce
			array.iterate(this, function (item, i, arr) {
				reduced = reduceFunc(reduced, item, i, arr);
			}, returnTruthy, null, initialValuePos + inc, inc);

			// we have a reduced value!
			return reduced;
		};

		if (!has('array-reduce')) {
			proto.reduce = function reduce (reduceFunc /*, initialValue */) {
				return _reduce.call(this, reduceFunc, 1, arguments[+1], arguments.length > 1);
			};
		}

		if (!has('array-reduceright')) {
			proto.reduceRight = function reduceRight (reduceFunc /*, initialValue */) {
				return _reduce.call(this, reduceFunc, -1, arguments[+1], arguments.length > 1);
			};
		}
	}

	/***** finders *****/

	if (!has('array-indexof') || !has('array-lastindexof')) {

		_find = function _find (arr, item, from, forward) {
			var len = array.toArrayLike(arr).length >>> 0, foundAt = -1;

			// convert to number, or default to start or end positions
			from = isNaN(from) ? (forward ? 0 : len - 1) : Number(from);
			// negative means it's an offset from the end position
			if (from < 0) {
				from = len + from - 1;
			}

			array.iterate(arr, array.returnValue, function (val, i) {
				if (val === item) {
					foundAt = i;
				}
				return foundAt == -1;
			}, null, from, forward ? 1 : -1);

			return foundAt;
		};

		if (!has('array-indexof')) {
			proto.indexOf = function indexOf (item) {
				// arguments[+1] is to fool google closure compiler into NOT adding a function argument!
				return _find(this, item, arguments[+1], true);
			};
		}

		if (!has('array-lastindexof')) {
			proto.lastIndexOf = function lastIndexOf (item) {
				// arguments[+1] is to fool google closure compiler into NOT adding a function argument!
				return _find(this, item, arguments[+1], false);
			};
		}
	}

	if (!Array.isArray) {
		Array.isArray = base.isArray;
	}

});
}(
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

},{"./lib/_array":763,"./lib/_base":764}],760:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * poly/date
 *
 * @author Brian Cavalier
 * @author John Hann
 *
 * ES5-ish Date shims for older browsers.
*/
(function (origDate, define) {
define(function (require) {

	var base = require('./lib/_base');

	var origProto,
		origParse,
		featureMap,
		maxDate,
		invalidDate,
		isoCompat,
		isoParseRx,
		ownProp,
		undef;

	origProto = origDate.prototype;
	origParse = origDate.parse;

	ownProp = Object.prototype.hasOwnProperty;

	maxDate = 8.64e15;
	invalidDate = NaN;
	// borrowed this from https://github.com/kriskowal/es5-shim
	isoCompat = function () { return origDate.parse('+275760-09-13T00:00:00.000Z') == maxDate; };
	// can't even have spaces in iso date strings
	// in Chrome and FF, the colon in the timezone is optional, but IE, Opera, and Safari need it
	isoParseRx = /^([+\-]\d{6}|\d{4})(?:-(\d{2}))?(?:-(\d{2}))?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:.(\d{1,3}))?)?(?:Z|([+\-])(\d{2})(?::(\d{2}))?)?)?$/;

	featureMap = {
		'date-now': 'now',
		'date-tojson': 'toJSON',
		'date-toisostring': 'toISOString'
	};

	function has (feature) {
		var prop = featureMap[feature];
		return prop in origDate || prop in origProto;
	}

	if (!has('date-now')) {
		origDate.now = function () { return +(new Date); };
	}

	function isInvalidDate (date) {
		return !isFinite(date);
	}

	function fix2 (number) {
		// ensures number is formatted to at least two digits
		return (number < 10 ? '0' : '') + number;
	}

	function isoParse (str) {
		// parses simplified iso8601 dates, such as
		// yyyy-mm-ddThh:mm:ssZ
		// +yyyyyy-mm-ddThh:mm:ss-06:30
		var result;

		// prepare for the worst
		result = invalidDate;

		// fast parse
		str.replace(isoParseRx, function (a, y, m, d, h, n, s, ms, tzs, tzh, tzm) {
			var adjust = 0;

			// Date.UTC handles years between 0 and 100 as 2-digit years, but
			// that's not what we want with iso dates. If we move forward
			// 400 years -- a full cycle in the Gregorian calendar -- then
			// subtract the 400 years (as milliseconds) afterwards, we can avoid
			// this problem. (learned of this trick from kriskowal/es5-shim.)
			if (y >= 0 && y < 100) {
				y = +y + 400; // convert to number
				adjust = -126227808e5; // 400 years
			}

			result = Date.UTC(y, (m || 1) - 1, d || 1, h || 0, n || 0, s || 0, ms || 0) + adjust;

			tzh = +(tzs + tzh); // convert to signed number
			tzm = +(tzs + tzm); // convert to signed number

			if (tzh || tzm) {
				result -= (tzh + tzm / 60) * 36e5;
				// check if time zone is out of bounds
				if (tzh > 23 || tzh < -23 || tzm > 59) result = invalidDate;
				// check if time zone pushed us over maximum date value
				if (result > maxDate) result = invalidDate;
			}

			return ''; // reduces memory used
		});

		return result;
	}

	if (!has('date-toisostring')) {

		origProto.toISOString = function toIsoString () {
			if (isInvalidDate(this)) {
				throw new RangeError("toISOString called on invalid value");
			}
			return [
				this.getUTCFullYear(), '-',
				fix2(this.getUTCMonth() + 1), '-',
				fix2(this.getUTCDate()), 'T',
				fix2(this.getUTCHours()), ':',
				fix2(this.getUTCMinutes()), ':',
				fix2(this.getUTCSeconds()), '.',
				(this.getUTCMilliseconds()/1000).toFixed(3).slice(2), 'Z'
			].join('');
		};

	}

	if (!has('date-tojson')) {

		origProto.toJSON = function toJSON (key) {
			// key arg is ignored by Date objects, but since this function
			// is generic, other Date-like objects could use the key arg.
			// spec says to throw a TypeError if toISOString is not callable
			// but that's what happens anyways, so no need for extra code.
			return this.toISOString();
		};
	}

	function checkIsoCompat () {
		// fix Date constructor

		var newDate = (function () {
			// Replacement Date constructor
			return function Date (y, m, d, h, mn, s, ms) {
				var len, result;

				// Date called as function, not constructor
				if (!(this instanceof newDate)) return origDate.apply(this, arguments);

				len = arguments.length;

				if (len === 0) {
					result = new origDate();
				}
				else if (len === 1) {
					result = new origDate(base.isString(y) ? newDate.parse(y) : y);
				}
				else {
					result = new origDate(y, m, d == undef ? 1 : d, h || 0, mn || 0, s || 0, ms || 0);
				}

				result.constructor = newDate;

				return result;
			};
		}());

		if (!isoCompat()) {

			newDate.now = origDate.now;
			newDate.UTC = origDate.UTC;
			newDate.prototype = origProto;
			newDate.prototype.constructor = newDate;

			newDate.parse = function parse (str) {
				var result;

				// check for iso date
				result = isoParse('' + str);

				if (isInvalidDate(result)) {
					// try original parse()
					result = origParse(str);
				}

				return result;
			};

			// Unfortunate. See cujojs/poly#11
			// Copy any owned props that may have been previously added to
			// the Date constructor by 3rd party libs.
			copyPropsSafely(newDate, origDate);

			Date = newDate;
		}
		else if (Date != origDate) {
			Date = origDate;
		}

	}

	function copyPropsSafely(dst, src) {
		for (var p in src) {
			if (ownProp.call(src, p) && !ownProp.call(dst, p)) {
				dst[p] = src[p];
			}
		}
	}

	checkIsoCompat();

	return {
		setIsoCompatTest: function (testFunc) {
			isoCompat = testFunc;
			checkIsoCompat();
		}
	};

});
}(
	Date,
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

},{"./lib/_base":764}],761:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * Function polyfill / shims
 *
 * @author Brian Cavalier
 * @author John Hann
 */
(function (define) {
define(function (require) {
"use strict";

	var base = require('./lib/_base');

	var bind,
		slice = [].slice,
		proto = Function.prototype,
		featureMap;

	featureMap = {
		'function-bind': 'bind'
	};

	function has (feature) {
		var prop = featureMap[feature];
		return base.isFunction(proto[prop]);
	}

	// check for missing features
	if (!has('function-bind')) {
		// adapted from Mozilla Developer Network example at
		// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind
		bind = function bind (obj) {
			var args = slice.call(arguments, 1),
				self = this,
				nop = function () {},
				bound = function () {
				  return self.apply(this instanceof nop ? this : (obj || {}), args.concat(slice.call(arguments)));
				};
			nop.prototype = this.prototype || {}; // Firefox cries sometimes if prototype is undefined
			bound.prototype = new nop();
			return bound;
		};
		proto.bind = bind;
	}

	return {};

});
}(
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

},{"./lib/_base":764}],762:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * JSON polyfill / shim
 *
 * @author Brian Cavalier
 * @author John Hann
 */
(function (define) {
define(function (require) {
"use strict";
	return require('./support/json3');
});
}(
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

},{"./support/json3":768}],763:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * poly common array functions
 *
 * @author Jared Cacurak
 * @author Brian Cavalier
 * @author John Hann
 */
(function (define) {
define(function (require) {

	var base = require('./_base');

	var toObject = base.createCaster(Object, 'Array'),
		isFunction = base.isFunction,
		undef;

	return {
		returnValue: returnValue,
		iterate: iterate,
		toArrayLike: toArrayLike
	};

	function toArrayLike (o) {
		return (base.toString(o) == '[object String]')
			? o.split('')
			: toObject(o);
	}

	function returnValue (val) {
		return val;
	}

	function iterate (arr, lambda, continueFunc, context, start, inc) {

		var alo, len, i, end;

		alo = toArrayLike(arr);
		len = alo.length >>> 0;

		if (start === undef) start = 0;
		if (!inc) inc = 1;
		end = inc < 0 ? -1 : len;

		if (!isFunction(lambda)) {
			throw new TypeError(lambda + ' is not a function');
		}
		if (start == end) {
			return false;
		}
		if ((start <= end) ^ (inc > 0)) {
			throw new TypeError('Invalid length or starting index');
		}

		for (i = start; i != end; i = i + inc) {
			if (i in alo) {
				if (!continueFunc(lambda.call(context, alo[i], i, alo), i, alo[i])) {
					return false;
				}
			}
		}

		return true;
	}

});
}(
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

},{"./_base":764}],764:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * poly common functions
 *
 * @author Brian Cavalier
 * @author John Hann
 */
(function (define) {
define(function (require, exports) {

	var toString;

	toString = ({}).toString;

	exports.isFunction = function (o) {
		return typeof o == 'function';
	};

	exports.isString = function (o) {
		return toString.call(o) == '[object String]';
	};

	exports.isArray = function (o) {
		return toString.call(o) == '[object Array]';
	};

	exports.toString = function (o) {
		return toString.apply(o);
	};

	exports.createCaster = function (caster, name) {
		return function cast (o) {
			if (o == null) throw new TypeError(name + ' method called on null or undefined');
			return caster(o);
		}
	};

	exports.isElement = function(o){
		return typeof HTMLElement == 'undefined'
			? 'tagName' in o && 'nodeName' in o
			: o instanceof HTMLELEMENT;
	};

});
}(
	typeof define == 'function' && define.amd
		? define
		: function (factory) { factory(require, exports); }
));

},{}],765:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * Object polyfill / shims
 *
 * @author Brian Cavalier
 * @author John Hann
 */
/**
 * The goal of these shims is to emulate a JavaScript 1.8.5+ environments as
 * much as possible.  While it's not feasible to fully shim Object,
 * we can try to maximize code compatibility with older js engines.
 *
 * Note: these shims cannot fix `for (var p in obj) {}`. Instead, use this:
 *     Object.keys(obj).forEach(function (p) {}); // shimmed Array
 *
 * Also, these shims can't prevent writing to object properties.
 *
 * If you want your code to fail loudly if a shim can't mimic ES5 closely
 * then set the AMD loader config option `failIfShimmed`.  Possible values
 * for `failIfShimmed` include:
 *
 * true: fail on every shimmed Object function
 * false: fail never
 * function: fail for shims whose name returns true from function (name) {}
 *
 * By default, no shims fail.
 *
 * The following functions are safely shimmed:
 * create (unless the second parameter is specified since that calls defineProperties)
 * keys
 * getOwnPropertyNames
 * getPrototypeOf
 * isExtensible
 *
 * In order to play nicely with several third-party libs (including Promises/A
 * implementations), the following functions don't fail by default even though
 * they can't be correctly shimmed:
 * freeze
 * seal
 * isFrozen
 * isSealed
 *
 * The poly/strict module will set failIfShimmed to fail for some shims.
 * See the documentation for more information.
 *
 * IE missing enum properties fixes copied from kangax:
 * https://github.com/kangax/protolicious/blob/master/experimental/object.for_in.js
 *
 * TODO: fix Object#propertyIsEnumerable for IE's non-enumerable props to match Object.keys()
 */
(function (define) {
define(function (require) {
"use strict";

	var base = require('./lib/_base');

	var refObj,
		refProto,
		has__proto__,
		hasNonEnumerableProps,
		getPrototypeOf,
		keys,
		featureMap,
		shims,
		secrets,
		protoSecretProp,
		hasOwnProp = 'hasOwnProperty',
		doc = typeof document != 'undefined' && document,
		testEl = doc && doc.createElement('p'),
		undef;

	refObj = Object;
	refProto = refObj.prototype;

	has__proto__ = typeof {}.__proto__ == 'object';

	hasNonEnumerableProps = (function () {
		for (var p in { valueOf: 1 }) return false;
		return true;
	}());

	// TODO: this still doesn't work for IE6-8 since object.constructor && object.constructor.prototype are clobbered/replaced when using `new` on a constructor that has a prototype. srsly.
	// devs will have to do the following if they want this to work in IE6-8:
	// Ctor.prototype.constructor = Ctor
	getPrototypeOf = has__proto__
		? function (object) { assertIsObject(object); return object.__proto__; }
		: function (object) {
			assertIsObject(object);
			// return null according to the investigation result at:
			// https://github.com/cujojs/poly/pull/21
			if (object == refProto) {
				return null;
			}
			return protoSecretProp && object[protoSecretProp](secrets)
				? object[protoSecretProp](secrets.proto)
				: object.constructor ? object.constructor.prototype : refProto;
		};

	keys = !hasNonEnumerableProps
		? _keys
		: (function (masked) {
			return function (object) {
				var result = _keys(object), i = 0, m;
				while (m = masked[i++]) {
					if (hasProp(object, m)) result.push(m);
				}
				return result;
			}
		}([ 'constructor', hasOwnProp, 'isPrototypeOf', 'propertyIsEnumerable', 'toString', 'toLocaleString', 'valueOf' ]));

	featureMap = {
		'object-create': 'create',
		'object-freeze': 'freeze',
		'object-isfrozen': 'isFrozen',
		'object-seal': 'seal',
		'object-issealed': 'isSealed',
		'object-getprototypeof': 'getPrototypeOf',
		'object-keys': 'keys',
		'object-getownpropertynames': 'getOwnPropertyNames',
		'object-isextensible': 'isExtensible',
		'object-preventextensions': 'preventExtensions',
		'object-defineproperty-obj': function () {
			return hasDefineProperty({});
		},
		'object-defineproperty-dom': function () {
			return doc && hasDefineProperty(testEl);
		},
		'object-defineproperties-obj': function () {
			return hasDefineProperties({});
		},
		'object-defineproperties-dom': function () {
			return doc && hasDefineProperties(testEl);
		},
		'object-getownpropertydescriptor-obj': function () {
			return hasGetOwnPropertyDescriptor({});
		},
		'object-getownpropertydescriptor-dom': function () {
			return doc && hasGetOwnPropertyDescriptor(testEl);
		}
	};

	shims = {};

	secrets = {
		proto: {}
	};

	protoSecretProp = !has('object-getprototypeof') && !has__proto__ && hasNonEnumerableProps && hasOwnProp;

	// we might create an owned property to hold the secrets, but make it look
	// like it's not an owned property.  (affects getOwnPropertyNames, too)
	if (protoSecretProp) (function (_hop) {
		refProto[hasOwnProp] = function (name) {
			if (name == protoSecretProp) return false;
			return _hop.call(this, name);
		};
	}(refProto[hasOwnProp]));

	if (!has('object-create')) {
		Object.create = shims.create = create;
	}

	if (!has('object-freeze')) {
		Object.freeze = shims.freeze = noop;
	}

	if (!has('object-isfrozen')) {
		Object.isFrozen = shims.isFrozen = nope;
	}

	if (!has('object-seal')) {
		Object.seal = shims.seal = noop;
	}

	if (!has('object-issealed')) {
		Object.isSealed = shims.isSealed = nope;
	}

	if (!has('object-getprototypeof')) {
		Object.getPrototypeOf = shims.getPrototypeOf = getPrototypeOf;
	}

	if (!has('object-keys')) {
		Object.keys = keys;
	}

	if (!has('object-getownpropertynames')) {
		Object.getOwnPropertyNames = shims.getOwnPropertyNames
			= getOwnPropertyNames;
	}

	if (!has('object-defineproperties-obj')) {
		// check if dom has it (IE8)
		Object.defineProperties = shims.defineProperties
			= has('object-defineproperties-dom')
				? useNativeForDom(Object.defineProperties, defineProperties)
				: defineProperties;
	}

	if (!has('object-defineproperty-obj')) {
		// check if dom has it (IE8)
		Object.defineProperty = shims.defineProperty
			= has('object-defineproperty-dom')
				? useNativeForDom(Object.defineProperty, defineProperty)
				: defineProperty;
	}

	if (!has('object-isextensible')) {
		Object.isExtensible = shims.isExtensible = isExtensible;
	}

	if (!has('object-preventextensions')) {
		Object.preventExtensions = shims.preventExtensions = preventExtensions;
	}

	if (!has('object-getownpropertydescriptor-obj')) {
		// check if dom has it (IE8)
		Object.getOwnPropertyDescriptor = shims.getOwnPropertyDescriptor
			= has('object-getownpropertydescriptor-dom')
				? useNativeForDom(Object.getOwnPropertyDescriptor, getOwnPropertyDescriptor)
				: getOwnPropertyDescriptor;
	}

	function hasDefineProperty (object) {
		if (('defineProperty' in Object)) {
			try {
				// test it
				Object.defineProperty(object, 'sentinel1', { value: 1 })
				return 'sentinel1' in object;
			}
			catch (ex) { /* squelch */ }
		}
	}

	// Note: MSDN docs say that IE8 has this function, but tests show
	// that it does not! JMH
	function hasDefineProperties (object) {
		if (('defineProperties' in Object)) {
			try {
				// test it
				Object.defineProperties(object, { 'sentinel2': { value: 1 } })
				return 'sentinel2' in object;
			}
			catch (ex) { /* squelch */ }
		}
	}

	function hasGetOwnPropertyDescriptor (object) {
		if (('getOwnPropertyDescriptor' in Object)) {
			object['sentinel3'] = true;
			try {
				return (Object.getOwnPropertyDescriptor(object, 'sentinel3').value);
			}
			catch (ex) { /* squelch */ }
		}
	}

	function PolyBase () {}

	// for better compression
	function hasProp (object, name) {
		return object.hasOwnProperty(name);
	}

	function _keys (object) {
		var result = [];
		for (var p in object) {
			if (hasProp(object, p)) {
				result.push(p);
			}
		}
		return result;
	}

	function create (proto, props) {
		var obj;

		if (typeof proto != 'object') throw new TypeError('prototype is not of type Object or Null.');

		PolyBase.prototype = proto;
		obj = new PolyBase();
		PolyBase.prototype = null;

		// provide a mechanism for retrieving the prototype in IE 6-8
		if (protoSecretProp) {
			var orig = obj[protoSecretProp];
			obj[protoSecretProp] = function (name) {
				if (name == secrets) return true; // yes, we're using secrets
				if (name == secrets.proto) return proto;
				return orig.call(this, name);
			};
		}

		if (arguments.length > 1) {
			// defineProperties could throw depending on `failIfShimmed`
			Object.defineProperties(obj, props);
		}

		return obj;
	}

	function defineProperties (object, descriptors) {
		var names, name;
		names = keys(descriptors);
		while ((name = names.pop())) {
			Object.defineProperty(object, name, descriptors[name]);
		}
		return object;
	}

	function defineProperty (object, name, descriptor) {
		object[name] = descriptor && descriptor.value;
		return object;
	}

	function getOwnPropertyDescriptor (object, name) {
		return hasProp(object, name)
			? {
				value: object[name],
				enumerable: true,
				configurable: true,
				writable: true
			}
			: undef;
	}

	function getOwnPropertyNames (object) {
		return keys(object);
	}

	function isExtensible (object) {
		var prop = '_poly_';
		try {
			// create unique property name
			while (prop in object) prop += '_';
			// try to set it
			object[prop] = 1;
			return hasProp(object, prop);
		}
		catch (ex) { return false; }
		finally {
			try { delete object[prop]; } catch (ex) { /* squelch */ }
		}
	}

	function preventExtensions (object) {
		return object;
	}

	function useNativeForDom (orig, shim) {
		return function (obj) {
			if (base.isElement(obj)) return orig.apply(this, arguments);
			else return shim.apply(this, arguments);
		};
	}

	function failIfShimmed (failTest) {
		var shouldThrow;

		if (typeof failTest == 'function') {
			shouldThrow = failTest;
		}
		else {
			// assume truthy/falsey
			shouldThrow = function () { return failTest; };
		}

		// create throwers for some features
		for (var feature in shims) {
			Object[feature] = shouldThrow(feature)
				? createFlameThrower(feature)
				: shims[feature];
		}
	}

	function assertIsObject (o) {
		if (typeof o != 'object') {
			throw new TypeError('Object.getPrototypeOf called on non-object');
		}
	}

	function createFlameThrower (feature) {
		return function () {
			throw new Error('poly/object: ' + feature + ' is not safely supported.');
		}
	}

	function has (feature) {
		var ret;
		var prop = featureMap[feature];

		if (base.isFunction(prop)) {
			// cache return value, ensure boolean
			ret = featureMap[feature] = !!prop(refObj);
		}
		else if (base.isString(prop)) {
			ret = featureMap[feature] = prop in refObj;
		}
		else {
			// return cached evaluate result
			ret = prop;
		}

		return ret;
	}

	function noop (it) { return it; }

	function nope (it) { return false; }

	return {
		failIfShimmed: failIfShimmed
	};

});
}(
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

},{"./lib/_base":764}],766:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * setImmediate polyfill / shim
 *
 * @author Jared Cacurak
 * @author Brian Cavalier
 * @author John Hann
 *
 * Based on NobleJS's setImmediate. (https://github.com/NobleJS/setImmediate)
 */
(function (global, define) {
define(function (require) {
"use strict";

	var base = require('./lib/_base');

	var testCache,
		tasks;

	testCache = {};
	tasks = (function () {
		var nextHandle,
			tasksByHandle,
			currentlyRunningATask;

		nextHandle = 1; // Spec says greater than zero
		tasksByHandle = {};
		currentlyRunningATask = false;

		function Task (handler, args) {
			this.handler = handler;
			this.args = Array.prototype.slice.call(args);
		}

		Task.prototype.run = function () {
			// See steps in section 5 of the spec.
			if (base.isFunction(this.handler)) {
				// Choice of `thisArg` is not in the setImmediate spec; `undefined` is in the setTimeout spec though:
				// http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html
				this.handler.apply(undefined, this.args);
			}
			else {
				var scriptSource = '' + this.handler;
				eval(scriptSource);
			}
		};

		return {
			addFromSetImmediateArguments: function (args) {
				var handler,
					argsToHandle,
					task,
					thisHandle;

				handler = args[0];
				argsToHandle = Array.prototype.slice.call(args, 1);
				task = new Task(handler, argsToHandle);

				thisHandle = nextHandle++;
				tasksByHandle[thisHandle] = task;
				return thisHandle;
			},
			runIfPresent: function (handle) {
				// From the spec: "Wait until any invocations of this algorithm started before this one have completed."
				// So if we're currently running a task, we'll need to delay this invocation.
				if (!currentlyRunningATask) {
					var task = tasksByHandle[handle];
					if (task) {
						currentlyRunningATask = true;
						try {
							task.run();
						} finally {
							delete tasksByHandle[handle];
							currentlyRunningATask = false;
						}
					}
				} else {
					// Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a
					// "too much recursion" error.
					global.setTimeout(function () {
						tasks.runIfPresent(handle);
					}, 0);
				}
			},
			remove: function (handle) {
				delete tasksByHandle[handle];
			}
		};
	}());

	function has (name) {
		if (base.isFunction(testCache[name])) {
			testCache[name] = testCache[name](global);
		}
		return testCache[name];
	}

	function add (name, test, now) {
		testCache[name] = now ? test(global, d, el) : test;
	}

	function aliasMicrosoftImplementation (attachTo) {
		attachTo.setImmediate = global.msSetImmediate;
		attachTo.clearImmediate = global.msClearImmediate;
	}

	function installPostMessageImplementation (attachTo) {
		// Installs an event handler on `global` for the `message` event: see
		// * https://developer.mozilla.org/en/DOM/window.postMessage
		// * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages

		var MESSAGE_PREFIX = 'cujojs/poly.setImmediate' + Math.random();

		function isStringAndStartsWith (string, putativeStart) {
			return typeof string === 'string' && string.substring(0, putativeStart.length) === putativeStart;
		}

		function onGlobalMessage (event) {
			// This will catch all incoming messages (even from other windows!), so we need to try reasonably hard to
			// avoid letting anyone else trick us into firing off. We test the origin is still this window, and that a
			// (randomly generated) unpredictable identifying prefix is present.
			if (event.source === global && isStringAndStartsWith(event.data, MESSAGE_PREFIX)) {
				var handle = event.data.substring(MESSAGE_PREFIX.length);
				tasks.runIfPresent(handle);
			}
		}
		global.addEventListener('message', onGlobalMessage, false);

		attachTo.setImmediate = function () {
			var handle = tasks.addFromSetImmediateArguments(arguments);

			// Make `global` post a message to itself with the handle and identifying prefix, thus asynchronously
			// invoking our onGlobalMessage listener above.
			global.postMessage(MESSAGE_PREFIX + handle, '*');
			return handle;
		};
	}

	function installReadyStateChangeImplementation(attachTo) {
		attachTo.setImmediate = function () {
			var handle = tasks.addFromSetImmediateArguments(arguments);

			// Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted
			// into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.
			var scriptEl = global.document.createElement('script');
			scriptEl.onreadystatechange = function () {
				tasks.runIfPresent(handle);

				scriptEl.onreadystatechange = null;
				scriptEl.parentNode.removeChild(scriptEl);
				scriptEl = null;
			};
			global.document.documentElement.appendChild(scriptEl);
			return handle;
		};
	}

	function installSetTimeoutImplementation(attachTo) {
		attachTo.setImmediate = function () {
			var handle = tasks.addFromSetImmediateArguments(arguments);

			global.setTimeout(function () {
				tasks.runIfPresent(handle);
			}, 0);
			return handle;
		};
	}

	add('setimmediate', function (g) {
		return base.isFunction(g.setImmediate);
	});

	add('ms-setimmediate', function (g) {
		return base.isFunction(g.msSetImmediate);
	});

	add('post-message', function (g) {
		// Note: this is only for the async postMessage, not the buggy sync
		// version in IE8
		var postMessageIsAsynchronous,
			oldOnMessage;

		postMessageIsAsynchronous = true;
		oldOnMessage = g.onmessage;

		if (!g.postMessage) {
			return false;
		}

		g.onmessage = function () {
			postMessageIsAsynchronous = false;
		};
		g.postMessage('', '*');
		g.onmessage = oldOnMessage;
		return postMessageIsAsynchronous;
	});

	add('script-onreadystatechange', function (g) {
		return 'document' in g && 'onreadystatechange' in g.document.createElement('script');
	});

	if (!has('setimmediate')) {
		if (has('ms-setimmediate')) {
			aliasMicrosoftImplementation(global);
		}
		else {
			if (has('post-message')) {
				installPostMessageImplementation(global);
			}
			else if (has('script-onreadystatechange')) {
				installReadyStateChangeImplementation(global);
			}
			else {
				 installSetTimeoutImplementation(global);
			}
			global.clearImmediate = tasks.remove;
		}
	}
});
}(
	this.global || this,
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

},{"./lib/_base":764}],767:[function(require,module,exports){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * String polyfill / shims
 *
 * @author Brian Cavalier
 * @author John Hann
 *
 * Adds str.trim(), str.trimRight(), and str.trimLeft()
 *
 * Note: we don't bother trimming all possible ES5 white-space characters.
 * If you truly need strict ES5 whitespace compliance in all browsers,
 * create your own trim function.
 * from http://perfectionkills.com/whitespace-deviations/
 * '\x09-\x0D\x20\xA0\u1680\u180E\u2000-\u200A\u202F\u205F\u3000\u2028\u2029'
 */
(function (define) {
define(function (require) {
"use strict";

	var base = require('./lib/_base');

	var proto = String.prototype,
		featureMap,
		has,
		toString;

	featureMap = {
		'string-trim': 'trim',
		'string-trimleft': 'trimLeft',
		'string-trimright': 'trimRight'
	};

	function checkFeature (feature) {
		var prop = featureMap[feature];
		return base.isFunction(proto[prop]);
	}

	function neg () { return false; }

	has = checkFeature;

	// compressibility helper
	function remove (str, rx) {
		return str.replace(rx, '');
	}

	toString = base.createCaster(String, 'String');

	var trimRightRx, trimLeftRx;

	trimRightRx = /\s+$/;
	trimLeftRx = /^\s+/;

	function checkShims () {
		if (!has('string-trim')) {
			proto.trim = function trim () {
				return remove(remove(toString(this), trimLeftRx), trimRightRx);
			};
		}

		if (!has('string-trimleft')) {
			proto.trimLeft = function trimLeft () {
				return remove(toString(this), trimLeftRx);
			};
		}

		if (!has('string-trimright')) {
			proto.trimRight = function trimRight () {
				return remove(toString(this), trimRightRx);
			};
		}

	}

	checkShims();

	return {
		setWhitespaceChars: function (wsc) {
			trimRightRx = new RegExp(wsc + '$');
			trimLeftRx = new RegExp('^' + wsc);
			// fail all has() checks and check shims again
			has = neg;
			checkShims();
		}
	};

});
}(
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

},{"./lib/_base":764}],768:[function(require,module,exports){
/*! JSON v3.2.4 | http://bestiejs.github.com/json3 | Copyright 2012, Kit Cambridge | http://kit.mit-license.org */
;(function () {
  // Convenience aliases.
  var getClass = {}.toString, isProperty, forEach, undef;

  // Detect the `define` function exposed by asynchronous module loaders. The
  // strict `define` check is necessary for compatibility with `r.js`.
  var isLoader = typeof define === "function" && define.amd, JSON3 = !isLoader && typeof exports == "object" && exports;

  if (JSON3 || isLoader) {
    if (typeof JSON == "object" && JSON) {
      // Delegate to the native `stringify` and `parse` implementations in
      // asynchronous module loaders and CommonJS environments.
      if (isLoader) {
        JSON3 = JSON;
      } else {
        JSON3.stringify = JSON.stringify;
        JSON3.parse = JSON.parse;
      }
    } else if (isLoader) {
      JSON3 = this.JSON = {};
    }
  } else {
    // Export for web browsers and JavaScript engines.
    JSON3 = this.JSON || (this.JSON = {});
  }

  // Local variables.
  var Escapes, toPaddedString, quote, serialize;
  var fromCharCode, Unescapes, abort, lex, get, walk, update, Index, Source;

  // Test the `Date#getUTC*` methods. Based on work by @Yaffle.
  var isExtended = new Date(-3509827334573292), floor, Months, getDay;

  try {
    // The `getUTCFullYear`, `Month`, and `Date` methods return nonsensical
    // results for certain dates in Opera >= 10.53.
    isExtended = isExtended.getUTCFullYear() == -109252 && isExtended.getUTCMonth() === 0 && isExtended.getUTCDate() == 1 &&
      // Safari < 2.0.2 stores the internal millisecond time value correctly,
      // but clips the values returned by the date methods to the range of
      // signed 32-bit integers ([-2 ** 31, 2 ** 31 - 1]).
      isExtended.getUTCHours() == 10 && isExtended.getUTCMinutes() == 37 && isExtended.getUTCSeconds() == 6 && isExtended.getUTCMilliseconds() == 708;
  } catch (exception) {}

  // Internal: Determines whether the native `JSON.stringify` and `parse`
  // implementations are spec-compliant. Based on work by Ken Snyder.
  function has(name) {
    var stringifySupported, parseSupported, value, serialized = '{"A":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}', all = name == "json";
    if (all || name == "json-stringify" || name == "json-parse") {
      // Test `JSON.stringify`.
      if (name == "json-stringify" || all) {
        if ((stringifySupported = typeof JSON3.stringify == "function" && isExtended)) {
          // A test function object with a custom `toJSON` method.
          (value = function () {
            return 1;
          }).toJSON = value;
          try {
            stringifySupported =
              // Firefox 3.1b1 and b2 serialize string, number, and boolean
              // primitives as object literals.
              JSON3.stringify(0) === "0" &&
              // FF 3.1b1, b2, and JSON 2 serialize wrapped primitives as object
              // literals.
              JSON3.stringify(new Number()) === "0" &&
              JSON3.stringify(new String()) == '""' &&
              // FF 3.1b1, 2 throw an error if the value is `null`, `undefined`, or
              // does not define a canonical JSON representation (this applies to
              // objects with `toJSON` properties as well, *unless* they are nested
              // within an object or array).
              JSON3.stringify(getClass) === undef &&
              // IE 8 serializes `undefined` as `"undefined"`. Safari <= 5.1.7 and
              // FF 3.1b3 pass this test.
              JSON3.stringify(undef) === undef &&
              // Safari <= 5.1.7 and FF 3.1b3 throw `Error`s and `TypeError`s,
              // respectively, if the value is omitted entirely.
              JSON3.stringify() === undef &&
              // FF 3.1b1, 2 throw an error if the given value is not a number,
              // string, array, object, Boolean, or `null` literal. This applies to
              // objects with custom `toJSON` methods as well, unless they are nested
              // inside object or array literals. YUI 3.0.0b1 ignores custom `toJSON`
              // methods entirely.
              JSON3.stringify(value) === "1" &&
              JSON3.stringify([value]) == "[1]" &&
              // Prototype <= 1.6.1 serializes `[undefined]` as `"[]"` instead of
              // `"[null]"`.
              JSON3.stringify([undef]) == "[null]" &&
              // YUI 3.0.0b1 fails to serialize `null` literals.
              JSON3.stringify(null) == "null" &&
              // FF 3.1b1, 2 halts serialization if an array contains a function:
              // `[1, true, getClass, 1]` serializes as "[1,true,],". These versions
              // of Firefox also allow trailing commas in JSON objects and arrays.
              // FF 3.1b3 elides non-JSON values from objects and arrays, unless they
              // define custom `toJSON` methods.
              JSON3.stringify([undef, getClass, null]) == "[null,null,null]" &&
              // Simple serialization test. FF 3.1b1 uses Unicode escape sequences
              // where character escape codes are expected (e.g., `\b` => `\u0008`).
              JSON3.stringify({ "A": [value, true, false, null, "\0\b\n\f\r\t"] }) == serialized &&
              // FF 3.1b1 and b2 ignore the `filter` and `width` arguments.
              JSON3.stringify(null, value) === "1" &&
              JSON3.stringify([1, 2], null, 1) == "[\n 1,\n 2\n]" &&
              // JSON 2, Prototype <= 1.7, and older WebKit builds incorrectly
              // serialize extended years.
              JSON3.stringify(new Date(-8.64e15)) == '"-271821-04-20T00:00:00.000Z"' &&
              // The milliseconds are optional in ES 5, but required in 5.1.
              JSON3.stringify(new Date(8.64e15)) == '"+275760-09-13T00:00:00.000Z"' &&
              // Firefox <= 11.0 incorrectly serializes years prior to 0 as negative
              // four-digit years instead of six-digit years. Credits: @Yaffle.
              JSON3.stringify(new Date(-621987552e5)) == '"-000001-01-01T00:00:00.000Z"' &&
              // Safari <= 5.1.5 and Opera >= 10.53 incorrectly serialize millisecond
              // values less than 1000. Credits: @Yaffle.
              JSON3.stringify(new Date(-1)) == '"1969-12-31T23:59:59.999Z"';
          } catch (exception) {
            stringifySupported = false;
          }
        }
        if (!all) {
          return stringifySupported;
        }
      }
      // Test `JSON.parse`.
      if (name == "json-parse" || all) {
        if (typeof JSON3.parse == "function") {
          try {
            // FF 3.1b1, b2 will throw an exception if a bare literal is provided.
            // Conforming implementations should also coerce the initial argument to
            // a string prior to parsing.
            if (JSON3.parse("0") === 0 && !JSON3.parse(false)) {
              // Simple parsing test.
              value = JSON3.parse(serialized);
              if ((parseSupported = value.A.length == 5 && value.A[0] == 1)) {
                try {
                  // Safari <= 5.1.2 and FF 3.1b1 allow unescaped tabs in strings.
                  parseSupported = !JSON3.parse('"\t"');
                } catch (exception) {}
                if (parseSupported) {
                  try {
                    // FF 4.0 and 4.0.1 allow leading `+` signs, and leading and
                    // trailing decimal points. FF 4.0, 4.0.1, and IE 9-10 also
                    // allow certain octal literals.
                    parseSupported = JSON3.parse("01") != 1;
                  } catch (exception) {}
                }
              }
            }
          } catch (exception) {
            parseSupported = false;
          }
        }
        if (!all) {
          return parseSupported;
        }
      }
      return stringifySupported && parseSupported;
    }
  }

  if (!has("json")) {
    // Define additional utility methods if the `Date` methods are buggy.
    if (!isExtended) {
      floor = Math.floor;
      // A mapping between the months of the year and the number of days between
      // January 1st and the first of the respective month.
      Months = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
      // Internal: Calculates the number of days between the Unix epoch and the
      // first day of the given month.
      getDay = function (year, month) {
        return Months[month] + 365 * (year - 1970) + floor((year - 1969 + (month = +(month > 1))) / 4) - floor((year - 1901 + month) / 100) + floor((year - 1601 + month) / 400);
      };
    }
    
    // Internal: Determines if a property is a direct property of the given
    // object. Delegates to the native `Object#hasOwnProperty` method.
    if (!(isProperty = {}.hasOwnProperty)) {
      isProperty = function (property) {
        var members = {}, constructor;
        if ((members.__proto__ = null, members.__proto__ = {
          // The *proto* property cannot be set multiple times in recent
          // versions of Firefox and SeaMonkey.
          "toString": 1
        }, members).toString != getClass) {
          // Safari <= 2.0.3 doesn't implement `Object#hasOwnProperty`, but
          // supports the mutable *proto* property.
          isProperty = function (property) {
            // Capture and break the object's prototype chain (see section 8.6.2
            // of the ES 5.1 spec). The parenthesized expression prevents an
            // unsafe transformation by the Closure Compiler.
            var original = this.__proto__, result = property in (this.__proto__ = null, this);
            // Restore the original prototype chain.
            this.__proto__ = original;
            return result;
          };
        } else {
          // Capture a reference to the top-level `Object` constructor.
          constructor = members.constructor;
          // Use the `constructor` property to simulate `Object#hasOwnProperty` in
          // other environments.
          isProperty = function (property) {
            var parent = (this.constructor || constructor).prototype;
            return property in this && !(property in parent && this[property] === parent[property]);
          };
        }
        members = null;
        return isProperty.call(this, property);
      };
    }

    // Internal: Normalizes the `for...in` iteration algorithm across
    // environments. Each enumerated key is yielded to a `callback` function.
    forEach = function (object, callback) {
      var size = 0, Properties, members, property, forEach;

      // Tests for bugs in the current environment's `for...in` algorithm. The
      // `valueOf` property inherits the non-enumerable flag from
      // `Object.prototype` in older versions of IE, Netscape, and Mozilla.
      (Properties = function () {
        this.valueOf = 0;
      }).prototype.valueOf = 0;

      // Iterate over a new instance of the `Properties` class.
      members = new Properties();
      for (property in members) {
        // Ignore all properties inherited from `Object.prototype`.
        if (isProperty.call(members, property)) {
          size++;
        }
      }
      Properties = members = null;

      // Normalize the iteration algorithm.
      if (!size) {
        // A list of non-enumerable properties inherited from `Object.prototype`.
        members = ["valueOf", "toString", "toLocaleString", "propertyIsEnumerable", "isPrototypeOf", "hasOwnProperty", "constructor"];
        // IE <= 8, Mozilla 1.0, and Netscape 6.2 ignore shadowed non-enumerable
        // properties.
        forEach = function (object, callback) {
          var isFunction = getClass.call(object) == "[object Function]", property, length;
          for (property in object) {
            // Gecko <= 1.0 enumerates the `prototype` property of functions under
            // certain conditions; IE does not.
            if (!(isFunction && property == "prototype") && isProperty.call(object, property)) {
              callback(property);
            }
          }
          // Manually invoke the callback for each non-enumerable property.
          for (length = members.length; property = members[--length]; isProperty.call(object, property) && callback(property));
        };
      } else if (size == 2) {
        // Safari <= 2.0.4 enumerates shadowed properties twice.
        forEach = function (object, callback) {
          // Create a set of iterated properties.
          var members = {}, isFunction = getClass.call(object) == "[object Function]", property;
          for (property in object) {
            // Store each property name to prevent double enumeration. The
            // `prototype` property of functions is not enumerated due to cross-
            // environment inconsistencies.
            if (!(isFunction && property == "prototype") && !isProperty.call(members, property) && (members[property] = 1) && isProperty.call(object, property)) {
              callback(property);
            }
          }
        };
      } else {
        // No bugs detected; use the standard `for...in` algorithm.
        forEach = function (object, callback) {
          var isFunction = getClass.call(object) == "[object Function]", property, isConstructor;
          for (property in object) {
            if (!(isFunction && property == "prototype") && isProperty.call(object, property) && !(isConstructor = property === "constructor")) {
              callback(property);
            }
          }
          // Manually invoke the callback for the `constructor` property due to
          // cross-environment inconsistencies.
          if (isConstructor || isProperty.call(object, (property = "constructor"))) {
            callback(property);
          }
        };
      }
      return forEach(object, callback);
    };

    // Public: Serializes a JavaScript `value` as a JSON string. The optional
    // `filter` argument may specify either a function that alters how object and
    // array members are serialized, or an array of strings and numbers that
    // indicates which properties should be serialized. The optional `width`
    // argument may be either a string or number that specifies the indentation
    // level of the output.
    if (!has("json-stringify")) {
      // Internal: A map of control characters and their escaped equivalents.
      Escapes = {
        "\\": "\\\\",
        '"': '\\"',
        "\b": "\\b",
        "\f": "\\f",
        "\n": "\\n",
        "\r": "\\r",
        "\t": "\\t"
      };

      // Internal: Converts `value` into a zero-padded string such that its
      // length is at least equal to `width`. The `width` must be <= 6.
      toPaddedString = function (width, value) {
        // The `|| 0` expression is necessary to work around a bug in
        // Opera <= 7.54u2 where `0 == -0`, but `String(-0) !== "0"`.
        return ("000000" + (value || 0)).slice(-width);
      };

      // Internal: Double-quotes a string `value`, replacing all ASCII control
      // characters (characters with code unit values between 0 and 31) with
      // their escaped equivalents. This is an implementation of the
      // `Quote(value)` operation defined in ES 5.1 section 15.12.3.
      quote = function (value) {
        var result = '"', index = 0, symbol;
        for (; symbol = value.charAt(index); index++) {
          // Escape the reverse solidus, double quote, backspace, form feed, line
          // feed, carriage return, and tab characters.
          result += '\\"\b\f\n\r\t'.indexOf(symbol) > -1 ? Escapes[symbol] :
            // If the character is a control character, append its Unicode escape
            // sequence; otherwise, append the character as-is.
            (Escapes[symbol] = symbol < " " ? "\\u00" + toPaddedString(2, symbol.charCodeAt(0).toString(16)) : symbol);
        }
        return result + '"';
      };

      // Internal: Recursively serializes an object. Implements the
      // `Str(key, holder)`, `JO(value)`, and `JA(value)` operations.
      serialize = function (property, object, callback, properties, whitespace, indentation, stack) {
        var value = object[property], className, year, month, date, time, hours, minutes, seconds, milliseconds, results, element, index, length, prefix, any, result;
        if (typeof value == "object" && value) {
          className = getClass.call(value);
          if (className == "[object Date]" && !isProperty.call(value, "toJSON")) {
            if (value > -1 / 0 && value < 1 / 0) {
              // Dates are serialized according to the `Date#toJSON` method
              // specified in ES 5.1 section 15.9.5.44. See section 15.9.1.15
              // for the ISO 8601 date time string format.
              if (getDay) {
                // Manually compute the year, month, date, hours, minutes,
                // seconds, and milliseconds if the `getUTC*` methods are
                // buggy. Adapted from @Yaffle's `date-shim` project.
                date = floor(value / 864e5);
                for (year = floor(date / 365.2425) + 1970 - 1; getDay(year + 1, 0) <= date; year++);
                for (month = floor((date - getDay(year, 0)) / 30.42); getDay(year, month + 1) <= date; month++);
                date = 1 + date - getDay(year, month);
                // The `time` value specifies the time within the day (see ES
                // 5.1 section 15.9.1.2). The formula `(A % B + B) % B` is used
                // to compute `A modulo B`, as the `%` operator does not
                // correspond to the `modulo` operation for negative numbers.
                time = (value % 864e5 + 864e5) % 864e5;
                // The hours, minutes, seconds, and milliseconds are obtained by
                // decomposing the time within the day. See section 15.9.1.10.
                hours = floor(time / 36e5) % 24;
                minutes = floor(time / 6e4) % 60;
                seconds = floor(time / 1e3) % 60;
                milliseconds = time % 1e3;
              } else {
                year = value.getUTCFullYear();
                month = value.getUTCMonth();
                date = value.getUTCDate();
                hours = value.getUTCHours();
                minutes = value.getUTCMinutes();
                seconds = value.getUTCSeconds();
                milliseconds = value.getUTCMilliseconds();
              }
              // Serialize extended years correctly.
              value = (year <= 0 || year >= 1e4 ? (year < 0 ? "-" : "+") + toPaddedString(6, year < 0 ? -year : year) : toPaddedString(4, year)) +
                "-" + toPaddedString(2, month + 1) + "-" + toPaddedString(2, date) +
                // Months, dates, hours, minutes, and seconds should have two
                // digits; milliseconds should have three.
                "T" + toPaddedString(2, hours) + ":" + toPaddedString(2, minutes) + ":" + toPaddedString(2, seconds) +
                // Milliseconds are optional in ES 5.0, but required in 5.1.
                "." + toPaddedString(3, milliseconds) + "Z";
            } else {
              value = null;
            }
          } else if (typeof value.toJSON == "function" && ((className != "[object Number]" && className != "[object String]" && className != "[object Array]") || isProperty.call(value, "toJSON"))) {
            // Prototype <= 1.6.1 adds non-standard `toJSON` methods to the
            // `Number`, `String`, `Date`, and `Array` prototypes. JSON 3
            // ignores all `toJSON` methods on these objects unless they are
            // defined directly on an instance.
            value = value.toJSON(property);
          }
        }
        if (callback) {
          // If a replacement function was provided, call it to obtain the value
          // for serialization.
          value = callback.call(object, property, value);
        }
        if (value === null) {
          return "null";
        }
        className = getClass.call(value);
        if (className == "[object Boolean]") {
          // Booleans are represented literally.
          return "" + value;
        } else if (className == "[object Number]") {
          // JSON numbers must be finite. `Infinity` and `NaN` are serialized as
          // `"null"`.
          return value > -1 / 0 && value < 1 / 0 ? "" + value : "null";
        } else if (className == "[object String]") {
          // Strings are double-quoted and escaped.
          return quote(value);
        }
        // Recursively serialize objects and arrays.
        if (typeof value == "object") {
          // Check for cyclic structures. This is a linear search; performance
          // is inversely proportional to the number of unique nested objects.
          for (length = stack.length; length--;) {
            if (stack[length] === value) {
              // Cyclic structures cannot be serialized by `JSON.stringify`.
              throw TypeError();
            }
          }
          // Add the object to the stack of traversed objects.
          stack.push(value);
          results = [];
          // Save the current indentation level and indent one additional level.
          prefix = indentation;
          indentation += whitespace;
          if (className == "[object Array]") {
            // Recursively serialize array elements.
            for (index = 0, length = value.length; index < length; any || (any = true), index++) {
              element = serialize(index, value, callback, properties, whitespace, indentation, stack);
              results.push(element === undef ? "null" : element);
            }
            result = any ? (whitespace ? "[\n" + indentation + results.join(",\n" + indentation) + "\n" + prefix + "]" : ("[" + results.join(",") + "]")) : "[]";
          } else {
            // Recursively serialize object members. Members are selected from
            // either a user-specified list of property names, or the object
            // itself.
            forEach(properties || value, function (property) {
              var element = serialize(property, value, callback, properties, whitespace, indentation, stack);
              if (element !== undef) {
                // According to ES 5.1 section 15.12.3: "If `gap` {whitespace}
                // is not the empty string, let `member` {quote(property) + ":"}
                // be the concatenation of `member` and the `space` character."
                // The "`space` character" refers to the literal space
                // character, not the `space` {width} argument provided to
                // `JSON.stringify`.
                results.push(quote(property) + ":" + (whitespace ? " " : "") + element);
              }
              any || (any = true);
            });
            result = any ? (whitespace ? "{\n" + indentation + results.join(",\n" + indentation) + "\n" + prefix + "}" : ("{" + results.join(",") + "}")) : "{}";
          }
          // Remove the object from the traversed object stack.
          stack.pop();
          return result;
        }
      };

      // Public: `JSON.stringify`. See ES 5.1 section 15.12.3.
      JSON3.stringify = function (source, filter, width) {
        var whitespace, callback, properties, index, length, value;
        if (typeof filter == "function" || typeof filter == "object" && filter) {
          if (getClass.call(filter) == "[object Function]") {
            callback = filter;
          } else if (getClass.call(filter) == "[object Array]") {
            // Convert the property names array into a makeshift set.
            properties = {};
            for (index = 0, length = filter.length; index < length; value = filter[index++], ((getClass.call(value) == "[object String]" || getClass.call(value) == "[object Number]") && (properties[value] = 1)));
          }
        }
        if (width) {
          if (getClass.call(width) == "[object Number]") {
            // Convert the `width` to an integer and create a string containing
            // `width` number of space characters.
            if ((width -= width % 1) > 0) {
              for (whitespace = "", width > 10 && (width = 10); whitespace.length < width; whitespace += " ");
            }
          } else if (getClass.call(width) == "[object String]") {
            whitespace = width.length <= 10 ? width : width.slice(0, 10);
          }
        }
        // Opera <= 7.54u2 discards the values associated with empty string keys
        // (`""`) only if they are used directly within an object member list
        // (e.g., `!("" in { "": 1})`).
        return serialize("", (value = {}, value[""] = source, value), callback, properties, whitespace, "", []);
      };
    }

    // Public: Parses a JSON source string.
    if (!has("json-parse")) {
      fromCharCode = String.fromCharCode;
      // Internal: A map of escaped control characters and their unescaped
      // equivalents.
      Unescapes = {
        "\\": "\\",
        '"': '"',
        "/": "/",
        "b": "\b",
        "t": "\t",
        "n": "\n",
        "f": "\f",
        "r": "\r"
      };

      // Internal: Resets the parser state and throws a `SyntaxError`.
      abort = function() {
        Index = Source = null;
        throw SyntaxError();
      };

      // Internal: Returns the next token, or `"$"` if the parser has reached
      // the end of the source string. A token may be a string, number, `null`
      // literal, or Boolean literal.
      lex = function () {
        var source = Source, length = source.length, symbol, value, begin, position, sign;
        while (Index < length) {
          symbol = source.charAt(Index);
          if ("\t\r\n ".indexOf(symbol) > -1) {
            // Skip whitespace tokens, including tabs, carriage returns, line
            // feeds, and space characters.
            Index++;
          } else if ("{}[]:,".indexOf(symbol) > -1) {
            // Parse a punctuator token at the current position.
            Index++;
            return symbol;
          } else if (symbol == '"') {
            // Advance to the next character and parse a JSON string at the
            // current position. String tokens are prefixed with the sentinel
            // `@` character to distinguish them from punctuators.
            for (value = "@", Index++; Index < length;) {
              symbol = source.charAt(Index);
              if (symbol < " ") {
                // Unescaped ASCII control characters are not permitted.
                abort();
              } else if (symbol == "\\") {
                // Parse escaped JSON control characters, `"`, `\`, `/`, and
                // Unicode escape sequences.
                symbol = source.charAt(++Index);
                if ('\\"/btnfr'.indexOf(symbol) > -1) {
                  // Revive escaped control characters.
                  value += Unescapes[symbol];
                  Index++;
                } else if (symbol == "u") {
                  // Advance to the first character of the escape sequence.
                  begin = ++Index;
                  // Validate the Unicode escape sequence.
                  for (position = Index + 4; Index < position; Index++) {
                    symbol = source.charAt(Index);
                    // A valid sequence comprises four hexdigits that form a
                    // single hexadecimal value.
                    if (!(symbol >= "0" && symbol <= "9" || symbol >= "a" && symbol <= "f" || symbol >= "A" && symbol <= "F")) {
                      // Invalid Unicode escape sequence.
                      abort();
                    }
                  }
                  // Revive the escaped character.
                  value += fromCharCode("0x" + source.slice(begin, Index));
                } else {
                  // Invalid escape sequence.
                  abort();
                }
              } else {
                if (symbol == '"') {
                  // An unescaped double-quote character marks the end of the
                  // string.
                  break;
                }
                // Append the original character as-is.
                value += symbol;
                Index++;
              }
            }
            if (source.charAt(Index) == '"') {
              Index++;
              // Return the revived string.
              return value;
            }
            // Unterminated string.
            abort();
          } else {
            // Parse numbers and literals.
            begin = Index;
            // Advance the scanner's position past the sign, if one is
            // specified.
            if (symbol == "-") {
              sign = true;
              symbol = source.charAt(++Index);
            }
            // Parse an integer or floating-point value.
            if (symbol >= "0" && symbol <= "9") {
              // Leading zeroes are interpreted as octal literals.
              if (symbol == "0" && (symbol = source.charAt(Index + 1), symbol >= "0" && symbol <= "9")) {
                // Illegal octal literal.
                abort();
              }
              sign = false;
              // Parse the integer component.
              for (; Index < length && (symbol = source.charAt(Index), symbol >= "0" && symbol <= "9"); Index++);
              // Floats cannot contain a leading decimal point; however, this
              // case is already accounted for by the parser.
              if (source.charAt(Index) == ".") {
                position = ++Index;
                // Parse the decimal component.
                for (; position < length && (symbol = source.charAt(position), symbol >= "0" && symbol <= "9"); position++);
                if (position == Index) {
                  // Illegal trailing decimal.
                  abort();
                }
                Index = position;
              }
              // Parse exponents.
              symbol = source.charAt(Index);
              if (symbol == "e" || symbol == "E") {
                // Skip past the sign following the exponent, if one is
                // specified.
                symbol = source.charAt(++Index);
                if (symbol == "+" || symbol == "-") {
                  Index++;
                }
                // Parse the exponential component.
                for (position = Index; position < length && (symbol = source.charAt(position), symbol >= "0" && symbol <= "9"); position++);
                if (position == Index) {
                  // Illegal empty exponent.
                  abort();
                }
                Index = position;
              }
              // Coerce the parsed value to a JavaScript number.
              return +source.slice(begin, Index);
            }
            // A negative sign may only precede numbers.
            if (sign) {
              abort();
            }
            // `true`, `false`, and `null` literals.
            if (source.slice(Index, Index + 4) == "true") {
              Index += 4;
              return true;
            } else if (source.slice(Index, Index + 5) == "false") {
              Index += 5;
              return false;
            } else if (source.slice(Index, Index + 4) == "null") {
              Index += 4;
              return null;
            }
            // Unrecognized token.
            abort();
          }
        }
        // Return the sentinel `$` character if the parser has reached the end
        // of the source string.
        return "$";
      };

      // Internal: Parses a JSON `value` token.
      get = function (value) {
        var results, any, key;
        if (value == "$") {
          // Unexpected end of input.
          abort();
        }
        if (typeof value == "string") {
          if (value.charAt(0) == "@") {
            // Remove the sentinel `@` character.
            return value.slice(1);
          }
          // Parse object and array literals.
          if (value == "[") {
            // Parses a JSON array, returning a new JavaScript array.
            results = [];
            for (;; any || (any = true)) {
              value = lex();
              // A closing square bracket marks the end of the array literal.
              if (value == "]") {
                break;
              }
              // If the array literal contains elements, the current token
              // should be a comma separating the previous element from the
              // next.
              if (any) {
                if (value == ",") {
                  value = lex();
                  if (value == "]") {
                    // Unexpected trailing `,` in array literal.
                    abort();
                  }
                } else {
                  // A `,` must separate each array element.
                  abort();
                }
              }
              // Elisions and leading commas are not permitted.
              if (value == ",") {
                abort();
              }
              results.push(get(value));
            }
            return results;
          } else if (value == "{") {
            // Parses a JSON object, returning a new JavaScript object.
            results = {};
            for (;; any || (any = true)) {
              value = lex();
              // A closing curly brace marks the end of the object literal.
              if (value == "}") {
                break;
              }
              // If the object literal contains members, the current token
              // should be a comma separator.
              if (any) {
                if (value == ",") {
                  value = lex();
                  if (value == "}") {
                    // Unexpected trailing `,` in object literal.
                    abort();
                  }
                } else {
                  // A `,` must separate each object member.
                  abort();
                }
              }
              // Leading commas are not permitted, object property names must be
              // double-quoted strings, and a `:` must separate each property
              // name and value.
              if (value == "," || typeof value != "string" || value.charAt(0) != "@" || lex() != ":") {
                abort();
              }
              results[value.slice(1)] = get(lex());
            }
            return results;
          }
          // Unexpected token encountered.
          abort();
        }
        return value;
      };

      // Internal: Updates a traversed object member.
      update = function(source, property, callback) {
        var element = walk(source, property, callback);
        if (element === undef) {
          delete source[property];
        } else {
          source[property] = element;
        }
      };

      // Internal: Recursively traverses a parsed JSON object, invoking the
      // `callback` function for each value. This is an implementation of the
      // `Walk(holder, name)` operation defined in ES 5.1 section 15.12.2.
      walk = function (source, property, callback) {
        var value = source[property], length;
        if (typeof value == "object" && value) {
          if (getClass.call(value) == "[object Array]") {
            for (length = value.length; length--;) {
              update(value, length, callback);
            }
          } else {
            // `forEach` can't be used to traverse an array in Opera <= 8.54,
            // as `Object#hasOwnProperty` returns `false` for array indices
            // (e.g., `![1, 2, 3].hasOwnProperty("0")`).
            forEach(value, function (property) {
              update(value, property, callback);
            });
          }
        }
        return callback.call(source, property, value);
      };

      // Public: `JSON.parse`. See ES 5.1 section 15.12.2.
      JSON3.parse = function (source, callback) {
        var result, value;
        Index = 0;
        Source = source;
        result = get(lex());
        // If a JSON string contains multiple tokens, it is invalid.
        if (lex() != "$") {
          abort();
        }
        // Reset the parser state.
        Index = Source = null;
        return callback && getClass.call(callback) == "[object Function]" ? walk((value = {}, value[""] = result, value), "", callback) : result;
      };
    }
  }

  // Export for asynchronous module loaders.
  if (isLoader) {
    define(function () {
      return JSON3;
    });
  }
}).call(this);
},{}],769:[function(require,module,exports){
(function (global){
/** @license MIT License (c) copyright 2013 original authors */
/**
 * XHR polyfill / shims
 *
 * @author Brian Cavalier
 * @author John Hann
 */
(function (global, define) {
define(function (require) {
"use strict";

	var progIds;

	// find XHR implementation
	if (typeof XMLHttpRequest == 'undefined') {
		// create xhr impl that will fail if called.
		assignCtor(function () { throw new Error("poly/xhr: XMLHttpRequest not available"); });
		// keep trying progIds until we find the correct one,
		progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];
		while (progIds.length && tryProgId(progIds.shift())) {}
	}

	function assignCtor (ctor) {
		// assign global.XMLHttpRequest function
		global.XMLHttpRequest = ctor;
	}

	function tryProgId (progId) {
		try {
			new ActiveXObject(progId);
			assignCtor(function () { return new ActiveXObject(progId); });
			return true;
		}
		catch (ex) {}
	}

});
}(
	typeof global != 'undefined' && global || this.global || this,
	typeof define == 'function' && define.amd
		? define
		: function (factory) { module.exports = factory(require); }
));

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],770:[function(require,module,exports){
/*! jQuery.ajaxRetry v0.1.3 | (c) 2013 Daniel Herman | opensource.org/licenses/MIT | https://github.com/dcherman/jQuery.ajaxRetry */
(function( $ ) {
    "use strict";

    var retryKey = "__RETRY__" + new Date().getTime();

    function isPromiseResolved( promise ) {
        if ( promise.state ) {
            return promise.state() !== "pending";
        } else {
            return promise.isResolved() || promise.isRejected();
        }
    }

    $.ajaxPrefilter(function( options, originalOptions, jqXHR ) {
        // Don't handle a call that's already "fixed" or that doesn't specify a shouldRetry option
        if ( options[retryKey] || typeof options.shouldRetry === "undefined" ) {
            return;
        }

        // Mark this as having been processed so the prefilter doesn't touch subsequent retried requests
        originalOptions[ retryKey ] = true;

        var
            // A deferred that will be resolved to satisfy the success, error, done, fail, and always handlers and deferreds
            dfr = $.Deferred(),

            // A deferred that'll be resolved to satisy the complete handler and deferred
            completeDeferred = $.Deferred(),

            // Any status code specific callbacks that should be invoked
            statusCode = {},

            // The number of times our request has been retried thus far
            retryCount = 0,

            // The options that'll be passed to our ajax handler if a retry is needed
            newOptions,

            // When the request finally completes, this will be the statusCode that the XHR returned
            finalStatusCode,

            // Returns either a boolean or a promise that'll be resolved with a boolean to determine
            // whether or not we should retry a given request.
            shouldRetry = function( jqXHR, retryCount, method ) {
                var result,
                    test = options.shouldRetry,
                    type = typeof test;

                switch( type ) {
                    case "number":
                        result = retryCount < test;
                        break;
                    case "boolean":
                        result = test;
                        break;
                    case "function":
                        result = test( jqXHR, retryCount, method );
                        break;
                }

                if ( typeof result === "object" && typeof result.then === "function" ) {
                    // If the value returned from a function is a promise, then ensure that
                    // if it's rejecteded, the promise returned from the function is resolved with false
                    // in order to avoid any situations where the request just hangs if someone rejects a promise.
                    // We can't simply use .then or .pipe here since those did not exist in 1.5
                    return $.Deferred(function( dfr ) {
                        result.then( dfr.resolve, function() {
                            dfr.resolve( false );
                        });
                    }).promise();
                }

                return $.when( result );
            };

        newOptions = $.extend({}, originalOptions, {
            success: $.noop,
            error: $.noop,
            complete: $.noop,
            statusCode: {}
        });

        (function tryRequest( options, lastJqXHR, finalizer ) {
            // If lastJqXHR === undefined at this point, then it's the first ever request.
            // Ensure that we always proceed without calling the shouldRetry function in that case
            ( !lastJqXHR ? $.when(true) : shouldRetry(lastJqXHR, retryCount++, options.type || "GET") ).done(function( willRetry ) {
                if ( willRetry === true ) {
                    (!lastJqXHR ? jqXHR : $.ajax(options) ).then(
                        function( data, textStatus, jqXHR ) {
                            finalStatusCode = jqXHR.status;
                            dfr.resolveWith( this, arguments );
                            dfr.done( statusCode[finalStatusCode] );
                            completeDeferred.resolveWith( this, [ jqXHR, textStatus ]);
                        },
                        function( jqXHR, textStatus ) {
                            var failureArgs = arguments,
                                failureContext = this;

                            tryRequest( options, jqXHR, function() {
                                finalStatusCode = jqXHR.status;
                                dfr.rejectWith( failureContext, failureArgs );
                                dfr.fail( statusCode[finalStatusCode] );
                                completeDeferred.resolveWith( failureContext, [ jqXHR, textStatus ]);
                            });
                        }
                    );
                }
                else {
                    finalizer();
                }


            });
        }( newOptions ));

        // Install legacy deferred style functions.  These are deprecated,
        // and presumably will be removed as a group at some point.
        // To maintain API compatibility, first check if we should even install these.
        if ( jqXHR.complete ) {
            jqXHR.complete = completeDeferred.done;
            jqXHR.success = dfr.done;
            jqXHR.error = dfr.fail;
        }

        // Override the promise methods on the jqXHR.  Don't use the .promise(obj) syntax
        // here since that wasn't introduced until 1.6.
        $.extend( jqXHR, dfr.promise() );

        jqXHR.statusCode = function( map ) {
            var code;

            if ( map ) {
                if ( isPromiseResolved(dfr) ) {
                    // Execute the appropriate callbacks.  Don't use .always() since it's not 1.5 compatible.
                    dfr.then( map[finalStatusCode], map[finalStatusCode] );
                } else {
                    for ( code in map ) {
                        // Lazy-add the new callback in a way that preserves old ones
                        statusCode[ code ] = [ statusCode[ code ], map[ code ] ];
                    }
                }
            }

            return this;
        };
    });
}( jQuery ));

},{}],771:[function(require,module,exports){
(function (root, factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module unless amdModuleId is set
    define([], function () {
      return (root['Autolinker'] = factory());
    });
  } else if (typeof exports === 'object') {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory();
  } else {
    root['Autolinker'] = factory();
  }
}(this, function () {

/*!
 * Autolinker.js
 * 0.15.3
 *
 * Copyright(c) 2015 Gregory Jacobs <greg@greg-jacobs.com>
 * MIT Licensed. http://www.opensource.org/licenses/mit-license.php
 *
 * https://github.com/gregjacobs/Autolinker.js
 */
/**
 * @class Autolinker
 * @extends Object
 * 
 * Utility class used to process a given string of text, and wrap the URLs, email addresses, and Twitter handles in 
 * the appropriate anchor (&lt;a&gt;) tags to turn them into links.
 * 
 * Any of the configuration options may be provided in an Object (map) provided to the Autolinker constructor, which
 * will configure how the {@link #link link()} method will process the links.
 * 
 * For example:
 * 
 *     var autolinker = new Autolinker( {
 *         newWindow : false,
 *         truncate  : 30
 *     } );
 *     
 *     var html = autolinker.link( "Joe went to www.yahoo.com" );
 *     // produces: 'Joe went to <a href="http://www.yahoo.com">yahoo.com</a>'
 * 
 * 
 * The {@link #static-link static link()} method may also be used to inline options into a single call, which may
 * be more convenient for one-off uses. For example:
 * 
 *     var html = Autolinker.link( "Joe went to www.yahoo.com", {
 *         newWindow : false,
 *         truncate  : 30
 *     } );
 *     // produces: 'Joe went to <a href="http://www.yahoo.com">yahoo.com</a>'
 * 
 * 
 * ## Custom Replacements of Links
 * 
 * If the configuration options do not provide enough flexibility, a {@link #replaceFn} may be provided to fully customize
 * the output of Autolinker. This function is called once for each URL/Email/Twitter handle match that is encountered.
 * 
 * For example:
 * 
 *     var input = "...";  // string with URLs, Email Addresses, and Twitter Handles
 *     
 *     var linkedText = Autolinker.link( input, {
 *         replaceFn : function( autolinker, match ) {
 *             console.log( "href = ", match.getAnchorHref() );
 *             console.log( "text = ", match.getAnchorText() );
 *         
 *             switch( match.getType() ) {
 *                 case 'url' : 
 *                     console.log( "url: ", match.getUrl() );
 *                     
 *                     if( match.getUrl().indexOf( 'mysite.com' ) === -1 ) {
 *                         var tag = autolinker.getTagBuilder().build( match );  // returns an `Autolinker.HtmlTag` instance, which provides mutator methods for easy changes
 *                         tag.setAttr( 'rel', 'nofollow' );
 *                         tag.addClass( 'external-link' );
 *                         
 *                         return tag;
 *                         
 *                     } else {
 *                         return true;  // let Autolinker perform its normal anchor tag replacement
 *                     }
 *                     
 *                 case 'email' :
 *                     var email = match.getEmail();
 *                     console.log( "email: ", email );
 *                     
 *                     if( email === "my@own.address" ) {
 *                         return false;  // don't auto-link this particular email address; leave as-is
 *                     } else {
 *                         return;  // no return value will have Autolinker perform its normal anchor tag replacement (same as returning `true`)
 *                     }
 *                 
 *                 case 'twitter' :
 *                     var twitterHandle = match.getTwitterHandle();
 *                     console.log( twitterHandle );
 *                     
 *                     return '<a href="http://newplace.to.link.twitter.handles.to/">' + twitterHandle + '</a>';
 *             }
 *         }
 *     } );
 * 
 * 
 * The function may return the following values:
 * 
 * - `true` (Boolean): Allow Autolinker to replace the match as it normally would.
 * - `false` (Boolean): Do not replace the current match at all - leave as-is.
 * - Any String: If a string is returned from the function, the string will be used directly as the replacement HTML for
 *   the match.
 * - An {@link Autolinker.HtmlTag} instance, which can be used to build/modify an HTML tag before writing out its HTML text.
 * 
 * @constructor
 * @param {Object} [config] The configuration options for the Autolinker instance, specified in an Object (map).
 */
var Autolinker = function( cfg ) {
	Autolinker.Util.assign( this, cfg );  // assign the properties of `cfg` onto the Autolinker instance. Prototype properties will be used for missing configs.
};


Autolinker.prototype = {
	constructor : Autolinker,  // fix constructor property
	
	/**
	 * @cfg {Boolean} urls
	 * 
	 * `true` if miscellaneous URLs should be automatically linked, `false` if they should not be.
	 */
	urls : true,
	
	/**
	 * @cfg {Boolean} email
	 * 
	 * `true` if email addresses should be automatically linked, `false` if they should not be.
	 */
	email : true,
	
	/**
	 * @cfg {Boolean} twitter
	 * 
	 * `true` if Twitter handles ("@example") should be automatically linked, `false` if they should not be.
	 */
	twitter : true,
	
	/**
	 * @cfg {Boolean} newWindow
	 * 
	 * `true` if the links should open in a new window, `false` otherwise.
	 */
	newWindow : true,
	
	/**
	 * @cfg {Boolean} stripPrefix
	 * 
	 * `true` if 'http://' or 'https://' and/or the 'www.' should be stripped from the beginning of URL links' text, 
	 * `false` otherwise.
	 */
	stripPrefix : true,
	
	/**
	 * @cfg {Number} truncate
	 * 
	 * A number for how many characters long URLs/emails/twitter handles should be truncated to inside the text of 
	 * a link. If the URL/email/twitter is over this number of characters, it will be truncated to this length by 
	 * adding a two period ellipsis ('..') to the end of the string.
	 * 
	 * For example: A url like 'http://www.yahoo.com/some/long/path/to/a/file' truncated to 25 characters might look
	 * something like this: 'yahoo.com/some/long/pat..'
	 */
	truncate : undefined,
	
	/**
	 * @cfg {String} className
	 * 
	 * A CSS class name to add to the generated links. This class will be added to all links, as well as this class
	 * plus url/email/twitter suffixes for styling url/email/twitter links differently.
	 * 
	 * For example, if this config is provided as "myLink", then:
	 * 
	 * - URL links will have the CSS classes: "myLink myLink-url"
	 * - Email links will have the CSS classes: "myLink myLink-email", and
	 * - Twitter links will have the CSS classes: "myLink myLink-twitter"
	 */
	className : "",
	
	/**
	 * @cfg {Function} replaceFn
	 * 
	 * A function to individually process each URL/Email/Twitter match found in the input string.
	 * 
	 * See the class's description for usage.
	 * 
	 * This function is called with the following parameters:
	 * 
	 * @cfg {Autolinker} replaceFn.autolinker The Autolinker instance, which may be used to retrieve child objects from (such
	 *   as the instance's {@link #getTagBuilder tag builder}).
	 * @cfg {Autolinker.match.Match} replaceFn.match The Match instance which can be used to retrieve information about the
	 *   {@link Autolinker.match.Url URL}/{@link Autolinker.match.Email email}/{@link Autolinker.match.Twitter Twitter}
	 *   match that the `replaceFn` is currently processing.
	 */
	
	
	/**
	 * @private
	 * @property {Autolinker.htmlParser.HtmlParser} htmlParser
	 * 
	 * The HtmlParser instance used to skip over HTML tags, while finding text nodes to process. This is lazily instantiated
	 * in the {@link #getHtmlParser} method.
	 */
	htmlParser : undefined,
	
	/**
	 * @private
	 * @property {Autolinker.matchParser.MatchParser} matchParser
	 * 
	 * The MatchParser instance used to find URL/email/Twitter matches in the text nodes of an input string passed to
	 * {@link #link}. This is lazily instantiated in the {@link #getMatchParser} method.
	 */
	matchParser : undefined,
	
	/**
	 * @private
	 * @property {Autolinker.AnchorTagBuilder} tagBuilder
	 * 
	 * The AnchorTagBuilder instance used to build the URL/email/Twitter replacement anchor tags. This is lazily instantiated
	 * in the {@link #getTagBuilder} method.
	 */
	tagBuilder : undefined,
	
	
	/**
	 * Automatically links URLs, email addresses, and Twitter handles found in the given chunk of HTML. 
	 * Does not link URLs found within HTML tags.
	 * 
	 * For instance, if given the text: `You should go to http://www.yahoo.com`, then the result
	 * will be `You should go to &lt;a href="http://www.yahoo.com"&gt;http://www.yahoo.com&lt;/a&gt;`
	 * 
	 * This method finds the text around any HTML elements in the input `textOrHtml`, which will be the text that is processed.
	 * Any original HTML elements will be left as-is, as well as the text that is already wrapped in anchor (&lt;a&gt;) tags.
	 * 
	 * @param {String} textOrHtml The HTML or text to link URLs, email addresses, and Twitter handles within (depending on if
	 *   the {@link #urls}, {@link #email}, and {@link #twitter} options are enabled).
	 * @return {String} The HTML, with URLs/emails/Twitter handles automatically linked.
	 */
	link : function( textOrHtml ) {
		var htmlParser = this.getHtmlParser(),
		    htmlNodes = htmlParser.parse( textOrHtml ),
		    anchorTagStackCount = 0,  // used to only process text around anchor tags, and any inner text/html they may have
		    resultHtml = [];
		
		for( var i = 0, len = htmlNodes.length; i < len; i++ ) {
			var node = htmlNodes[ i ],
			    nodeType = node.getType(),
			    nodeText = node.getText();
			
			if( nodeType === 'element' ) {
				// Process HTML nodes in the input `textOrHtml`
				if( node.getTagName() === 'a' ) {
					if( !node.isClosing() ) {  // it's the start <a> tag
						anchorTagStackCount++;
					} else {   // it's the end </a> tag
						anchorTagStackCount = Math.max( anchorTagStackCount - 1, 0 );  // attempt to handle extraneous </a> tags by making sure the stack count never goes below 0
					}
				}
				resultHtml.push( nodeText );  // now add the text of the tag itself verbatim
				
			} else if( nodeType === 'entity' ) {
				resultHtml.push( nodeText );  // append HTML entity nodes (such as '&nbsp;') verbatim
				
			} else {
				// Process text nodes in the input `textOrHtml`
				if( anchorTagStackCount === 0 ) {
					// If we're not within an <a> tag, process the text node to linkify
					var linkifiedStr = this.linkifyStr( nodeText );
					resultHtml.push( linkifiedStr );
					
				} else {
					// `text` is within an <a> tag, simply append the text - we do not want to autolink anything 
					// already within an <a>...</a> tag
					resultHtml.push( nodeText );
				}
			}
		}
		
		return resultHtml.join( "" );
	},
	
	
	/**
	 * Process the text that lies in between HTML tags, performing the anchor tag replacements for matched 
	 * URLs/emails/Twitter handles, and returns the string with the replacements made. 
	 * 
	 * This method does the actual wrapping of URLs/emails/Twitter handles with anchor tags.
	 * 
	 * @private
	 * @param {String} str The string of text to auto-link.
	 * @return {String} The text with anchor tags auto-filled.
	 */
	linkifyStr : function( str ) {
		return this.getMatchParser().replace( str, this.createMatchReturnVal, this );
	},
	
	
	/**
	 * Creates the return string value for a given match in the input string, for the {@link #processTextNode} method.
	 * 
	 * This method handles the {@link #replaceFn}, if one was provided.
	 * 
	 * @private
	 * @param {Autolinker.match.Match} match The Match object that represents the match.
	 * @return {String} The string that the `match` should be replaced with. This is usually the anchor tag string, but
	 *   may be the `matchStr` itself if the match is not to be replaced.
	 */
	createMatchReturnVal : function( match ) {
		// Handle a custom `replaceFn` being provided
		var replaceFnResult;
		if( this.replaceFn ) {
			replaceFnResult = this.replaceFn.call( this, this, match );  // Autolinker instance is the context, and the first arg
		}
		
		if( typeof replaceFnResult === 'string' ) {
			return replaceFnResult;  // `replaceFn` returned a string, use that
			
		} else if( replaceFnResult === false ) {
			return match.getMatchedText();  // no replacement for the match
			
		} else if( replaceFnResult instanceof Autolinker.HtmlTag ) {
			return replaceFnResult.toString();
		
		} else {  // replaceFnResult === true, or no/unknown return value from function
			// Perform Autolinker's default anchor tag generation
			var tagBuilder = this.getTagBuilder(),
			    anchorTag = tagBuilder.build( match );  // returns an Autolinker.HtmlTag instance
			
			return anchorTag.toString();
		}
	},
	
	
	/**
	 * Lazily instantiates and returns the {@link #htmlParser} instance for this Autolinker instance.
	 * 
	 * @protected
	 * @return {Autolinker.htmlParser.HtmlParser}
	 */
	getHtmlParser : function() {
		var htmlParser = this.htmlParser;
		
		if( !htmlParser ) {
			htmlParser = this.htmlParser = new Autolinker.htmlParser.HtmlParser();
		}
		
		return htmlParser;
	},
	
	
	/**
	 * Lazily instantiates and returns the {@link #matchParser} instance for this Autolinker instance.
	 * 
	 * @protected
	 * @return {Autolinker.matchParser.MatchParser}
	 */
	getMatchParser : function() {
		var matchParser = this.matchParser;
		
		if( !matchParser ) {
			matchParser = this.matchParser = new Autolinker.matchParser.MatchParser( {
				urls : this.urls,
				email : this.email,
				twitter : this.twitter,
				stripPrefix : this.stripPrefix
			} );
		}
		
		return matchParser;
	},
	
	
	/**
	 * Returns the {@link #tagBuilder} instance for this Autolinker instance, lazily instantiating it
	 * if it does not yet exist.
	 * 
	 * This method may be used in a {@link #replaceFn} to generate the {@link Autolinker.HtmlTag HtmlTag} instance that 
	 * Autolinker would normally generate, and then allow for modifications before returning it. For example:
	 * 
	 *     var html = Autolinker.link( "Test google.com", {
	 *         replaceFn : function( autolinker, match ) {
	 *             var tag = autolinker.getTagBuilder().build( match );  // returns an {@link Autolinker.HtmlTag} instance
	 *             tag.setAttr( 'rel', 'nofollow' );
	 *             
	 *             return tag;
	 *         }
	 *     } );
	 *     
	 *     // generated html:
	 *     //   Test <a href="http://google.com" target="_blank" rel="nofollow">google.com</a>
	 * 
	 * @return {Autolinker.AnchorTagBuilder}
	 */
	getTagBuilder : function() {
		var tagBuilder = this.tagBuilder;
		
		if( !tagBuilder ) {
			tagBuilder = this.tagBuilder = new Autolinker.AnchorTagBuilder( {
				newWindow   : this.newWindow,
				truncate    : this.truncate,
				className   : this.className
			} );
		}
		
		return tagBuilder;
	}

};


/**
 * Automatically links URLs, email addresses, and Twitter handles found in the given chunk of HTML. 
 * Does not link URLs found within HTML tags.
 * 
 * For instance, if given the text: `You should go to http://www.yahoo.com`, then the result
 * will be `You should go to &lt;a href="http://www.yahoo.com"&gt;http://www.yahoo.com&lt;/a&gt;`
 * 
 * Example:
 * 
 *     var linkedText = Autolinker.link( "Go to google.com", { newWindow: false } );
 *     // Produces: "Go to <a href="http://google.com">google.com</a>"
 * 
 * @static
 * @param {String} textOrHtml The HTML or text to find URLs, email addresses, and Twitter handles within (depending on if
 *   the {@link #urls}, {@link #email}, and {@link #twitter} options are enabled).
 * @param {Object} [options] Any of the configuration options for the Autolinker class, specified in an Object (map).
 *   See the class description for an example call.
 * @return {String} The HTML text, with URLs automatically linked
 */
Autolinker.link = function( textOrHtml, options ) {
	var autolinker = new Autolinker( options );
	return autolinker.link( textOrHtml );
};


// Autolinker Namespaces
Autolinker.match = {};
Autolinker.htmlParser = {};
Autolinker.matchParser = {};
/*global Autolinker */
/*jshint eqnull:true, boss:true */
/**
 * @class Autolinker.Util
 * @singleton
 * 
 * A few utility methods for Autolinker.
 */
Autolinker.Util = {
	
	/**
	 * @property {Function} abstractMethod
	 * 
	 * A function object which represents an abstract method.
	 */
	abstractMethod : function() { throw "abstract"; },
	
	
	/**
	 * Assigns (shallow copies) the properties of `src` onto `dest`.
	 * 
	 * @param {Object} dest The destination object.
	 * @param {Object} src The source object.
	 * @return {Object} The destination object (`dest`)
	 */
	assign : function( dest, src ) {
		for( var prop in src ) {
			if( src.hasOwnProperty( prop ) ) {
				dest[ prop ] = src[ prop ];
			}
		}
		
		return dest;
	},
	
	
	/**
	 * Extends `superclass` to create a new subclass, adding the `protoProps` to the new subclass's prototype.
	 * 
	 * @param {Function} superclass The constructor function for the superclass.
	 * @param {Object} protoProps The methods/properties to add to the subclass's prototype. This may contain the
	 *   special property `constructor`, which will be used as the new subclass's constructor function.
	 * @return {Function} The new subclass function.
	 */
	extend : function( superclass, protoProps ) {
		var superclassProto = superclass.prototype;
		
		var F = function() {};
		F.prototype = superclassProto;
		
		var subclass;
		if( protoProps.hasOwnProperty( 'constructor' ) ) {
			subclass = protoProps.constructor;
		} else {
			subclass = function() { superclassProto.constructor.apply( this, arguments ); };
		}
		
		var subclassProto = subclass.prototype = new F();  // set up prototype chain
		subclassProto.constructor = subclass;  // fix constructor property
		subclassProto.superclass = superclassProto;
		
		delete protoProps.constructor;  // don't re-assign constructor property to the prototype, since a new function may have been created (`subclass`), which is now already there
		Autolinker.Util.assign( subclassProto, protoProps );
		
		return subclass;
	},
	
	
	/**
	 * Truncates the `str` at `len - ellipsisChars.length`, and adds the `ellipsisChars` to the
	 * end of the string (by default, two periods: '..'). If the `str` length does not exceed 
	 * `len`, the string will be returned unchanged.
	 * 
	 * @param {String} str The string to truncate and add an ellipsis to.
	 * @param {Number} truncateLen The length to truncate the string at.
	 * @param {String} [ellipsisChars=..] The ellipsis character(s) to add to the end of `str`
	 *   when truncated. Defaults to '..'
	 */
	ellipsis : function( str, truncateLen, ellipsisChars ) {
		if( str.length > truncateLen ) {
			ellipsisChars = ( ellipsisChars == null ) ? '..' : ellipsisChars;
			str = str.substring( 0, truncateLen - ellipsisChars.length ) + ellipsisChars;
		}
		return str;
	},
	
	
	/**
	 * Supports `Array.prototype.indexOf()` functionality for old IE (IE8 and below).
	 * 
	 * @param {Array} arr The array to find an element of.
	 * @param {*} element The element to find in the array, and return the index of.
	 * @return {Number} The index of the `element`, or -1 if it was not found.
	 */
	indexOf : function( arr, element ) {
		if( Array.prototype.indexOf ) {
			return arr.indexOf( element );
			
		} else {
			for( var i = 0, len = arr.length; i < len; i++ ) {
				if( arr[ i ] === element ) return i;
			}
			return -1;
		}
	},
	
	
	
	/**
	 * Performs the functionality of what modern browsers do when `String.prototype.split()` is called
	 * with a regular expression that contains capturing parenthesis.
	 * 
	 * For example:
	 * 
	 *     // Modern browsers: 
	 *     "a,b,c".split( /(,)/ );  // --> [ 'a', ',', 'b', ',', 'c' ]
	 *     
	 *     // Old IE (including IE8):
	 *     "a,b,c".split( /(,)/ );  // --> [ 'a', 'b', 'c' ]
	 *     
	 * This method emulates the functionality of modern browsers for the old IE case.
	 * 
	 * @param {String} str The string to split.
	 * @param {RegExp} splitRegex The regular expression to split the input `str` on. The splitting
	 *   character(s) will be spliced into the array, as in the "modern browsers" example in the 
	 *   description of this method. 
	 *   Note #1: the supplied regular expression **must** have the 'g' flag specified.
	 *   Note #2: for simplicity's sake, the regular expression does not need 
	 *   to contain capturing parenthesis - it will be assumed that any match has them.
	 * @return {String[]} The split array of strings, with the splitting character(s) included.
	 */
	splitAndCapture : function( str, splitRegex ) {
		if( !splitRegex.global ) throw new Error( "`splitRegex` must have the 'g' flag set" );
		
		var result = [],
		    lastIdx = 0,
		    match;
		
		while( match = splitRegex.exec( str ) ) {
			result.push( str.substring( lastIdx, match.index ) );
			result.push( match[ 0 ] );  // push the splitting char(s)
			
			lastIdx = match.index + match[ 0 ].length;
		}
		result.push( str.substring( lastIdx ) );
		
		return result;
	}
	
};
/*global Autolinker */
/*jshint boss:true */
/**
 * @class Autolinker.HtmlTag
 * @extends Object
 * 
 * Represents an HTML tag, which can be used to easily build/modify HTML tags programmatically.
 * 
 * Autolinker uses this abstraction to create HTML tags, and then write them out as strings. You may also use
 * this class in your code, especially within a {@link Autolinker#replaceFn replaceFn}.
 * 
 * ## Examples
 * 
 * Example instantiation:
 * 
 *     var tag = new Autolinker.HtmlTag( {
 *         tagName : 'a',
 *         attrs   : { 'href': 'http://google.com', 'class': 'external-link' },
 *         innerHtml : 'Google'
 *     } );
 *     
 *     tag.toString();  // <a href="http://google.com" class="external-link">Google</a>
 *     
 *     // Individual accessor methods
 *     tag.getTagName();                 // 'a'
 *     tag.getAttr( 'href' );            // 'http://google.com'
 *     tag.hasClass( 'external-link' );  // true
 * 
 * 
 * Using mutator methods (which may be used in combination with instantiation config properties):
 * 
 *     var tag = new Autolinker.HtmlTag();
 *     tag.setTagName( 'a' );
 *     tag.setAttr( 'href', 'http://google.com' );
 *     tag.addClass( 'external-link' );
 *     tag.setInnerHtml( 'Google' );
 *     
 *     tag.getTagName();                 // 'a'
 *     tag.getAttr( 'href' );            // 'http://google.com'
 *     tag.hasClass( 'external-link' );  // true
 *     
 *     tag.toString();  // <a href="http://google.com" class="external-link">Google</a>
 *     
 * 
 * ## Example use within a {@link Autolinker#replaceFn replaceFn}
 * 
 *     var html = Autolinker.link( "Test google.com", {
 *         replaceFn : function( autolinker, match ) {
 *             var tag = autolinker.getTagBuilder().build( match );  // returns an {@link Autolinker.HtmlTag} instance, configured with the Match's href and anchor text
 *             tag.setAttr( 'rel', 'nofollow' );
 *             
 *             return tag;
 *         }
 *     } );
 *     
 *     // generated html:
 *     //   Test <a href="http://google.com" target="_blank" rel="nofollow">google.com</a>
 *     
 *     
 * ## Example use with a new tag for the replacement
 * 
 *     var html = Autolinker.link( "Test google.com", {
 *         replaceFn : function( autolinker, match ) {
 *             var tag = new Autolinker.HtmlTag( {
 *                 tagName : 'button',
 *                 attrs   : { 'title': 'Load URL: ' + match.getAnchorHref() },
 *                 innerHtml : 'Load URL: ' + match.getAnchorText()
 *             } );
 *             
 *             return tag;
 *         }
 *     } );
 *     
 *     // generated html:
 *     //   Test <button title="Load URL: http://google.com">Load URL: google.com</button>
 */
Autolinker.HtmlTag = Autolinker.Util.extend( Object, {
	
	/**
	 * @cfg {String} tagName
	 * 
	 * The tag name. Ex: 'a', 'button', etc.
	 * 
	 * Not required at instantiation time, but should be set using {@link #setTagName} before {@link #toString}
	 * is executed.
	 */
	
	/**
	 * @cfg {Object.<String, String>} attrs
	 * 
	 * An key/value Object (map) of attributes to create the tag with. The keys are the attribute names, and the
	 * values are the attribute values.
	 */
	
	/**
	 * @cfg {String} innerHtml
	 * 
	 * The inner HTML for the tag. 
	 * 
	 * Note the camel case name on `innerHtml`. Acronyms are camelCased in this utility (such as not to run into the acronym 
	 * naming inconsistency that the DOM developers created with `XMLHttpRequest`). You may alternatively use {@link #innerHTML}
	 * if you prefer, but this one is recommended.
	 */
	
	/**
	 * @cfg {String} innerHTML
	 * 
	 * Alias of {@link #innerHtml}, accepted for consistency with the browser DOM api, but prefer the camelCased version
	 * for acronym names.
	 */
	
	
	/**
	 * @protected
	 * @property {RegExp} whitespaceRegex
	 * 
	 * Regular expression used to match whitespace in a string of CSS classes.
	 */
	whitespaceRegex : /\s+/,
	
	
	/**
	 * @constructor
	 * @param {Object} [cfg] The configuration properties for this class, in an Object (map)
	 */
	constructor : function( cfg ) {
		Autolinker.Util.assign( this, cfg );
		
		this.innerHtml = this.innerHtml || this.innerHTML;  // accept either the camelCased form or the fully capitalized acronym
	},
	
	
	/**
	 * Sets the tag name that will be used to generate the tag with.
	 * 
	 * @param {String} tagName
	 * @return {Autolinker.HtmlTag} This HtmlTag instance, so that method calls may be chained.
	 */
	setTagName : function( tagName ) {
		this.tagName = tagName;
		return this;
	},
	
	
	/**
	 * Retrieves the tag name.
	 * 
	 * @return {String}
	 */
	getTagName : function() {
		return this.tagName || "";
	},
	
	
	/**
	 * Sets an attribute on the HtmlTag.
	 * 
	 * @param {String} attrName The attribute name to set.
	 * @param {String} attrValue The attribute value to set.
	 * @return {Autolinker.HtmlTag} This HtmlTag instance, so that method calls may be chained.
	 */
	setAttr : function( attrName, attrValue ) {
		var tagAttrs = this.getAttrs();
		tagAttrs[ attrName ] = attrValue;
		
		return this;
	},
	
	
	/**
	 * Retrieves an attribute from the HtmlTag. If the attribute does not exist, returns `undefined`.
	 * 
	 * @param {String} name The attribute name to retrieve.
	 * @return {String} The attribute's value, or `undefined` if it does not exist on the HtmlTag.
	 */
	getAttr : function( attrName ) {
		return this.getAttrs()[ attrName ];
	},
	
	
	/**
	 * Sets one or more attributes on the HtmlTag.
	 * 
	 * @param {Object.<String, String>} attrs A key/value Object (map) of the attributes to set.
	 * @return {Autolinker.HtmlTag} This HtmlTag instance, so that method calls may be chained.
	 */
	setAttrs : function( attrs ) {
		var tagAttrs = this.getAttrs();
		Autolinker.Util.assign( tagAttrs, attrs );
		
		return this;
	},
	
	
	/**
	 * Retrieves the attributes Object (map) for the HtmlTag.
	 * 
	 * @return {Object.<String, String>} A key/value object of the attributes for the HtmlTag.
	 */
	getAttrs : function() {
		return this.attrs || ( this.attrs = {} );
	},
	
	
	/**
	 * Sets the provided `cssClass`, overwriting any current CSS classes on the HtmlTag.
	 * 
	 * @param {String} cssClass One or more space-separated CSS classes to set (overwrite).
	 * @return {Autolinker.HtmlTag} This HtmlTag instance, so that method calls may be chained.
	 */
	setClass : function( cssClass ) {
		return this.setAttr( 'class', cssClass );
	},
	
	
	/**
	 * Convenience method to add one or more CSS classes to the HtmlTag. Will not add duplicate CSS classes.
	 * 
	 * @param {String} cssClass One or more space-separated CSS classes to add.
	 * @return {Autolinker.HtmlTag} This HtmlTag instance, so that method calls may be chained.
	 */
	addClass : function( cssClass ) {
		var classAttr = this.getClass(),
		    whitespaceRegex = this.whitespaceRegex,
		    indexOf = Autolinker.Util.indexOf,  // to support IE8 and below
		    classes = ( !classAttr ) ? [] : classAttr.split( whitespaceRegex ),
		    newClasses = cssClass.split( whitespaceRegex ),
		    newClass;
		
		while( newClass = newClasses.shift() ) {
			if( indexOf( classes, newClass ) === -1 ) {
				classes.push( newClass );
			}
		}
		
		this.getAttrs()[ 'class' ] = classes.join( " " );
		return this;
	},
	
	
	/**
	 * Convenience method to remove one or more CSS classes from the HtmlTag.
	 * 
	 * @param {String} cssClass One or more space-separated CSS classes to remove.
	 * @return {Autolinker.HtmlTag} This HtmlTag instance, so that method calls may be chained.
	 */
	removeClass : function( cssClass ) {
		var classAttr = this.getClass(),
		    whitespaceRegex = this.whitespaceRegex,
		    indexOf = Autolinker.Util.indexOf,  // to support IE8 and below
		    classes = ( !classAttr ) ? [] : classAttr.split( whitespaceRegex ),
		    removeClasses = cssClass.split( whitespaceRegex ),
		    removeClass;
		
		while( classes.length && ( removeClass = removeClasses.shift() ) ) {
			var idx = indexOf( classes, removeClass );
			if( idx !== -1 ) {
				classes.splice( idx, 1 );
			}
		}
		
		this.getAttrs()[ 'class' ] = classes.join( " " );
		return this;
	},
	
	
	/**
	 * Convenience method to retrieve the CSS class(es) for the HtmlTag, which will each be separated by spaces when
	 * there are multiple.
	 * 
	 * @return {String}
	 */
	getClass : function() {
		return this.getAttrs()[ 'class' ] || "";
	},
	
	
	/**
	 * Convenience method to check if the tag has a CSS class or not.
	 * 
	 * @param {String} cssClass The CSS class to check for.
	 * @return {Boolean} `true` if the HtmlTag has the CSS class, `false` otherwise.
	 */
	hasClass : function( cssClass ) {
		return ( ' ' + this.getClass() + ' ' ).indexOf( ' ' + cssClass + ' ' ) !== -1;
	},
	
	
	/**
	 * Sets the inner HTML for the tag.
	 * 
	 * @param {String} html The inner HTML to set.
	 * @return {Autolinker.HtmlTag} This HtmlTag instance, so that method calls may be chained.
	 */
	setInnerHtml : function( html ) {
		this.innerHtml = html;
		
		return this;
	},
	
	
	/**
	 * Retrieves the inner HTML for the tag.
	 * 
	 * @return {String}
	 */
	getInnerHtml : function() {
		return this.innerHtml || "";
	},
	
	
	/**
	 * Override of superclass method used to generate the HTML string for the tag.
	 * 
	 * @return {String}
	 */
	toString : function() {
		var tagName = this.getTagName(),
		    attrsStr = this.buildAttrsStr();
		
		attrsStr = ( attrsStr ) ? ' ' + attrsStr : '';  // prepend a space if there are actually attributes
		
		return [ '<', tagName, attrsStr, '>', this.getInnerHtml(), '</', tagName, '>' ].join( "" );
	},
	
	
	/**
	 * Support method for {@link #toString}, returns the string space-separated key="value" pairs, used to populate 
	 * the stringified HtmlTag.
	 * 
	 * @protected
	 * @return {String} Example return: `attr1="value1" attr2="value2"`
	 */
	buildAttrsStr : function() {
		if( !this.attrs ) return "";  // no `attrs` Object (map) has been set, return empty string
		
		var attrs = this.getAttrs(),
		    attrsArr = [];
		
		for( var prop in attrs ) {
			if( attrs.hasOwnProperty( prop ) ) {
				attrsArr.push( prop + '="' + attrs[ prop ] + '"' );
			}
		}
		return attrsArr.join( " " );
	}
	
} );
/*global Autolinker */
/*jshint sub:true */
/**
 * @protected
 * @class Autolinker.AnchorTagBuilder
 * @extends Object
 * 
 * Builds anchor (&lt;a&gt;) tags for the Autolinker utility when a match is found.
 * 
 * Normally this class is instantiated, configured, and used internally by an {@link Autolinker} instance, but may 
 * actually be retrieved in a {@link Autolinker#replaceFn replaceFn} to create {@link Autolinker.HtmlTag HtmlTag} instances
 * which may be modified before returning from the {@link Autolinker#replaceFn replaceFn}. For example:
 * 
 *     var html = Autolinker.link( "Test google.com", {
 *         replaceFn : function( autolinker, match ) {
 *             var tag = autolinker.getTagBuilder().build( match );  // returns an {@link Autolinker.HtmlTag} instance
 *             tag.setAttr( 'rel', 'nofollow' );
 *             
 *             return tag;
 *         }
 *     } );
 *     
 *     // generated html:
 *     //   Test <a href="http://google.com" target="_blank" rel="nofollow">google.com</a>
 */
Autolinker.AnchorTagBuilder = Autolinker.Util.extend( Object, {
	
	/**
	 * @cfg {Boolean} newWindow
	 * @inheritdoc Autolinker#newWindow
	 */
	
	/**
	 * @cfg {Number} truncate
	 * @inheritdoc Autolinker#truncate
	 */
	
	/**
	 * @cfg {String} className
	 * @inheritdoc Autolinker#className
	 */
	
	
	/**
	 * @constructor
	 * @param {Object} [cfg] The configuration options for the AnchorTagBuilder instance, specified in an Object (map).
	 */
	constructor : function( cfg ) {
		Autolinker.Util.assign( this, cfg );
	},
	
	
	/**
	 * Generates the actual anchor (&lt;a&gt;) tag to use in place of the matched URL/email/Twitter text,
	 * via its `match` object.
	 * 
	 * @param {Autolinker.match.Match} match The Match instance to generate an anchor tag from.
	 * @return {Autolinker.HtmlTag} The HtmlTag instance for the anchor tag.
	 */
	build : function( match ) {
		var tag = new Autolinker.HtmlTag( {
			tagName   : 'a',
			attrs     : this.createAttrs( match.getType(), match.getAnchorHref() ),
			innerHtml : this.processAnchorText( match.getAnchorText() )
		} );
		
		return tag;
	},
	
	
	/**
	 * Creates the Object (map) of the HTML attributes for the anchor (&lt;a&gt;) tag being generated.
	 * 
	 * @protected
	 * @param {"url"/"email"/"twitter"} matchType The type of match that an anchor tag is being generated for.
	 * @param {String} href The href for the anchor tag.
	 * @return {Object} A key/value Object (map) of the anchor tag's attributes. 
	 */
	createAttrs : function( matchType, anchorHref ) {
		var attrs = {
			'href' : anchorHref  // we'll always have the `href` attribute
		};
		
		var cssClass = this.createCssClass( matchType );
		if( cssClass ) {
			attrs[ 'class' ] = cssClass;
		}
		if( this.newWindow ) {
			attrs[ 'target' ] = "_blank";
		}
		
		return attrs;
	},
	
	
	/**
	 * Creates the CSS class that will be used for a given anchor tag, based on the `matchType` and the {@link #className}
	 * config.
	 * 
	 * @private
	 * @param {"url"/"email"/"twitter"} matchType The type of match that an anchor tag is being generated for.
	 * @return {String} The CSS class string for the link. Example return: "myLink myLink-url". If no {@link #className}
	 *   was configured, returns an empty string.
	 */
	createCssClass : function( matchType ) {
		var className = this.className;
		
		if( !className ) 
			return "";
		else
			return className + " " + className + "-" + matchType;  // ex: "myLink myLink-url", "myLink myLink-email", or "myLink myLink-twitter"
	},
	
	
	/**
	 * Processes the `anchorText` by truncating the text according to the {@link #truncate} config.
	 * 
	 * @private
	 * @param {String} anchorText The anchor tag's text (i.e. what will be displayed).
	 * @return {String} The processed `anchorText`.
	 */
	processAnchorText : function( anchorText ) {
		anchorText = this.doTruncate( anchorText );
		
		return anchorText;
	},
	
	
	/**
	 * Performs the truncation of the `anchorText`, if the `anchorText` is longer than the {@link #truncate} option.
	 * Truncates the text to 2 characters fewer than the {@link #truncate} option, and adds ".." to the end.
	 * 
	 * @private
	 * @param {String} text The anchor tag's text (i.e. what will be displayed).
	 * @return {String} The truncated anchor text.
	 */
	doTruncate : function( anchorText ) {
		return Autolinker.Util.ellipsis( anchorText, this.truncate || Number.POSITIVE_INFINITY );
	}
	
} );
/*global Autolinker */
/**
 * @private
 * @class Autolinker.htmlParser.HtmlParser
 * @extends Object
 * 
 * An HTML parser implementation which simply walks an HTML string and returns an array of 
 * {@link Autolinker.htmlParser.HtmlNode HtmlNodes} that represent the basic HTML structure of the input string.
 * 
 * Autolinker uses this to only link URLs/emails/Twitter handles within text nodes, effectively ignoring / "walking
 * around" HTML tags.
 */
Autolinker.htmlParser.HtmlParser = Autolinker.Util.extend( Object, {
	
	/**
	 * @private
	 * @property {RegExp} htmlRegex
	 * 
	 * The regular expression used to pull out HTML tags from a string. Handles namespaced HTML tags and
	 * attribute names, as specified by http://www.w3.org/TR/html-markup/syntax.html.
	 * 
	 * Capturing groups:
	 * 
	 * 1. The "!DOCTYPE" tag name, if a tag is a &lt;!DOCTYPE&gt; tag.
	 * 2. If it is an end tag, this group will have the '/'.
	 * 3. The tag name for all tags (other than the &lt;!DOCTYPE&gt; tag)
	 */
	htmlRegex : (function() {
		var tagNameRegex = /[0-9a-zA-Z][0-9a-zA-Z:]*/,
		    attrNameRegex = /[^\s\0"'>\/=\x01-\x1F\x7F]+/,   // the unicode range accounts for excluding control chars, and the delete char
		    attrValueRegex = /(?:"[^"]*?"|'[^']*?'|[^'"=<>`\s]+)/, // double quoted, single quoted, or unquoted attribute values
		    nameEqualsValueRegex = attrNameRegex.source + '(?:\\s*=\\s*' + attrValueRegex.source + ')?';  // optional '=[value]'
		
		return new RegExp( [
			// for <!DOCTYPE> tag. Ex: <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">) 
			'(?:',
				'<(!DOCTYPE)',  // *** Capturing Group 1 - If it's a doctype tag
					
					// Zero or more attributes following the tag name
					'(?:',
						'\\s+',  // one or more whitespace chars before an attribute
						
						// Either:
						// A. attr="value", or 
						// B. "value" alone (To cover example doctype tag: <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">) 
						'(?:', nameEqualsValueRegex, '|', attrValueRegex.source + ')',
					')*',
				'>',
			')',
			
			'|',
			
			// All other HTML tags (i.e. tags that are not <!DOCTYPE>)
			'(?:',
				'<(/)?',  // Beginning of a tag. Either '<' for a start tag, or '</' for an end tag. 
				          // *** Capturing Group 2: The slash or an empty string. Slash ('/') for end tag, empty string for start or self-closing tag.
			
					// *** Capturing Group 3 - The tag name
					'(' + tagNameRegex.source + ')',
					
					// Zero or more attributes following the tag name
					'(?:',
						'\\s+',                // one or more whitespace chars before an attribute
						nameEqualsValueRegex,  // attr="value" (with optional ="value" part)
					')*',
					
					'\\s*/?',  // any trailing spaces and optional '/' before the closing '>'
				'>',
			')'
		].join( "" ), 'gi' );
	} )(),
	
	/**
	 * @private
	 * @property {RegExp} htmlCharacterEntitiesRegex
	 *
	 * The regular expression that matches common HTML character entities.
	 * 
	 * Ignoring &amp; as it could be part of a query string -- handling it separately.
	 */
	htmlCharacterEntitiesRegex: /(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi,
	
	
	/**
	 * Parses an HTML string and returns a simple array of {@link Autolinker.htmlParser.HtmlNode HtmlNodes} to represent
	 * the HTML structure of the input string. 
	 * 
	 * @param {String} html The HTML to parse.
	 * @return {Autolinker.htmlParser.HtmlNode[]}
	 */
	parse : function( html ) {
		var htmlRegex = this.htmlRegex,
		    currentResult,
		    lastIndex = 0,
		    textAndEntityNodes,
		    nodes = [];  // will be the result of the method
		
		while( ( currentResult = htmlRegex.exec( html ) ) !== null ) {
			var tagText = currentResult[ 0 ],
			    tagName = currentResult[ 1 ] || currentResult[ 3 ],  // The <!DOCTYPE> tag (ex: "!DOCTYPE"), or another tag (ex: "a" or "img") 
			    isClosingTag = !!currentResult[ 2 ],
			    inBetweenTagsText = html.substring( lastIndex, currentResult.index );
			
			// Push TextNodes and EntityNodes for any text found between tags
			if( inBetweenTagsText ) {
				textAndEntityNodes = this.parseTextAndEntityNodes( inBetweenTagsText );
				nodes.push.apply( nodes, textAndEntityNodes );
			}
			
			// Push the ElementNode
			nodes.push( this.createElementNode( tagText, tagName, isClosingTag ) );
			
			lastIndex = currentResult.index + tagText.length;
		}
		
		// Process any remaining text after the last HTML element. Will process all of the text if there were no HTML elements.
		if( lastIndex < html.length ) {
			var text = html.substring( lastIndex );
			
			// Push TextNodes and EntityNodes for any text found between tags
			if( text ) {
				textAndEntityNodes = this.parseTextAndEntityNodes( text );
				nodes.push.apply( nodes, textAndEntityNodes );
			}
		}
		
		return nodes;
	},
	
	
	/**
	 * Parses text and HTML entity nodes from a given string. The input string should not have any HTML tags (elements)
	 * within it.
	 * 
	 * @private
	 * @param {String} text The text to parse.
	 * @return {Autolinker.htmlParser.HtmlNode[]} An array of HtmlNodes to represent the 
	 *   {@link Autolinker.htmlParser.TextNode TextNodes} and {@link Autolinker.htmlParser.EntityNode EntityNodes} found.
	 */
	parseTextAndEntityNodes : function( text ) {
		var nodes = [],
		    textAndEntityTokens = Autolinker.Util.splitAndCapture( text, this.htmlCharacterEntitiesRegex );  // split at HTML entities, but include the HTML entities in the results array
		
		// Every even numbered token is a TextNode, and every odd numbered token is an EntityNode
		// For example: an input `text` of "Test &quot;this&quot; today" would turn into the 
		//   `textAndEntityTokens`: [ 'Test ', '&quot;', 'this', '&quot;', ' today' ]
		for( var i = 0, len = textAndEntityTokens.length; i < len; i += 2 ) {
			var textToken = textAndEntityTokens[ i ],
			    entityToken = textAndEntityTokens[ i + 1 ];
			
			if( textToken ) nodes.push( this.createTextNode( textToken ) );
			if( entityToken ) nodes.push( this.createEntityNode( entityToken ) );
		}
		return nodes;
	},
	
	
	/**
	 * Factory method to create an {@link Autolinker.htmlParser.ElementNode ElementNode}.
	 * 
	 * @private
	 * @param {String} tagText The full text of the tag (element) that was matched, including its attributes.
	 * @param {String} tagName The name of the tag. Ex: An &lt;img&gt; tag would be passed to this method as "img".
	 * @param {Boolean} isClosingTag `true` if it's a closing tag, false otherwise.
	 * @return {Autolinker.htmlParser.ElementNode}
	 */
	createElementNode : function( tagText, tagName, isClosingTag ) {
		return new Autolinker.htmlParser.ElementNode( {
			text    : tagText,
			tagName : tagName.toLowerCase(),
			closing : isClosingTag
		} );
	},
	
	
	/**
	 * Factory method to create a {@link Autolinker.htmlParser.EntityNode EntityNode}.
	 * 
	 * @private
	 * @param {String} text The text that was matched for the HTML entity (such as '&amp;nbsp;').
	 * @return {Autolinker.htmlParser.EntityNode}
	 */
	createEntityNode : function( text ) {
		return new Autolinker.htmlParser.EntityNode( { text: text } );
	},
	
	
	/**
	 * Factory method to create a {@link Autolinker.htmlParser.TextNode TextNode}.
	 * 
	 * @private
	 * @param {String} text The text that was matched.
	 * @return {Autolinker.htmlParser.TextNode}
	 */
	createTextNode : function( text ) {
		return new Autolinker.htmlParser.TextNode( { text: text } );
	}
	
} );
/*global Autolinker */
/**
 * @abstract
 * @class Autolinker.htmlParser.HtmlNode
 * 
 * Represents an HTML node found in an input string. An HTML node is one of the following:
 * 
 * 1. An {@link Autolinker.htmlParser.ElementNode ElementNode}, which represents HTML tags.
 * 2. A {@link Autolinker.htmlParser.TextNode TextNode}, which represents text outside or within HTML tags.
 * 3. A {@link Autolinker.htmlParser.EntityNode EntityNode}, which represents one of the known HTML
 *    entities that Autolinker looks for. This includes common ones such as &amp;quot; and &amp;nbsp;
 */
Autolinker.htmlParser.HtmlNode = Autolinker.Util.extend( Object, {
	
	/**
	 * @cfg {String} text (required)
	 * 
	 * The original text that was matched for the HtmlNode. 
	 * 
	 * - In the case of an {@link Autolinker.htmlParser.ElementNode ElementNode}, this will be the tag's
	 *   text.
	 * - In the case of a {@link Autolinker.htmlParser.TextNode TextNode}, this will be the text itself.
	 * - In the case of a {@link Autolinker.htmlParser.EntityNode EntityNode}, this will be the text of
	 *   the HTML entity.
	 */
	text : "",
	
	
	/**
	 * @constructor
	 * @param {Object} cfg The configuration properties for the Match instance, specified in an Object (map).
	 */
	constructor : function( cfg ) {
		Autolinker.Util.assign( this, cfg );
	},

	
	/**
	 * Returns a string name for the type of node that this class represents.
	 * 
	 * @abstract
	 * @return {String}
	 */
	getType : Autolinker.Util.abstractMethod,
	
	
	/**
	 * Retrieves the {@link #text} for the HtmlNode.
	 * 
	 * @return {String}
	 */
	getText : function() {
		return this.text;
	}

} );
/*global Autolinker */
/**
 * @class Autolinker.htmlParser.ElementNode
 * @extends Autolinker.htmlParser.HtmlNode
 * 
 * Represents an HTML element node that has been parsed by the {@link Autolinker.htmlParser.HtmlParser}.
 * 
 * See this class's superclass ({@link Autolinker.htmlParser.HtmlNode}) for more details.
 */
Autolinker.htmlParser.ElementNode = Autolinker.Util.extend( Autolinker.htmlParser.HtmlNode, {
	
	/**
	 * @cfg {String} tagName (required)
	 * 
	 * The name of the tag that was matched.
	 */
	tagName : '',
	
	/**
	 * @cfg {Boolean} closing (required)
	 * 
	 * `true` if the element (tag) is a closing tag, `false` if its an opening tag.
	 */
	closing : false,

	
	/**
	 * Returns a string name for the type of node that this class represents.
	 * 
	 * @return {String}
	 */
	getType : function() {
		return 'element';
	},
	

	/**
	 * Returns the HTML element's (tag's) name. Ex: for an &lt;img&gt; tag, returns "img".
	 * 
	 * @return {String}
	 */
	getTagName : function() {
		return this.tagName;
	},
	
	
	/**
	 * Determines if the HTML element (tag) is a closing tag. Ex: &lt;div&gt; returns
	 * `false`, while &lt;/div&gt; returns `true`.
	 * 
	 * @return {Boolean}
	 */
	isClosing : function() {
		return this.closing;
	}
	
} );
/*global Autolinker */
/**
 * @class Autolinker.htmlParser.EntityNode
 * @extends Autolinker.htmlParser.HtmlNode
 * 
 * Represents a known HTML entity node that has been parsed by the {@link Autolinker.htmlParser.HtmlParser}.
 * Ex: '&amp;nbsp;', or '&amp#160;' (which will be retrievable from the {@link #getText} method.
 * 
 * Note that this class will only be returned from the HtmlParser for the set of checked HTML entity nodes 
 * defined by the {@link Autolinker.htmlParser.HtmlParser#htmlCharacterEntitiesRegex}.
 * 
 * See this class's superclass ({@link Autolinker.htmlParser.HtmlNode}) for more details.
 */
Autolinker.htmlParser.EntityNode = Autolinker.Util.extend( Autolinker.htmlParser.HtmlNode, {
	
	/**
	 * Returns a string name for the type of node that this class represents.
	 * 
	 * @return {String}
	 */
	getType : function() {
		return 'entity';
	}
	
} );
/*global Autolinker */
/**
 * @class Autolinker.htmlParser.TextNode
 * @extends Autolinker.htmlParser.HtmlNode
 * 
 * Represents a text node that has been parsed by the {@link Autolinker.htmlParser.HtmlParser}.
 * 
 * See this class's superclass ({@link Autolinker.htmlParser.HtmlNode}) for more details.
 */
Autolinker.htmlParser.TextNode = Autolinker.Util.extend( Autolinker.htmlParser.HtmlNode, {
	
	/**
	 * Returns a string name for the type of node that this class represents.
	 * 
	 * @return {String}
	 */
	getType : function() {
		return 'text';
	}
	
} );
/*global Autolinker */
/**
 * @private
 * @class Autolinker.matchParser.MatchParser
 * @extends Object
 * 
 * Used by Autolinker to parse {@link #urls URLs}, {@link #emails email addresses}, and {@link #twitter Twitter handles}, 
 * given an input string of text.
 * 
 * The MatchParser is fed a non-HTML string in order to search out URLs, email addresses and Twitter handles. Autolinker
 * first uses the {@link HtmlParser} to "walk around" HTML tags, and then the text around the HTML tags is passed into
 * the MatchParser in order to find the actual matches.
 */
Autolinker.matchParser.MatchParser = Autolinker.Util.extend( Object, {
	
	/**
	 * @cfg {Boolean} urls
	 * 
	 * `true` if miscellaneous URLs should be automatically linked, `false` if they should not be.
	 */
	urls : true,
	
	/**
	 * @cfg {Boolean} email
	 * 
	 * `true` if email addresses should be automatically linked, `false` if they should not be.
	 */
	email : true,
	
	/**
	 * @cfg {Boolean} twitter
	 * 
	 * `true` if Twitter handles ("@example") should be automatically linked, `false` if they should not be.
	 */
	twitter : true,
	
	/**
	 * @cfg {Boolean} stripPrefix
	 * 
	 * `true` if 'http://' or 'https://' and/or the 'www.' should be stripped from the beginning of URL links' text
	 * in {@link Autolinker.match.Url URL matches}, `false` otherwise.
	 * 
	 * TODO: Handle this before a URL Match object is instantiated.
	 */
	stripPrefix : true,
	
	
	/**
	 * @private
	 * @property {RegExp} matcherRegex
	 * 
	 * The regular expression that matches URLs, email addresses, and Twitter handles.
	 * 
	 * This regular expression has the following capturing groups:
	 * 
	 * 1. Group that is used to determine if there is a Twitter handle match (i.e. \@someTwitterUser). Simply check for its 
	 *    existence to determine if there is a Twitter handle match. The next couple of capturing groups give information 
	 *    about the Twitter handle match.
	 * 2. The whitespace character before the \@sign in a Twitter handle. This is needed because there are no lookbehinds in
	 *    JS regular expressions, and can be used to reconstruct the original string in a replace().
	 * 3. The Twitter handle itself in a Twitter match. If the match is '@someTwitterUser', the handle is 'someTwitterUser'.
	 * 4. Group that matches an email address. Used to determine if the match is an email address, as well as holding the full 
	 *    address. Ex: 'me@my.com'
	 * 5. Group that matches a URL in the input text. Ex: 'http://google.com', 'www.google.com', or just 'google.com'.
	 *    This also includes a path, url parameters, or hash anchors. Ex: google.com/path/to/file?q1=1&q2=2#myAnchor
	 * 6. Group that matches a protocol URL (i.e. 'http://google.com'). This is used to match protocol URLs with just a single
	 *    word, like 'http://localhost', where we won't double check that the domain name has at least one '.' in it.
	 * 7. A protocol-relative ('//') match for the case of a 'www.' prefixed URL. Will be an empty string if it is not a 
	 *    protocol-relative match. We need to know the character before the '//' in order to determine if it is a valid match
	 *    or the // was in a string we don't want to auto-link.
	 * 8. A protocol-relative ('//') match for the case of a known TLD prefixed URL. Will be an empty string if it is not a 
	 *    protocol-relative match. See #6 for more info. 
	 */
	matcherRegex : (function() {
		var twitterRegex = /(^|[^\w])@(\w{1,15})/,              // For matching a twitter handle. Ex: @gregory_jacobs
		    
		    emailRegex = /(?:[\-;:&=\+\$,\w\.]+@)/,             // something@ for email addresses (a.k.a. local-part)
		    
		    protocolRegex = /(?:[A-Za-z][-.+A-Za-z0-9]+:(?![A-Za-z][-.+A-Za-z0-9]+:\/\/)(?!\d+\/?)(?:\/\/)?)/,  // match protocol, allow in format "http://" or "mailto:". However, do not match the first part of something like 'link:http://www.google.com' (i.e. don't match "link:"). Also, make sure we don't interpret 'google.com:8000' as if 'google.com' was a protocol here (i.e. ignore a trailing port number in this regex)
		    wwwRegex = /(?:www\.)/,                             // starting with 'www.'
		    domainNameRegex = /[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,  // anything looking at all like a domain, non-unicode domains, not ending in a period
		    tldRegex = /\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/,   // match our known top level domains (TLDs)
		    
		    // Allow optional path, query string, and hash anchor, not ending in the following characters: "?!:,.;"
		    // http://blog.codinghorror.com/the-problem-with-urls/
		    urlSuffixRegex = /[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]?!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]]/;
		
		return new RegExp( [
			'(',  // *** Capturing group $1, which can be used to check for a twitter handle match. Use group $3 for the actual twitter handle though. $2 may be used to reconstruct the original string in a replace() 
				// *** Capturing group $2, which matches the whitespace character before the '@' sign (needed because of no lookbehinds), and 
				// *** Capturing group $3, which matches the actual twitter handle
				twitterRegex.source,
			')',
			
			'|',
			
			'(',  // *** Capturing group $4, which is used to determine an email match
				emailRegex.source,
				domainNameRegex.source,
				tldRegex.source,
			')',
			
			'|',
			
			'(',  // *** Capturing group $5, which is used to match a URL
				'(?:', // parens to cover match for protocol (optional), and domain
					'(',  // *** Capturing group $6, for a protocol-prefixed url (ex: http://google.com)
						protocolRegex.source,
						domainNameRegex.source,
					')',
					
					'|',
					
					'(?:',  // non-capturing paren for a 'www.' prefixed url (ex: www.google.com)
						'(.?//)?',  // *** Capturing group $7 for an optional protocol-relative URL. Must be at the beginning of the string or start with a non-word character
						wwwRegex.source,
						domainNameRegex.source,
					')',
					
					'|',
					
					'(?:',  // non-capturing paren for known a TLD url (ex: google.com)
						'(.?//)?',  // *** Capturing group $8 for an optional protocol-relative URL. Must be at the beginning of the string or start with a non-word character
						domainNameRegex.source,
						tldRegex.source,
					')',
				')',
				
				'(?:' + urlSuffixRegex.source + ')?',  // match for path, query string, and/or hash anchor - optional
			')'
		].join( "" ), 'gi' );
	} )(),
	
	/**
	 * @private
	 * @property {RegExp} charBeforeProtocolRelMatchRegex
	 * 
	 * The regular expression used to retrieve the character before a protocol-relative URL match.
	 * 
	 * This is used in conjunction with the {@link #matcherRegex}, which needs to grab the character before a protocol-relative
	 * '//' due to the lack of a negative look-behind in JavaScript regular expressions. The character before the match is stripped
	 * from the URL.
	 */
	charBeforeProtocolRelMatchRegex : /^(.)?\/\//,
	
	/**
	 * @private
	 * @property {Autolinker.MatchValidator} matchValidator
	 * 
	 * The MatchValidator object, used to filter out any false positives from the {@link #matcherRegex}. See
	 * {@link Autolinker.MatchValidator} for details.
	 */
	
	
	/**
	 * @constructor
	 * @param {Object} [cfg] The configuration options for the AnchorTagBuilder instance, specified in an Object (map).
	 */
	constructor : function( cfg ) {
		Autolinker.Util.assign( this, cfg );
	
		this.matchValidator = new Autolinker.MatchValidator();
	},
	
	
	/**
	 * Parses the input `text` to search for URLs/emails/Twitter handles, and calls the `replaceFn`
	 * to allow replacements of the matches. Returns the `text` with matches replaced.
	 * 
	 * @param {String} text The text to search and repace matches in.
	 * @param {Function} replaceFn The iterator function to handle the replacements. The function takes a
	 *   single argument, a {@link Autolinker.match.Match} object, and should return the text that should
	 *   make the replacement.
	 * @param {Object} [contextObj=window] The context object ("scope") to run the `replaceFn` in.
	 * @return {String}
	 */
	replace : function( text, replaceFn, contextObj ) {
		var me = this;  // for closure
		
		return text.replace( this.matcherRegex, function( matchStr, $1, $2, $3, $4, $5, $6, $7, $8 ) {
			var matchDescObj = me.processCandidateMatch( matchStr, $1, $2, $3, $4, $5, $6, $7, $8 );  // "match description" object
			
			// Return out with no changes for match types that are disabled (url, email, twitter), or for matches that are 
			// invalid (false positives from the matcherRegex, which can't use look-behinds since they are unavailable in JS).
			if( !matchDescObj ) {
				return matchStr;
				
			} else {
				// Generate replacement text for the match from the `replaceFn`
				var replaceStr = replaceFn.call( contextObj, matchDescObj.match );
				return matchDescObj.prefixStr + replaceStr + matchDescObj.suffixStr;
			}
		} );
	},
	
	
	/**
	 * Processes a candidate match from the {@link #matcherRegex}. 
	 * 
	 * Not all matches found by the regex are actual URL/email/Twitter matches, as determined by the {@link #matchValidator}. In
	 * this case, the method returns `null`. Otherwise, a valid Object with `prefixStr`, `match`, and `suffixStr` is returned.
	 * 
	 * @private
	 * @param {String} matchStr The full match that was found by the {@link #matcherRegex}.
	 * @param {String} twitterMatch The matched text of a Twitter handle, if the match is a Twitter match.
	 * @param {String} twitterHandlePrefixWhitespaceChar The whitespace char before the @ sign in a Twitter handle match. This 
	 *   is needed because of no lookbehinds in JS regexes, and is need to re-include the character for the anchor tag replacement.
	 * @param {String} twitterHandle The actual Twitter user (i.e the word after the @ sign in a Twitter match).
	 * @param {String} emailAddressMatch The matched email address for an email address match.
	 * @param {String} urlMatch The matched URL string for a URL match.
	 * @param {String} protocolUrlMatch The match URL string for a protocol match. Ex: 'http://yahoo.com'. This is used to match
	 *   something like 'http://localhost', where we won't double check that the domain name has at least one '.' in it.
	 * @param {String} wwwProtocolRelativeMatch The '//' for a protocol-relative match from a 'www' url, with the character that 
	 *   comes before the '//'.
	 * @param {String} tldProtocolRelativeMatch The '//' for a protocol-relative match from a TLD (top level domain) match, with 
	 *   the character that comes before the '//'.
	 *   
	 * @return {Object} A "match description object". This will be `null` if the match was invalid, or if a match type is disabled.
	 *   Otherwise, this will be an Object (map) with the following properties:
	 * @return {String} return.prefixStr The char(s) that should be prepended to the replacement string. These are char(s) that
	 *   were needed to be included from the regex match that were ignored by processing code, and should be re-inserted into 
	 *   the replacement stream.
	 * @return {String} return.suffixStr The char(s) that should be appended to the replacement string. These are char(s) that
	 *   were needed to be included from the regex match that were ignored by processing code, and should be re-inserted into 
	 *   the replacement stream.
	 * @return {Autolinker.match.Match} return.match The Match object that represents the match that was found.
	 */
	processCandidateMatch : function( 
		matchStr, twitterMatch, twitterHandlePrefixWhitespaceChar, twitterHandle, 
		emailAddressMatch, urlMatch, protocolUrlMatch, wwwProtocolRelativeMatch, tldProtocolRelativeMatch
	) {
		// Note: The `matchStr` variable wil be fixed up to remove characters that are no longer needed (which will 
		// be added to `prefixStr` and `suffixStr`).
		
		var protocolRelativeMatch = wwwProtocolRelativeMatch || tldProtocolRelativeMatch,
		    match,  // Will be an Autolinker.match.Match object
		    
		    prefixStr = "",       // A string to use to prefix the anchor tag that is created. This is needed for the Twitter handle match
		    suffixStr = "";       // A string to suffix the anchor tag that is created. This is used if there is a trailing parenthesis that should not be auto-linked.
		    
		
		// Return out with `null` for match types that are disabled (url, email, twitter), or for matches that are 
		// invalid (false positives from the matcherRegex, which can't use look-behinds since they are unavailable in JS).
		if(
			( twitterMatch && !this.twitter ) || ( emailAddressMatch && !this.email ) || ( urlMatch && !this.urls ) ||
			!this.matchValidator.isValidMatch( urlMatch, protocolUrlMatch, protocolRelativeMatch ) 
		) {
			return null;
		}
		
		// Handle a closing parenthesis at the end of the match, and exclude it if there is not a matching open parenthesis
		// in the match itself. 
		if( this.matchHasUnbalancedClosingParen( matchStr ) ) {
			matchStr = matchStr.substr( 0, matchStr.length - 1 );  // remove the trailing ")"
			suffixStr = ")";  // this will be added after the generated <a> tag
		}
		
		
		if( emailAddressMatch ) {
			match = new Autolinker.match.Email( { matchedText: matchStr, email: emailAddressMatch } );
			
		} else if( twitterMatch ) {
			// fix up the `matchStr` if there was a preceding whitespace char, which was needed to determine the match 
			// itself (since there are no look-behinds in JS regexes)
			if( twitterHandlePrefixWhitespaceChar ) {
				prefixStr = twitterHandlePrefixWhitespaceChar;
				matchStr = matchStr.slice( 1 );  // remove the prefixed whitespace char from the match
			}
			match = new Autolinker.match.Twitter( { matchedText: matchStr, twitterHandle: twitterHandle } );
			
		} else {  // url match
			// If it's a protocol-relative '//' match, remove the character before the '//' (which the matcherRegex needed
			// to match due to the lack of a negative look-behind in JavaScript regular expressions)
			if( protocolRelativeMatch ) {
				var charBeforeMatch = protocolRelativeMatch.match( this.charBeforeProtocolRelMatchRegex )[ 1 ] || "";
				
				if( charBeforeMatch ) {  // fix up the `matchStr` if there was a preceding char before a protocol-relative match, which was needed to determine the match itself (since there are no look-behinds in JS regexes)
					prefixStr = charBeforeMatch;
					matchStr = matchStr.slice( 1 );  // remove the prefixed char from the match
				}
			}
			
			match = new Autolinker.match.Url( {
				matchedText : matchStr,
				url : matchStr,
				protocolUrlMatch : !!protocolUrlMatch,
				protocolRelativeMatch : !!protocolRelativeMatch,
				stripPrefix : this.stripPrefix
			} );
		}
		
		return {
			prefixStr : prefixStr,
			suffixStr : suffixStr,
			match     : match
		};
	},
	
	
	/**
	 * Determines if a match found has an unmatched closing parenthesis. If so, this parenthesis will be removed
	 * from the match itself, and appended after the generated anchor tag in {@link #processTextNode}.
	 * 
	 * A match may have an extra closing parenthesis at the end of the match because the regular expression must include parenthesis
	 * for URLs such as "wikipedia.com/something_(disambiguation)", which should be auto-linked. 
	 * 
	 * However, an extra parenthesis *will* be included when the URL itself is wrapped in parenthesis, such as in the case of
	 * "(wikipedia.com/something_(disambiguation))". In this case, the last closing parenthesis should *not* be part of the URL 
	 * itself, and this method will return `true`.
	 * 
	 * @private
	 * @param {String} matchStr The full match string from the {@link #matcherRegex}.
	 * @return {Boolean} `true` if there is an unbalanced closing parenthesis at the end of the `matchStr`, `false` otherwise.
	 */
	matchHasUnbalancedClosingParen : function( matchStr ) {
		var lastChar = matchStr.charAt( matchStr.length - 1 );
		
		if( lastChar === ')' ) {
			var openParensMatch = matchStr.match( /\(/g ),
			    closeParensMatch = matchStr.match( /\)/g ),
			    numOpenParens = ( openParensMatch && openParensMatch.length ) || 0,
			    numCloseParens = ( closeParensMatch && closeParensMatch.length ) || 0;
			
			if( numOpenParens < numCloseParens ) {
				return true;
			}
		}
		
		return false;
	}
	
} );
/*global Autolinker */
/*jshint scripturl:true */
/**
 * @private
 * @class Autolinker.MatchValidator
 * @extends Object
 * 
 * Used by Autolinker to filter out false positives from the {@link Autolinker#matcherRegex}.
 * 
 * Due to the limitations of regular expressions (including the missing feature of look-behinds in JS regular expressions),
 * we cannot always determine the validity of a given match. This class applies a bit of additional logic to filter out any
 * false positives that have been matched by the {@link Autolinker#matcherRegex}.
 */
Autolinker.MatchValidator = Autolinker.Util.extend( Object, {
	
	/**
	 * @private
	 * @property {RegExp} invalidProtocolRelMatchRegex
	 * 
	 * The regular expression used to check a potential protocol-relative URL match, coming from the 
	 * {@link Autolinker#matcherRegex}. A protocol-relative URL is, for example, "//yahoo.com"
	 * 
	 * This regular expression checks to see if there is a word character before the '//' match in order to determine if 
	 * we should actually autolink a protocol-relative URL. This is needed because there is no negative look-behind in 
	 * JavaScript regular expressions. 
	 * 
	 * For instance, we want to autolink something like "Go to: //google.com", but we don't want to autolink something 
	 * like "abc//google.com"
	 */
	invalidProtocolRelMatchRegex : /^[\w]\/\//,
	
	/**
	 * Regex to test for a full protocol, with the two trailing slashes. Ex: 'http://'
	 * 
	 * @private
	 * @property {RegExp} hasFullProtocolRegex
	 */
	hasFullProtocolRegex : /^[A-Za-z][-.+A-Za-z0-9]+:\/\//,
	
	/**
	 * Regex to find the URI scheme, such as 'mailto:'.
	 * 
	 * This is used to filter out 'javascript:' and 'vbscript:' schemes.
	 * 
	 * @private
	 * @property {RegExp} uriSchemeRegex
	 */
	uriSchemeRegex : /^[A-Za-z][-.+A-Za-z0-9]+:/,
	
	/**
	 * Regex to determine if at least one word char exists after the protocol (i.e. after the ':')
	 * 
	 * @private
	 * @property {RegExp} hasWordCharAfterProtocolRegex
	 */
	hasWordCharAfterProtocolRegex : /:[^\s]*?[A-Za-z]/,
	
	
	/**
	 * Determines if a given match found by {@link Autolinker#processTextNode} is valid. Will return `false` for:
	 * 
	 * 1) URL matches which do not have at least have one period ('.') in the domain name (effectively skipping over 
	 *    matches like "abc:def"). However, URL matches with a protocol will be allowed (ex: 'http://localhost')
	 * 2) URL matches which do not have at least one word character in the domain name (effectively skipping over
	 *    matches like "git:1.0").
	 * 3) A protocol-relative url match (a URL beginning with '//') whose previous character is a word character 
	 *    (effectively skipping over strings like "abc//google.com")
	 * 
	 * Otherwise, returns `true`.
	 * 
	 * @param {String} urlMatch The matched URL, if there was one. Will be an empty string if the match is not a URL match.
	 * @param {String} protocolUrlMatch The match URL string for a protocol match. Ex: 'http://yahoo.com'. This is used to match
	 *   something like 'http://localhost', where we won't double check that the domain name has at least one '.' in it.
	 * @param {String} protocolRelativeMatch The protocol-relative string for a URL match (i.e. '//'), possibly with a preceding
	 *   character (ex, a space, such as: ' //', or a letter, such as: 'a//'). The match is invalid if there is a word character
	 *   preceding the '//'.
	 * @return {Boolean} `true` if the match given is valid and should be processed, or `false` if the match is invalid and/or 
	 *   should just not be processed.
	 */
	isValidMatch : function( urlMatch, protocolUrlMatch, protocolRelativeMatch ) {
		if(
			( protocolUrlMatch && !this.isValidUriScheme( protocolUrlMatch ) ) ||
			this.urlMatchDoesNotHaveProtocolOrDot( urlMatch, protocolUrlMatch ) ||       // At least one period ('.') must exist in the URL match for us to consider it an actual URL, *unless* it was a full protocol match (like 'http://localhost')
			this.urlMatchDoesNotHaveAtLeastOneWordChar( urlMatch, protocolUrlMatch ) ||  // At least one letter character must exist in the domain name after a protocol match. Ex: skip over something like "git:1.0"
			this.isInvalidProtocolRelativeMatch( protocolRelativeMatch )                 // A protocol-relative match which has a word character in front of it (so we can skip something like "abc//google.com")
		) {
			return false;
		}
		
		return true;
	},
	
	
	/**
	 * Determines if the URI scheme is a valid scheme to be autolinked. Returns `false` if the scheme is 
	 * 'javascript:' or 'vbscript:'
	 * 
	 * @private
	 * @param {String} uriSchemeMatch The match URL string for a full URI scheme match. Ex: 'http://yahoo.com' 
	 *   or 'mailto:a@a.com'.
	 * @return {Boolean} `true` if the scheme is a valid one, `false` otherwise.
	 */
	isValidUriScheme : function( uriSchemeMatch ) {
		var uriScheme = uriSchemeMatch.match( this.uriSchemeRegex )[ 0 ].toLowerCase();
		
		return ( uriScheme !== 'javascript:' && uriScheme !== 'vbscript:' );
	},
	
	
	/**
	 * Determines if a URL match does not have either:
	 * 
	 * a) a full protocol (i.e. 'http://'), or
	 * b) at least one dot ('.') in the domain name (for a non-full-protocol match).
	 * 
	 * Either situation is considered an invalid URL (ex: 'git:d' does not have either the '://' part, or at least one dot
	 * in the domain name. If the match was 'git:abc.com', we would consider this valid.)
	 * 
	 * @private
	 * @param {String} urlMatch The matched URL, if there was one. Will be an empty string if the match is not a URL match.
	 * @param {String} protocolUrlMatch The match URL string for a protocol match. Ex: 'http://yahoo.com'. This is used to match
	 *   something like 'http://localhost', where we won't double check that the domain name has at least one '.' in it.
	 * @return {Boolean} `true` if the URL match does not have a full protocol, or at least one dot ('.') in a non-full-protocol
	 *   match.
	 */
	urlMatchDoesNotHaveProtocolOrDot : function( urlMatch, protocolUrlMatch ) {
		return ( !!urlMatch && ( !protocolUrlMatch || !this.hasFullProtocolRegex.test( protocolUrlMatch ) ) && urlMatch.indexOf( '.' ) === -1 );
	},
	
	
	/**
	 * Determines if a URL match does not have at least one word character after the protocol (i.e. in the domain name).
	 * 
	 * At least one letter character must exist in the domain name after a protocol match. Ex: skip over something 
	 * like "git:1.0"
	 * 
	 * @private
	 * @param {String} urlMatch The matched URL, if there was one. Will be an empty string if the match is not a URL match.
	 * @param {String} protocolUrlMatch The match URL string for a protocol match. Ex: 'http://yahoo.com'. This is used to
	 *   know whether or not we have a protocol in the URL string, in order to check for a word character after the protocol
	 *   separator (':').
	 * @return {Boolean} `true` if the URL match does not have at least one word character in it after the protocol, `false`
	 *   otherwise.
	 */
	urlMatchDoesNotHaveAtLeastOneWordChar : function( urlMatch, protocolUrlMatch ) {
		if( urlMatch && protocolUrlMatch ) {
			return !this.hasWordCharAfterProtocolRegex.test( urlMatch );
		} else {
			return false;
		}
	},
	
	
	/**
	 * Determines if a protocol-relative match is an invalid one. This method returns `true` if there is a `protocolRelativeMatch`,
	 * and that match contains a word character before the '//' (i.e. it must contain whitespace or nothing before the '//' in
	 * order to be considered valid).
	 * 
	 * @private
	 * @param {String} protocolRelativeMatch The protocol-relative string for a URL match (i.e. '//'), possibly with a preceding
	 *   character (ex, a space, such as: ' //', or a letter, such as: 'a//'). The match is invalid if there is a word character
	 *   preceding the '//'.
	 * @return {Boolean} `true` if it is an invalid protocol-relative match, `false` otherwise.
	 */
	isInvalidProtocolRelativeMatch : function( protocolRelativeMatch ) {
		return ( !!protocolRelativeMatch && this.invalidProtocolRelMatchRegex.test( protocolRelativeMatch ) );
	}

} );
/*global Autolinker */
/**
 * @abstract
 * @class Autolinker.match.Match
 * 
 * Represents a match found in an input string which should be Autolinked. A Match object is what is provided in a 
 * {@link Autolinker#replaceFn replaceFn}, and may be used to query for details about the match.
 * 
 * For example:
 * 
 *     var input = "...";  // string with URLs, Email Addresses, and Twitter Handles
 *     
 *     var linkedText = Autolinker.link( input, {
 *         replaceFn : function( autolinker, match ) {
 *             console.log( "href = ", match.getAnchorHref() );
 *             console.log( "text = ", match.getAnchorText() );
 *         
 *             switch( match.getType() ) {
 *                 case 'url' : 
 *                     console.log( "url: ", match.getUrl() );
 *                     
 *                 case 'email' :
 *                     console.log( "email: ", match.getEmail() );
 *                     
 *                 case 'twitter' :
 *                     console.log( "twitter: ", match.getTwitterHandle() );
 *             }
 *         }
 *     } );
 *     
 * See the {@link Autolinker} class for more details on using the {@link Autolinker#replaceFn replaceFn}.
 */
Autolinker.match.Match = Autolinker.Util.extend( Object, {
	
	/**
	 * @cfg {String} matchedText (required)
	 * 
	 * The original text that was matched.
	 */
	
	
	/**
	 * @constructor
	 * @param {Object} cfg The configuration properties for the Match instance, specified in an Object (map).
	 */
	constructor : function( cfg ) {
		Autolinker.Util.assign( this, cfg );
	},

	
	/**
	 * Returns a string name for the type of match that this class represents.
	 * 
	 * @abstract
	 * @return {String}
	 */
	getType : Autolinker.Util.abstractMethod,
	
	
	/**
	 * Returns the original text that was matched.
	 * 
	 * @return {String}
	 */
	getMatchedText : function() {
		return this.matchedText;
	},
	

	/**
	 * Returns the anchor href that should be generated for the match.
	 * 
	 * @abstract
	 * @return {String}
	 */
	getAnchorHref : Autolinker.Util.abstractMethod,
	
	
	/**
	 * Returns the anchor text that should be generated for the match.
	 * 
	 * @abstract
	 * @return {String}
	 */
	getAnchorText : Autolinker.Util.abstractMethod

} );
/*global Autolinker */
/**
 * @class Autolinker.match.Email
 * @extends Autolinker.match.Match
 * 
 * Represents a Email match found in an input string which should be Autolinked.
 * 
 * See this class's superclass ({@link Autolinker.match.Match}) for more details.
 */
Autolinker.match.Email = Autolinker.Util.extend( Autolinker.match.Match, {
	
	/**
	 * @cfg {String} email (required)
	 * 
	 * The email address that was matched.
	 */
	

	/**
	 * Returns a string name for the type of match that this class represents.
	 * 
	 * @return {String}
	 */
	getType : function() {
		return 'email';
	},
	
	
	/**
	 * Returns the email address that was matched.
	 * 
	 * @return {String}
	 */
	getEmail : function() {
		return this.email;
	},
	

	/**
	 * Returns the anchor href that should be generated for the match.
	 * 
	 * @return {String}
	 */
	getAnchorHref : function() {
		return 'mailto:' + this.email;
	},
	
	
	/**
	 * Returns the anchor text that should be generated for the match.
	 * 
	 * @return {String}
	 */
	getAnchorText : function() {
		return this.email;
	}
	
} );
/*global Autolinker */
/**
 * @class Autolinker.match.Twitter
 * @extends Autolinker.match.Match
 * 
 * Represents a Twitter match found in an input string which should be Autolinked.
 * 
 * See this class's superclass ({@link Autolinker.match.Match}) for more details.
 */
Autolinker.match.Twitter = Autolinker.Util.extend( Autolinker.match.Match, {
	
	/**
	 * @cfg {String} twitterHandle (required)
	 * 
	 * The Twitter handle that was matched.
	 */
	

	/**
	 * Returns the type of match that this class represents.
	 * 
	 * @return {String}
	 */
	getType : function() {
		return 'twitter';
	},
	
	
	/**
	 * Returns a string name for the type of match that this class represents.
	 * 
	 * @return {String}
	 */
	getTwitterHandle : function() {
		return this.twitterHandle;
	},
	

	/**
	 * Returns the anchor href that should be generated for the match.
	 * 
	 * @return {String}
	 */
	getAnchorHref : function() {
		return 'https://twitter.com/' + this.twitterHandle;
	},
	
	
	/**
	 * Returns the anchor text that should be generated for the match.
	 * 
	 * @return {String}
	 */
	getAnchorText : function() {
		return '@' + this.twitterHandle;
	}
	
} );
/*global Autolinker */
/**
 * @class Autolinker.match.Url
 * @extends Autolinker.match.Match
 * 
 * Represents a Url match found in an input string which should be Autolinked.
 * 
 * See this class's superclass ({@link Autolinker.match.Match}) for more details.
 */
Autolinker.match.Url = Autolinker.Util.extend( Autolinker.match.Match, {
	
	/**
	 * @cfg {String} url (required)
	 * 
	 * The url that was matched.
	 */
	
	/**
	 * @cfg {Boolean} protocolUrlMatch (required)
	 * 
	 * `true` if the URL is a match which already has a protocol (i.e. 'http://'), `false` if the match was from a 'www' or
	 * known TLD match.
	 */
	
	/**
	 * @cfg {Boolean} protocolRelativeMatch (required)
	 * 
	 * `true` if the URL is a protocol-relative match. A protocol-relative match is a URL that starts with '//',
	 * and will be either http:// or https:// based on the protocol that the site is loaded under.
	 */
	
	/**
	 * @cfg {Boolean} stripPrefix (required)
	 * @inheritdoc Autolinker#stripPrefix
	 */
	

	/**
	 * @private
	 * @property {RegExp} urlPrefixRegex
	 * 
	 * A regular expression used to remove the 'http://' or 'https://' and/or the 'www.' from URLs.
	 */
	urlPrefixRegex: /^(https?:\/\/)?(www\.)?/i,
	
	/**
	 * @private
	 * @property {RegExp} protocolRelativeRegex
	 * 
	 * The regular expression used to remove the protocol-relative '//' from the {@link #url} string, for purposes
	 * of {@link #getAnchorText}. A protocol-relative URL is, for example, "//yahoo.com"
	 */
	protocolRelativeRegex : /^\/\//,
	
	/**
	 * @private
	 * @property {Boolean} protocolPrepended
	 * 
	 * Will be set to `true` if the 'http://' protocol has been prepended to the {@link #url} (because the
	 * {@link #url} did not have a protocol)
	 */
	protocolPrepended : false,
	

	/**
	 * Returns a string name for the type of match that this class represents.
	 * 
	 * @return {String}
	 */
	getType : function() {
		return 'url';
	},
	
	
	/**
	 * Returns the url that was matched, assuming the protocol to be 'http://' if the original
	 * match was missing a protocol.
	 * 
	 * @return {String}
	 */
	getUrl : function() {
		var url = this.url;
		
		// if the url string doesn't begin with a protocol, assume 'http://'
		if( !this.protocolRelativeMatch && !this.protocolUrlMatch && !this.protocolPrepended ) {
			url = this.url = 'http://' + url;
			
			this.protocolPrepended = true;
		}
		
		return url;
	},
	

	/**
	 * Returns the anchor href that should be generated for the match.
	 * 
	 * @return {String}
	 */
	getAnchorHref : function() {
		var url = this.getUrl();
		
		return url.replace( /&amp;/g, '&' );  // any &amp;'s in the URL should be converted back to '&' if they were displayed as &amp; in the source html 
	},
	
	
	/**
	 * Returns the anchor text that should be generated for the match.
	 * 
	 * @return {String}
	 */
	getAnchorText : function() {
		var anchorText = this.getUrl();
		
		if( this.protocolRelativeMatch ) {
			// Strip off any protocol-relative '//' from the anchor text
			anchorText = this.stripProtocolRelativePrefix( anchorText );
		}
		if( this.stripPrefix ) {
			anchorText = this.stripUrlPrefix( anchorText );
		}
		anchorText = this.removeTrailingSlash( anchorText );  // remove trailing slash, if there is one
		
		return anchorText;
	},
	
	
	// ---------------------------------------
	
	// Utility Functionality
	
	/**
	 * Strips the URL prefix (such as "http://" or "https://") from the given text.
	 * 
	 * @private
	 * @param {String} text The text of the anchor that is being generated, for which to strip off the
	 *   url prefix (such as stripping off "http://")
	 * @return {String} The `anchorText`, with the prefix stripped.
	 */
	stripUrlPrefix : function( text ) {
		return text.replace( this.urlPrefixRegex, '' );
	},
	
	
	/**
	 * Strips any protocol-relative '//' from the anchor text.
	 * 
	 * @private
	 * @param {String} text The text of the anchor that is being generated, for which to strip off the
	 *   protocol-relative prefix (such as stripping off "//")
	 * @return {String} The `anchorText`, with the protocol-relative prefix stripped.
	 */
	stripProtocolRelativePrefix : function( text ) {
		return text.replace( this.protocolRelativeRegex, '' );
	},
	
	
	/**
	 * Removes any trailing slash from the given `anchorText`, in preparation for the text to be displayed.
	 * 
	 * @private
	 * @param {String} anchorText The text of the anchor that is being generated, for which to remove any trailing
	 *   slash ('/') that may exist.
	 * @return {String} The `anchorText`, with the trailing slash removed.
	 */
	removeTrailingSlash : function( anchorText ) {
		if( anchorText.charAt( anchorText.length - 1 ) === '/' ) {
			anchorText = anchorText.slice( 0, -1 );
		}
		return anchorText;
	}
	
} );
return Autolinker;

}));

},{}],772:[function(require,module,exports){
//     Backbone.js 1.1.0

//     (c) 2010-2011 Jeremy Ashkenas, DocumentCloud Inc.
//     (c) 2011-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

(function(){

  // Initial Setup
  // -------------

  // Save a reference to the global object (`window` in the browser, `exports`
  // on the server).
  var root = this;

  // Save the previous value of the `Backbone` variable, so that it can be
  // restored later on, if `noConflict` is used.
  var previousBackbone = root.Backbone;

  // Create local references to array methods we'll want to use later.
  var array = [];
  var push = array.push;
  var slice = array.slice;
  var splice = array.splice;

  // The top-level namespace. All public Backbone classes and modules will
  // be attached to this. Exported for both the browser and the server.
  var Backbone;
  if (typeof exports !== 'undefined') {
    Backbone = exports;
  } else {
    Backbone = root.Backbone = {};
  }

  // Current version of the library. Keep in sync with `package.json`.
  Backbone.VERSION = '1.1.0';

  // Require Underscore, if we're on the server, and it's not already present.
  var _ = root._;
  if (!_ && (typeof require !== 'undefined')) _ = require('underscore');

  // For Backbone's purposes, jQuery, Zepto, Ender, or My Library (kidding) owns
  // the `$` variable.
  Backbone.$ = root.jQuery || root.Zepto || root.ender || root.$;

  // Runs Backbone.js in *noConflict* mode, returning the `Backbone` variable
  // to its previous owner. Returns a reference to this Backbone object.
  Backbone.noConflict = function() {
    root.Backbone = previousBackbone;
    return this;
  };

  // Turn on `emulateHTTP` to support legacy HTTP servers. Setting this option
  // will fake `"PATCH"`, `"PUT"` and `"DELETE"` requests via the `_method` parameter and
  // set a `X-Http-Method-Override` header.
  Backbone.emulateHTTP = false;

  // Turn on `emulateJSON` to support legacy servers that can't deal with direct
  // `application/json` requests ... will encode the body as
  // `application/x-www-form-urlencoded` instead and will send the model in a
  // form param named `model`.
  Backbone.emulateJSON = false;

  // Backbone.Events
  // ---------------

  // A module that can be mixed in to *any object* in order to provide it with
  // custom events. You may bind with `on` or remove with `off` callback
  // functions to an event; `trigger`-ing an event fires all callbacks in
  // succession.
  //
  //     var object = {};
  //     _.extend(object, Backbone.Events);
  //     object.on('expand', function(){ alert('expanded'); });
  //     object.trigger('expand');
  //
  var Events = Backbone.Events = {

    // Bind an event to a `callback` function. Passing `"all"` will bind
    // the callback to all events fired.
    on: function(name, callback, context) {
      if (!eventsApi(this, 'on', name, [callback, context]) || !callback) return this;
      this._events || (this._events = {});
      var events = this._events[name] || (this._events[name] = []);
      events.push({callback: callback, context: context, ctx: context || this});
      return this;
    },

    // Bind an event to only be triggered a single time. After the first time
    // the callback is invoked, it will be removed.
    once: function(name, callback, context) {
      if (!eventsApi(this, 'once', name, [callback, context]) || !callback) return this;
      var self = this;
      var once = _.once(function() {
        self.off(name, once);
        callback.apply(this, arguments);
      });
      once._callback = callback;
      return this.on(name, once, context);
    },

    // Remove one or many callbacks. If `context` is null, removes all
    // callbacks with that function. If `callback` is null, removes all
    // callbacks for the event. If `name` is null, removes all bound
    // callbacks for all events.
    off: function(name, callback, context) {
      var retain, ev, events, names, i, l, j, k;
      if (!this._events || !eventsApi(this, 'off', name, [callback, context])) return this;
      if (!name && !callback && !context) {
        this._events = {};
        return this;
      }
      names = name ? [name] : _.keys(this._events);
      for (i = 0, l = names.length; i < l; i++) {
        name = names[i];
        if (events = this._events[name]) {
          this._events[name] = retain = [];
          if (callback || context) {
            for (j = 0, k = events.length; j < k; j++) {
              ev = events[j];
              if ((callback && callback !== ev.callback && callback !== ev.callback._callback) ||
                  (context && context !== ev.context)) {
                retain.push(ev);
              }
            }
          }
          if (!retain.length) delete this._events[name];
        }
      }

      return this;
    },

    // Trigger one or many events, firing all bound callbacks. Callbacks are
    // passed the same arguments as `trigger` is, apart from the event name
    // (unless you're listening on `"all"`, which will cause your callback to
    // receive the true name of the event as the first argument).
    trigger: function(name) {
      if (!this._events) return this;
      var args = slice.call(arguments, 1);
      if (!eventsApi(this, 'trigger', name, args)) return this;
      var events = this._events[name];
      var allEvents = this._events.all;
      if (events) triggerEvents(events, args);
      if (allEvents) triggerEvents(allEvents, arguments);
      return this;
    },

    // Tell this object to stop listening to either specific events ... or
    // to every object it's currently listening to.
    stopListening: function(obj, name, callback) {
      var listeningTo = this._listeningTo;
      if (!listeningTo) return this;
      var remove = !name && !callback;
      if (!callback && typeof name === 'object') callback = this;
      if (obj) (listeningTo = {})[obj._listenId] = obj;
      for (var id in listeningTo) {
        obj = listeningTo[id];
        obj.off(name, callback, this);
        if (remove || _.isEmpty(obj._events)) delete this._listeningTo[id];
      }
      return this;
    }

  };

  // Regular expression used to split event strings.
  var eventSplitter = /\s+/;

  // Implement fancy features of the Events API such as multiple event
  // names `"change blur"` and jQuery-style event maps `{change: action}`
  // in terms of the existing API.
  var eventsApi = function(obj, action, name, rest) {
    if (!name) return true;

    // Handle event maps.
    if (typeof name === 'object') {
      for (var key in name) {
        obj[action].apply(obj, [key, name[key]].concat(rest));
      }
      return false;
    }

    // Handle space separated event names.
    if (eventSplitter.test(name)) {
      var names = name.split(eventSplitter);
      for (var i = 0, l = names.length; i < l; i++) {
        obj[action].apply(obj, [names[i]].concat(rest));
      }
      return false;
    }

    return true;
  };

  // A difficult-to-believe, but optimized internal dispatch function for
  // triggering events. Tries to keep the usual cases speedy (most internal
  // Backbone events have 3 arguments).
  var triggerEvents = function(events, args) {
    var ev, i = -1, l = events.length, a1 = args[0], a2 = args[1], a3 = args[2];
    switch (args.length) {
      case 0: while (++i < l) (ev = events[i]).callback.call(ev.ctx); return;
      case 1: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1); return;
      case 2: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1, a2); return;
      case 3: while (++i < l) (ev = events[i]).callback.call(ev.ctx, a1, a2, a3); return;
      default: while (++i < l) (ev = events[i]).callback.apply(ev.ctx, args);
    }
  };

  var listenMethods = {listenTo: 'on', listenToOnce: 'once'};

  // Inversion-of-control versions of `on` and `once`. Tell *this* object to
  // listen to an event in another object ... keeping track of what it's
  // listening to.
  _.each(listenMethods, function(implementation, method) {
    Events[method] = function(obj, name, callback) {
      var listeningTo = this._listeningTo || (this._listeningTo = {});
      var id = obj._listenId || (obj._listenId = _.uniqueId('l'));
      listeningTo[id] = obj;
      if (!callback && typeof name === 'object') callback = this;
      obj[implementation](name, callback, this);
      return this;
    };
  });

  // Aliases for backwards compatibility.
  Events.bind   = Events.on;
  Events.unbind = Events.off;

  // Allow the `Backbone` object to serve as a global event bus, for folks who
  // want global "pubsub" in a convenient place.
  _.extend(Backbone, Events);

  // Backbone.Model
  // --------------

  // Backbone **Models** are the basic data object in the framework --
  // frequently representing a row in a table in a database on your server.
  // A discrete chunk of data and a bunch of useful, related methods for
  // performing computations and transformations on that data.

  // Create a new model with the specified attributes. A client id (`cid`)
  // is automatically generated and assigned for you.
  var Model = Backbone.Model = function(attributes, options) {
    var attrs = attributes || {};
    options || (options = {});
    this.cid = _.uniqueId('c');
    this.attributes = {};
    if (options.collection) this.collection = options.collection;
    if (options.parse) attrs = this.parse(attrs, options) || {};
    attrs = _.defaults({}, attrs, _.result(this, 'defaults'));
    this.set(attrs, options);
    this.changed = {};
    this.initialize.apply(this, arguments);
  };

  // Attach all inheritable methods to the Model prototype.
  _.extend(Model.prototype, Events, {

    // A hash of attributes whose current and previous value differ.
    changed: null,

    // The value returned during the last failed validation.
    validationError: null,

    // The default name for the JSON `id` attribute is `"id"`. MongoDB and
    // CouchDB users may want to set this to `"_id"`.
    idAttribute: 'id',

    // Initialize is an empty function by default. Override it with your own
    // initialization logic.
    initialize: function(){},

    // Return a copy of the model's `attributes` object.
    toJSON: function(options) {
      return _.clone(this.attributes);
    },

    // Proxy `Backbone.sync` by default -- but override this if you need
    // custom syncing semantics for *this* particular model.
    sync: function() {
      return Backbone.sync.apply(this, arguments);
    },

    // Get the value of an attribute.
    get: function(attr) {
      return this.attributes[attr];
    },

    // Get the HTML-escaped value of an attribute.
    escape: function(attr) {
      return _.escape(this.get(attr));
    },

    // Returns `true` if the attribute contains a value that is not null
    // or undefined.
    has: function(attr) {
      return this.get(attr) != null;
    },

    // Set a hash of model attributes on the object, firing `"change"`. This is
    // the core primitive operation of a model, updating the data and notifying
    // anyone who needs to know about the change in state. The heart of the beast.
    set: function(key, val, options) {
      var attr, attrs, unset, changes, silent, changing, prev, current;
      if (key == null) return this;

      // Handle both `"key", value` and `{key: value}` -style arguments.
      if (typeof key === 'object') {
        attrs = key;
        options = val;
      } else {
        (attrs = {})[key] = val;
      }

      options || (options = {});

      // Run validation.
      if (!this._validate(attrs, options)) return false;

      // Extract attributes and options.
      unset           = options.unset;
      silent          = options.silent;
      changes         = [];
      changing        = this._changing;
      this._changing  = true;

      if (!changing) {
        this._previousAttributes = _.clone(this.attributes);
        this.changed = {};
      }
      current = this.attributes, prev = this._previousAttributes;

      // Check for changes of `id`.
      if (this.idAttribute in attrs) this.id = attrs[this.idAttribute];

      // For each `set` attribute, update or delete the current value.
      for (attr in attrs) {
        val = attrs[attr];
        if (!_.isEqual(current[attr], val)) changes.push(attr);
        if (!_.isEqual(prev[attr], val)) {
          this.changed[attr] = val;
        } else {
          delete this.changed[attr];
        }
        unset ? delete current[attr] : current[attr] = val;
      }

      // Trigger all relevant attribute changes.
      if (!silent) {
        if (changes.length) this._pending = true;
        for (var i = 0, l = changes.length; i < l; i++) {
          this.trigger('change:' + changes[i], this, current[changes[i]], options);
        }
      }

      // You might be wondering why there's a `while` loop here. Changes can
      // be recursively nested within `"change"` events.
      if (changing) return this;
      if (!silent) {
        while (this._pending) {
          this._pending = false;
          this.trigger('change', this, options);
        }
      }
      this._pending = false;
      this._changing = false;
      return this;
    },

    // Remove an attribute from the model, firing `"change"`. `unset` is a noop
    // if the attribute doesn't exist.
    unset: function(attr, options) {
      return this.set(attr, void 0, _.extend({}, options, {unset: true}));
    },

    // Clear all attributes on the model, firing `"change"`.
    clear: function(options) {
      var attrs = {};
      for (var key in this.attributes) attrs[key] = void 0;
      return this.set(attrs, _.extend({}, options, {unset: true}));
    },

    // Determine if the model has changed since the last `"change"` event.
    // If you specify an attribute name, determine if that attribute has changed.
    hasChanged: function(attr) {
      if (attr == null) return !_.isEmpty(this.changed);
      return _.has(this.changed, attr);
    },

    // Return an object containing all the attributes that have changed, or
    // false if there are no changed attributes. Useful for determining what
    // parts of a view need to be updated and/or what attributes need to be
    // persisted to the server. Unset attributes will be set to undefined.
    // You can also pass an attributes object to diff against the model,
    // determining if there *would be* a change.
    changedAttributes: function(diff) {
      if (!diff) return this.hasChanged() ? _.clone(this.changed) : false;
      var val, changed = false;
      var old = this._changing ? this._previousAttributes : this.attributes;
      for (var attr in diff) {
        if (_.isEqual(old[attr], (val = diff[attr]))) continue;
        (changed || (changed = {}))[attr] = val;
      }
      return changed;
    },

    // Get the previous value of an attribute, recorded at the time the last
    // `"change"` event was fired.
    previous: function(attr) {
      if (attr == null || !this._previousAttributes) return null;
      return this._previousAttributes[attr];
    },

    // Get all of the attributes of the model at the time of the previous
    // `"change"` event.
    previousAttributes: function() {
      return _.clone(this._previousAttributes);
    },

    // Fetch the model from the server. If the server's representation of the
    // model differs from its current attributes, they will be overridden,
    // triggering a `"change"` event.
    fetch: function(options) {
      options = options ? _.clone(options) : {};
      if (options.parse === void 0) options.parse = true;
      var model = this;
      var success = options.success;
      options.success = function(resp) {
        if (!model.set(model.parse(resp, options), options)) return false;
        if (success) success(model, resp, options);
        model.trigger('sync', model, resp, options);
      };
      wrapError(this, options);
      return this.sync('read', this, options);
    },

    // Set a hash of model attributes, and sync the model to the server.
    // If the server returns an attributes hash that differs, the model's
    // state will be `set` again.
    save: function(key, val, options) {
      var attrs, method, xhr, attributes = this.attributes;

      // Handle both `"key", value` and `{key: value}` -style arguments.
      if (key == null || typeof key === 'object') {
        attrs = key;
        options = val;
      } else {
        (attrs = {})[key] = val;
      }

      options = _.extend({validate: true}, options);

      // If we're not waiting and attributes exist, save acts as
      // `set(attr).save(null, opts)` with validation. Otherwise, check if
      // the model will be valid when the attributes, if any, are set.
      if (attrs && !options.wait) {
        if (!this.set(attrs, options)) return false;
      } else {
        if (!this._validate(attrs, options)) return false;
      }

      // Set temporary attributes if `{wait: true}`.
      if (attrs && options.wait) {
        this.attributes = _.extend({}, attributes, attrs);
      }

      // After a successful server-side save, the client is (optionally)
      // updated with the server-side state.
      if (options.parse === void 0) options.parse = true;
      var model = this;
      var success = options.success;
      options.success = function(resp) {
        // Ensure attributes are restored during synchronous saves.
        model.attributes = attributes;
        var serverAttrs = model.parse(resp, options);
        if (options.wait) serverAttrs = _.extend(attrs || {}, serverAttrs);
        if (_.isObject(serverAttrs) && !model.set(serverAttrs, options)) {
          return false;
        }
        if (success) success(model, resp, options);
        model.trigger('sync', model, resp, options);
      };
      wrapError(this, options);

      method = this.isNew() ? 'create' : (options.patch ? 'patch' : 'update');
      if (method === 'patch') options.attrs = attrs;
      xhr = this.sync(method, this, options);

      // Restore attributes.
      if (attrs && options.wait) this.attributes = attributes;

      return xhr;
    },

    // Destroy this model on the server if it was already persisted.
    // Optimistically removes the model from its collection, if it has one.
    // If `wait: true` is passed, waits for the server to respond before removal.
    destroy: function(options) {
      options = options ? _.clone(options) : {};
      var model = this;
      var success = options.success;

      var destroy = function() {
        model.trigger('destroy', model, model.collection, options);
      };

      options.success = function(resp) {
        if (options.wait || model.isNew()) destroy();
        if (success) success(model, resp, options);
        if (!model.isNew()) model.trigger('sync', model, resp, options);
      };

      if (this.isNew()) {
        options.success();
        return false;
      }
      wrapError(this, options);

      var xhr = this.sync('delete', this, options);
      if (!options.wait) destroy();
      return xhr;
    },

    // Default URL for the model's representation on the server -- if you're
    // using Backbone's restful methods, override this to change the endpoint
    // that will be called.
    url: function() {
      var base = _.result(this, 'urlRoot') || _.result(this.collection, 'url') || urlError();
      if (this.isNew()) return base;
      return base + (base.charAt(base.length - 1) === '/' ? '' : '/') + encodeURIComponent(this.id);
    },

    // **parse** converts a response into the hash of attributes to be `set` on
    // the model. The default implementation is just to pass the response along.
    parse: function(resp, options) {
      return resp;
    },

    // Create a new model with identical attributes to this one.
    clone: function() {
      return new this.constructor(this.attributes);
    },

    // A model is new if it has never been saved to the server, and lacks an id.
    isNew: function() {
      return this.id == null;
    },

    // Check if the model is currently in a valid state.
    isValid: function(options) {
      return this._validate({}, _.extend(options || {}, { validate: true }));
    },

    // Run validation against the next complete set of model attributes,
    // returning `true` if all is well. Otherwise, fire an `"invalid"` event.
    _validate: function(attrs, options) {
      if (!options.validate || !this.validate) return true;
      attrs = _.extend({}, this.attributes, attrs);
      var error = this.validationError = this.validate(attrs, options) || null;
      if (!error) return true;
      this.trigger('invalid', this, error, _.extend(options, {validationError: error}));
      return false;
    }

  });

  // Underscore methods that we want to implement on the Model.
  var modelMethods = ['keys', 'values', 'pairs', 'invert', 'pick', 'omit'];

  // Mix in each Underscore method as a proxy to `Model#attributes`.
  _.each(modelMethods, function(method) {
    Model.prototype[method] = function() {
      var args = slice.call(arguments);
      args.unshift(this.attributes);
      return _[method].apply(_, args);
    };
  });

  // Backbone.Collection
  // -------------------

  // If models tend to represent a single row of data, a Backbone Collection is
  // more analagous to a table full of data ... or a small slice or page of that
  // table, or a collection of rows that belong together for a particular reason
  // -- all of the messages in this particular folder, all of the documents
  // belonging to this particular author, and so on. Collections maintain
  // indexes of their models, both in order, and for lookup by `id`.

  // Create a new **Collection**, perhaps to contain a specific type of `model`.
  // If a `comparator` is specified, the Collection will maintain
  // its models in sort order, as they're added and removed.
  var Collection = Backbone.Collection = function(models, options) {
    options || (options = {});
    if (options.model) this.model = options.model;
    if (options.comparator !== void 0) this.comparator = options.comparator;
    this._reset();
    this.initialize.apply(this, arguments);
    if (models) this.reset(models, _.extend({silent: true}, options));
  };

  // Default options for `Collection#set`.
  var setOptions = {add: true, remove: true, merge: true};
  var addOptions = {add: true, remove: false};

  // Define the Collection's inheritable methods.
  _.extend(Collection.prototype, Events, {

    // The default model for a collection is just a **Backbone.Model**.
    // This should be overridden in most cases.
    model: Model,

    // Initialize is an empty function by default. Override it with your own
    // initialization logic.
    initialize: function(){},

    // The JSON representation of a Collection is an array of the
    // models' attributes.
    toJSON: function(options) {
      return this.map(function(model){ return model.toJSON(options); });
    },

    // Proxy `Backbone.sync` by default.
    sync: function() {
      return Backbone.sync.apply(this, arguments);
    },

    // Add a model, or list of models to the set.
    add: function(models, options) {
      return this.set(models, _.extend({merge: false}, options, addOptions));
    },

    // Remove a model, or a list of models from the set.
    remove: function(models, options) {
      var singular = !_.isArray(models);
      models = singular ? [models] : _.clone(models);
      options || (options = {});
      var i, l, index, model;
      for (i = 0, l = models.length; i < l; i++) {
        model = models[i] = this.get(models[i]);
        if (!model) continue;
        delete this._byId[model.id];
        delete this._byId[model.cid];
        index = this.indexOf(model);
        this.models.splice(index, 1);
        this.length--;
        if (!options.silent) {
          options.index = index;
          model.trigger('remove', model, this, options);
        }
        this._removeReference(model);
      }
      return singular ? models[0] : models;
    },

    // Update a collection by `set`-ing a new list of models, adding new ones,
    // removing models that are no longer present, and merging models that
    // already exist in the collection, as necessary. Similar to **Model#set**,
    // the core operation for updating the data contained by the collection.
    set: function(models, options) {
      options = _.defaults({}, options, setOptions);
      if (options.parse) models = this.parse(models, options);
      var singular = !_.isArray(models);
      models = singular ? (models ? [models] : []) : _.clone(models);
      var i, l, id, model, attrs, existing, sort;
      var at = options.at;
      var targetModel = this.model;
      var sortable = this.comparator && (at == null) && options.sort !== false;
      var sortAttr = _.isString(this.comparator) ? this.comparator : null;
      var toAdd = [], toRemove = [], modelMap = {};
      var add = options.add, merge = options.merge, remove = options.remove;
      var order = !sortable && add && remove ? [] : false;

      // Turn bare objects into model references, and prevent invalid models
      // from being added.
      for (i = 0, l = models.length; i < l; i++) {
        attrs = models[i];
        if (attrs instanceof Model) {
          id = model = attrs;
        } else {
          id = attrs[targetModel.prototype.idAttribute];
        }

        // If a duplicate is found, prevent it from being added and
        // optionally merge it into the existing model.
        if (existing = this.get(id)) {
          if (remove) modelMap[existing.cid] = true;
          if (merge) {
            attrs = attrs === model ? model.attributes : attrs;
            if (options.parse) attrs = existing.parse(attrs, options);
            existing.set(attrs, options);
            if (sortable && !sort && existing.hasChanged(sortAttr)) sort = true;
          }
          models[i] = existing;

        // If this is a new, valid model, push it to the `toAdd` list.
        } else if (add) {
          model = models[i] = this._prepareModel(attrs, options);
          if (!model) continue;
          toAdd.push(model);

          // Listen to added models' events, and index models for lookup by
          // `id` and by `cid`.
          model.on('all', this._onModelEvent, this);
          this._byId[model.cid] = model;
          if (model.id != null) this._byId[model.id] = model;
        }
        if (order) order.push(existing || model);
      }

      // Remove nonexistent models if appropriate.
      if (remove) {
        for (i = 0, l = this.length; i < l; ++i) {
          if (!modelMap[(model = this.models[i]).cid]) toRemove.push(model);
        }
        if (toRemove.length) this.remove(toRemove, options);
      }

      // See if sorting is needed, update `length` and splice in new models.
      if (toAdd.length || (order && order.length)) {
        if (sortable) sort = true;
        this.length += toAdd.length;
        if (at != null) {
          for (i = 0, l = toAdd.length; i < l; i++) {
            this.models.splice(at + i, 0, toAdd[i]);
          }
        } else {
          if (order) this.models.length = 0;
          var orderedModels = order || toAdd;
          for (i = 0, l = orderedModels.length; i < l; i++) {
            this.models.push(orderedModels[i]);
          }
        }
      }

      // Silently sort the collection if appropriate.
      if (sort) this.sort({silent: true});

      // Unless silenced, it's time to fire all appropriate add/sort events.
      if (!options.silent) {
        for (i = 0, l = toAdd.length; i < l; i++) {
          (model = toAdd[i]).trigger('add', model, this, options);
        }
        if (sort || (order && order.length)) this.trigger('sort', this, options);
      }
      
      // Return the added (or merged) model (or models).
      return singular ? models[0] : models;
    },

    // When you have more items than you want to add or remove individually,
    // you can reset the entire set with a new list of models, without firing
    // any granular `add` or `remove` events. Fires `reset` when finished.
    // Useful for bulk operations and optimizations.
    reset: function(models, options) {
      options || (options = {});
      for (var i = 0, l = this.models.length; i < l; i++) {
        this._removeReference(this.models[i]);
      }
      options.previousModels = this.models;
      this._reset();
      models = this.add(models, _.extend({silent: true}, options));
      if (!options.silent) this.trigger('reset', this, options);
      return models;
    },

    // Add a model to the end of the collection.
    push: function(model, options) {
      return this.add(model, _.extend({at: this.length}, options));
    },

    // Remove a model from the end of the collection.
    pop: function(options) {
      var model = this.at(this.length - 1);
      this.remove(model, options);
      return model;
    },

    // Add a model to the beginning of the collection.
    unshift: function(model, options) {
      return this.add(model, _.extend({at: 0}, options));
    },

    // Remove a model from the beginning of the collection.
    shift: function(options) {
      var model = this.at(0);
      this.remove(model, options);
      return model;
    },

    // Slice out a sub-array of models from the collection.
    slice: function() {
      return slice.apply(this.models, arguments);
    },

    // Get a model from the set by id.
    get: function(obj) {
      if (obj == null) return void 0;
      return this._byId[obj.id] || this._byId[obj.cid] || this._byId[obj];
    },

    // Get the model at the given index.
    at: function(index) {
      return this.models[index];
    },

    // Return models with matching attributes. Useful for simple cases of
    // `filter`.
    where: function(attrs, first) {
      if (_.isEmpty(attrs)) return first ? void 0 : [];
      return this[first ? 'find' : 'filter'](function(model) {
        for (var key in attrs) {
          if (attrs[key] !== model.get(key)) return false;
        }
        return true;
      });
    },

    // Return the first model with matching attributes. Useful for simple cases
    // of `find`.
    findWhere: function(attrs) {
      return this.where(attrs, true);
    },

    // Force the collection to re-sort itself. You don't need to call this under
    // normal circumstances, as the set will maintain sort order as each item
    // is added.
    sort: function(options) {
      if (!this.comparator) throw new Error('Cannot sort a set without a comparator');
      options || (options = {});

      // Run sort based on type of `comparator`.
      if (_.isString(this.comparator) || this.comparator.length === 1) {
        this.models = this.sortBy(this.comparator, this);
      } else {
        this.models.sort(_.bind(this.comparator, this));
      }

      if (!options.silent) this.trigger('sort', this, options);
      return this;
    },

    // Pluck an attribute from each model in the collection.
    pluck: function(attr) {
      return _.invoke(this.models, 'get', attr);
    },

    // Fetch the default set of models for this collection, resetting the
    // collection when they arrive. If `reset: true` is passed, the response
    // data will be passed through the `reset` method instead of `set`.
    fetch: function(options) {
      options = options ? _.clone(options) : {};
      if (options.parse === void 0) options.parse = true;
      var success = options.success;
      var collection = this;
      options.success = function(resp) {
        var method = options.reset ? 'reset' : 'set';
        collection[method](resp, options);
        if (success) success(collection, resp, options);
        collection.trigger('sync', collection, resp, options);
      };
      wrapError(this, options);
      return this.sync('read', this, options);
    },

    // Create a new instance of a model in this collection. Add the model to the
    // collection immediately, unless `wait: true` is passed, in which case we
    // wait for the server to agree.
    create: function(model, options) {
      options = options ? _.clone(options) : {};
      if (!(model = this._prepareModel(model, options))) return false;
      if (!options.wait) this.add(model, options);
      var collection = this;
      var success = options.success;
      options.success = function(model, resp, options) {
        if (options.wait) collection.add(model, options);
        if (success) success(model, resp, options);
      };
      model.save(null, options);
      return model;
    },

    // **parse** converts a response into a list of models to be added to the
    // collection. The default implementation is just to pass it through.
    parse: function(resp, options) {
      return resp;
    },

    // Create a new collection with an identical list of models as this one.
    clone: function() {
      return new this.constructor(this.models);
    },

    // Private method to reset all internal state. Called when the collection
    // is first initialized or reset.
    _reset: function() {
      this.length = 0;
      this.models = [];
      this._byId  = {};
    },

    // Prepare a hash of attributes (or other model) to be added to this
    // collection.
    _prepareModel: function(attrs, options) {
      if (attrs instanceof Model) {
        if (!attrs.collection) attrs.collection = this;
        return attrs;
      }
      options = options ? _.clone(options) : {};
      options.collection = this;
      var model = new this.model(attrs, options);
      if (!model.validationError) return model;
      this.trigger('invalid', this, model.validationError, options);
      return false;
    },

    // Internal method to sever a model's ties to a collection.
    _removeReference: function(model) {
      if (this === model.collection) delete model.collection;
      model.off('all', this._onModelEvent, this);
    },

    // Internal method called every time a model in the set fires an event.
    // Sets need to update their indexes when models change ids. All other
    // events simply proxy through. "add" and "remove" events that originate
    // in other collections are ignored.
    _onModelEvent: function(event, model, collection, options) {
      if ((event === 'add' || event === 'remove') && collection !== this) return;
      if (event === 'destroy') this.remove(model, options);
      if (model && event === 'change:' + model.idAttribute) {
        delete this._byId[model.previous(model.idAttribute)];
        if (model.id != null) this._byId[model.id] = model;
      }
      this.trigger.apply(this, arguments);
    }

  });

  // Underscore methods that we want to implement on the Collection.
  // 90% of the core usefulness of Backbone Collections is actually implemented
  // right here:
  var methods = ['forEach', 'each', 'map', 'collect', 'reduce', 'foldl',
    'inject', 'reduceRight', 'foldr', 'find', 'detect', 'filter', 'select',
    'reject', 'every', 'all', 'some', 'any', 'include', 'contains', 'invoke',
    'max', 'min', 'toArray', 'size', 'first', 'head', 'take', 'initial', 'rest',
    'tail', 'drop', 'last', 'without', 'difference', 'indexOf', 'shuffle',
    'lastIndexOf', 'isEmpty', 'chain'];

  // Mix in each Underscore method as a proxy to `Collection#models`.
  _.each(methods, function(method) {
    Collection.prototype[method] = function() {
      var args = slice.call(arguments);
      args.unshift(this.models);
      return _[method].apply(_, args);
    };
  });

  // Underscore methods that take a property name as an argument.
  var attributeMethods = ['groupBy', 'countBy', 'sortBy'];

  // Use attributes instead of properties.
  _.each(attributeMethods, function(method) {
    Collection.prototype[method] = function(value, context) {
      var iterator = _.isFunction(value) ? value : function(model) {
        return model.get(value);
      };
      return _[method](this.models, iterator, context);
    };
  });

  // Backbone.View
  // -------------

  // Backbone Views are almost more convention than they are actual code. A View
  // is simply a JavaScript object that represents a logical chunk of UI in the
  // DOM. This might be a single item, an entire list, a sidebar or panel, or
  // even the surrounding frame which wraps your whole app. Defining a chunk of
  // UI as a **View** allows you to define your DOM events declaratively, without
  // having to worry about render order ... and makes it easy for the view to
  // react to specific changes in the state of your models.

  // Creating a Backbone.View creates its initial element outside of the DOM,
  // if an existing element is not provided...
  var View = Backbone.View = function(options) {
    this.cid = _.uniqueId('view');
    options || (options = {});
    _.extend(this, _.pick(options, viewOptions));
    this._ensureElement();
    this.initialize.apply(this, arguments);
    this.delegateEvents();
  };

  // Cached regex to split keys for `delegate`.
  var delegateEventSplitter = /^(\S+)\s*(.*)$/;

  // List of view options to be merged as properties.
  var viewOptions = ['model', 'collection', 'el', 'id', 'attributes', 'className', 'tagName', 'events'];

  // Set up all inheritable **Backbone.View** properties and methods.
  _.extend(View.prototype, Events, {

    // The default `tagName` of a View's element is `"div"`.
    tagName: 'div',

    // jQuery delegate for element lookup, scoped to DOM elements within the
    // current view. This should be preferred to global lookups where possible.
    $: function(selector) {
      return this.$el.find(selector);
    },

    // Initialize is an empty function by default. Override it with your own
    // initialization logic.
    initialize: function(){},

    // **render** is the core function that your view should override, in order
    // to populate its element (`this.el`), with the appropriate HTML. The
    // convention is for **render** to always return `this`.
    render: function() {
      return this;
    },

    // Remove this view by taking the element out of the DOM, and removing any
    // applicable Backbone.Events listeners.
    remove: function() {
      this.$el.remove();
      this.stopListening();
      return this;
    },

    // Change the view's element (`this.el` property), including event
    // re-delegation.
    setElement: function(element, delegate) {
      if (this.$el) this.undelegateEvents();
      this.$el = element instanceof Backbone.$ ? element : Backbone.$(element);
      this.el = this.$el[0];
      if (delegate !== false) this.delegateEvents();
      return this;
    },

    // Set callbacks, where `this.events` is a hash of
    //
    // *{"event selector": "callback"}*
    //
    //     {
    //       'mousedown .title':  'edit',
    //       'click .button':     'save',
    //       'click .open':       function(e) { ... }
    //     }
    //
    // pairs. Callbacks will be bound to the view, with `this` set properly.
    // Uses event delegation for efficiency.
    // Omitting the selector binds the event to `this.el`.
    // This only works for delegate-able events: not `focus`, `blur`, and
    // not `change`, `submit`, and `reset` in Internet Explorer.
    delegateEvents: function(events) {
      if (!(events || (events = _.result(this, 'events')))) return this;
      this.undelegateEvents();
      for (var key in events) {
        var method = events[key];
        if (!_.isFunction(method)) method = this[events[key]];
        if (!method) continue;

        var match = key.match(delegateEventSplitter);
        var eventName = match[1], selector = match[2];
        method = _.bind(method, this);
        eventName += '.delegateEvents' + this.cid;
        if (selector === '') {
          this.$el.on(eventName, method);
        } else {
          this.$el.on(eventName, selector, method);
        }
      }
      return this;
    },

    // Clears all callbacks previously bound to the view with `delegateEvents`.
    // You usually don't need to use this, but may wish to if you have multiple
    // Backbone views attached to the same DOM element.
    undelegateEvents: function() {
      this.$el.off('.delegateEvents' + this.cid);
      return this;
    },

    // Ensure that the View has a DOM element to render into.
    // If `this.el` is a string, pass it through `$()`, take the first
    // matching element, and re-assign it to `el`. Otherwise, create
    // an element from the `id`, `className` and `tagName` properties.
    _ensureElement: function() {
      if (!this.el) {
        var attrs = _.extend({}, _.result(this, 'attributes'));
        if (this.id) attrs.id = _.result(this, 'id');
        if (this.className) attrs['class'] = _.result(this, 'className');
        var $el = Backbone.$('<' + _.result(this, 'tagName') + '>').attr(attrs);
        this.setElement($el, false);
      } else {
        this.setElement(_.result(this, 'el'), false);
      }
    }

  });

  // Backbone.sync
  // -------------

  // Override this function to change the manner in which Backbone persists
  // models to the server. You will be passed the type of request, and the
  // model in question. By default, makes a RESTful Ajax request
  // to the model's `url()`. Some possible customizations could be:
  //
  // * Use `setTimeout` to batch rapid-fire updates into a single request.
  // * Send up the models as XML instead of JSON.
  // * Persist models via WebSockets instead of Ajax.
  //
  // Turn on `Backbone.emulateHTTP` in order to send `PUT` and `DELETE` requests
  // as `POST`, with a `_method` parameter containing the true HTTP method,
  // as well as all requests with the body as `application/x-www-form-urlencoded`
  // instead of `application/json` with the model in a param named `model`.
  // Useful when interfacing with server-side languages like **PHP** that make
  // it difficult to read the body of `PUT` requests.
  Backbone.sync = function(method, model, options) {
    var type = methodMap[method];

    // Default options, unless specified.
    _.defaults(options || (options = {}), {
      emulateHTTP: Backbone.emulateHTTP,
      emulateJSON: Backbone.emulateJSON
    });

    // Default JSON-request options.
    var params = {type: type, dataType: 'json'};

    // Ensure that we have a URL.
    if (!options.url) {
      params.url = _.result(model, 'url') || urlError();
    }

    // Ensure that we have the appropriate request data.
    if (options.data == null && model && (method === 'create' || method === 'update' || method === 'patch')) {
      params.contentType = 'application/json';
      params.data = JSON.stringify(options.attrs || model.toJSON(options));
    }

    // For older servers, emulate JSON by encoding the request into an HTML-form.
    if (options.emulateJSON) {
      params.contentType = 'application/x-www-form-urlencoded';
      params.data = params.data ? {model: params.data} : {};
    }

    // For older servers, emulate HTTP by mimicking the HTTP method with `_method`
    // And an `X-HTTP-Method-Override` header.
    if (options.emulateHTTP && (type === 'PUT' || type === 'DELETE' || type === 'PATCH')) {
      params.type = 'POST';
      if (options.emulateJSON) params.data._method = type;
      var beforeSend = options.beforeSend;
      options.beforeSend = function(xhr) {
        xhr.setRequestHeader('X-HTTP-Method-Override', type);
        if (beforeSend) return beforeSend.apply(this, arguments);
      };
    }

    // Don't process data on a non-GET request.
    if (params.type !== 'GET' && !options.emulateJSON) {
      params.processData = false;
    }

    // If we're sending a `PATCH` request, and we're in an old Internet Explorer
    // that still has ActiveX enabled by default, override jQuery to use that
    // for XHR instead. Remove this line when jQuery supports `PATCH` on IE8.
    if (params.type === 'PATCH' && noXhrPatch) {
      params.xhr = function() {
        return new ActiveXObject("Microsoft.XMLHTTP");
      };
    }

    // Make the request, allowing the user to override any Ajax options.
    var xhr = options.xhr = Backbone.ajax(_.extend(params, options));
    model.trigger('request', model, xhr, options);
    return xhr;
  };

  var noXhrPatch = typeof window !== 'undefined' && !!window.ActiveXObject && !(window.XMLHttpRequest && (new XMLHttpRequest).dispatchEvent);

  // Map from CRUD to HTTP for our default `Backbone.sync` implementation.
  var methodMap = {
    'create': 'POST',
    'update': 'PUT',
    'patch':  'PATCH',
    'delete': 'DELETE',
    'read':   'GET'
  };

  // Set the default implementation of `Backbone.ajax` to proxy through to `$`.
  // Override this if you'd like to use a different library.
  Backbone.ajax = function() {
    return Backbone.$.ajax.apply(Backbone.$, arguments);
  };

  // Backbone.Router
  // ---------------

  // Routers map faux-URLs to actions, and fire events when routes are
  // matched. Creating a new one sets its `routes` hash, if not set statically.
  var Router = Backbone.Router = function(options) {
    options || (options = {});
    if (options.routes) this.routes = options.routes;
    this._bindRoutes();
    this.initialize.apply(this, arguments);
  };

  // Cached regular expressions for matching named param parts and splatted
  // parts of route strings.
  var optionalParam = /\((.*?)\)/g;
  var namedParam    = /(\(\?)?:\w+/g;
  var splatParam    = /\*\w+/g;
  var escapeRegExp  = /[\-{}\[\]+?.,\\\^$|#\s]/g;

  // Set up all inheritable **Backbone.Router** properties and methods.
  _.extend(Router.prototype, Events, {

    // Initialize is an empty function by default. Override it with your own
    // initialization logic.
    initialize: function(){},

    // Manually bind a single named route to a callback. For example:
    //
    //     this.route('search/:query/p:num', 'search', function(query, num) {
    //       ...
    //     });
    //
    route: function(route, name, callback) {
      if (!_.isRegExp(route)) route = this._routeToRegExp(route);
      if (_.isFunction(name)) {
        callback = name;
        name = '';
      }
      if (!callback) callback = this[name];
      var router = this;
      Backbone.history.route(route, function(fragment) {
        var args = router._extractParameters(route, fragment);
        callback && callback.apply(router, args);
        router.trigger.apply(router, ['route:' + name].concat(args));
        router.trigger('route', name, args);
        Backbone.history.trigger('route', router, name, args);
      });
      return this;
    },

    // Simple proxy to `Backbone.history` to save a fragment into the history.
    navigate: function(fragment, options) {
      Backbone.history.navigate(fragment, options);
      return this;
    },

    // Bind all defined routes to `Backbone.history`. We have to reverse the
    // order of the routes here to support behavior where the most general
    // routes can be defined at the bottom of the route map.
    _bindRoutes: function() {
      if (!this.routes) return;
      this.routes = _.result(this, 'routes');
      var route, routes = _.keys(this.routes);
      while ((route = routes.pop()) != null) {
        this.route(route, this.routes[route]);
      }
    },

    // Convert a route string into a regular expression, suitable for matching
    // against the current location hash.
    _routeToRegExp: function(route) {
      route = route.replace(escapeRegExp, '\\$&')
                   .replace(optionalParam, '(?:$1)?')
                   .replace(namedParam, function(match, optional) {
                     return optional ? match : '([^\/]+)';
                   })
                   .replace(splatParam, '(.*?)');
      return new RegExp('^' + route + '$');
    },

    // Given a route, and a URL fragment that it matches, return the array of
    // extracted decoded parameters. Empty or unmatched parameters will be
    // treated as `null` to normalize cross-browser behavior.
    _extractParameters: function(route, fragment) {
      var params = route.exec(fragment).slice(1);
      return _.map(params, function(param) {
        return param ? decodeURIComponent(param) : null;
      });
    }

  });

  // Backbone.History
  // ----------------

  // Handles cross-browser history management, based on either
  // [pushState](http://diveintohtml5.info/history.html) and real URLs, or
  // [onhashchange](https://developer.mozilla.org/en-US/docs/DOM/window.onhashchange)
  // and URL fragments. If the browser supports neither (old IE, natch),
  // falls back to polling.
  var History = Backbone.History = function() {
    this.handlers = [];
    _.bindAll(this, 'checkUrl');

    // Ensure that `History` can be used outside of the browser.
    if (typeof window !== 'undefined') {
      this.location = window.location;
      this.history = window.history;
    }
  };

  // Cached regex for stripping a leading hash/slash and trailing space.
  var routeStripper = /^[#\/]|\s+$/g;

  // Cached regex for stripping leading and trailing slashes.
  var rootStripper = /^\/+|\/+$/g;

  // Cached regex for detecting MSIE.
  var isExplorer = /msie [\w.]+/;

  // Cached regex for removing a trailing slash.
  var trailingSlash = /\/$/;

  // Cached regex for stripping urls of hash and query.
  var pathStripper = /[?#].*$/;

  // Has the history handling already been started?
  History.started = false;

  // Set up all inheritable **Backbone.History** properties and methods.
  _.extend(History.prototype, Events, {

    // The default interval to poll for hash changes, if necessary, is
    // twenty times a second.
    interval: 50,

    // Gets the true hash value. Cannot use location.hash directly due to bug
    // in Firefox where location.hash will always be decoded.
    getHash: function(window) {
      var match = (window || this).location.href.match(/#(.*)$/);
      return match ? match[1] : '';
    },

    // Get the cross-browser normalized URL fragment, either from the URL,
    // the hash, or the override.
    getFragment: function(fragment, forcePushState) {
      if (fragment == null) {
        if (this._hasPushState || !this._wantsHashChange || forcePushState) {
          fragment = this.location.pathname;
          var root = this.root.replace(trailingSlash, '');
          if (!fragment.indexOf(root)) fragment = fragment.slice(root.length);
        } else {
          fragment = this.getHash();
        }
      }
      return fragment.replace(routeStripper, '');
    },

    // Start the hash change handling, returning `true` if the current URL matches
    // an existing route, and `false` otherwise.
    start: function(options) {
      if (History.started) throw new Error("Backbone.history has already been started");
      History.started = true;

      // Figure out the initial configuration. Do we need an iframe?
      // Is pushState desired ... is it available?
      this.options          = _.extend({root: '/'}, this.options, options);
      this.root             = this.options.root;
      this._wantsHashChange = this.options.hashChange !== false;
      this._wantsPushState  = !!this.options.pushState;
      this._hasPushState    = !!(this.options.pushState && this.history && this.history.pushState);
      var fragment          = this.getFragment();
      var docMode           = document.documentMode;
      var oldIE             = (isExplorer.exec(navigator.userAgent.toLowerCase()) && (!docMode || docMode <= 7));

      // Normalize root to always include a leading and trailing slash.
      this.root = ('/' + this.root + '/').replace(rootStripper, '/');

      if (oldIE && this._wantsHashChange) {
        this.iframe = Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;
        this.navigate(fragment);
      }

      // Depending on whether we're using pushState or hashes, and whether
      // 'onhashchange' is supported, determine how we check the URL state.
      if (this._hasPushState) {
        Backbone.$(window).on('popstate', this.checkUrl);
      } else if (this._wantsHashChange && ('onhashchange' in window) && !oldIE) {
        Backbone.$(window).on('hashchange', this.checkUrl);
      } else if (this._wantsHashChange) {
        this._checkUrlInterval = setInterval(this.checkUrl, this.interval);
      }

      // Determine if we need to change the base url, for a pushState link
      // opened by a non-pushState browser.
      this.fragment = fragment;
      var loc = this.location;
      var atRoot = loc.pathname.replace(/[^\/]$/, '$&/') === this.root;

      // Transition from hashChange to pushState or vice versa if both are
      // requested.
      if (this._wantsHashChange && this._wantsPushState) {

        // If we've started off with a route from a `pushState`-enabled
        // browser, but we're currently in a browser that doesn't support it...
        if (!this._hasPushState && !atRoot) {
          this.fragment = this.getFragment(null, true);
          this.location.replace(this.root + this.location.search + '#' + this.fragment);
          // Return immediately as browser will do redirect to new url
          return true;

        // Or if we've started out with a hash-based route, but we're currently
        // in a browser where it could be `pushState`-based instead...
        } else if (this._hasPushState && atRoot && loc.hash) {
          this.fragment = this.getHash().replace(routeStripper, '');
          this.history.replaceState({}, document.title, this.root + this.fragment + loc.search);
        }

      }

      if (!this.options.silent) return this.loadUrl();
    },

    // Disable Backbone.history, perhaps temporarily. Not useful in a real app,
    // but possibly useful for unit testing Routers.
    stop: function() {
      Backbone.$(window).off('popstate', this.checkUrl).off('hashchange', this.checkUrl);
      clearInterval(this._checkUrlInterval);
      History.started = false;
    },

    // Add a route to be tested when the fragment changes. Routes added later
    // may override previous routes.
    route: function(route, callback) {
      this.handlers.unshift({route: route, callback: callback});
    },

    // Checks the current URL to see if it has changed, and if it has,
    // calls `loadUrl`, normalizing across the hidden iframe.
    checkUrl: function(e) {
      var current = this.getFragment();
      if (current === this.fragment && this.iframe) {
        current = this.getFragment(this.getHash(this.iframe));
      }
      if (current === this.fragment) return false;
      if (this.iframe) this.navigate(current);
      this.loadUrl();
    },

    // Attempt to load the current URL fragment. If a route succeeds with a
    // match, returns `true`. If no defined routes matches the fragment,
    // returns `false`.
    loadUrl: function(fragment) {
      fragment = this.fragment = this.getFragment(fragment);
      return _.any(this.handlers, function(handler) {
        if (handler.route.test(fragment)) {
          handler.callback(fragment);
          return true;
        }
      });
    },

    // Save a fragment into the hash history, or replace the URL state if the
    // 'replace' option is passed. You are responsible for properly URL-encoding
    // the fragment in advance.
    //
    // The options object can contain `trigger: true` if you wish to have the
    // route callback be fired (not usually desirable), or `replace: true`, if
    // you wish to modify the current URL without adding an entry to the history.
    navigate: function(fragment, options) {
      if (!History.started) return false;
      if (!options || options === true) options = {trigger: !!options};

      var url = this.root + (fragment = this.getFragment(fragment || ''));

      // Strip the fragment of the query and hash for matching.
      fragment = fragment.replace(pathStripper, '');

      if (this.fragment === fragment) return;
      this.fragment = fragment;

      // Don't include a trailing slash on the root.
      if (fragment === '' && url !== '/') url = url.slice(0, -1);

      // If pushState is available, we use it to set the fragment as a real URL.
      if (this._hasPushState) {
        this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);

      // If hash changes haven't been explicitly disabled, update the hash
      // fragment to store history.
      } else if (this._wantsHashChange) {
        this._updateHash(this.location, fragment, options.replace);
        if (this.iframe && (fragment !== this.getFragment(this.getHash(this.iframe)))) {
          // Opening and closing the iframe tricks IE7 and earlier to push a
          // history entry on hash-tag change.  When replace is true, we don't
          // want this.
          if(!options.replace) this.iframe.document.open().close();
          this._updateHash(this.iframe.location, fragment, options.replace);
        }

      // If you've told us that you explicitly don't want fallback hashchange-
      // based history, then `navigate` becomes a page refresh.
      } else {
        return this.location.assign(url);
      }
      if (options.trigger) return this.loadUrl(fragment);
    },

    // Update the hash location, either replacing the current entry, or adding
    // a new one to the browser history.
    _updateHash: function(location, fragment, replace) {
      if (replace) {
        var href = location.href.replace(/(javascript:|#).*$/, '');
        location.replace(href + '#' + fragment);
      } else {
        // Some browsers require that `hash` contains a leading #.
        location.hash = '#' + fragment;
      }
    }

  });

  // Create the default Backbone.history.
  Backbone.history = new History;

  // Helpers
  // -------

  // Helper function to correctly set up the prototype chain, for subclasses.
  // Similar to `goog.inherits`, but uses a hash of prototype properties and
  // class properties to be extended.
  var extend = function(protoProps, staticProps) {
    var parent = this;
    var child;

    // The constructor function for the new subclass is either defined by you
    // (the "constructor" property in your `extend` definition), or defaulted
    // by us to simply call the parent's constructor.
    if (protoProps && _.has(protoProps, 'constructor')) {
      child = protoProps.constructor;
    } else {
      child = function(){ return parent.apply(this, arguments); };
    }

    // Add static properties to the constructor function, if supplied.
    _.extend(child, parent, staticProps);

    // Set the prototype chain to inherit from `parent`, without calling
    // `parent`'s constructor function.
    var Surrogate = function(){ this.constructor = child; };
    Surrogate.prototype = parent.prototype;
    child.prototype = new Surrogate;

    // Add prototype properties (instance properties) to the subclass,
    // if supplied.
    if (protoProps) _.extend(child.prototype, protoProps);

    // Set a convenience property in case the parent's prototype is needed
    // later.
    child.__super__ = parent.prototype;

    return child;
  };

  // Set up inheritance for the model, collection, router, view and history.
  Model.extend = Collection.extend = Router.extend = View.extend = History.extend = extend;

  // Throw an error when a URL is needed, and none is supplied.
  var urlError = function() {
    throw new Error('A "url" property or function must be specified');
  };

  // Wrap an optional error callback with a fallback error event.
  var wrapError = function(model, options) {
    var error = options.error;
    options.error = function(resp) {
      if (error) error(model, resp, options);
      model.trigger('error', model, resp, options);
    };
  };

}).call(this);

},{"underscore":783}],773:[function(require,module,exports){
/*!
 * Chaplin 1.0.0
 *
 * Chaplin may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://chaplinjs.org
 */

(function(){

var loader = (function() {
  var modules = {};
  var cache = {};

  var dummy = function() {return function() {};};
  var initModule = function(name, definition) {
    var module = {id: name, exports: {}};
    definition(module.exports, dummy(), module);
    var exports = cache[name] = module.exports;
    return exports;
  };

  var loader = function(path) {
    if (cache.hasOwnProperty(path)) return cache[path];
    if (modules.hasOwnProperty(path)) return initModule(path, modules[path]);
    throw new Error('Cannot find module "' + path + '"');
  };

  loader.register = function(bundle, fn) {
    modules[bundle] = fn;
  };
  return loader;
})();

loader.register('chaplin/application', function(e, r, module) {
'use strict';

var Application, Backbone, Composer, Dispatcher, EventBroker, Layout, Router, mediator, _;

_ = loader('underscore');

Backbone = loader('backbone');

Dispatcher = loader('chaplin/dispatcher');

Layout = loader('chaplin/views/layout');

Composer = loader('chaplin/composer');

Router = loader('chaplin/lib/router');

EventBroker = loader('chaplin/lib/event_broker');

mediator = loader('chaplin/mediator');

module.exports = Application = (function() {

  Application.extend = Backbone.Model.extend;

  _.extend(Application.prototype, EventBroker);

  Application.prototype.title = '';

  Application.prototype.dispatcher = null;

  Application.prototype.layout = null;

  Application.prototype.router = null;

  Application.prototype.composer = null;

  Application.prototype.started = false;

  function Application(options) {
    if (options == null) {
      options = {};
    }
    this.initialize(options);
  }

  Application.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    if (this.started) {
      throw new Error('Application#initialize: App was already started');
    }
    this.initRouter(options.routes, options);
    this.initDispatcher(options);
    this.initLayout(options);
    this.initComposer(options);
    this.initMediator();
    return this.start();
  };

  Application.prototype.initDispatcher = function(options) {
    return this.dispatcher = new Dispatcher(options);
  };

  Application.prototype.initLayout = function(options) {
    var _ref;
    if (options == null) {
      options = {};
    }
    if ((_ref = options.title) == null) {
      options.title = this.title;
    }
    return this.layout = new Layout(options);
  };

  Application.prototype.initComposer = function(options) {
    if (options == null) {
      options = {};
    }
    return this.composer = new Composer(options);
  };

  Application.prototype.initMediator = function() {
    return mediator.seal();
  };

  Application.prototype.initRouter = function(routes, options) {
    this.router = new Router(options);
    return typeof routes === "function" ? routes(this.router.match) : void 0;
  };

  Application.prototype.start = function() {
    this.router.startHistory();
    this.started = true;
    return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
  };

  Application.prototype.disposed = false;

  Application.prototype.dispose = function() {
    var prop, properties, _i, _len;
    if (this.disposed) {
      return;
    }
    properties = ['dispatcher', 'layout', 'router', 'composer'];
    for (_i = 0, _len = properties.length; _i < _len; _i++) {
      prop = properties[_i];
      if (this[prop] != null) {
        this[prop].dispose();
      }
    }
    this.disposed = true;
    return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
  };

  return Application;

})();

});;loader.register('chaplin/mediator', function(e, r, module) {
'use strict';

var Backbone, handlers, mediator, support, utils, _,
  __slice = [].slice;

Backbone = loader('backbone');

_ = loader('underscore');

support = loader('chaplin/lib/support');

utils = loader('chaplin/lib/utils');

mediator = {};

mediator.subscribe = Backbone.Events.on;

mediator.unsubscribe = Backbone.Events.off;

mediator.publish = Backbone.Events.trigger;

mediator._callbacks = null;

handlers = mediator._handlers = {};

mediator.setHandler = function(name, method, instance) {
  return handlers[name] = {
    instance: instance,
    method: method
  };
};

mediator.execute = function() {
  var args, handler, name, nameOrObj, silent;
  nameOrObj = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
  silent = false;
  if (typeof nameOrObj === 'object') {
    silent = nameOrObj.silent;
    name = nameOrObj.name;
  } else {
    name = nameOrObj;
  }
  handler = handlers[name];
  if (handler) {
    return handler.method.apply(handler.instance, args);
  } else if (!silent) {
    throw new Error("mediator.execute: " + name + " handler is not defined");
  }
};

mediator.removeHandlers = function(instanceOrNames) {
  var handler, name, _i, _len;
  if (!instanceOrNames) {
    mediator._handlers = {};
  }
  if (utils.isArray(instanceOrNames)) {
    for (_i = 0, _len = instanceOrNames.length; _i < _len; _i++) {
      name = instanceOrNames[_i];
      delete handlers[name];
    }
  } else {
    for (name in handlers) {
      handler = handlers[name];
      if (handler.instance === instanceOrNames) {
        delete handlers[name];
      }
    }
  }
};

utils.readonly(mediator, 'subscribe', 'unsubscribe', 'publish', 'setHandler', 'execute', 'removeHandlers');

mediator.seal = function() {
  if (support.propertyDescriptors && Object.seal) {
    return Object.seal(mediator);
  }
};

utils.readonly(mediator, 'seal');

module.exports = mediator;

});;loader.register('chaplin/dispatcher', function(e, r, module) {
'use strict';

var Backbone, Dispatcher, EventBroker, mediator, utils, _;

_ = loader('underscore');

Backbone = loader('backbone');

mediator = loader('chaplin/mediator');

utils = loader('chaplin/lib/utils');

EventBroker = loader('chaplin/lib/event_broker');

module.exports = Dispatcher = (function() {

  Dispatcher.extend = Backbone.Model.extend;

  _.extend(Dispatcher.prototype, EventBroker);

  Dispatcher.prototype.previousRoute = null;

  Dispatcher.prototype.currentController = null;

  Dispatcher.prototype.currentRoute = null;

  Dispatcher.prototype.currentParams = null;

  Dispatcher.prototype.currentQuery = null;

  function Dispatcher() {
    this.initialize.apply(this, arguments);
  }

  Dispatcher.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    this.settings = _.defaults(options, {
      controllerPath: 'controllers/',
      controllerSuffix: '_controller'
    });
    return this.subscribeEvent('router:match', this.dispatch);
  };

  Dispatcher.prototype.dispatch = function(route, params, options) {
    var _ref, _ref1,
      _this = this;
    params = params ? _.extend({}, params) : {};
    options = options ? _.extend({}, options) : {};
    if (!(options.query != null)) {
      options.query = {};
    }
    if (options.forceStartup !== true) {
      options.forceStartup = false;
    }
    if (!options.forceStartup && ((_ref = this.currentRoute) != null ? _ref.controller : void 0) === route.controller && ((_ref1 = this.currentRoute) != null ? _ref1.action : void 0) === route.action && _.isEqual(this.currentParams, params) && _.isEqual(this.currentQuery, options.query)) {
      return;
    }
    return this.loadController(route.controller, function(Controller) {
      return _this.controllerLoaded(route, params, options, Controller);
    });
  };

  Dispatcher.prototype.loadController = function(name, handler) {
    var fileName, moduleName,
      _this = this;
    fileName = name + this.settings.controllerSuffix;
    moduleName = this.settings.controllerPath + fileName;
    if (typeof define !== "undefined" && define !== null ? define.amd : void 0) {
      return require([moduleName], handler);
    } else {
      return setTimeout(function() {
        return handler(require(moduleName));
      }, 0);
    }
  };

  Dispatcher.prototype.controllerLoaded = function(route, params, options, Controller) {
    var controller, prev, previous;
    if (this.nextPreviousRoute = this.currentRoute) {
      previous = _.extend({}, this.nextPreviousRoute);
      if (this.currentParams != null) {
        previous.params = this.currentParams;
      }
      if (previous.previous) {
        delete previous.previous;
      }
      prev = {
        previous: previous
      };
    }
    this.nextCurrentRoute = _.extend({}, route, prev);
    controller = new Controller(params, this.nextCurrentRoute, options);
    return this.executeBeforeAction(controller, this.nextCurrentRoute, params, options);
  };

  Dispatcher.prototype.executeAction = function(controller, route, params, options) {
    if (this.currentController) {
      this.publishEvent('beforeControllerDispose', this.currentController);
      this.currentController.dispose(params, route, options);
    }
    this.currentController = controller;
    this.currentParams = params;
    this.currentQuery = options.query;
    controller[route.action](params, route, options);
    if (controller.redirected) {
      return;
    }
    return this.publishEvent('dispatcher:dispatch', this.currentController, params, route, options);
  };

  Dispatcher.prototype.executeBeforeAction = function(controller, route, params, options) {
    var before, executeAction, promise,
      _this = this;
    before = controller.beforeAction;
    executeAction = function() {
      if (controller.redirected || _this.currentRoute && route === _this.currentRoute) {
        _this.nextPreviousRoute = _this.nextCurrentRoute = null;
        controller.dispose();
        return;
      }
      _this.previousRoute = _this.nextPreviousRoute;
      _this.currentRoute = _this.nextCurrentRoute;
      _this.nextPreviousRoute = _this.nextCurrentRoute = null;
      return _this.executeAction(controller, route, params, options);
    };
    if (!before) {
      executeAction();
      return;
    }
    if (typeof before !== 'function') {
      throw new TypeError('Controller#beforeAction: function expected. ' + 'Old object-like form is not supported.');
    }
    promise = controller.beforeAction(params, route, options);
    if (promise && promise.then) {
      return promise.then(executeAction);
    } else {
      return executeAction();
    }
  };

  Dispatcher.prototype.disposed = false;

  Dispatcher.prototype.dispose = function() {
    if (this.disposed) {
      return;
    }
    this.unsubscribeAllEvents();
    this.disposed = true;
    return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
  };

  return Dispatcher;

})();

});;loader.register('chaplin/composer', function(e, r, module) {
'use strict';

var Backbone, Composer, Composition, EventBroker, mediator, utils, _;

_ = loader('underscore');

Backbone = loader('backbone');

mediator = loader('chaplin/mediator');

utils = loader('chaplin/lib/utils');

Composition = loader('chaplin/lib/composition');

EventBroker = loader('chaplin/lib/event_broker');

module.exports = Composer = (function() {

  Composer.extend = Backbone.Model.extend;

  _.extend(Composer.prototype, EventBroker);

  Composer.prototype.compositions = null;

  function Composer() {
    this.initialize.apply(this, arguments);
  }

  Composer.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    this.compositions = {};
    mediator.setHandler('composer:compose', this.compose, this);
    mediator.setHandler('composer:retrieve', this.retrieve, this);
    return this.subscribeEvent('dispatcher:dispatch', this.cleanup);
  };

  Composer.prototype.compose = function(name, second, third) {
    if (typeof second === 'function') {
      if (third || second.prototype.dispose) {
        if (second.prototype instanceof Composition) {
          return this._compose(name, {
            composition: second,
            options: third
          });
        } else {
          return this._compose(name, {
            options: third,
            compose: function() {
              var autoRender, disabledAutoRender;
              this.item = new second(this.options);
              autoRender = this.item.autoRender;
              disabledAutoRender = autoRender === void 0 || !autoRender;
              if (disabledAutoRender && typeof this.item.render === 'function') {
                return this.item.render();
              }
            }
          });
        }
      }
      return this._compose(name, {
        compose: second
      });
    }
    if (typeof third === 'function') {
      return this._compose(name, {
        compose: third,
        options: second
      });
    }
    return this._compose(name, second);
  };

  Composer.prototype._compose = function(name, options) {
    var composition, current, isPromise, returned;
    if (typeof options.compose !== 'function' && !(options.composition != null)) {
      throw new Error('Composer#compose was used incorrectly');
    }
    if (options.composition != null) {
      composition = new options.composition(options.options);
    } else {
      composition = new Composition(options.options);
      composition.compose = options.compose;
      if (options.check) {
        composition.check = options.check;
      }
    }
    current = this.compositions[name];
    isPromise = false;
    if (current && current.check(composition.options)) {
      current.stale(false);
    } else {
      if (current) {
        current.dispose();
      }
      returned = composition.compose(composition.options);
      isPromise = typeof (returned != null ? returned.then : void 0) === 'function';
      composition.stale(false);
      this.compositions[name] = composition;
    }
    if (isPromise) {
      return returned;
    } else {
      return this.compositions[name].item;
    }
  };

  Composer.prototype.retrieve = function(name) {
    var active;
    active = this.compositions[name];
    if (active && !active.stale()) {
      return active.item;
    } else {
      return void 0;
    }
  };

  Composer.prototype.cleanup = function() {
    var composition, name, _ref;
    _ref = this.compositions;
    for (name in _ref) {
      composition = _ref[name];
      if (composition.stale()) {
        composition.dispose();
        delete this.compositions[name];
      } else {
        composition.stale(true);
      }
    }
  };

  Composer.prototype.dispose = function() {
    var composition, name, _ref;
    if (this.disposed) {
      return;
    }
    this.unsubscribeAllEvents();
    mediator.removeHandlers(this);
    _ref = this.compositions;
    for (name in _ref) {
      composition = _ref[name];
      composition.dispose();
    }
    delete this.compositions;
    this.disposed = true;
    return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
  };

  return Composer;

})();

});;loader.register('chaplin/controllers/controller', function(e, r, module) {
'use strict';

var Backbone, Controller, EventBroker, mediator, utils, _,
  __slice = [].slice,
  __hasProp = {}.hasOwnProperty;

_ = loader('underscore');

Backbone = loader('backbone');

EventBroker = loader('chaplin/lib/event_broker');

utils = loader('chaplin/lib/utils');

mediator = loader('chaplin/mediator');

module.exports = Controller = (function() {

  Controller.extend = Backbone.Model.extend;

  _.extend(Controller.prototype, Backbone.Events);

  _.extend(Controller.prototype, EventBroker);

  Controller.prototype.view = null;

  Controller.prototype.redirected = false;

  function Controller() {
    this.initialize.apply(this, arguments);
  }

  Controller.prototype.initialize = function() {};

  Controller.prototype.beforeAction = function() {};

  Controller.prototype.adjustTitle = function(subtitle) {
    return mediator.execute('adjustTitle', subtitle);
  };

  Controller.prototype.reuse = function(name) {
    var method;
    method = arguments.length === 1 ? 'retrieve' : 'compose';
    return mediator.execute.apply(mediator, ["composer:" + method].concat(__slice.call(arguments)));
  };

  Controller.prototype.compose = function() {
    throw new Error('Controller#compose was moved to Controller#reuse');
  };

  Controller.prototype.redirectTo = function(pathDesc, params, options) {
    this.redirected = true;
    return utils.redirectTo(pathDesc, params, options);
  };

  Controller.prototype.disposed = false;

  Controller.prototype.dispose = function() {
    var obj, prop;
    if (this.disposed) {
      return;
    }
    for (prop in this) {
      if (!__hasProp.call(this, prop)) continue;
      obj = this[prop];
      if (!(obj && typeof obj.dispose === 'function')) {
        continue;
      }
      obj.dispose();
      delete this[prop];
    }
    this.unsubscribeAllEvents();
    this.stopListening();
    this.disposed = true;
    return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
  };

  return Controller;

})();

});;loader.register('chaplin/models/collection', function(e, r, module) {
'use strict';

var Backbone, Collection, EventBroker, Model, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = loader('underscore');

Backbone = loader('backbone');

EventBroker = loader('chaplin/lib/event_broker');

Model = loader('chaplin/models/model');

utils = loader('chaplin/lib/utils');

module.exports = Collection = (function(_super) {

  __extends(Collection, _super);

  function Collection() {
    return Collection.__super__.constructor.apply(this, arguments);
  }

  _.extend(Collection.prototype, EventBroker);

  Collection.prototype.model = Model;

  Collection.prototype.serialize = function() {
    return this.map(utils.serialize);
  };

  Collection.prototype.disposed = false;

  Collection.prototype.dispose = function() {
    var prop, properties, _i, _len;
    if (this.disposed) {
      return;
    }
    this.trigger('dispose', this);
    this.reset([], {
      silent: true
    });
    this.unsubscribeAllEvents();
    this.stopListening();
    this.off();
    properties = ['model', 'models', '_byId', '_byCid', '_callbacks'];
    for (_i = 0, _len = properties.length; _i < _len; _i++) {
      prop = properties[_i];
      delete this[prop];
    }
    this.disposed = true;
    return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
  };

  return Collection;

})(Backbone.Collection);

});;loader.register('chaplin/models/model', function(e, r, module) {
'use strict';

var Backbone, EventBroker, Model, serializeAttributes, serializeModelAttributes, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = loader('underscore');

Backbone = loader('backbone');

utils = loader('chaplin/lib/utils');

EventBroker = loader('chaplin/lib/event_broker');

serializeAttributes = function(model, attributes, modelStack) {
  var delegator, key, otherModel, serializedModels, value, _i, _len, _ref;
  delegator = utils.beget(attributes);
  if (modelStack == null) {
    modelStack = {};
  }
  modelStack[model.cid] = true;
  for (key in attributes) {
    value = attributes[key];
    if (value instanceof Backbone.Model) {
      delegator[key] = serializeModelAttributes(value, model, modelStack);
    } else if (value instanceof Backbone.Collection) {
      serializedModels = [];
      _ref = value.models;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        otherModel = _ref[_i];
        serializedModels.push(serializeModelAttributes(otherModel, model, modelStack));
      }
      delegator[key] = serializedModels;
    }
  }
  delete modelStack[model.cid];
  return delegator;
};

serializeModelAttributes = function(model, currentModel, modelStack) {
  var attributes;
  if (model === currentModel || model.cid in modelStack) {
    return null;
  }
  attributes = typeof model.getAttributes === 'function' ? model.getAttributes() : model.attributes;
  return serializeAttributes(model, attributes, modelStack);
};

module.exports = Model = (function(_super) {

  __extends(Model, _super);

  function Model() {
    return Model.__super__.constructor.apply(this, arguments);
  }

  _.extend(Model.prototype, EventBroker);

  Model.prototype.getAttributes = function() {
    return this.attributes;
  };

  Model.prototype.serialize = function() {
    return serializeAttributes(this, this.getAttributes());
  };

  Model.prototype.disposed = false;

  Model.prototype.dispose = function() {
    var prop, properties, _i, _len;
    if (this.disposed) {
      return;
    }
    this.trigger('dispose', this);
    this.unsubscribeAllEvents();
    this.stopListening();
    this.off();
    properties = ['collection', 'attributes', 'changed', '_escapedAttributes', '_previousAttributes', '_silent', '_pending', '_callbacks'];
    for (_i = 0, _len = properties.length; _i < _len; _i++) {
      prop = properties[_i];
      delete this[prop];
    }
    this.disposed = true;
    return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
  };

  return Model;

})(Backbone.Model);

});;loader.register('chaplin/views/layout', function(e, r, module) {
'use strict';

var $, Backbone, EventBroker, Layout, View, mediator, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = loader('underscore');

Backbone = loader('backbone');

mediator = loader('chaplin/mediator');

utils = loader('chaplin/lib/utils');

EventBroker = loader('chaplin/lib/event_broker');

View = loader('chaplin/views/view');

$ = Backbone.$;

module.exports = Layout = (function(_super) {

  __extends(Layout, _super);

  Layout.prototype.el = 'body';

  Layout.prototype.keepElement = true;

  Layout.prototype.title = '';

  Layout.prototype.globalRegions = null;

  Layout.prototype.listen = {
    'beforeControllerDispose mediator': 'scroll'
  };

  function Layout(options) {
    if (options == null) {
      options = {};
    }
    this.openLink = __bind(this.openLink, this);

    this.globalRegions = [];
    this.title = options.title;
    if (options.regions) {
      this.regions = options.regions;
    }
    this.settings = _.defaults(options, {
      titleTemplate: function(data) {
        var st;
        st = data.subtitle ? "" + data.subtitle + " \u2013 " : '';
        return st + data.title;
      },
      openExternalToBlank: false,
      routeLinks: 'a, .go-to',
      skipRouting: '.noscript',
      scrollTo: [0, 0]
    });
    mediator.setHandler('region:show', this.showRegion, this);
    mediator.setHandler('region:register', this.registerRegionHandler, this);
    mediator.setHandler('region:unregister', this.unregisterRegionHandler, this);
    mediator.setHandler('region:find', this.regionByName, this);
    mediator.setHandler('adjustTitle', this.adjustTitle, this);
    Layout.__super__.constructor.apply(this, arguments);
    if (this.settings.routeLinks) {
      this.startLinkRouting();
    }
  }

  Layout.prototype.scroll = function() {
    var position;
    position = this.settings.scrollTo;
    if (position) {
      return window.scrollTo(position[0], position[1]);
    }
  };

  Layout.prototype.adjustTitle = function(subtitle) {
    var title,
      _this = this;
    if (subtitle == null) {
      subtitle = '';
    }
    title = this.settings.titleTemplate({
      title: this.title,
      subtitle: subtitle
    });
    setTimeout(function() {
      document.title = title;
      return _this.publishEvent('adjustTitle', subtitle, title);
    }, 50);
    return title;
  };

  Layout.prototype.startLinkRouting = function() {
    var route;
    route = this.settings.routeLinks;
    if (!route) {
      return;
    }
    if ($) {
      return this.$el.on('click', route, this.openLink);
    } else {
      return this.delegate('click', route, this.openLink);
    }
  };

  Layout.prototype.stopLinkRouting = function() {
    var route;
    route = this.settings.routeLinks;
    if ($) {
      if (route) {
        return this.$el.off('click', route);
      }
    } else {
      return this.undelegate('click', route, this.openLink);
    }
  };

  Layout.prototype.isExternalLink = function(link) {
    var _ref, _ref1;
    return link.target === '_blank' || link.rel === 'external' || ((_ref = link.protocol) !== 'http:' && _ref !== 'https:' && _ref !== 'file:') || ((_ref1 = link.hostname) !== location.hostname && _ref1 !== '');
  };

  Layout.prototype.openLink = function(event) {
    var el, external, href, isAnchor, skipRouting, type;
    if (utils.modifierKeyPressed(event)) {
      return;
    }
    el = $ ? event.currentTarget : event.delegateTarget;
    isAnchor = el.nodeName === 'A';
    href = el.getAttribute('href') || el.getAttribute('data-href') || null;
    if (!(href != null) || href === '' || href.charAt(0) === '#') {
      return;
    }
    skipRouting = this.settings.skipRouting;
    type = typeof skipRouting;
    if (type === 'function' && !skipRouting(href, el) || type === 'string' && ($ ? $(el).is(skipRouting) : Backbone.utils.matchesSelector(el, skipRouting))) {
      return;
    }
    external = isAnchor && this.isExternalLink(el);
    if (external) {
      if (this.settings.openExternalToBlank) {
        event.preventDefault();
        window.open(href);
      }
      return;
    }
    utils.redirectTo({
      url: href
    });
    event.preventDefault();
  };

  Layout.prototype.registerRegionHandler = function(instance, name, selector) {
    if (name != null) {
      return this.registerGlobalRegion(instance, name, selector);
    } else {
      return this.registerGlobalRegions(instance);
    }
  };

  Layout.prototype.registerGlobalRegion = function(instance, name, selector) {
    this.unregisterGlobalRegion(instance, name);
    return this.globalRegions.unshift({
      instance: instance,
      name: name,
      selector: selector
    });
  };

  Layout.prototype.registerGlobalRegions = function(instance) {
    var name, selector, version, _i, _len, _ref;
    _ref = utils.getAllPropertyVersions(instance, 'regions');
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      version = _ref[_i];
      for (name in version) {
        selector = version[name];
        this.registerGlobalRegion(instance, name, selector);
      }
    }
  };

  Layout.prototype.unregisterRegionHandler = function(instance, name) {
    if (name != null) {
      return this.unregisterGlobalRegion(instance, name);
    } else {
      return this.unregisterGlobalRegions(instance);
    }
  };

  Layout.prototype.unregisterGlobalRegion = function(instance, name) {
    var cid, region;
    cid = instance.cid;
    return this.globalRegions = (function() {
      var _i, _len, _ref, _results;
      _ref = this.globalRegions;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        region = _ref[_i];
        if (region.instance.cid !== cid || region.name !== name) {
          _results.push(region);
        }
      }
      return _results;
    }).call(this);
  };

  Layout.prototype.unregisterGlobalRegions = function(instance) {
    var region;
    return this.globalRegions = (function() {
      var _i, _len, _ref, _results;
      _ref = this.globalRegions;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        region = _ref[_i];
        if (region.instance.cid !== instance.cid) {
          _results.push(region);
        }
      }
      return _results;
    }).call(this);
  };

  Layout.prototype.regionByName = function(name) {
    var reg, _i, _len, _ref;
    _ref = this.globalRegions;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      reg = _ref[_i];
      if (reg.name === name && !reg.instance.stale) {
        return reg;
      }
    }
  };

  Layout.prototype.showRegion = function(name, instance) {
    var region;
    region = this.regionByName(name);
    if (!region) {
      throw new Error("No region registered under " + name);
    }
    return instance.container = region.selector === '' ? $ ? region.instance.$el : region.instance.el : region.instance.noWrap ? $ ? $(region.instance.container).find(region.selector) : region.instance.container.querySelector(region.selector) : region.instance[$ ? '$' : 'find'](region.selector);
  };

  Layout.prototype.dispose = function() {
    var prop, _i, _len, _ref;
    if (this.disposed) {
      return;
    }
    this.stopLinkRouting();
    _ref = ['globalRegions', 'title', 'route'];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      prop = _ref[_i];
      delete this[prop];
    }
    mediator.removeHandlers(this);
    return Layout.__super__.dispose.apply(this, arguments);
  };

  return Layout;

})(View);

});;loader.register('chaplin/views/view', function(e, r, module) {
'use strict';

var $, Backbone, EventBroker, View, attach, bind, mediator, setHTML, utils, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

_ = loader('underscore');

Backbone = loader('backbone');

mediator = loader('chaplin/mediator');

EventBroker = loader('chaplin/lib/event_broker');

utils = loader('chaplin/lib/utils');

$ = Backbone.$;

bind = (function() {
  if (Function.prototype.bind) {
    return function(item, ctx) {
      return item.bind(ctx);
    };
  } else if (_.bind) {
    return _.bind;
  }
})();

setHTML = (function() {
  if ($) {
    return function(elem, html) {
      return elem.html(html);
    };
  } else {
    return function(elem, html) {
      return elem.innerHTML = html;
    };
  }
})();

attach = (function() {
  if ($) {
    return function(view) {
      var actual;
      actual = $(view.container);
      if (typeof view.containerMethod === 'function') {
        return view.containerMethod(actual, view.el);
      } else {
        return actual[view.containerMethod](view.el);
      }
    };
  } else {
    return function(view) {
      var actual;
      actual = typeof view.container === 'string' ? document.querySelector(view.container) : view.container;
      if (typeof view.containerMethod === 'function') {
        return view.containerMethod(actual, view.el);
      } else {
        return actual[view.containerMethod](view.el);
      }
    };
  }
})();

module.exports = View = (function(_super) {

  __extends(View, _super);

  _.extend(View.prototype, EventBroker);

  View.prototype.autoRender = false;

  View.prototype.autoAttach = true;

  View.prototype.container = null;

  View.prototype.containerMethod = $ ? 'append' : 'appendChild';

  View.prototype.regions = null;

  View.prototype.region = null;

  View.prototype.stale = false;

  View.prototype.noWrap = false;

  View.prototype.keepElement = false;

  View.prototype.subviews = null;

  View.prototype.subviewsByName = null;

  View.prototype.optionNames = ['autoAttach', 'autoRender', 'container', 'containerMethod', 'region', 'regions', 'noWrap'];

  function View(options) {
    var optName, optValue, region, render,
      _this = this;
    if (options) {
      for (optName in options) {
        optValue = options[optName];
        if (__indexOf.call(this.optionNames, optName) >= 0) {
          this[optName] = optValue;
        }
      }
    }
    render = this.render;
    this.render = function() {
      if (_this.disposed) {
        return false;
      }
      render.apply(_this, arguments);
      if (_this.autoAttach) {
        _this.attach.apply(_this, arguments);
      }
      return _this;
    };
    this.subviews = [];
    this.subviewsByName = {};
    if (this.noWrap) {
      if (this.region) {
        region = mediator.execute('region:find', this.region);
        if (region != null) {
          this.el = region.instance.container != null ? region.instance.region != null ? $(region.instance.container).find(region.selector) : region.instance.container : region.instance.$(region.selector);
        }
      }
      if (this.container) {
        this.el = this.container;
      }
    }
    View.__super__.constructor.apply(this, arguments);
    this.delegateListeners();
    if (this.model) {
      this.listenTo(this.model, 'dispose', this.dispose);
    }
    if (this.collection) {
      this.listenTo(this.collection, 'dispose', function(subject) {
        if (!subject || subject === _this.collection) {
          return _this.dispose();
        }
      });
    }
    if (this.regions != null) {
      mediator.execute('region:register', this);
    }
    if (this.autoRender) {
      this.render();
    }
  }

  View.prototype.delegate = function(eventName, second, third) {
    var bound, event, events, handler, list, selector;
    if (Backbone.utils) {
      return Backbone.utils.delegate(this, eventName, second, third);
    }
    if (typeof eventName !== 'string') {
      throw new TypeError('View#delegate: first argument must be a string');
    }
    if (arguments.length === 2) {
      handler = second;
    } else if (arguments.length === 3) {
      selector = second;
      if (typeof selector !== 'string') {
        throw new TypeError('View#delegate: ' + 'second argument must be a string');
      }
      handler = third;
    } else {
      throw new TypeError('View#delegate: ' + 'only two or three arguments are allowed');
    }
    if (typeof handler !== 'function') {
      throw new TypeError('View#delegate: ' + 'handler argument must be function');
    }
    list = (function() {
      var _i, _len, _ref, _results;
      _ref = eventName.split(' ');
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        event = _ref[_i];
        _results.push("" + event + ".delegate" + this.cid);
      }
      return _results;
    }).call(this);
    events = list.join(' ');
    bound = bind(handler, this);
    this.$el.on(events, selector || null, bound);
    return bound;
  };

  View.prototype._delegateEvents = function(events) {
    var bound, eventName, handler, key, match, selector, value;
    if (Backbone.View.prototype.delegateEvents.length === 2) {
      return Backbone.View.prototype.delegateEvents.call(this, events, true);
    }
    for (key in events) {
      value = events[key];
      handler = typeof value === 'function' ? value : this[value];
      if (!handler) {
        throw new Error("Method '" + value + "' does not exist");
      }
      match = key.match(/^(\S+)\s*(.*)$/);
      eventName = "" + match[1] + ".delegateEvents" + this.cid;
      selector = match[2];
      bound = bind(handler, this);
      this.$el.on(eventName, selector || null, bound);
    }
  };

  View.prototype.delegateEvents = function(events, keepOld) {
    var classEvents, _i, _len, _ref;
    if (!keepOld) {
      this.undelegateEvents();
    }
    if (events) {
      return this._delegateEvents(events);
    }
    _ref = utils.getAllPropertyVersions(this, 'events');
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      classEvents = _ref[_i];
      if (typeof classEvents === 'function') {
        throw new TypeError('View#delegateEvents: functions are not supported');
      }
      this._delegateEvents(classEvents);
    }
  };

  View.prototype.undelegate = function(eventName, second, third) {
    var event, events, handler, list, selector;
    if (Backbone.utils) {
      return Backbone.utils.undelegate(this, eventName, second, third);
    }
    if (eventName) {
      if (typeof eventName !== 'string') {
        throw new TypeError('View#undelegate: first argument must be a string');
      }
      if (arguments.length === 2) {
        if (typeof second === 'string') {
          selector = second;
        } else {
          handler = second;
        }
      } else if (arguments.length === 3) {
        selector = second;
        if (typeof selector !== 'string') {
          throw new TypeError('View#undelegate: ' + 'second argument must be a string');
        }
        handler = third;
      }
      list = (function() {
        var _i, _len, _ref, _results;
        _ref = eventName.split(' ');
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          event = _ref[_i];
          _results.push("" + event + ".delegate" + this.cid);
        }
        return _results;
      }).call(this);
      events = list.join(' ');
      return this.$el.off(events, selector || null);
    } else {
      return this.$el.off(".delegate" + this.cid);
    }
  };

  View.prototype.delegateListeners = function() {
    var eventName, key, method, target, version, _i, _len, _ref, _ref1;
    if (!this.listen) {
      return;
    }
    _ref = utils.getAllPropertyVersions(this, 'listen');
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      version = _ref[_i];
      for (key in version) {
        method = version[key];
        if (typeof method !== 'function') {
          method = this[method];
        }
        if (typeof method !== 'function') {
          throw new Error('View#delegateListeners: ' + ("" + method + " must be function"));
        }
        _ref1 = key.split(' '), eventName = _ref1[0], target = _ref1[1];
        this.delegateListener(eventName, target, method);
      }
    }
  };

  View.prototype.delegateListener = function(eventName, target, callback) {
    var prop;
    if (target === 'model' || target === 'collection') {
      prop = this[target];
      if (prop) {
        this.listenTo(prop, eventName, callback);
      }
    } else if (target === 'mediator') {
      this.subscribeEvent(eventName, callback);
    } else if (!target) {
      this.on(eventName, callback, this);
    }
  };

  View.prototype.registerRegion = function(name, selector) {
    return mediator.execute('region:register', this, name, selector);
  };

  View.prototype.unregisterRegion = function(name) {
    return mediator.execute('region:unregister', this, name);
  };

  View.prototype.unregisterAllRegions = function() {
    return mediator.execute({
      name: 'region:unregister',
      silent: true
    }, this);
  };

  View.prototype.subview = function(name, view) {
    var byName, subviews;
    subviews = this.subviews;
    byName = this.subviewsByName;
    if (name && view) {
      this.removeSubview(name);
      subviews.push(view);
      byName[name] = view;
      return view;
    } else if (name) {
      return byName[name];
    }
  };

  View.prototype.removeSubview = function(nameOrView) {
    var byName, index, name, otherName, otherView, subviews, view;
    if (!nameOrView) {
      return;
    }
    subviews = this.subviews;
    byName = this.subviewsByName;
    if (typeof nameOrView === 'string') {
      name = nameOrView;
      view = byName[name];
    } else {
      view = nameOrView;
      for (otherName in byName) {
        otherView = byName[otherName];
        if (!(otherView === view)) {
          continue;
        }
        name = otherName;
        break;
      }
    }
    if (!(name && view && view.dispose)) {
      return;
    }
    view.dispose();
    index = utils.indexOf(subviews, view);
    if (index !== -1) {
      subviews.splice(index, 1);
    }
    return delete byName[name];
  };

  View.prototype.getTemplateData = function() {
    var data, source;
    data = this.model ? utils.serialize(this.model) : this.collection ? {
      items: utils.serialize(this.collection),
      length: this.collection.length
    } : {};
    source = this.model || this.collection;
    if (source) {
      if (typeof source.isSynced === 'function' && !('synced' in data)) {
        data.synced = source.isSynced();
      }
    }
    return data;
  };

  View.prototype.getTemplateFunction = function() {
    throw new Error('View#getTemplateFunction must be overridden');
  };

  View.prototype.render = function() {
    var el, html, templateFunc;
    if (this.disposed) {
      return false;
    }
    templateFunc = this.getTemplateFunction();
    if (typeof templateFunc === 'function') {
      html = templateFunc(this.getTemplateData());
      if (this.noWrap) {
        el = document.createElement('div');
        el.innerHTML = html;
        if (el.children.length > 1) {
          throw new Error('There must be a single top-level element when ' + 'using `noWrap`.');
        }
        this.undelegateEvents();
        this.setElement(el.firstChild, true);
      } else {
        setHTML(($ ? this.$el : this.el), html);
      }
    }
    return this;
  };

  View.prototype.attach = function() {
    if (this.region != null) {
      mediator.execute('region:show', this.region, this);
    }
    if (this.container && !document.body.contains(this.el)) {
      attach(this);
      return this.trigger('addedToDOM');
    }
  };

  View.prototype.disposed = false;

  View.prototype.dispose = function() {
    var prop, properties, subview, _i, _j, _len, _len1, _ref;
    if (this.disposed) {
      return;
    }
    this.unregisterAllRegions();
    _ref = this.subviews;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      subview = _ref[_i];
      subview.dispose();
    }
    this.unsubscribeAllEvents();
    this.off();
    if (this.keepElement) {
      this.undelegateEvents();
      this.undelegate();
      this.stopListening();
    } else {
      this.remove();
    }
    properties = ['el', '$el', 'options', 'model', 'collection', 'subviews', 'subviewsByName', '_callbacks'];
    for (_j = 0, _len1 = properties.length; _j < _len1; _j++) {
      prop = properties[_j];
      delete this[prop];
    }
    this.disposed = true;
    return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
  };

  return View;

})(Backbone.View);

});;loader.register('chaplin/views/collection_view', function(e, r, module) {
'use strict';

var $, Backbone, CollectionView, View, addClass, endAnimation, filterChildren, insertView, startAnimation, toggleElement, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = loader('underscore');

Backbone = loader('backbone');

View = loader('chaplin/views/view');

utils = loader('chaplin/lib/utils');

$ = Backbone.$;

filterChildren = function(nodeList, selector) {
  var node, _i, _len, _results;
  if (!selector) {
    return nodeList;
  }
  _results = [];
  for (_i = 0, _len = nodeList.length; _i < _len; _i++) {
    node = nodeList[_i];
    if (Backbone.utils.matchesSelector(node, selector)) {
      _results.push(node);
    }
  }
  return _results;
};

toggleElement = (function() {
  if ($) {
    return function(elem, visible) {
      return elem.toggle(visible);
    };
  } else {
    return function(elem, visible) {
      return elem.style.display = (visible ? '' : 'none');
    };
  }
})();

addClass = (function() {
  if ($) {
    return function(elem, cls) {
      return elem.addClass(cls);
    };
  } else {
    return function(elem, cls) {
      return elem.classList.add(cls);
    };
  }
})();

startAnimation = (function() {
  if ($) {
    return function(elem, useCssAnimation, cls) {
      if (useCssAnimation) {
        return addClass(elem, cls);
      } else {
        return elem.css('opacity', 0);
      }
    };
  } else {
    return function(elem, useCssAnimation, cls) {
      if (useCssAnimation) {
        return addClass(elem, cls);
      } else {
        return elem.style.opacity = 0;
      }
    };
  }
})();

endAnimation = (function() {
  if ($) {
    return function(elem, duration) {
      return elem.animate({
        opacity: 1
      }, duration);
    };
  } else {
    return function(elem, duration) {
      elem.style.transition = "opacity " + (duration / 1000) + "s";
      return elem.opacity = 1;
    };
  }
})();

insertView = (function() {
  if ($) {
    return function(list, viewEl, position, length, itemSelector) {
      var children, childrenLength, insertInMiddle, isEnd, method;
      insertInMiddle = (0 < position && position < length);
      isEnd = function(length) {
        return length === 0 || position === length;
      };
      if (insertInMiddle || itemSelector) {
        children = list.children(itemSelector);
        childrenLength = children.length;
        if (children[position] !== viewEl) {
          if (isEnd(childrenLength)) {
            return list.append(viewEl);
          } else {
            if (position === 0) {
              return children.eq(position).before(viewEl);
            } else {
              return children.eq(position - 1).after(viewEl);
            }
          }
        }
      } else {
        method = isEnd(length) ? 'append' : 'prepend';
        return list[method](viewEl);
      }
    };
  } else {
    return function(list, viewEl, position, length, itemSelector) {
      var children, childrenLength, insertInMiddle, isEnd, last;
      insertInMiddle = (0 < position && position < length);
      isEnd = function(length) {
        return length === 0 || position === length;
      };
      if (insertInMiddle || itemSelector) {
        children = filterChildren(list.children, itemSelector);
        childrenLength = children.length;
        if (children[position] !== viewEl) {
          if (isEnd(childrenLength)) {
            return list.appendChild(viewEl);
          } else if (position === 0) {
            return list.insertBefore(viewEl, children[position]);
          } else {
            last = children[position - 1];
            if (list.lastChild === last) {
              return list.appendChild(viewEl);
            } else {
              return list.insertBefore(viewEl, last.nextElementSibling);
            }
          }
        }
      } else if (isEnd(length)) {
        return list.appendChild(viewEl);
      } else {
        return list.insertBefore(viewEl, list.firstChild);
      }
    };
  }
})();

module.exports = CollectionView = (function(_super) {

  __extends(CollectionView, _super);

  CollectionView.prototype.itemView = null;

  CollectionView.prototype.autoRender = true;

  CollectionView.prototype.renderItems = true;

  CollectionView.prototype.animationDuration = 500;

  CollectionView.prototype.useCssAnimation = false;

  CollectionView.prototype.animationStartClass = 'animated-item-view';

  CollectionView.prototype.animationEndClass = 'animated-item-view-end';

  CollectionView.prototype.listSelector = null;

  CollectionView.prototype.$list = null;

  CollectionView.prototype.fallbackSelector = null;

  CollectionView.prototype.$fallback = null;

  CollectionView.prototype.loadingSelector = null;

  CollectionView.prototype.$loading = null;

  CollectionView.prototype.itemSelector = void 0;

  CollectionView.prototype.filterer = null;

  CollectionView.prototype.filterCallback = function(view, included) {
    if ($) {
      view.$el.stop(true, true);
    }
    return toggleElement(($ ? view.$el : view.el), included);
  };

  CollectionView.prototype.visibleItems = null;

  CollectionView.prototype.optionNames = View.prototype.optionNames.concat(['renderItems', 'itemView']);

  function CollectionView(options) {
    this.renderAllItems = __bind(this.renderAllItems, this);

    this.toggleFallback = __bind(this.toggleFallback, this);

    this.itemsReset = __bind(this.itemsReset, this);

    this.itemRemoved = __bind(this.itemRemoved, this);

    this.itemAdded = __bind(this.itemAdded, this);
    this.visibleItems = [];
    CollectionView.__super__.constructor.apply(this, arguments);
  }

  CollectionView.prototype.initialize = function(options) {
    if (options == null) {
      options = {};
    }
    this.addCollectionListeners();
    if (options.filterer != null) {
      return this.filter(options.filterer);
    }
  };

  CollectionView.prototype.addCollectionListeners = function() {
    this.listenTo(this.collection, 'add', this.itemAdded);
    this.listenTo(this.collection, 'remove', this.itemRemoved);
    return this.listenTo(this.collection, 'reset sort', this.itemsReset);
  };

  CollectionView.prototype.getTemplateData = function() {
    var templateData;
    templateData = {
      length: this.collection.length
    };
    if (typeof this.collection.isSynced === 'function') {
      templateData.synced = this.collection.isSynced();
    }
    return templateData;
  };

  CollectionView.prototype.getTemplateFunction = function() {};

  CollectionView.prototype.render = function() {
    var listSelector;
    CollectionView.__super__.render.apply(this, arguments);
    listSelector = _.result(this, 'listSelector');
    if ($) {
      this.$list = listSelector ? this.$(listSelector) : this.$el;
    } else {
      this.list = listSelector ? this.find(this.listSelector) : this.el;
    }
    this.initFallback();
    this.initLoadingIndicator();
    if (this.renderItems) {
      return this.renderAllItems();
    }
  };

  CollectionView.prototype.itemAdded = function(item, collection, options) {
    return this.insertView(item, this.renderItem(item), options.at);
  };

  CollectionView.prototype.itemRemoved = function(item) {
    return this.removeViewForItem(item);
  };

  CollectionView.prototype.itemsReset = function() {
    return this.renderAllItems();
  };

  CollectionView.prototype.initFallback = function() {
    if (!this.fallbackSelector) {
      return;
    }
    if ($) {
      this.$fallback = this.$(this.fallbackSelector);
    } else {
      this.fallback = this.find(this.fallbackSelector);
    }
    this.on('visibilityChange', this.toggleFallback);
    this.listenTo(this.collection, 'syncStateChange', this.toggleFallback);
    return this.toggleFallback();
  };

  CollectionView.prototype.toggleFallback = function() {
    var visible;
    visible = this.visibleItems.length === 0 && (typeof this.collection.isSynced === 'function' ? this.collection.isSynced() : true);
    return toggleElement(($ ? this.$fallback : this.fallback), visible);
  };

  CollectionView.prototype.initLoadingIndicator = function() {
    if (!(this.loadingSelector && typeof this.collection.isSyncing === 'function')) {
      return;
    }
    if ($) {
      this.$loading = this.$(this.loadingSelector);
    } else {
      this.loading = this.find(this.loadingSelector);
    }
    this.listenTo(this.collection, 'syncStateChange', this.toggleLoadingIndicator);
    return this.toggleLoadingIndicator();
  };

  CollectionView.prototype.toggleLoadingIndicator = function() {
    var visible;
    visible = this.collection.length === 0 && this.collection.isSyncing();
    return toggleElement(($ ? this.$loading : this.loading), visible);
  };

  CollectionView.prototype.getItemViews = function() {
    var itemViews, name, view, _ref;
    itemViews = {};
    if (this.subviews.length > 0) {
      _ref = this.subviewsByName;
      for (name in _ref) {
        view = _ref[name];
        if (name.slice(0, 9) === 'itemView:') {
          itemViews[name.slice(9)] = view;
        }
      }
    }
    return itemViews;
  };

  CollectionView.prototype.filter = function(filterer, filterCallback) {
    var hasItemViews, included, index, item, view, _i, _len, _ref,
      _this = this;
    if (typeof filterer === 'function' || filterer === null) {
      this.filterer = filterer;
    }
    if (typeof filterCallback === 'function' || filterCallback === null) {
      this.filterCallback = filterCallback;
    }
    hasItemViews = (function() {
      var name;
      if (_this.subviews.length > 0) {
        for (name in _this.subviewsByName) {
          if (name.slice(0, 9) === 'itemView:') {
            return true;
          }
        }
      }
      return false;
    })();
    if (hasItemViews) {
      _ref = this.collection.models;
      for (index = _i = 0, _len = _ref.length; _i < _len; index = ++_i) {
        item = _ref[index];
        included = typeof this.filterer === 'function' ? this.filterer(item, index) : true;
        view = this.subview("itemView:" + item.cid);
        if (!view) {
          throw new Error('CollectionView#filter: ' + ("no view found for " + item.cid));
        }
        this.filterCallback(view, included);
        this.updateVisibleItems(view.model, included, false);
      }
    }
    return this.trigger('visibilityChange', this.visibleItems);
  };

  CollectionView.prototype.renderAllItems = function() {
    var cid, index, item, items, remainingViewsByCid, view, _i, _j, _len, _len1, _ref;
    items = this.collection.models;
    this.visibleItems = [];
    remainingViewsByCid = {};
    for (_i = 0, _len = items.length; _i < _len; _i++) {
      item = items[_i];
      view = this.subview("itemView:" + item.cid);
      if (view) {
        remainingViewsByCid[item.cid] = view;
      }
    }
    _ref = this.getItemViews();
    for (cid in _ref) {
      if (!__hasProp.call(_ref, cid)) continue;
      view = _ref[cid];
      if (!(cid in remainingViewsByCid)) {
        this.removeSubview("itemView:" + cid);
      }
    }
    for (index = _j = 0, _len1 = items.length; _j < _len1; index = ++_j) {
      item = items[index];
      view = this.subview("itemView:" + item.cid);
      if (view) {
        this.insertView(item, view, index, false);
      } else {
        this.insertView(item, this.renderItem(item), index);
      }
    }
    if (items.length === 0) {
      return this.trigger('visibilityChange', this.visibleItems);
    }
  };

  CollectionView.prototype.renderItem = function(item) {
    var view;
    view = this.subview("itemView:" + item.cid);
    if (!view) {
      view = this.initItemView(item);
      this.subview("itemView:" + item.cid, view);
    }
    view.render();
    return view;
  };

  CollectionView.prototype.initItemView = function(model) {
    if (this.itemView) {
      return new this.itemView({
        autoRender: false,
        model: model
      });
    } else {
      throw new Error('The CollectionView#itemView property ' + 'must be defined or the initItemView() must be overridden.');
    }
  };

  CollectionView.prototype.insertView = function(item, view, position, enableAnimation) {
    var elem, included, length, list,
      _this = this;
    if (enableAnimation == null) {
      enableAnimation = true;
    }
    if (this.animationDuration === 0) {
      enableAnimation = false;
    }
    if (typeof position !== 'number') {
      position = this.collection.indexOf(item);
    }
    included = typeof this.filterer === 'function' ? this.filterer(item, position) : true;
    elem = $ ? view.$el : view.el;
    if (included && enableAnimation) {
      startAnimation(elem, this.useCssAnimation, this.animationStartClass);
    }
    if (this.filterer) {
      this.filterCallback(view, included);
    }
    length = this.collection.length;
    list = $ ? this.$list : this.list;
    insertView(list, elem, position, length, this.itemSelector);
    view.trigger('addedToParent');
    this.updateVisibleItems(item, included);
    if (included && enableAnimation) {
      if (this.useCssAnimation) {
        setTimeout((function() {
          return addClass(elem, _this.animationEndClass);
        }), 0);
      } else {
        endAnimation(elem, this.animationDuration);
      }
    }
    return view;
  };

  CollectionView.prototype.removeViewForItem = function(item) {
    this.updateVisibleItems(item, false);
    return this.removeSubview("itemView:" + item.cid);
  };

  CollectionView.prototype.updateVisibleItems = function(item, includedInFilter, triggerEvent) {
    var includedInVisibleItems, visibilityChanged, visibleItemsIndex;
    if (triggerEvent == null) {
      triggerEvent = true;
    }
    visibilityChanged = false;
    visibleItemsIndex = utils.indexOf(this.visibleItems, item);
    includedInVisibleItems = visibleItemsIndex !== -1;
    if (includedInFilter && !includedInVisibleItems) {
      this.visibleItems.push(item);
      visibilityChanged = true;
    } else if (!includedInFilter && includedInVisibleItems) {
      this.visibleItems.splice(visibleItemsIndex, 1);
      visibilityChanged = true;
    }
    if (visibilityChanged && triggerEvent) {
      this.trigger('visibilityChange', this.visibleItems);
    }
    return visibilityChanged;
  };

  CollectionView.prototype.dispose = function() {
    var prop, properties, _i, _len;
    if (this.disposed) {
      return;
    }
    properties = ['$list', '$fallback', '$loading', 'visibleItems'];
    for (_i = 0, _len = properties.length; _i < _len; _i++) {
      prop = properties[_i];
      delete this[prop];
    }
    return CollectionView.__super__.dispose.apply(this, arguments);
  };

  return CollectionView;

})(View);

});;loader.register('chaplin/lib/route', function(e, r, module) {
'use strict';

var Backbone, Controller, EventBroker, Route, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty;

_ = loader('underscore');

Backbone = loader('backbone');

EventBroker = loader('chaplin/lib/event_broker');

Controller = loader('chaplin/controllers/controller');

utils = loader('chaplin/lib/utils');

module.exports = Route = (function() {
  var escapeRegExp, optionalRegExp, paramRegExp, processTrailingSlash;

  Route.extend = Backbone.Model.extend;

  _.extend(Route.prototype, EventBroker);

  escapeRegExp = /[\-{}\[\]+?.,\\\^$|#\s]/g;

  optionalRegExp = /\((.*?)\)/g;

  paramRegExp = /(?::|\*)(\w+)/g;

  processTrailingSlash = function(path, trailing) {
    switch (trailing) {
      case true:
        if (path.slice(-1) !== '/') {
          path += '/';
        }
        break;
      case false:
        if (path.slice(-1) === '/') {
          path = path.slice(0, -1);
        }
    }
    return path;
  };

  function Route(pattern, controller, action, options) {
    var _ref;
    this.pattern = pattern;
    this.controller = controller;
    this.action = action;
    this.handler = __bind(this.handler, this);

    this.replaceParams = __bind(this.replaceParams, this);

    this.parseOptionalPortion = __bind(this.parseOptionalPortion, this);

    if (typeof this.pattern !== 'string') {
      throw new Error('Route: RegExps are not supported.\
        Use strings with :names and `constraints` option of route');
    }
    this.options = options ? _.extend({}, options) : {};
    if (this.options.name != null) {
      this.name = this.options.name;
    }
    if (this.name && this.name.indexOf('#') !== -1) {
      throw new Error('Route: "#" cannot be used in name');
    }
    if ((_ref = this.name) == null) {
      this.name = this.controller + '#' + this.action;
    }
    this.allParams = [];
    this.requiredParams = [];
    this.optionalParams = [];
    if (this.action in Controller.prototype) {
      throw new Error('Route: You should not use existing controller ' + 'properties as action names');
    }
    this.createRegExp();
    if (typeof Object.freeze === "function") {
      Object.freeze(this);
    }
  }

  Route.prototype.matches = function(criteria) {
    var invalidParamsCount, name, propertiesCount, property, _i, _len, _ref;
    if (typeof criteria === 'string') {
      return criteria === this.name;
    } else {
      propertiesCount = 0;
      _ref = ['name', 'action', 'controller'];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        name = _ref[_i];
        propertiesCount++;
        property = criteria[name];
        if (property && property !== this[name]) {
          return false;
        }
      }
      invalidParamsCount = propertiesCount === 1 && (name === 'action' || name === 'controller');
      return !invalidParamsCount;
    }
  };

  Route.prototype.reverse = function(params, query) {
    var name, queryString, raw, url, value, _i, _j, _len, _len1, _ref, _ref1;
    params = this.normalizeParams(params);
    if (params === false) {
      return false;
    }
    url = this.pattern;
    _ref = this.requiredParams;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      name = _ref[_i];
      value = params[name];
      url = url.replace(RegExp("[:*]" + name, "g"), value);
    }
    _ref1 = this.optionalParams;
    for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
      name = _ref1[_j];
      if (value = params[name]) {
        url = url.replace(RegExp("[:*]" + name, "g"), value);
      }
    }
    raw = url.replace(optionalRegExp, function(match, portion) {
      if (portion.match(/[:*]/g)) {
        return "";
      } else {
        return portion;
      }
    });
    url = processTrailingSlash(raw, this.options.trailing);
    if (!query) {
      return url;
    }
    if (typeof query === 'object') {
      queryString = utils.queryParams.stringify(query);
      return url += queryString ? '?' + queryString : '';
    } else {
      return url += (query[0] === '?' ? '' : '?') + query;
    }
  };

  Route.prototype.normalizeParams = function(params) {
    var paramIndex, paramName, paramsHash, _i, _len, _ref;
    if (utils.isArray(params)) {
      if (params.length < this.requiredParams.length) {
        return false;
      }
      paramsHash = {};
      _ref = this.requiredParams;
      for (paramIndex = _i = 0, _len = _ref.length; _i < _len; paramIndex = ++_i) {
        paramName = _ref[paramIndex];
        paramsHash[paramName] = params[paramIndex];
      }
      if (!this.testConstraints(paramsHash)) {
        return false;
      }
      params = paramsHash;
    } else {
      if (params == null) {
        params = {};
      }
      if (!this.testParams(params)) {
        return false;
      }
    }
    return params;
  };

  Route.prototype.testConstraints = function(params) {
    var constraint, constraints, name;
    constraints = this.options.constraints;
    if (constraints) {
      for (name in constraints) {
        if (!__hasProp.call(constraints, name)) continue;
        constraint = constraints[name];
        if (!constraint.test(params[name])) {
          return false;
        }
      }
    }
    return true;
  };

  Route.prototype.testParams = function(params) {
    var paramName, _i, _len, _ref;
    _ref = this.requiredParams;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      paramName = _ref[_i];
      if (params[paramName] === void 0) {
        return false;
      }
    }
    return this.testConstraints(params);
  };

  Route.prototype.createRegExp = function() {
    var pattern,
      _this = this;
    pattern = this.pattern;
    pattern = pattern.replace(escapeRegExp, '\\$&');
    this.replaceParams(pattern, function(match, param) {
      return _this.allParams.push(param);
    });
    pattern = pattern.replace(optionalRegExp, this.parseOptionalPortion);
    pattern = this.replaceParams(pattern, function(match, param) {
      _this.requiredParams.push(param);
      return _this.paramCapturePattern(match);
    });
    return this.regExp = RegExp("^" + pattern + "(?=\\/?(?=\\?|$))");
  };

  Route.prototype.parseOptionalPortion = function(match, optionalPortion) {
    var portion,
      _this = this;
    portion = this.replaceParams(optionalPortion, function(match, param) {
      _this.optionalParams.push(param);
      return _this.paramCapturePattern(match);
    });
    return "(?:" + portion + ")?";
  };

  Route.prototype.replaceParams = function(s, callback) {
    return s.replace(paramRegExp, callback);
  };

  Route.prototype.paramCapturePattern = function(param) {
    if (param.charAt(0) === ':') {
      return '([^\/\?]+)';
    } else {
      return '(.*?)';
    }
  };

  Route.prototype.test = function(path) {
    var constraints, matched;
    matched = this.regExp.test(path);
    if (!matched) {
      return false;
    }
    constraints = this.options.constraints;
    if (constraints) {
      return this.testConstraints(this.extractParams(path));
    }
    return true;
  };

  Route.prototype.handler = function(pathParams, options) {
    var actionParams, params, path, query, route, _ref;
    options = options ? _.extend({}, options) : {};
    if (typeof pathParams === 'object') {
      query = utils.queryParams.stringify(options.query);
      params = pathParams;
      path = this.reverse(params);
    } else {
      _ref = pathParams.split('?'), path = _ref[0], query = _ref[1];
      if (!(query != null)) {
        query = '';
      } else {
        options.query = utils.queryParams.parse(query);
      }
      params = this.extractParams(path);
      path = processTrailingSlash(path, this.options.trailing);
    }
    actionParams = _.extend({}, params, this.options.params);
    route = {
      path: path,
      action: this.action,
      controller: this.controller,
      name: this.name,
      query: query
    };
    return this.publishEvent('router:match', route, actionParams, options);
  };

  Route.prototype.extractParams = function(path) {
    var index, match, matches, paramName, params, _i, _len, _ref;
    params = {};
    matches = this.regExp.exec(path);
    _ref = matches.slice(1);
    for (index = _i = 0, _len = _ref.length; _i < _len; index = ++_i) {
      match = _ref[index];
      paramName = this.allParams.length ? this.allParams[index] : index;
      params[paramName] = match;
    }
    return params;
  };

  return Route;

})();

});;loader.register('chaplin/lib/router', function(e, r, module) {
'use strict';

var Backbone, EventBroker, History, Route, Router, mediator, utils, _,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

_ = loader('underscore');

Backbone = loader('backbone');

mediator = loader('chaplin/mediator');

EventBroker = loader('chaplin/lib/event_broker');

History = loader('chaplin/lib/history');

Route = loader('chaplin/lib/route');

utils = loader('chaplin/lib/utils');

module.exports = Router = (function() {

  Router.extend = Backbone.Model.extend;

  _.extend(Router.prototype, EventBroker);

  function Router(options) {
    var isWebFile;
    this.options = options != null ? options : {};
    this.match = __bind(this.match, this);

    isWebFile = window.location.protocol !== 'file:';
    _.defaults(this.options, {
      pushState: isWebFile,
      root: '/',
      trailing: false
    });
    this.removeRoot = new RegExp('^' + utils.escapeRegExp(this.options.root) + '(#)?');
    this.subscribeEvent('!router:route', this.oldEventError);
    this.subscribeEvent('!router:routeByName', this.oldEventError);
    this.subscribeEvent('!router:changeURL', this.oldURLEventError);
    this.subscribeEvent('dispatcher:dispatch', this.changeURL);
    mediator.setHandler('router:route', this.route, this);
    mediator.setHandler('router:reverse', this.reverse, this);
    this.createHistory();
  }

  Router.prototype.oldEventError = function() {
    throw new Error('!router:route and !router:routeByName events were removed.\
  Use `Chaplin.utils.redirectTo`');
  };

  Router.prototype.oldURLEventError = function() {
    throw new Error('!router:changeURL event was removed.');
  };

  Router.prototype.createHistory = function() {
    return Backbone.history = new History();
  };

  Router.prototype.startHistory = function() {
    return Backbone.history.start(this.options);
  };

  Router.prototype.stopHistory = function() {
    if (Backbone.History.started) {
      return Backbone.history.stop();
    }
  };

  Router.prototype.findHandler = function(predicate) {
    var handler, _i, _len, _ref;
    _ref = Backbone.history.handlers;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      handler = _ref[_i];
      if (predicate(handler)) {
        return handler;
      }
    }
  };

  Router.prototype.match = function(pattern, target, options) {
    var action, controller, route, _ref;
    if (options == null) {
      options = {};
    }
    if (arguments.length === 2 && typeof target === 'object') {
      options = target;
      controller = options.controller, action = options.action;
      if (!(controller && action)) {
        throw new Error('Router#match must receive either target or ' + 'options.controller & options.action');
      }
    } else {
      controller = options.controller, action = options.action;
      if (controller || action) {
        throw new Error('Router#match cannot use both target and ' + 'options.controller / options.action');
      }
      _ref = target.split('#'), controller = _ref[0], action = _ref[1];
    }
    _.defaults(options, {
      trailing: this.options.trailing
    });
    route = new Route(pattern, controller, action, options);
    Backbone.history.handlers.push({
      route: route,
      callback: route.handler
    });
    return route;
  };

  Router.prototype.route = function(pathDesc, params, options) {
    var handler, path;
    if (typeof pathDesc === 'object') {
      path = pathDesc.url;
      if (!params && pathDesc.params) {
        params = pathDesc.params;
      }
    }
    params = params ? utils.isArray(params) ? params.slice() : _.extend({}, params) : {};
    if (path != null) {
      path = path.replace(this.removeRoot, '');
      handler = this.findHandler(function(handler) {
        return handler.route.test(path);
      });
      options = params;
      params = null;
    } else {
      options = options ? _.extend({}, options) : {};
      handler = this.findHandler(function(handler) {
        if (handler.route.matches(pathDesc)) {
          params = handler.route.normalizeParams(params);
          if (params) {
            return true;
          }
        }
        return false;
      });
    }
    if (handler) {
      _.defaults(options, {
        changeURL: true
      });
      handler.callback(path || params, options);
      return true;
    } else {
      throw new Error('Router#route: request was not routed');
    }
  };

  Router.prototype.reverse = function(criteria, params, query) {
    var handler, handlers, reversed, root, url, _i, _len;
    root = this.options.root;
    if ((params != null) && typeof params !== 'object') {
      throw new TypeError('Router#reverse: params must be an array or an ' + 'object');
    }
    handlers = Backbone.history.handlers;
    for (_i = 0, _len = handlers.length; _i < _len; _i++) {
      handler = handlers[_i];
      if (!(handler.route.matches(criteria))) {
        continue;
      }
      reversed = handler.route.reverse(params, query);
      if (reversed !== false) {
        url = root ? root + reversed : reversed;
        return url;
      }
    }
    throw new Error('Router#reverse: invalid route specified');
  };

  Router.prototype.changeURL = function(controller, params, route, options) {
    var navigateOptions, url;
    if (!((route.path != null) && options.changeURL)) {
      return;
    }
    url = route.path + (route.query ? "?" + route.query : "");
    navigateOptions = {
      trigger: options.trigger === true,
      replace: options.replace === true
    };
    return Backbone.history.navigate(url, navigateOptions);
  };

  Router.prototype.disposed = false;

  Router.prototype.dispose = function() {
    if (this.disposed) {
      return;
    }
    this.stopHistory();
    delete Backbone.history;
    this.unsubscribeAllEvents();
    mediator.removeHandlers(this);
    this.disposed = true;
    return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
  };

  return Router;

})();

});;loader.register('chaplin/lib/history', function(e, r, module) {
'use strict';

var Backbone, History, isExplorer, rootStripper, routeStripper, trailingSlash, _,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

_ = loader('underscore');

Backbone = loader('backbone');

routeStripper = /^[#\/]|\s+$/g;

rootStripper = /^\/+|\/+$/g;

isExplorer = /msie [\w.]+/;

trailingSlash = /\/$/;

History = (function(_super) {

  __extends(History, _super);

  function History() {
    return History.__super__.constructor.apply(this, arguments);
  }

  History.prototype.getFragment = function(fragment, forcePushState) {
    var root;
    if (!(fragment != null)) {
      if (this._hasPushState || !this._wantsHashChange || forcePushState) {
        fragment = this.location.pathname + this.location.search;
        root = this.root.replace(trailingSlash, '');
        if (!fragment.indexOf(root)) {
          fragment = fragment.substr(root.length);
        }
      } else {
        fragment = this.getHash();
      }
    }
    return fragment.replace(routeStripper, '');
  };

  History.prototype.start = function(options) {
    var atRoot, fragment, loc;
    if (Backbone.History.started) {
      throw new Error('Backbone.history has already been started');
    }
    Backbone.History.started = true;
    this.options = _.extend({}, {
      root: '/'
    }, this.options, options);
    this.root = this.options.root;
    this._wantsHashChange = this.options.hashChange !== false;
    this._wantsPushState = Boolean(this.options.pushState);
    this._hasPushState = Boolean(this.options.pushState && this.history && this.history.pushState);
    fragment = this.getFragment();
    this.root = ('/' + this.root + '/').replace(rootStripper, '/');
    if (this._hasPushState) {
      Backbone.$(window).on('popstate', this.checkUrl);
    } else if (this._wantsHashChange && 'onhashchange' in window) {
      Backbone.$(window).on('hashchange', this.checkUrl);
    } else if (this._wantsHashChange) {
      this._checkUrlInterval = setInterval(this.checkUrl, this.interval);
    }
    this.fragment = fragment;
    loc = this.location;
    atRoot = loc.pathname.replace(/[^\/]$/, '$&/') === this.root;
    if (this._wantsHashChange && this._wantsPushState && !this._hasPushState && !atRoot) {
      this.fragment = this.getFragment(null, true);
      this.location.replace(this.root + '#' + this.fragment);
      return true;
    } else if (this._wantsPushState && this._hasPushState && atRoot && loc.hash) {
      this.fragment = this.getHash().replace(routeStripper, '');
      this.history.replaceState({}, document.title, this.root + this.fragment);
    }
    if (!this.options.silent) {
      return this.loadUrl();
    }
  };

  History.prototype.navigate = function(fragment, options) {
    var historyMethod, isSameFragment, url;
    if (fragment == null) {
      fragment = '';
    }
    if (!Backbone.History.started) {
      return false;
    }
    if (!options || options === true) {
      options = {
        trigger: options
      };
    }
    fragment = this.getFragment(fragment);
    url = this.root + fragment;
    if (this.fragment === fragment) {
      return false;
    }
    this.fragment = fragment;
    if (fragment.length === 0 && url !== '/') {
      url = url.slice(0, -1);
    }
    if (this._hasPushState) {
      historyMethod = options.replace ? 'replaceState' : 'pushState';
      this.history[historyMethod]({}, document.title, url);
    } else if (this._wantsHashChange) {
      this._updateHash(this.location, fragment, options.replace);
      isSameFragment = fragment !== this.getFragment(this.getHash(this.iframe));
      if ((this.iframe != null) && isSameFragment) {
        if (!options.replace) {
          this.iframe.document.open().close();
        }
        this._updateHash(this.iframe.location, fragment, options.replace);
      }
    } else {
      return this.location.assign(url);
    }
    if (options.trigger) {
      return this.loadUrl(fragment);
    }
  };

  return History;

})(Backbone.History);

module.exports = Backbone.$ ? History : Backbone.History;

});;loader.register('chaplin/lib/event_broker', function(e, r, module) {
'use strict';

var EventBroker, mediator,
  __slice = [].slice;

mediator = loader('chaplin/mediator');

EventBroker = {
  subscribeEvent: function(type, handler) {
    if (typeof type !== 'string') {
      throw new TypeError('EventBroker#subscribeEvent: ' + 'type argument must be a string');
    }
    if (typeof handler !== 'function') {
      throw new TypeError('EventBroker#subscribeEvent: ' + 'handler argument must be a function');
    }
    mediator.unsubscribe(type, handler, this);
    return mediator.subscribe(type, handler, this);
  },
  unsubscribeEvent: function(type, handler) {
    if (typeof type !== 'string') {
      throw new TypeError('EventBroker#unsubscribeEvent: ' + 'type argument must be a string');
    }
    if (typeof handler !== 'function') {
      throw new TypeError('EventBroker#unsubscribeEvent: ' + 'handler argument must be a function');
    }
    return mediator.unsubscribe(type, handler);
  },
  unsubscribeAllEvents: function() {
    return mediator.unsubscribe(null, null, this);
  },
  publishEvent: function() {
    var args, type;
    type = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
    if (typeof type !== 'string') {
      throw new TypeError('EventBroker#publishEvent: ' + 'type argument must be a string');
    }
    return mediator.publish.apply(mediator, [type].concat(__slice.call(args)));
  }
};

if (typeof Object.freeze === "function") {
  Object.freeze(EventBroker);
}

module.exports = EventBroker;

});;loader.register('chaplin/lib/support', function(e, r, module) {
'use strict';

var support;

support = {
  propertyDescriptors: (function() {
    var o;
    if (!(typeof Object.defineProperty === 'function' && typeof Object.defineProperties === 'function')) {
      return false;
    }
    try {
      o = {};
      Object.defineProperty(o, 'foo', {
        value: 'bar'
      });
      return o.foo === 'bar';
    } catch (error) {
      return false;
    }
  })()
};

module.exports = support;

});;loader.register('chaplin/lib/composition', function(e, r, module) {
'use strict';

var Backbone, Composition, EventBroker, has, _,
  __hasProp = {}.hasOwnProperty;

_ = loader('underscore');

Backbone = loader('backbone');

EventBroker = loader('chaplin/lib/event_broker');

has = Object.prototype.hasOwnProperty;

module.exports = Composition = (function() {

  Composition.extend = Backbone.Model.extend;

  _.extend(Composition.prototype, Backbone.Events);

  _.extend(Composition.prototype, EventBroker);

  Composition.prototype.item = null;

  Composition.prototype.options = null;

  Composition.prototype._stale = false;

  function Composition(options) {
    if (options != null) {
      this.options = _.extend({}, options);
    }
    this.item = this;
    this.initialize(this.options);
  }

  Composition.prototype.initialize = function() {};

  Composition.prototype.compose = function() {};

  Composition.prototype.check = function(options) {
    return _.isEqual(this.options, options);
  };

  Composition.prototype.stale = function(value) {
    var item, name;
    if (value == null) {
      return this._stale;
    }
    this._stale = value;
    for (name in this) {
      item = this[name];
      if (item && item !== this && typeof item === 'object' && has.call(item, 'stale')) {
        item.stale = value;
      }
    }
  };

  Composition.prototype.disposed = false;

  Composition.prototype.dispose = function() {
    var obj, prop, properties, _i, _len;
    if (this.disposed) {
      return;
    }
    for (prop in this) {
      if (!__hasProp.call(this, prop)) continue;
      obj = this[prop];
      if (obj && typeof obj.dispose === 'function') {
        if (obj !== this) {
          obj.dispose();
          delete this[prop];
        }
      }
    }
    this.unsubscribeAllEvents();
    this.stopListening();
    properties = ['redirected'];
    for (_i = 0, _len = properties.length; _i < _len; _i++) {
      prop = properties[_i];
      delete this[prop];
    }
    this.disposed = true;
    return typeof Object.freeze === "function" ? Object.freeze(this) : void 0;
  };

  return Composition;

})();

});;loader.register('chaplin/lib/sync_machine', function(e, r, module) {
'use strict';

var STATE_CHANGE, SYNCED, SYNCING, SyncMachine, UNSYNCED, event, _fn, _i, _len, _ref;

UNSYNCED = 'unsynced';

SYNCING = 'syncing';

SYNCED = 'synced';

STATE_CHANGE = 'syncStateChange';

SyncMachine = {
  _syncState: UNSYNCED,
  _previousSyncState: null,
  syncState: function() {
    return this._syncState;
  },
  isUnsynced: function() {
    return this._syncState === UNSYNCED;
  },
  isSynced: function() {
    return this._syncState === SYNCED;
  },
  isSyncing: function() {
    return this._syncState === SYNCING;
  },
  unsync: function() {
    var _ref;
    if ((_ref = this._syncState) === SYNCING || _ref === SYNCED) {
      this._previousSync = this._syncState;
      this._syncState = UNSYNCED;
      this.trigger(this._syncState, this, this._syncState);
      this.trigger(STATE_CHANGE, this, this._syncState);
    }
  },
  beginSync: function() {
    var _ref;
    if ((_ref = this._syncState) === UNSYNCED || _ref === SYNCED) {
      this._previousSync = this._syncState;
      this._syncState = SYNCING;
      this.trigger(this._syncState, this, this._syncState);
      this.trigger(STATE_CHANGE, this, this._syncState);
    }
  },
  finishSync: function() {
    if (this._syncState === SYNCING) {
      this._previousSync = this._syncState;
      this._syncState = SYNCED;
      this.trigger(this._syncState, this, this._syncState);
      this.trigger(STATE_CHANGE, this, this._syncState);
    }
  },
  abortSync: function() {
    if (this._syncState === SYNCING) {
      this._syncState = this._previousSync;
      this._previousSync = this._syncState;
      this.trigger(this._syncState, this, this._syncState);
      this.trigger(STATE_CHANGE, this, this._syncState);
    }
  }
};

_ref = [UNSYNCED, SYNCING, SYNCED, STATE_CHANGE];
_fn = function(event) {
  return SyncMachine[event] = function(callback, context) {
    if (context == null) {
      context = this;
    }
    this.on(event, callback, context);
    if (this._syncState === event) {
      return callback.call(context);
    }
  };
};
for (_i = 0, _len = _ref.length; _i < _len; _i++) {
  event = _ref[_i];
  _fn(event);
}

if (typeof Object.freeze === "function") {
  Object.freeze(SyncMachine);
}

module.exports = SyncMachine;

});;loader.register('chaplin/lib/utils', function(e, r, module) {
'use strict';

var support, utils, _,
  __slice = [].slice,
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
  __hasProp = {}.hasOwnProperty;

_ = loader('underscore');

support = loader('chaplin/lib/support');

utils = {
  beget: (function() {
    var ctor;
    if (typeof Object.create === 'function') {
      return Object.create;
    } else {
      ctor = function() {};
      return function(obj) {
        ctor.prototype = obj;
        return new ctor;
      };
    }
  })(),
  indexOf: (function() {
    if (Array.prototype.indexOf) {
      return function(list, index) {
        return list.indexOf(index);
      };
    } else if (_.indexOf) {
      return _.indexOf;
    }
  })(),
  isArray: Array.isArray || _.isArray,
  serialize: function(data) {
    if (typeof data.serialize === 'function') {
      return data.serialize();
    } else if (typeof data.toJSON === 'function') {
      return data.toJSON();
    } else {
      throw new TypeError('utils.serialize: Unknown data was passed');
    }
  },
  readonly: (function() {
    var readonlyDescriptor;
    if (support.propertyDescriptors) {
      readonlyDescriptor = {
        writable: false,
        enumerable: true,
        configurable: false
      };
      return function() {
        var obj, prop, properties, _i, _len;
        obj = arguments[0], properties = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
        for (_i = 0, _len = properties.length; _i < _len; _i++) {
          prop = properties[_i];
          readonlyDescriptor.value = obj[prop];
          Object.defineProperty(obj, prop, readonlyDescriptor);
        }
        return true;
      };
    } else {
      return function() {
        return false;
      };
    }
  })(),
  getPrototypeChain: function(object) {
    var chain, _ref, _ref1, _ref2;
    chain = [object.constructor.prototype];
    while (object = (_ref = (_ref1 = object.constructor) != null ? _ref1.__super__ : void 0) != null ? _ref : (_ref2 = object.constructor) != null ? _ref2.superclass : void 0) {
      chain.push(object);
    }
    return chain.reverse();
  },
  getAllPropertyVersions: function(object, property) {
    var proto, result, value, _i, _len, _ref;
    result = [];
    _ref = utils.getPrototypeChain(object);
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      proto = _ref[_i];
      value = proto[property];
      if (value && __indexOf.call(result, value) < 0) {
        result.push(value);
      }
    }
    return result;
  },
  upcase: function(str) {
    return str.charAt(0).toUpperCase() + str.substring(1);
  },
  escapeRegExp: function(str) {
    return String(str || '').replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
  },
  modifierKeyPressed: function(event) {
    return event.shiftKey || event.altKey || event.ctrlKey || event.metaKey;
  },
  reverse: function(criteria, params, query) {
    return loader('chaplin/mediator').execute('router:reverse', criteria, params, query);
  },
  redirectTo: function(pathDesc, params, options) {
    return loader('chaplin/mediator').execute('router:route', pathDesc, params, options);
  },
  queryParams: {
    stringify: function(queryParams) {
      var arrParam, encodedKey, key, query, stringifyKeyValuePair, value, _i, _len;
      query = '';
      stringifyKeyValuePair = function(encodedKey, value) {
        if (value != null) {
          return '&' + encodedKey + '=' + encodeURIComponent(value);
        } else {
          return '';
        }
      };
      for (key in queryParams) {
        if (!__hasProp.call(queryParams, key)) continue;
        value = queryParams[key];
        encodedKey = encodeURIComponent(key);
        if (utils.isArray(value)) {
          for (_i = 0, _len = value.length; _i < _len; _i++) {
            arrParam = value[_i];
            query += stringifyKeyValuePair(encodedKey, arrParam);
          }
        } else {
          query += stringifyKeyValuePair(encodedKey, value);
        }
      }
      return query && query.substring(1);
    },
    parse: function(queryString) {
      var current, field, pair, pairs, params, value, _i, _len, _ref;
      params = {};
      if (!queryString) {
        return params;
      }
      pairs = queryString.split('&');
      for (_i = 0, _len = pairs.length; _i < _len; _i++) {
        pair = pairs[_i];
        if (!pair.length) {
          continue;
        }
        _ref = pair.split('='), field = _ref[0], value = _ref[1];
        if (!field.length) {
          continue;
        }
        field = decodeURIComponent(field);
        value = decodeURIComponent(value);
        current = params[field];
        if (current) {
          if (current.push) {
            current.push(value);
          } else {
            params[field] = [current, value];
          }
        } else {
          params[field] = value;
        }
      }
      return params;
    }
  }
};

if (typeof Object.seal === "function") {
  Object.seal(utils);
}

module.exports = utils;

});;loader.register('chaplin', function(e, r, module) {

module.exports = {
  Application: loader('chaplin/application'),
  mediator: loader('chaplin/mediator'),
  Dispatcher: loader('chaplin/dispatcher'),
  Controller: loader('chaplin/controllers/controller'),
  Composer: loader('chaplin/composer'),
  Composition: loader('chaplin/lib/composition'),
  Collection: loader('chaplin/models/collection'),
  Model: loader('chaplin/models/model'),
  Layout: loader('chaplin/views/layout'),
  View: loader('chaplin/views/view'),
  CollectionView: loader('chaplin/views/collection_view'),
  Route: loader('chaplin/lib/route'),
  Router: loader('chaplin/lib/router'),
  EventBroker: loader('chaplin/lib/event_broker'),
  support: loader('chaplin/lib/support'),
  SyncMachine: loader('chaplin/lib/sync_machine'),
  utils: loader('chaplin/lib/utils')
};

});
var regDeps = function(Backbone, _) {
  loader.register('backbone', function(exports, require, module) {
    module.exports = Backbone;
  });
  loader.register('underscore', function(exports, require, module) {
    module.exports = _;
  });
};

if (typeof define === 'function' && define.amd) {
  define(['backbone', 'underscore'], function(Backbone, _) {
    regDeps(Backbone, _);
    return loader('chaplin');
  });
} else if (typeof module === 'object' && module && module.exports) {
  regDeps(require('backbone'), require('underscore'));
  module.exports = loader('chaplin');
} else if (typeof require === 'function') {
  regDeps(window.Backbone, window._ || window.Backbone.utils);
  window.Chaplin = loader('chaplin');
} else {
  throw new Error('Chaplin requires Common.js or AMD modules');
}

})();
},{"backbone":772,"underscore":783}],774:[function(require,module,exports){
/*!
 * jQuery JavaScript Library v1.11.0
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-01-23T21:02Z
 */

(function( global, factory ) {

	if ( typeof module === "object" && typeof module.exports === "object" ) {
		// For CommonJS and CommonJS-like environments where a proper window is present,
		// execute the factory and get jQuery
		// For environments that do not inherently posses a window with a document
		// (such as Node.js), expose a jQuery-making factory as module.exports
		// This accentuates the need for the creation of a real window
		// e.g. var jQuery = require("jquery")(window);
		// See ticket #14549 for more info
		module.exports = global.document ?
			factory( global, true ) :
			function( w ) {
				if ( !w.document ) {
					throw new Error( "jQuery requires a window with a document" );
				}
				return factory( w );
			};
	} else {
		factory( global );
	}

// Pass this if window is not defined yet
}(typeof window !== "undefined" ? window : this, function( window, noGlobal ) {

// Can't do this because several apps including ASP.NET trace
// the stack via arguments.caller.callee and Firefox dies if
// you try to trace through "use strict" call chains. (#13335)
// Support: Firefox 18+
//

var deletedIds = [];

var slice = deletedIds.slice;

var concat = deletedIds.concat;

var push = deletedIds.push;

var indexOf = deletedIds.indexOf;

var class2type = {};

var toString = class2type.toString;

var hasOwn = class2type.hasOwnProperty;

var trim = "".trim;

var support = {};



var
	version = "1.11.0",

	// Define a local copy of jQuery
	jQuery = function( selector, context ) {
		// The jQuery object is actually just the init constructor 'enhanced'
		// Need init if jQuery is called (just allow error to be thrown if not included)
		return new jQuery.fn.init( selector, context );
	},

	// Make sure we trim BOM and NBSP (here's looking at you, Safari 5.0 and IE)
	rtrim = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,

	// Matches dashed string for camelizing
	rmsPrefix = /^-ms-/,
	rdashAlpha = /-([\da-z])/gi,

	// Used by jQuery.camelCase as callback to replace()
	fcamelCase = function( all, letter ) {
		return letter.toUpperCase();
	};

jQuery.fn = jQuery.prototype = {
	// The current version of jQuery being used
	jquery: version,

	constructor: jQuery,

	// Start with an empty selector
	selector: "",

	// The default length of a jQuery object is 0
	length: 0,

	toArray: function() {
		return slice.call( this );
	},

	// Get the Nth element in the matched element set OR
	// Get the whole matched element set as a clean array
	get: function( num ) {
		return num != null ?

			// Return a 'clean' array
			( num < 0 ? this[ num + this.length ] : this[ num ] ) :

			// Return just the object
			slice.call( this );
	},

	// Take an array of elements and push it onto the stack
	// (returning the new matched element set)
	pushStack: function( elems ) {

		// Build a new jQuery matched element set
		var ret = jQuery.merge( this.constructor(), elems );

		// Add the old object onto the stack (as a reference)
		ret.prevObject = this;
		ret.context = this.context;

		// Return the newly-formed element set
		return ret;
	},

	// Execute a callback for every element in the matched set.
	// (You can seed the arguments with an array of args, but this is
	// only used internally.)
	each: function( callback, args ) {
		return jQuery.each( this, callback, args );
	},

	map: function( callback ) {
		return this.pushStack( jQuery.map(this, function( elem, i ) {
			return callback.call( elem, i, elem );
		}));
	},

	slice: function() {
		return this.pushStack( slice.apply( this, arguments ) );
	},

	first: function() {
		return this.eq( 0 );
	},

	last: function() {
		return this.eq( -1 );
	},

	eq: function( i ) {
		var len = this.length,
			j = +i + ( i < 0 ? len : 0 );
		return this.pushStack( j >= 0 && j < len ? [ this[j] ] : [] );
	},

	end: function() {
		return this.prevObject || this.constructor(null);
	},

	// For internal use only.
	// Behaves like an Array's method, not like a jQuery method.
	push: push,
	sort: deletedIds.sort,
	splice: deletedIds.splice
};

jQuery.extend = jQuery.fn.extend = function() {
	var src, copyIsArray, copy, name, options, clone,
		target = arguments[0] || {},
		i = 1,
		length = arguments.length,
		deep = false;

	// Handle a deep copy situation
	if ( typeof target === "boolean" ) {
		deep = target;

		// skip the boolean and the target
		target = arguments[ i ] || {};
		i++;
	}

	// Handle case when target is a string or something (possible in deep copy)
	if ( typeof target !== "object" && !jQuery.isFunction(target) ) {
		target = {};
	}

	// extend jQuery itself if only one argument is passed
	if ( i === length ) {
		target = this;
		i--;
	}

	for ( ; i < length; i++ ) {
		// Only deal with non-null/undefined values
		if ( (options = arguments[ i ]) != null ) {
			// Extend the base object
			for ( name in options ) {
				src = target[ name ];
				copy = options[ name ];

				// Prevent never-ending loop
				if ( target === copy ) {
					continue;
				}

				// Recurse if we're merging plain objects or arrays
				if ( deep && copy && ( jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)) ) ) {
					if ( copyIsArray ) {
						copyIsArray = false;
						clone = src && jQuery.isArray(src) ? src : [];

					} else {
						clone = src && jQuery.isPlainObject(src) ? src : {};
					}

					// Never move original objects, clone them
					target[ name ] = jQuery.extend( deep, clone, copy );

				// Don't bring in undefined values
				} else if ( copy !== undefined ) {
					target[ name ] = copy;
				}
			}
		}
	}

	// Return the modified object
	return target;
};

jQuery.extend({
	// Unique for each copy of jQuery on the page
	expando: "jQuery" + ( version + Math.random() ).replace( /\D/g, "" ),

	// Assume jQuery is ready without the ready module
	isReady: true,

	error: function( msg ) {
		throw new Error( msg );
	},

	noop: function() {},

	// See test/unit/core.js for details concerning isFunction.
	// Since version 1.3, DOM methods and functions like alert
	// aren't supported. They return false on IE (#2968).
	isFunction: function( obj ) {
		return jQuery.type(obj) === "function";
	},

	isArray: Array.isArray || function( obj ) {
		return jQuery.type(obj) === "array";
	},

	isWindow: function( obj ) {
		/* jshint eqeqeq: false */
		return obj != null && obj == obj.window;
	},

	isNumeric: function( obj ) {
		// parseFloat NaNs numeric-cast false positives (null|true|false|"")
		// ...but misinterprets leading-number strings, particularly hex literals ("0x...")
		// subtraction forces infinities to NaN
		return obj - parseFloat( obj ) >= 0;
	},

	isEmptyObject: function( obj ) {
		var name;
		for ( name in obj ) {
			return false;
		}
		return true;
	},

	isPlainObject: function( obj ) {
		var key;

		// Must be an Object.
		// Because of IE, we also have to check the presence of the constructor property.
		// Make sure that DOM nodes and window objects don't pass through, as well
		if ( !obj || jQuery.type(obj) !== "object" || obj.nodeType || jQuery.isWindow( obj ) ) {
			return false;
		}

		try {
			// Not own constructor property must be Object
			if ( obj.constructor &&
				!hasOwn.call(obj, "constructor") &&
				!hasOwn.call(obj.constructor.prototype, "isPrototypeOf") ) {
				return false;
			}
		} catch ( e ) {
			// IE8,9 Will throw exceptions on certain host objects #9897
			return false;
		}

		// Support: IE<9
		// Handle iteration over inherited properties before own properties.
		if ( support.ownLast ) {
			for ( key in obj ) {
				return hasOwn.call( obj, key );
			}
		}

		// Own properties are enumerated firstly, so to speed up,
		// if last one is own, then all properties are own.
		for ( key in obj ) {}

		return key === undefined || hasOwn.call( obj, key );
	},

	type: function( obj ) {
		if ( obj == null ) {
			return obj + "";
		}
		return typeof obj === "object" || typeof obj === "function" ?
			class2type[ toString.call(obj) ] || "object" :
			typeof obj;
	},

	// Evaluates a script in a global context
	// Workarounds based on findings by Jim Driscoll
	// http://weblogs.java.net/blog/driscoll/archive/2009/09/08/eval-javascript-global-context
	globalEval: function( data ) {
		if ( data && jQuery.trim( data ) ) {
			// We use execScript on Internet Explorer
			// We use an anonymous function so that context is window
			// rather than jQuery in Firefox
			( window.execScript || function( data ) {
				window[ "eval" ].call( window, data );
			} )( data );
		}
	},

	// Convert dashed to camelCase; used by the css and data modules
	// Microsoft forgot to hump their vendor prefix (#9572)
	camelCase: function( string ) {
		return string.replace( rmsPrefix, "ms-" ).replace( rdashAlpha, fcamelCase );
	},

	nodeName: function( elem, name ) {
		return elem.nodeName && elem.nodeName.toLowerCase() === name.toLowerCase();
	},

	// args is for internal usage only
	each: function( obj, callback, args ) {
		var value,
			i = 0,
			length = obj.length,
			isArray = isArraylike( obj );

		if ( args ) {
			if ( isArray ) {
				for ( ; i < length; i++ ) {
					value = callback.apply( obj[ i ], args );

					if ( value === false ) {
						break;
					}
				}
			} else {
				for ( i in obj ) {
					value = callback.apply( obj[ i ], args );

					if ( value === false ) {
						break;
					}
				}
			}

		// A special, fast, case for the most common use of each
		} else {
			if ( isArray ) {
				for ( ; i < length; i++ ) {
					value = callback.call( obj[ i ], i, obj[ i ] );

					if ( value === false ) {
						break;
					}
				}
			} else {
				for ( i in obj ) {
					value = callback.call( obj[ i ], i, obj[ i ] );

					if ( value === false ) {
						break;
					}
				}
			}
		}

		return obj;
	},

	// Use native String.trim function wherever possible
	trim: trim && !trim.call("\uFEFF\xA0") ?
		function( text ) {
			return text == null ?
				"" :
				trim.call( text );
		} :

		// Otherwise use our own trimming functionality
		function( text ) {
			return text == null ?
				"" :
				( text + "" ).replace( rtrim, "" );
		},

	// results is for internal usage only
	makeArray: function( arr, results ) {
		var ret = results || [];

		if ( arr != null ) {
			if ( isArraylike( Object(arr) ) ) {
				jQuery.merge( ret,
					typeof arr === "string" ?
					[ arr ] : arr
				);
			} else {
				push.call( ret, arr );
			}
		}

		return ret;
	},

	inArray: function( elem, arr, i ) {
		var len;

		if ( arr ) {
			if ( indexOf ) {
				return indexOf.call( arr, elem, i );
			}

			len = arr.length;
			i = i ? i < 0 ? Math.max( 0, len + i ) : i : 0;

			for ( ; i < len; i++ ) {
				// Skip accessing in sparse arrays
				if ( i in arr && arr[ i ] === elem ) {
					return i;
				}
			}
		}

		return -1;
	},

	merge: function( first, second ) {
		var len = +second.length,
			j = 0,
			i = first.length;

		while ( j < len ) {
			first[ i++ ] = second[ j++ ];
		}

		// Support: IE<9
		// Workaround casting of .length to NaN on otherwise arraylike objects (e.g., NodeLists)
		if ( len !== len ) {
			while ( second[j] !== undefined ) {
				first[ i++ ] = second[ j++ ];
			}
		}

		first.length = i;

		return first;
	},

	grep: function( elems, callback, invert ) {
		var callbackInverse,
			matches = [],
			i = 0,
			length = elems.length,
			callbackExpect = !invert;

		// Go through the array, only saving the items
		// that pass the validator function
		for ( ; i < length; i++ ) {
			callbackInverse = !callback( elems[ i ], i );
			if ( callbackInverse !== callbackExpect ) {
				matches.push( elems[ i ] );
			}
		}

		return matches;
	},

	// arg is for internal usage only
	map: function( elems, callback, arg ) {
		var value,
			i = 0,
			length = elems.length,
			isArray = isArraylike( elems ),
			ret = [];

		// Go through the array, translating each of the items to their new values
		if ( isArray ) {
			for ( ; i < length; i++ ) {
				value = callback( elems[ i ], i, arg );

				if ( value != null ) {
					ret.push( value );
				}
			}

		// Go through every key on the object,
		} else {
			for ( i in elems ) {
				value = callback( elems[ i ], i, arg );

				if ( value != null ) {
					ret.push( value );
				}
			}
		}

		// Flatten any nested arrays
		return concat.apply( [], ret );
	},

	// A global GUID counter for objects
	guid: 1,

	// Bind a function to a context, optionally partially applying any
	// arguments.
	proxy: function( fn, context ) {
		var args, proxy, tmp;

		if ( typeof context === "string" ) {
			tmp = fn[ context ];
			context = fn;
			fn = tmp;
		}

		// Quick check to determine if target is callable, in the spec
		// this throws a TypeError, but we will just return undefined.
		if ( !jQuery.isFunction( fn ) ) {
			return undefined;
		}

		// Simulated bind
		args = slice.call( arguments, 2 );
		proxy = function() {
			return fn.apply( context || this, args.concat( slice.call( arguments ) ) );
		};

		// Set the guid of unique handler to the same of original handler, so it can be removed
		proxy.guid = fn.guid = fn.guid || jQuery.guid++;

		return proxy;
	},

	now: function() {
		return +( new Date() );
	},

	// jQuery.support is not used in Core but other projects attach their
	// properties to it so it needs to exist.
	support: support
});

// Populate the class2type map
jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function(i, name) {
	class2type[ "[object " + name + "]" ] = name.toLowerCase();
});

function isArraylike( obj ) {
	var length = obj.length,
		type = jQuery.type( obj );

	if ( type === "function" || jQuery.isWindow( obj ) ) {
		return false;
	}

	if ( obj.nodeType === 1 && length ) {
		return true;
	}

	return type === "array" || length === 0 ||
		typeof length === "number" && length > 0 && ( length - 1 ) in obj;
}
var Sizzle =
/*!
 * Sizzle CSS Selector Engine v1.10.16
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-01-13
 */
(function( window ) {

var i,
	support,
	Expr,
	getText,
	isXML,
	compile,
	outermostContext,
	sortInput,
	hasDuplicate,

	// Local document vars
	setDocument,
	document,
	docElem,
	documentIsHTML,
	rbuggyQSA,
	rbuggyMatches,
	matches,
	contains,

	// Instance-specific data
	expando = "sizzle" + -(new Date()),
	preferredDoc = window.document,
	dirruns = 0,
	done = 0,
	classCache = createCache(),
	tokenCache = createCache(),
	compilerCache = createCache(),
	sortOrder = function( a, b ) {
		if ( a === b ) {
			hasDuplicate = true;
		}
		return 0;
	},

	// General-purpose constants
	strundefined = typeof undefined,
	MAX_NEGATIVE = 1 << 31,

	// Instance methods
	hasOwn = ({}).hasOwnProperty,
	arr = [],
	pop = arr.pop,
	push_native = arr.push,
	push = arr.push,
	slice = arr.slice,
	// Use a stripped-down indexOf if we can't use a native one
	indexOf = arr.indexOf || function( elem ) {
		var i = 0,
			len = this.length;
		for ( ; i < len; i++ ) {
			if ( this[i] === elem ) {
				return i;
			}
		}
		return -1;
	},

	booleans = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",

	// Regular expressions

	// Whitespace characters http://www.w3.org/TR/css3-selectors/#whitespace
	whitespace = "[\\x20\\t\\r\\n\\f]",
	// http://www.w3.org/TR/css3-syntax/#characters
	characterEncoding = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",

	// Loosely modeled on CSS identifier characters
	// An unquoted value should be a CSS identifier http://www.w3.org/TR/css3-selectors/#attribute-selectors
	// Proper syntax: http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier
	identifier = characterEncoding.replace( "w", "w#" ),

	// Acceptable operators http://www.w3.org/TR/selectors/#attribute-selectors
	attributes = "\\[" + whitespace + "*(" + characterEncoding + ")" + whitespace +
		"*(?:([*^$|!~]?=)" + whitespace + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + identifier + ")|)|)" + whitespace + "*\\]",

	// Prefer arguments quoted,
	//   then not containing pseudos/brackets,
	//   then attribute selectors/non-parenthetical expressions,
	//   then anything else
	// These preferences are here to reduce the number of selectors
	//   needing tokenize in the PSEUDO preFilter
	pseudos = ":(" + characterEncoding + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + attributes.replace( 3, 8 ) + ")*)|.*)\\)|)",

	// Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter
	rtrim = new RegExp( "^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g" ),

	rcomma = new RegExp( "^" + whitespace + "*," + whitespace + "*" ),
	rcombinators = new RegExp( "^" + whitespace + "*([>+~]|" + whitespace + ")" + whitespace + "*" ),

	rattributeQuotes = new RegExp( "=" + whitespace + "*([^\\]'\"]*?)" + whitespace + "*\\]", "g" ),

	rpseudo = new RegExp( pseudos ),
	ridentifier = new RegExp( "^" + identifier + "$" ),

	matchExpr = {
		"ID": new RegExp( "^#(" + characterEncoding + ")" ),
		"CLASS": new RegExp( "^\\.(" + characterEncoding + ")" ),
		"TAG": new RegExp( "^(" + characterEncoding.replace( "w", "w*" ) + ")" ),
		"ATTR": new RegExp( "^" + attributes ),
		"PSEUDO": new RegExp( "^" + pseudos ),
		"CHILD": new RegExp( "^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + whitespace +
			"*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace +
			"*(\\d+)|))" + whitespace + "*\\)|)", "i" ),
		"bool": new RegExp( "^(?:" + booleans + ")$", "i" ),
		// For use in libraries implementing .is()
		// We use this for POS matching in `select`
		"needsContext": new RegExp( "^" + whitespace + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" +
			whitespace + "*((?:-\\d)?\\d*)" + whitespace + "*\\)|)(?=[^-]|$)", "i" )
	},

	rinputs = /^(?:input|select|textarea|button)$/i,
	rheader = /^h\d$/i,

	rnative = /^[^{]+\{\s*\[native \w/,

	// Easily-parseable/retrievable ID or TAG or CLASS selectors
	rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,

	rsibling = /[+~]/,
	rescape = /'|\\/g,

	// CSS escapes http://www.w3.org/TR/CSS21/syndata.html#escaped-characters
	runescape = new RegExp( "\\\\([\\da-f]{1,6}" + whitespace + "?|(" + whitespace + ")|.)", "ig" ),
	funescape = function( _, escaped, escapedWhitespace ) {
		var high = "0x" + escaped - 0x10000;
		// NaN means non-codepoint
		// Support: Firefox
		// Workaround erroneous numeric interpretation of +"0x"
		return high !== high || escapedWhitespace ?
			escaped :
			high < 0 ?
				// BMP codepoint
				String.fromCharCode( high + 0x10000 ) :
				// Supplemental Plane codepoint (surrogate pair)
				String.fromCharCode( high >> 10 | 0xD800, high & 0x3FF | 0xDC00 );
	};

// Optimize for push.apply( _, NodeList )
try {
	push.apply(
		(arr = slice.call( preferredDoc.childNodes )),
		preferredDoc.childNodes
	);
	// Support: Android<4.0
	// Detect silently failing push.apply
	arr[ preferredDoc.childNodes.length ].nodeType;
} catch ( e ) {
	push = { apply: arr.length ?

		// Leverage slice if possible
		function( target, els ) {
			push_native.apply( target, slice.call(els) );
		} :

		// Support: IE<9
		// Otherwise append directly
		function( target, els ) {
			var j = target.length,
				i = 0;
			// Can't trust NodeList.length
			while ( (target[j++] = els[i++]) ) {}
			target.length = j - 1;
		}
	};
}

function Sizzle( selector, context, results, seed ) {
	var match, elem, m, nodeType,
		// QSA vars
		i, groups, old, nid, newContext, newSelector;

	if ( ( context ? context.ownerDocument || context : preferredDoc ) !== document ) {
		setDocument( context );
	}

	context = context || document;
	results = results || [];

	if ( !selector || typeof selector !== "string" ) {
		return results;
	}

	if ( (nodeType = context.nodeType) !== 1 && nodeType !== 9 ) {
		return [];
	}

	if ( documentIsHTML && !seed ) {

		// Shortcuts
		if ( (match = rquickExpr.exec( selector )) ) {
			// Speed-up: Sizzle("#ID")
			if ( (m = match[1]) ) {
				if ( nodeType === 9 ) {
					elem = context.getElementById( m );
					// Check parentNode to catch when Blackberry 4.6 returns
					// nodes that are no longer in the document (jQuery #6963)
					if ( elem && elem.parentNode ) {
						// Handle the case where IE, Opera, and Webkit return items
						// by name instead of ID
						if ( elem.id === m ) {
							results.push( elem );
							return results;
						}
					} else {
						return results;
					}
				} else {
					// Context is not a document
					if ( context.ownerDocument && (elem = context.ownerDocument.getElementById( m )) &&
						contains( context, elem ) && elem.id === m ) {
						results.push( elem );
						return results;
					}
				}

			// Speed-up: Sizzle("TAG")
			} else if ( match[2] ) {
				push.apply( results, context.getElementsByTagName( selector ) );
				return results;

			// Speed-up: Sizzle(".CLASS")
			} else if ( (m = match[3]) && support.getElementsByClassName && context.getElementsByClassName ) {
				push.apply( results, context.getElementsByClassName( m ) );
				return results;
			}
		}

		// QSA path
		if ( support.qsa && (!rbuggyQSA || !rbuggyQSA.test( selector )) ) {
			nid = old = expando;
			newContext = context;
			newSelector = nodeType === 9 && selector;

			// qSA works strangely on Element-rooted queries
			// We can work around this by specifying an extra ID on the root
			// and working up from there (Thanks to Andrew Dupont for the technique)
			// IE 8 doesn't work on object elements
			if ( nodeType === 1 && context.nodeName.toLowerCase() !== "object" ) {
				groups = tokenize( selector );

				if ( (old = context.getAttribute("id")) ) {
					nid = old.replace( rescape, "\\$&" );
				} else {
					context.setAttribute( "id", nid );
				}
				nid = "[id='" + nid + "'] ";

				i = groups.length;
				while ( i-- ) {
					groups[i] = nid + toSelector( groups[i] );
				}
				newContext = rsibling.test( selector ) && testContext( context.parentNode ) || context;
				newSelector = groups.join(",");
			}

			if ( newSelector ) {
				try {
					push.apply( results,
						newContext.querySelectorAll( newSelector )
					);
					return results;
				} catch(qsaError) {
				} finally {
					if ( !old ) {
						context.removeAttribute("id");
					}
				}
			}
		}
	}

	// All others
	return select( selector.replace( rtrim, "$1" ), context, results, seed );
}

/**
 * Create key-value caches of limited size
 * @returns {Function(string, Object)} Returns the Object data after storing it on itself with
 *	property name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)
 *	deleting the oldest entry
 */
function createCache() {
	var keys = [];

	function cache( key, value ) {
		// Use (key + " ") to avoid collision with native prototype properties (see Issue #157)
		if ( keys.push( key + " " ) > Expr.cacheLength ) {
			// Only keep the most recent entries
			delete cache[ keys.shift() ];
		}
		return (cache[ key + " " ] = value);
	}
	return cache;
}

/**
 * Mark a function for special use by Sizzle
 * @param {Function} fn The function to mark
 */
function markFunction( fn ) {
	fn[ expando ] = true;
	return fn;
}

/**
 * Support testing using an element
 * @param {Function} fn Passed the created div and expects a boolean result
 */
function assert( fn ) {
	var div = document.createElement("div");

	try {
		return !!fn( div );
	} catch (e) {
		return false;
	} finally {
		// Remove from its parent by default
		if ( div.parentNode ) {
			div.parentNode.removeChild( div );
		}
		// release memory in IE
		div = null;
	}
}

/**
 * Adds the same handler for all of the specified attrs
 * @param {String} attrs Pipe-separated list of attributes
 * @param {Function} handler The method that will be applied
 */
function addHandle( attrs, handler ) {
	var arr = attrs.split("|"),
		i = attrs.length;

	while ( i-- ) {
		Expr.attrHandle[ arr[i] ] = handler;
	}
}

/**
 * Checks document order of two siblings
 * @param {Element} a
 * @param {Element} b
 * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b
 */
function siblingCheck( a, b ) {
	var cur = b && a,
		diff = cur && a.nodeType === 1 && b.nodeType === 1 &&
			( ~b.sourceIndex || MAX_NEGATIVE ) -
			( ~a.sourceIndex || MAX_NEGATIVE );

	// Use IE sourceIndex if available on both nodes
	if ( diff ) {
		return diff;
	}

	// Check if b follows a
	if ( cur ) {
		while ( (cur = cur.nextSibling) ) {
			if ( cur === b ) {
				return -1;
			}
		}
	}

	return a ? 1 : -1;
}

/**
 * Returns a function to use in pseudos for input types
 * @param {String} type
 */
function createInputPseudo( type ) {
	return function( elem ) {
		var name = elem.nodeName.toLowerCase();
		return name === "input" && elem.type === type;
	};
}

/**
 * Returns a function to use in pseudos for buttons
 * @param {String} type
 */
function createButtonPseudo( type ) {
	return function( elem ) {
		var name = elem.nodeName.toLowerCase();
		return (name === "input" || name === "button") && elem.type === type;
	};
}

/**
 * Returns a function to use in pseudos for positionals
 * @param {Function} fn
 */
function createPositionalPseudo( fn ) {
	return markFunction(function( argument ) {
		argument = +argument;
		return markFunction(function( seed, matches ) {
			var j,
				matchIndexes = fn( [], seed.length, argument ),
				i = matchIndexes.length;

			// Match elements found at the specified indexes
			while ( i-- ) {
				if ( seed[ (j = matchIndexes[i]) ] ) {
					seed[j] = !(matches[j] = seed[j]);
				}
			}
		});
	});
}

/**
 * Checks a node for validity as a Sizzle context
 * @param {Element|Object=} context
 * @returns {Element|Object|Boolean} The input node if acceptable, otherwise a falsy value
 */
function testContext( context ) {
	return context && typeof context.getElementsByTagName !== strundefined && context;
}

// Expose support vars for convenience
support = Sizzle.support = {};

/**
 * Detects XML nodes
 * @param {Element|Object} elem An element or a document
 * @returns {Boolean} True iff elem is a non-HTML XML node
 */
isXML = Sizzle.isXML = function( elem ) {
	// documentElement is verified for cases where it doesn't yet exist
	// (such as loading iframes in IE - #4833)
	var documentElement = elem && (elem.ownerDocument || elem).documentElement;
	return documentElement ? documentElement.nodeName !== "HTML" : false;
};

/**
 * Sets document-related variables once based on the current document
 * @param {Element|Object} [doc] An element or document object to use to set the document
 * @returns {Object} Returns the current document
 */
setDocument = Sizzle.setDocument = function( node ) {
	var hasCompare,
		doc = node ? node.ownerDocument || node : preferredDoc,
		parent = doc.defaultView;

	// If no document and documentElement is available, return
	if ( doc === document || doc.nodeType !== 9 || !doc.documentElement ) {
		return document;
	}

	// Set our document
	document = doc;
	docElem = doc.documentElement;

	// Support tests
	documentIsHTML = !isXML( doc );

	// Support: IE>8
	// If iframe document is assigned to "document" variable and if iframe has been reloaded,
	// IE will throw "permission denied" error when accessing "document" variable, see jQuery #13936
	// IE6-8 do not support the defaultView property so parent will be undefined
	if ( parent && parent !== parent.top ) {
		// IE11 does not have attachEvent, so all must suffer
		if ( parent.addEventListener ) {
			parent.addEventListener( "unload", function() {
				setDocument();
			}, false );
		} else if ( parent.attachEvent ) {
			parent.attachEvent( "onunload", function() {
				setDocument();
			});
		}
	}

	/* Attributes
	---------------------------------------------------------------------- */

	// Support: IE<8
	// Verify that getAttribute really returns attributes and not properties (excepting IE8 booleans)
	support.attributes = assert(function( div ) {
		div.className = "i";
		return !div.getAttribute("className");
	});

	/* getElement(s)By*
	---------------------------------------------------------------------- */

	// Check if getElementsByTagName("*") returns only elements
	support.getElementsByTagName = assert(function( div ) {
		div.appendChild( doc.createComment("") );
		return !div.getElementsByTagName("*").length;
	});

	// Check if getElementsByClassName can be trusted
	support.getElementsByClassName = rnative.test( doc.getElementsByClassName ) && assert(function( div ) {
		div.innerHTML = "<div class='a'></div><div class='a i'></div>";

		// Support: Safari<4
		// Catch class over-caching
		div.firstChild.className = "i";
		// Support: Opera<10
		// Catch gEBCN failure to find non-leading classes
		return div.getElementsByClassName("i").length === 2;
	});

	// Support: IE<10
	// Check if getElementById returns elements by name
	// The broken getElementById methods don't pick up programatically-set names,
	// so use a roundabout getElementsByName test
	support.getById = assert(function( div ) {
		docElem.appendChild( div ).id = expando;
		return !doc.getElementsByName || !doc.getElementsByName( expando ).length;
	});

	// ID find and filter
	if ( support.getById ) {
		Expr.find["ID"] = function( id, context ) {
			if ( typeof context.getElementById !== strundefined && documentIsHTML ) {
				var m = context.getElementById( id );
				// Check parentNode to catch when Blackberry 4.6 returns
				// nodes that are no longer in the document #6963
				return m && m.parentNode ? [m] : [];
			}
		};
		Expr.filter["ID"] = function( id ) {
			var attrId = id.replace( runescape, funescape );
			return function( elem ) {
				return elem.getAttribute("id") === attrId;
			};
		};
	} else {
		// Support: IE6/7
		// getElementById is not reliable as a find shortcut
		delete Expr.find["ID"];

		Expr.filter["ID"] =  function( id ) {
			var attrId = id.replace( runescape, funescape );
			return function( elem ) {
				var node = typeof elem.getAttributeNode !== strundefined && elem.getAttributeNode("id");
				return node && node.value === attrId;
			};
		};
	}

	// Tag
	Expr.find["TAG"] = support.getElementsByTagName ?
		function( tag, context ) {
			if ( typeof context.getElementsByTagName !== strundefined ) {
				return context.getElementsByTagName( tag );
			}
		} :
		function( tag, context ) {
			var elem,
				tmp = [],
				i = 0,
				results = context.getElementsByTagName( tag );

			// Filter out possible comments
			if ( tag === "*" ) {
				while ( (elem = results[i++]) ) {
					if ( elem.nodeType === 1 ) {
						tmp.push( elem );
					}
				}

				return tmp;
			}
			return results;
		};

	// Class
	Expr.find["CLASS"] = support.getElementsByClassName && function( className, context ) {
		if ( typeof context.getElementsByClassName !== strundefined && documentIsHTML ) {
			return context.getElementsByClassName( className );
		}
	};

	/* QSA/matchesSelector
	---------------------------------------------------------------------- */

	// QSA and matchesSelector support

	// matchesSelector(:active) reports false when true (IE9/Opera 11.5)
	rbuggyMatches = [];

	// qSa(:focus) reports false when true (Chrome 21)
	// We allow this because of a bug in IE8/9 that throws an error
	// whenever `document.activeElement` is accessed on an iframe
	// So, we allow :focus to pass through QSA all the time to avoid the IE error
	// See http://bugs.jquery.com/ticket/13378
	rbuggyQSA = [];

	if ( (support.qsa = rnative.test( doc.querySelectorAll )) ) {
		// Build QSA regex
		// Regex strategy adopted from Diego Perini
		assert(function( div ) {
			// Select is set to empty string on purpose
			// This is to test IE's treatment of not explicitly
			// setting a boolean content attribute,
			// since its presence should be enough
			// http://bugs.jquery.com/ticket/12359
			div.innerHTML = "<select t=''><option selected=''></option></select>";

			// Support: IE8, Opera 10-12
			// Nothing should be selected when empty strings follow ^= or $= or *=
			if ( div.querySelectorAll("[t^='']").length ) {
				rbuggyQSA.push( "[*^$]=" + whitespace + "*(?:''|\"\")" );
			}

			// Support: IE8
			// Boolean attributes and "value" are not treated correctly
			if ( !div.querySelectorAll("[selected]").length ) {
				rbuggyQSA.push( "\\[" + whitespace + "*(?:value|" + booleans + ")" );
			}

			// Webkit/Opera - :checked should return selected option elements
			// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
			// IE8 throws error here and will not see later tests
			if ( !div.querySelectorAll(":checked").length ) {
				rbuggyQSA.push(":checked");
			}
		});

		assert(function( div ) {
			// Support: Windows 8 Native Apps
			// The type and name attributes are restricted during .innerHTML assignment
			var input = doc.createElement("input");
			input.setAttribute( "type", "hidden" );
			div.appendChild( input ).setAttribute( "name", "D" );

			// Support: IE8
			// Enforce case-sensitivity of name attribute
			if ( div.querySelectorAll("[name=d]").length ) {
				rbuggyQSA.push( "name" + whitespace + "*[*^$|!~]?=" );
			}

			// FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)
			// IE8 throws error here and will not see later tests
			if ( !div.querySelectorAll(":enabled").length ) {
				rbuggyQSA.push( ":enabled", ":disabled" );
			}

			// Opera 10-11 does not throw on post-comma invalid pseudos
			div.querySelectorAll("*,:x");
			rbuggyQSA.push(",.*:");
		});
	}

	if ( (support.matchesSelector = rnative.test( (matches = docElem.webkitMatchesSelector ||
		docElem.mozMatchesSelector ||
		docElem.oMatchesSelector ||
		docElem.msMatchesSelector) )) ) {

		assert(function( div ) {
			// Check to see if it's possible to do matchesSelector
			// on a disconnected node (IE 9)
			support.disconnectedMatch = matches.call( div, "div" );

			// This should fail with an exception
			// Gecko does not error, returns false instead
			matches.call( div, "[s!='']:x" );
			rbuggyMatches.push( "!=", pseudos );
		});
	}

	rbuggyQSA = rbuggyQSA.length && new RegExp( rbuggyQSA.join("|") );
	rbuggyMatches = rbuggyMatches.length && new RegExp( rbuggyMatches.join("|") );

	/* Contains
	---------------------------------------------------------------------- */
	hasCompare = rnative.test( docElem.compareDocumentPosition );

	// Element contains another
	// Purposefully does not implement inclusive descendent
	// As in, an element does not contain itself
	contains = hasCompare || rnative.test( docElem.contains ) ?
		function( a, b ) {
			var adown = a.nodeType === 9 ? a.documentElement : a,
				bup = b && b.parentNode;
			return a === bup || !!( bup && bup.nodeType === 1 && (
				adown.contains ?
					adown.contains( bup ) :
					a.compareDocumentPosition && a.compareDocumentPosition( bup ) & 16
			));
		} :
		function( a, b ) {
			if ( b ) {
				while ( (b = b.parentNode) ) {
					if ( b === a ) {
						return true;
					}
				}
			}
			return false;
		};

	/* Sorting
	---------------------------------------------------------------------- */

	// Document order sorting
	sortOrder = hasCompare ?
	function( a, b ) {

		// Flag for duplicate removal
		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		// Sort on method existence if only one input has compareDocumentPosition
		var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;
		if ( compare ) {
			return compare;
		}

		// Calculate position if both inputs belong to the same document
		compare = ( a.ownerDocument || a ) === ( b.ownerDocument || b ) ?
			a.compareDocumentPosition( b ) :

			// Otherwise we know they are disconnected
			1;

		// Disconnected nodes
		if ( compare & 1 ||
			(!support.sortDetached && b.compareDocumentPosition( a ) === compare) ) {

			// Choose the first element that is related to our preferred document
			if ( a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a) ) {
				return -1;
			}
			if ( b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b) ) {
				return 1;
			}

			// Maintain original order
			return sortInput ?
				( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :
				0;
		}

		return compare & 4 ? -1 : 1;
	} :
	function( a, b ) {
		// Exit early if the nodes are identical
		if ( a === b ) {
			hasDuplicate = true;
			return 0;
		}

		var cur,
			i = 0,
			aup = a.parentNode,
			bup = b.parentNode,
			ap = [ a ],
			bp = [ b ];

		// Parentless nodes are either documents or disconnected
		if ( !aup || !bup ) {
			return a === doc ? -1 :
				b === doc ? 1 :
				aup ? -1 :
				bup ? 1 :
				sortInput ?
				( indexOf.call( sortInput, a ) - indexOf.call( sortInput, b ) ) :
				0;

		// If the nodes are siblings, we can do a quick check
		} else if ( aup === bup ) {
			return siblingCheck( a, b );
		}

		// Otherwise we need full lists of their ancestors for comparison
		cur = a;
		while ( (cur = cur.parentNode) ) {
			ap.unshift( cur );
		}
		cur = b;
		while ( (cur = cur.parentNode) ) {
			bp.unshift( cur );
		}

		// Walk down the tree looking for a discrepancy
		while ( ap[i] === bp[i] ) {
			i++;
		}

		return i ?
			// Do a sibling check if the nodes have a common ancestor
			siblingCheck( ap[i], bp[i] ) :

			// Otherwise nodes in our document sort first
			ap[i] === preferredDoc ? -1 :
			bp[i] === preferredDoc ? 1 :
			0;
	};

	return doc;
};

Sizzle.matches = function( expr, elements ) {
	return Sizzle( expr, null, null, elements );
};

Sizzle.matchesSelector = function( elem, expr ) {
	// Set document vars if needed
	if ( ( elem.ownerDocument || elem ) !== document ) {
		setDocument( elem );
	}

	// Make sure that attribute selectors are quoted
	expr = expr.replace( rattributeQuotes, "='$1']" );

	if ( support.matchesSelector && documentIsHTML &&
		( !rbuggyMatches || !rbuggyMatches.test( expr ) ) &&
		( !rbuggyQSA     || !rbuggyQSA.test( expr ) ) ) {

		try {
			var ret = matches.call( elem, expr );

			// IE 9's matchesSelector returns false on disconnected nodes
			if ( ret || support.disconnectedMatch ||
					// As well, disconnected nodes are said to be in a document
					// fragment in IE 9
					elem.document && elem.document.nodeType !== 11 ) {
				return ret;
			}
		} catch(e) {}
	}

	return Sizzle( expr, document, null, [elem] ).length > 0;
};

Sizzle.contains = function( context, elem ) {
	// Set document vars if needed
	if ( ( context.ownerDocument || context ) !== document ) {
		setDocument( context );
	}
	return contains( context, elem );
};

Sizzle.attr = function( elem, name ) {
	// Set document vars if needed
	if ( ( elem.ownerDocument || elem ) !== document ) {
		setDocument( elem );
	}

	var fn = Expr.attrHandle[ name.toLowerCase() ],
		// Don't get fooled by Object.prototype properties (jQuery #13807)
		val = fn && hasOwn.call( Expr.attrHandle, name.toLowerCase() ) ?
			fn( elem, name, !documentIsHTML ) :
			undefined;

	return val !== undefined ?
		val :
		support.attributes || !documentIsHTML ?
			elem.getAttribute( name ) :
			(val = elem.getAttributeNode(name)) && val.specified ?
				val.value :
				null;
};

Sizzle.error = function( msg ) {
	throw new Error( "Syntax error, unrecognized expression: " + msg );
};

/**
 * Document sorting and removing duplicates
 * @param {ArrayLike} results
 */
Sizzle.uniqueSort = function( results ) {
	var elem,
		duplicates = [],
		j = 0,
		i = 0;

	// Unless we *know* we can detect duplicates, assume their presence
	hasDuplicate = !support.detectDuplicates;
	sortInput = !support.sortStable && results.slice( 0 );
	results.sort( sortOrder );

	if ( hasDuplicate ) {
		while ( (elem = results[i++]) ) {
			if ( elem === results[ i ] ) {
				j = duplicates.push( i );
			}
		}
		while ( j-- ) {
			results.splice( duplicates[ j ], 1 );
		}
	}

	// Clear input after sorting to release objects
	// See https://github.com/jquery/sizzle/pull/225
	sortInput = null;

	return results;
};

/**
 * Utility function for retrieving the text value of an array of DOM nodes
 * @param {Array|Element} elem
 */
getText = Sizzle.getText = function( elem ) {
	var node,
		ret = "",
		i = 0,
		nodeType = elem.nodeType;

	if ( !nodeType ) {
		// If no nodeType, this is expected to be an array
		while ( (node = elem[i++]) ) {
			// Do not traverse comment nodes
			ret += getText( node );
		}
	} else if ( nodeType === 1 || nodeType === 9 || nodeType === 11 ) {
		// Use textContent for elements
		// innerText usage removed for consistency of new lines (jQuery #11153)
		if ( typeof elem.textContent === "string" ) {
			return elem.textContent;
		} else {
			// Traverse its children
			for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
				ret += getText( elem );
			}
		}
	} else if ( nodeType === 3 || nodeType === 4 ) {
		return elem.nodeValue;
	}
	// Do not include comment or processing instruction nodes

	return ret;
};

Expr = Sizzle.selectors = {

	// Can be adjusted by the user
	cacheLength: 50,

	createPseudo: markFunction,

	match: matchExpr,

	attrHandle: {},

	find: {},

	relative: {
		">": { dir: "parentNode", first: true },
		" ": { dir: "parentNode" },
		"+": { dir: "previousSibling", first: true },
		"~": { dir: "previousSibling" }
	},

	preFilter: {
		"ATTR": function( match ) {
			match[1] = match[1].replace( runescape, funescape );

			// Move the given value to match[3] whether quoted or unquoted
			match[3] = ( match[4] || match[5] || "" ).replace( runescape, funescape );

			if ( match[2] === "~=" ) {
				match[3] = " " + match[3] + " ";
			}

			return match.slice( 0, 4 );
		},

		"CHILD": function( match ) {
			/* matches from matchExpr["CHILD"]
				1 type (only|nth|...)
				2 what (child|of-type)
				3 argument (even|odd|\d*|\d*n([+-]\d+)?|...)
				4 xn-component of xn+y argument ([+-]?\d*n|)
				5 sign of xn-component
				6 x of xn-component
				7 sign of y-component
				8 y of y-component
			*/
			match[1] = match[1].toLowerCase();

			if ( match[1].slice( 0, 3 ) === "nth" ) {
				// nth-* requires argument
				if ( !match[3] ) {
					Sizzle.error( match[0] );
				}

				// numeric x and y parameters for Expr.filter.CHILD
				// remember that false/true cast respectively to 0/1
				match[4] = +( match[4] ? match[5] + (match[6] || 1) : 2 * ( match[3] === "even" || match[3] === "odd" ) );
				match[5] = +( ( match[7] + match[8] ) || match[3] === "odd" );

			// other types prohibit arguments
			} else if ( match[3] ) {
				Sizzle.error( match[0] );
			}

			return match;
		},

		"PSEUDO": function( match ) {
			var excess,
				unquoted = !match[5] && match[2];

			if ( matchExpr["CHILD"].test( match[0] ) ) {
				return null;
			}

			// Accept quoted arguments as-is
			if ( match[3] && match[4] !== undefined ) {
				match[2] = match[4];

			// Strip excess characters from unquoted arguments
			} else if ( unquoted && rpseudo.test( unquoted ) &&
				// Get excess from tokenize (recursively)
				(excess = tokenize( unquoted, true )) &&
				// advance to the next closing parenthesis
				(excess = unquoted.indexOf( ")", unquoted.length - excess ) - unquoted.length) ) {

				// excess is a negative index
				match[0] = match[0].slice( 0, excess );
				match[2] = unquoted.slice( 0, excess );
			}

			// Return only captures needed by the pseudo filter method (type and argument)
			return match.slice( 0, 3 );
		}
	},

	filter: {

		"TAG": function( nodeNameSelector ) {
			var nodeName = nodeNameSelector.replace( runescape, funescape ).toLowerCase();
			return nodeNameSelector === "*" ?
				function() { return true; } :
				function( elem ) {
					return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
				};
		},

		"CLASS": function( className ) {
			var pattern = classCache[ className + " " ];

			return pattern ||
				(pattern = new RegExp( "(^|" + whitespace + ")" + className + "(" + whitespace + "|$)" )) &&
				classCache( className, function( elem ) {
					return pattern.test( typeof elem.className === "string" && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute("class") || "" );
				});
		},

		"ATTR": function( name, operator, check ) {
			return function( elem ) {
				var result = Sizzle.attr( elem, name );

				if ( result == null ) {
					return operator === "!=";
				}
				if ( !operator ) {
					return true;
				}

				result += "";

				return operator === "=" ? result === check :
					operator === "!=" ? result !== check :
					operator === "^=" ? check && result.indexOf( check ) === 0 :
					operator === "*=" ? check && result.indexOf( check ) > -1 :
					operator === "$=" ? check && result.slice( -check.length ) === check :
					operator === "~=" ? ( " " + result + " " ).indexOf( check ) > -1 :
					operator === "|=" ? result === check || result.slice( 0, check.length + 1 ) === check + "-" :
					false;
			};
		},

		"CHILD": function( type, what, argument, first, last ) {
			var simple = type.slice( 0, 3 ) !== "nth",
				forward = type.slice( -4 ) !== "last",
				ofType = what === "of-type";

			return first === 1 && last === 0 ?

				// Shortcut for :nth-*(n)
				function( elem ) {
					return !!elem.parentNode;
				} :

				function( elem, context, xml ) {
					var cache, outerCache, node, diff, nodeIndex, start,
						dir = simple !== forward ? "nextSibling" : "previousSibling",
						parent = elem.parentNode,
						name = ofType && elem.nodeName.toLowerCase(),
						useCache = !xml && !ofType;

					if ( parent ) {

						// :(first|last|only)-(child|of-type)
						if ( simple ) {
							while ( dir ) {
								node = elem;
								while ( (node = node[ dir ]) ) {
									if ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) {
										return false;
									}
								}
								// Reverse direction for :only-* (if we haven't yet done so)
								start = dir = type === "only" && !start && "nextSibling";
							}
							return true;
						}

						start = [ forward ? parent.firstChild : parent.lastChild ];

						// non-xml :nth-child(...) stores cache data on `parent`
						if ( forward && useCache ) {
							// Seek `elem` from a previously-cached index
							outerCache = parent[ expando ] || (parent[ expando ] = {});
							cache = outerCache[ type ] || [];
							nodeIndex = cache[0] === dirruns && cache[1];
							diff = cache[0] === dirruns && cache[2];
							node = nodeIndex && parent.childNodes[ nodeIndex ];

							while ( (node = ++nodeIndex && node && node[ dir ] ||

								// Fallback to seeking `elem` from the start
								(diff = nodeIndex = 0) || start.pop()) ) {

								// When found, cache indexes on `parent` and break
								if ( node.nodeType === 1 && ++diff && node === elem ) {
									outerCache[ type ] = [ dirruns, nodeIndex, diff ];
									break;
								}
							}

						// Use previously-cached element index if available
						} else if ( useCache && (cache = (elem[ expando ] || (elem[ expando ] = {}))[ type ]) && cache[0] === dirruns ) {
							diff = cache[1];

						// xml :nth-child(...) or :nth-last-child(...) or :nth(-last)?-of-type(...)
						} else {
							// Use the same loop as above to seek `elem` from the start
							while ( (node = ++nodeIndex && node && node[ dir ] ||
								(diff = nodeIndex = 0) || start.pop()) ) {

								if ( ( ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1 ) && ++diff ) {
									// Cache the index of each encountered element
									if ( useCache ) {
										(node[ expando ] || (node[ expando ] = {}))[ type ] = [ dirruns, diff ];
									}

									if ( node === elem ) {
										break;
									}
								}
							}
						}

						// Incorporate the offset, then check against cycle size
						diff -= last;
						return diff === first || ( diff % first === 0 && diff / first >= 0 );
					}
				};
		},

		"PSEUDO": function( pseudo, argument ) {
			// pseudo-class names are case-insensitive
			// http://www.w3.org/TR/selectors/#pseudo-classes
			// Prioritize by case sensitivity in case custom pseudos are added with uppercase letters
			// Remember that setFilters inherits from pseudos
			var args,
				fn = Expr.pseudos[ pseudo ] || Expr.setFilters[ pseudo.toLowerCase() ] ||
					Sizzle.error( "unsupported pseudo: " + pseudo );

			// The user may use createPseudo to indicate that
			// arguments are needed to create the filter function
			// just as Sizzle does
			if ( fn[ expando ] ) {
				return fn( argument );
			}

			// But maintain support for old signatures
			if ( fn.length > 1 ) {
				args = [ pseudo, pseudo, "", argument ];
				return Expr.setFilters.hasOwnProperty( pseudo.toLowerCase() ) ?
					markFunction(function( seed, matches ) {
						var idx,
							matched = fn( seed, argument ),
							i = matched.length;
						while ( i-- ) {
							idx = indexOf.call( seed, matched[i] );
							seed[ idx ] = !( matches[ idx ] = matched[i] );
						}
					}) :
					function( elem ) {
						return fn( elem, 0, args );
					};
			}

			return fn;
		}
	},

	pseudos: {
		// Potentially complex pseudos
		"not": markFunction(function( selector ) {
			// Trim the selector passed to compile
			// to avoid treating leading and trailing
			// spaces as combinators
			var input = [],
				results = [],
				matcher = compile( selector.replace( rtrim, "$1" ) );

			return matcher[ expando ] ?
				markFunction(function( seed, matches, context, xml ) {
					var elem,
						unmatched = matcher( seed, null, xml, [] ),
						i = seed.length;

					// Match elements unmatched by `matcher`
					while ( i-- ) {
						if ( (elem = unmatched[i]) ) {
							seed[i] = !(matches[i] = elem);
						}
					}
				}) :
				function( elem, context, xml ) {
					input[0] = elem;
					matcher( input, null, xml, results );
					return !results.pop();
				};
		}),

		"has": markFunction(function( selector ) {
			return function( elem ) {
				return Sizzle( selector, elem ).length > 0;
			};
		}),

		"contains": markFunction(function( text ) {
			return function( elem ) {
				return ( elem.textContent || elem.innerText || getText( elem ) ).indexOf( text ) > -1;
			};
		}),

		// "Whether an element is represented by a :lang() selector
		// is based solely on the element's language value
		// being equal to the identifier C,
		// or beginning with the identifier C immediately followed by "-".
		// The matching of C against the element's language value is performed case-insensitively.
		// The identifier C does not have to be a valid language name."
		// http://www.w3.org/TR/selectors/#lang-pseudo
		"lang": markFunction( function( lang ) {
			// lang value must be a valid identifier
			if ( !ridentifier.test(lang || "") ) {
				Sizzle.error( "unsupported lang: " + lang );
			}
			lang = lang.replace( runescape, funescape ).toLowerCase();
			return function( elem ) {
				var elemLang;
				do {
					if ( (elemLang = documentIsHTML ?
						elem.lang :
						elem.getAttribute("xml:lang") || elem.getAttribute("lang")) ) {

						elemLang = elemLang.toLowerCase();
						return elemLang === lang || elemLang.indexOf( lang + "-" ) === 0;
					}
				} while ( (elem = elem.parentNode) && elem.nodeType === 1 );
				return false;
			};
		}),

		// Miscellaneous
		"target": function( elem ) {
			var hash = window.location && window.location.hash;
			return hash && hash.slice( 1 ) === elem.id;
		},

		"root": function( elem ) {
			return elem === docElem;
		},

		"focus": function( elem ) {
			return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);
		},

		// Boolean properties
		"enabled": function( elem ) {
			return elem.disabled === false;
		},

		"disabled": function( elem ) {
			return elem.disabled === true;
		},

		"checked": function( elem ) {
			// In CSS3, :checked should return both checked and selected elements
			// http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
			var nodeName = elem.nodeName.toLowerCase();
			return (nodeName === "input" && !!elem.checked) || (nodeName === "option" && !!elem.selected);
		},

		"selected": function( elem ) {
			// Accessing this property makes selected-by-default
			// options in Safari work properly
			if ( elem.parentNode ) {
				elem.parentNode.selectedIndex;
			}

			return elem.selected === true;
		},

		// Contents
		"empty": function( elem ) {
			// http://www.w3.org/TR/selectors/#empty-pseudo
			// :empty is negated by element (1) or content nodes (text: 3; cdata: 4; entity ref: 5),
			//   but not by others (comment: 8; processing instruction: 7; etc.)
			// nodeType < 6 works because attributes (2) do not appear as children
			for ( elem = elem.firstChild; elem; elem = elem.nextSibling ) {
				if ( elem.nodeType < 6 ) {
					return false;
				}
			}
			return true;
		},

		"parent": function( elem ) {
			return !Expr.pseudos["empty"]( elem );
		},

		// Element/input types
		"header": function( elem ) {
			return rheader.test( elem.nodeName );
		},

		"input": function( elem ) {
			return rinputs.test( elem.nodeName );
		},

		"button": function( elem ) {
			var name = elem.nodeName.toLowerCase();
			return name === "input" && elem.type === "button" || name === "button";
		},

		"text": function( elem ) {
			var attr;
			return elem.nodeName.toLowerCase() === "input" &&
				elem.type === "text" &&

				// Support: IE<8
				// New HTML5 attribute values (e.g., "search") appear with elem.type === "text"
				( (attr = elem.getAttribute("type")) == null || attr.toLowerCase() === "text" );
		},

		// Position-in-collection
		"first": createPositionalPseudo(function() {
			return [ 0 ];
		}),

		"last": createPositionalPseudo(function( matchIndexes, length ) {
			return [ length - 1 ];
		}),

		"eq": createPositionalPseudo(function( matchIndexes, length, argument ) {
			return [ argument < 0 ? argument + length : argument ];
		}),

		"even": createPositionalPseudo(function( matchIndexes, length ) {
			var i = 0;
			for ( ; i < length; i += 2 ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"odd": createPositionalPseudo(function( matchIndexes, length ) {
			var i = 1;
			for ( ; i < length; i += 2 ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"lt": createPositionalPseudo(function( matchIndexes, length, argument ) {
			var i = argument < 0 ? argument + length : argument;
			for ( ; --i >= 0; ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		}),

		"gt": createPositionalPseudo(function( matchIndexes, length, argument ) {
			var i = argument < 0 ? argument + length : argument;
			for ( ; ++i < length; ) {
				matchIndexes.push( i );
			}
			return matchIndexes;
		})
	}
};

Expr.pseudos["nth"] = Expr.pseudos["eq"];

// Add button/input type pseudos
for ( i in { radio: true, checkbox: true, file: true, password: true, image: true } ) {
	Expr.pseudos[ i ] = createInputPseudo( i );
}
for ( i in { submit: true, reset: true } ) {
	Expr.pseudos[ i ] = createButtonPseudo( i );
}

// Easy API for creating new setFilters
function setFilters() {}
setFilters.prototype = Expr.filters = Expr.pseudos;
Expr.setFilters = new setFilters();

function tokenize( selector, parseOnly ) {
	var matched, match, tokens, type,
		soFar, groups, preFilters,
		cached = tokenCache[ selector + " " ];

	if ( cached ) {
		return parseOnly ? 0 : cached.slice( 0 );
	}

	soFar = selector;
	groups = [];
	preFilters = Expr.preFilter;

	while ( soFar ) {

		// Comma and first run
		if ( !matched || (match = rcomma.exec( soFar )) ) {
			if ( match ) {
				// Don't consume trailing commas as valid
				soFar = soFar.slice( match[0].length ) || soFar;
			}
			groups.push( (tokens = []) );
		}

		matched = false;

		// Combinators
		if ( (match = rcombinators.exec( soFar )) ) {
			matched = match.shift();
			tokens.push({
				value: matched,
				// Cast descendant combinators to space
				type: match[0].replace( rtrim, " " )
			});
			soFar = soFar.slice( matched.length );
		}

		// Filters
		for ( type in Expr.filter ) {
			if ( (match = matchExpr[ type ].exec( soFar )) && (!preFilters[ type ] ||
				(match = preFilters[ type ]( match ))) ) {
				matched = match.shift();
				tokens.push({
					value: matched,
					type: type,
					matches: match
				});
				soFar = soFar.slice( matched.length );
			}
		}

		if ( !matched ) {
			break;
		}
	}

	// Return the length of the invalid excess
	// if we're just parsing
	// Otherwise, throw an error or return tokens
	return parseOnly ?
		soFar.length :
		soFar ?
			Sizzle.error( selector ) :
			// Cache the tokens
			tokenCache( selector, groups ).slice( 0 );
}

function toSelector( tokens ) {
	var i = 0,
		len = tokens.length,
		selector = "";
	for ( ; i < len; i++ ) {
		selector += tokens[i].value;
	}
	return selector;
}

function addCombinator( matcher, combinator, base ) {
	var dir = combinator.dir,
		checkNonElements = base && dir === "parentNode",
		doneName = done++;

	return combinator.first ?
		// Check against closest ancestor/preceding element
		function( elem, context, xml ) {
			while ( (elem = elem[ dir ]) ) {
				if ( elem.nodeType === 1 || checkNonElements ) {
					return matcher( elem, context, xml );
				}
			}
		} :

		// Check against all ancestor/preceding elements
		function( elem, context, xml ) {
			var oldCache, outerCache,
				newCache = [ dirruns, doneName ];

			// We can't set arbitrary data on XML nodes, so they don't benefit from dir caching
			if ( xml ) {
				while ( (elem = elem[ dir ]) ) {
					if ( elem.nodeType === 1 || checkNonElements ) {
						if ( matcher( elem, context, xml ) ) {
							return true;
						}
					}
				}
			} else {
				while ( (elem = elem[ dir ]) ) {
					if ( elem.nodeType === 1 || checkNonElements ) {
						outerCache = elem[ expando ] || (elem[ expando ] = {});
						if ( (oldCache = outerCache[ dir ]) &&
							oldCache[ 0 ] === dirruns && oldCache[ 1 ] === doneName ) {

							// Assign to newCache so results back-propagate to previous elements
							return (newCache[ 2 ] = oldCache[ 2 ]);
						} else {
							// Reuse newcache so results back-propagate to previous elements
							outerCache[ dir ] = newCache;

							// A match means we're done; a fail means we have to keep checking
							if ( (newCache[ 2 ] = matcher( elem, context, xml )) ) {
								return true;
							}
						}
					}
				}
			}
		};
}

function elementMatcher( matchers ) {
	return matchers.length > 1 ?
		function( elem, context, xml ) {
			var i = matchers.length;
			while ( i-- ) {
				if ( !matchers[i]( elem, context, xml ) ) {
					return false;
				}
			}
			return true;
		} :
		matchers[0];
}

function condense( unmatched, map, filter, context, xml ) {
	var elem,
		newUnmatched = [],
		i = 0,
		len = unmatched.length,
		mapped = map != null;

	for ( ; i < len; i++ ) {
		if ( (elem = unmatched[i]) ) {
			if ( !filter || filter( elem, context, xml ) ) {
				newUnmatched.push( elem );
				if ( mapped ) {
					map.push( i );
				}
			}
		}
	}

	return newUnmatched;
}

function setMatcher( preFilter, selector, matcher, postFilter, postFinder, postSelector ) {
	if ( postFilter && !postFilter[ expando ] ) {
		postFilter = setMatcher( postFilter );
	}
	if ( postFinder && !postFinder[ expando ] ) {
		postFinder = setMatcher( postFinder, postSelector );
	}
	return markFunction(function( seed, results, context, xml ) {
		var temp, i, elem,
			preMap = [],
			postMap = [],
			preexisting = results.length,

			// Get initial elements from seed or context
			elems = seed || multipleContexts( selector || "*", context.nodeType ? [ context ] : context, [] ),

			// Prefilter to get matcher input, preserving a map for seed-results synchronization
			matcherIn = preFilter && ( seed || !selector ) ?
				condense( elems, preMap, preFilter, context, xml ) :
				elems,

			matcherOut = matcher ?
				// If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,
				postFinder || ( seed ? preFilter : preexisting || postFilter ) ?

					// ...intermediate processing is necessary
					[] :

					// ...otherwise use results directly
					results :
				matcherIn;

		// Find primary matches
		if ( matcher ) {
			matcher( matcherIn, matcherOut, context, xml );
		}

		// Apply postFilter
		if ( postFilter ) {
			temp = condense( matcherOut, postMap );
			postFilter( temp, [], context, xml );

			// Un-match failing elements by moving them back to matcherIn
			i = temp.length;
			while ( i-- ) {
				if ( (elem = temp[i]) ) {
					matcherOut[ postMap[i] ] = !(matcherIn[ postMap[i] ] = elem);
				}
			}
		}

		if ( seed ) {
			if ( postFinder || preFilter ) {
				if ( postFinder ) {
					// Get the final matcherOut by condensing this intermediate into postFinder contexts
					temp = [];
					i = matcherOut.length;
					while ( i-- ) {
						if ( (elem = matcherOut[i]) ) {
							// Restore matcherIn since elem is not yet a final match
							temp.push( (matcherIn[i] = elem) );
						}
					}
					postFinder( null, (matcherOut = []), temp, xml );
				}

				// Move matched elements from seed to results to keep them synchronized
				i = matcherOut.length;
				while ( i-- ) {
					if ( (elem = matcherOut[i]) &&
						(temp = postFinder ? indexOf.call( seed, elem ) : preMap[i]) > -1 ) {

						seed[temp] = !(results[temp] = elem);
					}
				}
			}

		// Add elements to results, through postFinder if defined
		} else {
			matcherOut = condense(
				matcherOut === results ?
					matcherOut.splice( preexisting, matcherOut.length ) :
					matcherOut
			);
			if ( postFinder ) {
				postFinder( null, results, matcherOut, xml );
			} else {
				push.apply( results, matcherOut );
			}
		}
	});
}

function matcherFromTokens( tokens ) {
	var checkContext, matcher, j,
		len = tokens.length,
		leadingRelative = Expr.relative[ tokens[0].type ],
		implicitRelative = leadingRelative || Expr.relative[" "],
		i = leadingRelative ? 1 : 0,

		// The foundational matcher ensures that elements are reachable from top-level context(s)
		matchContext = addCombinator( function( elem ) {
			return elem === checkContext;
		}, implicitRelative, true ),
		matchAnyContext = addCombinator( function( elem ) {
			return indexOf.call( checkContext, elem ) > -1;
		}, implicitRelative, true ),
		matchers = [ function( elem, context, xml ) {
			return ( !leadingRelative && ( xml || context !== outermostContext ) ) || (
				(checkContext = context).nodeType ?
					matchContext( elem, context, xml ) :
					matchAnyContext( elem, context, xml ) );
		} ];

	for ( ; i < len; i++ ) {
		if ( (matcher = Expr.relative[ tokens[i].type ]) ) {
			matchers = [ addCombinator(elementMatcher( matchers ), matcher) ];
		} else {
			matcher = Expr.filter[ tokens[i].type ].apply( null, tokens[i].matches );

			// Return special upon seeing a positional matcher
			if ( matcher[ expando ] ) {
				// Find the next relative operator (if any) for proper handling
				j = ++i;
				for ( ; j < len; j++ ) {
					if ( Expr.relative[ tokens[j].type ] ) {
						break;
					}
				}
				return setMatcher(
					i > 1 && elementMatcher( matchers ),
					i > 1 && toSelector(
						// If the preceding token was a descendant combinator, insert an implicit any-element `*`
						tokens.slice( 0, i - 1 ).concat({ value: tokens[ i - 2 ].type === " " ? "*" : "" })
					).replace( rtrim, "$1" ),
					matcher,
					i < j && matcherFromTokens( tokens.slice( i, j ) ),
					j < len && matcherFromTokens( (tokens = tokens.slice( j )) ),
					j < len && toSelector( tokens )
				);
			}
			matchers.push( matcher );
		}
	}

	return elementMatcher( matchers );
}

function matcherFromGroupMatchers( elementMatchers, setMatchers ) {
	var bySet = setMatchers.length > 0,
		byElement = elementMatchers.length > 0,
		superMatcher = function( seed, context, xml, results, outermost ) {
			var elem, j, matcher,
				matchedCount = 0,
				i = "0",
				unmatched = seed && [],
				setMatched = [],
				contextBackup = outermostContext,
				// We must always have either seed elements or outermost context
				elems = seed || byElement && Expr.find["TAG"]( "*", outermost ),
				// Use integer dirruns iff this is the outermost matcher
				dirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),
				len = elems.length;

			if ( outermost ) {
				outermostContext = context !== document && context;
			}

			// Add elements passing elementMatchers directly to results
			// Keep `i` a string if there are no elements so `matchedCount` will be "00" below
			// Support: IE<9, Safari
			// Tolerate NodeList properties (IE: "length"; Safari: <number>) matching elements by id
			for ( ; i !== len && (elem = elems[i]) != null; i++ ) {
				if ( byElement && elem ) {
					j = 0;
					while ( (matcher = elementMatchers[j++]) ) {
						if ( matcher( elem, context, xml ) ) {
							results.push( elem );
							break;
						}
					}
					if ( outermost ) {
						dirruns = dirrunsUnique;
					}
				}

				// Track unmatched elements for set filters
				if ( bySet ) {
					// They will have gone through all possible matchers
					if ( (elem = !matcher && elem) ) {
						matchedCount--;
					}

					// Lengthen the array for every element, matched or not
					if ( seed ) {
						unmatched.push( elem );
					}
				}
			}

			// Apply set filters to unmatched elements
			matchedCount += i;
			if ( bySet && i !== matchedCount ) {
				j = 0;
				while ( (matcher = setMatchers[j++]) ) {
					matcher( unmatched, setMatched, context, xml );
				}

				if ( seed ) {
					// Reintegrate element matches to eliminate the need for sorting
					if ( matchedCount > 0 ) {
						while ( i-- ) {
							if ( !(unmatched[i] || setMatched[i]) ) {
								setMatched[i] = pop.call( results );
							}
						}
					}

					// Discard index placeholder values to get only actual matches
					setMatched = condense( setMatched );
				}

				// Add matches to results
				push.apply( results, setMatched );

				// Seedless set matches succeeding multiple successful matchers stipulate sorting
				if ( outermost && !seed && setMatched.length > 0 &&
					( matchedCount + setMatchers.length ) > 1 ) {

					Sizzle.uniqueSort( results );
				}
			}

			// Override manipulation of globals by nested matchers
			if ( outermost ) {
				dirruns = dirrunsUnique;
				outermostContext = contextBackup;
			}

			return unmatched;
		};

	return bySet ?
		markFunction( superMatcher ) :
		superMatcher;
}

compile = Sizzle.compile = function( selector, group /* Internal Use Only */ ) {
	var i,
		setMatchers = [],
		elementMatchers = [],
		cached = compilerCache[ selector + " " ];

	if ( !cached ) {
		// Generate a function of recursive functions that can be used to check each element
		if ( !group ) {
			group = tokenize( selector );
		}
		i = group.length;
		while ( i-- ) {
			cached = matcherFromTokens( group[i] );
			if ( cached[ expando ] ) {
				setMatchers.push( cached );
			} else {
				elementMatchers.push( cached );
			}
		}

		// Cache the compiled function
		cached = compilerCache( selector, matcherFromGroupMatchers( elementMatchers, setMatchers ) );
	}
	return cached;
};

function multipleContexts( selector, contexts, results ) {
	var i = 0,
		len = contexts.length;
	for ( ; i < len; i++ ) {
		Sizzle( selector, contexts[i], results );
	}
	return results;
}

function select( selector, context, results, seed ) {
	var i, tokens, token, type, find,
		match = tokenize( selector );

	if ( !seed ) {
		// Try to minimize operations if there is only one group
		if ( match.length === 1 ) {

			// Take a shortcut and set the context if the root selector is an ID
			tokens = match[0] = match[0].slice( 0 );
			if ( tokens.length > 2 && (token = tokens[0]).type === "ID" &&
					support.getById && context.nodeType === 9 && documentIsHTML &&
					Expr.relative[ tokens[1].type ] ) {

				context = ( Expr.find["ID"]( token.matches[0].replace(runescape, funescape), context ) || [] )[0];
				if ( !context ) {
					return results;
				}
				selector = selector.slice( tokens.shift().value.length );
			}

			// Fetch a seed set for right-to-left matching
			i = matchExpr["needsContext"].test( selector ) ? 0 : tokens.length;
			while ( i-- ) {
				token = tokens[i];

				// Abort if we hit a combinator
				if ( Expr.relative[ (type = token.type) ] ) {
					break;
				}
				if ( (find = Expr.find[ type ]) ) {
					// Search, expanding context for leading sibling combinators
					if ( (seed = find(
						token.matches[0].replace( runescape, funescape ),
						rsibling.test( tokens[0].type ) && testContext( context.parentNode ) || context
					)) ) {

						// If seed is empty or no tokens remain, we can return early
						tokens.splice( i, 1 );
						selector = seed.length && toSelector( tokens );
						if ( !selector ) {
							push.apply( results, seed );
							return results;
						}

						break;
					}
				}
			}
		}
	}

	// Compile and execute a filtering function
	// Provide `match` to avoid retokenization if we modified the selector above
	compile( selector, match )(
		seed,
		context,
		!documentIsHTML,
		results,
		rsibling.test( selector ) && testContext( context.parentNode ) || context
	);
	return results;
}

// One-time assignments

// Sort stability
support.sortStable = expando.split("").sort( sortOrder ).join("") === expando;

// Support: Chrome<14
// Always assume duplicates if they aren't passed to the comparison function
support.detectDuplicates = !!hasDuplicate;

// Initialize against the default document
setDocument();

// Support: Webkit<537.32 - Safari 6.0.3/Chrome 25 (fixed in Chrome 27)
// Detached nodes confoundingly follow *each other*
support.sortDetached = assert(function( div1 ) {
	// Should return 1, but returns 4 (following)
	return div1.compareDocumentPosition( document.createElement("div") ) & 1;
});

// Support: IE<8
// Prevent attribute/property "interpolation"
// http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx
if ( !assert(function( div ) {
	div.innerHTML = "<a href='#'></a>";
	return div.firstChild.getAttribute("href") === "#" ;
}) ) {
	addHandle( "type|href|height|width", function( elem, name, isXML ) {
		if ( !isXML ) {
			return elem.getAttribute( name, name.toLowerCase() === "type" ? 1 : 2 );
		}
	});
}

// Support: IE<9
// Use defaultValue in place of getAttribute("value")
if ( !support.attributes || !assert(function( div ) {
	div.innerHTML = "<input/>";
	div.firstChild.setAttribute( "value", "" );
	return div.firstChild.getAttribute( "value" ) === "";
}) ) {
	addHandle( "value", function( elem, name, isXML ) {
		if ( !isXML && elem.nodeName.toLowerCase() === "input" ) {
			return elem.defaultValue;
		}
	});
}

// Support: IE<9
// Use getAttributeNode to fetch booleans when getAttribute lies
if ( !assert(function( div ) {
	return div.getAttribute("disabled") == null;
}) ) {
	addHandle( booleans, function( elem, name, isXML ) {
		var val;
		if ( !isXML ) {
			return elem[ name ] === true ? name.toLowerCase() :
					(val = elem.getAttributeNode( name )) && val.specified ?
					val.value :
				null;
		}
	});
}

return Sizzle;

})( window );



jQuery.find = Sizzle;
jQuery.expr = Sizzle.selectors;
jQuery.expr[":"] = jQuery.expr.pseudos;
jQuery.unique = Sizzle.uniqueSort;
jQuery.text = Sizzle.getText;
jQuery.isXMLDoc = Sizzle.isXML;
jQuery.contains = Sizzle.contains;



var rneedsContext = jQuery.expr.match.needsContext;

var rsingleTag = (/^<(\w+)\s*\/?>(?:<\/\1>|)$/);



var risSimple = /^.[^:#\[\.,]*$/;

// Implement the identical functionality for filter and not
function winnow( elements, qualifier, not ) {
	if ( jQuery.isFunction( qualifier ) ) {
		return jQuery.grep( elements, function( elem, i ) {
			/* jshint -W018 */
			return !!qualifier.call( elem, i, elem ) !== not;
		});

	}

	if ( qualifier.nodeType ) {
		return jQuery.grep( elements, function( elem ) {
			return ( elem === qualifier ) !== not;
		});

	}

	if ( typeof qualifier === "string" ) {
		if ( risSimple.test( qualifier ) ) {
			return jQuery.filter( qualifier, elements, not );
		}

		qualifier = jQuery.filter( qualifier, elements );
	}

	return jQuery.grep( elements, function( elem ) {
		return ( jQuery.inArray( elem, qualifier ) >= 0 ) !== not;
	});
}

jQuery.filter = function( expr, elems, not ) {
	var elem = elems[ 0 ];

	if ( not ) {
		expr = ":not(" + expr + ")";
	}

	return elems.length === 1 && elem.nodeType === 1 ?
		jQuery.find.matchesSelector( elem, expr ) ? [ elem ] : [] :
		jQuery.find.matches( expr, jQuery.grep( elems, function( elem ) {
			return elem.nodeType === 1;
		}));
};

jQuery.fn.extend({
	find: function( selector ) {
		var i,
			ret = [],
			self = this,
			len = self.length;

		if ( typeof selector !== "string" ) {
			return this.pushStack( jQuery( selector ).filter(function() {
				for ( i = 0; i < len; i++ ) {
					if ( jQuery.contains( self[ i ], this ) ) {
						return true;
					}
				}
			}) );
		}

		for ( i = 0; i < len; i++ ) {
			jQuery.find( selector, self[ i ], ret );
		}

		// Needed because $( selector, context ) becomes $( context ).find( selector )
		ret = this.pushStack( len > 1 ? jQuery.unique( ret ) : ret );
		ret.selector = this.selector ? this.selector + " " + selector : selector;
		return ret;
	},
	filter: function( selector ) {
		return this.pushStack( winnow(this, selector || [], false) );
	},
	not: function( selector ) {
		return this.pushStack( winnow(this, selector || [], true) );
	},
	is: function( selector ) {
		return !!winnow(
			this,

			// If this is a positional/relative selector, check membership in the returned set
			// so $("p:first").is("p:last") won't return true for a doc with two "p".
			typeof selector === "string" && rneedsContext.test( selector ) ?
				jQuery( selector ) :
				selector || [],
			false
		).length;
	}
});


// Initialize a jQuery object


// A central reference to the root jQuery(document)
var rootjQuery,

	// Use the correct document accordingly with window argument (sandbox)
	document = window.document,

	// A simple way to check for HTML strings
	// Prioritize #id over <tag> to avoid XSS via location.hash (#9521)
	// Strict HTML recognition (#11290: must start with <)
	rquickExpr = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,

	init = jQuery.fn.init = function( selector, context ) {
		var match, elem;

		// HANDLE: $(""), $(null), $(undefined), $(false)
		if ( !selector ) {
			return this;
		}

		// Handle HTML strings
		if ( typeof selector === "string" ) {
			if ( selector.charAt(0) === "<" && selector.charAt( selector.length - 1 ) === ">" && selector.length >= 3 ) {
				// Assume that strings that start and end with <> are HTML and skip the regex check
				match = [ null, selector, null ];

			} else {
				match = rquickExpr.exec( selector );
			}

			// Match html or make sure no context is specified for #id
			if ( match && (match[1] || !context) ) {

				// HANDLE: $(html) -> $(array)
				if ( match[1] ) {
					context = context instanceof jQuery ? context[0] : context;

					// scripts is true for back-compat
					// Intentionally let the error be thrown if parseHTML is not present
					jQuery.merge( this, jQuery.parseHTML(
						match[1],
						context && context.nodeType ? context.ownerDocument || context : document,
						true
					) );

					// HANDLE: $(html, props)
					if ( rsingleTag.test( match[1] ) && jQuery.isPlainObject( context ) ) {
						for ( match in context ) {
							// Properties of context are called as methods if possible
							if ( jQuery.isFunction( this[ match ] ) ) {
								this[ match ]( context[ match ] );

							// ...and otherwise set as attributes
							} else {
								this.attr( match, context[ match ] );
							}
						}
					}

					return this;

				// HANDLE: $(#id)
				} else {
					elem = document.getElementById( match[2] );

					// Check parentNode to catch when Blackberry 4.6 returns
					// nodes that are no longer in the document #6963
					if ( elem && elem.parentNode ) {
						// Handle the case where IE and Opera return items
						// by name instead of ID
						if ( elem.id !== match[2] ) {
							return rootjQuery.find( selector );
						}

						// Otherwise, we inject the element directly into the jQuery object
						this.length = 1;
						this[0] = elem;
					}

					this.context = document;
					this.selector = selector;
					return this;
				}

			// HANDLE: $(expr, $(...))
			} else if ( !context || context.jquery ) {
				return ( context || rootjQuery ).find( selector );

			// HANDLE: $(expr, context)
			// (which is just equivalent to: $(context).find(expr)
			} else {
				return this.constructor( context ).find( selector );
			}

		// HANDLE: $(DOMElement)
		} else if ( selector.nodeType ) {
			this.context = this[0] = selector;
			this.length = 1;
			return this;

		// HANDLE: $(function)
		// Shortcut for document ready
		} else if ( jQuery.isFunction( selector ) ) {
			return typeof rootjQuery.ready !== "undefined" ?
				rootjQuery.ready( selector ) :
				// Execute immediately if ready is not present
				selector( jQuery );
		}

		if ( selector.selector !== undefined ) {
			this.selector = selector.selector;
			this.context = selector.context;
		}

		return jQuery.makeArray( selector, this );
	};

// Give the init function the jQuery prototype for later instantiation
init.prototype = jQuery.fn;

// Initialize central reference
rootjQuery = jQuery( document );


var rparentsprev = /^(?:parents|prev(?:Until|All))/,
	// methods guaranteed to produce a unique set when starting from a unique set
	guaranteedUnique = {
		children: true,
		contents: true,
		next: true,
		prev: true
	};

jQuery.extend({
	dir: function( elem, dir, until ) {
		var matched = [],
			cur = elem[ dir ];

		while ( cur && cur.nodeType !== 9 && (until === undefined || cur.nodeType !== 1 || !jQuery( cur ).is( until )) ) {
			if ( cur.nodeType === 1 ) {
				matched.push( cur );
			}
			cur = cur[dir];
		}
		return matched;
	},

	sibling: function( n, elem ) {
		var r = [];

		for ( ; n; n = n.nextSibling ) {
			if ( n.nodeType === 1 && n !== elem ) {
				r.push( n );
			}
		}

		return r;
	}
});

jQuery.fn.extend({
	has: function( target ) {
		var i,
			targets = jQuery( target, this ),
			len = targets.length;

		return this.filter(function() {
			for ( i = 0; i < len; i++ ) {
				if ( jQuery.contains( this, targets[i] ) ) {
					return true;
				}
			}
		});
	},

	closest: function( selectors, context ) {
		var cur,
			i = 0,
			l = this.length,
			matched = [],
			pos = rneedsContext.test( selectors ) || typeof selectors !== "string" ?
				jQuery( selectors, context || this.context ) :
				0;

		for ( ; i < l; i++ ) {
			for ( cur = this[i]; cur && cur !== context; cur = cur.parentNode ) {
				// Always skip document fragments
				if ( cur.nodeType < 11 && (pos ?
					pos.index(cur) > -1 :

					// Don't pass non-elements to Sizzle
					cur.nodeType === 1 &&
						jQuery.find.matchesSelector(cur, selectors)) ) {

					matched.push( cur );
					break;
				}
			}
		}

		return this.pushStack( matched.length > 1 ? jQuery.unique( matched ) : matched );
	},

	// Determine the position of an element within
	// the matched set of elements
	index: function( elem ) {

		// No argument, return index in parent
		if ( !elem ) {
			return ( this[0] && this[0].parentNode ) ? this.first().prevAll().length : -1;
		}

		// index in selector
		if ( typeof elem === "string" ) {
			return jQuery.inArray( this[0], jQuery( elem ) );
		}

		// Locate the position of the desired element
		return jQuery.inArray(
			// If it receives a jQuery object, the first element is used
			elem.jquery ? elem[0] : elem, this );
	},

	add: function( selector, context ) {
		return this.pushStack(
			jQuery.unique(
				jQuery.merge( this.get(), jQuery( selector, context ) )
			)
		);
	},

	addBack: function( selector ) {
		return this.add( selector == null ?
			this.prevObject : this.prevObject.filter(selector)
		);
	}
});

function sibling( cur, dir ) {
	do {
		cur = cur[ dir ];
	} while ( cur && cur.nodeType !== 1 );

	return cur;
}

jQuery.each({
	parent: function( elem ) {
		var parent = elem.parentNode;
		return parent && parent.nodeType !== 11 ? parent : null;
	},
	parents: function( elem ) {
		return jQuery.dir( elem, "parentNode" );
	},
	parentsUntil: function( elem, i, until ) {
		return jQuery.dir( elem, "parentNode", until );
	},
	next: function( elem ) {
		return sibling( elem, "nextSibling" );
	},
	prev: function( elem ) {
		return sibling( elem, "previousSibling" );
	},
	nextAll: function( elem ) {
		return jQuery.dir( elem, "nextSibling" );
	},
	prevAll: function( elem ) {
		return jQuery.dir( elem, "previousSibling" );
	},
	nextUntil: function( elem, i, until ) {
		return jQuery.dir( elem, "nextSibling", until );
	},
	prevUntil: function( elem, i, until ) {
		return jQuery.dir( elem, "previousSibling", until );
	},
	siblings: function( elem ) {
		return jQuery.sibling( ( elem.parentNode || {} ).firstChild, elem );
	},
	children: function( elem ) {
		return jQuery.sibling( elem.firstChild );
	},
	contents: function( elem ) {
		return jQuery.nodeName( elem, "iframe" ) ?
			elem.contentDocument || elem.contentWindow.document :
			jQuery.merge( [], elem.childNodes );
	}
}, function( name, fn ) {
	jQuery.fn[ name ] = function( until, selector ) {
		var ret = jQuery.map( this, fn, until );

		if ( name.slice( -5 ) !== "Until" ) {
			selector = until;
		}

		if ( selector && typeof selector === "string" ) {
			ret = jQuery.filter( selector, ret );
		}

		if ( this.length > 1 ) {
			// Remove duplicates
			if ( !guaranteedUnique[ name ] ) {
				ret = jQuery.unique( ret );
			}

			// Reverse order for parents* and prev-derivatives
			if ( rparentsprev.test( name ) ) {
				ret = ret.reverse();
			}
		}

		return this.pushStack( ret );
	};
});
var rnotwhite = (/\S+/g);



// String to Object options format cache
var optionsCache = {};

// Convert String-formatted options into Object-formatted ones and store in cache
function createOptions( options ) {
	var object = optionsCache[ options ] = {};
	jQuery.each( options.match( rnotwhite ) || [], function( _, flag ) {
		object[ flag ] = true;
	});
	return object;
}

/*
 * Create a callback list using the following parameters:
 *
 *	options: an optional list of space-separated options that will change how
 *			the callback list behaves or a more traditional option object
 *
 * By default a callback list will act like an event callback list and can be
 * "fired" multiple times.
 *
 * Possible options:
 *
 *	once:			will ensure the callback list can only be fired once (like a Deferred)
 *
 *	memory:			will keep track of previous values and will call any callback added
 *					after the list has been fired right away with the latest "memorized"
 *					values (like a Deferred)
 *
 *	unique:			will ensure a callback can only be added once (no duplicate in the list)
 *
 *	stopOnFalse:	interrupt callings when a callback returns false
 *
 */
jQuery.Callbacks = function( options ) {

	// Convert options from String-formatted to Object-formatted if needed
	// (we check in cache first)
	options = typeof options === "string" ?
		( optionsCache[ options ] || createOptions( options ) ) :
		jQuery.extend( {}, options );

	var // Flag to know if list is currently firing
		firing,
		// Last fire value (for non-forgettable lists)
		memory,
		// Flag to know if list was already fired
		fired,
		// End of the loop when firing
		firingLength,
		// Index of currently firing callback (modified by remove if needed)
		firingIndex,
		// First callback to fire (used internally by add and fireWith)
		firingStart,
		// Actual callback list
		list = [],
		// Stack of fire calls for repeatable lists
		stack = !options.once && [],
		// Fire callbacks
		fire = function( data ) {
			memory = options.memory && data;
			fired = true;
			firingIndex = firingStart || 0;
			firingStart = 0;
			firingLength = list.length;
			firing = true;
			for ( ; list && firingIndex < firingLength; firingIndex++ ) {
				if ( list[ firingIndex ].apply( data[ 0 ], data[ 1 ] ) === false && options.stopOnFalse ) {
					memory = false; // To prevent further calls using add
					break;
				}
			}
			firing = false;
			if ( list ) {
				if ( stack ) {
					if ( stack.length ) {
						fire( stack.shift() );
					}
				} else if ( memory ) {
					list = [];
				} else {
					self.disable();
				}
			}
		},
		// Actual Callbacks object
		self = {
			// Add a callback or a collection of callbacks to the list
			add: function() {
				if ( list ) {
					// First, we save the current length
					var start = list.length;
					(function add( args ) {
						jQuery.each( args, function( _, arg ) {
							var type = jQuery.type( arg );
							if ( type === "function" ) {
								if ( !options.unique || !self.has( arg ) ) {
									list.push( arg );
								}
							} else if ( arg && arg.length && type !== "string" ) {
								// Inspect recursively
								add( arg );
							}
						});
					})( arguments );
					// Do we need to add the callbacks to the
					// current firing batch?
					if ( firing ) {
						firingLength = list.length;
					// With memory, if we're not firing then
					// we should call right away
					} else if ( memory ) {
						firingStart = start;
						fire( memory );
					}
				}
				return this;
			},
			// Remove a callback from the list
			remove: function() {
				if ( list ) {
					jQuery.each( arguments, function( _, arg ) {
						var index;
						while ( ( index = jQuery.inArray( arg, list, index ) ) > -1 ) {
							list.splice( index, 1 );
							// Handle firing indexes
							if ( firing ) {
								if ( index <= firingLength ) {
									firingLength--;
								}
								if ( index <= firingIndex ) {
									firingIndex--;
								}
							}
						}
					});
				}
				return this;
			},
			// Check if a given callback is in the list.
			// If no argument is given, return whether or not list has callbacks attached.
			has: function( fn ) {
				return fn ? jQuery.inArray( fn, list ) > -1 : !!( list && list.length );
			},
			// Remove all callbacks from the list
			empty: function() {
				list = [];
				firingLength = 0;
				return this;
			},
			// Have the list do nothing anymore
			disable: function() {
				list = stack = memory = undefined;
				return this;
			},
			// Is it disabled?
			disabled: function() {
				return !list;
			},
			// Lock the list in its current state
			lock: function() {
				stack = undefined;
				if ( !memory ) {
					self.disable();
				}
				return this;
			},
			// Is it locked?
			locked: function() {
				return !stack;
			},
			// Call all callbacks with the given context and arguments
			fireWith: function( context, args ) {
				if ( list && ( !fired || stack ) ) {
					args = args || [];
					args = [ context, args.slice ? args.slice() : args ];
					if ( firing ) {
						stack.push( args );
					} else {
						fire( args );
					}
				}
				return this;
			},
			// Call all the callbacks with the given arguments
			fire: function() {
				self.fireWith( this, arguments );
				return this;
			},
			// To know if the callbacks have already been called at least once
			fired: function() {
				return !!fired;
			}
		};

	return self;
};


jQuery.extend({

	Deferred: function( func ) {
		var tuples = [
				// action, add listener, listener list, final state
				[ "resolve", "done", jQuery.Callbacks("once memory"), "resolved" ],
				[ "reject", "fail", jQuery.Callbacks("once memory"), "rejected" ],
				[ "notify", "progress", jQuery.Callbacks("memory") ]
			],
			state = "pending",
			promise = {
				state: function() {
					return state;
				},
				always: function() {
					deferred.done( arguments ).fail( arguments );
					return this;
				},
				then: function( /* fnDone, fnFail, fnProgress */ ) {
					var fns = arguments;
					return jQuery.Deferred(function( newDefer ) {
						jQuery.each( tuples, function( i, tuple ) {
							var fn = jQuery.isFunction( fns[ i ] ) && fns[ i ];
							// deferred[ done | fail | progress ] for forwarding actions to newDefer
							deferred[ tuple[1] ](function() {
								var returned = fn && fn.apply( this, arguments );
								if ( returned && jQuery.isFunction( returned.promise ) ) {
									returned.promise()
										.done( newDefer.resolve )
										.fail( newDefer.reject )
										.progress( newDefer.notify );
								} else {
									newDefer[ tuple[ 0 ] + "With" ]( this === promise ? newDefer.promise() : this, fn ? [ returned ] : arguments );
								}
							});
						});
						fns = null;
					}).promise();
				},
				// Get a promise for this deferred
				// If obj is provided, the promise aspect is added to the object
				promise: function( obj ) {
					return obj != null ? jQuery.extend( obj, promise ) : promise;
				}
			},
			deferred = {};

		// Keep pipe for back-compat
		promise.pipe = promise.then;

		// Add list-specific methods
		jQuery.each( tuples, function( i, tuple ) {
			var list = tuple[ 2 ],
				stateString = tuple[ 3 ];

			// promise[ done | fail | progress ] = list.add
			promise[ tuple[1] ] = list.add;

			// Handle state
			if ( stateString ) {
				list.add(function() {
					// state = [ resolved | rejected ]
					state = stateString;

				// [ reject_list | resolve_list ].disable; progress_list.lock
				}, tuples[ i ^ 1 ][ 2 ].disable, tuples[ 2 ][ 2 ].lock );
			}

			// deferred[ resolve | reject | notify ]
			deferred[ tuple[0] ] = function() {
				deferred[ tuple[0] + "With" ]( this === deferred ? promise : this, arguments );
				return this;
			};
			deferred[ tuple[0] + "With" ] = list.fireWith;
		});

		// Make the deferred a promise
		promise.promise( deferred );

		// Call given func if any
		if ( func ) {
			func.call( deferred, deferred );
		}

		// All done!
		return deferred;
	},

	// Deferred helper
	when: function( subordinate /* , ..., subordinateN */ ) {
		var i = 0,
			resolveValues = slice.call( arguments ),
			length = resolveValues.length,

			// the count of uncompleted subordinates
			remaining = length !== 1 || ( subordinate && jQuery.isFunction( subordinate.promise ) ) ? length : 0,

			// the master Deferred. If resolveValues consist of only a single Deferred, just use that.
			deferred = remaining === 1 ? subordinate : jQuery.Deferred(),

			// Update function for both resolve and progress values
			updateFunc = function( i, contexts, values ) {
				return function( value ) {
					contexts[ i ] = this;
					values[ i ] = arguments.length > 1 ? slice.call( arguments ) : value;
					if ( values === progressValues ) {
						deferred.notifyWith( contexts, values );

					} else if ( !(--remaining) ) {
						deferred.resolveWith( contexts, values );
					}
				};
			},

			progressValues, progressContexts, resolveContexts;

		// add listeners to Deferred subordinates; treat others as resolved
		if ( length > 1 ) {
			progressValues = new Array( length );
			progressContexts = new Array( length );
			resolveContexts = new Array( length );
			for ( ; i < length; i++ ) {
				if ( resolveValues[ i ] && jQuery.isFunction( resolveValues[ i ].promise ) ) {
					resolveValues[ i ].promise()
						.done( updateFunc( i, resolveContexts, resolveValues ) )
						.fail( deferred.reject )
						.progress( updateFunc( i, progressContexts, progressValues ) );
				} else {
					--remaining;
				}
			}
		}

		// if we're not waiting on anything, resolve the master
		if ( !remaining ) {
			deferred.resolveWith( resolveContexts, resolveValues );
		}

		return deferred.promise();
	}
});


// The deferred used on DOM ready
var readyList;

jQuery.fn.ready = function( fn ) {
	// Add the callback
	jQuery.ready.promise().done( fn );

	return this;
};

jQuery.extend({
	// Is the DOM ready to be used? Set to true once it occurs.
	isReady: false,

	// A counter to track how many items to wait for before
	// the ready event fires. See #6781
	readyWait: 1,

	// Hold (or release) the ready event
	holdReady: function( hold ) {
		if ( hold ) {
			jQuery.readyWait++;
		} else {
			jQuery.ready( true );
		}
	},

	// Handle when the DOM is ready
	ready: function( wait ) {

		// Abort if there are pending holds or we're already ready
		if ( wait === true ? --jQuery.readyWait : jQuery.isReady ) {
			return;
		}

		// Make sure body exists, at least, in case IE gets a little overzealous (ticket #5443).
		if ( !document.body ) {
			return setTimeout( jQuery.ready );
		}

		// Remember that the DOM is ready
		jQuery.isReady = true;

		// If a normal DOM Ready event fired, decrement, and wait if need be
		if ( wait !== true && --jQuery.readyWait > 0 ) {
			return;
		}

		// If there are functions bound, to execute
		readyList.resolveWith( document, [ jQuery ] );

		// Trigger any bound ready events
		if ( jQuery.fn.trigger ) {
			jQuery( document ).trigger("ready").off("ready");
		}
	}
});

/**
 * Clean-up method for dom ready events
 */
function detach() {
	if ( document.addEventListener ) {
		document.removeEventListener( "DOMContentLoaded", completed, false );
		window.removeEventListener( "load", completed, false );

	} else {
		document.detachEvent( "onreadystatechange", completed );
		window.detachEvent( "onload", completed );
	}
}

/**
 * The ready event handler and self cleanup method
 */
function completed() {
	// readyState === "complete" is good enough for us to call the dom ready in oldIE
	if ( document.addEventListener || event.type === "load" || document.readyState === "complete" ) {
		detach();
		jQuery.ready();
	}
}

jQuery.ready.promise = function( obj ) {
	if ( !readyList ) {

		readyList = jQuery.Deferred();

		// Catch cases where $(document).ready() is called after the browser event has already occurred.
		// we once tried to use readyState "interactive" here, but it caused issues like the one
		// discovered by ChrisS here: http://bugs.jquery.com/ticket/12282#comment:15
		if ( document.readyState === "complete" ) {
			// Handle it asynchronously to allow scripts the opportunity to delay ready
			setTimeout( jQuery.ready );

		// Standards-based browsers support DOMContentLoaded
		} else if ( document.addEventListener ) {
			// Use the handy event callback
			document.addEventListener( "DOMContentLoaded", completed, false );

			// A fallback to window.onload, that will always work
			window.addEventListener( "load", completed, false );

		// If IE event model is used
		} else {
			// Ensure firing before onload, maybe late but safe also for iframes
			document.attachEvent( "onreadystatechange", completed );

			// A fallback to window.onload, that will always work
			window.attachEvent( "onload", completed );

			// If IE and not a frame
			// continually check to see if the document is ready
			var top = false;

			try {
				top = window.frameElement == null && document.documentElement;
			} catch(e) {}

			if ( top && top.doScroll ) {
				(function doScrollCheck() {
					if ( !jQuery.isReady ) {

						try {
							// Use the trick by Diego Perini
							// http://javascript.nwbox.com/IEContentLoaded/
							top.doScroll("left");
						} catch(e) {
							return setTimeout( doScrollCheck, 50 );
						}

						// detach all dom ready events
						detach();

						// and execute any waiting functions
						jQuery.ready();
					}
				})();
			}
		}
	}
	return readyList.promise( obj );
};


var strundefined = typeof undefined;



// Support: IE<9
// Iteration over object's inherited properties before its own
var i;
for ( i in jQuery( support ) ) {
	break;
}
support.ownLast = i !== "0";

// Note: most support tests are defined in their respective modules.
// false until the test is run
support.inlineBlockNeedsLayout = false;

jQuery(function() {
	// We need to execute this one support test ASAP because we need to know
	// if body.style.zoom needs to be set.

	var container, div,
		body = document.getElementsByTagName("body")[0];

	if ( !body ) {
		// Return for frameset docs that don't have a body
		return;
	}

	// Setup
	container = document.createElement( "div" );
	container.style.cssText = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";

	div = document.createElement( "div" );
	body.appendChild( container ).appendChild( div );

	if ( typeof div.style.zoom !== strundefined ) {
		// Support: IE<8
		// Check if natively block-level elements act like inline-block
		// elements when setting their display to 'inline' and giving
		// them layout
		div.style.cssText = "border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1";

		if ( (support.inlineBlockNeedsLayout = ( div.offsetWidth === 3 )) ) {
			// Prevent IE 6 from affecting layout for positioned elements #11048
			// Prevent IE from shrinking the body in IE 7 mode #12869
			// Support: IE<8
			body.style.zoom = 1;
		}
	}

	body.removeChild( container );

	// Null elements to avoid leaks in IE
	container = div = null;
});




(function() {
	var div = document.createElement( "div" );

	// Execute the test only if not already executed in another module.
	if (support.deleteExpando == null) {
		// Support: IE<9
		support.deleteExpando = true;
		try {
			delete div.test;
		} catch( e ) {
			support.deleteExpando = false;
		}
	}

	// Null elements to avoid leaks in IE.
	div = null;
})();


/**
 * Determines whether an object can have data
 */
jQuery.acceptData = function( elem ) {
	var noData = jQuery.noData[ (elem.nodeName + " ").toLowerCase() ],
		nodeType = +elem.nodeType || 1;

	// Do not set data on non-element DOM nodes because it will not be cleared (#8335).
	return nodeType !== 1 && nodeType !== 9 ?
		false :

		// Nodes accept data unless otherwise specified; rejection can be conditional
		!noData || noData !== true && elem.getAttribute("classid") === noData;
};


var rbrace = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,
	rmultiDash = /([A-Z])/g;

function dataAttr( elem, key, data ) {
	// If nothing was found internally, try to fetch any
	// data from the HTML5 data-* attribute
	if ( data === undefined && elem.nodeType === 1 ) {

		var name = "data-" + key.replace( rmultiDash, "-$1" ).toLowerCase();

		data = elem.getAttribute( name );

		if ( typeof data === "string" ) {
			try {
				data = data === "true" ? true :
					data === "false" ? false :
					data === "null" ? null :
					// Only convert to a number if it doesn't change the string
					+data + "" === data ? +data :
					rbrace.test( data ) ? jQuery.parseJSON( data ) :
					data;
			} catch( e ) {}

			// Make sure we set the data so it isn't changed later
			jQuery.data( elem, key, data );

		} else {
			data = undefined;
		}
	}

	return data;
}

// checks a cache object for emptiness
function isEmptyDataObject( obj ) {
	var name;
	for ( name in obj ) {

		// if the public data object is empty, the private is still empty
		if ( name === "data" && jQuery.isEmptyObject( obj[name] ) ) {
			continue;
		}
		if ( name !== "toJSON" ) {
			return false;
		}
	}

	return true;
}

function internalData( elem, name, data, pvt /* Internal Use Only */ ) {
	if ( !jQuery.acceptData( elem ) ) {
		return;
	}

	var ret, thisCache,
		internalKey = jQuery.expando,

		// We have to handle DOM nodes and JS objects differently because IE6-7
		// can't GC object references properly across the DOM-JS boundary
		isNode = elem.nodeType,

		// Only DOM nodes need the global jQuery cache; JS object data is
		// attached directly to the object so GC can occur automatically
		cache = isNode ? jQuery.cache : elem,

		// Only defining an ID for JS objects if its cache already exists allows
		// the code to shortcut on the same path as a DOM node with no cache
		id = isNode ? elem[ internalKey ] : elem[ internalKey ] && internalKey;

	// Avoid doing any more work than we need to when trying to get data on an
	// object that has no data at all
	if ( (!id || !cache[id] || (!pvt && !cache[id].data)) && data === undefined && typeof name === "string" ) {
		return;
	}

	if ( !id ) {
		// Only DOM nodes need a new unique ID for each element since their data
		// ends up in the global cache
		if ( isNode ) {
			id = elem[ internalKey ] = deletedIds.pop() || jQuery.guid++;
		} else {
			id = internalKey;
		}
	}

	if ( !cache[ id ] ) {
		// Avoid exposing jQuery metadata on plain JS objects when the object
		// is serialized using JSON.stringify
		cache[ id ] = isNode ? {} : { toJSON: jQuery.noop };
	}

	// An object can be passed to jQuery.data instead of a key/value pair; this gets
	// shallow copied over onto the existing cache
	if ( typeof name === "object" || typeof name === "function" ) {
		if ( pvt ) {
			cache[ id ] = jQuery.extend( cache[ id ], name );
		} else {
			cache[ id ].data = jQuery.extend( cache[ id ].data, name );
		}
	}

	thisCache = cache[ id ];

	// jQuery data() is stored in a separate object inside the object's internal data
	// cache in order to avoid key collisions between internal data and user-defined
	// data.
	if ( !pvt ) {
		if ( !thisCache.data ) {
			thisCache.data = {};
		}

		thisCache = thisCache.data;
	}

	if ( data !== undefined ) {
		thisCache[ jQuery.camelCase( name ) ] = data;
	}

	// Check for both converted-to-camel and non-converted data property names
	// If a data property was specified
	if ( typeof name === "string" ) {

		// First Try to find as-is property data
		ret = thisCache[ name ];

		// Test for null|undefined property data
		if ( ret == null ) {

			// Try to find the camelCased property
			ret = thisCache[ jQuery.camelCase( name ) ];
		}
	} else {
		ret = thisCache;
	}

	return ret;
}

function internalRemoveData( elem, name, pvt ) {
	if ( !jQuery.acceptData( elem ) ) {
		return;
	}

	var thisCache, i,
		isNode = elem.nodeType,

		// See jQuery.data for more information
		cache = isNode ? jQuery.cache : elem,
		id = isNode ? elem[ jQuery.expando ] : jQuery.expando;

	// If there is already no cache entry for this object, there is no
	// purpose in continuing
	if ( !cache[ id ] ) {
		return;
	}

	if ( name ) {

		thisCache = pvt ? cache[ id ] : cache[ id ].data;

		if ( thisCache ) {

			// Support array or space separated string names for data keys
			if ( !jQuery.isArray( name ) ) {

				// try the string as a key before any manipulation
				if ( name in thisCache ) {
					name = [ name ];
				} else {

					// split the camel cased version by spaces unless a key with the spaces exists
					name = jQuery.camelCase( name );
					if ( name in thisCache ) {
						name = [ name ];
					} else {
						name = name.split(" ");
					}
				}
			} else {
				// If "name" is an array of keys...
				// When data is initially created, via ("key", "val") signature,
				// keys will be converted to camelCase.
				// Since there is no way to tell _how_ a key was added, remove
				// both plain key and camelCase key. #12786
				// This will only penalize the array argument path.
				name = name.concat( jQuery.map( name, jQuery.camelCase ) );
			}

			i = name.length;
			while ( i-- ) {
				delete thisCache[ name[i] ];
			}

			// If there is no data left in the cache, we want to continue
			// and let the cache object itself get destroyed
			if ( pvt ? !isEmptyDataObject(thisCache) : !jQuery.isEmptyObject(thisCache) ) {
				return;
			}
		}
	}

	// See jQuery.data for more information
	if ( !pvt ) {
		delete cache[ id ].data;

		// Don't destroy the parent cache unless the internal data object
		// had been the only thing left in it
		if ( !isEmptyDataObject( cache[ id ] ) ) {
			return;
		}
	}

	// Destroy the cache
	if ( isNode ) {
		jQuery.cleanData( [ elem ], true );

	// Use delete when supported for expandos or `cache` is not a window per isWindow (#10080)
	/* jshint eqeqeq: false */
	} else if ( support.deleteExpando || cache != cache.window ) {
		/* jshint eqeqeq: true */
		delete cache[ id ];

	// When all else fails, null
	} else {
		cache[ id ] = null;
	}
}

jQuery.extend({
	cache: {},

	// The following elements (space-suffixed to avoid Object.prototype collisions)
	// throw uncatchable exceptions if you attempt to set expando properties
	noData: {
		"applet ": true,
		"embed ": true,
		// ...but Flash objects (which have this classid) *can* handle expandos
		"object ": "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
	},

	hasData: function( elem ) {
		elem = elem.nodeType ? jQuery.cache[ elem[jQuery.expando] ] : elem[ jQuery.expando ];
		return !!elem && !isEmptyDataObject( elem );
	},

	data: function( elem, name, data ) {
		return internalData( elem, name, data );
	},

	removeData: function( elem, name ) {
		return internalRemoveData( elem, name );
	},

	// For internal use only.
	_data: function( elem, name, data ) {
		return internalData( elem, name, data, true );
	},

	_removeData: function( elem, name ) {
		return internalRemoveData( elem, name, true );
	}
});

jQuery.fn.extend({
	data: function( key, value ) {
		var i, name, data,
			elem = this[0],
			attrs = elem && elem.attributes;

		// Special expections of .data basically thwart jQuery.access,
		// so implement the relevant behavior ourselves

		// Gets all values
		if ( key === undefined ) {
			if ( this.length ) {
				data = jQuery.data( elem );

				if ( elem.nodeType === 1 && !jQuery._data( elem, "parsedAttrs" ) ) {
					i = attrs.length;
					while ( i-- ) {
						name = attrs[i].name;

						if ( name.indexOf("data-") === 0 ) {
							name = jQuery.camelCase( name.slice(5) );

							dataAttr( elem, name, data[ name ] );
						}
					}
					jQuery._data( elem, "parsedAttrs", true );
				}
			}

			return data;
		}

		// Sets multiple values
		if ( typeof key === "object" ) {
			return this.each(function() {
				jQuery.data( this, key );
			});
		}

		return arguments.length > 1 ?

			// Sets one value
			this.each(function() {
				jQuery.data( this, key, value );
			}) :

			// Gets one value
			// Try to fetch any internally stored data first
			elem ? dataAttr( elem, key, jQuery.data( elem, key ) ) : undefined;
	},

	removeData: function( key ) {
		return this.each(function() {
			jQuery.removeData( this, key );
		});
	}
});


jQuery.extend({
	queue: function( elem, type, data ) {
		var queue;

		if ( elem ) {
			type = ( type || "fx" ) + "queue";
			queue = jQuery._data( elem, type );

			// Speed up dequeue by getting out quickly if this is just a lookup
			if ( data ) {
				if ( !queue || jQuery.isArray(data) ) {
					queue = jQuery._data( elem, type, jQuery.makeArray(data) );
				} else {
					queue.push( data );
				}
			}
			return queue || [];
		}
	},

	dequeue: function( elem, type ) {
		type = type || "fx";

		var queue = jQuery.queue( elem, type ),
			startLength = queue.length,
			fn = queue.shift(),
			hooks = jQuery._queueHooks( elem, type ),
			next = function() {
				jQuery.dequeue( elem, type );
			};

		// If the fx queue is dequeued, always remove the progress sentinel
		if ( fn === "inprogress" ) {
			fn = queue.shift();
			startLength--;
		}

		if ( fn ) {

			// Add a progress sentinel to prevent the fx queue from being
			// automatically dequeued
			if ( type === "fx" ) {
				queue.unshift( "inprogress" );
			}

			// clear up the last queue stop function
			delete hooks.stop;
			fn.call( elem, next, hooks );
		}

		if ( !startLength && hooks ) {
			hooks.empty.fire();
		}
	},

	// not intended for public consumption - generates a queueHooks object, or returns the current one
	_queueHooks: function( elem, type ) {
		var key = type + "queueHooks";
		return jQuery._data( elem, key ) || jQuery._data( elem, key, {
			empty: jQuery.Callbacks("once memory").add(function() {
				jQuery._removeData( elem, type + "queue" );
				jQuery._removeData( elem, key );
			})
		});
	}
});

jQuery.fn.extend({
	queue: function( type, data ) {
		var setter = 2;

		if ( typeof type !== "string" ) {
			data = type;
			type = "fx";
			setter--;
		}

		if ( arguments.length < setter ) {
			return jQuery.queue( this[0], type );
		}

		return data === undefined ?
			this :
			this.each(function() {
				var queue = jQuery.queue( this, type, data );

				// ensure a hooks for this queue
				jQuery._queueHooks( this, type );

				if ( type === "fx" && queue[0] !== "inprogress" ) {
					jQuery.dequeue( this, type );
				}
			});
	},
	dequeue: function( type ) {
		return this.each(function() {
			jQuery.dequeue( this, type );
		});
	},
	clearQueue: function( type ) {
		return this.queue( type || "fx", [] );
	},
	// Get a promise resolved when queues of a certain type
	// are emptied (fx is the type by default)
	promise: function( type, obj ) {
		var tmp,
			count = 1,
			defer = jQuery.Deferred(),
			elements = this,
			i = this.length,
			resolve = function() {
				if ( !( --count ) ) {
					defer.resolveWith( elements, [ elements ] );
				}
			};

		if ( typeof type !== "string" ) {
			obj = type;
			type = undefined;
		}
		type = type || "fx";

		while ( i-- ) {
			tmp = jQuery._data( elements[ i ], type + "queueHooks" );
			if ( tmp && tmp.empty ) {
				count++;
				tmp.empty.add( resolve );
			}
		}
		resolve();
		return defer.promise( obj );
	}
});
var pnum = (/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/).source;

var cssExpand = [ "Top", "Right", "Bottom", "Left" ];

var isHidden = function( elem, el ) {
		// isHidden might be called from jQuery#filter function;
		// in that case, element will be second argument
		elem = el || elem;
		return jQuery.css( elem, "display" ) === "none" || !jQuery.contains( elem.ownerDocument, elem );
	};



// Multifunctional method to get and set values of a collection
// The value/s can optionally be executed if it's a function
var access = jQuery.access = function( elems, fn, key, value, chainable, emptyGet, raw ) {
	var i = 0,
		length = elems.length,
		bulk = key == null;

	// Sets many values
	if ( jQuery.type( key ) === "object" ) {
		chainable = true;
		for ( i in key ) {
			jQuery.access( elems, fn, i, key[i], true, emptyGet, raw );
		}

	// Sets one value
	} else if ( value !== undefined ) {
		chainable = true;

		if ( !jQuery.isFunction( value ) ) {
			raw = true;
		}

		if ( bulk ) {
			// Bulk operations run against the entire set
			if ( raw ) {
				fn.call( elems, value );
				fn = null;

			// ...except when executing function values
			} else {
				bulk = fn;
				fn = function( elem, key, value ) {
					return bulk.call( jQuery( elem ), value );
				};
			}
		}

		if ( fn ) {
			for ( ; i < length; i++ ) {
				fn( elems[i], key, raw ? value : value.call( elems[i], i, fn( elems[i], key ) ) );
			}
		}
	}

	return chainable ?
		elems :

		// Gets
		bulk ?
			fn.call( elems ) :
			length ? fn( elems[0], key ) : emptyGet;
};
var rcheckableType = (/^(?:checkbox|radio)$/i);



(function() {
	var fragment = document.createDocumentFragment(),
		div = document.createElement("div"),
		input = document.createElement("input");

	// Setup
	div.setAttribute( "className", "t" );
	div.innerHTML = "  <link/><table></table><a href='/a'>a</a>";

	// IE strips leading whitespace when .innerHTML is used
	support.leadingWhitespace = div.firstChild.nodeType === 3;

	// Make sure that tbody elements aren't automatically inserted
	// IE will insert them into empty tables
	support.tbody = !div.getElementsByTagName( "tbody" ).length;

	// Make sure that link elements get serialized correctly by innerHTML
	// This requires a wrapper element in IE
	support.htmlSerialize = !!div.getElementsByTagName( "link" ).length;

	// Makes sure cloning an html5 element does not cause problems
	// Where outerHTML is undefined, this still works
	support.html5Clone =
		document.createElement( "nav" ).cloneNode( true ).outerHTML !== "<:nav></:nav>";

	// Check if a disconnected checkbox will retain its checked
	// value of true after appended to the DOM (IE6/7)
	input.type = "checkbox";
	input.checked = true;
	fragment.appendChild( input );
	support.appendChecked = input.checked;

	// Make sure textarea (and checkbox) defaultValue is properly cloned
	// Support: IE6-IE11+
	div.innerHTML = "<textarea>x</textarea>";
	support.noCloneChecked = !!div.cloneNode( true ).lastChild.defaultValue;

	// #11217 - WebKit loses check when the name is after the checked attribute
	fragment.appendChild( div );
	div.innerHTML = "<input type='radio' checked='checked' name='t'/>";

	// Support: Safari 5.1, iOS 5.1, Android 4.x, Android 2.3
	// old WebKit doesn't clone checked state correctly in fragments
	support.checkClone = div.cloneNode( true ).cloneNode( true ).lastChild.checked;

	// Support: IE<9
	// Opera does not clone events (and typeof div.attachEvent === undefined).
	// IE9-10 clones events bound via attachEvent, but they don't trigger with .click()
	support.noCloneEvent = true;
	if ( div.attachEvent ) {
		div.attachEvent( "onclick", function() {
			support.noCloneEvent = false;
		});

		div.cloneNode( true ).click();
	}

	// Execute the test only if not already executed in another module.
	if (support.deleteExpando == null) {
		// Support: IE<9
		support.deleteExpando = true;
		try {
			delete div.test;
		} catch( e ) {
			support.deleteExpando = false;
		}
	}

	// Null elements to avoid leaks in IE.
	fragment = div = input = null;
})();


(function() {
	var i, eventName,
		div = document.createElement( "div" );

	// Support: IE<9 (lack submit/change bubble), Firefox 23+ (lack focusin event)
	for ( i in { submit: true, change: true, focusin: true }) {
		eventName = "on" + i;

		if ( !(support[ i + "Bubbles" ] = eventName in window) ) {
			// Beware of CSP restrictions (https://developer.mozilla.org/en/Security/CSP)
			div.setAttribute( eventName, "t" );
			support[ i + "Bubbles" ] = div.attributes[ eventName ].expando === false;
		}
	}

	// Null elements to avoid leaks in IE.
	div = null;
})();


var rformElems = /^(?:input|select|textarea)$/i,
	rkeyEvent = /^key/,
	rmouseEvent = /^(?:mouse|contextmenu)|click/,
	rfocusMorph = /^(?:focusinfocus|focusoutblur)$/,
	rtypenamespace = /^([^.]*)(?:\.(.+)|)$/;

function returnTrue() {
	return true;
}

function returnFalse() {
	return false;
}

function safeActiveElement() {
	try {
		return document.activeElement;
	} catch ( err ) { }
}

/*
 * Helper functions for managing events -- not part of the public interface.
 * Props to Dean Edwards' addEvent library for many of the ideas.
 */
jQuery.event = {

	global: {},

	add: function( elem, types, handler, data, selector ) {
		var tmp, events, t, handleObjIn,
			special, eventHandle, handleObj,
			handlers, type, namespaces, origType,
			elemData = jQuery._data( elem );

		// Don't attach events to noData or text/comment nodes (but allow plain objects)
		if ( !elemData ) {
			return;
		}

		// Caller can pass in an object of custom data in lieu of the handler
		if ( handler.handler ) {
			handleObjIn = handler;
			handler = handleObjIn.handler;
			selector = handleObjIn.selector;
		}

		// Make sure that the handler has a unique ID, used to find/remove it later
		if ( !handler.guid ) {
			handler.guid = jQuery.guid++;
		}

		// Init the element's event structure and main handler, if this is the first
		if ( !(events = elemData.events) ) {
			events = elemData.events = {};
		}
		if ( !(eventHandle = elemData.handle) ) {
			eventHandle = elemData.handle = function( e ) {
				// Discard the second event of a jQuery.event.trigger() and
				// when an event is called after a page has unloaded
				return typeof jQuery !== strundefined && (!e || jQuery.event.triggered !== e.type) ?
					jQuery.event.dispatch.apply( eventHandle.elem, arguments ) :
					undefined;
			};
			// Add elem as a property of the handle fn to prevent a memory leak with IE non-native events
			eventHandle.elem = elem;
		}

		// Handle multiple events separated by a space
		types = ( types || "" ).match( rnotwhite ) || [ "" ];
		t = types.length;
		while ( t-- ) {
			tmp = rtypenamespace.exec( types[t] ) || [];
			type = origType = tmp[1];
			namespaces = ( tmp[2] || "" ).split( "." ).sort();

			// There *must* be a type, no attaching namespace-only handlers
			if ( !type ) {
				continue;
			}

			// If event changes its type, use the special event handlers for the changed type
			special = jQuery.event.special[ type ] || {};

			// If selector defined, determine special event api type, otherwise given type
			type = ( selector ? special.delegateType : special.bindType ) || type;

			// Update special based on newly reset type
			special = jQuery.event.special[ type ] || {};

			// handleObj is passed to all event handlers
			handleObj = jQuery.extend({
				type: type,
				origType: origType,
				data: data,
				handler: handler,
				guid: handler.guid,
				selector: selector,
				needsContext: selector && jQuery.expr.match.needsContext.test( selector ),
				namespace: namespaces.join(".")
			}, handleObjIn );

			// Init the event handler queue if we're the first
			if ( !(handlers = events[ type ]) ) {
				handlers = events[ type ] = [];
				handlers.delegateCount = 0;

				// Only use addEventListener/attachEvent if the special events handler returns false
				if ( !special.setup || special.setup.call( elem, data, namespaces, eventHandle ) === false ) {
					// Bind the global event handler to the element
					if ( elem.addEventListener ) {
						elem.addEventListener( type, eventHandle, false );

					} else if ( elem.attachEvent ) {
						elem.attachEvent( "on" + type, eventHandle );
					}
				}
			}

			if ( special.add ) {
				special.add.call( elem, handleObj );

				if ( !handleObj.handler.guid ) {
					handleObj.handler.guid = handler.guid;
				}
			}

			// Add to the element's handler list, delegates in front
			if ( selector ) {
				handlers.splice( handlers.delegateCount++, 0, handleObj );
			} else {
				handlers.push( handleObj );
			}

			// Keep track of which events have ever been used, for event optimization
			jQuery.event.global[ type ] = true;
		}

		// Nullify elem to prevent memory leaks in IE
		elem = null;
	},

	// Detach an event or set of events from an element
	remove: function( elem, types, handler, selector, mappedTypes ) {
		var j, handleObj, tmp,
			origCount, t, events,
			special, handlers, type,
			namespaces, origType,
			elemData = jQuery.hasData( elem ) && jQuery._data( elem );

		if ( !elemData || !(events = elemData.events) ) {
			return;
		}

		// Once for each type.namespace in types; type may be omitted
		types = ( types || "" ).match( rnotwhite ) || [ "" ];
		t = types.length;
		while ( t-- ) {
			tmp = rtypenamespace.exec( types[t] ) || [];
			type = origType = tmp[1];
			namespaces = ( tmp[2] || "" ).split( "." ).sort();

			// Unbind all events (on this namespace, if provided) for the element
			if ( !type ) {
				for ( type in events ) {
					jQuery.event.remove( elem, type + types[ t ], handler, selector, true );
				}
				continue;
			}

			special = jQuery.event.special[ type ] || {};
			type = ( selector ? special.delegateType : special.bindType ) || type;
			handlers = events[ type ] || [];
			tmp = tmp[2] && new RegExp( "(^|\\.)" + namespaces.join("\\.(?:.*\\.|)") + "(\\.|$)" );

			// Remove matching events
			origCount = j = handlers.length;
			while ( j-- ) {
				handleObj = handlers[ j ];

				if ( ( mappedTypes || origType === handleObj.origType ) &&
					( !handler || handler.guid === handleObj.guid ) &&
					( !tmp || tmp.test( handleObj.namespace ) ) &&
					( !selector || selector === handleObj.selector || selector === "**" && handleObj.selector ) ) {
					handlers.splice( j, 1 );

					if ( handleObj.selector ) {
						handlers.delegateCount--;
					}
					if ( special.remove ) {
						special.remove.call( elem, handleObj );
					}
				}
			}

			// Remove generic event handler if we removed something and no more handlers exist
			// (avoids potential for endless recursion during removal of special event handlers)
			if ( origCount && !handlers.length ) {
				if ( !special.teardown || special.teardown.call( elem, namespaces, elemData.handle ) === false ) {
					jQuery.removeEvent( elem, type, elemData.handle );
				}

				delete events[ type ];
			}
		}

		// Remove the expando if it's no longer used
		if ( jQuery.isEmptyObject( events ) ) {
			delete elemData.handle;

			// removeData also checks for emptiness and clears the expando if empty
			// so use it instead of delete
			jQuery._removeData( elem, "events" );
		}
	},

	trigger: function( event, data, elem, onlyHandlers ) {
		var handle, ontype, cur,
			bubbleType, special, tmp, i,
			eventPath = [ elem || document ],
			type = hasOwn.call( event, "type" ) ? event.type : event,
			namespaces = hasOwn.call( event, "namespace" ) ? event.namespace.split(".") : [];

		cur = tmp = elem = elem || document;

		// Don't do events on text and comment nodes
		if ( elem.nodeType === 3 || elem.nodeType === 8 ) {
			return;
		}

		// focus/blur morphs to focusin/out; ensure we're not firing them right now
		if ( rfocusMorph.test( type + jQuery.event.triggered ) ) {
			return;
		}

		if ( type.indexOf(".") >= 0 ) {
			// Namespaced trigger; create a regexp to match event type in handle()
			namespaces = type.split(".");
			type = namespaces.shift();
			namespaces.sort();
		}
		ontype = type.indexOf(":") < 0 && "on" + type;

		// Caller can pass in a jQuery.Event object, Object, or just an event type string
		event = event[ jQuery.expando ] ?
			event :
			new jQuery.Event( type, typeof event === "object" && event );

		// Trigger bitmask: & 1 for native handlers; & 2 for jQuery (always true)
		event.isTrigger = onlyHandlers ? 2 : 3;
		event.namespace = namespaces.join(".");
		event.namespace_re = event.namespace ?
			new RegExp( "(^|\\.)" + namespaces.join("\\.(?:.*\\.|)") + "(\\.|$)" ) :
			null;

		// Clean up the event in case it is being reused
		event.result = undefined;
		if ( !event.target ) {
			event.target = elem;
		}

		// Clone any incoming data and prepend the event, creating the handler arg list
		data = data == null ?
			[ event ] :
			jQuery.makeArray( data, [ event ] );

		// Allow special events to draw outside the lines
		special = jQuery.event.special[ type ] || {};
		if ( !onlyHandlers && special.trigger && special.trigger.apply( elem, data ) === false ) {
			return;
		}

		// Determine event propagation path in advance, per W3C events spec (#9951)
		// Bubble up to document, then to window; watch for a global ownerDocument var (#9724)
		if ( !onlyHandlers && !special.noBubble && !jQuery.isWindow( elem ) ) {

			bubbleType = special.delegateType || type;
			if ( !rfocusMorph.test( bubbleType + type ) ) {
				cur = cur.parentNode;
			}
			for ( ; cur; cur = cur.parentNode ) {
				eventPath.push( cur );
				tmp = cur;
			}

			// Only add window if we got to document (e.g., not plain obj or detached DOM)
			if ( tmp === (elem.ownerDocument || document) ) {
				eventPath.push( tmp.defaultView || tmp.parentWindow || window );
			}
		}

		// Fire handlers on the event path
		i = 0;
		while ( (cur = eventPath[i++]) && !event.isPropagationStopped() ) {

			event.type = i > 1 ?
				bubbleType :
				special.bindType || type;

			// jQuery handler
			handle = ( jQuery._data( cur, "events" ) || {} )[ event.type ] && jQuery._data( cur, "handle" );
			if ( handle ) {
				handle.apply( cur, data );
			}

			// Native handler
			handle = ontype && cur[ ontype ];
			if ( handle && handle.apply && jQuery.acceptData( cur ) ) {
				event.result = handle.apply( cur, data );
				if ( event.result === false ) {
					event.preventDefault();
				}
			}
		}
		event.type = type;

		// If nobody prevented the default action, do it now
		if ( !onlyHandlers && !event.isDefaultPrevented() ) {

			if ( (!special._default || special._default.apply( eventPath.pop(), data ) === false) &&
				jQuery.acceptData( elem ) ) {

				// Call a native DOM method on the target with the same name name as the event.
				// Can't use an .isFunction() check here because IE6/7 fails that test.
				// Don't do default actions on window, that's where global variables be (#6170)
				if ( ontype && elem[ type ] && !jQuery.isWindow( elem ) ) {

					// Don't re-trigger an onFOO event when we call its FOO() method
					tmp = elem[ ontype ];

					if ( tmp ) {
						elem[ ontype ] = null;
					}

					// Prevent re-triggering of the same event, since we already bubbled it above
					jQuery.event.triggered = type;
					try {
						elem[ type ]();
					} catch ( e ) {
						// IE<9 dies on focus/blur to hidden element (#1486,#12518)
						// only reproducible on winXP IE8 native, not IE9 in IE8 mode
					}
					jQuery.event.triggered = undefined;

					if ( tmp ) {
						elem[ ontype ] = tmp;
					}
				}
			}
		}

		return event.result;
	},

	dispatch: function( event ) {

		// Make a writable jQuery.Event from the native event object
		event = jQuery.event.fix( event );

		var i, ret, handleObj, matched, j,
			handlerQueue = [],
			args = slice.call( arguments ),
			handlers = ( jQuery._data( this, "events" ) || {} )[ event.type ] || [],
			special = jQuery.event.special[ event.type ] || {};

		// Use the fix-ed jQuery.Event rather than the (read-only) native event
		args[0] = event;
		event.delegateTarget = this;

		// Call the preDispatch hook for the mapped type, and let it bail if desired
		if ( special.preDispatch && special.preDispatch.call( this, event ) === false ) {
			return;
		}

		// Determine handlers
		handlerQueue = jQuery.event.handlers.call( this, event, handlers );

		// Run delegates first; they may want to stop propagation beneath us
		i = 0;
		while ( (matched = handlerQueue[ i++ ]) && !event.isPropagationStopped() ) {
			event.currentTarget = matched.elem;

			j = 0;
			while ( (handleObj = matched.handlers[ j++ ]) && !event.isImmediatePropagationStopped() ) {

				// Triggered event must either 1) have no namespace, or
				// 2) have namespace(s) a subset or equal to those in the bound event (both can have no namespace).
				if ( !event.namespace_re || event.namespace_re.test( handleObj.namespace ) ) {

					event.handleObj = handleObj;
					event.data = handleObj.data;

					ret = ( (jQuery.event.special[ handleObj.origType ] || {}).handle || handleObj.handler )
							.apply( matched.elem, args );

					if ( ret !== undefined ) {
						if ( (event.result = ret) === false ) {
							event.preventDefault();
							event.stopPropagation();
						}
					}
				}
			}
		}

		// Call the postDispatch hook for the mapped type
		if ( special.postDispatch ) {
			special.postDispatch.call( this, event );
		}

		return event.result;
	},

	handlers: function( event, handlers ) {
		var sel, handleObj, matches, i,
			handlerQueue = [],
			delegateCount = handlers.delegateCount,
			cur = event.target;

		// Find delegate handlers
		// Black-hole SVG <use> instance trees (#13180)
		// Avoid non-left-click bubbling in Firefox (#3861)
		if ( delegateCount && cur.nodeType && (!event.button || event.type !== "click") ) {

			/* jshint eqeqeq: false */
			for ( ; cur != this; cur = cur.parentNode || this ) {
				/* jshint eqeqeq: true */

				// Don't check non-elements (#13208)
				// Don't process clicks on disabled elements (#6911, #8165, #11382, #11764)
				if ( cur.nodeType === 1 && (cur.disabled !== true || event.type !== "click") ) {
					matches = [];
					for ( i = 0; i < delegateCount; i++ ) {
						handleObj = handlers[ i ];

						// Don't conflict with Object.prototype properties (#13203)
						sel = handleObj.selector + " ";

						if ( matches[ sel ] === undefined ) {
							matches[ sel ] = handleObj.needsContext ?
								jQuery( sel, this ).index( cur ) >= 0 :
								jQuery.find( sel, this, null, [ cur ] ).length;
						}
						if ( matches[ sel ] ) {
							matches.push( handleObj );
						}
					}
					if ( matches.length ) {
						handlerQueue.push({ elem: cur, handlers: matches });
					}
				}
			}
		}

		// Add the remaining (directly-bound) handlers
		if ( delegateCount < handlers.length ) {
			handlerQueue.push({ elem: this, handlers: handlers.slice( delegateCount ) });
		}

		return handlerQueue;
	},

	fix: function( event ) {
		if ( event[ jQuery.expando ] ) {
			return event;
		}

		// Create a writable copy of the event object and normalize some properties
		var i, prop, copy,
			type = event.type,
			originalEvent = event,
			fixHook = this.fixHooks[ type ];

		if ( !fixHook ) {
			this.fixHooks[ type ] = fixHook =
				rmouseEvent.test( type ) ? this.mouseHooks :
				rkeyEvent.test( type ) ? this.keyHooks :
				{};
		}
		copy = fixHook.props ? this.props.concat( fixHook.props ) : this.props;

		event = new jQuery.Event( originalEvent );

		i = copy.length;
		while ( i-- ) {
			prop = copy[ i ];
			event[ prop ] = originalEvent[ prop ];
		}

		// Support: IE<9
		// Fix target property (#1925)
		if ( !event.target ) {
			event.target = originalEvent.srcElement || document;
		}

		// Support: Chrome 23+, Safari?
		// Target should not be a text node (#504, #13143)
		if ( event.target.nodeType === 3 ) {
			event.target = event.target.parentNode;
		}

		// Support: IE<9
		// For mouse/key events, metaKey==false if it's undefined (#3368, #11328)
		event.metaKey = !!event.metaKey;

		return fixHook.filter ? fixHook.filter( event, originalEvent ) : event;
	},

	// Includes some event props shared by KeyEvent and MouseEvent
	props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),

	fixHooks: {},

	keyHooks: {
		props: "char charCode key keyCode".split(" "),
		filter: function( event, original ) {

			// Add which for key events
			if ( event.which == null ) {
				event.which = original.charCode != null ? original.charCode : original.keyCode;
			}

			return event;
		}
	},

	mouseHooks: {
		props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
		filter: function( event, original ) {
			var body, eventDoc, doc,
				button = original.button,
				fromElement = original.fromElement;

			// Calculate pageX/Y if missing and clientX/Y available
			if ( event.pageX == null && original.clientX != null ) {
				eventDoc = event.target.ownerDocument || document;
				doc = eventDoc.documentElement;
				body = eventDoc.body;

				event.pageX = original.clientX + ( doc && doc.scrollLeft || body && body.scrollLeft || 0 ) - ( doc && doc.clientLeft || body && body.clientLeft || 0 );
				event.pageY = original.clientY + ( doc && doc.scrollTop  || body && body.scrollTop  || 0 ) - ( doc && doc.clientTop  || body && body.clientTop  || 0 );
			}

			// Add relatedTarget, if necessary
			if ( !event.relatedTarget && fromElement ) {
				event.relatedTarget = fromElement === event.target ? original.toElement : fromElement;
			}

			// Add which for click: 1 === left; 2 === middle; 3 === right
			// Note: button is not normalized, so don't use it
			if ( !event.which && button !== undefined ) {
				event.which = ( button & 1 ? 1 : ( button & 2 ? 3 : ( button & 4 ? 2 : 0 ) ) );
			}

			return event;
		}
	},

	special: {
		load: {
			// Prevent triggered image.load events from bubbling to window.load
			noBubble: true
		},
		focus: {
			// Fire native event if possible so blur/focus sequence is correct
			trigger: function() {
				if ( this !== safeActiveElement() && this.focus ) {
					try {
						this.focus();
						return false;
					} catch ( e ) {
						// Support: IE<9
						// If we error on focus to hidden element (#1486, #12518),
						// let .trigger() run the handlers
					}
				}
			},
			delegateType: "focusin"
		},
		blur: {
			trigger: function() {
				if ( this === safeActiveElement() && this.blur ) {
					this.blur();
					return false;
				}
			},
			delegateType: "focusout"
		},
		click: {
			// For checkbox, fire native event so checked state will be right
			trigger: function() {
				if ( jQuery.nodeName( this, "input" ) && this.type === "checkbox" && this.click ) {
					this.click();
					return false;
				}
			},

			// For cross-browser consistency, don't fire native .click() on links
			_default: function( event ) {
				return jQuery.nodeName( event.target, "a" );
			}
		},

		beforeunload: {
			postDispatch: function( event ) {

				// Even when returnValue equals to undefined Firefox will still show alert
				if ( event.result !== undefined ) {
					event.originalEvent.returnValue = event.result;
				}
			}
		}
	},

	simulate: function( type, elem, event, bubble ) {
		// Piggyback on a donor event to simulate a different one.
		// Fake originalEvent to avoid donor's stopPropagation, but if the
		// simulated event prevents default then we do the same on the donor.
		var e = jQuery.extend(
			new jQuery.Event(),
			event,
			{
				type: type,
				isSimulated: true,
				originalEvent: {}
			}
		);
		if ( bubble ) {
			jQuery.event.trigger( e, null, elem );
		} else {
			jQuery.event.dispatch.call( elem, e );
		}
		if ( e.isDefaultPrevented() ) {
			event.preventDefault();
		}
	}
};

jQuery.removeEvent = document.removeEventListener ?
	function( elem, type, handle ) {
		if ( elem.removeEventListener ) {
			elem.removeEventListener( type, handle, false );
		}
	} :
	function( elem, type, handle ) {
		var name = "on" + type;

		if ( elem.detachEvent ) {

			// #8545, #7054, preventing memory leaks for custom events in IE6-8
			// detachEvent needed property on element, by name of that event, to properly expose it to GC
			if ( typeof elem[ name ] === strundefined ) {
				elem[ name ] = null;
			}

			elem.detachEvent( name, handle );
		}
	};

jQuery.Event = function( src, props ) {
	// Allow instantiation without the 'new' keyword
	if ( !(this instanceof jQuery.Event) ) {
		return new jQuery.Event( src, props );
	}

	// Event object
	if ( src && src.type ) {
		this.originalEvent = src;
		this.type = src.type;

		// Events bubbling up the document may have been marked as prevented
		// by a handler lower down the tree; reflect the correct value.
		this.isDefaultPrevented = src.defaultPrevented ||
				src.defaultPrevented === undefined && (
				// Support: IE < 9
				src.returnValue === false ||
				// Support: Android < 4.0
				src.getPreventDefault && src.getPreventDefault() ) ?
			returnTrue :
			returnFalse;

	// Event type
	} else {
		this.type = src;
	}

	// Put explicitly provided properties onto the event object
	if ( props ) {
		jQuery.extend( this, props );
	}

	// Create a timestamp if incoming event doesn't have one
	this.timeStamp = src && src.timeStamp || jQuery.now();

	// Mark it as fixed
	this[ jQuery.expando ] = true;
};

// jQuery.Event is based on DOM3 Events as specified by the ECMAScript Language Binding
// http://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html
jQuery.Event.prototype = {
	isDefaultPrevented: returnFalse,
	isPropagationStopped: returnFalse,
	isImmediatePropagationStopped: returnFalse,

	preventDefault: function() {
		var e = this.originalEvent;

		this.isDefaultPrevented = returnTrue;
		if ( !e ) {
			return;
		}

		// If preventDefault exists, run it on the original event
		if ( e.preventDefault ) {
			e.preventDefault();

		// Support: IE
		// Otherwise set the returnValue property of the original event to false
		} else {
			e.returnValue = false;
		}
	},
	stopPropagation: function() {
		var e = this.originalEvent;

		this.isPropagationStopped = returnTrue;
		if ( !e ) {
			return;
		}
		// If stopPropagation exists, run it on the original event
		if ( e.stopPropagation ) {
			e.stopPropagation();
		}

		// Support: IE
		// Set the cancelBubble property of the original event to true
		e.cancelBubble = true;
	},
	stopImmediatePropagation: function() {
		this.isImmediatePropagationStopped = returnTrue;
		this.stopPropagation();
	}
};

// Create mouseenter/leave events using mouseover/out and event-time checks
jQuery.each({
	mouseenter: "mouseover",
	mouseleave: "mouseout"
}, function( orig, fix ) {
	jQuery.event.special[ orig ] = {
		delegateType: fix,
		bindType: fix,

		handle: function( event ) {
			var ret,
				target = this,
				related = event.relatedTarget,
				handleObj = event.handleObj;

			// For mousenter/leave call the handler if related is outside the target.
			// NB: No relatedTarget if the mouse left/entered the browser window
			if ( !related || (related !== target && !jQuery.contains( target, related )) ) {
				event.type = handleObj.origType;
				ret = handleObj.handler.apply( this, arguments );
				event.type = fix;
			}
			return ret;
		}
	};
});

// IE submit delegation
if ( !support.submitBubbles ) {

	jQuery.event.special.submit = {
		setup: function() {
			// Only need this for delegated form submit events
			if ( jQuery.nodeName( this, "form" ) ) {
				return false;
			}

			// Lazy-add a submit handler when a descendant form may potentially be submitted
			jQuery.event.add( this, "click._submit keypress._submit", function( e ) {
				// Node name check avoids a VML-related crash in IE (#9807)
				var elem = e.target,
					form = jQuery.nodeName( elem, "input" ) || jQuery.nodeName( elem, "button" ) ? elem.form : undefined;
				if ( form && !jQuery._data( form, "submitBubbles" ) ) {
					jQuery.event.add( form, "submit._submit", function( event ) {
						event._submit_bubble = true;
					});
					jQuery._data( form, "submitBubbles", true );
				}
			});
			// return undefined since we don't need an event listener
		},

		postDispatch: function( event ) {
			// If form was submitted by the user, bubble the event up the tree
			if ( event._submit_bubble ) {
				delete event._submit_bubble;
				if ( this.parentNode && !event.isTrigger ) {
					jQuery.event.simulate( "submit", this.parentNode, event, true );
				}
			}
		},

		teardown: function() {
			// Only need this for delegated form submit events
			if ( jQuery.nodeName( this, "form" ) ) {
				return false;
			}

			// Remove delegated handlers; cleanData eventually reaps submit handlers attached above
			jQuery.event.remove( this, "._submit" );
		}
	};
}

// IE change delegation and checkbox/radio fix
if ( !support.changeBubbles ) {

	jQuery.event.special.change = {

		setup: function() {

			if ( rformElems.test( this.nodeName ) ) {
				// IE doesn't fire change on a check/radio until blur; trigger it on click
				// after a propertychange. Eat the blur-change in special.change.handle.
				// This still fires onchange a second time for check/radio after blur.
				if ( this.type === "checkbox" || this.type === "radio" ) {
					jQuery.event.add( this, "propertychange._change", function( event ) {
						if ( event.originalEvent.propertyName === "checked" ) {
							this._just_changed = true;
						}
					});
					jQuery.event.add( this, "click._change", function( event ) {
						if ( this._just_changed && !event.isTrigger ) {
							this._just_changed = false;
						}
						// Allow triggered, simulated change events (#11500)
						jQuery.event.simulate( "change", this, event, true );
					});
				}
				return false;
			}
			// Delegated event; lazy-add a change handler on descendant inputs
			jQuery.event.add( this, "beforeactivate._change", function( e ) {
				var elem = e.target;

				if ( rformElems.test( elem.nodeName ) && !jQuery._data( elem, "changeBubbles" ) ) {
					jQuery.event.add( elem, "change._change", function( event ) {
						if ( this.parentNode && !event.isSimulated && !event.isTrigger ) {
							jQuery.event.simulate( "change", this.parentNode, event, true );
						}
					});
					jQuery._data( elem, "changeBubbles", true );
				}
			});
		},

		handle: function( event ) {
			var elem = event.target;

			// Swallow native change events from checkbox/radio, we already triggered them above
			if ( this !== elem || event.isSimulated || event.isTrigger || (elem.type !== "radio" && elem.type !== "checkbox") ) {
				return event.handleObj.handler.apply( this, arguments );
			}
		},

		teardown: function() {
			jQuery.event.remove( this, "._change" );

			return !rformElems.test( this.nodeName );
		}
	};
}

// Create "bubbling" focus and blur events
if ( !support.focusinBubbles ) {
	jQuery.each({ focus: "focusin", blur: "focusout" }, function( orig, fix ) {

		// Attach a single capturing handler on the document while someone wants focusin/focusout
		var handler = function( event ) {
				jQuery.event.simulate( fix, event.target, jQuery.event.fix( event ), true );
			};

		jQuery.event.special[ fix ] = {
			setup: function() {
				var doc = this.ownerDocument || this,
					attaches = jQuery._data( doc, fix );

				if ( !attaches ) {
					doc.addEventListener( orig, handler, true );
				}
				jQuery._data( doc, fix, ( attaches || 0 ) + 1 );
			},
			teardown: function() {
				var doc = this.ownerDocument || this,
					attaches = jQuery._data( doc, fix ) - 1;

				if ( !attaches ) {
					doc.removeEventListener( orig, handler, true );
					jQuery._removeData( doc, fix );
				} else {
					jQuery._data( doc, fix, attaches );
				}
			}
		};
	});
}

jQuery.fn.extend({

	on: function( types, selector, data, fn, /*INTERNAL*/ one ) {
		var type, origFn;

		// Types can be a map of types/handlers
		if ( typeof types === "object" ) {
			// ( types-Object, selector, data )
			if ( typeof selector !== "string" ) {
				// ( types-Object, data )
				data = data || selector;
				selector = undefined;
			}
			for ( type in types ) {
				this.on( type, selector, data, types[ type ], one );
			}
			return this;
		}

		if ( data == null && fn == null ) {
			// ( types, fn )
			fn = selector;
			data = selector = undefined;
		} else if ( fn == null ) {
			if ( typeof selector === "string" ) {
				// ( types, selector, fn )
				fn = data;
				data = undefined;
			} else {
				// ( types, data, fn )
				fn = data;
				data = selector;
				selector = undefined;
			}
		}
		if ( fn === false ) {
			fn = returnFalse;
		} else if ( !fn ) {
			return this;
		}

		if ( one === 1 ) {
			origFn = fn;
			fn = function( event ) {
				// Can use an empty set, since event contains the info
				jQuery().off( event );
				return origFn.apply( this, arguments );
			};
			// Use same guid so caller can remove using origFn
			fn.guid = origFn.guid || ( origFn.guid = jQuery.guid++ );
		}
		return this.each( function() {
			jQuery.event.add( this, types, fn, data, selector );
		});
	},
	one: function( types, selector, data, fn ) {
		return this.on( types, selector, data, fn, 1 );
	},
	off: function( types, selector, fn ) {
		var handleObj, type;
		if ( types && types.preventDefault && types.handleObj ) {
			// ( event )  dispatched jQuery.Event
			handleObj = types.handleObj;
			jQuery( types.delegateTarget ).off(
				handleObj.namespace ? handleObj.origType + "." + handleObj.namespace : handleObj.origType,
				handleObj.selector,
				handleObj.handler
			);
			return this;
		}
		if ( typeof types === "object" ) {
			// ( types-object [, selector] )
			for ( type in types ) {
				this.off( type, selector, types[ type ] );
			}
			return this;
		}
		if ( selector === false || typeof selector === "function" ) {
			// ( types [, fn] )
			fn = selector;
			selector = undefined;
		}
		if ( fn === false ) {
			fn = returnFalse;
		}
		return this.each(function() {
			jQuery.event.remove( this, types, fn, selector );
		});
	},

	trigger: function( type, data ) {
		return this.each(function() {
			jQuery.event.trigger( type, data, this );
		});
	},
	triggerHandler: function( type, data ) {
		var elem = this[0];
		if ( elem ) {
			return jQuery.event.trigger( type, data, elem, true );
		}
	}
});


function createSafeFragment( document ) {
	var list = nodeNames.split( "|" ),
		safeFrag = document.createDocumentFragment();

	if ( safeFrag.createElement ) {
		while ( list.length ) {
			safeFrag.createElement(
				list.pop()
			);
		}
	}
	return safeFrag;
}

var nodeNames = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|" +
		"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",
	rinlinejQuery = / jQuery\d+="(?:null|\d+)"/g,
	rnoshimcache = new RegExp("<(?:" + nodeNames + ")[\\s/>]", "i"),
	rleadingWhitespace = /^\s+/,
	rxhtmlTag = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,
	rtagName = /<([\w:]+)/,
	rtbody = /<tbody/i,
	rhtml = /<|&#?\w+;/,
	rnoInnerhtml = /<(?:script|style|link)/i,
	// checked="checked" or checked
	rchecked = /checked\s*(?:[^=]|=\s*.checked.)/i,
	rscriptType = /^$|\/(?:java|ecma)script/i,
	rscriptTypeMasked = /^true\/(.*)/,
	rcleanScript = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,

	// We have to close these tags to support XHTML (#13200)
	wrapMap = {
		option: [ 1, "<select multiple='multiple'>", "</select>" ],
		legend: [ 1, "<fieldset>", "</fieldset>" ],
		area: [ 1, "<map>", "</map>" ],
		param: [ 1, "<object>", "</object>" ],
		thead: [ 1, "<table>", "</table>" ],
		tr: [ 2, "<table><tbody>", "</tbody></table>" ],
		col: [ 2, "<table><tbody></tbody><colgroup>", "</colgroup></table>" ],
		td: [ 3, "<table><tbody><tr>", "</tr></tbody></table>" ],

		// IE6-8 can't serialize link, script, style, or any html5 (NoScope) tags,
		// unless wrapped in a div with non-breaking characters in front of it.
		_default: support.htmlSerialize ? [ 0, "", "" ] : [ 1, "X<div>", "</div>"  ]
	},
	safeFragment = createSafeFragment( document ),
	fragmentDiv = safeFragment.appendChild( document.createElement("div") );

wrapMap.optgroup = wrapMap.option;
wrapMap.tbody = wrapMap.tfoot = wrapMap.colgroup = wrapMap.caption = wrapMap.thead;
wrapMap.th = wrapMap.td;

function getAll( context, tag ) {
	var elems, elem,
		i = 0,
		found = typeof context.getElementsByTagName !== strundefined ? context.getElementsByTagName( tag || "*" ) :
			typeof context.querySelectorAll !== strundefined ? context.querySelectorAll( tag || "*" ) :
			undefined;

	if ( !found ) {
		for ( found = [], elems = context.childNodes || context; (elem = elems[i]) != null; i++ ) {
			if ( !tag || jQuery.nodeName( elem, tag ) ) {
				found.push( elem );
			} else {
				jQuery.merge( found, getAll( elem, tag ) );
			}
		}
	}

	return tag === undefined || tag && jQuery.nodeName( context, tag ) ?
		jQuery.merge( [ context ], found ) :
		found;
}

// Used in buildFragment, fixes the defaultChecked property
function fixDefaultChecked( elem ) {
	if ( rcheckableType.test( elem.type ) ) {
		elem.defaultChecked = elem.checked;
	}
}

// Support: IE<8
// Manipulating tables requires a tbody
function manipulationTarget( elem, content ) {
	return jQuery.nodeName( elem, "table" ) &&
		jQuery.nodeName( content.nodeType !== 11 ? content : content.firstChild, "tr" ) ?

		elem.getElementsByTagName("tbody")[0] ||
			elem.appendChild( elem.ownerDocument.createElement("tbody") ) :
		elem;
}

// Replace/restore the type attribute of script elements for safe DOM manipulation
function disableScript( elem ) {
	elem.type = (jQuery.find.attr( elem, "type" ) !== null) + "/" + elem.type;
	return elem;
}
function restoreScript( elem ) {
	var match = rscriptTypeMasked.exec( elem.type );
	if ( match ) {
		elem.type = match[1];
	} else {
		elem.removeAttribute("type");
	}
	return elem;
}

// Mark scripts as having already been evaluated
function setGlobalEval( elems, refElements ) {
	var elem,
		i = 0;
	for ( ; (elem = elems[i]) != null; i++ ) {
		jQuery._data( elem, "globalEval", !refElements || jQuery._data( refElements[i], "globalEval" ) );
	}
}

function cloneCopyEvent( src, dest ) {

	if ( dest.nodeType !== 1 || !jQuery.hasData( src ) ) {
		return;
	}

	var type, i, l,
		oldData = jQuery._data( src ),
		curData = jQuery._data( dest, oldData ),
		events = oldData.events;

	if ( events ) {
		delete curData.handle;
		curData.events = {};

		for ( type in events ) {
			for ( i = 0, l = events[ type ].length; i < l; i++ ) {
				jQuery.event.add( dest, type, events[ type ][ i ] );
			}
		}
	}

	// make the cloned public data object a copy from the original
	if ( curData.data ) {
		curData.data = jQuery.extend( {}, curData.data );
	}
}

function fixCloneNodeIssues( src, dest ) {
	var nodeName, e, data;

	// We do not need to do anything for non-Elements
	if ( dest.nodeType !== 1 ) {
		return;
	}

	nodeName = dest.nodeName.toLowerCase();

	// IE6-8 copies events bound via attachEvent when using cloneNode.
	if ( !support.noCloneEvent && dest[ jQuery.expando ] ) {
		data = jQuery._data( dest );

		for ( e in data.events ) {
			jQuery.removeEvent( dest, e, data.handle );
		}

		// Event data gets referenced instead of copied if the expando gets copied too
		dest.removeAttribute( jQuery.expando );
	}

	// IE blanks contents when cloning scripts, and tries to evaluate newly-set text
	if ( nodeName === "script" && dest.text !== src.text ) {
		disableScript( dest ).text = src.text;
		restoreScript( dest );

	// IE6-10 improperly clones children of object elements using classid.
	// IE10 throws NoModificationAllowedError if parent is null, #12132.
	} else if ( nodeName === "object" ) {
		if ( dest.parentNode ) {
			dest.outerHTML = src.outerHTML;
		}

		// This path appears unavoidable for IE9. When cloning an object
		// element in IE9, the outerHTML strategy above is not sufficient.
		// If the src has innerHTML and the destination does not,
		// copy the src.innerHTML into the dest.innerHTML. #10324
		if ( support.html5Clone && ( src.innerHTML && !jQuery.trim(dest.innerHTML) ) ) {
			dest.innerHTML = src.innerHTML;
		}

	} else if ( nodeName === "input" && rcheckableType.test( src.type ) ) {
		// IE6-8 fails to persist the checked state of a cloned checkbox
		// or radio button. Worse, IE6-7 fail to give the cloned element
		// a checked appearance if the defaultChecked value isn't also set

		dest.defaultChecked = dest.checked = src.checked;

		// IE6-7 get confused and end up setting the value of a cloned
		// checkbox/radio button to an empty string instead of "on"
		if ( dest.value !== src.value ) {
			dest.value = src.value;
		}

	// IE6-8 fails to return the selected option to the default selected
	// state when cloning options
	} else if ( nodeName === "option" ) {
		dest.defaultSelected = dest.selected = src.defaultSelected;

	// IE6-8 fails to set the defaultValue to the correct value when
	// cloning other types of input fields
	} else if ( nodeName === "input" || nodeName === "textarea" ) {
		dest.defaultValue = src.defaultValue;
	}
}

jQuery.extend({
	clone: function( elem, dataAndEvents, deepDataAndEvents ) {
		var destElements, node, clone, i, srcElements,
			inPage = jQuery.contains( elem.ownerDocument, elem );

		if ( support.html5Clone || jQuery.isXMLDoc(elem) || !rnoshimcache.test( "<" + elem.nodeName + ">" ) ) {
			clone = elem.cloneNode( true );

		// IE<=8 does not properly clone detached, unknown element nodes
		} else {
			fragmentDiv.innerHTML = elem.outerHTML;
			fragmentDiv.removeChild( clone = fragmentDiv.firstChild );
		}

		if ( (!support.noCloneEvent || !support.noCloneChecked) &&
				(elem.nodeType === 1 || elem.nodeType === 11) && !jQuery.isXMLDoc(elem) ) {

			// We eschew Sizzle here for performance reasons: http://jsperf.com/getall-vs-sizzle/2
			destElements = getAll( clone );
			srcElements = getAll( elem );

			// Fix all IE cloning issues
			for ( i = 0; (node = srcElements[i]) != null; ++i ) {
				// Ensure that the destination node is not null; Fixes #9587
				if ( destElements[i] ) {
					fixCloneNodeIssues( node, destElements[i] );
				}
			}
		}

		// Copy the events from the original to the clone
		if ( dataAndEvents ) {
			if ( deepDataAndEvents ) {
				srcElements = srcElements || getAll( elem );
				destElements = destElements || getAll( clone );

				for ( i = 0; (node = srcElements[i]) != null; i++ ) {
					cloneCopyEvent( node, destElements[i] );
				}
			} else {
				cloneCopyEvent( elem, clone );
			}
		}

		// Preserve script evaluation history
		destElements = getAll( clone, "script" );
		if ( destElements.length > 0 ) {
			setGlobalEval( destElements, !inPage && getAll( elem, "script" ) );
		}

		destElements = srcElements = node = null;

		// Return the cloned set
		return clone;
	},

	buildFragment: function( elems, context, scripts, selection ) {
		var j, elem, contains,
			tmp, tag, tbody, wrap,
			l = elems.length,

			// Ensure a safe fragment
			safe = createSafeFragment( context ),

			nodes = [],
			i = 0;

		for ( ; i < l; i++ ) {
			elem = elems[ i ];

			if ( elem || elem === 0 ) {

				// Add nodes directly
				if ( jQuery.type( elem ) === "object" ) {
					jQuery.merge( nodes, elem.nodeType ? [ elem ] : elem );

				// Convert non-html into a text node
				} else if ( !rhtml.test( elem ) ) {
					nodes.push( context.createTextNode( elem ) );

				// Convert html into DOM nodes
				} else {
					tmp = tmp || safe.appendChild( context.createElement("div") );

					// Deserialize a standard representation
					tag = (rtagName.exec( elem ) || [ "", "" ])[ 1 ].toLowerCase();
					wrap = wrapMap[ tag ] || wrapMap._default;

					tmp.innerHTML = wrap[1] + elem.replace( rxhtmlTag, "<$1></$2>" ) + wrap[2];

					// Descend through wrappers to the right content
					j = wrap[0];
					while ( j-- ) {
						tmp = tmp.lastChild;
					}

					// Manually add leading whitespace removed by IE
					if ( !support.leadingWhitespace && rleadingWhitespace.test( elem ) ) {
						nodes.push( context.createTextNode( rleadingWhitespace.exec( elem )[0] ) );
					}

					// Remove IE's autoinserted <tbody> from table fragments
					if ( !support.tbody ) {

						// String was a <table>, *may* have spurious <tbody>
						elem = tag === "table" && !rtbody.test( elem ) ?
							tmp.firstChild :

							// String was a bare <thead> or <tfoot>
							wrap[1] === "<table>" && !rtbody.test( elem ) ?
								tmp :
								0;

						j = elem && elem.childNodes.length;
						while ( j-- ) {
							if ( jQuery.nodeName( (tbody = elem.childNodes[j]), "tbody" ) && !tbody.childNodes.length ) {
								elem.removeChild( tbody );
							}
						}
					}

					jQuery.merge( nodes, tmp.childNodes );

					// Fix #12392 for WebKit and IE > 9
					tmp.textContent = "";

					// Fix #12392 for oldIE
					while ( tmp.firstChild ) {
						tmp.removeChild( tmp.firstChild );
					}

					// Remember the top-level container for proper cleanup
					tmp = safe.lastChild;
				}
			}
		}

		// Fix #11356: Clear elements from fragment
		if ( tmp ) {
			safe.removeChild( tmp );
		}

		// Reset defaultChecked for any radios and checkboxes
		// about to be appended to the DOM in IE 6/7 (#8060)
		if ( !support.appendChecked ) {
			jQuery.grep( getAll( nodes, "input" ), fixDefaultChecked );
		}

		i = 0;
		while ( (elem = nodes[ i++ ]) ) {

			// #4087 - If origin and destination elements are the same, and this is
			// that element, do not do anything
			if ( selection && jQuery.inArray( elem, selection ) !== -1 ) {
				continue;
			}

			contains = jQuery.contains( elem.ownerDocument, elem );

			// Append to fragment
			tmp = getAll( safe.appendChild( elem ), "script" );

			// Preserve script evaluation history
			if ( contains ) {
				setGlobalEval( tmp );
			}

			// Capture executables
			if ( scripts ) {
				j = 0;
				while ( (elem = tmp[ j++ ]) ) {
					if ( rscriptType.test( elem.type || "" ) ) {
						scripts.push( elem );
					}
				}
			}
		}

		tmp = null;

		return safe;
	},

	cleanData: function( elems, /* internal */ acceptData ) {
		var elem, type, id, data,
			i = 0,
			internalKey = jQuery.expando,
			cache = jQuery.cache,
			deleteExpando = support.deleteExpando,
			special = jQuery.event.special;

		for ( ; (elem = elems[i]) != null; i++ ) {
			if ( acceptData || jQuery.acceptData( elem ) ) {

				id = elem[ internalKey ];
				data = id && cache[ id ];

				if ( data ) {
					if ( data.events ) {
						for ( type in data.events ) {
							if ( special[ type ] ) {
								jQuery.event.remove( elem, type );

							// This is a shortcut to avoid jQuery.event.remove's overhead
							} else {
								jQuery.removeEvent( elem, type, data.handle );
							}
						}
					}

					// Remove cache only if it was not already removed by jQuery.event.remove
					if ( cache[ id ] ) {

						delete cache[ id ];

						// IE does not allow us to delete expando properties from nodes,
						// nor does it have a removeAttribute function on Document nodes;
						// we must handle all of these cases
						if ( deleteExpando ) {
							delete elem[ internalKey ];

						} else if ( typeof elem.removeAttribute !== strundefined ) {
							elem.removeAttribute( internalKey );

						} else {
							elem[ internalKey ] = null;
						}

						deletedIds.push( id );
					}
				}
			}
		}
	}
});

jQuery.fn.extend({
	text: function( value ) {
		return access( this, function( value ) {
			return value === undefined ?
				jQuery.text( this ) :
				this.empty().append( ( this[0] && this[0].ownerDocument || document ).createTextNode( value ) );
		}, null, value, arguments.length );
	},

	append: function() {
		return this.domManip( arguments, function( elem ) {
			if ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {
				var target = manipulationTarget( this, elem );
				target.appendChild( elem );
			}
		});
	},

	prepend: function() {
		return this.domManip( arguments, function( elem ) {
			if ( this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9 ) {
				var target = manipulationTarget( this, elem );
				target.insertBefore( elem, target.firstChild );
			}
		});
	},

	before: function() {
		return this.domManip( arguments, function( elem ) {
			if ( this.parentNode ) {
				this.parentNode.insertBefore( elem, this );
			}
		});
	},

	after: function() {
		return this.domManip( arguments, function( elem ) {
			if ( this.parentNode ) {
				this.parentNode.insertBefore( elem, this.nextSibling );
			}
		});
	},

	remove: function( selector, keepData /* Internal Use Only */ ) {
		var elem,
			elems = selector ? jQuery.filter( selector, this ) : this,
			i = 0;

		for ( ; (elem = elems[i]) != null; i++ ) {

			if ( !keepData && elem.nodeType === 1 ) {
				jQuery.cleanData( getAll( elem ) );
			}

			if ( elem.parentNode ) {
				if ( keepData && jQuery.contains( elem.ownerDocument, elem ) ) {
					setGlobalEval( getAll( elem, "script" ) );
				}
				elem.parentNode.removeChild( elem );
			}
		}

		return this;
	},

	empty: function() {
		var elem,
			i = 0;

		for ( ; (elem = this[i]) != null; i++ ) {
			// Remove element nodes and prevent memory leaks
			if ( elem.nodeType === 1 ) {
				jQuery.cleanData( getAll( elem, false ) );
			}

			// Remove any remaining nodes
			while ( elem.firstChild ) {
				elem.removeChild( elem.firstChild );
			}

			// If this is a select, ensure that it displays empty (#12336)
			// Support: IE<9
			if ( elem.options && jQuery.nodeName( elem, "select" ) ) {
				elem.options.length = 0;
			}
		}

		return this;
	},

	clone: function( dataAndEvents, deepDataAndEvents ) {
		dataAndEvents = dataAndEvents == null ? false : dataAndEvents;
		deepDataAndEvents = deepDataAndEvents == null ? dataAndEvents : deepDataAndEvents;

		return this.map(function() {
			return jQuery.clone( this, dataAndEvents, deepDataAndEvents );
		});
	},

	html: function( value ) {
		return access( this, function( value ) {
			var elem = this[ 0 ] || {},
				i = 0,
				l = this.length;

			if ( value === undefined ) {
				return elem.nodeType === 1 ?
					elem.innerHTML.replace( rinlinejQuery, "" ) :
					undefined;
			}

			// See if we can take a shortcut and just use innerHTML
			if ( typeof value === "string" && !rnoInnerhtml.test( value ) &&
				( support.htmlSerialize || !rnoshimcache.test( value )  ) &&
				( support.leadingWhitespace || !rleadingWhitespace.test( value ) ) &&
				!wrapMap[ (rtagName.exec( value ) || [ "", "" ])[ 1 ].toLowerCase() ] ) {

				value = value.replace( rxhtmlTag, "<$1></$2>" );

				try {
					for (; i < l; i++ ) {
						// Remove element nodes and prevent memory leaks
						elem = this[i] || {};
						if ( elem.nodeType === 1 ) {
							jQuery.cleanData( getAll( elem, false ) );
							elem.innerHTML = value;
						}
					}

					elem = 0;

				// If using innerHTML throws an exception, use the fallback method
				} catch(e) {}
			}

			if ( elem ) {
				this.empty().append( value );
			}
		}, null, value, arguments.length );
	},

	replaceWith: function() {
		var arg = arguments[ 0 ];

		// Make the changes, replacing each context element with the new content
		this.domManip( arguments, function( elem ) {
			arg = this.parentNode;

			jQuery.cleanData( getAll( this ) );

			if ( arg ) {
				arg.replaceChild( elem, this );
			}
		});

		// Force removal if there was no new content (e.g., from empty arguments)
		return arg && (arg.length || arg.nodeType) ? this : this.remove();
	},

	detach: function( selector ) {
		return this.remove( selector, true );
	},

	domManip: function( args, callback ) {

		// Flatten any nested arrays
		args = concat.apply( [], args );

		var first, node, hasScripts,
			scripts, doc, fragment,
			i = 0,
			l = this.length,
			set = this,
			iNoClone = l - 1,
			value = args[0],
			isFunction = jQuery.isFunction( value );

		// We can't cloneNode fragments that contain checked, in WebKit
		if ( isFunction ||
				( l > 1 && typeof value === "string" &&
					!support.checkClone && rchecked.test( value ) ) ) {
			return this.each(function( index ) {
				var self = set.eq( index );
				if ( isFunction ) {
					args[0] = value.call( this, index, self.html() );
				}
				self.domManip( args, callback );
			});
		}

		if ( l ) {
			fragment = jQuery.buildFragment( args, this[ 0 ].ownerDocument, false, this );
			first = fragment.firstChild;

			if ( fragment.childNodes.length === 1 ) {
				fragment = first;
			}

			if ( first ) {
				scripts = jQuery.map( getAll( fragment, "script" ), disableScript );
				hasScripts = scripts.length;

				// Use the original fragment for the last item instead of the first because it can end up
				// being emptied incorrectly in certain situations (#8070).
				for ( ; i < l; i++ ) {
					node = fragment;

					if ( i !== iNoClone ) {
						node = jQuery.clone( node, true, true );

						// Keep references to cloned scripts for later restoration
						if ( hasScripts ) {
							jQuery.merge( scripts, getAll( node, "script" ) );
						}
					}

					callback.call( this[i], node, i );
				}

				if ( hasScripts ) {
					doc = scripts[ scripts.length - 1 ].ownerDocument;

					// Reenable scripts
					jQuery.map( scripts, restoreScript );

					// Evaluate executable scripts on first document insertion
					for ( i = 0; i < hasScripts; i++ ) {
						node = scripts[ i ];
						if ( rscriptType.test( node.type || "" ) &&
							!jQuery._data( node, "globalEval" ) && jQuery.contains( doc, node ) ) {

							if ( node.src ) {
								// Optional AJAX dependency, but won't run scripts if not present
								if ( jQuery._evalUrl ) {
									jQuery._evalUrl( node.src );
								}
							} else {
								jQuery.globalEval( ( node.text || node.textContent || node.innerHTML || "" ).replace( rcleanScript, "" ) );
							}
						}
					}
				}

				// Fix #11809: Avoid leaking memory
				fragment = first = null;
			}
		}

		return this;
	}
});

jQuery.each({
	appendTo: "append",
	prependTo: "prepend",
	insertBefore: "before",
	insertAfter: "after",
	replaceAll: "replaceWith"
}, function( name, original ) {
	jQuery.fn[ name ] = function( selector ) {
		var elems,
			i = 0,
			ret = [],
			insert = jQuery( selector ),
			last = insert.length - 1;

		for ( ; i <= last; i++ ) {
			elems = i === last ? this : this.clone(true);
			jQuery( insert[i] )[ original ]( elems );

			// Modern browsers can apply jQuery collections as arrays, but oldIE needs a .get()
			push.apply( ret, elems.get() );
		}

		return this.pushStack( ret );
	};
});


var iframe,
	elemdisplay = {};

/**
 * Retrieve the actual display of a element
 * @param {String} name nodeName of the element
 * @param {Object} doc Document object
 */
// Called only from within defaultDisplay
function actualDisplay( name, doc ) {
	var elem = jQuery( doc.createElement( name ) ).appendTo( doc.body ),

		// getDefaultComputedStyle might be reliably used only on attached element
		display = window.getDefaultComputedStyle ?

			// Use of this method is a temporary fix (more like optmization) until something better comes along,
			// since it was removed from specification and supported only in FF
			window.getDefaultComputedStyle( elem[ 0 ] ).display : jQuery.css( elem[ 0 ], "display" );

	// We don't have any data stored on the element,
	// so use "detach" method as fast way to get rid of the element
	elem.detach();

	return display;
}

/**
 * Try to determine the default display value of an element
 * @param {String} nodeName
 */
function defaultDisplay( nodeName ) {
	var doc = document,
		display = elemdisplay[ nodeName ];

	if ( !display ) {
		display = actualDisplay( nodeName, doc );

		// If the simple way fails, read from inside an iframe
		if ( display === "none" || !display ) {

			// Use the already-created iframe if possible
			iframe = (iframe || jQuery( "<iframe frameborder='0' width='0' height='0'/>" )).appendTo( doc.documentElement );

			// Always write a new HTML skeleton so Webkit and Firefox don't choke on reuse
			doc = ( iframe[ 0 ].contentWindow || iframe[ 0 ].contentDocument ).document;

			// Support: IE
			doc.write();
			doc.close();

			display = actualDisplay( nodeName, doc );
			iframe.detach();
		}

		// Store the correct default display
		elemdisplay[ nodeName ] = display;
	}

	return display;
}


(function() {
	var a, shrinkWrapBlocksVal,
		div = document.createElement( "div" ),
		divReset =
			"-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;" +
			"display:block;padding:0;margin:0;border:0";

	// Setup
	div.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";
	a = div.getElementsByTagName( "a" )[ 0 ];

	a.style.cssText = "float:left;opacity:.5";

	// Make sure that element opacity exists
	// (IE uses filter instead)
	// Use a regex to work around a WebKit issue. See #5145
	support.opacity = /^0.5/.test( a.style.opacity );

	// Verify style float existence
	// (IE uses styleFloat instead of cssFloat)
	support.cssFloat = !!a.style.cssFloat;

	div.style.backgroundClip = "content-box";
	div.cloneNode( true ).style.backgroundClip = "";
	support.clearCloneStyle = div.style.backgroundClip === "content-box";

	// Null elements to avoid leaks in IE.
	a = div = null;

	support.shrinkWrapBlocks = function() {
		var body, container, div, containerStyles;

		if ( shrinkWrapBlocksVal == null ) {
			body = document.getElementsByTagName( "body" )[ 0 ];
			if ( !body ) {
				// Test fired too early or in an unsupported environment, exit.
				return;
			}

			containerStyles = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px";
			container = document.createElement( "div" );
			div = document.createElement( "div" );

			body.appendChild( container ).appendChild( div );

			// Will be changed later if needed.
			shrinkWrapBlocksVal = false;

			if ( typeof div.style.zoom !== strundefined ) {
				// Support: IE6
				// Check if elements with layout shrink-wrap their children
				div.style.cssText = divReset + ";width:1px;padding:1px;zoom:1";
				div.innerHTML = "<div></div>";
				div.firstChild.style.width = "5px";
				shrinkWrapBlocksVal = div.offsetWidth !== 3;
			}

			body.removeChild( container );

			// Null elements to avoid leaks in IE.
			body = container = div = null;
		}

		return shrinkWrapBlocksVal;
	};

})();
var rmargin = (/^margin/);

var rnumnonpx = new RegExp( "^(" + pnum + ")(?!px)[a-z%]+$", "i" );



var getStyles, curCSS,
	rposition = /^(top|right|bottom|left)$/;

if ( window.getComputedStyle ) {
	getStyles = function( elem ) {
		return elem.ownerDocument.defaultView.getComputedStyle( elem, null );
	};

	curCSS = function( elem, name, computed ) {
		var width, minWidth, maxWidth, ret,
			style = elem.style;

		computed = computed || getStyles( elem );

		// getPropertyValue is only needed for .css('filter') in IE9, see #12537
		ret = computed ? computed.getPropertyValue( name ) || computed[ name ] : undefined;

		if ( computed ) {

			if ( ret === "" && !jQuery.contains( elem.ownerDocument, elem ) ) {
				ret = jQuery.style( elem, name );
			}

			// A tribute to the "awesome hack by Dean Edwards"
			// Chrome < 17 and Safari 5.0 uses "computed value" instead of "used value" for margin-right
			// Safari 5.1.7 (at least) returns percentage for a larger set of values, but width seems to be reliably pixels
			// this is against the CSSOM draft spec: http://dev.w3.org/csswg/cssom/#resolved-values
			if ( rnumnonpx.test( ret ) && rmargin.test( name ) ) {

				// Remember the original values
				width = style.width;
				minWidth = style.minWidth;
				maxWidth = style.maxWidth;

				// Put in the new values to get a computed value out
				style.minWidth = style.maxWidth = style.width = ret;
				ret = computed.width;

				// Revert the changed values
				style.width = width;
				style.minWidth = minWidth;
				style.maxWidth = maxWidth;
			}
		}

		// Support: IE
		// IE returns zIndex value as an integer.
		return ret === undefined ?
			ret :
			ret + "";
	};
} else if ( document.documentElement.currentStyle ) {
	getStyles = function( elem ) {
		return elem.currentStyle;
	};

	curCSS = function( elem, name, computed ) {
		var left, rs, rsLeft, ret,
			style = elem.style;

		computed = computed || getStyles( elem );
		ret = computed ? computed[ name ] : undefined;

		// Avoid setting ret to empty string here
		// so we don't default to auto
		if ( ret == null && style && style[ name ] ) {
			ret = style[ name ];
		}

		// From the awesome hack by Dean Edwards
		// http://erik.eae.net/archives/2007/07/27/18.54.15/#comment-102291

		// If we're not dealing with a regular pixel number
		// but a number that has a weird ending, we need to convert it to pixels
		// but not position css attributes, as those are proportional to the parent element instead
		// and we can't measure the parent instead because it might trigger a "stacking dolls" problem
		if ( rnumnonpx.test( ret ) && !rposition.test( name ) ) {

			// Remember the original values
			left = style.left;
			rs = elem.runtimeStyle;
			rsLeft = rs && rs.left;

			// Put in the new values to get a computed value out
			if ( rsLeft ) {
				rs.left = elem.currentStyle.left;
			}
			style.left = name === "fontSize" ? "1em" : ret;
			ret = style.pixelLeft + "px";

			// Revert the changed values
			style.left = left;
			if ( rsLeft ) {
				rs.left = rsLeft;
			}
		}

		// Support: IE
		// IE returns zIndex value as an integer.
		return ret === undefined ?
			ret :
			ret + "" || "auto";
	};
}




function addGetHookIf( conditionFn, hookFn ) {
	// Define the hook, we'll check on the first run if it's really needed.
	return {
		get: function() {
			var condition = conditionFn();

			if ( condition == null ) {
				// The test was not ready at this point; screw the hook this time
				// but check again when needed next time.
				return;
			}

			if ( condition ) {
				// Hook not needed (or it's not possible to use it due to missing dependency),
				// remove it.
				// Since there are no other hooks for marginRight, remove the whole object.
				delete this.get;
				return;
			}

			// Hook needed; redefine it so that the support test is not executed again.

			return (this.get = hookFn).apply( this, arguments );
		}
	};
}


(function() {
	var a, reliableHiddenOffsetsVal, boxSizingVal, boxSizingReliableVal,
		pixelPositionVal, reliableMarginRightVal,
		div = document.createElement( "div" ),
		containerStyles = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px",
		divReset =
			"-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;" +
			"display:block;padding:0;margin:0;border:0";

	// Setup
	div.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";
	a = div.getElementsByTagName( "a" )[ 0 ];

	a.style.cssText = "float:left;opacity:.5";

	// Make sure that element opacity exists
	// (IE uses filter instead)
	// Use a regex to work around a WebKit issue. See #5145
	support.opacity = /^0.5/.test( a.style.opacity );

	// Verify style float existence
	// (IE uses styleFloat instead of cssFloat)
	support.cssFloat = !!a.style.cssFloat;

	div.style.backgroundClip = "content-box";
	div.cloneNode( true ).style.backgroundClip = "";
	support.clearCloneStyle = div.style.backgroundClip === "content-box";

	// Null elements to avoid leaks in IE.
	a = div = null;

	jQuery.extend(support, {
		reliableHiddenOffsets: function() {
			if ( reliableHiddenOffsetsVal != null ) {
				return reliableHiddenOffsetsVal;
			}

			var container, tds, isSupported,
				div = document.createElement( "div" ),
				body = document.getElementsByTagName( "body" )[ 0 ];

			if ( !body ) {
				// Return for frameset docs that don't have a body
				return;
			}

			// Setup
			div.setAttribute( "className", "t" );
			div.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";

			container = document.createElement( "div" );
			container.style.cssText = containerStyles;

			body.appendChild( container ).appendChild( div );

			// Support: IE8
			// Check if table cells still have offsetWidth/Height when they are set
			// to display:none and there are still other visible table cells in a
			// table row; if so, offsetWidth/Height are not reliable for use when
			// determining if an element has been hidden directly using
			// display:none (it is still safe to use offsets if a parent element is
			// hidden; don safety goggles and see bug #4512 for more information).
			div.innerHTML = "<table><tr><td></td><td>t</td></tr></table>";
			tds = div.getElementsByTagName( "td" );
			tds[ 0 ].style.cssText = "padding:0;margin:0;border:0;display:none";
			isSupported = ( tds[ 0 ].offsetHeight === 0 );

			tds[ 0 ].style.display = "";
			tds[ 1 ].style.display = "none";

			// Support: IE8
			// Check if empty table cells still have offsetWidth/Height
			reliableHiddenOffsetsVal = isSupported && ( tds[ 0 ].offsetHeight === 0 );

			body.removeChild( container );

			// Null elements to avoid leaks in IE.
			div = body = null;

			return reliableHiddenOffsetsVal;
		},

		boxSizing: function() {
			if ( boxSizingVal == null ) {
				computeStyleTests();
			}
			return boxSizingVal;
		},

		boxSizingReliable: function() {
			if ( boxSizingReliableVal == null ) {
				computeStyleTests();
			}
			return boxSizingReliableVal;
		},

		pixelPosition: function() {
			if ( pixelPositionVal == null ) {
				computeStyleTests();
			}
			return pixelPositionVal;
		},

		reliableMarginRight: function() {
			var body, container, div, marginDiv;

			// Use window.getComputedStyle because jsdom on node.js will break without it.
			if ( reliableMarginRightVal == null && window.getComputedStyle ) {
				body = document.getElementsByTagName( "body" )[ 0 ];
				if ( !body ) {
					// Test fired too early or in an unsupported environment, exit.
					return;
				}

				container = document.createElement( "div" );
				div = document.createElement( "div" );
				container.style.cssText = containerStyles;

				body.appendChild( container ).appendChild( div );

				// Check if div with explicit width and no margin-right incorrectly
				// gets computed margin-right based on width of container. (#3333)
				// Fails in WebKit before Feb 2011 nightlies
				// WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right
				marginDiv = div.appendChild( document.createElement( "div" ) );
				marginDiv.style.cssText = div.style.cssText = divReset;
				marginDiv.style.marginRight = marginDiv.style.width = "0";
				div.style.width = "1px";

				reliableMarginRightVal =
					!parseFloat( ( window.getComputedStyle( marginDiv, null ) || {} ).marginRight );

				body.removeChild( container );
			}

			return reliableMarginRightVal;
		}
	});

	function computeStyleTests() {
		var container, div,
			body = document.getElementsByTagName( "body" )[ 0 ];

		if ( !body ) {
			// Test fired too early or in an unsupported environment, exit.
			return;
		}

		container = document.createElement( "div" );
		div = document.createElement( "div" );
		container.style.cssText = containerStyles;

		body.appendChild( container ).appendChild( div );

		div.style.cssText =
			"-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;" +
				"position:absolute;display:block;padding:1px;border:1px;width:4px;" +
				"margin-top:1%;top:1%";

		// Workaround failing boxSizing test due to offsetWidth returning wrong value
		// with some non-1 values of body zoom, ticket #13543
		jQuery.swap( body, body.style.zoom != null ? { zoom: 1 } : {}, function() {
			boxSizingVal = div.offsetWidth === 4;
		});

		// Will be changed later if needed.
		boxSizingReliableVal = true;
		pixelPositionVal = false;
		reliableMarginRightVal = true;

		// Use window.getComputedStyle because jsdom on node.js will break without it.
		if ( window.getComputedStyle ) {
			pixelPositionVal = ( window.getComputedStyle( div, null ) || {} ).top !== "1%";
			boxSizingReliableVal =
				( window.getComputedStyle( div, null ) || { width: "4px" } ).width === "4px";
		}

		body.removeChild( container );

		// Null elements to avoid leaks in IE.
		div = body = null;
	}

})();


// A method for quickly swapping in/out CSS properties to get correct calculations.
jQuery.swap = function( elem, options, callback, args ) {
	var ret, name,
		old = {};

	// Remember the old values, and insert the new ones
	for ( name in options ) {
		old[ name ] = elem.style[ name ];
		elem.style[ name ] = options[ name ];
	}

	ret = callback.apply( elem, args || [] );

	// Revert the old values
	for ( name in options ) {
		elem.style[ name ] = old[ name ];
	}

	return ret;
};


var
		ralpha = /alpha\([^)]*\)/i,
	ropacity = /opacity\s*=\s*([^)]*)/,

	// swappable if display is none or starts with table except "table", "table-cell", or "table-caption"
	// see here for display values: https://developer.mozilla.org/en-US/docs/CSS/display
	rdisplayswap = /^(none|table(?!-c[ea]).+)/,
	rnumsplit = new RegExp( "^(" + pnum + ")(.*)$", "i" ),
	rrelNum = new RegExp( "^([+-])=(" + pnum + ")", "i" ),

	cssShow = { position: "absolute", visibility: "hidden", display: "block" },
	cssNormalTransform = {
		letterSpacing: 0,
		fontWeight: 400
	},

	cssPrefixes = [ "Webkit", "O", "Moz", "ms" ];


// return a css property mapped to a potentially vendor prefixed property
function vendorPropName( style, name ) {

	// shortcut for names that are not vendor prefixed
	if ( name in style ) {
		return name;
	}

	// check for vendor prefixed names
	var capName = name.charAt(0).toUpperCase() + name.slice(1),
		origName = name,
		i = cssPrefixes.length;

	while ( i-- ) {
		name = cssPrefixes[ i ] + capName;
		if ( name in style ) {
			return name;
		}
	}

	return origName;
}

function showHide( elements, show ) {
	var display, elem, hidden,
		values = [],
		index = 0,
		length = elements.length;

	for ( ; index < length; index++ ) {
		elem = elements[ index ];
		if ( !elem.style ) {
			continue;
		}

		values[ index ] = jQuery._data( elem, "olddisplay" );
		display = elem.style.display;
		if ( show ) {
			// Reset the inline display of this element to learn if it is
			// being hidden by cascaded rules or not
			if ( !values[ index ] && display === "none" ) {
				elem.style.display = "";
			}

			// Set elements which have been overridden with display: none
			// in a stylesheet to whatever the default browser style is
			// for such an element
			if ( elem.style.display === "" && isHidden( elem ) ) {
				values[ index ] = jQuery._data( elem, "olddisplay", defaultDisplay(elem.nodeName) );
			}
		} else {

			if ( !values[ index ] ) {
				hidden = isHidden( elem );

				if ( display && display !== "none" || !hidden ) {
					jQuery._data( elem, "olddisplay", hidden ? display : jQuery.css( elem, "display" ) );
				}
			}
		}
	}

	// Set the display of most of the elements in a second loop
	// to avoid the constant reflow
	for ( index = 0; index < length; index++ ) {
		elem = elements[ index ];
		if ( !elem.style ) {
			continue;
		}
		if ( !show || elem.style.display === "none" || elem.style.display === "" ) {
			elem.style.display = show ? values[ index ] || "" : "none";
		}
	}

	return elements;
}

function setPositiveNumber( elem, value, subtract ) {
	var matches = rnumsplit.exec( value );
	return matches ?
		// Guard against undefined "subtract", e.g., when used as in cssHooks
		Math.max( 0, matches[ 1 ] - ( subtract || 0 ) ) + ( matches[ 2 ] || "px" ) :
		value;
}

function augmentWidthOrHeight( elem, name, extra, isBorderBox, styles ) {
	var i = extra === ( isBorderBox ? "border" : "content" ) ?
		// If we already have the right measurement, avoid augmentation
		4 :
		// Otherwise initialize for horizontal or vertical properties
		name === "width" ? 1 : 0,

		val = 0;

	for ( ; i < 4; i += 2 ) {
		// both box models exclude margin, so add it if we want it
		if ( extra === "margin" ) {
			val += jQuery.css( elem, extra + cssExpand[ i ], true, styles );
		}

		if ( isBorderBox ) {
			// border-box includes padding, so remove it if we want content
			if ( extra === "content" ) {
				val -= jQuery.css( elem, "padding" + cssExpand[ i ], true, styles );
			}

			// at this point, extra isn't border nor margin, so remove border
			if ( extra !== "margin" ) {
				val -= jQuery.css( elem, "border" + cssExpand[ i ] + "Width", true, styles );
			}
		} else {
			// at this point, extra isn't content, so add padding
			val += jQuery.css( elem, "padding" + cssExpand[ i ], true, styles );

			// at this point, extra isn't content nor padding, so add border
			if ( extra !== "padding" ) {
				val += jQuery.css( elem, "border" + cssExpand[ i ] + "Width", true, styles );
			}
		}
	}

	return val;
}

function getWidthOrHeight( elem, name, extra ) {

	// Start with offset property, which is equivalent to the border-box value
	var valueIsBorderBox = true,
		val = name === "width" ? elem.offsetWidth : elem.offsetHeight,
		styles = getStyles( elem ),
		isBorderBox = support.boxSizing() && jQuery.css( elem, "boxSizing", false, styles ) === "border-box";

	// some non-html elements return undefined for offsetWidth, so check for null/undefined
	// svg - https://bugzilla.mozilla.org/show_bug.cgi?id=649285
	// MathML - https://bugzilla.mozilla.org/show_bug.cgi?id=491668
	if ( val <= 0 || val == null ) {
		// Fall back to computed then uncomputed css if necessary
		val = curCSS( elem, name, styles );
		if ( val < 0 || val == null ) {
			val = elem.style[ name ];
		}

		// Computed unit is not pixels. Stop here and return.
		if ( rnumnonpx.test(val) ) {
			return val;
		}

		// we need the check for style in case a browser which returns unreliable values
		// for getComputedStyle silently falls back to the reliable elem.style
		valueIsBorderBox = isBorderBox && ( support.boxSizingReliable() || val === elem.style[ name ] );

		// Normalize "", auto, and prepare for extra
		val = parseFloat( val ) || 0;
	}

	// use the active box-sizing model to add/subtract irrelevant styles
	return ( val +
		augmentWidthOrHeight(
			elem,
			name,
			extra || ( isBorderBox ? "border" : "content" ),
			valueIsBorderBox,
			styles
		)
	) + "px";
}

jQuery.extend({
	// Add in style property hooks for overriding the default
	// behavior of getting and setting a style property
	cssHooks: {
		opacity: {
			get: function( elem, computed ) {
				if ( computed ) {
					// We should always get a number back from opacity
					var ret = curCSS( elem, "opacity" );
					return ret === "" ? "1" : ret;
				}
			}
		}
	},

	// Don't automatically add "px" to these possibly-unitless properties
	cssNumber: {
		"columnCount": true,
		"fillOpacity": true,
		"fontWeight": true,
		"lineHeight": true,
		"opacity": true,
		"order": true,
		"orphans": true,
		"widows": true,
		"zIndex": true,
		"zoom": true
	},

	// Add in properties whose names you wish to fix before
	// setting or getting the value
	cssProps: {
		// normalize float css property
		"float": support.cssFloat ? "cssFloat" : "styleFloat"
	},

	// Get and set the style property on a DOM Node
	style: function( elem, name, value, extra ) {
		// Don't set styles on text and comment nodes
		if ( !elem || elem.nodeType === 3 || elem.nodeType === 8 || !elem.style ) {
			return;
		}

		// Make sure that we're working with the right name
		var ret, type, hooks,
			origName = jQuery.camelCase( name ),
			style = elem.style;

		name = jQuery.cssProps[ origName ] || ( jQuery.cssProps[ origName ] = vendorPropName( style, origName ) );

		// gets hook for the prefixed version
		// followed by the unprefixed version
		hooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];

		// Check if we're setting a value
		if ( value !== undefined ) {
			type = typeof value;

			// convert relative number strings (+= or -=) to relative numbers. #7345
			if ( type === "string" && (ret = rrelNum.exec( value )) ) {
				value = ( ret[1] + 1 ) * ret[2] + parseFloat( jQuery.css( elem, name ) );
				// Fixes bug #9237
				type = "number";
			}

			// Make sure that null and NaN values aren't set. See: #7116
			if ( value == null || value !== value ) {
				return;
			}

			// If a number was passed in, add 'px' to the (except for certain CSS properties)
			if ( type === "number" && !jQuery.cssNumber[ origName ] ) {
				value += "px";
			}

			// Fixes #8908, it can be done more correctly by specifing setters in cssHooks,
			// but it would mean to define eight (for every problematic property) identical functions
			if ( !support.clearCloneStyle && value === "" && name.indexOf("background") === 0 ) {
				style[ name ] = "inherit";
			}

			// If a hook was provided, use that value, otherwise just set the specified value
			if ( !hooks || !("set" in hooks) || (value = hooks.set( elem, value, extra )) !== undefined ) {

				// Support: IE
				// Swallow errors from 'invalid' CSS values (#5509)
				try {
					// Support: Chrome, Safari
					// Setting style to blank string required to delete "style: x !important;"
					style[ name ] = "";
					style[ name ] = value;
				} catch(e) {}
			}

		} else {
			// If a hook was provided get the non-computed value from there
			if ( hooks && "get" in hooks && (ret = hooks.get( elem, false, extra )) !== undefined ) {
				return ret;
			}

			// Otherwise just get the value from the style object
			return style[ name ];
		}
	},

	css: function( elem, name, extra, styles ) {
		var num, val, hooks,
			origName = jQuery.camelCase( name );

		// Make sure that we're working with the right name
		name = jQuery.cssProps[ origName ] || ( jQuery.cssProps[ origName ] = vendorPropName( elem.style, origName ) );

		// gets hook for the prefixed version
		// followed by the unprefixed version
		hooks = jQuery.cssHooks[ name ] || jQuery.cssHooks[ origName ];

		// If a hook was provided get the computed value from there
		if ( hooks && "get" in hooks ) {
			val = hooks.get( elem, true, extra );
		}

		// Otherwise, if a way to get the computed value exists, use that
		if ( val === undefined ) {
			val = curCSS( elem, name, styles );
		}

		//convert "normal" to computed value
		if ( val === "normal" && name in cssNormalTransform ) {
			val = cssNormalTransform[ name ];
		}

		// Return, converting to number if forced or a qualifier was provided and val looks numeric
		if ( extra === "" || extra ) {
			num = parseFloat( val );
			return extra === true || jQuery.isNumeric( num ) ? num || 0 : val;
		}
		return val;
	}
});

jQuery.each([ "height", "width" ], function( i, name ) {
	jQuery.cssHooks[ name ] = {
		get: function( elem, computed, extra ) {
			if ( computed ) {
				// certain elements can have dimension info if we invisibly show them
				// however, it must have a current display style that would benefit from this
				return elem.offsetWidth === 0 && rdisplayswap.test( jQuery.css( elem, "display" ) ) ?
					jQuery.swap( elem, cssShow, function() {
						return getWidthOrHeight( elem, name, extra );
					}) :
					getWidthOrHeight( elem, name, extra );
			}
		},

		set: function( elem, value, extra ) {
			var styles = extra && getStyles( elem );
			return setPositiveNumber( elem, value, extra ?
				augmentWidthOrHeight(
					elem,
					name,
					extra,
					support.boxSizing() && jQuery.css( elem, "boxSizing", false, styles ) === "border-box",
					styles
				) : 0
			);
		}
	};
});

if ( !support.opacity ) {
	jQuery.cssHooks.opacity = {
		get: function( elem, computed ) {
			// IE uses filters for opacity
			return ropacity.test( (computed && elem.currentStyle ? elem.currentStyle.filter : elem.style.filter) || "" ) ?
				( 0.01 * parseFloat( RegExp.$1 ) ) + "" :
				computed ? "1" : "";
		},

		set: function( elem, value ) {
			var style = elem.style,
				currentStyle = elem.currentStyle,
				opacity = jQuery.isNumeric( value ) ? "alpha(opacity=" + value * 100 + ")" : "",
				filter = currentStyle && currentStyle.filter || style.filter || "";

			// IE has trouble with opacity if it does not have layout
			// Force it by setting the zoom level
			style.zoom = 1;

			// if setting opacity to 1, and no other filters exist - attempt to remove filter attribute #6652
			// if value === "", then remove inline opacity #12685
			if ( ( value >= 1 || value === "" ) &&
					jQuery.trim( filter.replace( ralpha, "" ) ) === "" &&
					style.removeAttribute ) {

				// Setting style.filter to null, "" & " " still leave "filter:" in the cssText
				// if "filter:" is present at all, clearType is disabled, we want to avoid this
				// style.removeAttribute is IE Only, but so apparently is this code path...
				style.removeAttribute( "filter" );

				// if there is no filter style applied in a css rule or unset inline opacity, we are done
				if ( value === "" || currentStyle && !currentStyle.filter ) {
					return;
				}
			}

			// otherwise, set new filter values
			style.filter = ralpha.test( filter ) ?
				filter.replace( ralpha, opacity ) :
				filter + " " + opacity;
		}
	};
}

jQuery.cssHooks.marginRight = addGetHookIf( support.reliableMarginRight,
	function( elem, computed ) {
		if ( computed ) {
			// WebKit Bug 13343 - getComputedStyle returns wrong value for margin-right
			// Work around by temporarily setting element display to inline-block
			return jQuery.swap( elem, { "display": "inline-block" },
				curCSS, [ elem, "marginRight" ] );
		}
	}
);

// These hooks are used by animate to expand properties
jQuery.each({
	margin: "",
	padding: "",
	border: "Width"
}, function( prefix, suffix ) {
	jQuery.cssHooks[ prefix + suffix ] = {
		expand: function( value ) {
			var i = 0,
				expanded = {},

				// assumes a single number if not a string
				parts = typeof value === "string" ? value.split(" ") : [ value ];

			for ( ; i < 4; i++ ) {
				expanded[ prefix + cssExpand[ i ] + suffix ] =
					parts[ i ] || parts[ i - 2 ] || parts[ 0 ];
			}

			return expanded;
		}
	};

	if ( !rmargin.test( prefix ) ) {
		jQuery.cssHooks[ prefix + suffix ].set = setPositiveNumber;
	}
});

jQuery.fn.extend({
	css: function( name, value ) {
		return access( this, function( elem, name, value ) {
			var styles, len,
				map = {},
				i = 0;

			if ( jQuery.isArray( name ) ) {
				styles = getStyles( elem );
				len = name.length;

				for ( ; i < len; i++ ) {
					map[ name[ i ] ] = jQuery.css( elem, name[ i ], false, styles );
				}

				return map;
			}

			return value !== undefined ?
				jQuery.style( elem, name, value ) :
				jQuery.css( elem, name );
		}, name, value, arguments.length > 1 );
	},
	show: function() {
		return showHide( this, true );
	},
	hide: function() {
		return showHide( this );
	},
	toggle: function( state ) {
		if ( typeof state === "boolean" ) {
			return state ? this.show() : this.hide();
		}

		return this.each(function() {
			if ( isHidden( this ) ) {
				jQuery( this ).show();
			} else {
				jQuery( this ).hide();
			}
		});
	}
});


function Tween( elem, options, prop, end, easing ) {
	return new Tween.prototype.init( elem, options, prop, end, easing );
}
jQuery.Tween = Tween;

Tween.prototype = {
	constructor: Tween,
	init: function( elem, options, prop, end, easing, unit ) {
		this.elem = elem;
		this.prop = prop;
		this.easing = easing || "swing";
		this.options = options;
		this.start = this.now = this.cur();
		this.end = end;
		this.unit = unit || ( jQuery.cssNumber[ prop ] ? "" : "px" );
	},
	cur: function() {
		var hooks = Tween.propHooks[ this.prop ];

		return hooks && hooks.get ?
			hooks.get( this ) :
			Tween.propHooks._default.get( this );
	},
	run: function( percent ) {
		var eased,
			hooks = Tween.propHooks[ this.prop ];

		if ( this.options.duration ) {
			this.pos = eased = jQuery.easing[ this.easing ](
				percent, this.options.duration * percent, 0, 1, this.options.duration
			);
		} else {
			this.pos = eased = percent;
		}
		this.now = ( this.end - this.start ) * eased + this.start;

		if ( this.options.step ) {
			this.options.step.call( this.elem, this.now, this );
		}

		if ( hooks && hooks.set ) {
			hooks.set( this );
		} else {
			Tween.propHooks._default.set( this );
		}
		return this;
	}
};

Tween.prototype.init.prototype = Tween.prototype;

Tween.propHooks = {
	_default: {
		get: function( tween ) {
			var result;

			if ( tween.elem[ tween.prop ] != null &&
				(!tween.elem.style || tween.elem.style[ tween.prop ] == null) ) {
				return tween.elem[ tween.prop ];
			}

			// passing an empty string as a 3rd parameter to .css will automatically
			// attempt a parseFloat and fallback to a string if the parse fails
			// so, simple values such as "10px" are parsed to Float.
			// complex values such as "rotate(1rad)" are returned as is.
			result = jQuery.css( tween.elem, tween.prop, "" );
			// Empty strings, null, undefined and "auto" are converted to 0.
			return !result || result === "auto" ? 0 : result;
		},
		set: function( tween ) {
			// use step hook for back compat - use cssHook if its there - use .style if its
			// available and use plain properties where available
			if ( jQuery.fx.step[ tween.prop ] ) {
				jQuery.fx.step[ tween.prop ]( tween );
			} else if ( tween.elem.style && ( tween.elem.style[ jQuery.cssProps[ tween.prop ] ] != null || jQuery.cssHooks[ tween.prop ] ) ) {
				jQuery.style( tween.elem, tween.prop, tween.now + tween.unit );
			} else {
				tween.elem[ tween.prop ] = tween.now;
			}
		}
	}
};

// Support: IE <=9
// Panic based approach to setting things on disconnected nodes

Tween.propHooks.scrollTop = Tween.propHooks.scrollLeft = {
	set: function( tween ) {
		if ( tween.elem.nodeType && tween.elem.parentNode ) {
			tween.elem[ tween.prop ] = tween.now;
		}
	}
};

jQuery.easing = {
	linear: function( p ) {
		return p;
	},
	swing: function( p ) {
		return 0.5 - Math.cos( p * Math.PI ) / 2;
	}
};

jQuery.fx = Tween.prototype.init;

// Back Compat <1.8 extension point
jQuery.fx.step = {};




var
	fxNow, timerId,
	rfxtypes = /^(?:toggle|show|hide)$/,
	rfxnum = new RegExp( "^(?:([+-])=|)(" + pnum + ")([a-z%]*)$", "i" ),
	rrun = /queueHooks$/,
	animationPrefilters = [ defaultPrefilter ],
	tweeners = {
		"*": [ function( prop, value ) {
			var tween = this.createTween( prop, value ),
				target = tween.cur(),
				parts = rfxnum.exec( value ),
				unit = parts && parts[ 3 ] || ( jQuery.cssNumber[ prop ] ? "" : "px" ),

				// Starting value computation is required for potential unit mismatches
				start = ( jQuery.cssNumber[ prop ] || unit !== "px" && +target ) &&
					rfxnum.exec( jQuery.css( tween.elem, prop ) ),
				scale = 1,
				maxIterations = 20;

			if ( start && start[ 3 ] !== unit ) {
				// Trust units reported by jQuery.css
				unit = unit || start[ 3 ];

				// Make sure we update the tween properties later on
				parts = parts || [];

				// Iteratively approximate from a nonzero starting point
				start = +target || 1;

				do {
					// If previous iteration zeroed out, double until we get *something*
					// Use a string for doubling factor so we don't accidentally see scale as unchanged below
					scale = scale || ".5";

					// Adjust and apply
					start = start / scale;
					jQuery.style( tween.elem, prop, start + unit );

				// Update scale, tolerating zero or NaN from tween.cur()
				// And breaking the loop if scale is unchanged or perfect, or if we've just had enough
				} while ( scale !== (scale = tween.cur() / target) && scale !== 1 && --maxIterations );
			}

			// Update tween properties
			if ( parts ) {
				start = tween.start = +start || +target || 0;
				tween.unit = unit;
				// If a +=/-= token was provided, we're doing a relative animation
				tween.end = parts[ 1 ] ?
					start + ( parts[ 1 ] + 1 ) * parts[ 2 ] :
					+parts[ 2 ];
			}

			return tween;
		} ]
	};

// Animations created synchronously will run synchronously
function createFxNow() {
	setTimeout(function() {
		fxNow = undefined;
	});
	return ( fxNow = jQuery.now() );
}

// Generate parameters to create a standard animation
function genFx( type, includeWidth ) {
	var which,
		attrs = { height: type },
		i = 0;

	// if we include width, step value is 1 to do all cssExpand values,
	// if we don't include width, step value is 2 to skip over Left and Right
	includeWidth = includeWidth ? 1 : 0;
	for ( ; i < 4 ; i += 2 - includeWidth ) {
		which = cssExpand[ i ];
		attrs[ "margin" + which ] = attrs[ "padding" + which ] = type;
	}

	if ( includeWidth ) {
		attrs.opacity = attrs.width = type;
	}

	return attrs;
}

function createTween( value, prop, animation ) {
	var tween,
		collection = ( tweeners[ prop ] || [] ).concat( tweeners[ "*" ] ),
		index = 0,
		length = collection.length;
	for ( ; index < length; index++ ) {
		if ( (tween = collection[ index ].call( animation, prop, value )) ) {

			// we're done with this property
			return tween;
		}
	}
}

function defaultPrefilter( elem, props, opts ) {
	/* jshint validthis: true */
	var prop, value, toggle, tween, hooks, oldfire, display, dDisplay,
		anim = this,
		orig = {},
		style = elem.style,
		hidden = elem.nodeType && isHidden( elem ),
		dataShow = jQuery._data( elem, "fxshow" );

	// handle queue: false promises
	if ( !opts.queue ) {
		hooks = jQuery._queueHooks( elem, "fx" );
		if ( hooks.unqueued == null ) {
			hooks.unqueued = 0;
			oldfire = hooks.empty.fire;
			hooks.empty.fire = function() {
				if ( !hooks.unqueued ) {
					oldfire();
				}
			};
		}
		hooks.unqueued++;

		anim.always(function() {
			// doing this makes sure that the complete handler will be called
			// before this completes
			anim.always(function() {
				hooks.unqueued--;
				if ( !jQuery.queue( elem, "fx" ).length ) {
					hooks.empty.fire();
				}
			});
		});
	}

	// height/width overflow pass
	if ( elem.nodeType === 1 && ( "height" in props || "width" in props ) ) {
		// Make sure that nothing sneaks out
		// Record all 3 overflow attributes because IE does not
		// change the overflow attribute when overflowX and
		// overflowY are set to the same value
		opts.overflow = [ style.overflow, style.overflowX, style.overflowY ];

		// Set display property to inline-block for height/width
		// animations on inline elements that are having width/height animated
		display = jQuery.css( elem, "display" );
		dDisplay = defaultDisplay( elem.nodeName );
		if ( display === "none" ) {
			display = dDisplay;
		}
		if ( display === "inline" &&
				jQuery.css( elem, "float" ) === "none" ) {

			// inline-level elements accept inline-block;
			// block-level elements need to be inline with layout
			if ( !support.inlineBlockNeedsLayout || dDisplay === "inline" ) {
				style.display = "inline-block";
			} else {
				style.zoom = 1;
			}
		}
	}

	if ( opts.overflow ) {
		style.overflow = "hidden";
		if ( !support.shrinkWrapBlocks() ) {
			anim.always(function() {
				style.overflow = opts.overflow[ 0 ];
				style.overflowX = opts.overflow[ 1 ];
				style.overflowY = opts.overflow[ 2 ];
			});
		}
	}

	// show/hide pass
	for ( prop in props ) {
		value = props[ prop ];
		if ( rfxtypes.exec( value ) ) {
			delete props[ prop ];
			toggle = toggle || value === "toggle";
			if ( value === ( hidden ? "hide" : "show" ) ) {

				// If there is dataShow left over from a stopped hide or show and we are going to proceed with show, we should pretend to be hidden
				if ( value === "show" && dataShow && dataShow[ prop ] !== undefined ) {
					hidden = true;
				} else {
					continue;
				}
			}
			orig[ prop ] = dataShow && dataShow[ prop ] || jQuery.style( elem, prop );
		}
	}

	if ( !jQuery.isEmptyObject( orig ) ) {
		if ( dataShow ) {
			if ( "hidden" in dataShow ) {
				hidden = dataShow.hidden;
			}
		} else {
			dataShow = jQuery._data( elem, "fxshow", {} );
		}

		// store state if its toggle - enables .stop().toggle() to "reverse"
		if ( toggle ) {
			dataShow.hidden = !hidden;
		}
		if ( hidden ) {
			jQuery( elem ).show();
		} else {
			anim.done(function() {
				jQuery( elem ).hide();
			});
		}
		anim.done(function() {
			var prop;
			jQuery._removeData( elem, "fxshow" );
			for ( prop in orig ) {
				jQuery.style( elem, prop, orig[ prop ] );
			}
		});
		for ( prop in orig ) {
			tween = createTween( hidden ? dataShow[ prop ] : 0, prop, anim );

			if ( !( prop in dataShow ) ) {
				dataShow[ prop ] = tween.start;
				if ( hidden ) {
					tween.end = tween.start;
					tween.start = prop === "width" || prop === "height" ? 1 : 0;
				}
			}
		}
	}
}

function propFilter( props, specialEasing ) {
	var index, name, easing, value, hooks;

	// camelCase, specialEasing and expand cssHook pass
	for ( index in props ) {
		name = jQuery.camelCase( index );
		easing = specialEasing[ name ];
		value = props[ index ];
		if ( jQuery.isArray( value ) ) {
			easing = value[ 1 ];
			value = props[ index ] = value[ 0 ];
		}

		if ( index !== name ) {
			props[ name ] = value;
			delete props[ index ];
		}

		hooks = jQuery.cssHooks[ name ];
		if ( hooks && "expand" in hooks ) {
			value = hooks.expand( value );
			delete props[ name ];

			// not quite $.extend, this wont overwrite keys already present.
			// also - reusing 'index' from above because we have the correct "name"
			for ( index in value ) {
				if ( !( index in props ) ) {
					props[ index ] = value[ index ];
					specialEasing[ index ] = easing;
				}
			}
		} else {
			specialEasing[ name ] = easing;
		}
	}
}

function Animation( elem, properties, options ) {
	var result,
		stopped,
		index = 0,
		length = animationPrefilters.length,
		deferred = jQuery.Deferred().always( function() {
			// don't match elem in the :animated selector
			delete tick.elem;
		}),
		tick = function() {
			if ( stopped ) {
				return false;
			}
			var currentTime = fxNow || createFxNow(),
				remaining = Math.max( 0, animation.startTime + animation.duration - currentTime ),
				// archaic crash bug won't allow us to use 1 - ( 0.5 || 0 ) (#12497)
				temp = remaining / animation.duration || 0,
				percent = 1 - temp,
				index = 0,
				length = animation.tweens.length;

			for ( ; index < length ; index++ ) {
				animation.tweens[ index ].run( percent );
			}

			deferred.notifyWith( elem, [ animation, percent, remaining ]);

			if ( percent < 1 && length ) {
				return remaining;
			} else {
				deferred.resolveWith( elem, [ animation ] );
				return false;
			}
		},
		animation = deferred.promise({
			elem: elem,
			props: jQuery.extend( {}, properties ),
			opts: jQuery.extend( true, { specialEasing: {} }, options ),
			originalProperties: properties,
			originalOptions: options,
			startTime: fxNow || createFxNow(),
			duration: options.duration,
			tweens: [],
			createTween: function( prop, end ) {
				var tween = jQuery.Tween( elem, animation.opts, prop, end,
						animation.opts.specialEasing[ prop ] || animation.opts.easing );
				animation.tweens.push( tween );
				return tween;
			},
			stop: function( gotoEnd ) {
				var index = 0,
					// if we are going to the end, we want to run all the tweens
					// otherwise we skip this part
					length = gotoEnd ? animation.tweens.length : 0;
				if ( stopped ) {
					return this;
				}
				stopped = true;
				for ( ; index < length ; index++ ) {
					animation.tweens[ index ].run( 1 );
				}

				// resolve when we played the last frame
				// otherwise, reject
				if ( gotoEnd ) {
					deferred.resolveWith( elem, [ animation, gotoEnd ] );
				} else {
					deferred.rejectWith( elem, [ animation, gotoEnd ] );
				}
				return this;
			}
		}),
		props = animation.props;

	propFilter( props, animation.opts.specialEasing );

	for ( ; index < length ; index++ ) {
		result = animationPrefilters[ index ].call( animation, elem, props, animation.opts );
		if ( result ) {
			return result;
		}
	}

	jQuery.map( props, createTween, animation );

	if ( jQuery.isFunction( animation.opts.start ) ) {
		animation.opts.start.call( elem, animation );
	}

	jQuery.fx.timer(
		jQuery.extend( tick, {
			elem: elem,
			anim: animation,
			queue: animation.opts.queue
		})
	);

	// attach callbacks from options
	return animation.progress( animation.opts.progress )
		.done( animation.opts.done, animation.opts.complete )
		.fail( animation.opts.fail )
		.always( animation.opts.always );
}

jQuery.Animation = jQuery.extend( Animation, {
	tweener: function( props, callback ) {
		if ( jQuery.isFunction( props ) ) {
			callback = props;
			props = [ "*" ];
		} else {
			props = props.split(" ");
		}

		var prop,
			index = 0,
			length = props.length;

		for ( ; index < length ; index++ ) {
			prop = props[ index ];
			tweeners[ prop ] = tweeners[ prop ] || [];
			tweeners[ prop ].unshift( callback );
		}
	},

	prefilter: function( callback, prepend ) {
		if ( prepend ) {
			animationPrefilters.unshift( callback );
		} else {
			animationPrefilters.push( callback );
		}
	}
});

jQuery.speed = function( speed, easing, fn ) {
	var opt = speed && typeof speed === "object" ? jQuery.extend( {}, speed ) : {
		complete: fn || !fn && easing ||
			jQuery.isFunction( speed ) && speed,
		duration: speed,
		easing: fn && easing || easing && !jQuery.isFunction( easing ) && easing
	};

	opt.duration = jQuery.fx.off ? 0 : typeof opt.duration === "number" ? opt.duration :
		opt.duration in jQuery.fx.speeds ? jQuery.fx.speeds[ opt.duration ] : jQuery.fx.speeds._default;

	// normalize opt.queue - true/undefined/null -> "fx"
	if ( opt.queue == null || opt.queue === true ) {
		opt.queue = "fx";
	}

	// Queueing
	opt.old = opt.complete;

	opt.complete = function() {
		if ( jQuery.isFunction( opt.old ) ) {
			opt.old.call( this );
		}

		if ( opt.queue ) {
			jQuery.dequeue( this, opt.queue );
		}
	};

	return opt;
};

jQuery.fn.extend({
	fadeTo: function( speed, to, easing, callback ) {

		// show any hidden elements after setting opacity to 0
		return this.filter( isHidden ).css( "opacity", 0 ).show()

			// animate to the value specified
			.end().animate({ opacity: to }, speed, easing, callback );
	},
	animate: function( prop, speed, easing, callback ) {
		var empty = jQuery.isEmptyObject( prop ),
			optall = jQuery.speed( speed, easing, callback ),
			doAnimation = function() {
				// Operate on a copy of prop so per-property easing won't be lost
				var anim = Animation( this, jQuery.extend( {}, prop ), optall );

				// Empty animations, or finishing resolves immediately
				if ( empty || jQuery._data( this, "finish" ) ) {
					anim.stop( true );
				}
			};
			doAnimation.finish = doAnimation;

		return empty || optall.queue === false ?
			this.each( doAnimation ) :
			this.queue( optall.queue, doAnimation );
	},
	stop: function( type, clearQueue, gotoEnd ) {
		var stopQueue = function( hooks ) {
			var stop = hooks.stop;
			delete hooks.stop;
			stop( gotoEnd );
		};

		if ( typeof type !== "string" ) {
			gotoEnd = clearQueue;
			clearQueue = type;
			type = undefined;
		}
		if ( clearQueue && type !== false ) {
			this.queue( type || "fx", [] );
		}

		return this.each(function() {
			var dequeue = true,
				index = type != null && type + "queueHooks",
				timers = jQuery.timers,
				data = jQuery._data( this );

			if ( index ) {
				if ( data[ index ] && data[ index ].stop ) {
					stopQueue( data[ index ] );
				}
			} else {
				for ( index in data ) {
					if ( data[ index ] && data[ index ].stop && rrun.test( index ) ) {
						stopQueue( data[ index ] );
					}
				}
			}

			for ( index = timers.length; index--; ) {
				if ( timers[ index ].elem === this && (type == null || timers[ index ].queue === type) ) {
					timers[ index ].anim.stop( gotoEnd );
					dequeue = false;
					timers.splice( index, 1 );
				}
			}

			// start the next in the queue if the last step wasn't forced
			// timers currently will call their complete callbacks, which will dequeue
			// but only if they were gotoEnd
			if ( dequeue || !gotoEnd ) {
				jQuery.dequeue( this, type );
			}
		});
	},
	finish: function( type ) {
		if ( type !== false ) {
			type = type || "fx";
		}
		return this.each(function() {
			var index,
				data = jQuery._data( this ),
				queue = data[ type + "queue" ],
				hooks = data[ type + "queueHooks" ],
				timers = jQuery.timers,
				length = queue ? queue.length : 0;

			// enable finishing flag on private data
			data.finish = true;

			// empty the queue first
			jQuery.queue( this, type, [] );

			if ( hooks && hooks.stop ) {
				hooks.stop.call( this, true );
			}

			// look for any active animations, and finish them
			for ( index = timers.length; index--; ) {
				if ( timers[ index ].elem === this && timers[ index ].queue === type ) {
					timers[ index ].anim.stop( true );
					timers.splice( index, 1 );
				}
			}

			// look for any animations in the old queue and finish them
			for ( index = 0; index < length; index++ ) {
				if ( queue[ index ] && queue[ index ].finish ) {
					queue[ index ].finish.call( this );
				}
			}

			// turn off finishing flag
			delete data.finish;
		});
	}
});

jQuery.each([ "toggle", "show", "hide" ], function( i, name ) {
	var cssFn = jQuery.fn[ name ];
	jQuery.fn[ name ] = function( speed, easing, callback ) {
		return speed == null || typeof speed === "boolean" ?
			cssFn.apply( this, arguments ) :
			this.animate( genFx( name, true ), speed, easing, callback );
	};
});

// Generate shortcuts for custom animations
jQuery.each({
	slideDown: genFx("show"),
	slideUp: genFx("hide"),
	slideToggle: genFx("toggle"),
	fadeIn: { opacity: "show" },
	fadeOut: { opacity: "hide" },
	fadeToggle: { opacity: "toggle" }
}, function( name, props ) {
	jQuery.fn[ name ] = function( speed, easing, callback ) {
		return this.animate( props, speed, easing, callback );
	};
});

jQuery.timers = [];
jQuery.fx.tick = function() {
	var timer,
		timers = jQuery.timers,
		i = 0;

	fxNow = jQuery.now();

	for ( ; i < timers.length; i++ ) {
		timer = timers[ i ];
		// Checks the timer has not already been removed
		if ( !timer() && timers[ i ] === timer ) {
			timers.splice( i--, 1 );
		}
	}

	if ( !timers.length ) {
		jQuery.fx.stop();
	}
	fxNow = undefined;
};

jQuery.fx.timer = function( timer ) {
	jQuery.timers.push( timer );
	if ( timer() ) {
		jQuery.fx.start();
	} else {
		jQuery.timers.pop();
	}
};

jQuery.fx.interval = 13;

jQuery.fx.start = function() {
	if ( !timerId ) {
		timerId = setInterval( jQuery.fx.tick, jQuery.fx.interval );
	}
};

jQuery.fx.stop = function() {
	clearInterval( timerId );
	timerId = null;
};

jQuery.fx.speeds = {
	slow: 600,
	fast: 200,
	// Default speed
	_default: 400
};


// Based off of the plugin by Clint Helfers, with permission.
// http://blindsignals.com/index.php/2009/07/jquery-delay/
jQuery.fn.delay = function( time, type ) {
	time = jQuery.fx ? jQuery.fx.speeds[ time ] || time : time;
	type = type || "fx";

	return this.queue( type, function( next, hooks ) {
		var timeout = setTimeout( next, time );
		hooks.stop = function() {
			clearTimeout( timeout );
		};
	});
};


(function() {
	var a, input, select, opt,
		div = document.createElement("div" );

	// Setup
	div.setAttribute( "className", "t" );
	div.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";
	a = div.getElementsByTagName("a")[ 0 ];

	// First batch of tests.
	select = document.createElement("select");
	opt = select.appendChild( document.createElement("option") );
	input = div.getElementsByTagName("input")[ 0 ];

	a.style.cssText = "top:1px";

	// Test setAttribute on camelCase class. If it works, we need attrFixes when doing get/setAttribute (ie6/7)
	support.getSetAttribute = div.className !== "t";

	// Get the style information from getAttribute
	// (IE uses .cssText instead)
	support.style = /top/.test( a.getAttribute("style") );

	// Make sure that URLs aren't manipulated
	// (IE normalizes it by default)
	support.hrefNormalized = a.getAttribute("href") === "/a";

	// Check the default checkbox/radio value ("" on WebKit; "on" elsewhere)
	support.checkOn = !!input.value;

	// Make sure that a selected-by-default option has a working selected property.
	// (WebKit defaults to false instead of true, IE too, if it's in an optgroup)
	support.optSelected = opt.selected;

	// Tests for enctype support on a form (#6743)
	support.enctype = !!document.createElement("form").enctype;

	// Make sure that the options inside disabled selects aren't marked as disabled
	// (WebKit marks them as disabled)
	select.disabled = true;
	support.optDisabled = !opt.disabled;

	// Support: IE8 only
	// Check if we can trust getAttribute("value")
	input = document.createElement( "input" );
	input.setAttribute( "value", "" );
	support.input = input.getAttribute( "value" ) === "";

	// Check if an input maintains its value after becoming a radio
	input.value = "t";
	input.setAttribute( "type", "radio" );
	support.radioValue = input.value === "t";

	// Null elements to avoid leaks in IE.
	a = input = select = opt = div = null;
})();


var rreturn = /\r/g;

jQuery.fn.extend({
	val: function( value ) {
		var hooks, ret, isFunction,
			elem = this[0];

		if ( !arguments.length ) {
			if ( elem ) {
				hooks = jQuery.valHooks[ elem.type ] || jQuery.valHooks[ elem.nodeName.toLowerCase() ];

				if ( hooks && "get" in hooks && (ret = hooks.get( elem, "value" )) !== undefined ) {
					return ret;
				}

				ret = elem.value;

				return typeof ret === "string" ?
					// handle most common string cases
					ret.replace(rreturn, "") :
					// handle cases where value is null/undef or number
					ret == null ? "" : ret;
			}

			return;
		}

		isFunction = jQuery.isFunction( value );

		return this.each(function( i ) {
			var val;

			if ( this.nodeType !== 1 ) {
				return;
			}

			if ( isFunction ) {
				val = value.call( this, i, jQuery( this ).val() );
			} else {
				val = value;
			}

			// Treat null/undefined as ""; convert numbers to string
			if ( val == null ) {
				val = "";
			} else if ( typeof val === "number" ) {
				val += "";
			} else if ( jQuery.isArray( val ) ) {
				val = jQuery.map( val, function( value ) {
					return value == null ? "" : value + "";
				});
			}

			hooks = jQuery.valHooks[ this.type ] || jQuery.valHooks[ this.nodeName.toLowerCase() ];

			// If set returns undefined, fall back to normal setting
			if ( !hooks || !("set" in hooks) || hooks.set( this, val, "value" ) === undefined ) {
				this.value = val;
			}
		});
	}
});

jQuery.extend({
	valHooks: {
		option: {
			get: function( elem ) {
				var val = jQuery.find.attr( elem, "value" );
				return val != null ?
					val :
					jQuery.text( elem );
			}
		},
		select: {
			get: function( elem ) {
				var value, option,
					options = elem.options,
					index = elem.selectedIndex,
					one = elem.type === "select-one" || index < 0,
					values = one ? null : [],
					max = one ? index + 1 : options.length,
					i = index < 0 ?
						max :
						one ? index : 0;

				// Loop through all the selected options
				for ( ; i < max; i++ ) {
					option = options[ i ];

					// oldIE doesn't update selected after form reset (#2551)
					if ( ( option.selected || i === index ) &&
							// Don't return options that are disabled or in a disabled optgroup
							( support.optDisabled ? !option.disabled : option.getAttribute("disabled") === null ) &&
							( !option.parentNode.disabled || !jQuery.nodeName( option.parentNode, "optgroup" ) ) ) {

						// Get the specific value for the option
						value = jQuery( option ).val();

						// We don't need an array for one selects
						if ( one ) {
							return value;
						}

						// Multi-Selects return an array
						values.push( value );
					}
				}

				return values;
			},

			set: function( elem, value ) {
				var optionSet, option,
					options = elem.options,
					values = jQuery.makeArray( value ),
					i = options.length;

				while ( i-- ) {
					option = options[ i ];

					if ( jQuery.inArray( jQuery.valHooks.option.get( option ), values ) >= 0 ) {

						// Support: IE6
						// When new option element is added to select box we need to
						// force reflow of newly added node in order to workaround delay
						// of initialization properties
						try {
							option.selected = optionSet = true;

						} catch ( _ ) {

							// Will be executed only in IE6
							option.scrollHeight;
						}

					} else {
						option.selected = false;
					}
				}

				// Force browsers to behave consistently when non-matching value is set
				if ( !optionSet ) {
					elem.selectedIndex = -1;
				}

				return options;
			}
		}
	}
});

// Radios and checkboxes getter/setter
jQuery.each([ "radio", "checkbox" ], function() {
	jQuery.valHooks[ this ] = {
		set: function( elem, value ) {
			if ( jQuery.isArray( value ) ) {
				return ( elem.checked = jQuery.inArray( jQuery(elem).val(), value ) >= 0 );
			}
		}
	};
	if ( !support.checkOn ) {
		jQuery.valHooks[ this ].get = function( elem ) {
			// Support: Webkit
			// "" is returned instead of "on" if a value isn't specified
			return elem.getAttribute("value") === null ? "on" : elem.value;
		};
	}
});




var nodeHook, boolHook,
	attrHandle = jQuery.expr.attrHandle,
	ruseDefault = /^(?:checked|selected)$/i,
	getSetAttribute = support.getSetAttribute,
	getSetInput = support.input;

jQuery.fn.extend({
	attr: function( name, value ) {
		return access( this, jQuery.attr, name, value, arguments.length > 1 );
	},

	removeAttr: function( name ) {
		return this.each(function() {
			jQuery.removeAttr( this, name );
		});
	}
});

jQuery.extend({
	attr: function( elem, name, value ) {
		var hooks, ret,
			nType = elem.nodeType;

		// don't get/set attributes on text, comment and attribute nodes
		if ( !elem || nType === 3 || nType === 8 || nType === 2 ) {
			return;
		}

		// Fallback to prop when attributes are not supported
		if ( typeof elem.getAttribute === strundefined ) {
			return jQuery.prop( elem, name, value );
		}

		// All attributes are lowercase
		// Grab necessary hook if one is defined
		if ( nType !== 1 || !jQuery.isXMLDoc( elem ) ) {
			name = name.toLowerCase();
			hooks = jQuery.attrHooks[ name ] ||
				( jQuery.expr.match.bool.test( name ) ? boolHook : nodeHook );
		}

		if ( value !== undefined ) {

			if ( value === null ) {
				jQuery.removeAttr( elem, name );

			} else if ( hooks && "set" in hooks && (ret = hooks.set( elem, value, name )) !== undefined ) {
				return ret;

			} else {
				elem.setAttribute( name, value + "" );
				return value;
			}

		} else if ( hooks && "get" in hooks && (ret = hooks.get( elem, name )) !== null ) {
			return ret;

		} else {
			ret = jQuery.find.attr( elem, name );

			// Non-existent attributes return null, we normalize to undefined
			return ret == null ?
				undefined :
				ret;
		}
	},

	removeAttr: function( elem, value ) {
		var name, propName,
			i = 0,
			attrNames = value && value.match( rnotwhite );

		if ( attrNames && elem.nodeType === 1 ) {
			while ( (name = attrNames[i++]) ) {
				propName = jQuery.propFix[ name ] || name;

				// Boolean attributes get special treatment (#10870)
				if ( jQuery.expr.match.bool.test( name ) ) {
					// Set corresponding property to false
					if ( getSetInput && getSetAttribute || !ruseDefault.test( name ) ) {
						elem[ propName ] = false;
					// Support: IE<9
					// Also clear defaultChecked/defaultSelected (if appropriate)
					} else {
						elem[ jQuery.camelCase( "default-" + name ) ] =
							elem[ propName ] = false;
					}

				// See #9699 for explanation of this approach (setting first, then removal)
				} else {
					jQuery.attr( elem, name, "" );
				}

				elem.removeAttribute( getSetAttribute ? name : propName );
			}
		}
	},

	attrHooks: {
		type: {
			set: function( elem, value ) {
				if ( !support.radioValue && value === "radio" && jQuery.nodeName(elem, "input") ) {
					// Setting the type on a radio button after the value resets the value in IE6-9
					// Reset value to default in case type is set after value during creation
					var val = elem.value;
					elem.setAttribute( "type", value );
					if ( val ) {
						elem.value = val;
					}
					return value;
				}
			}
		}
	}
});

// Hook for boolean attributes
boolHook = {
	set: function( elem, value, name ) {
		if ( value === false ) {
			// Remove boolean attributes when set to false
			jQuery.removeAttr( elem, name );
		} else if ( getSetInput && getSetAttribute || !ruseDefault.test( name ) ) {
			// IE<8 needs the *property* name
			elem.setAttribute( !getSetAttribute && jQuery.propFix[ name ] || name, name );

		// Use defaultChecked and defaultSelected for oldIE
		} else {
			elem[ jQuery.camelCase( "default-" + name ) ] = elem[ name ] = true;
		}

		return name;
	}
};

// Retrieve booleans specially
jQuery.each( jQuery.expr.match.bool.source.match( /\w+/g ), function( i, name ) {

	var getter = attrHandle[ name ] || jQuery.find.attr;

	attrHandle[ name ] = getSetInput && getSetAttribute || !ruseDefault.test( name ) ?
		function( elem, name, isXML ) {
			var ret, handle;
			if ( !isXML ) {
				// Avoid an infinite loop by temporarily removing this function from the getter
				handle = attrHandle[ name ];
				attrHandle[ name ] = ret;
				ret = getter( elem, name, isXML ) != null ?
					name.toLowerCase() :
					null;
				attrHandle[ name ] = handle;
			}
			return ret;
		} :
		function( elem, name, isXML ) {
			if ( !isXML ) {
				return elem[ jQuery.camelCase( "default-" + name ) ] ?
					name.toLowerCase() :
					null;
			}
		};
});

// fix oldIE attroperties
if ( !getSetInput || !getSetAttribute ) {
	jQuery.attrHooks.value = {
		set: function( elem, value, name ) {
			if ( jQuery.nodeName( elem, "input" ) ) {
				// Does not return so that setAttribute is also used
				elem.defaultValue = value;
			} else {
				// Use nodeHook if defined (#1954); otherwise setAttribute is fine
				return nodeHook && nodeHook.set( elem, value, name );
			}
		}
	};
}

// IE6/7 do not support getting/setting some attributes with get/setAttribute
if ( !getSetAttribute ) {

	// Use this for any attribute in IE6/7
	// This fixes almost every IE6/7 issue
	nodeHook = {
		set: function( elem, value, name ) {
			// Set the existing or create a new attribute node
			var ret = elem.getAttributeNode( name );
			if ( !ret ) {
				elem.setAttributeNode(
					(ret = elem.ownerDocument.createAttribute( name ))
				);
			}

			ret.value = value += "";

			// Break association with cloned elements by also using setAttribute (#9646)
			if ( name === "value" || value === elem.getAttribute( name ) ) {
				return value;
			}
		}
	};

	// Some attributes are constructed with empty-string values when not defined
	attrHandle.id = attrHandle.name = attrHandle.coords =
		function( elem, name, isXML ) {
			var ret;
			if ( !isXML ) {
				return (ret = elem.getAttributeNode( name )) && ret.value !== "" ?
					ret.value :
					null;
			}
		};

	// Fixing value retrieval on a button requires this module
	jQuery.valHooks.button = {
		get: function( elem, name ) {
			var ret = elem.getAttributeNode( name );
			if ( ret && ret.specified ) {
				return ret.value;
			}
		},
		set: nodeHook.set
	};

	// Set contenteditable to false on removals(#10429)
	// Setting to empty string throws an error as an invalid value
	jQuery.attrHooks.contenteditable = {
		set: function( elem, value, name ) {
			nodeHook.set( elem, value === "" ? false : value, name );
		}
	};

	// Set width and height to auto instead of 0 on empty string( Bug #8150 )
	// This is for removals
	jQuery.each([ "width", "height" ], function( i, name ) {
		jQuery.attrHooks[ name ] = {
			set: function( elem, value ) {
				if ( value === "" ) {
					elem.setAttribute( name, "auto" );
					return value;
				}
			}
		};
	});
}

if ( !support.style ) {
	jQuery.attrHooks.style = {
		get: function( elem ) {
			// Return undefined in the case of empty string
			// Note: IE uppercases css property names, but if we were to .toLowerCase()
			// .cssText, that would destroy case senstitivity in URL's, like in "background"
			return elem.style.cssText || undefined;
		},
		set: function( elem, value ) {
			return ( elem.style.cssText = value + "" );
		}
	};
}




var rfocusable = /^(?:input|select|textarea|button|object)$/i,
	rclickable = /^(?:a|area)$/i;

jQuery.fn.extend({
	prop: function( name, value ) {
		return access( this, jQuery.prop, name, value, arguments.length > 1 );
	},

	removeProp: function( name ) {
		name = jQuery.propFix[ name ] || name;
		return this.each(function() {
			// try/catch handles cases where IE balks (such as removing a property on window)
			try {
				this[ name ] = undefined;
				delete this[ name ];
			} catch( e ) {}
		});
	}
});

jQuery.extend({
	propFix: {
		"for": "htmlFor",
		"class": "className"
	},

	prop: function( elem, name, value ) {
		var ret, hooks, notxml,
			nType = elem.nodeType;

		// don't get/set properties on text, comment and attribute nodes
		if ( !elem || nType === 3 || nType === 8 || nType === 2 ) {
			return;
		}

		notxml = nType !== 1 || !jQuery.isXMLDoc( elem );

		if ( notxml ) {
			// Fix name and attach hooks
			name = jQuery.propFix[ name ] || name;
			hooks = jQuery.propHooks[ name ];
		}

		if ( value !== undefined ) {
			return hooks && "set" in hooks && (ret = hooks.set( elem, value, name )) !== undefined ?
				ret :
				( elem[ name ] = value );

		} else {
			return hooks && "get" in hooks && (ret = hooks.get( elem, name )) !== null ?
				ret :
				elem[ name ];
		}
	},

	propHooks: {
		tabIndex: {
			get: function( elem ) {
				// elem.tabIndex doesn't always return the correct value when it hasn't been explicitly set
				// http://fluidproject.org/blog/2008/01/09/getting-setting-and-removing-tabindex-values-with-javascript/
				// Use proper attribute retrieval(#12072)
				var tabindex = jQuery.find.attr( elem, "tabindex" );

				return tabindex ?
					parseInt( tabindex, 10 ) :
					rfocusable.test( elem.nodeName ) || rclickable.test( elem.nodeName ) && elem.href ?
						0 :
						-1;
			}
		}
	}
});

// Some attributes require a special call on IE
// http://msdn.microsoft.com/en-us/library/ms536429%28VS.85%29.aspx
if ( !support.hrefNormalized ) {
	// href/src property should get the full normalized URL (#10299/#12915)
	jQuery.each([ "href", "src" ], function( i, name ) {
		jQuery.propHooks[ name ] = {
			get: function( elem ) {
				return elem.getAttribute( name, 4 );
			}
		};
	});
}

// Support: Safari, IE9+
// mis-reports the default selected property of an option
// Accessing the parent's selectedIndex property fixes it
if ( !support.optSelected ) {
	jQuery.propHooks.selected = {
		get: function( elem ) {
			var parent = elem.parentNode;

			if ( parent ) {
				parent.selectedIndex;

				// Make sure that it also works with optgroups, see #5701
				if ( parent.parentNode ) {
					parent.parentNode.selectedIndex;
				}
			}
			return null;
		}
	};
}

jQuery.each([
	"tabIndex",
	"readOnly",
	"maxLength",
	"cellSpacing",
	"cellPadding",
	"rowSpan",
	"colSpan",
	"useMap",
	"frameBorder",
	"contentEditable"
], function() {
	jQuery.propFix[ this.toLowerCase() ] = this;
});

// IE6/7 call enctype encoding
if ( !support.enctype ) {
	jQuery.propFix.enctype = "encoding";
}




var rclass = /[\t\r\n\f]/g;

jQuery.fn.extend({
	addClass: function( value ) {
		var classes, elem, cur, clazz, j, finalValue,
			i = 0,
			len = this.length,
			proceed = typeof value === "string" && value;

		if ( jQuery.isFunction( value ) ) {
			return this.each(function( j ) {
				jQuery( this ).addClass( value.call( this, j, this.className ) );
			});
		}

		if ( proceed ) {
			// The disjunction here is for better compressibility (see removeClass)
			classes = ( value || "" ).match( rnotwhite ) || [];

			for ( ; i < len; i++ ) {
				elem = this[ i ];
				cur = elem.nodeType === 1 && ( elem.className ?
					( " " + elem.className + " " ).replace( rclass, " " ) :
					" "
				);

				if ( cur ) {
					j = 0;
					while ( (clazz = classes[j++]) ) {
						if ( cur.indexOf( " " + clazz + " " ) < 0 ) {
							cur += clazz + " ";
						}
					}

					// only assign if different to avoid unneeded rendering.
					finalValue = jQuery.trim( cur );
					if ( elem.className !== finalValue ) {
						elem.className = finalValue;
					}
				}
			}
		}

		return this;
	},

	removeClass: function( value ) {
		var classes, elem, cur, clazz, j, finalValue,
			i = 0,
			len = this.length,
			proceed = arguments.length === 0 || typeof value === "string" && value;

		if ( jQuery.isFunction( value ) ) {
			return this.each(function( j ) {
				jQuery( this ).removeClass( value.call( this, j, this.className ) );
			});
		}
		if ( proceed ) {
			classes = ( value || "" ).match( rnotwhite ) || [];

			for ( ; i < len; i++ ) {
				elem = this[ i ];
				// This expression is here for better compressibility (see addClass)
				cur = elem.nodeType === 1 && ( elem.className ?
					( " " + elem.className + " " ).replace( rclass, " " ) :
					""
				);

				if ( cur ) {
					j = 0;
					while ( (clazz = classes[j++]) ) {
						// Remove *all* instances
						while ( cur.indexOf( " " + clazz + " " ) >= 0 ) {
							cur = cur.replace( " " + clazz + " ", " " );
						}
					}

					// only assign if different to avoid unneeded rendering.
					finalValue = value ? jQuery.trim( cur ) : "";
					if ( elem.className !== finalValue ) {
						elem.className = finalValue;
					}
				}
			}
		}

		return this;
	},

	toggleClass: function( value, stateVal ) {
		var type = typeof value;

		if ( typeof stateVal === "boolean" && type === "string" ) {
			return stateVal ? this.addClass( value ) : this.removeClass( value );
		}

		if ( jQuery.isFunction( value ) ) {
			return this.each(function( i ) {
				jQuery( this ).toggleClass( value.call(this, i, this.className, stateVal), stateVal );
			});
		}

		return this.each(function() {
			if ( type === "string" ) {
				// toggle individual class names
				var className,
					i = 0,
					self = jQuery( this ),
					classNames = value.match( rnotwhite ) || [];

				while ( (className = classNames[ i++ ]) ) {
					// check each className given, space separated list
					if ( self.hasClass( className ) ) {
						self.removeClass( className );
					} else {
						self.addClass( className );
					}
				}

			// Toggle whole class name
			} else if ( type === strundefined || type === "boolean" ) {
				if ( this.className ) {
					// store className if set
					jQuery._data( this, "__className__", this.className );
				}

				// If the element has a class name or if we're passed "false",
				// then remove the whole classname (if there was one, the above saved it).
				// Otherwise bring back whatever was previously saved (if anything),
				// falling back to the empty string if nothing was stored.
				this.className = this.className || value === false ? "" : jQuery._data( this, "__className__" ) || "";
			}
		});
	},

	hasClass: function( selector ) {
		var className = " " + selector + " ",
			i = 0,
			l = this.length;
		for ( ; i < l; i++ ) {
			if ( this[i].nodeType === 1 && (" " + this[i].className + " ").replace(rclass, " ").indexOf( className ) >= 0 ) {
				return true;
			}
		}

		return false;
	}
});




// Return jQuery for attributes-only inclusion


jQuery.each( ("blur focus focusin focusout load resize scroll unload click dblclick " +
	"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave " +
	"change select submit keydown keypress keyup error contextmenu").split(" "), function( i, name ) {

	// Handle event binding
	jQuery.fn[ name ] = function( data, fn ) {
		return arguments.length > 0 ?
			this.on( name, null, data, fn ) :
			this.trigger( name );
	};
});

jQuery.fn.extend({
	hover: function( fnOver, fnOut ) {
		return this.mouseenter( fnOver ).mouseleave( fnOut || fnOver );
	},

	bind: function( types, data, fn ) {
		return this.on( types, null, data, fn );
	},
	unbind: function( types, fn ) {
		return this.off( types, null, fn );
	},

	delegate: function( selector, types, data, fn ) {
		return this.on( types, selector, data, fn );
	},
	undelegate: function( selector, types, fn ) {
		// ( namespace ) or ( selector, types [, fn] )
		return arguments.length === 1 ? this.off( selector, "**" ) : this.off( types, selector || "**", fn );
	}
});


var nonce = jQuery.now();

var rquery = (/\?/);



var rvalidtokens = /(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;

jQuery.parseJSON = function( data ) {
	// Attempt to parse using the native JSON parser first
	if ( window.JSON && window.JSON.parse ) {
		// Support: Android 2.3
		// Workaround failure to string-cast null input
		return window.JSON.parse( data + "" );
	}

	var requireNonComma,
		depth = null,
		str = jQuery.trim( data + "" );

	// Guard against invalid (and possibly dangerous) input by ensuring that nothing remains
	// after removing valid tokens
	return str && !jQuery.trim( str.replace( rvalidtokens, function( token, comma, open, close ) {

		// Force termination if we see a misplaced comma
		if ( requireNonComma && comma ) {
			depth = 0;
		}

		// Perform no more replacements after returning to outermost depth
		if ( depth === 0 ) {
			return token;
		}

		// Commas must not follow "[", "{", or ","
		requireNonComma = open || comma;

		// Determine new depth
		// array/object open ("[" or "{"): depth += true - false (increment)
		// array/object close ("]" or "}"): depth += false - true (decrement)
		// other cases ("," or primitive): depth += true - true (numeric cast)
		depth += !close - !open;

		// Remove this token
		return "";
	}) ) ?
		( Function( "return " + str ) )() :
		jQuery.error( "Invalid JSON: " + data );
};


// Cross-browser xml parsing
jQuery.parseXML = function( data ) {
	var xml, tmp;
	if ( !data || typeof data !== "string" ) {
		return null;
	}
	try {
		if ( window.DOMParser ) { // Standard
			tmp = new DOMParser();
			xml = tmp.parseFromString( data, "text/xml" );
		} else { // IE
			xml = new ActiveXObject( "Microsoft.XMLDOM" );
			xml.async = "false";
			xml.loadXML( data );
		}
	} catch( e ) {
		xml = undefined;
	}
	if ( !xml || !xml.documentElement || xml.getElementsByTagName( "parsererror" ).length ) {
		jQuery.error( "Invalid XML: " + data );
	}
	return xml;
};


var
	// Document location
	ajaxLocParts,
	ajaxLocation,

	rhash = /#.*$/,
	rts = /([?&])_=[^&]*/,
	rheaders = /^(.*?):[ \t]*([^\r\n]*)\r?$/mg, // IE leaves an \r character at EOL
	// #7653, #8125, #8152: local protocol detection
	rlocalProtocol = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/,
	rnoContent = /^(?:GET|HEAD)$/,
	rprotocol = /^\/\//,
	rurl = /^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,

	/* Prefilters
	 * 1) They are useful to introduce custom dataTypes (see ajax/jsonp.js for an example)
	 * 2) These are called:
	 *    - BEFORE asking for a transport
	 *    - AFTER param serialization (s.data is a string if s.processData is true)
	 * 3) key is the dataType
	 * 4) the catchall symbol "*" can be used
	 * 5) execution will start with transport dataType and THEN continue down to "*" if needed
	 */
	prefilters = {},

	/* Transports bindings
	 * 1) key is the dataType
	 * 2) the catchall symbol "*" can be used
	 * 3) selection will start with transport dataType and THEN go to "*" if needed
	 */
	transports = {},

	// Avoid comment-prolog char sequence (#10098); must appease lint and evade compression
	allTypes = "*/".concat("*");

// #8138, IE may throw an exception when accessing
// a field from window.location if document.domain has been set
try {
	ajaxLocation = location.href;
} catch( e ) {
	// Use the href attribute of an A element
	// since IE will modify it given document.location
	ajaxLocation = document.createElement( "a" );
	ajaxLocation.href = "";
	ajaxLocation = ajaxLocation.href;
}

// Segment location into parts
ajaxLocParts = rurl.exec( ajaxLocation.toLowerCase() ) || [];

// Base "constructor" for jQuery.ajaxPrefilter and jQuery.ajaxTransport
function addToPrefiltersOrTransports( structure ) {

	// dataTypeExpression is optional and defaults to "*"
	return function( dataTypeExpression, func ) {

		if ( typeof dataTypeExpression !== "string" ) {
			func = dataTypeExpression;
			dataTypeExpression = "*";
		}

		var dataType,
			i = 0,
			dataTypes = dataTypeExpression.toLowerCase().match( rnotwhite ) || [];

		if ( jQuery.isFunction( func ) ) {
			// For each dataType in the dataTypeExpression
			while ( (dataType = dataTypes[i++]) ) {
				// Prepend if requested
				if ( dataType.charAt( 0 ) === "+" ) {
					dataType = dataType.slice( 1 ) || "*";
					(structure[ dataType ] = structure[ dataType ] || []).unshift( func );

				// Otherwise append
				} else {
					(structure[ dataType ] = structure[ dataType ] || []).push( func );
				}
			}
		}
	};
}

// Base inspection function for prefilters and transports
function inspectPrefiltersOrTransports( structure, options, originalOptions, jqXHR ) {

	var inspected = {},
		seekingTransport = ( structure === transports );

	function inspect( dataType ) {
		var selected;
		inspected[ dataType ] = true;
		jQuery.each( structure[ dataType ] || [], function( _, prefilterOrFactory ) {
			var dataTypeOrTransport = prefilterOrFactory( options, originalOptions, jqXHR );
			if ( typeof dataTypeOrTransport === "string" && !seekingTransport && !inspected[ dataTypeOrTransport ] ) {
				options.dataTypes.unshift( dataTypeOrTransport );
				inspect( dataTypeOrTransport );
				return false;
			} else if ( seekingTransport ) {
				return !( selected = dataTypeOrTransport );
			}
		});
		return selected;
	}

	return inspect( options.dataTypes[ 0 ] ) || !inspected[ "*" ] && inspect( "*" );
}

// A special extend for ajax options
// that takes "flat" options (not to be deep extended)
// Fixes #9887
function ajaxExtend( target, src ) {
	var deep, key,
		flatOptions = jQuery.ajaxSettings.flatOptions || {};

	for ( key in src ) {
		if ( src[ key ] !== undefined ) {
			( flatOptions[ key ] ? target : ( deep || (deep = {}) ) )[ key ] = src[ key ];
		}
	}
	if ( deep ) {
		jQuery.extend( true, target, deep );
	}

	return target;
}

/* Handles responses to an ajax request:
 * - finds the right dataType (mediates between content-type and expected dataType)
 * - returns the corresponding response
 */
function ajaxHandleResponses( s, jqXHR, responses ) {
	var firstDataType, ct, finalDataType, type,
		contents = s.contents,
		dataTypes = s.dataTypes;

	// Remove auto dataType and get content-type in the process
	while ( dataTypes[ 0 ] === "*" ) {
		dataTypes.shift();
		if ( ct === undefined ) {
			ct = s.mimeType || jqXHR.getResponseHeader("Content-Type");
		}
	}

	// Check if we're dealing with a known content-type
	if ( ct ) {
		for ( type in contents ) {
			if ( contents[ type ] && contents[ type ].test( ct ) ) {
				dataTypes.unshift( type );
				break;
			}
		}
	}

	// Check to see if we have a response for the expected dataType
	if ( dataTypes[ 0 ] in responses ) {
		finalDataType = dataTypes[ 0 ];
	} else {
		// Try convertible dataTypes
		for ( type in responses ) {
			if ( !dataTypes[ 0 ] || s.converters[ type + " " + dataTypes[0] ] ) {
				finalDataType = type;
				break;
			}
			if ( !firstDataType ) {
				firstDataType = type;
			}
		}
		// Or just use first one
		finalDataType = finalDataType || firstDataType;
	}

	// If we found a dataType
	// We add the dataType to the list if needed
	// and return the corresponding response
	if ( finalDataType ) {
		if ( finalDataType !== dataTypes[ 0 ] ) {
			dataTypes.unshift( finalDataType );
		}
		return responses[ finalDataType ];
	}
}

/* Chain conversions given the request and the original response
 * Also sets the responseXXX fields on the jqXHR instance
 */
function ajaxConvert( s, response, jqXHR, isSuccess ) {
	var conv2, current, conv, tmp, prev,
		converters = {},
		// Work with a copy of dataTypes in case we need to modify it for conversion
		dataTypes = s.dataTypes.slice();

	// Create converters map with lowercased keys
	if ( dataTypes[ 1 ] ) {
		for ( conv in s.converters ) {
			converters[ conv.toLowerCase() ] = s.converters[ conv ];
		}
	}

	current = dataTypes.shift();

	// Convert to each sequential dataType
	while ( current ) {

		if ( s.responseFields[ current ] ) {
			jqXHR[ s.responseFields[ current ] ] = response;
		}

		// Apply the dataFilter if provided
		if ( !prev && isSuccess && s.dataFilter ) {
			response = s.dataFilter( response, s.dataType );
		}

		prev = current;
		current = dataTypes.shift();

		if ( current ) {

			// There's only work to do if current dataType is non-auto
			if ( current === "*" ) {

				current = prev;

			// Convert response if prev dataType is non-auto and differs from current
			} else if ( prev !== "*" && prev !== current ) {

				// Seek a direct converter
				conv = converters[ prev + " " + current ] || converters[ "* " + current ];

				// If none found, seek a pair
				if ( !conv ) {
					for ( conv2 in converters ) {

						// If conv2 outputs current
						tmp = conv2.split( " " );
						if ( tmp[ 1 ] === current ) {

							// If prev can be converted to accepted input
							conv = converters[ prev + " " + tmp[ 0 ] ] ||
								converters[ "* " + tmp[ 0 ] ];
							if ( conv ) {
								// Condense equivalence converters
								if ( conv === true ) {
									conv = converters[ conv2 ];

								// Otherwise, insert the intermediate dataType
								} else if ( converters[ conv2 ] !== true ) {
									current = tmp[ 0 ];
									dataTypes.unshift( tmp[ 1 ] );
								}
								break;
							}
						}
					}
				}

				// Apply converter (if not an equivalence)
				if ( conv !== true ) {

					// Unless errors are allowed to bubble, catch and return them
					if ( conv && s[ "throws" ] ) {
						response = conv( response );
					} else {
						try {
							response = conv( response );
						} catch ( e ) {
							return { state: "parsererror", error: conv ? e : "No conversion from " + prev + " to " + current };
						}
					}
				}
			}
		}
	}

	return { state: "success", data: response };
}

jQuery.extend({

	// Counter for holding the number of active queries
	active: 0,

	// Last-Modified header cache for next request
	lastModified: {},
	etag: {},

	ajaxSettings: {
		url: ajaxLocation,
		type: "GET",
		isLocal: rlocalProtocol.test( ajaxLocParts[ 1 ] ),
		global: true,
		processData: true,
		async: true,
		contentType: "application/x-www-form-urlencoded; charset=UTF-8",
		/*
		timeout: 0,
		data: null,
		dataType: null,
		username: null,
		password: null,
		cache: null,
		throws: false,
		traditional: false,
		headers: {},
		*/

		accepts: {
			"*": allTypes,
			text: "text/plain",
			html: "text/html",
			xml: "application/xml, text/xml",
			json: "application/json, text/javascript"
		},

		contents: {
			xml: /xml/,
			html: /html/,
			json: /json/
		},

		responseFields: {
			xml: "responseXML",
			text: "responseText",
			json: "responseJSON"
		},

		// Data converters
		// Keys separate source (or catchall "*") and destination types with a single space
		converters: {

			// Convert anything to text
			"* text": String,

			// Text to html (true = no transformation)
			"text html": true,

			// Evaluate text as a json expression
			"text json": jQuery.parseJSON,

			// Parse text as xml
			"text xml": jQuery.parseXML
		},

		// For options that shouldn't be deep extended:
		// you can add your own custom options here if
		// and when you create one that shouldn't be
		// deep extended (see ajaxExtend)
		flatOptions: {
			url: true,
			context: true
		}
	},

	// Creates a full fledged settings object into target
	// with both ajaxSettings and settings fields.
	// If target is omitted, writes into ajaxSettings.
	ajaxSetup: function( target, settings ) {
		return settings ?

			// Building a settings object
			ajaxExtend( ajaxExtend( target, jQuery.ajaxSettings ), settings ) :

			// Extending ajaxSettings
			ajaxExtend( jQuery.ajaxSettings, target );
	},

	ajaxPrefilter: addToPrefiltersOrTransports( prefilters ),
	ajaxTransport: addToPrefiltersOrTransports( transports ),

	// Main method
	ajax: function( url, options ) {

		// If url is an object, simulate pre-1.5 signature
		if ( typeof url === "object" ) {
			options = url;
			url = undefined;
		}

		// Force options to be an object
		options = options || {};

		var // Cross-domain detection vars
			parts,
			// Loop variable
			i,
			// URL without anti-cache param
			cacheURL,
			// Response headers as string
			responseHeadersString,
			// timeout handle
			timeoutTimer,

			// To know if global events are to be dispatched
			fireGlobals,

			transport,
			// Response headers
			responseHeaders,
			// Create the final options object
			s = jQuery.ajaxSetup( {}, options ),
			// Callbacks context
			callbackContext = s.context || s,
			// Context for global events is callbackContext if it is a DOM node or jQuery collection
			globalEventContext = s.context && ( callbackContext.nodeType || callbackContext.jquery ) ?
				jQuery( callbackContext ) :
				jQuery.event,
			// Deferreds
			deferred = jQuery.Deferred(),
			completeDeferred = jQuery.Callbacks("once memory"),
			// Status-dependent callbacks
			statusCode = s.statusCode || {},
			// Headers (they are sent all at once)
			requestHeaders = {},
			requestHeadersNames = {},
			// The jqXHR state
			state = 0,
			// Default abort message
			strAbort = "canceled",
			// Fake xhr
			jqXHR = {
				readyState: 0,

				// Builds headers hashtable if needed
				getResponseHeader: function( key ) {
					var match;
					if ( state === 2 ) {
						if ( !responseHeaders ) {
							responseHeaders = {};
							while ( (match = rheaders.exec( responseHeadersString )) ) {
								responseHeaders[ match[1].toLowerCase() ] = match[ 2 ];
							}
						}
						match = responseHeaders[ key.toLowerCase() ];
					}
					return match == null ? null : match;
				},

				// Raw string
				getAllResponseHeaders: function() {
					return state === 2 ? responseHeadersString : null;
				},

				// Caches the header
				setRequestHeader: function( name, value ) {
					var lname = name.toLowerCase();
					if ( !state ) {
						name = requestHeadersNames[ lname ] = requestHeadersNames[ lname ] || name;
						requestHeaders[ name ] = value;
					}
					return this;
				},

				// Overrides response content-type header
				overrideMimeType: function( type ) {
					if ( !state ) {
						s.mimeType = type;
					}
					return this;
				},

				// Status-dependent callbacks
				statusCode: function( map ) {
					var code;
					if ( map ) {
						if ( state < 2 ) {
							for ( code in map ) {
								// Lazy-add the new callback in a way that preserves old ones
								statusCode[ code ] = [ statusCode[ code ], map[ code ] ];
							}
						} else {
							// Execute the appropriate callbacks
							jqXHR.always( map[ jqXHR.status ] );
						}
					}
					return this;
				},

				// Cancel the request
				abort: function( statusText ) {
					var finalText = statusText || strAbort;
					if ( transport ) {
						transport.abort( finalText );
					}
					done( 0, finalText );
					return this;
				}
			};

		// Attach deferreds
		deferred.promise( jqXHR ).complete = completeDeferred.add;
		jqXHR.success = jqXHR.done;
		jqXHR.error = jqXHR.fail;

		// Remove hash character (#7531: and string promotion)
		// Add protocol if not provided (#5866: IE7 issue with protocol-less urls)
		// Handle falsy url in the settings object (#10093: consistency with old signature)
		// We also use the url parameter if available
		s.url = ( ( url || s.url || ajaxLocation ) + "" ).replace( rhash, "" ).replace( rprotocol, ajaxLocParts[ 1 ] + "//" );

		// Alias method option to type as per ticket #12004
		s.type = options.method || options.type || s.method || s.type;

		// Extract dataTypes list
		s.dataTypes = jQuery.trim( s.dataType || "*" ).toLowerCase().match( rnotwhite ) || [ "" ];

		// A cross-domain request is in order when we have a protocol:host:port mismatch
		if ( s.crossDomain == null ) {
			parts = rurl.exec( s.url.toLowerCase() );
			s.crossDomain = !!( parts &&
				( parts[ 1 ] !== ajaxLocParts[ 1 ] || parts[ 2 ] !== ajaxLocParts[ 2 ] ||
					( parts[ 3 ] || ( parts[ 1 ] === "http:" ? "80" : "443" ) ) !==
						( ajaxLocParts[ 3 ] || ( ajaxLocParts[ 1 ] === "http:" ? "80" : "443" ) ) )
			);
		}

		// Convert data if not already a string
		if ( s.data && s.processData && typeof s.data !== "string" ) {
			s.data = jQuery.param( s.data, s.traditional );
		}

		// Apply prefilters
		inspectPrefiltersOrTransports( prefilters, s, options, jqXHR );

		// If request was aborted inside a prefilter, stop there
		if ( state === 2 ) {
			return jqXHR;
		}

		// We can fire global events as of now if asked to
		fireGlobals = s.global;

		// Watch for a new set of requests
		if ( fireGlobals && jQuery.active++ === 0 ) {
			jQuery.event.trigger("ajaxStart");
		}

		// Uppercase the type
		s.type = s.type.toUpperCase();

		// Determine if request has content
		s.hasContent = !rnoContent.test( s.type );

		// Save the URL in case we're toying with the If-Modified-Since
		// and/or If-None-Match header later on
		cacheURL = s.url;

		// More options handling for requests with no content
		if ( !s.hasContent ) {

			// If data is available, append data to url
			if ( s.data ) {
				cacheURL = ( s.url += ( rquery.test( cacheURL ) ? "&" : "?" ) + s.data );
				// #9682: remove data so that it's not used in an eventual retry
				delete s.data;
			}

			// Add anti-cache in url if needed
			if ( s.cache === false ) {
				s.url = rts.test( cacheURL ) ?

					// If there is already a '_' parameter, set its value
					cacheURL.replace( rts, "$1_=" + nonce++ ) :

					// Otherwise add one to the end
					cacheURL + ( rquery.test( cacheURL ) ? "&" : "?" ) + "_=" + nonce++;
			}
		}

		// Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.
		if ( s.ifModified ) {
			if ( jQuery.lastModified[ cacheURL ] ) {
				jqXHR.setRequestHeader( "If-Modified-Since", jQuery.lastModified[ cacheURL ] );
			}
			if ( jQuery.etag[ cacheURL ] ) {
				jqXHR.setRequestHeader( "If-None-Match", jQuery.etag[ cacheURL ] );
			}
		}

		// Set the correct header, if data is being sent
		if ( s.data && s.hasContent && s.contentType !== false || options.contentType ) {
			jqXHR.setRequestHeader( "Content-Type", s.contentType );
		}

		// Set the Accepts header for the server, depending on the dataType
		jqXHR.setRequestHeader(
			"Accept",
			s.dataTypes[ 0 ] && s.accepts[ s.dataTypes[0] ] ?
				s.accepts[ s.dataTypes[0] ] + ( s.dataTypes[ 0 ] !== "*" ? ", " + allTypes + "; q=0.01" : "" ) :
				s.accepts[ "*" ]
		);

		// Check for headers option
		for ( i in s.headers ) {
			jqXHR.setRequestHeader( i, s.headers[ i ] );
		}

		// Allow custom headers/mimetypes and early abort
		if ( s.beforeSend && ( s.beforeSend.call( callbackContext, jqXHR, s ) === false || state === 2 ) ) {
			// Abort if not done already and return
			return jqXHR.abort();
		}

		// aborting is no longer a cancellation
		strAbort = "abort";

		// Install callbacks on deferreds
		for ( i in { success: 1, error: 1, complete: 1 } ) {
			jqXHR[ i ]( s[ i ] );
		}

		// Get transport
		transport = inspectPrefiltersOrTransports( transports, s, options, jqXHR );

		// If no transport, we auto-abort
		if ( !transport ) {
			done( -1, "No Transport" );
		} else {
			jqXHR.readyState = 1;

			// Send global event
			if ( fireGlobals ) {
				globalEventContext.trigger( "ajaxSend", [ jqXHR, s ] );
			}
			// Timeout
			if ( s.async && s.timeout > 0 ) {
				timeoutTimer = setTimeout(function() {
					jqXHR.abort("timeout");
				}, s.timeout );
			}

			try {
				state = 1;
				transport.send( requestHeaders, done );
			} catch ( e ) {
				// Propagate exception as error if not done
				if ( state < 2 ) {
					done( -1, e );
				// Simply rethrow otherwise
				} else {
					throw e;
				}
			}
		}

		// Callback for when everything is done
		function done( status, nativeStatusText, responses, headers ) {
			var isSuccess, success, error, response, modified,
				statusText = nativeStatusText;

			// Called once
			if ( state === 2 ) {
				return;
			}

			// State is "done" now
			state = 2;

			// Clear timeout if it exists
			if ( timeoutTimer ) {
				clearTimeout( timeoutTimer );
			}

			// Dereference transport for early garbage collection
			// (no matter how long the jqXHR object will be used)
			transport = undefined;

			// Cache response headers
			responseHeadersString = headers || "";

			// Set readyState
			jqXHR.readyState = status > 0 ? 4 : 0;

			// Determine if successful
			isSuccess = status >= 200 && status < 300 || status === 304;

			// Get response data
			if ( responses ) {
				response = ajaxHandleResponses( s, jqXHR, responses );
			}

			// Convert no matter what (that way responseXXX fields are always set)
			response = ajaxConvert( s, response, jqXHR, isSuccess );

			// If successful, handle type chaining
			if ( isSuccess ) {

				// Set the If-Modified-Since and/or If-None-Match header, if in ifModified mode.
				if ( s.ifModified ) {
					modified = jqXHR.getResponseHeader("Last-Modified");
					if ( modified ) {
						jQuery.lastModified[ cacheURL ] = modified;
					}
					modified = jqXHR.getResponseHeader("etag");
					if ( modified ) {
						jQuery.etag[ cacheURL ] = modified;
					}
				}

				// if no content
				if ( status === 204 || s.type === "HEAD" ) {
					statusText = "nocontent";

				// if not modified
				} else if ( status === 304 ) {
					statusText = "notmodified";

				// If we have data, let's convert it
				} else {
					statusText = response.state;
					success = response.data;
					error = response.error;
					isSuccess = !error;
				}
			} else {
				// We extract error from statusText
				// then normalize statusText and status for non-aborts
				error = statusText;
				if ( status || !statusText ) {
					statusText = "error";
					if ( status < 0 ) {
						status = 0;
					}
				}
			}

			// Set data for the fake xhr object
			jqXHR.status = status;
			jqXHR.statusText = ( nativeStatusText || statusText ) + "";

			// Success/Error
			if ( isSuccess ) {
				deferred.resolveWith( callbackContext, [ success, statusText, jqXHR ] );
			} else {
				deferred.rejectWith( callbackContext, [ jqXHR, statusText, error ] );
			}

			// Status-dependent callbacks
			jqXHR.statusCode( statusCode );
			statusCode = undefined;

			if ( fireGlobals ) {
				globalEventContext.trigger( isSuccess ? "ajaxSuccess" : "ajaxError",
					[ jqXHR, s, isSuccess ? success : error ] );
			}

			// Complete
			completeDeferred.fireWith( callbackContext, [ jqXHR, statusText ] );

			if ( fireGlobals ) {
				globalEventContext.trigger( "ajaxComplete", [ jqXHR, s ] );
				// Handle the global AJAX counter
				if ( !( --jQuery.active ) ) {
					jQuery.event.trigger("ajaxStop");
				}
			}
		}

		return jqXHR;
	},

	getJSON: function( url, data, callback ) {
		return jQuery.get( url, data, callback, "json" );
	},

	getScript: function( url, callback ) {
		return jQuery.get( url, undefined, callback, "script" );
	}
});

jQuery.each( [ "get", "post" ], function( i, method ) {
	jQuery[ method ] = function( url, data, callback, type ) {
		// shift arguments if data argument was omitted
		if ( jQuery.isFunction( data ) ) {
			type = type || callback;
			callback = data;
			data = undefined;
		}

		return jQuery.ajax({
			url: url,
			type: method,
			dataType: type,
			data: data,
			success: callback
		});
	};
});

// Attach a bunch of functions for handling common AJAX events
jQuery.each( [ "ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend" ], function( i, type ) {
	jQuery.fn[ type ] = function( fn ) {
		return this.on( type, fn );
	};
});


jQuery._evalUrl = function( url ) {
	return jQuery.ajax({
		url: url,
		type: "GET",
		dataType: "script",
		async: false,
		global: false,
		"throws": true
	});
};


jQuery.fn.extend({
	wrapAll: function( html ) {
		if ( jQuery.isFunction( html ) ) {
			return this.each(function(i) {
				jQuery(this).wrapAll( html.call(this, i) );
			});
		}

		if ( this[0] ) {
			// The elements to wrap the target around
			var wrap = jQuery( html, this[0].ownerDocument ).eq(0).clone(true);

			if ( this[0].parentNode ) {
				wrap.insertBefore( this[0] );
			}

			wrap.map(function() {
				var elem = this;

				while ( elem.firstChild && elem.firstChild.nodeType === 1 ) {
					elem = elem.firstChild;
				}

				return elem;
			}).append( this );
		}

		return this;
	},

	wrapInner: function( html ) {
		if ( jQuery.isFunction( html ) ) {
			return this.each(function(i) {
				jQuery(this).wrapInner( html.call(this, i) );
			});
		}

		return this.each(function() {
			var self = jQuery( this ),
				contents = self.contents();

			if ( contents.length ) {
				contents.wrapAll( html );

			} else {
				self.append( html );
			}
		});
	},

	wrap: function( html ) {
		var isFunction = jQuery.isFunction( html );

		return this.each(function(i) {
			jQuery( this ).wrapAll( isFunction ? html.call(this, i) : html );
		});
	},

	unwrap: function() {
		return this.parent().each(function() {
			if ( !jQuery.nodeName( this, "body" ) ) {
				jQuery( this ).replaceWith( this.childNodes );
			}
		}).end();
	}
});


jQuery.expr.filters.hidden = function( elem ) {
	// Support: Opera <= 12.12
	// Opera reports offsetWidths and offsetHeights less than zero on some elements
	return elem.offsetWidth <= 0 && elem.offsetHeight <= 0 ||
		(!support.reliableHiddenOffsets() &&
			((elem.style && elem.style.display) || jQuery.css( elem, "display" )) === "none");
};

jQuery.expr.filters.visible = function( elem ) {
	return !jQuery.expr.filters.hidden( elem );
};




var r20 = /%20/g,
	rbracket = /\[\]$/,
	rCRLF = /\r?\n/g,
	rsubmitterTypes = /^(?:submit|button|image|reset|file)$/i,
	rsubmittable = /^(?:input|select|textarea|keygen)/i;

function buildParams( prefix, obj, traditional, add ) {
	var name;

	if ( jQuery.isArray( obj ) ) {
		// Serialize array item.
		jQuery.each( obj, function( i, v ) {
			if ( traditional || rbracket.test( prefix ) ) {
				// Treat each array item as a scalar.
				add( prefix, v );

			} else {
				// Item is non-scalar (array or object), encode its numeric index.
				buildParams( prefix + "[" + ( typeof v === "object" ? i : "" ) + "]", v, traditional, add );
			}
		});

	} else if ( !traditional && jQuery.type( obj ) === "object" ) {
		// Serialize object item.
		for ( name in obj ) {
			buildParams( prefix + "[" + name + "]", obj[ name ], traditional, add );
		}

	} else {
		// Serialize scalar item.
		add( prefix, obj );
	}
}

// Serialize an array of form elements or a set of
// key/values into a query string
jQuery.param = function( a, traditional ) {
	var prefix,
		s = [],
		add = function( key, value ) {
			// If value is a function, invoke it and return its value
			value = jQuery.isFunction( value ) ? value() : ( value == null ? "" : value );
			s[ s.length ] = encodeURIComponent( key ) + "=" + encodeURIComponent( value );
		};

	// Set traditional to true for jQuery <= 1.3.2 behavior.
	if ( traditional === undefined ) {
		traditional = jQuery.ajaxSettings && jQuery.ajaxSettings.traditional;
	}

	// If an array was passed in, assume that it is an array of form elements.
	if ( jQuery.isArray( a ) || ( a.jquery && !jQuery.isPlainObject( a ) ) ) {
		// Serialize the form elements
		jQuery.each( a, function() {
			add( this.name, this.value );
		});

	} else {
		// If traditional, encode the "old" way (the way 1.3.2 or older
		// did it), otherwise encode params recursively.
		for ( prefix in a ) {
			buildParams( prefix, a[ prefix ], traditional, add );
		}
	}

	// Return the resulting serialization
	return s.join( "&" ).replace( r20, "+" );
};

jQuery.fn.extend({
	serialize: function() {
		return jQuery.param( this.serializeArray() );
	},
	serializeArray: function() {
		return this.map(function() {
			// Can add propHook for "elements" to filter or add form elements
			var elements = jQuery.prop( this, "elements" );
			return elements ? jQuery.makeArray( elements ) : this;
		})
		.filter(function() {
			var type = this.type;
			// Use .is(":disabled") so that fieldset[disabled] works
			return this.name && !jQuery( this ).is( ":disabled" ) &&
				rsubmittable.test( this.nodeName ) && !rsubmitterTypes.test( type ) &&
				( this.checked || !rcheckableType.test( type ) );
		})
		.map(function( i, elem ) {
			var val = jQuery( this ).val();

			return val == null ?
				null :
				jQuery.isArray( val ) ?
					jQuery.map( val, function( val ) {
						return { name: elem.name, value: val.replace( rCRLF, "\r\n" ) };
					}) :
					{ name: elem.name, value: val.replace( rCRLF, "\r\n" ) };
		}).get();
	}
});


// Create the request object
// (This is still attached to ajaxSettings for backward compatibility)
jQuery.ajaxSettings.xhr = window.ActiveXObject !== undefined ?
	// Support: IE6+
	function() {

		// XHR cannot access local files, always use ActiveX for that case
		return !this.isLocal &&

			// Support: IE7-8
			// oldIE XHR does not support non-RFC2616 methods (#13240)
			// See http://msdn.microsoft.com/en-us/library/ie/ms536648(v=vs.85).aspx
			// and http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9
			// Although this check for six methods instead of eight
			// since IE also does not support "trace" and "connect"
			/^(get|post|head|put|delete|options)$/i.test( this.type ) &&

			createStandardXHR() || createActiveXHR();
	} :
	// For all other browsers, use the standard XMLHttpRequest object
	createStandardXHR;

var xhrId = 0,
	xhrCallbacks = {},
	xhrSupported = jQuery.ajaxSettings.xhr();

// Support: IE<10
// Open requests must be manually aborted on unload (#5280)
if ( window.ActiveXObject ) {
	jQuery( window ).on( "unload", function() {
		for ( var key in xhrCallbacks ) {
			xhrCallbacks[ key ]( undefined, true );
		}
	});
}

// Determine support properties
support.cors = !!xhrSupported && ( "withCredentials" in xhrSupported );
xhrSupported = support.ajax = !!xhrSupported;

// Create transport if the browser can provide an xhr
if ( xhrSupported ) {

	jQuery.ajaxTransport(function( options ) {
		// Cross domain only allowed if supported through XMLHttpRequest
		if ( !options.crossDomain || support.cors ) {

			var callback;

			return {
				send: function( headers, complete ) {
					var i,
						xhr = options.xhr(),
						id = ++xhrId;

					// Open the socket
					xhr.open( options.type, options.url, options.async, options.username, options.password );

					// Apply custom fields if provided
					if ( options.xhrFields ) {
						for ( i in options.xhrFields ) {
							xhr[ i ] = options.xhrFields[ i ];
						}
					}

					// Override mime type if needed
					if ( options.mimeType && xhr.overrideMimeType ) {
						xhr.overrideMimeType( options.mimeType );
					}

					// X-Requested-With header
					// For cross-domain requests, seeing as conditions for a preflight are
					// akin to a jigsaw puzzle, we simply never set it to be sure.
					// (it can always be set on a per-request basis or even using ajaxSetup)
					// For same-domain requests, won't change header if already provided.
					if ( !options.crossDomain && !headers["X-Requested-With"] ) {
						headers["X-Requested-With"] = "XMLHttpRequest";
					}

					// Set headers
					for ( i in headers ) {
						// Support: IE<9
						// IE's ActiveXObject throws a 'Type Mismatch' exception when setting
						// request header to a null-value.
						//
						// To keep consistent with other XHR implementations, cast the value
						// to string and ignore `undefined`.
						if ( headers[ i ] !== undefined ) {
							xhr.setRequestHeader( i, headers[ i ] + "" );
						}
					}

					// Do send the request
					// This may raise an exception which is actually
					// handled in jQuery.ajax (so no try/catch here)
					xhr.send( ( options.hasContent && options.data ) || null );

					// Listener
					callback = function( _, isAbort ) {
						var status, statusText, responses;

						// Was never called and is aborted or complete
						if ( callback && ( isAbort || xhr.readyState === 4 ) ) {
							// Clean up
							delete xhrCallbacks[ id ];
							callback = undefined;
							xhr.onreadystatechange = jQuery.noop;

							// Abort manually if needed
							if ( isAbort ) {
								if ( xhr.readyState !== 4 ) {
									xhr.abort();
								}
							} else {
								responses = {};
								status = xhr.status;

								// Support: IE<10
								// Accessing binary-data responseText throws an exception
								// (#11426)
								if ( typeof xhr.responseText === "string" ) {
									responses.text = xhr.responseText;
								}

								// Firefox throws an exception when accessing
								// statusText for faulty cross-domain requests
								try {
									statusText = xhr.statusText;
								} catch( e ) {
									// We normalize with Webkit giving an empty statusText
									statusText = "";
								}

								// Filter status for non standard behaviors

								// If the request is local and we have data: assume a success
								// (success with no data won't get notified, that's the best we
								// can do given current implementations)
								if ( !status && options.isLocal && !options.crossDomain ) {
									status = responses.text ? 200 : 404;
								// IE - #1450: sometimes returns 1223 when it should be 204
								} else if ( status === 1223 ) {
									status = 204;
								}
							}
						}

						// Call complete if needed
						if ( responses ) {
							complete( status, statusText, responses, xhr.getAllResponseHeaders() );
						}
					};

					if ( !options.async ) {
						// if we're in sync mode we fire the callback
						callback();
					} else if ( xhr.readyState === 4 ) {
						// (IE6 & IE7) if it's in cache and has been
						// retrieved directly we need to fire the callback
						setTimeout( callback );
					} else {
						// Add to the list of active xhr callbacks
						xhr.onreadystatechange = xhrCallbacks[ id ] = callback;
					}
				},

				abort: function() {
					if ( callback ) {
						callback( undefined, true );
					}
				}
			};
		}
	});
}

// Functions to create xhrs
function createStandardXHR() {
	try {
		return new window.XMLHttpRequest();
	} catch( e ) {}
}

function createActiveXHR() {
	try {
		return new window.ActiveXObject( "Microsoft.XMLHTTP" );
	} catch( e ) {}
}




// Install script dataType
jQuery.ajaxSetup({
	accepts: {
		script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"
	},
	contents: {
		script: /(?:java|ecma)script/
	},
	converters: {
		"text script": function( text ) {
			jQuery.globalEval( text );
			return text;
		}
	}
});

// Handle cache's special case and global
jQuery.ajaxPrefilter( "script", function( s ) {
	if ( s.cache === undefined ) {
		s.cache = false;
	}
	if ( s.crossDomain ) {
		s.type = "GET";
		s.global = false;
	}
});

// Bind script tag hack transport
jQuery.ajaxTransport( "script", function(s) {

	// This transport only deals with cross domain requests
	if ( s.crossDomain ) {

		var script,
			head = document.head || jQuery("head")[0] || document.documentElement;

		return {

			send: function( _, callback ) {

				script = document.createElement("script");

				script.async = true;

				if ( s.scriptCharset ) {
					script.charset = s.scriptCharset;
				}

				script.src = s.url;

				// Attach handlers for all browsers
				script.onload = script.onreadystatechange = function( _, isAbort ) {

					if ( isAbort || !script.readyState || /loaded|complete/.test( script.readyState ) ) {

						// Handle memory leak in IE
						script.onload = script.onreadystatechange = null;

						// Remove the script
						if ( script.parentNode ) {
							script.parentNode.removeChild( script );
						}

						// Dereference the script
						script = null;

						// Callback if not abort
						if ( !isAbort ) {
							callback( 200, "success" );
						}
					}
				};

				// Circumvent IE6 bugs with base elements (#2709 and #4378) by prepending
				// Use native DOM manipulation to avoid our domManip AJAX trickery
				head.insertBefore( script, head.firstChild );
			},

			abort: function() {
				if ( script ) {
					script.onload( undefined, true );
				}
			}
		};
	}
});




var oldCallbacks = [],
	rjsonp = /(=)\?(?=&|$)|\?\?/;

// Default jsonp settings
jQuery.ajaxSetup({
	jsonp: "callback",
	jsonpCallback: function() {
		var callback = oldCallbacks.pop() || ( jQuery.expando + "_" + ( nonce++ ) );
		this[ callback ] = true;
		return callback;
	}
});

// Detect, normalize options and install callbacks for jsonp requests
jQuery.ajaxPrefilter( "json jsonp", function( s, originalSettings, jqXHR ) {

	var callbackName, overwritten, responseContainer,
		jsonProp = s.jsonp !== false && ( rjsonp.test( s.url ) ?
			"url" :
			typeof s.data === "string" && !( s.contentType || "" ).indexOf("application/x-www-form-urlencoded") && rjsonp.test( s.data ) && "data"
		);

	// Handle iff the expected data type is "jsonp" or we have a parameter to set
	if ( jsonProp || s.dataTypes[ 0 ] === "jsonp" ) {

		// Get callback name, remembering preexisting value associated with it
		callbackName = s.jsonpCallback = jQuery.isFunction( s.jsonpCallback ) ?
			s.jsonpCallback() :
			s.jsonpCallback;

		// Insert callback into url or form data
		if ( jsonProp ) {
			s[ jsonProp ] = s[ jsonProp ].replace( rjsonp, "$1" + callbackName );
		} else if ( s.jsonp !== false ) {
			s.url += ( rquery.test( s.url ) ? "&" : "?" ) + s.jsonp + "=" + callbackName;
		}

		// Use data converter to retrieve json after script execution
		s.converters["script json"] = function() {
			if ( !responseContainer ) {
				jQuery.error( callbackName + " was not called" );
			}
			return responseContainer[ 0 ];
		};

		// force json dataType
		s.dataTypes[ 0 ] = "json";

		// Install callback
		overwritten = window[ callbackName ];
		window[ callbackName ] = function() {
			responseContainer = arguments;
		};

		// Clean-up function (fires after converters)
		jqXHR.always(function() {
			// Restore preexisting value
			window[ callbackName ] = overwritten;

			// Save back as free
			if ( s[ callbackName ] ) {
				// make sure that re-using the options doesn't screw things around
				s.jsonpCallback = originalSettings.jsonpCallback;

				// save the callback name for future use
				oldCallbacks.push( callbackName );
			}

			// Call if it was a function and we have a response
			if ( responseContainer && jQuery.isFunction( overwritten ) ) {
				overwritten( responseContainer[ 0 ] );
			}

			responseContainer = overwritten = undefined;
		});

		// Delegate to script
		return "script";
	}
});




// data: string of html
// context (optional): If specified, the fragment will be created in this context, defaults to document
// keepScripts (optional): If true, will include scripts passed in the html string
jQuery.parseHTML = function( data, context, keepScripts ) {
	if ( !data || typeof data !== "string" ) {
		return null;
	}
	if ( typeof context === "boolean" ) {
		keepScripts = context;
		context = false;
	}
	context = context || document;

	var parsed = rsingleTag.exec( data ),
		scripts = !keepScripts && [];

	// Single tag
	if ( parsed ) {
		return [ context.createElement( parsed[1] ) ];
	}

	parsed = jQuery.buildFragment( [ data ], context, scripts );

	if ( scripts && scripts.length ) {
		jQuery( scripts ).remove();
	}

	return jQuery.merge( [], parsed.childNodes );
};


// Keep a copy of the old load method
var _load = jQuery.fn.load;

/**
 * Load a url into a page
 */
jQuery.fn.load = function( url, params, callback ) {
	if ( typeof url !== "string" && _load ) {
		return _load.apply( this, arguments );
	}

	var selector, response, type,
		self = this,
		off = url.indexOf(" ");

	if ( off >= 0 ) {
		selector = url.slice( off, url.length );
		url = url.slice( 0, off );
	}

	// If it's a function
	if ( jQuery.isFunction( params ) ) {

		// We assume that it's the callback
		callback = params;
		params = undefined;

	// Otherwise, build a param string
	} else if ( params && typeof params === "object" ) {
		type = "POST";
	}

	// If we have elements to modify, make the request
	if ( self.length > 0 ) {
		jQuery.ajax({
			url: url,

			// if "type" variable is undefined, then "GET" method will be used
			type: type,
			dataType: "html",
			data: params
		}).done(function( responseText ) {

			// Save response for use in complete callback
			response = arguments;

			self.html( selector ?

				// If a selector was specified, locate the right elements in a dummy div
				// Exclude scripts to avoid IE 'Permission Denied' errors
				jQuery("<div>").append( jQuery.parseHTML( responseText ) ).find( selector ) :

				// Otherwise use the full result
				responseText );

		}).complete( callback && function( jqXHR, status ) {
			self.each( callback, response || [ jqXHR.responseText, status, jqXHR ] );
		});
	}

	return this;
};




jQuery.expr.filters.animated = function( elem ) {
	return jQuery.grep(jQuery.timers, function( fn ) {
		return elem === fn.elem;
	}).length;
};





var docElem = window.document.documentElement;

/**
 * Gets a window from an element
 */
function getWindow( elem ) {
	return jQuery.isWindow( elem ) ?
		elem :
		elem.nodeType === 9 ?
			elem.defaultView || elem.parentWindow :
			false;
}

jQuery.offset = {
	setOffset: function( elem, options, i ) {
		var curPosition, curLeft, curCSSTop, curTop, curOffset, curCSSLeft, calculatePosition,
			position = jQuery.css( elem, "position" ),
			curElem = jQuery( elem ),
			props = {};

		// set position first, in-case top/left are set even on static elem
		if ( position === "static" ) {
			elem.style.position = "relative";
		}

		curOffset = curElem.offset();
		curCSSTop = jQuery.css( elem, "top" );
		curCSSLeft = jQuery.css( elem, "left" );
		calculatePosition = ( position === "absolute" || position === "fixed" ) &&
			jQuery.inArray("auto", [ curCSSTop, curCSSLeft ] ) > -1;

		// need to be able to calculate position if either top or left is auto and position is either absolute or fixed
		if ( calculatePosition ) {
			curPosition = curElem.position();
			curTop = curPosition.top;
			curLeft = curPosition.left;
		} else {
			curTop = parseFloat( curCSSTop ) || 0;
			curLeft = parseFloat( curCSSLeft ) || 0;
		}

		if ( jQuery.isFunction( options ) ) {
			options = options.call( elem, i, curOffset );
		}

		if ( options.top != null ) {
			props.top = ( options.top - curOffset.top ) + curTop;
		}
		if ( options.left != null ) {
			props.left = ( options.left - curOffset.left ) + curLeft;
		}

		if ( "using" in options ) {
			options.using.call( elem, props );
		} else {
			curElem.css( props );
		}
	}
};

jQuery.fn.extend({
	offset: function( options ) {
		if ( arguments.length ) {
			return options === undefined ?
				this :
				this.each(function( i ) {
					jQuery.offset.setOffset( this, options, i );
				});
		}

		var docElem, win,
			box = { top: 0, left: 0 },
			elem = this[ 0 ],
			doc = elem && elem.ownerDocument;

		if ( !doc ) {
			return;
		}

		docElem = doc.documentElement;

		// Make sure it's not a disconnected DOM node
		if ( !jQuery.contains( docElem, elem ) ) {
			return box;
		}

		// If we don't have gBCR, just use 0,0 rather than error
		// BlackBerry 5, iOS 3 (original iPhone)
		if ( typeof elem.getBoundingClientRect !== strundefined ) {
			box = elem.getBoundingClientRect();
		}
		win = getWindow( doc );
		return {
			top: box.top  + ( win.pageYOffset || docElem.scrollTop )  - ( docElem.clientTop  || 0 ),
			left: box.left + ( win.pageXOffset || docElem.scrollLeft ) - ( docElem.clientLeft || 0 )
		};
	},

	position: function() {
		if ( !this[ 0 ] ) {
			return;
		}

		var offsetParent, offset,
			parentOffset = { top: 0, left: 0 },
			elem = this[ 0 ];

		// fixed elements are offset from window (parentOffset = {top:0, left: 0}, because it is its only offset parent
		if ( jQuery.css( elem, "position" ) === "fixed" ) {
			// we assume that getBoundingClientRect is available when computed position is fixed
			offset = elem.getBoundingClientRect();
		} else {
			// Get *real* offsetParent
			offsetParent = this.offsetParent();

			// Get correct offsets
			offset = this.offset();
			if ( !jQuery.nodeName( offsetParent[ 0 ], "html" ) ) {
				parentOffset = offsetParent.offset();
			}

			// Add offsetParent borders
			parentOffset.top  += jQuery.css( offsetParent[ 0 ], "borderTopWidth", true );
			parentOffset.left += jQuery.css( offsetParent[ 0 ], "borderLeftWidth", true );
		}

		// Subtract parent offsets and element margins
		// note: when an element has margin: auto the offsetLeft and marginLeft
		// are the same in Safari causing offset.left to incorrectly be 0
		return {
			top:  offset.top  - parentOffset.top - jQuery.css( elem, "marginTop", true ),
			left: offset.left - parentOffset.left - jQuery.css( elem, "marginLeft", true)
		};
	},

	offsetParent: function() {
		return this.map(function() {
			var offsetParent = this.offsetParent || docElem;

			while ( offsetParent && ( !jQuery.nodeName( offsetParent, "html" ) && jQuery.css( offsetParent, "position" ) === "static" ) ) {
				offsetParent = offsetParent.offsetParent;
			}
			return offsetParent || docElem;
		});
	}
});

// Create scrollLeft and scrollTop methods
jQuery.each( { scrollLeft: "pageXOffset", scrollTop: "pageYOffset" }, function( method, prop ) {
	var top = /Y/.test( prop );

	jQuery.fn[ method ] = function( val ) {
		return access( this, function( elem, method, val ) {
			var win = getWindow( elem );

			if ( val === undefined ) {
				return win ? (prop in win) ? win[ prop ] :
					win.document.documentElement[ method ] :
					elem[ method ];
			}

			if ( win ) {
				win.scrollTo(
					!top ? val : jQuery( win ).scrollLeft(),
					top ? val : jQuery( win ).scrollTop()
				);

			} else {
				elem[ method ] = val;
			}
		}, method, val, arguments.length, null );
	};
});

// Add the top/left cssHooks using jQuery.fn.position
// Webkit bug: https://bugs.webkit.org/show_bug.cgi?id=29084
// getComputedStyle returns percent when specified for top/left/bottom/right
// rather than make the css module depend on the offset module, we just check for it here
jQuery.each( [ "top", "left" ], function( i, prop ) {
	jQuery.cssHooks[ prop ] = addGetHookIf( support.pixelPosition,
		function( elem, computed ) {
			if ( computed ) {
				computed = curCSS( elem, prop );
				// if curCSS returns percentage, fallback to offset
				return rnumnonpx.test( computed ) ?
					jQuery( elem ).position()[ prop ] + "px" :
					computed;
			}
		}
	);
});


// Create innerHeight, innerWidth, height, width, outerHeight and outerWidth methods
jQuery.each( { Height: "height", Width: "width" }, function( name, type ) {
	jQuery.each( { padding: "inner" + name, content: type, "": "outer" + name }, function( defaultExtra, funcName ) {
		// margin is only for outerHeight, outerWidth
		jQuery.fn[ funcName ] = function( margin, value ) {
			var chainable = arguments.length && ( defaultExtra || typeof margin !== "boolean" ),
				extra = defaultExtra || ( margin === true || value === true ? "margin" : "border" );

			return access( this, function( elem, type, value ) {
				var doc;

				if ( jQuery.isWindow( elem ) ) {
					// As of 5/8/2012 this will yield incorrect results for Mobile Safari, but there
					// isn't a whole lot we can do. See pull request at this URL for discussion:
					// https://github.com/jquery/jquery/pull/764
					return elem.document.documentElement[ "client" + name ];
				}

				// Get document width or height
				if ( elem.nodeType === 9 ) {
					doc = elem.documentElement;

					// Either scroll[Width/Height] or offset[Width/Height] or client[Width/Height], whichever is greatest
					// unfortunately, this causes bug #3838 in IE6/8 only, but there is currently no good, small way to fix it.
					return Math.max(
						elem.body[ "scroll" + name ], doc[ "scroll" + name ],
						elem.body[ "offset" + name ], doc[ "offset" + name ],
						doc[ "client" + name ]
					);
				}

				return value === undefined ?
					// Get width or height on the element, requesting but not forcing parseFloat
					jQuery.css( elem, type, extra ) :

					// Set width or height on the element
					jQuery.style( elem, type, value, extra );
			}, type, chainable ? margin : undefined, chainable, null );
		};
	});
});


// The number of elements contained in the matched element set
jQuery.fn.size = function() {
	return this.length;
};

jQuery.fn.andSelf = jQuery.fn.addBack;




// Register as a named AMD module, since jQuery can be concatenated with other
// files that may use define, but not via a proper concatenation script that
// understands anonymous AMD modules. A named AMD is safest and most robust
// way to register. Lowercase jquery is used because AMD module names are
// derived from file names, and jQuery is normally delivered in a lowercase
// file name. Do this after creating the global so that if an AMD module wants
// to call noConflict to hide this version of jQuery, it will work.
if ( typeof define === "function" && define.amd ) {
	define( "jquery", [], function() {
		return jQuery;
	});
}




var
	// Map over jQuery in case of overwrite
	_jQuery = window.jQuery,

	// Map over the $ in case of overwrite
	_$ = window.$;

jQuery.noConflict = function( deep ) {
	if ( window.$ === jQuery ) {
		window.$ = _$;
	}

	if ( deep && window.jQuery === jQuery ) {
		window.jQuery = _jQuery;
	}

	return jQuery;
};

// Expose jQuery and $ identifiers, even in
// AMD (#7102#comment:10, https://github.com/jquery/jquery/pull/557)
// and CommonJS for browser emulators (#13566)
if ( typeof noGlobal === strundefined ) {
	window.jQuery = window.$ = jQuery;
}




return jQuery;

}));

},{}],775:[function(require,module,exports){
/*
 A JavaScript implementation of the SHA family of hashes, as
 defined in FIPS PUB 180-4 and FIPS PUB 202, as well as the corresponding
 HMAC implementation as defined in FIPS PUB 198a

 Copyright Brian Turek 2008-2017
 Distributed under the BSD License
 See http://caligatio.github.com/jsSHA/ for more information

 Several functions taken from Paul Johnston
*/
'use strict';(function(Y){function C(c,a,b){var e=0,h=[],n=0,g,l,d,f,m,q,u,r,I=!1,v=[],w=[],t,y=!1,z=!1,x=-1;b=b||{};g=b.encoding||"UTF8";t=b.numRounds||1;if(t!==parseInt(t,10)||1>t)throw Error("numRounds must a integer >= 1");if("SHA-1"===c)m=512,q=K,u=Z,f=160,r=function(a){return a.slice()};else if(0===c.lastIndexOf("SHA-",0))if(q=function(a,b){return L(a,b,c)},u=function(a,b,h,e){var k,f;if("SHA-224"===c||"SHA-256"===c)k=(b+65>>>9<<4)+15,f=16;else if("SHA-384"===c||"SHA-512"===c)k=(b+129>>>10<<
5)+31,f=32;else throw Error("Unexpected error in SHA-2 implementation");for(;a.length<=k;)a.push(0);a[b>>>5]|=128<<24-b%32;b=b+h;a[k]=b&4294967295;a[k-1]=b/4294967296|0;h=a.length;for(b=0;b<h;b+=f)e=L(a.slice(b,b+f),e,c);if("SHA-224"===c)a=[e[0],e[1],e[2],e[3],e[4],e[5],e[6]];else if("SHA-256"===c)a=e;else if("SHA-384"===c)a=[e[0].a,e[0].b,e[1].a,e[1].b,e[2].a,e[2].b,e[3].a,e[3].b,e[4].a,e[4].b,e[5].a,e[5].b];else if("SHA-512"===c)a=[e[0].a,e[0].b,e[1].a,e[1].b,e[2].a,e[2].b,e[3].a,e[3].b,e[4].a,
e[4].b,e[5].a,e[5].b,e[6].a,e[6].b,e[7].a,e[7].b];else throw Error("Unexpected error in SHA-2 implementation");return a},r=function(a){return a.slice()},"SHA-224"===c)m=512,f=224;else if("SHA-256"===c)m=512,f=256;else if("SHA-384"===c)m=1024,f=384;else if("SHA-512"===c)m=1024,f=512;else throw Error("Chosen SHA variant is not supported");else if(0===c.lastIndexOf("SHA3-",0)||0===c.lastIndexOf("SHAKE",0)){var F=6;q=D;r=function(a){var c=[],e;for(e=0;5>e;e+=1)c[e]=a[e].slice();return c};x=1;if("SHA3-224"===
c)m=1152,f=224;else if("SHA3-256"===c)m=1088,f=256;else if("SHA3-384"===c)m=832,f=384;else if("SHA3-512"===c)m=576,f=512;else if("SHAKE128"===c)m=1344,f=-1,F=31,z=!0;else if("SHAKE256"===c)m=1088,f=-1,F=31,z=!0;else throw Error("Chosen SHA variant is not supported");u=function(a,c,e,b,h){e=m;var k=F,f,g=[],n=e>>>5,l=0,d=c>>>5;for(f=0;f<d&&c>=e;f+=n)b=D(a.slice(f,f+n),b),c-=e;a=a.slice(f);for(c%=e;a.length<n;)a.push(0);f=c>>>3;a[f>>2]^=k<<f%4*8;a[n-1]^=2147483648;for(b=D(a,b);32*g.length<h;){a=b[l%
5][l/5|0];g.push(a.b);if(32*g.length>=h)break;g.push(a.a);l+=1;0===64*l%e&&D(null,b)}return g}}else throw Error("Chosen SHA variant is not supported");d=M(a,g,x);l=A(c);this.setHMACKey=function(a,b,h){var k;if(!0===I)throw Error("HMAC key already set");if(!0===y)throw Error("Cannot set HMAC key after calling update");if(!0===z)throw Error("SHAKE is not supported for HMAC");g=(h||{}).encoding||"UTF8";b=M(b,g,x)(a);a=b.binLen;b=b.value;k=m>>>3;h=k/4-1;if(k<a/8){for(b=u(b,a,0,A(c),f);b.length<=h;)b.push(0);
b[h]&=4294967040}else if(k>a/8){for(;b.length<=h;)b.push(0);b[h]&=4294967040}for(a=0;a<=h;a+=1)v[a]=b[a]^909522486,w[a]=b[a]^1549556828;l=q(v,l);e=m;I=!0};this.update=function(a){var c,b,k,f=0,g=m>>>5;c=d(a,h,n);a=c.binLen;b=c.value;c=a>>>5;for(k=0;k<c;k+=g)f+m<=a&&(l=q(b.slice(k,k+g),l),f+=m);e+=f;h=b.slice(f>>>5);n=a%m;y=!0};this.getHash=function(a,b){var k,g,d,m;if(!0===I)throw Error("Cannot call getHash after setting HMAC key");d=N(b);if(!0===z){if(-1===d.shakeLen)throw Error("shakeLen must be specified in options");
f=d.shakeLen}switch(a){case "HEX":k=function(a){return O(a,f,x,d)};break;case "B64":k=function(a){return P(a,f,x,d)};break;case "BYTES":k=function(a){return Q(a,f,x)};break;case "ARRAYBUFFER":try{g=new ArrayBuffer(0)}catch(p){throw Error("ARRAYBUFFER not supported by this environment");}k=function(a){return R(a,f,x)};break;default:throw Error("format must be HEX, B64, BYTES, or ARRAYBUFFER");}m=u(h.slice(),n,e,r(l),f);for(g=1;g<t;g+=1)!0===z&&0!==f%32&&(m[m.length-1]&=16777215>>>24-f%32),m=u(m,f,
0,A(c),f);return k(m)};this.getHMAC=function(a,b){var k,g,d,p;if(!1===I)throw Error("Cannot call getHMAC without first setting HMAC key");d=N(b);switch(a){case "HEX":k=function(a){return O(a,f,x,d)};break;case "B64":k=function(a){return P(a,f,x,d)};break;case "BYTES":k=function(a){return Q(a,f,x)};break;case "ARRAYBUFFER":try{k=new ArrayBuffer(0)}catch(v){throw Error("ARRAYBUFFER not supported by this environment");}k=function(a){return R(a,f,x)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER");
}g=u(h.slice(),n,e,r(l),f);p=q(w,A(c));p=u(g,f,m,p,f);return k(p)}}function b(c,a){this.a=c;this.b=a}function O(c,a,b,e){var h="";a/=8;var n,g,d;d=-1===b?3:0;for(n=0;n<a;n+=1)g=c[n>>>2]>>>8*(d+n%4*b),h+="0123456789abcdef".charAt(g>>>4&15)+"0123456789abcdef".charAt(g&15);return e.outputUpper?h.toUpperCase():h}function P(c,a,b,e){var h="",n=a/8,g,d,p,f;f=-1===b?3:0;for(g=0;g<n;g+=3)for(d=g+1<n?c[g+1>>>2]:0,p=g+2<n?c[g+2>>>2]:0,p=(c[g>>>2]>>>8*(f+g%4*b)&255)<<16|(d>>>8*(f+(g+1)%4*b)&255)<<8|p>>>8*(f+
(g+2)%4*b)&255,d=0;4>d;d+=1)8*g+6*d<=a?h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>6*(3-d)&63):h+=e.b64Pad;return h}function Q(c,a,b){var e="";a/=8;var h,d,g;g=-1===b?3:0;for(h=0;h<a;h+=1)d=c[h>>>2]>>>8*(g+h%4*b)&255,e+=String.fromCharCode(d);return e}function R(c,a,b){a/=8;var e,h=new ArrayBuffer(a),d,g;g=new Uint8Array(h);d=-1===b?3:0;for(e=0;e<a;e+=1)g[e]=c[e>>>2]>>>8*(d+e%4*b)&255;return h}function N(c){var a={outputUpper:!1,b64Pad:"=",shakeLen:-1};c=c||{};
a.outputUpper=c.outputUpper||!1;!0===c.hasOwnProperty("b64Pad")&&(a.b64Pad=c.b64Pad);if(!0===c.hasOwnProperty("shakeLen")){if(0!==c.shakeLen%8)throw Error("shakeLen must be a multiple of 8");a.shakeLen=c.shakeLen}if("boolean"!==typeof a.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!==typeof a.b64Pad)throw Error("Invalid b64Pad formatting option");return a}function M(c,a,b){switch(a){case "UTF8":case "UTF16BE":case "UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE");
}switch(c){case "HEX":c=function(a,c,d){var g=a.length,l,p,f,m,q,u;if(0!==g%2)throw Error("String of HEX type must be in byte increments");c=c||[0];d=d||0;q=d>>>3;u=-1===b?3:0;for(l=0;l<g;l+=2){p=parseInt(a.substr(l,2),16);if(isNaN(p))throw Error("String of HEX type contains invalid characters");m=(l>>>1)+q;for(f=m>>>2;c.length<=f;)c.push(0);c[f]|=p<<8*(u+m%4*b)}return{value:c,binLen:4*g+d}};break;case "TEXT":c=function(c,h,d){var g,l,p=0,f,m,q,u,r,t;h=h||[0];d=d||0;q=d>>>3;if("UTF8"===a)for(t=-1===
b?3:0,f=0;f<c.length;f+=1)for(g=c.charCodeAt(f),l=[],128>g?l.push(g):2048>g?(l.push(192|g>>>6),l.push(128|g&63)):55296>g||57344<=g?l.push(224|g>>>12,128|g>>>6&63,128|g&63):(f+=1,g=65536+((g&1023)<<10|c.charCodeAt(f)&1023),l.push(240|g>>>18,128|g>>>12&63,128|g>>>6&63,128|g&63)),m=0;m<l.length;m+=1){r=p+q;for(u=r>>>2;h.length<=u;)h.push(0);h[u]|=l[m]<<8*(t+r%4*b);p+=1}else if("UTF16BE"===a||"UTF16LE"===a)for(t=-1===b?2:0,l="UTF16LE"===a&&1!==b||"UTF16LE"!==a&&1===b,f=0;f<c.length;f+=1){g=c.charCodeAt(f);
!0===l&&(m=g&255,g=m<<8|g>>>8);r=p+q;for(u=r>>>2;h.length<=u;)h.push(0);h[u]|=g<<8*(t+r%4*b);p+=2}return{value:h,binLen:8*p+d}};break;case "B64":c=function(a,c,d){var g=0,l,p,f,m,q,u,r,t;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");p=a.indexOf("=");a=a.replace(/\=/g,"");if(-1!==p&&p<a.length)throw Error("Invalid '=' found in base-64 string");c=c||[0];d=d||0;u=d>>>3;t=-1===b?3:0;for(p=0;p<a.length;p+=4){q=a.substr(p,4);for(f=m=0;f<q.length;f+=1)l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(q[f]),
m|=l<<18-6*f;for(f=0;f<q.length-1;f+=1){r=g+u;for(l=r>>>2;c.length<=l;)c.push(0);c[l]|=(m>>>16-8*f&255)<<8*(t+r%4*b);g+=1}}return{value:c,binLen:8*g+d}};break;case "BYTES":c=function(a,c,d){var g,l,p,f,m,q;c=c||[0];d=d||0;p=d>>>3;q=-1===b?3:0;for(l=0;l<a.length;l+=1)g=a.charCodeAt(l),m=l+p,f=m>>>2,c.length<=f&&c.push(0),c[f]|=g<<8*(q+m%4*b);return{value:c,binLen:8*a.length+d}};break;case "ARRAYBUFFER":try{c=new ArrayBuffer(0)}catch(e){throw Error("ARRAYBUFFER not supported by this environment");}c=
function(a,c,d){var g,l,p,f,m,q;c=c||[0];d=d||0;l=d>>>3;m=-1===b?3:0;q=new Uint8Array(a);for(g=0;g<a.byteLength;g+=1)f=g+l,p=f>>>2,c.length<=p&&c.push(0),c[p]|=q[g]<<8*(m+f%4*b);return{value:c,binLen:8*a.byteLength+d}};break;default:throw Error("format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER");}return c}function y(c,a){return c<<a|c>>>32-a}function S(c,a){return 32<a?(a-=32,new b(c.b<<a|c.a>>>32-a,c.a<<a|c.b>>>32-a)):0!==a?new b(c.a<<a|c.b>>>32-a,c.b<<a|c.a>>>32-a):c}function w(c,a){return c>>>
a|c<<32-a}function t(c,a){var k=null,k=new b(c.a,c.b);return k=32>=a?new b(k.a>>>a|k.b<<32-a&4294967295,k.b>>>a|k.a<<32-a&4294967295):new b(k.b>>>a-32|k.a<<64-a&4294967295,k.a>>>a-32|k.b<<64-a&4294967295)}function T(c,a){var k=null;return k=32>=a?new b(c.a>>>a,c.b>>>a|c.a<<32-a&4294967295):new b(0,c.a>>>a-32)}function aa(c,a,b){return c&a^~c&b}function ba(c,a,k){return new b(c.a&a.a^~c.a&k.a,c.b&a.b^~c.b&k.b)}function U(c,a,b){return c&a^c&b^a&b}function ca(c,a,k){return new b(c.a&a.a^c.a&k.a^a.a&
k.a,c.b&a.b^c.b&k.b^a.b&k.b)}function da(c){return w(c,2)^w(c,13)^w(c,22)}function ea(c){var a=t(c,28),k=t(c,34);c=t(c,39);return new b(a.a^k.a^c.a,a.b^k.b^c.b)}function fa(c){return w(c,6)^w(c,11)^w(c,25)}function ga(c){var a=t(c,14),k=t(c,18);c=t(c,41);return new b(a.a^k.a^c.a,a.b^k.b^c.b)}function ha(c){return w(c,7)^w(c,18)^c>>>3}function ia(c){var a=t(c,1),k=t(c,8);c=T(c,7);return new b(a.a^k.a^c.a,a.b^k.b^c.b)}function ja(c){return w(c,17)^w(c,19)^c>>>10}function ka(c){var a=t(c,19),k=t(c,61);
c=T(c,6);return new b(a.a^k.a^c.a,a.b^k.b^c.b)}function G(c,a){var b=(c&65535)+(a&65535);return((c>>>16)+(a>>>16)+(b>>>16)&65535)<<16|b&65535}function la(c,a,b,e){var h=(c&65535)+(a&65535)+(b&65535)+(e&65535);return((c>>>16)+(a>>>16)+(b>>>16)+(e>>>16)+(h>>>16)&65535)<<16|h&65535}function H(c,a,b,e,h){var d=(c&65535)+(a&65535)+(b&65535)+(e&65535)+(h&65535);return((c>>>16)+(a>>>16)+(b>>>16)+(e>>>16)+(h>>>16)+(d>>>16)&65535)<<16|d&65535}function ma(c,a){var d,e,h;d=(c.b&65535)+(a.b&65535);e=(c.b>>>16)+
(a.b>>>16)+(d>>>16);h=(e&65535)<<16|d&65535;d=(c.a&65535)+(a.a&65535)+(e>>>16);e=(c.a>>>16)+(a.a>>>16)+(d>>>16);return new b((e&65535)<<16|d&65535,h)}function na(c,a,d,e){var h,n,g;h=(c.b&65535)+(a.b&65535)+(d.b&65535)+(e.b&65535);n=(c.b>>>16)+(a.b>>>16)+(d.b>>>16)+(e.b>>>16)+(h>>>16);g=(n&65535)<<16|h&65535;h=(c.a&65535)+(a.a&65535)+(d.a&65535)+(e.a&65535)+(n>>>16);n=(c.a>>>16)+(a.a>>>16)+(d.a>>>16)+(e.a>>>16)+(h>>>16);return new b((n&65535)<<16|h&65535,g)}function oa(c,a,d,e,h){var n,g,l;n=(c.b&
65535)+(a.b&65535)+(d.b&65535)+(e.b&65535)+(h.b&65535);g=(c.b>>>16)+(a.b>>>16)+(d.b>>>16)+(e.b>>>16)+(h.b>>>16)+(n>>>16);l=(g&65535)<<16|n&65535;n=(c.a&65535)+(a.a&65535)+(d.a&65535)+(e.a&65535)+(h.a&65535)+(g>>>16);g=(c.a>>>16)+(a.a>>>16)+(d.a>>>16)+(e.a>>>16)+(h.a>>>16)+(n>>>16);return new b((g&65535)<<16|n&65535,l)}function B(c,a){return new b(c.a^a.a,c.b^a.b)}function A(c){var a=[],d;if("SHA-1"===c)a=[1732584193,4023233417,2562383102,271733878,3285377520];else if(0===c.lastIndexOf("SHA-",0))switch(a=
[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],d=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],c){case "SHA-224":break;case "SHA-256":a=d;break;case "SHA-384":a=[new b(3418070365,a[0]),new b(1654270250,a[1]),new b(2438529370,a[2]),new b(355462360,a[3]),new b(1731405415,a[4]),new b(41048885895,a[5]),new b(3675008525,a[6]),new b(1203062813,a[7])];break;case "SHA-512":a=[new b(d[0],4089235720),new b(d[1],2227873595),
new b(d[2],4271175723),new b(d[3],1595750129),new b(d[4],2917565137),new b(d[5],725511199),new b(d[6],4215389547),new b(d[7],327033209)];break;default:throw Error("Unknown SHA variant");}else if(0===c.lastIndexOf("SHA3-",0)||0===c.lastIndexOf("SHAKE",0))for(c=0;5>c;c+=1)a[c]=[new b(0,0),new b(0,0),new b(0,0),new b(0,0),new b(0,0)];else throw Error("No SHA variants supported");return a}function K(c,a){var b=[],e,d,n,g,l,p,f;e=a[0];d=a[1];n=a[2];g=a[3];l=a[4];for(f=0;80>f;f+=1)b[f]=16>f?c[f]:y(b[f-
3]^b[f-8]^b[f-14]^b[f-16],1),p=20>f?H(y(e,5),d&n^~d&g,l,1518500249,b[f]):40>f?H(y(e,5),d^n^g,l,1859775393,b[f]):60>f?H(y(e,5),U(d,n,g),l,2400959708,b[f]):H(y(e,5),d^n^g,l,3395469782,b[f]),l=g,g=n,n=y(d,30),d=e,e=p;a[0]=G(e,a[0]);a[1]=G(d,a[1]);a[2]=G(n,a[2]);a[3]=G(g,a[3]);a[4]=G(l,a[4]);return a}function Z(c,a,b,e){var d;for(d=(a+65>>>9<<4)+15;c.length<=d;)c.push(0);c[a>>>5]|=128<<24-a%32;a+=b;c[d]=a&4294967295;c[d-1]=a/4294967296|0;a=c.length;for(d=0;d<a;d+=16)e=K(c.slice(d,d+16),e);return e}function L(c,
a,k){var e,h,n,g,l,p,f,m,q,u,r,t,v,w,y,A,z,x,F,B,C,D,E=[],J;if("SHA-224"===k||"SHA-256"===k)u=64,t=1,D=Number,v=G,w=la,y=H,A=ha,z=ja,x=da,F=fa,C=U,B=aa,J=d;else if("SHA-384"===k||"SHA-512"===k)u=80,t=2,D=b,v=ma,w=na,y=oa,A=ia,z=ka,x=ea,F=ga,C=ca,B=ba,J=V;else throw Error("Unexpected error in SHA-2 implementation");k=a[0];e=a[1];h=a[2];n=a[3];g=a[4];l=a[5];p=a[6];f=a[7];for(r=0;r<u;r+=1)16>r?(q=r*t,m=c.length<=q?0:c[q],q=c.length<=q+1?0:c[q+1],E[r]=new D(m,q)):E[r]=w(z(E[r-2]),E[r-7],A(E[r-15]),E[r-
16]),m=y(f,F(g),B(g,l,p),J[r],E[r]),q=v(x(k),C(k,e,h)),f=p,p=l,l=g,g=v(n,m),n=h,h=e,e=k,k=v(m,q);a[0]=v(k,a[0]);a[1]=v(e,a[1]);a[2]=v(h,a[2]);a[3]=v(n,a[3]);a[4]=v(g,a[4]);a[5]=v(l,a[5]);a[6]=v(p,a[6]);a[7]=v(f,a[7]);return a}function D(c,a){var d,e,h,n,g=[],l=[];if(null!==c)for(e=0;e<c.length;e+=2)a[(e>>>1)%5][(e>>>1)/5|0]=B(a[(e>>>1)%5][(e>>>1)/5|0],new b(c[e+1],c[e]));for(d=0;24>d;d+=1){n=A("SHA3-");for(e=0;5>e;e+=1){h=a[e][0];var p=a[e][1],f=a[e][2],m=a[e][3],q=a[e][4];g[e]=new b(h.a^p.a^f.a^
m.a^q.a,h.b^p.b^f.b^m.b^q.b)}for(e=0;5>e;e+=1)l[e]=B(g[(e+4)%5],S(g[(e+1)%5],1));for(e=0;5>e;e+=1)for(h=0;5>h;h+=1)a[e][h]=B(a[e][h],l[e]);for(e=0;5>e;e+=1)for(h=0;5>h;h+=1)n[h][(2*e+3*h)%5]=S(a[e][h],W[e][h]);for(e=0;5>e;e+=1)for(h=0;5>h;h+=1)a[e][h]=B(n[e][h],new b(~n[(e+1)%5][h].a&n[(e+2)%5][h].a,~n[(e+1)%5][h].b&n[(e+2)%5][h].b));a[0][0]=B(a[0][0],X[d])}return a}var d,V,W,X;d=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,
1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,
2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];V=[new b(d[0],3609767458),new b(d[1],602891725),new b(d[2],3964484399),new b(d[3],2173295548),new b(d[4],4081628472),new b(d[5],3053834265),new b(d[6],2937671579),new b(d[7],3664609560),new b(d[8],2734883394),new b(d[9],1164996542),new b(d[10],1323610764),new b(d[11],3590304994),new b(d[12],4068182383),new b(d[13],991336113),new b(d[14],633803317),new b(d[15],3479774868),new b(d[16],2666613458),new b(d[17],944711139),new b(d[18],2341262773),
new b(d[19],2007800933),new b(d[20],1495990901),new b(d[21],1856431235),new b(d[22],3175218132),new b(d[23],2198950837),new b(d[24],3999719339),new b(d[25],766784016),new b(d[26],2566594879),new b(d[27],3203337956),new b(d[28],1034457026),new b(d[29],2466948901),new b(d[30],3758326383),new b(d[31],168717936),new b(d[32],1188179964),new b(d[33],1546045734),new b(d[34],1522805485),new b(d[35],2643833823),new b(d[36],2343527390),new b(d[37],1014477480),new b(d[38],1206759142),new b(d[39],344077627),
new b(d[40],1290863460),new b(d[41],3158454273),new b(d[42],3505952657),new b(d[43],106217008),new b(d[44],3606008344),new b(d[45],1432725776),new b(d[46],1467031594),new b(d[47],851169720),new b(d[48],3100823752),new b(d[49],1363258195),new b(d[50],3750685593),new b(d[51],3785050280),new b(d[52],3318307427),new b(d[53],3812723403),new b(d[54],2003034995),new b(d[55],3602036899),new b(d[56],1575990012),new b(d[57],1125592928),new b(d[58],2716904306),new b(d[59],442776044),new b(d[60],593698344),new b(d[61],
3733110249),new b(d[62],2999351573),new b(d[63],3815920427),new b(3391569614,3928383900),new b(3515267271,566280711),new b(3940187606,3454069534),new b(4118630271,4000239992),new b(116418474,1914138554),new b(174292421,2731055270),new b(289380356,3203993006),new b(460393269,320620315),new b(685471733,587496836),new b(852142971,1086792851),new b(1017036298,365543100),new b(1126000580,2618297676),new b(1288033470,3409855158),new b(1501505948,4234509866),new b(1607167915,987167468),new b(1816402316,
1246189591)];X=[new b(0,1),new b(0,32898),new b(2147483648,32906),new b(2147483648,2147516416),new b(0,32907),new b(0,2147483649),new b(2147483648,2147516545),new b(2147483648,32777),new b(0,138),new b(0,136),new b(0,2147516425),new b(0,2147483658),new b(0,2147516555),new b(2147483648,139),new b(2147483648,32905),new b(2147483648,32771),new b(2147483648,32770),new b(2147483648,128),new b(0,32778),new b(2147483648,2147483658),new b(2147483648,2147516545),new b(2147483648,32896),new b(0,2147483649),
new b(2147483648,2147516424)];W=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];"function"===typeof define&&define.amd?define(function(){return C}):"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(module.exports=C),exports=C):Y.jsSHA=C})(this);

},{}],776:[function(require,module,exports){
(function (global){
/**
 * @license
 * Lo-Dash 2.4.1 (Custom Build) <http://lodash.com/>
 * Build: `lodash modern -o ./dist/lodash.js`
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <http://lodash.com/license>
 */
;(function() {

  /** Used as a safe reference for `undefined` in pre ES5 environments */
  var undefined;

  /** Used to pool arrays and objects used internally */
  var arrayPool = [],
      objectPool = [];

  /** Used to generate unique IDs */
  var idCounter = 0;

  /** Used to prefix keys to avoid issues with `__proto__` and properties on `Object.prototype` */
  var keyPrefix = +new Date + '';

  /** Used as the size when optimizations are enabled for large arrays */
  var largeArraySize = 75;

  /** Used as the max size of the `arrayPool` and `objectPool` */
  var maxPoolSize = 40;

  /** Used to detect and test whitespace */
  var whitespace = (
    // whitespace
    ' \t\x0B\f\xA0\ufeff' +

    // line terminators
    '\n\r\u2028\u2029' +

    // unicode category "Zs" space separators
    '\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000'
  );

  /** Used to match empty string literals in compiled template source */
  var reEmptyStringLeading = /\b__p \+= '';/g,
      reEmptyStringMiddle = /\b(__p \+=) '' \+/g,
      reEmptyStringTrailing = /(__e\(.*?\)|\b__t\)) \+\n'';/g;

  /**
   * Used to match ES6 template delimiters
   * http://people.mozilla.org/~jorendorff/es6-draft.html#sec-literals-string-literals
   */
  var reEsTemplate = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;

  /** Used to match regexp flags from their coerced string values */
  var reFlags = /\w*$/;

  /** Used to detected named functions */
  var reFuncName = /^\s*function[ \n\r\t]+\w/;

  /** Used to match "interpolate" template delimiters */
  var reInterpolate = /<%=([\s\S]+?)%>/g;

  /** Used to match leading whitespace and zeros to be removed */
  var reLeadingSpacesAndZeros = RegExp('^[' + whitespace + ']*0+(?=.$)');

  /** Used to ensure capturing order of template delimiters */
  var reNoMatch = /($^)/;

  /** Used to detect functions containing a `this` reference */
  var reThis = /\bthis\b/;

  /** Used to match unescaped characters in compiled string literals */
  var reUnescapedString = /['\n\r\t\u2028\u2029\\]/g;

  /** Used to assign default `context` object properties */
  var contextProps = [
    'Array', 'Boolean', 'Date', 'Function', 'Math', 'Number', 'Object',
    'RegExp', 'String', '_', 'attachEvent', 'clearTimeout', 'isFinite', 'isNaN',
    'parseInt', 'setTimeout'
  ];

  /** Used to make template sourceURLs easier to identify */
  var templateCounter = 0;

  /** `Object#toString` result shortcuts */
  var argsClass = '[object Arguments]',
      arrayClass = '[object Array]',
      boolClass = '[object Boolean]',
      dateClass = '[object Date]',
      funcClass = '[object Function]',
      numberClass = '[object Number]',
      objectClass = '[object Object]',
      regexpClass = '[object RegExp]',
      stringClass = '[object String]';

  /** Used to identify object classifications that `_.clone` supports */
  var cloneableClasses = {};
  cloneableClasses[funcClass] = false;
  cloneableClasses[argsClass] = cloneableClasses[arrayClass] =
  cloneableClasses[boolClass] = cloneableClasses[dateClass] =
  cloneableClasses[numberClass] = cloneableClasses[objectClass] =
  cloneableClasses[regexpClass] = cloneableClasses[stringClass] = true;

  /** Used as an internal `_.debounce` options object */
  var debounceOptions = {
    'leading': false,
    'maxWait': 0,
    'trailing': false
  };

  /** Used as the property descriptor for `__bindData__` */
  var descriptor = {
    'configurable': false,
    'enumerable': false,
    'value': null,
    'writable': false
  };

  /** Used to determine if values are of the language type Object */
  var objectTypes = {
    'boolean': false,
    'function': true,
    'object': true,
    'number': false,
    'string': false,
    'undefined': false
  };

  /** Used to escape characters for inclusion in compiled string literals */
  var stringEscapes = {
    '\\': '\\',
    "'": "'",
    '\n': 'n',
    '\r': 'r',
    '\t': 't',
    '\u2028': 'u2028',
    '\u2029': 'u2029'
  };

  /** Used as a reference to the global object */
  var root = (objectTypes[typeof window] && window) || this;

  /** Detect free variable `exports` */
  var freeExports = objectTypes[typeof exports] && exports && !exports.nodeType && exports;

  /** Detect free variable `module` */
  var freeModule = objectTypes[typeof module] && module && !module.nodeType && module;

  /** Detect the popular CommonJS extension `module.exports` */
  var moduleExports = freeModule && freeModule.exports === freeExports && freeExports;

  /** Detect free variable `global` from Node.js or Browserified code and use it as `root` */
  var freeGlobal = objectTypes[typeof global] && global;
  if (freeGlobal && (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal)) {
    root = freeGlobal;
  }

  /*--------------------------------------------------------------------------*/

  /**
   * The base implementation of `_.indexOf` without support for binary searches
   * or `fromIndex` constraints.
   *
   * @private
   * @param {Array} array The array to search.
   * @param {*} value The value to search for.
   * @param {number} [fromIndex=0] The index to search from.
   * @returns {number} Returns the index of the matched value or `-1`.
   */
  function baseIndexOf(array, value, fromIndex) {
    var index = (fromIndex || 0) - 1,
        length = array ? array.length : 0;

    while (++index < length) {
      if (array[index] === value) {
        return index;
      }
    }
    return -1;
  }

  /**
   * An implementation of `_.contains` for cache objects that mimics the return
   * signature of `_.indexOf` by returning `0` if the value is found, else `-1`.
   *
   * @private
   * @param {Object} cache The cache object to inspect.
   * @param {*} value The value to search for.
   * @returns {number} Returns `0` if `value` is found, else `-1`.
   */
  function cacheIndexOf(cache, value) {
    var type = typeof value;
    cache = cache.cache;

    if (type == 'boolean' || value == null) {
      return cache[value] ? 0 : -1;
    }
    if (type != 'number' && type != 'string') {
      type = 'object';
    }
    var key = type == 'number' ? value : keyPrefix + value;
    cache = (cache = cache[type]) && cache[key];

    return type == 'object'
      ? (cache && baseIndexOf(cache, value) > -1 ? 0 : -1)
      : (cache ? 0 : -1);
  }

  /**
   * Adds a given value to the corresponding cache object.
   *
   * @private
   * @param {*} value The value to add to the cache.
   */
  function cachePush(value) {
    var cache = this.cache,
        type = typeof value;

    if (type == 'boolean' || value == null) {
      cache[value] = true;
    } else {
      if (type != 'number' && type != 'string') {
        type = 'object';
      }
      var key = type == 'number' ? value : keyPrefix + value,
          typeCache = cache[type] || (cache[type] = {});

      if (type == 'object') {
        (typeCache[key] || (typeCache[key] = [])).push(value);
      } else {
        typeCache[key] = true;
      }
    }
  }

  /**
   * Used by `_.max` and `_.min` as the default callback when a given
   * collection is a string value.
   *
   * @private
   * @param {string} value The character to inspect.
   * @returns {number} Returns the code unit of given character.
   */
  function charAtCallback(value) {
    return value.charCodeAt(0);
  }

  /**
   * Used by `sortBy` to compare transformed `collection` elements, stable sorting
   * them in ascending order.
   *
   * @private
   * @param {Object} a The object to compare to `b`.
   * @param {Object} b The object to compare to `a`.
   * @returns {number} Returns the sort order indicator of `1` or `-1`.
   */
  function compareAscending(a, b) {
    var ac = a.criteria,
        bc = b.criteria,
        index = -1,
        length = ac.length;

    while (++index < length) {
      var value = ac[index],
          other = bc[index];

      if (value !== other) {
        if (value > other || typeof value == 'undefined') {
          return 1;
        }
        if (value < other || typeof other == 'undefined') {
          return -1;
        }
      }
    }
    // Fixes an `Array#sort` bug in the JS engine embedded in Adobe applications
    // that causes it, under certain circumstances, to return the same value for
    // `a` and `b`. See https://github.com/jashkenas/underscore/pull/1247
    //
    // This also ensures a stable sort in V8 and other engines.
    // See http://code.google.com/p/v8/issues/detail?id=90
    return a.index - b.index;
  }

  /**
   * Creates a cache object to optimize linear searches of large arrays.
   *
   * @private
   * @param {Array} [array=[]] The array to search.
   * @returns {null|Object} Returns the cache object or `null` if caching should not be used.
   */
  function createCache(array) {
    var index = -1,
        length = array.length,
        first = array[0],
        mid = array[(length / 2) | 0],
        last = array[length - 1];

    if (first && typeof first == 'object' &&
        mid && typeof mid == 'object' && last && typeof last == 'object') {
      return false;
    }
    var cache = getObject();
    cache['false'] = cache['null'] = cache['true'] = cache['undefined'] = false;

    var result = getObject();
    result.array = array;
    result.cache = cache;
    result.push = cachePush;

    while (++index < length) {
      result.push(array[index]);
    }
    return result;
  }

  /**
   * Used by `template` to escape characters for inclusion in compiled
   * string literals.
   *
   * @private
   * @param {string} match The matched character to escape.
   * @returns {string} Returns the escaped character.
   */
  function escapeStringChar(match) {
    return '\\' + stringEscapes[match];
  }

  /**
   * Gets an array from the array pool or creates a new one if the pool is empty.
   *
   * @private
   * @returns {Array} The array from the pool.
   */
  function getArray() {
    return arrayPool.pop() || [];
  }

  /**
   * Gets an object from the object pool or creates a new one if the pool is empty.
   *
   * @private
   * @returns {Object} The object from the pool.
   */
  function getObject() {
    return objectPool.pop() || {
      'array': null,
      'cache': null,
      'criteria': null,
      'false': false,
      'index': 0,
      'null': false,
      'number': null,
      'object': null,
      'push': null,
      'string': null,
      'true': false,
      'undefined': false,
      'value': null
    };
  }

  /**
   * Releases the given array back to the array pool.
   *
   * @private
   * @param {Array} [array] The array to release.
   */
  function releaseArray(array) {
    array.length = 0;
    if (arrayPool.length < maxPoolSize) {
      arrayPool.push(array);
    }
  }

  /**
   * Releases the given object back to the object pool.
   *
   * @private
   * @param {Object} [object] The object to release.
   */
  function releaseObject(object) {
    var cache = object.cache;
    if (cache) {
      releaseObject(cache);
    }
    object.array = object.cache = object.criteria = object.object = object.number = object.string = object.value = null;
    if (objectPool.length < maxPoolSize) {
      objectPool.push(object);
    }
  }

  /**
   * Slices the `collection` from the `start` index up to, but not including,
   * the `end` index.
   *
   * Note: This function is used instead of `Array#slice` to support node lists
   * in IE < 9 and to ensure dense arrays are returned.
   *
   * @private
   * @param {Array|Object|string} collection The collection to slice.
   * @param {number} start The start index.
   * @param {number} end The end index.
   * @returns {Array} Returns the new array.
   */
  function slice(array, start, end) {
    start || (start = 0);
    if (typeof end == 'undefined') {
      end = array ? array.length : 0;
    }
    var index = -1,
        length = end - start || 0,
        result = Array(length < 0 ? 0 : length);

    while (++index < length) {
      result[index] = array[start + index];
    }
    return result;
  }

  /*--------------------------------------------------------------------------*/

  /**
   * Create a new `lodash` function using the given context object.
   *
   * @static
   * @memberOf _
   * @category Utilities
   * @param {Object} [context=root] The context object.
   * @returns {Function} Returns the `lodash` function.
   */
  function runInContext(context) {
    // Avoid issues with some ES3 environments that attempt to use values, named
    // after built-in constructors like `Object`, for the creation of literals.
    // ES5 clears this up by stating that literals must use built-in constructors.
    // See http://es5.github.io/#x11.1.5.
    context = context ? _.defaults(root.Object(), context, _.pick(root, contextProps)) : root;

    /** Native constructor references */
    var Array = context.Array,
        Boolean = context.Boolean,
        Date = context.Date,
        Function = context.Function,
        Math = context.Math,
        Number = context.Number,
        Object = context.Object,
        RegExp = context.RegExp,
        String = context.String,
        TypeError = context.TypeError;

    /**
     * Used for `Array` method references.
     *
     * Normally `Array.prototype` would suffice, however, using an array literal
     * avoids issues in Narwhal.
     */
    var arrayRef = [];

    /** Used for native method references */
    var objectProto = Object.prototype;

    /** Used to restore the original `_` reference in `noConflict` */
    var oldDash = context._;

    /** Used to resolve the internal [[Class]] of values */
    var toString = objectProto.toString;

    /** Used to detect if a method is native */
    var reNative = RegExp('^' +
      String(toString)
        .replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
        .replace(/toString| for [^\]]+/g, '.*?') + '$'
    );

    /** Native method shortcuts */
    var ceil = Math.ceil,
        clearTimeout = context.clearTimeout,
        floor = Math.floor,
        fnToString = Function.prototype.toString,
        getPrototypeOf = isNative(getPrototypeOf = Object.getPrototypeOf) && getPrototypeOf,
        hasOwnProperty = objectProto.hasOwnProperty,
        push = arrayRef.push,
        setTimeout = context.setTimeout,
        splice = arrayRef.splice,
        unshift = arrayRef.unshift;

    /** Used to set meta data on functions */
    var defineProperty = (function() {
      // IE 8 only accepts DOM elements
      try {
        var o = {},
            func = isNative(func = Object.defineProperty) && func,
            result = func(o, o, o) && func;
      } catch(e) { }
      return result;
    }());

    /* Native method shortcuts for methods with the same name as other `lodash` methods */
    var nativeCreate = isNative(nativeCreate = Object.create) && nativeCreate,
        nativeIsArray = isNative(nativeIsArray = Array.isArray) && nativeIsArray,
        nativeIsFinite = context.isFinite,
        nativeIsNaN = context.isNaN,
        nativeKeys = isNative(nativeKeys = Object.keys) && nativeKeys,
        nativeMax = Math.max,
        nativeMin = Math.min,
        nativeParseInt = context.parseInt,
        nativeRandom = Math.random;

    /** Used to lookup a built-in constructor by [[Class]] */
    var ctorByClass = {};
    ctorByClass[arrayClass] = Array;
    ctorByClass[boolClass] = Boolean;
    ctorByClass[dateClass] = Date;
    ctorByClass[funcClass] = Function;
    ctorByClass[objectClass] = Object;
    ctorByClass[numberClass] = Number;
    ctorByClass[regexpClass] = RegExp;
    ctorByClass[stringClass] = String;

    /*--------------------------------------------------------------------------*/

    /**
     * Creates a `lodash` object which wraps the given value to enable intuitive
     * method chaining.
     *
     * In addition to Lo-Dash methods, wrappers also have the following `Array` methods:
     * `concat`, `join`, `pop`, `push`, `reverse`, `shift`, `slice`, `sort`, `splice`,
     * and `unshift`
     *
     * Chaining is supported in custom builds as long as the `value` method is
     * implicitly or explicitly included in the build.
     *
     * The chainable wrapper functions are:
     * `after`, `assign`, `bind`, `bindAll`, `bindKey`, `chain`, `compact`,
     * `compose`, `concat`, `countBy`, `create`, `createCallback`, `curry`,
     * `debounce`, `defaults`, `defer`, `delay`, `difference`, `filter`, `flatten`,
     * `forEach`, `forEachRight`, `forIn`, `forInRight`, `forOwn`, `forOwnRight`,
     * `functions`, `groupBy`, `indexBy`, `initial`, `intersection`, `invert`,
     * `invoke`, `keys`, `map`, `max`, `memoize`, `merge`, `min`, `object`, `omit`,
     * `once`, `pairs`, `partial`, `partialRight`, `pick`, `pluck`, `pull`, `push`,
     * `range`, `reject`, `remove`, `rest`, `reverse`, `shuffle`, `slice`, `sort`,
     * `sortBy`, `splice`, `tap`, `throttle`, `times`, `toArray`, `transform`,
     * `union`, `uniq`, `unshift`, `unzip`, `values`, `where`, `without`, `wrap`,
     * and `zip`
     *
     * The non-chainable wrapper functions are:
     * `clone`, `cloneDeep`, `contains`, `escape`, `every`, `find`, `findIndex`,
     * `findKey`, `findLast`, `findLastIndex`, `findLastKey`, `has`, `identity`,
     * `indexOf`, `isArguments`, `isArray`, `isBoolean`, `isDate`, `isElement`,
     * `isEmpty`, `isEqual`, `isFinite`, `isFunction`, `isNaN`, `isNull`, `isNumber`,
     * `isObject`, `isPlainObject`, `isRegExp`, `isString`, `isUndefined`, `join`,
     * `lastIndexOf`, `mixin`, `noConflict`, `parseInt`, `pop`, `random`, `reduce`,
     * `reduceRight`, `result`, `shift`, `size`, `some`, `sortedIndex`, `runInContext`,
     * `template`, `unescape`, `uniqueId`, and `value`
     *
     * The wrapper functions `first` and `last` return wrapped values when `n` is
     * provided, otherwise they return unwrapped values.
     *
     * Explicit chaining can be enabled by using the `_.chain` method.
     *
     * @name _
     * @constructor
     * @category Chaining
     * @param {*} value The value to wrap in a `lodash` instance.
     * @returns {Object} Returns a `lodash` instance.
     * @example
     *
     * var wrapped = _([1, 2, 3]);
     *
     * // returns an unwrapped value
     * wrapped.reduce(function(sum, num) {
     *   return sum + num;
     * });
     * // => 6
     *
     * // returns a wrapped value
     * var squares = wrapped.map(function(num) {
     *   return num * num;
     * });
     *
     * _.isArray(squares);
     * // => false
     *
     * _.isArray(squares.value());
     * // => true
     */
    function lodash(value) {
      // don't wrap if already wrapped, even if wrapped by a different `lodash` constructor
      return (value && typeof value == 'object' && !isArray(value) && hasOwnProperty.call(value, '__wrapped__'))
       ? value
       : new lodashWrapper(value);
    }

    /**
     * A fast path for creating `lodash` wrapper objects.
     *
     * @private
     * @param {*} value The value to wrap in a `lodash` instance.
     * @param {boolean} chainAll A flag to enable chaining for all methods
     * @returns {Object} Returns a `lodash` instance.
     */
    function lodashWrapper(value, chainAll) {
      this.__chain__ = !!chainAll;
      this.__wrapped__ = value;
    }
    // ensure `new lodashWrapper` is an instance of `lodash`
    lodashWrapper.prototype = lodash.prototype;

    /**
     * An object used to flag environments features.
     *
     * @static
     * @memberOf _
     * @type Object
     */
    var support = lodash.support = {};

    /**
     * Detect if functions can be decompiled by `Function#toString`
     * (all but PS3 and older Opera mobile browsers & avoided in Windows 8 apps).
     *
     * @memberOf _.support
     * @type boolean
     */
    support.funcDecomp = !isNative(context.WinRTError) && reThis.test(runInContext);

    /**
     * Detect if `Function#name` is supported (all but IE).
     *
     * @memberOf _.support
     * @type boolean
     */
    support.funcNames = typeof Function.name == 'string';

    /**
     * By default, the template delimiters used by Lo-Dash are similar to those in
     * embedded Ruby (ERB). Change the following template settings to use alternative
     * delimiters.
     *
     * @static
     * @memberOf _
     * @type Object
     */
    lodash.templateSettings = {

      /**
       * Used to detect `data` property values to be HTML-escaped.
       *
       * @memberOf _.templateSettings
       * @type RegExp
       */
      'escape': /<%-([\s\S]+?)%>/g,

      /**
       * Used to detect code to be evaluated.
       *
       * @memberOf _.templateSettings
       * @type RegExp
       */
      'evaluate': /<%([\s\S]+?)%>/g,

      /**
       * Used to detect `data` property values to inject.
       *
       * @memberOf _.templateSettings
       * @type RegExp
       */
      'interpolate': reInterpolate,

      /**
       * Used to reference the data object in the template text.
       *
       * @memberOf _.templateSettings
       * @type string
       */
      'variable': '',

      /**
       * Used to import variables into the compiled template.
       *
       * @memberOf _.templateSettings
       * @type Object
       */
      'imports': {

        /**
         * A reference to the `lodash` function.
         *
         * @memberOf _.templateSettings.imports
         * @type Function
         */
        '_': lodash
      }
    };

    /*--------------------------------------------------------------------------*/

    /**
     * The base implementation of `_.bind` that creates the bound function and
     * sets its meta data.
     *
     * @private
     * @param {Array} bindData The bind data array.
     * @returns {Function} Returns the new bound function.
     */
    function baseBind(bindData) {
      var func = bindData[0],
          partialArgs = bindData[2],
          thisArg = bindData[4];

      function bound() {
        // `Function#bind` spec
        // http://es5.github.io/#x15.3.4.5
        if (partialArgs) {
          // avoid `arguments` object deoptimizations by using `slice` instead
          // of `Array.prototype.slice.call` and not assigning `arguments` to a
          // variable as a ternary expression
          var args = slice(partialArgs);
          push.apply(args, arguments);
        }
        // mimic the constructor's `return` behavior
        // http://es5.github.io/#x13.2.2
        if (this instanceof bound) {
          // ensure `new bound` is an instance of `func`
          var thisBinding = baseCreate(func.prototype),
              result = func.apply(thisBinding, args || arguments);
          return isObject(result) ? result : thisBinding;
        }
        return func.apply(thisArg, args || arguments);
      }
      setBindData(bound, bindData);
      return bound;
    }

    /**
     * The base implementation of `_.clone` without argument juggling or support
     * for `thisArg` binding.
     *
     * @private
     * @param {*} value The value to clone.
     * @param {boolean} [isDeep=false] Specify a deep clone.
     * @param {Function} [callback] The function to customize cloning values.
     * @param {Array} [stackA=[]] Tracks traversed source objects.
     * @param {Array} [stackB=[]] Associates clones with source counterparts.
     * @returns {*} Returns the cloned value.
     */
    function baseClone(value, isDeep, callback, stackA, stackB) {
      if (callback) {
        var result = callback(value);
        if (typeof result != 'undefined') {
          return result;
        }
      }
      // inspect [[Class]]
      var isObj = isObject(value);
      if (isObj) {
        var className = toString.call(value);
        if (!cloneableClasses[className]) {
          return value;
        }
        var ctor = ctorByClass[className];
        switch (className) {
          case boolClass:
          case dateClass:
            return new ctor(+value);

          case numberClass:
          case stringClass:
            return new ctor(value);

          case regexpClass:
            result = ctor(value.source, reFlags.exec(value));
            result.lastIndex = value.lastIndex;
            return result;
        }
      } else {
        return value;
      }
      var isArr = isArray(value);
      if (isDeep) {
        // check for circular references and return corresponding clone
        var initedStack = !stackA;
        stackA || (stackA = getArray());
        stackB || (stackB = getArray());

        var length = stackA.length;
        while (length--) {
          if (stackA[length] == value) {
            return stackB[length];
          }
        }
        result = isArr ? ctor(value.length) : {};
      }
      else {
        result = isArr ? slice(value) : assign({}, value);
      }
      // add array properties assigned by `RegExp#exec`
      if (isArr) {
        if (hasOwnProperty.call(value, 'index')) {
          result.index = value.index;
        }
        if (hasOwnProperty.call(value, 'input')) {
          result.input = value.input;
        }
      }
      // exit for shallow clone
      if (!isDeep) {
        return result;
      }
      // add the source value to the stack of traversed objects
      // and associate it with its clone
      stackA.push(value);
      stackB.push(result);

      // recursively populate clone (susceptible to call stack limits)
      (isArr ? forEach : forOwn)(value, function(objValue, key) {
        result[key] = baseClone(objValue, isDeep, callback, stackA, stackB);
      });

      if (initedStack) {
        releaseArray(stackA);
        releaseArray(stackB);
      }
      return result;
    }

    /**
     * The base implementation of `_.create` without support for assigning
     * properties to the created object.
     *
     * @private
     * @param {Object} prototype The object to inherit from.
     * @returns {Object} Returns the new object.
     */
    function baseCreate(prototype, properties) {
      return isObject(prototype) ? nativeCreate(prototype) : {};
    }
    // fallback for browsers without `Object.create`
    if (!nativeCreate) {
      baseCreate = (function() {
        function Object() {}
        return function(prototype) {
          if (isObject(prototype)) {
            Object.prototype = prototype;
            var result = new Object;
            Object.prototype = null;
          }
          return result || context.Object();
        };
      }());
    }

    /**
     * The base implementation of `_.createCallback` without support for creating
     * "_.pluck" or "_.where" style callbacks.
     *
     * @private
     * @param {*} [func=identity] The value to convert to a callback.
     * @param {*} [thisArg] The `this` binding of the created callback.
     * @param {number} [argCount] The number of arguments the callback accepts.
     * @returns {Function} Returns a callback function.
     */
    function baseCreateCallback(func, thisArg, argCount) {
      if (typeof func != 'function') {
        return identity;
      }
      // exit early for no `thisArg` or already bound by `Function#bind`
      if (typeof thisArg == 'undefined' || !('prototype' in func)) {
        return func;
      }
      var bindData = func.__bindData__;
      if (typeof bindData == 'undefined') {
        if (support.funcNames) {
          bindData = !func.name;
        }
        bindData = bindData || !support.funcDecomp;
        if (!bindData) {
          var source = fnToString.call(func);
          if (!support.funcNames) {
            bindData = !reFuncName.test(source);
          }
          if (!bindData) {
            // checks if `func` references the `this` keyword and stores the result
            bindData = reThis.test(source);
            setBindData(func, bindData);
          }
        }
      }
      // exit early if there are no `this` references or `func` is bound
      if (bindData === false || (bindData !== true && bindData[1] & 1)) {
        return func;
      }
      switch (argCount) {
        case 1: return function(value) {
          return func.call(thisArg, value);
        };
        case 2: return function(a, b) {
          return func.call(thisArg, a, b);
        };
        case 3: return function(value, index, collection) {
          return func.call(thisArg, value, index, collection);
        };
        case 4: return function(accumulator, value, index, collection) {
          return func.call(thisArg, accumulator, value, index, collection);
        };
      }
      return bind(func, thisArg);
    }

    /**
     * The base implementation of `createWrapper` that creates the wrapper and
     * sets its meta data.
     *
     * @private
     * @param {Array} bindData The bind data array.
     * @returns {Function} Returns the new function.
     */
    function baseCreateWrapper(bindData) {
      var func = bindData[0],
          bitmask = bindData[1],
          partialArgs = bindData[2],
          partialRightArgs = bindData[3],
          thisArg = bindData[4],
          arity = bindData[5];

      var isBind = bitmask & 1,
          isBindKey = bitmask & 2,
          isCurry = bitmask & 4,
          isCurryBound = bitmask & 8,
          key = func;

      function bound() {
        var thisBinding = isBind ? thisArg : this;
        if (partialArgs) {
          var args = slice(partialArgs);
          push.apply(args, arguments);
        }
        if (partialRightArgs || isCurry) {
          args || (args = slice(arguments));
          if (partialRightArgs) {
            push.apply(args, partialRightArgs);
          }
          if (isCurry && args.length < arity) {
            bitmask |= 16 & ~32;
            return baseCreateWrapper([func, (isCurryBound ? bitmask : bitmask & ~3), args, null, thisArg, arity]);
          }
        }
        args || (args = arguments);
        if (isBindKey) {
          func = thisBinding[key];
        }
        if (this instanceof bound) {
          thisBinding = baseCreate(func.prototype);
          var result = func.apply(thisBinding, args);
          return isObject(result) ? result : thisBinding;
        }
        return func.apply(thisBinding, args);
      }
      setBindData(bound, bindData);
      return bound;
    }

    /**
     * The base implementation of `_.difference` that accepts a single array
     * of values to exclude.
     *
     * @private
     * @param {Array} array The array to process.
     * @param {Array} [values] The array of values to exclude.
     * @returns {Array} Returns a new array of filtered values.
     */
    function baseDifference(array, values) {
      var index = -1,
          indexOf = getIndexOf(),
          length = array ? array.length : 0,
          isLarge = length >= largeArraySize && indexOf === baseIndexOf,
          result = [];

      if (isLarge) {
        var cache = createCache(values);
        if (cache) {
          indexOf = cacheIndexOf;
          values = cache;
        } else {
          isLarge = false;
        }
      }
      while (++index < length) {
        var value = array[index];
        if (indexOf(values, value) < 0) {
          result.push(value);
        }
      }
      if (isLarge) {
        releaseObject(values);
      }
      return result;
    }

    /**
     * The base implementation of `_.flatten` without support for callback
     * shorthands or `thisArg` binding.
     *
     * @private
     * @param {Array} array The array to flatten.
     * @param {boolean} [isShallow=false] A flag to restrict flattening to a single level.
     * @param {boolean} [isStrict=false] A flag to restrict flattening to arrays and `arguments` objects.
     * @param {number} [fromIndex=0] The index to start from.
     * @returns {Array} Returns a new flattened array.
     */
    function baseFlatten(array, isShallow, isStrict, fromIndex) {
      var index = (fromIndex || 0) - 1,
          length = array ? array.length : 0,
          result = [];

      while (++index < length) {
        var value = array[index];

        if (value && typeof value == 'object' && typeof value.length == 'number'
            && (isArray(value) || isArguments(value))) {
          // recursively flatten arrays (susceptible to call stack limits)
          if (!isShallow) {
            value = baseFlatten(value, isShallow, isStrict);
          }
          var valIndex = -1,
              valLength = value.length,
              resIndex = result.length;

          result.length += valLength;
          while (++valIndex < valLength) {
            result[resIndex++] = value[valIndex];
          }
        } else if (!isStrict) {
          result.push(value);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.isEqual`, without support for `thisArg` binding,
     * that allows partial "_.where" style comparisons.
     *
     * @private
     * @param {*} a The value to compare.
     * @param {*} b The other value to compare.
     * @param {Function} [callback] The function to customize comparing values.
     * @param {Function} [isWhere=false] A flag to indicate performing partial comparisons.
     * @param {Array} [stackA=[]] Tracks traversed `a` objects.
     * @param {Array} [stackB=[]] Tracks traversed `b` objects.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     */
    function baseIsEqual(a, b, callback, isWhere, stackA, stackB) {
      // used to indicate that when comparing objects, `a` has at least the properties of `b`
      if (callback) {
        var result = callback(a, b);
        if (typeof result != 'undefined') {
          return !!result;
        }
      }
      // exit early for identical values
      if (a === b) {
        // treat `+0` vs. `-0` as not equal
        return a !== 0 || (1 / a == 1 / b);
      }
      var type = typeof a,
          otherType = typeof b;

      // exit early for unlike primitive values
      if (a === a &&
          !(a && objectTypes[type]) &&
          !(b && objectTypes[otherType])) {
        return false;
      }
      // exit early for `null` and `undefined` avoiding ES3's Function#call behavior
      // http://es5.github.io/#x15.3.4.4
      if (a == null || b == null) {
        return a === b;
      }
      // compare [[Class]] names
      var className = toString.call(a),
          otherClass = toString.call(b);

      if (className == argsClass) {
        className = objectClass;
      }
      if (otherClass == argsClass) {
        otherClass = objectClass;
      }
      if (className != otherClass) {
        return false;
      }
      switch (className) {
        case boolClass:
        case dateClass:
          // coerce dates and booleans to numbers, dates to milliseconds and booleans
          // to `1` or `0` treating invalid dates coerced to `NaN` as not equal
          return +a == +b;

        case numberClass:
          // treat `NaN` vs. `NaN` as equal
          return (a != +a)
            ? b != +b
            // but treat `+0` vs. `-0` as not equal
            : (a == 0 ? (1 / a == 1 / b) : a == +b);

        case regexpClass:
        case stringClass:
          // coerce regexes to strings (http://es5.github.io/#x15.10.6.4)
          // treat string primitives and their corresponding object instances as equal
          return a == String(b);
      }
      var isArr = className == arrayClass;
      if (!isArr) {
        // unwrap any `lodash` wrapped values
        var aWrapped = hasOwnProperty.call(a, '__wrapped__'),
            bWrapped = hasOwnProperty.call(b, '__wrapped__');

        if (aWrapped || bWrapped) {
          return baseIsEqual(aWrapped ? a.__wrapped__ : a, bWrapped ? b.__wrapped__ : b, callback, isWhere, stackA, stackB);
        }
        // exit for functions and DOM nodes
        if (className != objectClass) {
          return false;
        }
        // in older versions of Opera, `arguments` objects have `Array` constructors
        var ctorA = a.constructor,
            ctorB = b.constructor;

        // non `Object` object instances with different constructors are not equal
        if (ctorA != ctorB &&
              !(isFunction(ctorA) && ctorA instanceof ctorA && isFunction(ctorB) && ctorB instanceof ctorB) &&
              ('constructor' in a && 'constructor' in b)
            ) {
          return false;
        }
      }
      // assume cyclic structures are equal
      // the algorithm for detecting cyclic structures is adapted from ES 5.1
      // section 15.12.3, abstract operation `JO` (http://es5.github.io/#x15.12.3)
      var initedStack = !stackA;
      stackA || (stackA = getArray());
      stackB || (stackB = getArray());

      var length = stackA.length;
      while (length--) {
        if (stackA[length] == a) {
          return stackB[length] == b;
        }
      }
      var size = 0;
      result = true;

      // add `a` and `b` to the stack of traversed objects
      stackA.push(a);
      stackB.push(b);

      // recursively compare objects and arrays (susceptible to call stack limits)
      if (isArr) {
        // compare lengths to determine if a deep comparison is necessary
        length = a.length;
        size = b.length;
        result = size == length;

        if (result || isWhere) {
          // deep compare the contents, ignoring non-numeric properties
          while (size--) {
            var index = length,
                value = b[size];

            if (isWhere) {
              while (index--) {
                if ((result = baseIsEqual(a[index], value, callback, isWhere, stackA, stackB))) {
                  break;
                }
              }
            } else if (!(result = baseIsEqual(a[size], value, callback, isWhere, stackA, stackB))) {
              break;
            }
          }
        }
      }
      else {
        // deep compare objects using `forIn`, instead of `forOwn`, to avoid `Object.keys`
        // which, in this case, is more costly
        forIn(b, function(value, key, b) {
          if (hasOwnProperty.call(b, key)) {
            // count the number of properties.
            size++;
            // deep compare each property value.
            return (result = hasOwnProperty.call(a, key) && baseIsEqual(a[key], value, callback, isWhere, stackA, stackB));
          }
        });

        if (result && !isWhere) {
          // ensure both objects have the same number of properties
          forIn(a, function(value, key, a) {
            if (hasOwnProperty.call(a, key)) {
              // `size` will be `-1` if `a` has more properties than `b`
              return (result = --size > -1);
            }
          });
        }
      }
      stackA.pop();
      stackB.pop();

      if (initedStack) {
        releaseArray(stackA);
        releaseArray(stackB);
      }
      return result;
    }

    /**
     * The base implementation of `_.merge` without argument juggling or support
     * for `thisArg` binding.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @param {Function} [callback] The function to customize merging properties.
     * @param {Array} [stackA=[]] Tracks traversed source objects.
     * @param {Array} [stackB=[]] Associates values with source counterparts.
     */
    function baseMerge(object, source, callback, stackA, stackB) {
      (isArray(source) ? forEach : forOwn)(source, function(source, key) {
        var found,
            isArr,
            result = source,
            value = object[key];

        if (source && ((isArr = isArray(source)) || isPlainObject(source))) {
          // avoid merging previously merged cyclic sources
          var stackLength = stackA.length;
          while (stackLength--) {
            if ((found = stackA[stackLength] == source)) {
              value = stackB[stackLength];
              break;
            }
          }
          if (!found) {
            var isShallow;
            if (callback) {
              result = callback(value, source);
              if ((isShallow = typeof result != 'undefined')) {
                value = result;
              }
            }
            if (!isShallow) {
              value = isArr
                ? (isArray(value) ? value : [])
                : (isPlainObject(value) ? value : {});
            }
            // add `source` and associated `value` to the stack of traversed objects
            stackA.push(source);
            stackB.push(value);

            // recursively merge objects and arrays (susceptible to call stack limits)
            if (!isShallow) {
              baseMerge(value, source, callback, stackA, stackB);
            }
          }
        }
        else {
          if (callback) {
            result = callback(value, source);
            if (typeof result == 'undefined') {
              result = source;
            }
          }
          if (typeof result != 'undefined') {
            value = result;
          }
        }
        object[key] = value;
      });
    }

    /**
     * The base implementation of `_.random` without argument juggling or support
     * for returning floating-point numbers.
     *
     * @private
     * @param {number} min The minimum possible value.
     * @param {number} max The maximum possible value.
     * @returns {number} Returns a random number.
     */
    function baseRandom(min, max) {
      return min + floor(nativeRandom() * (max - min + 1));
    }

    /**
     * The base implementation of `_.uniq` without support for callback shorthands
     * or `thisArg` binding.
     *
     * @private
     * @param {Array} array The array to process.
     * @param {boolean} [isSorted=false] A flag to indicate that `array` is sorted.
     * @param {Function} [callback] The function called per iteration.
     * @returns {Array} Returns a duplicate-value-free array.
     */
    function baseUniq(array, isSorted, callback) {
      var index = -1,
          indexOf = getIndexOf(),
          length = array ? array.length : 0,
          result = [];

      var isLarge = !isSorted && length >= largeArraySize && indexOf === baseIndexOf,
          seen = (callback || isLarge) ? getArray() : result;

      if (isLarge) {
        var cache = createCache(seen);
        indexOf = cacheIndexOf;
        seen = cache;
      }
      while (++index < length) {
        var value = array[index],
            computed = callback ? callback(value, index, array) : value;

        if (isSorted
              ? !index || seen[seen.length - 1] !== computed
              : indexOf(seen, computed) < 0
            ) {
          if (callback || isLarge) {
            seen.push(computed);
          }
          result.push(value);
        }
      }
      if (isLarge) {
        releaseArray(seen.array);
        releaseObject(seen);
      } else if (callback) {
        releaseArray(seen);
      }
      return result;
    }

    /**
     * Creates a function that aggregates a collection, creating an object composed
     * of keys generated from the results of running each element of the collection
     * through a callback. The given `setter` function sets the keys and values
     * of the composed object.
     *
     * @private
     * @param {Function} setter The setter function.
     * @returns {Function} Returns the new aggregator function.
     */
    function createAggregator(setter) {
      return function(collection, callback, thisArg) {
        var result = {};
        callback = lodash.createCallback(callback, thisArg, 3);

        var index = -1,
            length = collection ? collection.length : 0;

        if (typeof length == 'number') {
          while (++index < length) {
            var value = collection[index];
            setter(result, value, callback(value, index, collection), collection);
          }
        } else {
          forOwn(collection, function(value, key, collection) {
            setter(result, value, callback(value, key, collection), collection);
          });
        }
        return result;
      };
    }

    /**
     * Creates a function that, when called, either curries or invokes `func`
     * with an optional `this` binding and partially applied arguments.
     *
     * @private
     * @param {Function|string} func The function or method name to reference.
     * @param {number} bitmask The bitmask of method flags to compose.
     *  The bitmask may be composed of the following flags:
     *  1 - `_.bind`
     *  2 - `_.bindKey`
     *  4 - `_.curry`
     *  8 - `_.curry` (bound)
     *  16 - `_.partial`
     *  32 - `_.partialRight`
     * @param {Array} [partialArgs] An array of arguments to prepend to those
     *  provided to the new function.
     * @param {Array} [partialRightArgs] An array of arguments to append to those
     *  provided to the new function.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {number} [arity] The arity of `func`.
     * @returns {Function} Returns the new function.
     */
    function createWrapper(func, bitmask, partialArgs, partialRightArgs, thisArg, arity) {
      var isBind = bitmask & 1,
          isBindKey = bitmask & 2,
          isCurry = bitmask & 4,
          isCurryBound = bitmask & 8,
          isPartial = bitmask & 16,
          isPartialRight = bitmask & 32;

      if (!isBindKey && !isFunction(func)) {
        throw new TypeError;
      }
      if (isPartial && !partialArgs.length) {
        bitmask &= ~16;
        isPartial = partialArgs = false;
      }
      if (isPartialRight && !partialRightArgs.length) {
        bitmask &= ~32;
        isPartialRight = partialRightArgs = false;
      }
      var bindData = func && func.__bindData__;
      if (bindData && bindData !== true) {
        // clone `bindData`
        bindData = slice(bindData);
        if (bindData[2]) {
          bindData[2] = slice(bindData[2]);
        }
        if (bindData[3]) {
          bindData[3] = slice(bindData[3]);
        }
        // set `thisBinding` is not previously bound
        if (isBind && !(bindData[1] & 1)) {
          bindData[4] = thisArg;
        }
        // set if previously bound but not currently (subsequent curried functions)
        if (!isBind && bindData[1] & 1) {
          bitmask |= 8;
        }
        // set curried arity if not yet set
        if (isCurry && !(bindData[1] & 4)) {
          bindData[5] = arity;
        }
        // append partial left arguments
        if (isPartial) {
          push.apply(bindData[2] || (bindData[2] = []), partialArgs);
        }
        // append partial right arguments
        if (isPartialRight) {
          unshift.apply(bindData[3] || (bindData[3] = []), partialRightArgs);
        }
        // merge flags
        bindData[1] |= bitmask;
        return createWrapper.apply(null, bindData);
      }
      // fast path for `_.bind`
      var creater = (bitmask == 1 || bitmask === 17) ? baseBind : baseCreateWrapper;
      return creater([func, bitmask, partialArgs, partialRightArgs, thisArg, arity]);
    }

    /**
     * Used by `escape` to convert characters to HTML entities.
     *
     * @private
     * @param {string} match The matched character to escape.
     * @returns {string} Returns the escaped character.
     */
    function escapeHtmlChar(match) {
      return htmlEscapes[match];
    }

    /**
     * Gets the appropriate "indexOf" function. If the `_.indexOf` method is
     * customized, this method returns the custom method, otherwise it returns
     * the `baseIndexOf` function.
     *
     * @private
     * @returns {Function} Returns the "indexOf" function.
     */
    function getIndexOf() {
      var result = (result = lodash.indexOf) === indexOf ? baseIndexOf : result;
      return result;
    }

    /**
     * Checks if `value` is a native function.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is a native function, else `false`.
     */
    function isNative(value) {
      return typeof value == 'function' && reNative.test(value);
    }

    /**
     * Sets `this` binding data on a given function.
     *
     * @private
     * @param {Function} func The function to set data on.
     * @param {Array} value The data array to set.
     */
    var setBindData = !defineProperty ? noop : function(func, value) {
      descriptor.value = value;
      defineProperty(func, '__bindData__', descriptor);
    };

    /**
     * A fallback implementation of `isPlainObject` which checks if a given value
     * is an object created by the `Object` constructor, assuming objects created
     * by the `Object` constructor have no inherited enumerable properties and that
     * there are no `Object.prototype` extensions.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.
     */
    function shimIsPlainObject(value) {
      var ctor,
          result;

      // avoid non Object objects, `arguments` objects, and DOM elements
      if (!(value && toString.call(value) == objectClass) ||
          (ctor = value.constructor, isFunction(ctor) && !(ctor instanceof ctor))) {
        return false;
      }
      // In most environments an object's own properties are iterated before
      // its inherited properties. If the last iterated property is an object's
      // own property then there are no inherited enumerable properties.
      forIn(value, function(value, key) {
        result = key;
      });
      return typeof result == 'undefined' || hasOwnProperty.call(value, result);
    }

    /**
     * Used by `unescape` to convert HTML entities to characters.
     *
     * @private
     * @param {string} match The matched character to unescape.
     * @returns {string} Returns the unescaped character.
     */
    function unescapeHtmlChar(match) {
      return htmlUnescapes[match];
    }

    /*--------------------------------------------------------------------------*/

    /**
     * Checks if `value` is an `arguments` object.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is an `arguments` object, else `false`.
     * @example
     *
     * (function() { return _.isArguments(arguments); })(1, 2, 3);
     * // => true
     *
     * _.isArguments([1, 2, 3]);
     * // => false
     */
    function isArguments(value) {
      return value && typeof value == 'object' && typeof value.length == 'number' &&
        toString.call(value) == argsClass || false;
    }

    /**
     * Checks if `value` is an array.
     *
     * @static
     * @memberOf _
     * @type Function
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is an array, else `false`.
     * @example
     *
     * (function() { return _.isArray(arguments); })();
     * // => false
     *
     * _.isArray([1, 2, 3]);
     * // => true
     */
    var isArray = nativeIsArray || function(value) {
      return value && typeof value == 'object' && typeof value.length == 'number' &&
        toString.call(value) == arrayClass || false;
    };

    /**
     * A fallback implementation of `Object.keys` which produces an array of the
     * given object's own enumerable property names.
     *
     * @private
     * @type Function
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns an array of property names.
     */
    var shimKeys = function(object) {
      var index, iterable = object, result = [];
      if (!iterable) return result;
      if (!(objectTypes[typeof object])) return result;
        for (index in iterable) {
          if (hasOwnProperty.call(iterable, index)) {
            result.push(index);
          }
        }
      return result
    };

    /**
     * Creates an array composed of the own enumerable property names of an object.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns an array of property names.
     * @example
     *
     * _.keys({ 'one': 1, 'two': 2, 'three': 3 });
     * // => ['one', 'two', 'three'] (property order is not guaranteed across environments)
     */
    var keys = !nativeKeys ? shimKeys : function(object) {
      if (!isObject(object)) {
        return [];
      }
      return nativeKeys(object);
    };

    /**
     * Used to convert characters to HTML entities:
     *
     * Though the `>` character is escaped for symmetry, characters like `>` and `/`
     * don't require escaping in HTML and have no special meaning unless they're part
     * of a tag or an unquoted attribute value.
     * http://mathiasbynens.be/notes/ambiguous-ampersands (under "semi-related fun fact")
     */
    var htmlEscapes = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;'
    };

    /** Used to convert HTML entities to characters */
    var htmlUnescapes = invert(htmlEscapes);

    /** Used to match HTML entities and HTML characters */
    var reEscapedHtml = RegExp('(' + keys(htmlUnescapes).join('|') + ')', 'g'),
        reUnescapedHtml = RegExp('[' + keys(htmlEscapes).join('') + ']', 'g');

    /*--------------------------------------------------------------------------*/

    /**
     * Assigns own enumerable properties of source object(s) to the destination
     * object. Subsequent sources will overwrite property assignments of previous
     * sources. If a callback is provided it will be executed to produce the
     * assigned values. The callback is bound to `thisArg` and invoked with two
     * arguments; (objectValue, sourceValue).
     *
     * @static
     * @memberOf _
     * @type Function
     * @alias extend
     * @category Objects
     * @param {Object} object The destination object.
     * @param {...Object} [source] The source objects.
     * @param {Function} [callback] The function to customize assigning values.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns the destination object.
     * @example
     *
     * _.assign({ 'name': 'fred' }, { 'employer': 'slate' });
     * // => { 'name': 'fred', 'employer': 'slate' }
     *
     * var defaults = _.partialRight(_.assign, function(a, b) {
     *   return typeof a == 'undefined' ? b : a;
     * });
     *
     * var object = { 'name': 'barney' };
     * defaults(object, { 'name': 'fred', 'employer': 'slate' });
     * // => { 'name': 'barney', 'employer': 'slate' }
     */
    var assign = function(object, source, guard) {
      var index, iterable = object, result = iterable;
      if (!iterable) return result;
      var args = arguments,
          argsIndex = 0,
          argsLength = typeof guard == 'number' ? 2 : args.length;
      if (argsLength > 3 && typeof args[argsLength - 2] == 'function') {
        var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);
      } else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {
        callback = args[--argsLength];
      }
      while (++argsIndex < argsLength) {
        iterable = args[argsIndex];
        if (iterable && objectTypes[typeof iterable]) {
        var ownIndex = -1,
            ownProps = objectTypes[typeof iterable] && keys(iterable),
            length = ownProps ? ownProps.length : 0;

        while (++ownIndex < length) {
          index = ownProps[ownIndex];
          result[index] = callback ? callback(result[index], iterable[index]) : iterable[index];
        }
        }
      }
      return result
    };

    /**
     * Creates a clone of `value`. If `isDeep` is `true` nested objects will also
     * be cloned, otherwise they will be assigned by reference. If a callback
     * is provided it will be executed to produce the cloned values. If the
     * callback returns `undefined` cloning will be handled by the method instead.
     * The callback is bound to `thisArg` and invoked with one argument; (value).
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to clone.
     * @param {boolean} [isDeep=false] Specify a deep clone.
     * @param {Function} [callback] The function to customize cloning values.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the cloned value.
     * @example
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36 },
     *   { 'name': 'fred',   'age': 40 }
     * ];
     *
     * var shallow = _.clone(characters);
     * shallow[0] === characters[0];
     * // => true
     *
     * var deep = _.clone(characters, true);
     * deep[0] === characters[0];
     * // => false
     *
     * _.mixin({
     *   'clone': _.partialRight(_.clone, function(value) {
     *     return _.isElement(value) ? value.cloneNode(false) : undefined;
     *   })
     * });
     *
     * var clone = _.clone(document.body);
     * clone.childNodes.length;
     * // => 0
     */
    function clone(value, isDeep, callback, thisArg) {
      // allows working with "Collections" methods without using their `index`
      // and `collection` arguments for `isDeep` and `callback`
      if (typeof isDeep != 'boolean' && isDeep != null) {
        thisArg = callback;
        callback = isDeep;
        isDeep = false;
      }
      return baseClone(value, isDeep, typeof callback == 'function' && baseCreateCallback(callback, thisArg, 1));
    }

    /**
     * Creates a deep clone of `value`. If a callback is provided it will be
     * executed to produce the cloned values. If the callback returns `undefined`
     * cloning will be handled by the method instead. The callback is bound to
     * `thisArg` and invoked with one argument; (value).
     *
     * Note: This method is loosely based on the structured clone algorithm. Functions
     * and DOM nodes are **not** cloned. The enumerable properties of `arguments` objects and
     * objects created by constructors other than `Object` are cloned to plain `Object` objects.
     * See http://www.w3.org/TR/html5/infrastructure.html#internal-structured-cloning-algorithm.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to deep clone.
     * @param {Function} [callback] The function to customize cloning values.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the deep cloned value.
     * @example
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36 },
     *   { 'name': 'fred',   'age': 40 }
     * ];
     *
     * var deep = _.cloneDeep(characters);
     * deep[0] === characters[0];
     * // => false
     *
     * var view = {
     *   'label': 'docs',
     *   'node': element
     * };
     *
     * var clone = _.cloneDeep(view, function(value) {
     *   return _.isElement(value) ? value.cloneNode(true) : undefined;
     * });
     *
     * clone.node == view.node;
     * // => false
     */
    function cloneDeep(value, callback, thisArg) {
      return baseClone(value, true, typeof callback == 'function' && baseCreateCallback(callback, thisArg, 1));
    }

    /**
     * Creates an object that inherits from the given `prototype` object. If a
     * `properties` object is provided its own enumerable properties are assigned
     * to the created object.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} prototype The object to inherit from.
     * @param {Object} [properties] The properties to assign to the object.
     * @returns {Object} Returns the new object.
     * @example
     *
     * function Shape() {
     *   this.x = 0;
     *   this.y = 0;
     * }
     *
     * function Circle() {
     *   Shape.call(this);
     * }
     *
     * Circle.prototype = _.create(Shape.prototype, { 'constructor': Circle });
     *
     * var circle = new Circle;
     * circle instanceof Circle;
     * // => true
     *
     * circle instanceof Shape;
     * // => true
     */
    function create(prototype, properties) {
      var result = baseCreate(prototype);
      return properties ? assign(result, properties) : result;
    }

    /**
     * Assigns own enumerable properties of source object(s) to the destination
     * object for all destination properties that resolve to `undefined`. Once a
     * property is set, additional defaults of the same property will be ignored.
     *
     * @static
     * @memberOf _
     * @type Function
     * @category Objects
     * @param {Object} object The destination object.
     * @param {...Object} [source] The source objects.
     * @param- {Object} [guard] Allows working with `_.reduce` without using its
     *  `key` and `object` arguments as sources.
     * @returns {Object} Returns the destination object.
     * @example
     *
     * var object = { 'name': 'barney' };
     * _.defaults(object, { 'name': 'fred', 'employer': 'slate' });
     * // => { 'name': 'barney', 'employer': 'slate' }
     */
    var defaults = function(object, source, guard) {
      var index, iterable = object, result = iterable;
      if (!iterable) return result;
      var args = arguments,
          argsIndex = 0,
          argsLength = typeof guard == 'number' ? 2 : args.length;
      while (++argsIndex < argsLength) {
        iterable = args[argsIndex];
        if (iterable && objectTypes[typeof iterable]) {
        var ownIndex = -1,
            ownProps = objectTypes[typeof iterable] && keys(iterable),
            length = ownProps ? ownProps.length : 0;

        while (++ownIndex < length) {
          index = ownProps[ownIndex];
          if (typeof result[index] == 'undefined') result[index] = iterable[index];
        }
        }
      }
      return result
    };

    /**
     * This method is like `_.findIndex` except that it returns the key of the
     * first element that passes the callback check, instead of the element itself.
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The object to search.
     * @param {Function|Object|string} [callback=identity] The function called per
     *  iteration. If a property name or object is provided it will be used to
     *  create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {string|undefined} Returns the key of the found element, else `undefined`.
     * @example
     *
     * var characters = {
     *   'barney': {  'age': 36, 'blocked': false },
     *   'fred': {    'age': 40, 'blocked': true },
     *   'pebbles': { 'age': 1,  'blocked': false }
     * };
     *
     * _.findKey(characters, function(chr) {
     *   return chr.age < 40;
     * });
     * // => 'barney' (property order is not guaranteed across environments)
     *
     * // using "_.where" callback shorthand
     * _.findKey(characters, { 'age': 1 });
     * // => 'pebbles'
     *
     * // using "_.pluck" callback shorthand
     * _.findKey(characters, 'blocked');
     * // => 'fred'
     */
    function findKey(object, callback, thisArg) {
      var result;
      callback = lodash.createCallback(callback, thisArg, 3);
      forOwn(object, function(value, key, object) {
        if (callback(value, key, object)) {
          result = key;
          return false;
        }
      });
      return result;
    }

    /**
     * This method is like `_.findKey` except that it iterates over elements
     * of a `collection` in the opposite order.
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The object to search.
     * @param {Function|Object|string} [callback=identity] The function called per
     *  iteration. If a property name or object is provided it will be used to
     *  create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {string|undefined} Returns the key of the found element, else `undefined`.
     * @example
     *
     * var characters = {
     *   'barney': {  'age': 36, 'blocked': true },
     *   'fred': {    'age': 40, 'blocked': false },
     *   'pebbles': { 'age': 1,  'blocked': true }
     * };
     *
     * _.findLastKey(characters, function(chr) {
     *   return chr.age < 40;
     * });
     * // => returns `pebbles`, assuming `_.findKey` returns `barney`
     *
     * // using "_.where" callback shorthand
     * _.findLastKey(characters, { 'age': 40 });
     * // => 'fred'
     *
     * // using "_.pluck" callback shorthand
     * _.findLastKey(characters, 'blocked');
     * // => 'pebbles'
     */
    function findLastKey(object, callback, thisArg) {
      var result;
      callback = lodash.createCallback(callback, thisArg, 3);
      forOwnRight(object, function(value, key, object) {
        if (callback(value, key, object)) {
          result = key;
          return false;
        }
      });
      return result;
    }

    /**
     * Iterates over own and inherited enumerable properties of an object,
     * executing the callback for each property. The callback is bound to `thisArg`
     * and invoked with three arguments; (value, key, object). Callbacks may exit
     * iteration early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @type Function
     * @category Objects
     * @param {Object} object The object to iterate over.
     * @param {Function} [callback=identity] The function called per iteration.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns `object`.
     * @example
     *
     * function Shape() {
     *   this.x = 0;
     *   this.y = 0;
     * }
     *
     * Shape.prototype.move = function(x, y) {
     *   this.x += x;
     *   this.y += y;
     * };
     *
     * _.forIn(new Shape, function(value, key) {
     *   console.log(key);
     * });
     * // => logs 'x', 'y', and 'move' (property order is not guaranteed across environments)
     */
    var forIn = function(collection, callback, thisArg) {
      var index, iterable = collection, result = iterable;
      if (!iterable) return result;
      if (!objectTypes[typeof iterable]) return result;
      callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3);
        for (index in iterable) {
          if (callback(iterable[index], index, collection) === false) return result;
        }
      return result
    };

    /**
     * This method is like `_.forIn` except that it iterates over elements
     * of a `collection` in the opposite order.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The object to iterate over.
     * @param {Function} [callback=identity] The function called per iteration.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns `object`.
     * @example
     *
     * function Shape() {
     *   this.x = 0;
     *   this.y = 0;
     * }
     *
     * Shape.prototype.move = function(x, y) {
     *   this.x += x;
     *   this.y += y;
     * };
     *
     * _.forInRight(new Shape, function(value, key) {
     *   console.log(key);
     * });
     * // => logs 'move', 'y', and 'x' assuming `_.forIn ` logs 'x', 'y', and 'move'
     */
    function forInRight(object, callback, thisArg) {
      var pairs = [];

      forIn(object, function(value, key) {
        pairs.push(key, value);
      });

      var length = pairs.length;
      callback = baseCreateCallback(callback, thisArg, 3);
      while (length--) {
        if (callback(pairs[length--], pairs[length], object) === false) {
          break;
        }
      }
      return object;
    }

    /**
     * Iterates over own enumerable properties of an object, executing the callback
     * for each property. The callback is bound to `thisArg` and invoked with three
     * arguments; (value, key, object). Callbacks may exit iteration early by
     * explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @type Function
     * @category Objects
     * @param {Object} object The object to iterate over.
     * @param {Function} [callback=identity] The function called per iteration.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns `object`.
     * @example
     *
     * _.forOwn({ '0': 'zero', '1': 'one', 'length': 2 }, function(num, key) {
     *   console.log(key);
     * });
     * // => logs '0', '1', and 'length' (property order is not guaranteed across environments)
     */
    var forOwn = function(collection, callback, thisArg) {
      var index, iterable = collection, result = iterable;
      if (!iterable) return result;
      if (!objectTypes[typeof iterable]) return result;
      callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3);
        var ownIndex = -1,
            ownProps = objectTypes[typeof iterable] && keys(iterable),
            length = ownProps ? ownProps.length : 0;

        while (++ownIndex < length) {
          index = ownProps[ownIndex];
          if (callback(iterable[index], index, collection) === false) return result;
        }
      return result
    };

    /**
     * This method is like `_.forOwn` except that it iterates over elements
     * of a `collection` in the opposite order.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The object to iterate over.
     * @param {Function} [callback=identity] The function called per iteration.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns `object`.
     * @example
     *
     * _.forOwnRight({ '0': 'zero', '1': 'one', 'length': 2 }, function(num, key) {
     *   console.log(key);
     * });
     * // => logs 'length', '1', and '0' assuming `_.forOwn` logs '0', '1', and 'length'
     */
    function forOwnRight(object, callback, thisArg) {
      var props = keys(object),
          length = props.length;

      callback = baseCreateCallback(callback, thisArg, 3);
      while (length--) {
        var key = props[length];
        if (callback(object[key], key, object) === false) {
          break;
        }
      }
      return object;
    }

    /**
     * Creates a sorted array of property names of all enumerable properties,
     * own and inherited, of `object` that have function values.
     *
     * @static
     * @memberOf _
     * @alias methods
     * @category Objects
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns an array of property names that have function values.
     * @example
     *
     * _.functions(_);
     * // => ['all', 'any', 'bind', 'bindAll', 'clone', 'compact', 'compose', ...]
     */
    function functions(object) {
      var result = [];
      forIn(object, function(value, key) {
        if (isFunction(value)) {
          result.push(key);
        }
      });
      return result.sort();
    }

    /**
     * Checks if the specified property name exists as a direct property of `object`,
     * instead of an inherited property.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The object to inspect.
     * @param {string} key The name of the property to check.
     * @returns {boolean} Returns `true` if key is a direct property, else `false`.
     * @example
     *
     * _.has({ 'a': 1, 'b': 2, 'c': 3 }, 'b');
     * // => true
     */
    function has(object, key) {
      return object ? hasOwnProperty.call(object, key) : false;
    }

    /**
     * Creates an object composed of the inverted keys and values of the given object.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The object to invert.
     * @returns {Object} Returns the created inverted object.
     * @example
     *
     * _.invert({ 'first': 'fred', 'second': 'barney' });
     * // => { 'fred': 'first', 'barney': 'second' }
     */
    function invert(object) {
      var index = -1,
          props = keys(object),
          length = props.length,
          result = {};

      while (++index < length) {
        var key = props[index];
        result[object[key]] = key;
      }
      return result;
    }

    /**
     * Checks if `value` is a boolean value.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is a boolean value, else `false`.
     * @example
     *
     * _.isBoolean(null);
     * // => false
     */
    function isBoolean(value) {
      return value === true || value === false ||
        value && typeof value == 'object' && toString.call(value) == boolClass || false;
    }

    /**
     * Checks if `value` is a date.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is a date, else `false`.
     * @example
     *
     * _.isDate(new Date);
     * // => true
     */
    function isDate(value) {
      return value && typeof value == 'object' && toString.call(value) == dateClass || false;
    }

    /**
     * Checks if `value` is a DOM element.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is a DOM element, else `false`.
     * @example
     *
     * _.isElement(document.body);
     * // => true
     */
    function isElement(value) {
      return value && value.nodeType === 1 || false;
    }

    /**
     * Checks if `value` is empty. Arrays, strings, or `arguments` objects with a
     * length of `0` and objects with no own enumerable properties are considered
     * "empty".
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Array|Object|string} value The value to inspect.
     * @returns {boolean} Returns `true` if the `value` is empty, else `false`.
     * @example
     *
     * _.isEmpty([1, 2, 3]);
     * // => false
     *
     * _.isEmpty({});
     * // => true
     *
     * _.isEmpty('');
     * // => true
     */
    function isEmpty(value) {
      var result = true;
      if (!value) {
        return result;
      }
      var className = toString.call(value),
          length = value.length;

      if ((className == arrayClass || className == stringClass || className == argsClass ) ||
          (className == objectClass && typeof length == 'number' && isFunction(value.splice))) {
        return !length;
      }
      forOwn(value, function() {
        return (result = false);
      });
      return result;
    }

    /**
     * Performs a deep comparison between two values to determine if they are
     * equivalent to each other. If a callback is provided it will be executed
     * to compare values. If the callback returns `undefined` comparisons will
     * be handled by the method instead. The callback is bound to `thisArg` and
     * invoked with two arguments; (a, b).
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} a The value to compare.
     * @param {*} b The other value to compare.
     * @param {Function} [callback] The function to customize comparing values.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     * @example
     *
     * var object = { 'name': 'fred' };
     * var copy = { 'name': 'fred' };
     *
     * object == copy;
     * // => false
     *
     * _.isEqual(object, copy);
     * // => true
     *
     * var words = ['hello', 'goodbye'];
     * var otherWords = ['hi', 'goodbye'];
     *
     * _.isEqual(words, otherWords, function(a, b) {
     *   var reGreet = /^(?:hello|hi)$/i,
     *       aGreet = _.isString(a) && reGreet.test(a),
     *       bGreet = _.isString(b) && reGreet.test(b);
     *
     *   return (aGreet || bGreet) ? (aGreet == bGreet) : undefined;
     * });
     * // => true
     */
    function isEqual(a, b, callback, thisArg) {
      return baseIsEqual(a, b, typeof callback == 'function' && baseCreateCallback(callback, thisArg, 2));
    }

    /**
     * Checks if `value` is, or can be coerced to, a finite number.
     *
     * Note: This is not the same as native `isFinite` which will return true for
     * booleans and empty strings. See http://es5.github.io/#x15.1.2.5.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is finite, else `false`.
     * @example
     *
     * _.isFinite(-101);
     * // => true
     *
     * _.isFinite('10');
     * // => true
     *
     * _.isFinite(true);
     * // => false
     *
     * _.isFinite('');
     * // => false
     *
     * _.isFinite(Infinity);
     * // => false
     */
    function isFinite(value) {
      return nativeIsFinite(value) && !nativeIsNaN(parseFloat(value));
    }

    /**
     * Checks if `value` is a function.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is a function, else `false`.
     * @example
     *
     * _.isFunction(_);
     * // => true
     */
    function isFunction(value) {
      return typeof value == 'function';
    }

    /**
     * Checks if `value` is the language type of Object.
     * (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is an object, else `false`.
     * @example
     *
     * _.isObject({});
     * // => true
     *
     * _.isObject([1, 2, 3]);
     * // => true
     *
     * _.isObject(1);
     * // => false
     */
    function isObject(value) {
      // check if the value is the ECMAScript language type of Object
      // http://es5.github.io/#x8
      // and avoid a V8 bug
      // http://code.google.com/p/v8/issues/detail?id=2291
      return !!(value && objectTypes[typeof value]);
    }

    /**
     * Checks if `value` is `NaN`.
     *
     * Note: This is not the same as native `isNaN` which will return `true` for
     * `undefined` and other non-numeric values. See http://es5.github.io/#x15.1.2.4.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is `NaN`, else `false`.
     * @example
     *
     * _.isNaN(NaN);
     * // => true
     *
     * _.isNaN(new Number(NaN));
     * // => true
     *
     * isNaN(undefined);
     * // => true
     *
     * _.isNaN(undefined);
     * // => false
     */
    function isNaN(value) {
      // `NaN` as a primitive is the only value that is not equal to itself
      // (perform the [[Class]] check first to avoid errors with some host objects in IE)
      return isNumber(value) && value != +value;
    }

    /**
     * Checks if `value` is `null`.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is `null`, else `false`.
     * @example
     *
     * _.isNull(null);
     * // => true
     *
     * _.isNull(undefined);
     * // => false
     */
    function isNull(value) {
      return value === null;
    }

    /**
     * Checks if `value` is a number.
     *
     * Note: `NaN` is considered a number. See http://es5.github.io/#x8.5.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is a number, else `false`.
     * @example
     *
     * _.isNumber(8.4 * 5);
     * // => true
     */
    function isNumber(value) {
      return typeof value == 'number' ||
        value && typeof value == 'object' && toString.call(value) == numberClass || false;
    }

    /**
     * Checks if `value` is an object created by the `Object` constructor.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.
     * @example
     *
     * function Shape() {
     *   this.x = 0;
     *   this.y = 0;
     * }
     *
     * _.isPlainObject(new Shape);
     * // => false
     *
     * _.isPlainObject([1, 2, 3]);
     * // => false
     *
     * _.isPlainObject({ 'x': 0, 'y': 0 });
     * // => true
     */
    var isPlainObject = !getPrototypeOf ? shimIsPlainObject : function(value) {
      if (!(value && toString.call(value) == objectClass)) {
        return false;
      }
      var valueOf = value.valueOf,
          objProto = isNative(valueOf) && (objProto = getPrototypeOf(valueOf)) && getPrototypeOf(objProto);

      return objProto
        ? (value == objProto || getPrototypeOf(value) == objProto)
        : shimIsPlainObject(value);
    };

    /**
     * Checks if `value` is a regular expression.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is a regular expression, else `false`.
     * @example
     *
     * _.isRegExp(/fred/);
     * // => true
     */
    function isRegExp(value) {
      return value && typeof value == 'object' && toString.call(value) == regexpClass || false;
    }

    /**
     * Checks if `value` is a string.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is a string, else `false`.
     * @example
     *
     * _.isString('fred');
     * // => true
     */
    function isString(value) {
      return typeof value == 'string' ||
        value && typeof value == 'object' && toString.call(value) == stringClass || false;
    }

    /**
     * Checks if `value` is `undefined`.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if the `value` is `undefined`, else `false`.
     * @example
     *
     * _.isUndefined(void 0);
     * // => true
     */
    function isUndefined(value) {
      return typeof value == 'undefined';
    }

    /**
     * Creates an object with the same keys as `object` and values generated by
     * running each own enumerable property of `object` through the callback.
     * The callback is bound to `thisArg` and invoked with three arguments;
     * (value, key, object).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The object to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns a new object with values of the results of each `callback` execution.
     * @example
     *
     * _.mapValues({ 'a': 1, 'b': 2, 'c': 3} , function(num) { return num * 3; });
     * // => { 'a': 3, 'b': 6, 'c': 9 }
     *
     * var characters = {
     *   'fred': { 'name': 'fred', 'age': 40 },
     *   'pebbles': { 'name': 'pebbles', 'age': 1 }
     * };
     *
     * // using "_.pluck" callback shorthand
     * _.mapValues(characters, 'age');
     * // => { 'fred': 40, 'pebbles': 1 }
     */
    function mapValues(object, callback, thisArg) {
      var result = {};
      callback = lodash.createCallback(callback, thisArg, 3);

      forOwn(object, function(value, key, object) {
        result[key] = callback(value, key, object);
      });
      return result;
    }

    /**
     * Recursively merges own enumerable properties of the source object(s), that
     * don't resolve to `undefined` into the destination object. Subsequent sources
     * will overwrite property assignments of previous sources. If a callback is
     * provided it will be executed to produce the merged values of the destination
     * and source properties. If the callback returns `undefined` merging will
     * be handled by the method instead. The callback is bound to `thisArg` and
     * invoked with two arguments; (objectValue, sourceValue).
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The destination object.
     * @param {...Object} [source] The source objects.
     * @param {Function} [callback] The function to customize merging properties.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns the destination object.
     * @example
     *
     * var names = {
     *   'characters': [
     *     { 'name': 'barney' },
     *     { 'name': 'fred' }
     *   ]
     * };
     *
     * var ages = {
     *   'characters': [
     *     { 'age': 36 },
     *     { 'age': 40 }
     *   ]
     * };
     *
     * _.merge(names, ages);
     * // => { 'characters': [{ 'name': 'barney', 'age': 36 }, { 'name': 'fred', 'age': 40 }] }
     *
     * var food = {
     *   'fruits': ['apple'],
     *   'vegetables': ['beet']
     * };
     *
     * var otherFood = {
     *   'fruits': ['banana'],
     *   'vegetables': ['carrot']
     * };
     *
     * _.merge(food, otherFood, function(a, b) {
     *   return _.isArray(a) ? a.concat(b) : undefined;
     * });
     * // => { 'fruits': ['apple', 'banana'], 'vegetables': ['beet', 'carrot] }
     */
    function merge(object) {
      var args = arguments,
          length = 2;

      if (!isObject(object)) {
        return object;
      }
      // allows working with `_.reduce` and `_.reduceRight` without using
      // their `index` and `collection` arguments
      if (typeof args[2] != 'number') {
        length = args.length;
      }
      if (length > 3 && typeof args[length - 2] == 'function') {
        var callback = baseCreateCallback(args[--length - 1], args[length--], 2);
      } else if (length > 2 && typeof args[length - 1] == 'function') {
        callback = args[--length];
      }
      var sources = slice(arguments, 1, length),
          index = -1,
          stackA = getArray(),
          stackB = getArray();

      while (++index < length) {
        baseMerge(object, sources[index], callback, stackA, stackB);
      }
      releaseArray(stackA);
      releaseArray(stackB);
      return object;
    }

    /**
     * Creates a shallow clone of `object` excluding the specified properties.
     * Property names may be specified as individual arguments or as arrays of
     * property names. If a callback is provided it will be executed for each
     * property of `object` omitting the properties the callback returns truey
     * for. The callback is bound to `thisArg` and invoked with three arguments;
     * (value, key, object).
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The source object.
     * @param {Function|...string|string[]} [callback] The properties to omit or the
     *  function called per iteration.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns an object without the omitted properties.
     * @example
     *
     * _.omit({ 'name': 'fred', 'age': 40 }, 'age');
     * // => { 'name': 'fred' }
     *
     * _.omit({ 'name': 'fred', 'age': 40 }, function(value) {
     *   return typeof value == 'number';
     * });
     * // => { 'name': 'fred' }
     */
    function omit(object, callback, thisArg) {
      var result = {};
      if (typeof callback != 'function') {
        var props = [];
        forIn(object, function(value, key) {
          props.push(key);
        });
        props = baseDifference(props, baseFlatten(arguments, true, false, 1));

        var index = -1,
            length = props.length;

        while (++index < length) {
          var key = props[index];
          result[key] = object[key];
        }
      } else {
        callback = lodash.createCallback(callback, thisArg, 3);
        forIn(object, function(value, key, object) {
          if (!callback(value, key, object)) {
            result[key] = value;
          }
        });
      }
      return result;
    }

    /**
     * Creates a two dimensional array of an object's key-value pairs,
     * i.e. `[[key1, value1], [key2, value2]]`.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns new array of key-value pairs.
     * @example
     *
     * _.pairs({ 'barney': 36, 'fred': 40 });
     * // => [['barney', 36], ['fred', 40]] (property order is not guaranteed across environments)
     */
    function pairs(object) {
      var index = -1,
          props = keys(object),
          length = props.length,
          result = Array(length);

      while (++index < length) {
        var key = props[index];
        result[index] = [key, object[key]];
      }
      return result;
    }

    /**
     * Creates a shallow clone of `object` composed of the specified properties.
     * Property names may be specified as individual arguments or as arrays of
     * property names. If a callback is provided it will be executed for each
     * property of `object` picking the properties the callback returns truey
     * for. The callback is bound to `thisArg` and invoked with three arguments;
     * (value, key, object).
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The source object.
     * @param {Function|...string|string[]} [callback] The function called per
     *  iteration or property names to pick, specified as individual property
     *  names or arrays of property names.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns an object composed of the picked properties.
     * @example
     *
     * _.pick({ 'name': 'fred', '_userid': 'fred1' }, 'name');
     * // => { 'name': 'fred' }
     *
     * _.pick({ 'name': 'fred', '_userid': 'fred1' }, function(value, key) {
     *   return key.charAt(0) != '_';
     * });
     * // => { 'name': 'fred' }
     */
    function pick(object, callback, thisArg) {
      var result = {};
      if (typeof callback != 'function') {
        var index = -1,
            props = baseFlatten(arguments, true, false, 1),
            length = isObject(object) ? props.length : 0;

        while (++index < length) {
          var key = props[index];
          if (key in object) {
            result[key] = object[key];
          }
        }
      } else {
        callback = lodash.createCallback(callback, thisArg, 3);
        forIn(object, function(value, key, object) {
          if (callback(value, key, object)) {
            result[key] = value;
          }
        });
      }
      return result;
    }

    /**
     * An alternative to `_.reduce` this method transforms `object` to a new
     * `accumulator` object which is the result of running each of its own
     * enumerable properties through a callback, with each callback execution
     * potentially mutating the `accumulator` object. The callback is bound to
     * `thisArg` and invoked with four arguments; (accumulator, value, key, object).
     * Callbacks may exit iteration early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Array|Object} object The object to iterate over.
     * @param {Function} [callback=identity] The function called per iteration.
     * @param {*} [accumulator] The custom accumulator value.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the accumulated value.
     * @example
     *
     * var squares = _.transform([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], function(result, num) {
     *   num *= num;
     *   if (num % 2) {
     *     return result.push(num) < 3;
     *   }
     * });
     * // => [1, 9, 25]
     *
     * var mapped = _.transform({ 'a': 1, 'b': 2, 'c': 3 }, function(result, num, key) {
     *   result[key] = num * 3;
     * });
     * // => { 'a': 3, 'b': 6, 'c': 9 }
     */
    function transform(object, callback, accumulator, thisArg) {
      var isArr = isArray(object);
      if (accumulator == null) {
        if (isArr) {
          accumulator = [];
        } else {
          var ctor = object && object.constructor,
              proto = ctor && ctor.prototype;

          accumulator = baseCreate(proto);
        }
      }
      if (callback) {
        callback = lodash.createCallback(callback, thisArg, 4);
        (isArr ? forEach : forOwn)(object, function(value, index, object) {
          return callback(accumulator, value, index, object);
        });
      }
      return accumulator;
    }

    /**
     * Creates an array composed of the own enumerable property values of `object`.
     *
     * @static
     * @memberOf _
     * @category Objects
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns an array of property values.
     * @example
     *
     * _.values({ 'one': 1, 'two': 2, 'three': 3 });
     * // => [1, 2, 3] (property order is not guaranteed across environments)
     */
    function values(object) {
      var index = -1,
          props = keys(object),
          length = props.length,
          result = Array(length);

      while (++index < length) {
        result[index] = object[props[index]];
      }
      return result;
    }

    /*--------------------------------------------------------------------------*/

    /**
     * Creates an array of elements from the specified indexes, or keys, of the
     * `collection`. Indexes may be specified as individual arguments or as arrays
     * of indexes.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {...(number|number[]|string|string[])} [index] The indexes of `collection`
     *   to retrieve, specified as individual indexes or arrays of indexes.
     * @returns {Array} Returns a new array of elements corresponding to the
     *  provided indexes.
     * @example
     *
     * _.at(['a', 'b', 'c', 'd', 'e'], [0, 2, 4]);
     * // => ['a', 'c', 'e']
     *
     * _.at(['fred', 'barney', 'pebbles'], 0, 2);
     * // => ['fred', 'pebbles']
     */
    function at(collection) {
      var args = arguments,
          index = -1,
          props = baseFlatten(args, true, false, 1),
          length = (args[2] && args[2][args[1]] === collection) ? 1 : props.length,
          result = Array(length);

      while(++index < length) {
        result[index] = collection[props[index]];
      }
      return result;
    }

    /**
     * Checks if a given value is present in a collection using strict equality
     * for comparisons, i.e. `===`. If `fromIndex` is negative, it is used as the
     * offset from the end of the collection.
     *
     * @static
     * @memberOf _
     * @alias include
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {*} target The value to check for.
     * @param {number} [fromIndex=0] The index to search from.
     * @returns {boolean} Returns `true` if the `target` element is found, else `false`.
     * @example
     *
     * _.contains([1, 2, 3], 1);
     * // => true
     *
     * _.contains([1, 2, 3], 1, 2);
     * // => false
     *
     * _.contains({ 'name': 'fred', 'age': 40 }, 'fred');
     * // => true
     *
     * _.contains('pebbles', 'eb');
     * // => true
     */
    function contains(collection, target, fromIndex) {
      var index = -1,
          indexOf = getIndexOf(),
          length = collection ? collection.length : 0,
          result = false;

      fromIndex = (fromIndex < 0 ? nativeMax(0, length + fromIndex) : fromIndex) || 0;
      if (isArray(collection)) {
        result = indexOf(collection, target, fromIndex) > -1;
      } else if (typeof length == 'number') {
        result = (isString(collection) ? collection.indexOf(target, fromIndex) : indexOf(collection, target, fromIndex)) > -1;
      } else {
        forOwn(collection, function(value) {
          if (++index >= fromIndex) {
            return !(result = value === target);
          }
        });
      }
      return result;
    }

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of `collection` through the callback. The corresponding value
     * of each key is the number of times the key was returned by the callback.
     * The callback is bound to `thisArg` and invoked with three arguments;
     * (value, index|key, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * _.countBy([4.3, 6.1, 6.4], function(num) { return Math.floor(num); });
     * // => { '4': 1, '6': 2 }
     *
     * _.countBy([4.3, 6.1, 6.4], function(num) { return this.floor(num); }, Math);
     * // => { '4': 1, '6': 2 }
     *
     * _.countBy(['one', 'two', 'three'], 'length');
     * // => { '3': 2, '5': 1 }
     */
    var countBy = createAggregator(function(result, value, key) {
      (hasOwnProperty.call(result, key) ? result[key]++ : result[key] = 1);
    });

    /**
     * Checks if the given callback returns truey value for **all** elements of
     * a collection. The callback is bound to `thisArg` and invoked with three
     * arguments; (value, index|key, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @alias all
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {boolean} Returns `true` if all elements passed the callback check,
     *  else `false`.
     * @example
     *
     * _.every([true, 1, null, 'yes']);
     * // => false
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36 },
     *   { 'name': 'fred',   'age': 40 }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.every(characters, 'age');
     * // => true
     *
     * // using "_.where" callback shorthand
     * _.every(characters, { 'age': 36 });
     * // => false
     */
    function every(collection, callback, thisArg) {
      var result = true;
      callback = lodash.createCallback(callback, thisArg, 3);

      var index = -1,
          length = collection ? collection.length : 0;

      if (typeof length == 'number') {
        while (++index < length) {
          if (!(result = !!callback(collection[index], index, collection))) {
            break;
          }
        }
      } else {
        forOwn(collection, function(value, index, collection) {
          return (result = !!callback(value, index, collection));
        });
      }
      return result;
    }

    /**
     * Iterates over elements of a collection, returning an array of all elements
     * the callback returns truey for. The callback is bound to `thisArg` and
     * invoked with three arguments; (value, index|key, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @alias select
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns a new array of elements that passed the callback check.
     * @example
     *
     * var evens = _.filter([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });
     * // => [2, 4, 6]
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36, 'blocked': false },
     *   { 'name': 'fred',   'age': 40, 'blocked': true }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.filter(characters, 'blocked');
     * // => [{ 'name': 'fred', 'age': 40, 'blocked': true }]
     *
     * // using "_.where" callback shorthand
     * _.filter(characters, { 'age': 36 });
     * // => [{ 'name': 'barney', 'age': 36, 'blocked': false }]
     */
    function filter(collection, callback, thisArg) {
      var result = [];
      callback = lodash.createCallback(callback, thisArg, 3);

      var index = -1,
          length = collection ? collection.length : 0;

      if (typeof length == 'number') {
        while (++index < length) {
          var value = collection[index];
          if (callback(value, index, collection)) {
            result.push(value);
          }
        }
      } else {
        forOwn(collection, function(value, index, collection) {
          if (callback(value, index, collection)) {
            result.push(value);
          }
        });
      }
      return result;
    }

    /**
     * Iterates over elements of a collection, returning the first element that
     * the callback returns truey for. The callback is bound to `thisArg` and
     * invoked with three arguments; (value, index|key, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @alias detect, findWhere
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the found element, else `undefined`.
     * @example
     *
     * var characters = [
     *   { 'name': 'barney',  'age': 36, 'blocked': false },
     *   { 'name': 'fred',    'age': 40, 'blocked': true },
     *   { 'name': 'pebbles', 'age': 1,  'blocked': false }
     * ];
     *
     * _.find(characters, function(chr) {
     *   return chr.age < 40;
     * });
     * // => { 'name': 'barney', 'age': 36, 'blocked': false }
     *
     * // using "_.where" callback shorthand
     * _.find(characters, { 'age': 1 });
     * // =>  { 'name': 'pebbles', 'age': 1, 'blocked': false }
     *
     * // using "_.pluck" callback shorthand
     * _.find(characters, 'blocked');
     * // => { 'name': 'fred', 'age': 40, 'blocked': true }
     */
    function find(collection, callback, thisArg) {
      callback = lodash.createCallback(callback, thisArg, 3);

      var index = -1,
          length = collection ? collection.length : 0;

      if (typeof length == 'number') {
        while (++index < length) {
          var value = collection[index];
          if (callback(value, index, collection)) {
            return value;
          }
        }
      } else {
        var result;
        forOwn(collection, function(value, index, collection) {
          if (callback(value, index, collection)) {
            result = value;
            return false;
          }
        });
        return result;
      }
    }

    /**
     * This method is like `_.find` except that it iterates over elements
     * of a `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the found element, else `undefined`.
     * @example
     *
     * _.findLast([1, 2, 3, 4], function(num) {
     *   return num % 2 == 1;
     * });
     * // => 3
     */
    function findLast(collection, callback, thisArg) {
      var result;
      callback = lodash.createCallback(callback, thisArg, 3);
      forEachRight(collection, function(value, index, collection) {
        if (callback(value, index, collection)) {
          result = value;
          return false;
        }
      });
      return result;
    }

    /**
     * Iterates over elements of a collection, executing the callback for each
     * element. The callback is bound to `thisArg` and invoked with three arguments;
     * (value, index|key, collection). Callbacks may exit iteration early by
     * explicitly returning `false`.
     *
     * Note: As with other "Collections" methods, objects with a `length` property
     * are iterated like arrays. To avoid this behavior `_.forIn` or `_.forOwn`
     * may be used for object iteration.
     *
     * @static
     * @memberOf _
     * @alias each
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} [callback=identity] The function called per iteration.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array|Object|string} Returns `collection`.
     * @example
     *
     * _([1, 2, 3]).forEach(function(num) { console.log(num); }).join(',');
     * // => logs each number and returns '1,2,3'
     *
     * _.forEach({ 'one': 1, 'two': 2, 'three': 3 }, function(num) { console.log(num); });
     * // => logs each number and returns the object (property order is not guaranteed across environments)
     */
    function forEach(collection, callback, thisArg) {
      var index = -1,
          length = collection ? collection.length : 0;

      callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3);
      if (typeof length == 'number') {
        while (++index < length) {
          if (callback(collection[index], index, collection) === false) {
            break;
          }
        }
      } else {
        forOwn(collection, callback);
      }
      return collection;
    }

    /**
     * This method is like `_.forEach` except that it iterates over elements
     * of a `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @alias eachRight
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} [callback=identity] The function called per iteration.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array|Object|string} Returns `collection`.
     * @example
     *
     * _([1, 2, 3]).forEachRight(function(num) { console.log(num); }).join(',');
     * // => logs each number from right to left and returns '3,2,1'
     */
    function forEachRight(collection, callback, thisArg) {
      var length = collection ? collection.length : 0;
      callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3);
      if (typeof length == 'number') {
        while (length--) {
          if (callback(collection[length], length, collection) === false) {
            break;
          }
        }
      } else {
        var props = keys(collection);
        length = props.length;
        forOwn(collection, function(value, key, collection) {
          key = props ? props[--length] : --length;
          return callback(collection[key], key, collection);
        });
      }
      return collection;
    }

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of a collection through the callback. The corresponding value
     * of each key is an array of the elements responsible for generating the key.
     * The callback is bound to `thisArg` and invoked with three arguments;
     * (value, index|key, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * _.groupBy([4.2, 6.1, 6.4], function(num) { return Math.floor(num); });
     * // => { '4': [4.2], '6': [6.1, 6.4] }
     *
     * _.groupBy([4.2, 6.1, 6.4], function(num) { return this.floor(num); }, Math);
     * // => { '4': [4.2], '6': [6.1, 6.4] }
     *
     * // using "_.pluck" callback shorthand
     * _.groupBy(['one', 'two', 'three'], 'length');
     * // => { '3': ['one', 'two'], '5': ['three'] }
     */
    var groupBy = createAggregator(function(result, value, key) {
      (hasOwnProperty.call(result, key) ? result[key] : result[key] = []).push(value);
    });

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of the collection through the given callback. The corresponding
     * value of each key is the last element responsible for generating the key.
     * The callback is bound to `thisArg` and invoked with three arguments;
     * (value, index|key, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * var keys = [
     *   { 'dir': 'left', 'code': 97 },
     *   { 'dir': 'right', 'code': 100 }
     * ];
     *
     * _.indexBy(keys, 'dir');
     * // => { 'left': { 'dir': 'left', 'code': 97 }, 'right': { 'dir': 'right', 'code': 100 } }
     *
     * _.indexBy(keys, function(key) { return String.fromCharCode(key.code); });
     * // => { 'a': { 'dir': 'left', 'code': 97 }, 'd': { 'dir': 'right', 'code': 100 } }
     *
     * _.indexBy(characters, function(key) { this.fromCharCode(key.code); }, String);
     * // => { 'a': { 'dir': 'left', 'code': 97 }, 'd': { 'dir': 'right', 'code': 100 } }
     */
    var indexBy = createAggregator(function(result, value, key) {
      result[key] = value;
    });

    /**
     * Invokes the method named by `methodName` on each element in the `collection`
     * returning an array of the results of each invoked method. Additional arguments
     * will be provided to each invoked method. If `methodName` is a function it
     * will be invoked for, and `this` bound to, each element in the `collection`.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|string} methodName The name of the method to invoke or
     *  the function invoked per iteration.
     * @param {...*} [arg] Arguments to invoke the method with.
     * @returns {Array} Returns a new array of the results of each invoked method.
     * @example
     *
     * _.invoke([[5, 1, 7], [3, 2, 1]], 'sort');
     * // => [[1, 5, 7], [1, 2, 3]]
     *
     * _.invoke([123, 456], String.prototype.split, '');
     * // => [['1', '2', '3'], ['4', '5', '6']]
     */
    function invoke(collection, methodName) {
      var args = slice(arguments, 2),
          index = -1,
          isFunc = typeof methodName == 'function',
          length = collection ? collection.length : 0,
          result = Array(typeof length == 'number' ? length : 0);

      forEach(collection, function(value) {
        result[++index] = (isFunc ? methodName : value[methodName]).apply(value, args);
      });
      return result;
    }

    /**
     * Creates an array of values by running each element in the collection
     * through the callback. The callback is bound to `thisArg` and invoked with
     * three arguments; (value, index|key, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @alias collect
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns a new array of the results of each `callback` execution.
     * @example
     *
     * _.map([1, 2, 3], function(num) { return num * 3; });
     * // => [3, 6, 9]
     *
     * _.map({ 'one': 1, 'two': 2, 'three': 3 }, function(num) { return num * 3; });
     * // => [3, 6, 9] (property order is not guaranteed across environments)
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36 },
     *   { 'name': 'fred',   'age': 40 }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.map(characters, 'name');
     * // => ['barney', 'fred']
     */
    function map(collection, callback, thisArg) {
      var index = -1,
          length = collection ? collection.length : 0;

      callback = lodash.createCallback(callback, thisArg, 3);
      if (typeof length == 'number') {
        var result = Array(length);
        while (++index < length) {
          result[index] = callback(collection[index], index, collection);
        }
      } else {
        result = [];
        forOwn(collection, function(value, key, collection) {
          result[++index] = callback(value, key, collection);
        });
      }
      return result;
    }

    /**
     * Retrieves the maximum value of a collection. If the collection is empty or
     * falsey `-Infinity` is returned. If a callback is provided it will be executed
     * for each value in the collection to generate the criterion by which the value
     * is ranked. The callback is bound to `thisArg` and invoked with three
     * arguments; (value, index, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the maximum value.
     * @example
     *
     * _.max([4, 2, 8, 6]);
     * // => 8
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36 },
     *   { 'name': 'fred',   'age': 40 }
     * ];
     *
     * _.max(characters, function(chr) { return chr.age; });
     * // => { 'name': 'fred', 'age': 40 };
     *
     * // using "_.pluck" callback shorthand
     * _.max(characters, 'age');
     * // => { 'name': 'fred', 'age': 40 };
     */
    function max(collection, callback, thisArg) {
      var computed = -Infinity,
          result = computed;

      // allows working with functions like `_.map` without using
      // their `index` argument as a callback
      if (typeof callback != 'function' && thisArg && thisArg[callback] === collection) {
        callback = null;
      }
      if (callback == null && isArray(collection)) {
        var index = -1,
            length = collection.length;

        while (++index < length) {
          var value = collection[index];
          if (value > result) {
            result = value;
          }
        }
      } else {
        callback = (callback == null && isString(collection))
          ? charAtCallback
          : lodash.createCallback(callback, thisArg, 3);

        forEach(collection, function(value, index, collection) {
          var current = callback(value, index, collection);
          if (current > computed) {
            computed = current;
            result = value;
          }
        });
      }
      return result;
    }

    /**
     * Retrieves the minimum value of a collection. If the collection is empty or
     * falsey `Infinity` is returned. If a callback is provided it will be executed
     * for each value in the collection to generate the criterion by which the value
     * is ranked. The callback is bound to `thisArg` and invoked with three
     * arguments; (value, index, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the minimum value.
     * @example
     *
     * _.min([4, 2, 8, 6]);
     * // => 2
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36 },
     *   { 'name': 'fred',   'age': 40 }
     * ];
     *
     * _.min(characters, function(chr) { return chr.age; });
     * // => { 'name': 'barney', 'age': 36 };
     *
     * // using "_.pluck" callback shorthand
     * _.min(characters, 'age');
     * // => { 'name': 'barney', 'age': 36 };
     */
    function min(collection, callback, thisArg) {
      var computed = Infinity,
          result = computed;

      // allows working with functions like `_.map` without using
      // their `index` argument as a callback
      if (typeof callback != 'function' && thisArg && thisArg[callback] === collection) {
        callback = null;
      }
      if (callback == null && isArray(collection)) {
        var index = -1,
            length = collection.length;

        while (++index < length) {
          var value = collection[index];
          if (value < result) {
            result = value;
          }
        }
      } else {
        callback = (callback == null && isString(collection))
          ? charAtCallback
          : lodash.createCallback(callback, thisArg, 3);

        forEach(collection, function(value, index, collection) {
          var current = callback(value, index, collection);
          if (current < computed) {
            computed = current;
            result = value;
          }
        });
      }
      return result;
    }

    /**
     * Retrieves the value of a specified property from all elements in the collection.
     *
     * @static
     * @memberOf _
     * @type Function
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {string} property The name of the property to pluck.
     * @returns {Array} Returns a new array of property values.
     * @example
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36 },
     *   { 'name': 'fred',   'age': 40 }
     * ];
     *
     * _.pluck(characters, 'name');
     * // => ['barney', 'fred']
     */
    var pluck = map;

    /**
     * Reduces a collection to a value which is the accumulated result of running
     * each element in the collection through the callback, where each successive
     * callback execution consumes the return value of the previous execution. If
     * `accumulator` is not provided the first element of the collection will be
     * used as the initial `accumulator` value. The callback is bound to `thisArg`
     * and invoked with four arguments; (accumulator, value, index|key, collection).
     *
     * @static
     * @memberOf _
     * @alias foldl, inject
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} [callback=identity] The function called per iteration.
     * @param {*} [accumulator] Initial value of the accumulator.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the accumulated value.
     * @example
     *
     * var sum = _.reduce([1, 2, 3], function(sum, num) {
     *   return sum + num;
     * });
     * // => 6
     *
     * var mapped = _.reduce({ 'a': 1, 'b': 2, 'c': 3 }, function(result, num, key) {
     *   result[key] = num * 3;
     *   return result;
     * }, {});
     * // => { 'a': 3, 'b': 6, 'c': 9 }
     */
    function reduce(collection, callback, accumulator, thisArg) {
      if (!collection) return accumulator;
      var noaccum = arguments.length < 3;
      callback = lodash.createCallback(callback, thisArg, 4);

      var index = -1,
          length = collection.length;

      if (typeof length == 'number') {
        if (noaccum) {
          accumulator = collection[++index];
        }
        while (++index < length) {
          accumulator = callback(accumulator, collection[index], index, collection);
        }
      } else {
        forOwn(collection, function(value, index, collection) {
          accumulator = noaccum
            ? (noaccum = false, value)
            : callback(accumulator, value, index, collection)
        });
      }
      return accumulator;
    }

    /**
     * This method is like `_.reduce` except that it iterates over elements
     * of a `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @alias foldr
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function} [callback=identity] The function called per iteration.
     * @param {*} [accumulator] Initial value of the accumulator.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the accumulated value.
     * @example
     *
     * var list = [[0, 1], [2, 3], [4, 5]];
     * var flat = _.reduceRight(list, function(a, b) { return a.concat(b); }, []);
     * // => [4, 5, 2, 3, 0, 1]
     */
    function reduceRight(collection, callback, accumulator, thisArg) {
      var noaccum = arguments.length < 3;
      callback = lodash.createCallback(callback, thisArg, 4);
      forEachRight(collection, function(value, index, collection) {
        accumulator = noaccum
          ? (noaccum = false, value)
          : callback(accumulator, value, index, collection);
      });
      return accumulator;
    }

    /**
     * The opposite of `_.filter` this method returns the elements of a
     * collection that the callback does **not** return truey for.
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns a new array of elements that failed the callback check.
     * @example
     *
     * var odds = _.reject([1, 2, 3, 4, 5, 6], function(num) { return num % 2 == 0; });
     * // => [1, 3, 5]
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36, 'blocked': false },
     *   { 'name': 'fred',   'age': 40, 'blocked': true }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.reject(characters, 'blocked');
     * // => [{ 'name': 'barney', 'age': 36, 'blocked': false }]
     *
     * // using "_.where" callback shorthand
     * _.reject(characters, { 'age': 36 });
     * // => [{ 'name': 'fred', 'age': 40, 'blocked': true }]
     */
    function reject(collection, callback, thisArg) {
      callback = lodash.createCallback(callback, thisArg, 3);
      return filter(collection, function(value, index, collection) {
        return !callback(value, index, collection);
      });
    }

    /**
     * Retrieves a random element or `n` random elements from a collection.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to sample.
     * @param {number} [n] The number of elements to sample.
     * @param- {Object} [guard] Allows working with functions like `_.map`
     *  without using their `index` arguments as `n`.
     * @returns {Array} Returns the random sample(s) of `collection`.
     * @example
     *
     * _.sample([1, 2, 3, 4]);
     * // => 2
     *
     * _.sample([1, 2, 3, 4], 2);
     * // => [3, 1]
     */
    function sample(collection, n, guard) {
      if (collection && typeof collection.length != 'number') {
        collection = values(collection);
      }
      if (n == null || guard) {
        return collection ? collection[baseRandom(0, collection.length - 1)] : undefined;
      }
      var result = shuffle(collection);
      result.length = nativeMin(nativeMax(0, n), result.length);
      return result;
    }

    /**
     * Creates an array of shuffled values, using a version of the Fisher-Yates
     * shuffle. See http://en.wikipedia.org/wiki/Fisher-Yates_shuffle.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to shuffle.
     * @returns {Array} Returns a new shuffled collection.
     * @example
     *
     * _.shuffle([1, 2, 3, 4, 5, 6]);
     * // => [4, 1, 6, 3, 5, 2]
     */
    function shuffle(collection) {
      var index = -1,
          length = collection ? collection.length : 0,
          result = Array(typeof length == 'number' ? length : 0);

      forEach(collection, function(value) {
        var rand = baseRandom(0, ++index);
        result[index] = result[rand];
        result[rand] = value;
      });
      return result;
    }

    /**
     * Gets the size of the `collection` by returning `collection.length` for arrays
     * and array-like objects or the number of own enumerable properties for objects.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to inspect.
     * @returns {number} Returns `collection.length` or number of own enumerable properties.
     * @example
     *
     * _.size([1, 2]);
     * // => 2
     *
     * _.size({ 'one': 1, 'two': 2, 'three': 3 });
     * // => 3
     *
     * _.size('pebbles');
     * // => 7
     */
    function size(collection) {
      var length = collection ? collection.length : 0;
      return typeof length == 'number' ? length : keys(collection).length;
    }

    /**
     * Checks if the callback returns a truey value for **any** element of a
     * collection. The function returns as soon as it finds a passing value and
     * does not iterate over the entire collection. The callback is bound to
     * `thisArg` and invoked with three arguments; (value, index|key, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @alias any
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {boolean} Returns `true` if any element passed the callback check,
     *  else `false`.
     * @example
     *
     * _.some([null, 0, 'yes', false], Boolean);
     * // => true
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36, 'blocked': false },
     *   { 'name': 'fred',   'age': 40, 'blocked': true }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.some(characters, 'blocked');
     * // => true
     *
     * // using "_.where" callback shorthand
     * _.some(characters, { 'age': 1 });
     * // => false
     */
    function some(collection, callback, thisArg) {
      var result;
      callback = lodash.createCallback(callback, thisArg, 3);

      var index = -1,
          length = collection ? collection.length : 0;

      if (typeof length == 'number') {
        while (++index < length) {
          if ((result = callback(collection[index], index, collection))) {
            break;
          }
        }
      } else {
        forOwn(collection, function(value, index, collection) {
          return !(result = callback(value, index, collection));
        });
      }
      return !!result;
    }

    /**
     * Creates an array of elements, sorted in ascending order by the results of
     * running each element in a collection through the callback. This method
     * performs a stable sort, that is, it will preserve the original sort order
     * of equal elements. The callback is bound to `thisArg` and invoked with
     * three arguments; (value, index|key, collection).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an array of property names is provided for `callback` the collection
     * will be sorted by each property value.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Array|Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns a new array of sorted elements.
     * @example
     *
     * _.sortBy([1, 2, 3], function(num) { return Math.sin(num); });
     * // => [3, 1, 2]
     *
     * _.sortBy([1, 2, 3], function(num) { return this.sin(num); }, Math);
     * // => [3, 1, 2]
     *
     * var characters = [
     *   { 'name': 'barney',  'age': 36 },
     *   { 'name': 'fred',    'age': 40 },
     *   { 'name': 'barney',  'age': 26 },
     *   { 'name': 'fred',    'age': 30 }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.map(_.sortBy(characters, 'age'), _.values);
     * // => [['barney', 26], ['fred', 30], ['barney', 36], ['fred', 40]]
     *
     * // sorting by multiple properties
     * _.map(_.sortBy(characters, ['name', 'age']), _.values);
     * // = > [['barney', 26], ['barney', 36], ['fred', 30], ['fred', 40]]
     */
    function sortBy(collection, callback, thisArg) {
      var index = -1,
          isArr = isArray(callback),
          length = collection ? collection.length : 0,
          result = Array(typeof length == 'number' ? length : 0);

      if (!isArr) {
        callback = lodash.createCallback(callback, thisArg, 3);
      }
      forEach(collection, function(value, key, collection) {
        var object = result[++index] = getObject();
        if (isArr) {
          object.criteria = map(callback, function(key) { return value[key]; });
        } else {
          (object.criteria = getArray())[0] = callback(value, key, collection);
        }
        object.index = index;
        object.value = value;
      });

      length = result.length;
      result.sort(compareAscending);
      while (length--) {
        var object = result[length];
        result[length] = object.value;
        if (!isArr) {
          releaseArray(object.criteria);
        }
        releaseObject(object);
      }
      return result;
    }

    /**
     * Converts the `collection` to an array.
     *
     * @static
     * @memberOf _
     * @category Collections
     * @param {Array|Object|string} collection The collection to convert.
     * @returns {Array} Returns the new converted array.
     * @example
     *
     * (function() { return _.toArray(arguments).slice(1); })(1, 2, 3, 4);
     * // => [2, 3, 4]
     */
    function toArray(collection) {
      if (collection && typeof collection.length == 'number') {
        return slice(collection);
      }
      return values(collection);
    }

    /**
     * Performs a deep comparison of each element in a `collection` to the given
     * `properties` object, returning an array of all elements that have equivalent
     * property values.
     *
     * @static
     * @memberOf _
     * @type Function
     * @category Collections
     * @param {Array|Object|string} collection The collection to iterate over.
     * @param {Object} props The object of property values to filter by.
     * @returns {Array} Returns a new array of elements that have the given properties.
     * @example
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36, 'pets': ['hoppy'] },
     *   { 'name': 'fred',   'age': 40, 'pets': ['baby puss', 'dino'] }
     * ];
     *
     * _.where(characters, { 'age': 36 });
     * // => [{ 'name': 'barney', 'age': 36, 'pets': ['hoppy'] }]
     *
     * _.where(characters, { 'pets': ['dino'] });
     * // => [{ 'name': 'fred', 'age': 40, 'pets': ['baby puss', 'dino'] }]
     */
    var where = filter;

    /*--------------------------------------------------------------------------*/

    /**
     * Creates an array with all falsey values removed. The values `false`, `null`,
     * `0`, `""`, `undefined`, and `NaN` are all falsey.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to compact.
     * @returns {Array} Returns a new array of filtered values.
     * @example
     *
     * _.compact([0, 1, false, 2, '', 3]);
     * // => [1, 2, 3]
     */
    function compact(array) {
      var index = -1,
          length = array ? array.length : 0,
          result = [];

      while (++index < length) {
        var value = array[index];
        if (value) {
          result.push(value);
        }
      }
      return result;
    }

    /**
     * Creates an array excluding all values of the provided arrays using strict
     * equality for comparisons, i.e. `===`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to process.
     * @param {...Array} [values] The arrays of values to exclude.
     * @returns {Array} Returns a new array of filtered values.
     * @example
     *
     * _.difference([1, 2, 3, 4, 5], [5, 2, 10]);
     * // => [1, 3, 4]
     */
    function difference(array) {
      return baseDifference(array, baseFlatten(arguments, true, true, 1));
    }

    /**
     * This method is like `_.find` except that it returns the index of the first
     * element that passes the callback check, instead of the element itself.
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to search.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {number} Returns the index of the found element, else `-1`.
     * @example
     *
     * var characters = [
     *   { 'name': 'barney',  'age': 36, 'blocked': false },
     *   { 'name': 'fred',    'age': 40, 'blocked': true },
     *   { 'name': 'pebbles', 'age': 1,  'blocked': false }
     * ];
     *
     * _.findIndex(characters, function(chr) {
     *   return chr.age < 20;
     * });
     * // => 2
     *
     * // using "_.where" callback shorthand
     * _.findIndex(characters, { 'age': 36 });
     * // => 0
     *
     * // using "_.pluck" callback shorthand
     * _.findIndex(characters, 'blocked');
     * // => 1
     */
    function findIndex(array, callback, thisArg) {
      var index = -1,
          length = array ? array.length : 0;

      callback = lodash.createCallback(callback, thisArg, 3);
      while (++index < length) {
        if (callback(array[index], index, array)) {
          return index;
        }
      }
      return -1;
    }

    /**
     * This method is like `_.findIndex` except that it iterates over elements
     * of a `collection` from right to left.
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to search.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {number} Returns the index of the found element, else `-1`.
     * @example
     *
     * var characters = [
     *   { 'name': 'barney',  'age': 36, 'blocked': true },
     *   { 'name': 'fred',    'age': 40, 'blocked': false },
     *   { 'name': 'pebbles', 'age': 1,  'blocked': true }
     * ];
     *
     * _.findLastIndex(characters, function(chr) {
     *   return chr.age > 30;
     * });
     * // => 1
     *
     * // using "_.where" callback shorthand
     * _.findLastIndex(characters, { 'age': 36 });
     * // => 0
     *
     * // using "_.pluck" callback shorthand
     * _.findLastIndex(characters, 'blocked');
     * // => 2
     */
    function findLastIndex(array, callback, thisArg) {
      var length = array ? array.length : 0;
      callback = lodash.createCallback(callback, thisArg, 3);
      while (length--) {
        if (callback(array[length], length, array)) {
          return length;
        }
      }
      return -1;
    }

    /**
     * Gets the first element or first `n` elements of an array. If a callback
     * is provided elements at the beginning of the array are returned as long
     * as the callback returns truey. The callback is bound to `thisArg` and
     * invoked with three arguments; (value, index, array).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @alias head, take
     * @category Arrays
     * @param {Array} array The array to query.
     * @param {Function|Object|number|string} [callback] The function called
     *  per element or the number of elements to return. If a property name or
     *  object is provided it will be used to create a "_.pluck" or "_.where"
     *  style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the first element(s) of `array`.
     * @example
     *
     * _.first([1, 2, 3]);
     * // => 1
     *
     * _.first([1, 2, 3], 2);
     * // => [1, 2]
     *
     * _.first([1, 2, 3], function(num) {
     *   return num < 3;
     * });
     * // => [1, 2]
     *
     * var characters = [
     *   { 'name': 'barney',  'blocked': true,  'employer': 'slate' },
     *   { 'name': 'fred',    'blocked': false, 'employer': 'slate' },
     *   { 'name': 'pebbles', 'blocked': true,  'employer': 'na' }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.first(characters, 'blocked');
     * // => [{ 'name': 'barney', 'blocked': true, 'employer': 'slate' }]
     *
     * // using "_.where" callback shorthand
     * _.pluck(_.first(characters, { 'employer': 'slate' }), 'name');
     * // => ['barney', 'fred']
     */
    function first(array, callback, thisArg) {
      var n = 0,
          length = array ? array.length : 0;

      if (typeof callback != 'number' && callback != null) {
        var index = -1;
        callback = lodash.createCallback(callback, thisArg, 3);
        while (++index < length && callback(array[index], index, array)) {
          n++;
        }
      } else {
        n = callback;
        if (n == null || thisArg) {
          return array ? array[0] : undefined;
        }
      }
      return slice(array, 0, nativeMin(nativeMax(0, n), length));
    }

    /**
     * Flattens a nested array (the nesting can be to any depth). If `isShallow`
     * is truey, the array will only be flattened a single level. If a callback
     * is provided each element of the array is passed through the callback before
     * flattening. The callback is bound to `thisArg` and invoked with three
     * arguments; (value, index, array).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to flatten.
     * @param {boolean} [isShallow=false] A flag to restrict flattening to a single level.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns a new flattened array.
     * @example
     *
     * _.flatten([1, [2], [3, [[4]]]]);
     * // => [1, 2, 3, 4];
     *
     * _.flatten([1, [2], [3, [[4]]]], true);
     * // => [1, 2, 3, [[4]]];
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 30, 'pets': ['hoppy'] },
     *   { 'name': 'fred',   'age': 40, 'pets': ['baby puss', 'dino'] }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.flatten(characters, 'pets');
     * // => ['hoppy', 'baby puss', 'dino']
     */
    function flatten(array, isShallow, callback, thisArg) {
      // juggle arguments
      if (typeof isShallow != 'boolean' && isShallow != null) {
        thisArg = callback;
        callback = (typeof isShallow != 'function' && thisArg && thisArg[isShallow] === array) ? null : isShallow;
        isShallow = false;
      }
      if (callback != null) {
        array = map(array, callback, thisArg);
      }
      return baseFlatten(array, isShallow);
    }

    /**
     * Gets the index at which the first occurrence of `value` is found using
     * strict equality for comparisons, i.e. `===`. If the array is already sorted
     * providing `true` for `fromIndex` will run a faster binary search.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to search.
     * @param {*} value The value to search for.
     * @param {boolean|number} [fromIndex=0] The index to search from or `true`
     *  to perform a binary search on a sorted array.
     * @returns {number} Returns the index of the matched value or `-1`.
     * @example
     *
     * _.indexOf([1, 2, 3, 1, 2, 3], 2);
     * // => 1
     *
     * _.indexOf([1, 2, 3, 1, 2, 3], 2, 3);
     * // => 4
     *
     * _.indexOf([1, 1, 2, 2, 3, 3], 2, true);
     * // => 2
     */
    function indexOf(array, value, fromIndex) {
      if (typeof fromIndex == 'number') {
        var length = array ? array.length : 0;
        fromIndex = (fromIndex < 0 ? nativeMax(0, length + fromIndex) : fromIndex || 0);
      } else if (fromIndex) {
        var index = sortedIndex(array, value);
        return array[index] === value ? index : -1;
      }
      return baseIndexOf(array, value, fromIndex);
    }

    /**
     * Gets all but the last element or last `n` elements of an array. If a
     * callback is provided elements at the end of the array are excluded from
     * the result as long as the callback returns truey. The callback is bound
     * to `thisArg` and invoked with three arguments; (value, index, array).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to query.
     * @param {Function|Object|number|string} [callback=1] The function called
     *  per element or the number of elements to exclude. If a property name or
     *  object is provided it will be used to create a "_.pluck" or "_.where"
     *  style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns a slice of `array`.
     * @example
     *
     * _.initial([1, 2, 3]);
     * // => [1, 2]
     *
     * _.initial([1, 2, 3], 2);
     * // => [1]
     *
     * _.initial([1, 2, 3], function(num) {
     *   return num > 1;
     * });
     * // => [1]
     *
     * var characters = [
     *   { 'name': 'barney',  'blocked': false, 'employer': 'slate' },
     *   { 'name': 'fred',    'blocked': true,  'employer': 'slate' },
     *   { 'name': 'pebbles', 'blocked': true,  'employer': 'na' }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.initial(characters, 'blocked');
     * // => [{ 'name': 'barney',  'blocked': false, 'employer': 'slate' }]
     *
     * // using "_.where" callback shorthand
     * _.pluck(_.initial(characters, { 'employer': 'na' }), 'name');
     * // => ['barney', 'fred']
     */
    function initial(array, callback, thisArg) {
      var n = 0,
          length = array ? array.length : 0;

      if (typeof callback != 'number' && callback != null) {
        var index = length;
        callback = lodash.createCallback(callback, thisArg, 3);
        while (index-- && callback(array[index], index, array)) {
          n++;
        }
      } else {
        n = (callback == null || thisArg) ? 1 : callback || n;
      }
      return slice(array, 0, nativeMin(nativeMax(0, length - n), length));
    }

    /**
     * Creates an array of unique values present in all provided arrays using
     * strict equality for comparisons, i.e. `===`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {...Array} [array] The arrays to inspect.
     * @returns {Array} Returns an array of shared values.
     * @example
     *
     * _.intersection([1, 2, 3], [5, 2, 1, 4], [2, 1]);
     * // => [1, 2]
     */
    function intersection() {
      var args = [],
          argsIndex = -1,
          argsLength = arguments.length,
          caches = getArray(),
          indexOf = getIndexOf(),
          trustIndexOf = indexOf === baseIndexOf,
          seen = getArray();

      while (++argsIndex < argsLength) {
        var value = arguments[argsIndex];
        if (isArray(value) || isArguments(value)) {
          args.push(value);
          caches.push(trustIndexOf && value.length >= largeArraySize &&
            createCache(argsIndex ? args[argsIndex] : seen));
        }
      }
      var array = args[0],
          index = -1,
          length = array ? array.length : 0,
          result = [];

      outer:
      while (++index < length) {
        var cache = caches[0];
        value = array[index];

        if ((cache ? cacheIndexOf(cache, value) : indexOf(seen, value)) < 0) {
          argsIndex = argsLength;
          (cache || seen).push(value);
          while (--argsIndex) {
            cache = caches[argsIndex];
            if ((cache ? cacheIndexOf(cache, value) : indexOf(args[argsIndex], value)) < 0) {
              continue outer;
            }
          }
          result.push(value);
        }
      }
      while (argsLength--) {
        cache = caches[argsLength];
        if (cache) {
          releaseObject(cache);
        }
      }
      releaseArray(caches);
      releaseArray(seen);
      return result;
    }

    /**
     * Gets the last element or last `n` elements of an array. If a callback is
     * provided elements at the end of the array are returned as long as the
     * callback returns truey. The callback is bound to `thisArg` and invoked
     * with three arguments; (value, index, array).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to query.
     * @param {Function|Object|number|string} [callback] The function called
     *  per element or the number of elements to return. If a property name or
     *  object is provided it will be used to create a "_.pluck" or "_.where"
     *  style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {*} Returns the last element(s) of `array`.
     * @example
     *
     * _.last([1, 2, 3]);
     * // => 3
     *
     * _.last([1, 2, 3], 2);
     * // => [2, 3]
     *
     * _.last([1, 2, 3], function(num) {
     *   return num > 1;
     * });
     * // => [2, 3]
     *
     * var characters = [
     *   { 'name': 'barney',  'blocked': false, 'employer': 'slate' },
     *   { 'name': 'fred',    'blocked': true,  'employer': 'slate' },
     *   { 'name': 'pebbles', 'blocked': true,  'employer': 'na' }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.pluck(_.last(characters, 'blocked'), 'name');
     * // => ['fred', 'pebbles']
     *
     * // using "_.where" callback shorthand
     * _.last(characters, { 'employer': 'na' });
     * // => [{ 'name': 'pebbles', 'blocked': true, 'employer': 'na' }]
     */
    function last(array, callback, thisArg) {
      var n = 0,
          length = array ? array.length : 0;

      if (typeof callback != 'number' && callback != null) {
        var index = length;
        callback = lodash.createCallback(callback, thisArg, 3);
        while (index-- && callback(array[index], index, array)) {
          n++;
        }
      } else {
        n = callback;
        if (n == null || thisArg) {
          return array ? array[length - 1] : undefined;
        }
      }
      return slice(array, nativeMax(0, length - n));
    }

    /**
     * Gets the index at which the last occurrence of `value` is found using strict
     * equality for comparisons, i.e. `===`. If `fromIndex` is negative, it is used
     * as the offset from the end of the collection.
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to search.
     * @param {*} value The value to search for.
     * @param {number} [fromIndex=array.length-1] The index to search from.
     * @returns {number} Returns the index of the matched value or `-1`.
     * @example
     *
     * _.lastIndexOf([1, 2, 3, 1, 2, 3], 2);
     * // => 4
     *
     * _.lastIndexOf([1, 2, 3, 1, 2, 3], 2, 3);
     * // => 1
     */
    function lastIndexOf(array, value, fromIndex) {
      var index = array ? array.length : 0;
      if (typeof fromIndex == 'number') {
        index = (fromIndex < 0 ? nativeMax(0, index + fromIndex) : nativeMin(fromIndex, index - 1)) + 1;
      }
      while (index--) {
        if (array[index] === value) {
          return index;
        }
      }
      return -1;
    }

    /**
     * Removes all provided values from the given array using strict equality for
     * comparisons, i.e. `===`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to modify.
     * @param {...*} [value] The values to remove.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = [1, 2, 3, 1, 2, 3];
     * _.pull(array, 2, 3);
     * console.log(array);
     * // => [1, 1]
     */
    function pull(array) {
      var args = arguments,
          argsIndex = 0,
          argsLength = args.length,
          length = array ? array.length : 0;

      while (++argsIndex < argsLength) {
        var index = -1,
            value = args[argsIndex];
        while (++index < length) {
          if (array[index] === value) {
            splice.call(array, index--, 1);
            length--;
          }
        }
      }
      return array;
    }

    /**
     * Creates an array of numbers (positive and/or negative) progressing from
     * `start` up to but not including `end`. If `start` is less than `stop` a
     * zero-length range is created unless a negative `step` is specified.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {number} [start=0] The start of the range.
     * @param {number} end The end of the range.
     * @param {number} [step=1] The value to increment or decrement by.
     * @returns {Array} Returns a new range array.
     * @example
     *
     * _.range(4);
     * // => [0, 1, 2, 3]
     *
     * _.range(1, 5);
     * // => [1, 2, 3, 4]
     *
     * _.range(0, 20, 5);
     * // => [0, 5, 10, 15]
     *
     * _.range(0, -4, -1);
     * // => [0, -1, -2, -3]
     *
     * _.range(1, 4, 0);
     * // => [1, 1, 1]
     *
     * _.range(0);
     * // => []
     */
    function range(start, end, step) {
      start = +start || 0;
      step = typeof step == 'number' ? step : (+step || 1);

      if (end == null) {
        end = start;
        start = 0;
      }
      // use `Array(length)` so engines like Chakra and V8 avoid slower modes
      // http://youtu.be/XAqIpGU8ZZk#t=17m25s
      var index = -1,
          length = nativeMax(0, ceil((end - start) / (step || 1))),
          result = Array(length);

      while (++index < length) {
        result[index] = start;
        start += step;
      }
      return result;
    }

    /**
     * Removes all elements from an array that the callback returns truey for
     * and returns an array of removed elements. The callback is bound to `thisArg`
     * and invoked with three arguments; (value, index, array).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to modify.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns a new array of removed elements.
     * @example
     *
     * var array = [1, 2, 3, 4, 5, 6];
     * var evens = _.remove(array, function(num) { return num % 2 == 0; });
     *
     * console.log(array);
     * // => [1, 3, 5]
     *
     * console.log(evens);
     * // => [2, 4, 6]
     */
    function remove(array, callback, thisArg) {
      var index = -1,
          length = array ? array.length : 0,
          result = [];

      callback = lodash.createCallback(callback, thisArg, 3);
      while (++index < length) {
        var value = array[index];
        if (callback(value, index, array)) {
          result.push(value);
          splice.call(array, index--, 1);
          length--;
        }
      }
      return result;
    }

    /**
     * The opposite of `_.initial` this method gets all but the first element or
     * first `n` elements of an array. If a callback function is provided elements
     * at the beginning of the array are excluded from the result as long as the
     * callback returns truey. The callback is bound to `thisArg` and invoked
     * with three arguments; (value, index, array).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @alias drop, tail
     * @category Arrays
     * @param {Array} array The array to query.
     * @param {Function|Object|number|string} [callback=1] The function called
     *  per element or the number of elements to exclude. If a property name or
     *  object is provided it will be used to create a "_.pluck" or "_.where"
     *  style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns a slice of `array`.
     * @example
     *
     * _.rest([1, 2, 3]);
     * // => [2, 3]
     *
     * _.rest([1, 2, 3], 2);
     * // => [3]
     *
     * _.rest([1, 2, 3], function(num) {
     *   return num < 3;
     * });
     * // => [3]
     *
     * var characters = [
     *   { 'name': 'barney',  'blocked': true,  'employer': 'slate' },
     *   { 'name': 'fred',    'blocked': false,  'employer': 'slate' },
     *   { 'name': 'pebbles', 'blocked': true, 'employer': 'na' }
     * ];
     *
     * // using "_.pluck" callback shorthand
     * _.pluck(_.rest(characters, 'blocked'), 'name');
     * // => ['fred', 'pebbles']
     *
     * // using "_.where" callback shorthand
     * _.rest(characters, { 'employer': 'slate' });
     * // => [{ 'name': 'pebbles', 'blocked': true, 'employer': 'na' }]
     */
    function rest(array, callback, thisArg) {
      if (typeof callback != 'number' && callback != null) {
        var n = 0,
            index = -1,
            length = array ? array.length : 0;

        callback = lodash.createCallback(callback, thisArg, 3);
        while (++index < length && callback(array[index], index, array)) {
          n++;
        }
      } else {
        n = (callback == null || thisArg) ? 1 : nativeMax(0, callback);
      }
      return slice(array, n);
    }

    /**
     * Uses a binary search to determine the smallest index at which a value
     * should be inserted into a given sorted array in order to maintain the sort
     * order of the array. If a callback is provided it will be executed for
     * `value` and each element of `array` to compute their sort ranking. The
     * callback is bound to `thisArg` and invoked with one argument; (value).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to inspect.
     * @param {*} value The value to evaluate.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * _.sortedIndex([20, 30, 50], 40);
     * // => 2
     *
     * // using "_.pluck" callback shorthand
     * _.sortedIndex([{ 'x': 20 }, { 'x': 30 }, { 'x': 50 }], { 'x': 40 }, 'x');
     * // => 2
     *
     * var dict = {
     *   'wordToNumber': { 'twenty': 20, 'thirty': 30, 'fourty': 40, 'fifty': 50 }
     * };
     *
     * _.sortedIndex(['twenty', 'thirty', 'fifty'], 'fourty', function(word) {
     *   return dict.wordToNumber[word];
     * });
     * // => 2
     *
     * _.sortedIndex(['twenty', 'thirty', 'fifty'], 'fourty', function(word) {
     *   return this.wordToNumber[word];
     * }, dict);
     * // => 2
     */
    function sortedIndex(array, value, callback, thisArg) {
      var low = 0,
          high = array ? array.length : low;

      // explicitly reference `identity` for better inlining in Firefox
      callback = callback ? lodash.createCallback(callback, thisArg, 1) : identity;
      value = callback(value);

      while (low < high) {
        var mid = (low + high) >>> 1;
        (callback(array[mid]) < value)
          ? low = mid + 1
          : high = mid;
      }
      return low;
    }

    /**
     * Creates an array of unique values, in order, of the provided arrays using
     * strict equality for comparisons, i.e. `===`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {...Array} [array] The arrays to inspect.
     * @returns {Array} Returns an array of combined values.
     * @example
     *
     * _.union([1, 2, 3], [5, 2, 1, 4], [2, 1]);
     * // => [1, 2, 3, 5, 4]
     */
    function union() {
      return baseUniq(baseFlatten(arguments, true, true));
    }

    /**
     * Creates a duplicate-value-free version of an array using strict equality
     * for comparisons, i.e. `===`. If the array is sorted, providing
     * `true` for `isSorted` will use a faster algorithm. If a callback is provided
     * each element of `array` is passed through the callback before uniqueness
     * is computed. The callback is bound to `thisArg` and invoked with three
     * arguments; (value, index, array).
     *
     * If a property name is provided for `callback` the created "_.pluck" style
     * callback will return the property value of the given element.
     *
     * If an object is provided for `callback` the created "_.where" style callback
     * will return `true` for elements that have the properties of the given object,
     * else `false`.
     *
     * @static
     * @memberOf _
     * @alias unique
     * @category Arrays
     * @param {Array} array The array to process.
     * @param {boolean} [isSorted=false] A flag to indicate that `array` is sorted.
     * @param {Function|Object|string} [callback=identity] The function called
     *  per iteration. If a property name or object is provided it will be used
     *  to create a "_.pluck" or "_.where" style callback, respectively.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns a duplicate-value-free array.
     * @example
     *
     * _.uniq([1, 2, 1, 3, 1]);
     * // => [1, 2, 3]
     *
     * _.uniq([1, 1, 2, 2, 3], true);
     * // => [1, 2, 3]
     *
     * _.uniq(['A', 'b', 'C', 'a', 'B', 'c'], function(letter) { return letter.toLowerCase(); });
     * // => ['A', 'b', 'C']
     *
     * _.uniq([1, 2.5, 3, 1.5, 2, 3.5], function(num) { return this.floor(num); }, Math);
     * // => [1, 2.5, 3]
     *
     * // using "_.pluck" callback shorthand
     * _.uniq([{ 'x': 1 }, { 'x': 2 }, { 'x': 1 }], 'x');
     * // => [{ 'x': 1 }, { 'x': 2 }]
     */
    function uniq(array, isSorted, callback, thisArg) {
      // juggle arguments
      if (typeof isSorted != 'boolean' && isSorted != null) {
        thisArg = callback;
        callback = (typeof isSorted != 'function' && thisArg && thisArg[isSorted] === array) ? null : isSorted;
        isSorted = false;
      }
      if (callback != null) {
        callback = lodash.createCallback(callback, thisArg, 3);
      }
      return baseUniq(array, isSorted, callback);
    }

    /**
     * Creates an array excluding all provided values using strict equality for
     * comparisons, i.e. `===`.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {Array} array The array to filter.
     * @param {...*} [value] The values to exclude.
     * @returns {Array} Returns a new array of filtered values.
     * @example
     *
     * _.without([1, 2, 1, 0, 3, 1, 4], 0, 1);
     * // => [2, 3, 4]
     */
    function without(array) {
      return baseDifference(array, slice(arguments, 1));
    }

    /**
     * Creates an array that is the symmetric difference of the provided arrays.
     * See http://en.wikipedia.org/wiki/Symmetric_difference.
     *
     * @static
     * @memberOf _
     * @category Arrays
     * @param {...Array} [array] The arrays to inspect.
     * @returns {Array} Returns an array of values.
     * @example
     *
     * _.xor([1, 2, 3], [5, 2, 1, 4]);
     * // => [3, 5, 4]
     *
     * _.xor([1, 2, 5], [2, 3, 5], [3, 4, 5]);
     * // => [1, 4, 5]
     */
    function xor() {
      var index = -1,
          length = arguments.length;

      while (++index < length) {
        var array = arguments[index];
        if (isArray(array) || isArguments(array)) {
          var result = result
            ? baseUniq(baseDifference(result, array).concat(baseDifference(array, result)))
            : array;
        }
      }
      return result || [];
    }

    /**
     * Creates an array of grouped elements, the first of which contains the first
     * elements of the given arrays, the second of which contains the second
     * elements of the given arrays, and so on.
     *
     * @static
     * @memberOf _
     * @alias unzip
     * @category Arrays
     * @param {...Array} [array] Arrays to process.
     * @returns {Array} Returns a new array of grouped elements.
     * @example
     *
     * _.zip(['fred', 'barney'], [30, 40], [true, false]);
     * // => [['fred', 30, true], ['barney', 40, false]]
     */
    function zip() {
      var array = arguments.length > 1 ? arguments : arguments[0],
          index = -1,
          length = array ? max(pluck(array, 'length')) : 0,
          result = Array(length < 0 ? 0 : length);

      while (++index < length) {
        result[index] = pluck(array, index);
      }
      return result;
    }

    /**
     * Creates an object composed from arrays of `keys` and `values`. Provide
     * either a single two dimensional array, i.e. `[[key1, value1], [key2, value2]]`
     * or two arrays, one of `keys` and one of corresponding `values`.
     *
     * @static
     * @memberOf _
     * @alias object
     * @category Arrays
     * @param {Array} keys The array of keys.
     * @param {Array} [values=[]] The array of values.
     * @returns {Object} Returns an object composed of the given keys and
     *  corresponding values.
     * @example
     *
     * _.zipObject(['fred', 'barney'], [30, 40]);
     * // => { 'fred': 30, 'barney': 40 }
     */
    function zipObject(keys, values) {
      var index = -1,
          length = keys ? keys.length : 0,
          result = {};

      if (!values && length && !isArray(keys[0])) {
        values = [];
      }
      while (++index < length) {
        var key = keys[index];
        if (values) {
          result[key] = values[index];
        } else if (key) {
          result[key[0]] = key[1];
        }
      }
      return result;
    }

    /*--------------------------------------------------------------------------*/

    /**
     * Creates a function that executes `func`, with  the `this` binding and
     * arguments of the created function, only after being called `n` times.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {number} n The number of times the function must be called before
     *  `func` is executed.
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * var saves = ['profile', 'settings'];
     *
     * var done = _.after(saves.length, function() {
     *   console.log('Done saving!');
     * });
     *
     * _.forEach(saves, function(type) {
     *   asyncSave({ 'type': type, 'complete': done });
     * });
     * // => logs 'Done saving!', after all saves have completed
     */
    function after(n, func) {
      if (!isFunction(func)) {
        throw new TypeError;
      }
      return function() {
        if (--n < 1) {
          return func.apply(this, arguments);
        }
      };
    }

    /**
     * Creates a function that, when called, invokes `func` with the `this`
     * binding of `thisArg` and prepends any additional `bind` arguments to those
     * provided to the bound function.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Function} func The function to bind.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {...*} [arg] Arguments to be partially applied.
     * @returns {Function} Returns the new bound function.
     * @example
     *
     * var func = function(greeting) {
     *   return greeting + ' ' + this.name;
     * };
     *
     * func = _.bind(func, { 'name': 'fred' }, 'hi');
     * func();
     * // => 'hi fred'
     */
    function bind(func, thisArg) {
      return arguments.length > 2
        ? createWrapper(func, 17, slice(arguments, 2), null, thisArg)
        : createWrapper(func, 1, null, null, thisArg);
    }

    /**
     * Binds methods of an object to the object itself, overwriting the existing
     * method. Method names may be specified as individual arguments or as arrays
     * of method names. If no method names are provided all the function properties
     * of `object` will be bound.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Object} object The object to bind and assign the bound methods to.
     * @param {...string} [methodName] The object method names to
     *  bind, specified as individual method names or arrays of method names.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var view = {
     *   'label': 'docs',
     *   'onClick': function() { console.log('clicked ' + this.label); }
     * };
     *
     * _.bindAll(view);
     * jQuery('#docs').on('click', view.onClick);
     * // => logs 'clicked docs', when the button is clicked
     */
    function bindAll(object) {
      var funcs = arguments.length > 1 ? baseFlatten(arguments, true, false, 1) : functions(object),
          index = -1,
          length = funcs.length;

      while (++index < length) {
        var key = funcs[index];
        object[key] = createWrapper(object[key], 1, null, null, object);
      }
      return object;
    }

    /**
     * Creates a function that, when called, invokes the method at `object[key]`
     * and prepends any additional `bindKey` arguments to those provided to the bound
     * function. This method differs from `_.bind` by allowing bound functions to
     * reference methods that will be redefined or don't yet exist.
     * See http://michaux.ca/articles/lazy-function-definition-pattern.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Object} object The object the method belongs to.
     * @param {string} key The key of the method.
     * @param {...*} [arg] Arguments to be partially applied.
     * @returns {Function} Returns the new bound function.
     * @example
     *
     * var object = {
     *   'name': 'fred',
     *   'greet': function(greeting) {
     *     return greeting + ' ' + this.name;
     *   }
     * };
     *
     * var func = _.bindKey(object, 'greet', 'hi');
     * func();
     * // => 'hi fred'
     *
     * object.greet = function(greeting) {
     *   return greeting + 'ya ' + this.name + '!';
     * };
     *
     * func();
     * // => 'hiya fred!'
     */
    function bindKey(object, key) {
      return arguments.length > 2
        ? createWrapper(key, 19, slice(arguments, 2), null, object)
        : createWrapper(key, 3, null, null, object);
    }

    /**
     * Creates a function that is the composition of the provided functions,
     * where each function consumes the return value of the function that follows.
     * For example, composing the functions `f()`, `g()`, and `h()` produces `f(g(h()))`.
     * Each function is executed with the `this` binding of the composed function.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {...Function} [func] Functions to compose.
     * @returns {Function} Returns the new composed function.
     * @example
     *
     * var realNameMap = {
     *   'pebbles': 'penelope'
     * };
     *
     * var format = function(name) {
     *   name = realNameMap[name.toLowerCase()] || name;
     *   return name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
     * };
     *
     * var greet = function(formatted) {
     *   return 'Hiya ' + formatted + '!';
     * };
     *
     * var welcome = _.compose(greet, format);
     * welcome('pebbles');
     * // => 'Hiya Penelope!'
     */
    function compose() {
      var funcs = arguments,
          length = funcs.length;

      while (length--) {
        if (!isFunction(funcs[length])) {
          throw new TypeError;
        }
      }
      return function() {
        var args = arguments,
            length = funcs.length;

        while (length--) {
          args = [funcs[length].apply(this, args)];
        }
        return args[0];
      };
    }

    /**
     * Creates a function which accepts one or more arguments of `func` that when
     * invoked either executes `func` returning its result, if all `func` arguments
     * have been provided, or returns a function that accepts one or more of the
     * remaining `func` arguments, and so on. The arity of `func` can be specified
     * if `func.length` is not sufficient.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Function} func The function to curry.
     * @param {number} [arity=func.length] The arity of `func`.
     * @returns {Function} Returns the new curried function.
     * @example
     *
     * var curried = _.curry(function(a, b, c) {
     *   console.log(a + b + c);
     * });
     *
     * curried(1)(2)(3);
     * // => 6
     *
     * curried(1, 2)(3);
     * // => 6
     *
     * curried(1, 2, 3);
     * // => 6
     */
    function curry(func, arity) {
      arity = typeof arity == 'number' ? arity : (+arity || func.length);
      return createWrapper(func, 4, null, null, null, arity);
    }

    /**
     * Creates a function that will delay the execution of `func` until after
     * `wait` milliseconds have elapsed since the last time it was invoked.
     * Provide an options object to indicate that `func` should be invoked on
     * the leading and/or trailing edge of the `wait` timeout. Subsequent calls
     * to the debounced function will return the result of the last `func` call.
     *
     * Note: If `leading` and `trailing` options are `true` `func` will be called
     * on the trailing edge of the timeout only if the the debounced function is
     * invoked more than once during the `wait` timeout.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Function} func The function to debounce.
     * @param {number} wait The number of milliseconds to delay.
     * @param {Object} [options] The options object.
     * @param {boolean} [options.leading=false] Specify execution on the leading edge of the timeout.
     * @param {number} [options.maxWait] The maximum time `func` is allowed to be delayed before it's called.
     * @param {boolean} [options.trailing=true] Specify execution on the trailing edge of the timeout.
     * @returns {Function} Returns the new debounced function.
     * @example
     *
     * // avoid costly calculations while the window size is in flux
     * var lazyLayout = _.debounce(calculateLayout, 150);
     * jQuery(window).on('resize', lazyLayout);
     *
     * // execute `sendMail` when the click event is fired, debouncing subsequent calls
     * jQuery('#postbox').on('click', _.debounce(sendMail, 300, {
     *   'leading': true,
     *   'trailing': false
     * });
     *
     * // ensure `batchLog` is executed once after 1 second of debounced calls
     * var source = new EventSource('/stream');
     * source.addEventListener('message', _.debounce(batchLog, 250, {
     *   'maxWait': 1000
     * }, false);
     */
    function debounce(func, wait, options) {
      var args,
          maxTimeoutId,
          result,
          stamp,
          thisArg,
          timeoutId,
          trailingCall,
          lastCalled = 0,
          maxWait = false,
          trailing = true;

      if (!isFunction(func)) {
        throw new TypeError;
      }
      wait = nativeMax(0, wait) || 0;
      if (options === true) {
        var leading = true;
        trailing = false;
      } else if (isObject(options)) {
        leading = options.leading;
        maxWait = 'maxWait' in options && (nativeMax(wait, options.maxWait) || 0);
        trailing = 'trailing' in options ? options.trailing : trailing;
      }
      var delayed = function() {
        var remaining = wait - (now() - stamp);
        if (remaining <= 0) {
          if (maxTimeoutId) {
            clearTimeout(maxTimeoutId);
          }
          var isCalled = trailingCall;
          maxTimeoutId = timeoutId = trailingCall = undefined;
          if (isCalled) {
            lastCalled = now();
            result = func.apply(thisArg, args);
            if (!timeoutId && !maxTimeoutId) {
              args = thisArg = null;
            }
          }
        } else {
          timeoutId = setTimeout(delayed, remaining);
        }
      };

      var maxDelayed = function() {
        if (timeoutId) {
          clearTimeout(timeoutId);
        }
        maxTimeoutId = timeoutId = trailingCall = undefined;
        if (trailing || (maxWait !== wait)) {
          lastCalled = now();
          result = func.apply(thisArg, args);
          if (!timeoutId && !maxTimeoutId) {
            args = thisArg = null;
          }
        }
      };

      return function() {
        args = arguments;
        stamp = now();
        thisArg = this;
        trailingCall = trailing && (timeoutId || !leading);

        if (maxWait === false) {
          var leadingCall = leading && !timeoutId;
        } else {
          if (!maxTimeoutId && !leading) {
            lastCalled = stamp;
          }
          var remaining = maxWait - (stamp - lastCalled),
              isCalled = remaining <= 0;

          if (isCalled) {
            if (maxTimeoutId) {
              maxTimeoutId = clearTimeout(maxTimeoutId);
            }
            lastCalled = stamp;
            result = func.apply(thisArg, args);
          }
          else if (!maxTimeoutId) {
            maxTimeoutId = setTimeout(maxDelayed, remaining);
          }
        }
        if (isCalled && timeoutId) {
          timeoutId = clearTimeout(timeoutId);
        }
        else if (!timeoutId && wait !== maxWait) {
          timeoutId = setTimeout(delayed, wait);
        }
        if (leadingCall) {
          isCalled = true;
          result = func.apply(thisArg, args);
        }
        if (isCalled && !timeoutId && !maxTimeoutId) {
          args = thisArg = null;
        }
        return result;
      };
    }

    /**
     * Defers executing the `func` function until the current call stack has cleared.
     * Additional arguments will be provided to `func` when it is invoked.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Function} func The function to defer.
     * @param {...*} [arg] Arguments to invoke the function with.
     * @returns {number} Returns the timer id.
     * @example
     *
     * _.defer(function(text) { console.log(text); }, 'deferred');
     * // logs 'deferred' after one or more milliseconds
     */
    function defer(func) {
      if (!isFunction(func)) {
        throw new TypeError;
      }
      var args = slice(arguments, 1);
      return setTimeout(function() { func.apply(undefined, args); }, 1);
    }

    /**
     * Executes the `func` function after `wait` milliseconds. Additional arguments
     * will be provided to `func` when it is invoked.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Function} func The function to delay.
     * @param {number} wait The number of milliseconds to delay execution.
     * @param {...*} [arg] Arguments to invoke the function with.
     * @returns {number} Returns the timer id.
     * @example
     *
     * _.delay(function(text) { console.log(text); }, 1000, 'later');
     * // => logs 'later' after one second
     */
    function delay(func, wait) {
      if (!isFunction(func)) {
        throw new TypeError;
      }
      var args = slice(arguments, 2);
      return setTimeout(function() { func.apply(undefined, args); }, wait);
    }

    /**
     * Creates a function that memoizes the result of `func`. If `resolver` is
     * provided it will be used to determine the cache key for storing the result
     * based on the arguments provided to the memoized function. By default, the
     * first argument provided to the memoized function is used as the cache key.
     * The `func` is executed with the `this` binding of the memoized function.
     * The result cache is exposed as the `cache` property on the memoized function.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Function} func The function to have its output memoized.
     * @param {Function} [resolver] A function used to resolve the cache key.
     * @returns {Function} Returns the new memoizing function.
     * @example
     *
     * var fibonacci = _.memoize(function(n) {
     *   return n < 2 ? n : fibonacci(n - 1) + fibonacci(n - 2);
     * });
     *
     * fibonacci(9)
     * // => 34
     *
     * var data = {
     *   'fred': { 'name': 'fred', 'age': 40 },
     *   'pebbles': { 'name': 'pebbles', 'age': 1 }
     * };
     *
     * // modifying the result cache
     * var get = _.memoize(function(name) { return data[name]; }, _.identity);
     * get('pebbles');
     * // => { 'name': 'pebbles', 'age': 1 }
     *
     * get.cache.pebbles.name = 'penelope';
     * get('pebbles');
     * // => { 'name': 'penelope', 'age': 1 }
     */
    function memoize(func, resolver) {
      if (!isFunction(func)) {
        throw new TypeError;
      }
      var memoized = function() {
        var cache = memoized.cache,
            key = resolver ? resolver.apply(this, arguments) : keyPrefix + arguments[0];

        return hasOwnProperty.call(cache, key)
          ? cache[key]
          : (cache[key] = func.apply(this, arguments));
      }
      memoized.cache = {};
      return memoized;
    }

    /**
     * Creates a function that is restricted to execute `func` once. Repeat calls to
     * the function will return the value of the first call. The `func` is executed
     * with the `this` binding of the created function.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * var initialize = _.once(createApplication);
     * initialize();
     * initialize();
     * // `initialize` executes `createApplication` once
     */
    function once(func) {
      var ran,
          result;

      if (!isFunction(func)) {
        throw new TypeError;
      }
      return function() {
        if (ran) {
          return result;
        }
        ran = true;
        result = func.apply(this, arguments);

        // clear the `func` variable so the function may be garbage collected
        func = null;
        return result;
      };
    }

    /**
     * Creates a function that, when called, invokes `func` with any additional
     * `partial` arguments prepended to those provided to the new function. This
     * method is similar to `_.bind` except it does **not** alter the `this` binding.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Function} func The function to partially apply arguments to.
     * @param {...*} [arg] Arguments to be partially applied.
     * @returns {Function} Returns the new partially applied function.
     * @example
     *
     * var greet = function(greeting, name) { return greeting + ' ' + name; };
     * var hi = _.partial(greet, 'hi');
     * hi('fred');
     * // => 'hi fred'
     */
    function partial(func) {
      return createWrapper(func, 16, slice(arguments, 1));
    }

    /**
     * This method is like `_.partial` except that `partial` arguments are
     * appended to those provided to the new function.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Function} func The function to partially apply arguments to.
     * @param {...*} [arg] Arguments to be partially applied.
     * @returns {Function} Returns the new partially applied function.
     * @example
     *
     * var defaultsDeep = _.partialRight(_.merge, _.defaults);
     *
     * var options = {
     *   'variable': 'data',
     *   'imports': { 'jq': $ }
     * };
     *
     * defaultsDeep(options, _.templateSettings);
     *
     * options.variable
     * // => 'data'
     *
     * options.imports
     * // => { '_': _, 'jq': $ }
     */
    function partialRight(func) {
      return createWrapper(func, 32, null, slice(arguments, 1));
    }

    /**
     * Creates a function that, when executed, will only call the `func` function
     * at most once per every `wait` milliseconds. Provide an options object to
     * indicate that `func` should be invoked on the leading and/or trailing edge
     * of the `wait` timeout. Subsequent calls to the throttled function will
     * return the result of the last `func` call.
     *
     * Note: If `leading` and `trailing` options are `true` `func` will be called
     * on the trailing edge of the timeout only if the the throttled function is
     * invoked more than once during the `wait` timeout.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {Function} func The function to throttle.
     * @param {number} wait The number of milliseconds to throttle executions to.
     * @param {Object} [options] The options object.
     * @param {boolean} [options.leading=true] Specify execution on the leading edge of the timeout.
     * @param {boolean} [options.trailing=true] Specify execution on the trailing edge of the timeout.
     * @returns {Function} Returns the new throttled function.
     * @example
     *
     * // avoid excessively updating the position while scrolling
     * var throttled = _.throttle(updatePosition, 100);
     * jQuery(window).on('scroll', throttled);
     *
     * // execute `renewToken` when the click event is fired, but not more than once every 5 minutes
     * jQuery('.interactive').on('click', _.throttle(renewToken, 300000, {
     *   'trailing': false
     * }));
     */
    function throttle(func, wait, options) {
      var leading = true,
          trailing = true;

      if (!isFunction(func)) {
        throw new TypeError;
      }
      if (options === false) {
        leading = false;
      } else if (isObject(options)) {
        leading = 'leading' in options ? options.leading : leading;
        trailing = 'trailing' in options ? options.trailing : trailing;
      }
      debounceOptions.leading = leading;
      debounceOptions.maxWait = wait;
      debounceOptions.trailing = trailing;

      return debounce(func, wait, debounceOptions);
    }

    /**
     * Creates a function that provides `value` to the wrapper function as its
     * first argument. Additional arguments provided to the function are appended
     * to those provided to the wrapper function. The wrapper is executed with
     * the `this` binding of the created function.
     *
     * @static
     * @memberOf _
     * @category Functions
     * @param {*} value The value to wrap.
     * @param {Function} wrapper The wrapper function.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var p = _.wrap(_.escape, function(func, text) {
     *   return '<p>' + func(text) + '</p>';
     * });
     *
     * p('Fred, Wilma, & Pebbles');
     * // => '<p>Fred, Wilma, &amp; Pebbles</p>'
     */
    function wrap(value, wrapper) {
      return createWrapper(wrapper, 16, [value]);
    }

    /*--------------------------------------------------------------------------*/

    /**
     * Creates a function that returns `value`.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {*} value The value to return from the new function.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var object = { 'name': 'fred' };
     * var getter = _.constant(object);
     * getter() === object;
     * // => true
     */
    function constant(value) {
      return function() {
        return value;
      };
    }

    /**
     * Produces a callback bound to an optional `thisArg`. If `func` is a property
     * name the created callback will return the property value for a given element.
     * If `func` is an object the created callback will return `true` for elements
     * that contain the equivalent object properties, otherwise it will return `false`.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {*} [func=identity] The value to convert to a callback.
     * @param {*} [thisArg] The `this` binding of the created callback.
     * @param {number} [argCount] The number of arguments the callback accepts.
     * @returns {Function} Returns a callback function.
     * @example
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36 },
     *   { 'name': 'fred',   'age': 40 }
     * ];
     *
     * // wrap to create custom callback shorthands
     * _.createCallback = _.wrap(_.createCallback, function(func, callback, thisArg) {
     *   var match = /^(.+?)__([gl]t)(.+)$/.exec(callback);
     *   return !match ? func(callback, thisArg) : function(object) {
     *     return match[2] == 'gt' ? object[match[1]] > match[3] : object[match[1]] < match[3];
     *   };
     * });
     *
     * _.filter(characters, 'age__gt38');
     * // => [{ 'name': 'fred', 'age': 40 }]
     */
    function createCallback(func, thisArg, argCount) {
      var type = typeof func;
      if (func == null || type == 'function') {
        return baseCreateCallback(func, thisArg, argCount);
      }
      // handle "_.pluck" style callback shorthands
      if (type != 'object') {
        return property(func);
      }
      var props = keys(func),
          key = props[0],
          a = func[key];

      // handle "_.where" style callback shorthands
      if (props.length == 1 && a === a && !isObject(a)) {
        // fast path the common case of providing an object with a single
        // property containing a primitive value
        return function(object) {
          var b = object[key];
          return a === b && (a !== 0 || (1 / a == 1 / b));
        };
      }
      return function(object) {
        var length = props.length,
            result = false;

        while (length--) {
          if (!(result = baseIsEqual(object[props[length]], func[props[length]], null, true))) {
            break;
          }
        }
        return result;
      };
    }

    /**
     * Converts the characters `&`, `<`, `>`, `"`, and `'` in `string` to their
     * corresponding HTML entities.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {string} string The string to escape.
     * @returns {string} Returns the escaped string.
     * @example
     *
     * _.escape('Fred, Wilma, & Pebbles');
     * // => 'Fred, Wilma, &amp; Pebbles'
     */
    function escape(string) {
      return string == null ? '' : String(string).replace(reUnescapedHtml, escapeHtmlChar);
    }

    /**
     * This method returns the first argument provided to it.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {*} value Any value.
     * @returns {*} Returns `value`.
     * @example
     *
     * var object = { 'name': 'fred' };
     * _.identity(object) === object;
     * // => true
     */
    function identity(value) {
      return value;
    }

    /**
     * Adds function properties of a source object to the destination object.
     * If `object` is a function methods will be added to its prototype as well.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {Function|Object} [object=lodash] object The destination object.
     * @param {Object} source The object of functions to add.
     * @param {Object} [options] The options object.
     * @param {boolean} [options.chain=true] Specify whether the functions added are chainable.
     * @example
     *
     * function capitalize(string) {
     *   return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
     * }
     *
     * _.mixin({ 'capitalize': capitalize });
     * _.capitalize('fred');
     * // => 'Fred'
     *
     * _('fred').capitalize().value();
     * // => 'Fred'
     *
     * _.mixin({ 'capitalize': capitalize }, { 'chain': false });
     * _('fred').capitalize();
     * // => 'Fred'
     */
    function mixin(object, source, options) {
      var chain = true,
          methodNames = source && functions(source);

      if (!source || (!options && !methodNames.length)) {
        if (options == null) {
          options = source;
        }
        ctor = lodashWrapper;
        source = object;
        object = lodash;
        methodNames = functions(source);
      }
      if (options === false) {
        chain = false;
      } else if (isObject(options) && 'chain' in options) {
        chain = options.chain;
      }
      var ctor = object,
          isFunc = isFunction(ctor);

      forEach(methodNames, function(methodName) {
        var func = object[methodName] = source[methodName];
        if (isFunc) {
          ctor.prototype[methodName] = function() {
            var chainAll = this.__chain__,
                value = this.__wrapped__,
                args = [value];

            push.apply(args, arguments);
            var result = func.apply(object, args);
            if (chain || chainAll) {
              if (value === result && isObject(result)) {
                return this;
              }
              result = new ctor(result);
              result.__chain__ = chainAll;
            }
            return result;
          };
        }
      });
    }

    /**
     * Reverts the '_' variable to its previous value and returns a reference to
     * the `lodash` function.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @returns {Function} Returns the `lodash` function.
     * @example
     *
     * var lodash = _.noConflict();
     */
    function noConflict() {
      context._ = oldDash;
      return this;
    }

    /**
     * A no-operation function.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @example
     *
     * var object = { 'name': 'fred' };
     * _.noop(object) === undefined;
     * // => true
     */
    function noop() {
      // no operation performed
    }

    /**
     * Gets the number of milliseconds that have elapsed since the Unix epoch
     * (1 January 1970 00:00:00 UTC).
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @example
     *
     * var stamp = _.now();
     * _.defer(function() { console.log(_.now() - stamp); });
     * // => logs the number of milliseconds it took for the deferred function to be called
     */
    var now = isNative(now = Date.now) && now || function() {
      return new Date().getTime();
    };

    /**
     * Converts the given value into an integer of the specified radix.
     * If `radix` is `undefined` or `0` a `radix` of `10` is used unless the
     * `value` is a hexadecimal, in which case a `radix` of `16` is used.
     *
     * Note: This method avoids differences in native ES3 and ES5 `parseInt`
     * implementations. See http://es5.github.io/#E.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {string} value The value to parse.
     * @param {number} [radix] The radix used to interpret the value to parse.
     * @returns {number} Returns the new integer value.
     * @example
     *
     * _.parseInt('08');
     * // => 8
     */
    var parseInt = nativeParseInt(whitespace + '08') == 8 ? nativeParseInt : function(value, radix) {
      // Firefox < 21 and Opera < 15 follow the ES3 specified implementation of `parseInt`
      return nativeParseInt(isString(value) ? value.replace(reLeadingSpacesAndZeros, '') : value, radix || 0);
    };

    /**
     * Creates a "_.pluck" style function, which returns the `key` value of a
     * given object.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {string} key The name of the property to retrieve.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var characters = [
     *   { 'name': 'fred',   'age': 40 },
     *   { 'name': 'barney', 'age': 36 }
     * ];
     *
     * var getName = _.property('name');
     *
     * _.map(characters, getName);
     * // => ['barney', 'fred']
     *
     * _.sortBy(characters, getName);
     * // => [{ 'name': 'barney', 'age': 36 }, { 'name': 'fred',   'age': 40 }]
     */
    function property(key) {
      return function(object) {
        return object[key];
      };
    }

    /**
     * Produces a random number between `min` and `max` (inclusive). If only one
     * argument is provided a number between `0` and the given number will be
     * returned. If `floating` is truey or either `min` or `max` are floats a
     * floating-point number will be returned instead of an integer.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {number} [min=0] The minimum possible value.
     * @param {number} [max=1] The maximum possible value.
     * @param {boolean} [floating=false] Specify returning a floating-point number.
     * @returns {number} Returns a random number.
     * @example
     *
     * _.random(0, 5);
     * // => an integer between 0 and 5
     *
     * _.random(5);
     * // => also an integer between 0 and 5
     *
     * _.random(5, true);
     * // => a floating-point number between 0 and 5
     *
     * _.random(1.2, 5.2);
     * // => a floating-point number between 1.2 and 5.2
     */
    function random(min, max, floating) {
      var noMin = min == null,
          noMax = max == null;

      if (floating == null) {
        if (typeof min == 'boolean' && noMax) {
          floating = min;
          min = 1;
        }
        else if (!noMax && typeof max == 'boolean') {
          floating = max;
          noMax = true;
        }
      }
      if (noMin && noMax) {
        max = 1;
      }
      min = +min || 0;
      if (noMax) {
        max = min;
        min = 0;
      } else {
        max = +max || 0;
      }
      if (floating || min % 1 || max % 1) {
        var rand = nativeRandom();
        return nativeMin(min + (rand * (max - min + parseFloat('1e-' + ((rand +'').length - 1)))), max);
      }
      return baseRandom(min, max);
    }

    /**
     * Resolves the value of property `key` on `object`. If `key` is a function
     * it will be invoked with the `this` binding of `object` and its result returned,
     * else the property value is returned. If `object` is falsey then `undefined`
     * is returned.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {Object} object The object to inspect.
     * @param {string} key The name of the property to resolve.
     * @returns {*} Returns the resolved value.
     * @example
     *
     * var object = {
     *   'cheese': 'crumpets',
     *   'stuff': function() {
     *     return 'nonsense';
     *   }
     * };
     *
     * _.result(object, 'cheese');
     * // => 'crumpets'
     *
     * _.result(object, 'stuff');
     * // => 'nonsense'
     */
    function result(object, key) {
      if (object) {
        var value = object[key];
        return isFunction(value) ? object[key]() : value;
      }
    }

    /**
     * A micro-templating method that handles arbitrary delimiters, preserves
     * whitespace, and correctly escapes quotes within interpolated code.
     *
     * Note: In the development build, `_.template` utilizes sourceURLs for easier
     * debugging. See http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl
     *
     * For more information on precompiling templates see:
     * http://lodash.com/custom-builds
     *
     * For more information on Chrome extension sandboxes see:
     * http://developer.chrome.com/stable/extensions/sandboxingEval.html
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {string} text The template text.
     * @param {Object} data The data object used to populate the text.
     * @param {Object} [options] The options object.
     * @param {RegExp} [options.escape] The "escape" delimiter.
     * @param {RegExp} [options.evaluate] The "evaluate" delimiter.
     * @param {Object} [options.imports] An object to import into the template as local variables.
     * @param {RegExp} [options.interpolate] The "interpolate" delimiter.
     * @param {string} [sourceURL] The sourceURL of the template's compiled source.
     * @param {string} [variable] The data object variable name.
     * @returns {Function|string} Returns a compiled function when no `data` object
     *  is given, else it returns the interpolated text.
     * @example
     *
     * // using the "interpolate" delimiter to create a compiled template
     * var compiled = _.template('hello <%= name %>');
     * compiled({ 'name': 'fred' });
     * // => 'hello fred'
     *
     * // using the "escape" delimiter to escape HTML in data property values
     * _.template('<b><%- value %></b>', { 'value': '<script>' });
     * // => '<b>&lt;script&gt;</b>'
     *
     * // using the "evaluate" delimiter to generate HTML
     * var list = '<% _.forEach(people, function(name) { %><li><%- name %></li><% }); %>';
     * _.template(list, { 'people': ['fred', 'barney'] });
     * // => '<li>fred</li><li>barney</li>'
     *
     * // using the ES6 delimiter as an alternative to the default "interpolate" delimiter
     * _.template('hello ${ name }', { 'name': 'pebbles' });
     * // => 'hello pebbles'
     *
     * // using the internal `print` function in "evaluate" delimiters
     * _.template('<% print("hello " + name); %>!', { 'name': 'barney' });
     * // => 'hello barney!'
     *
     * // using a custom template delimiters
     * _.templateSettings = {
     *   'interpolate': /{{([\s\S]+?)}}/g
     * };
     *
     * _.template('hello {{ name }}!', { 'name': 'mustache' });
     * // => 'hello mustache!'
     *
     * // using the `imports` option to import jQuery
     * var list = '<% jq.each(people, function(name) { %><li><%- name %></li><% }); %>';
     * _.template(list, { 'people': ['fred', 'barney'] }, { 'imports': { 'jq': jQuery } });
     * // => '<li>fred</li><li>barney</li>'
     *
     * // using the `sourceURL` option to specify a custom sourceURL for the template
     * var compiled = _.template('hello <%= name %>', null, { 'sourceURL': '/basic/greeting.jst' });
     * compiled(data);
     * // => find the source of "greeting.jst" under the Sources tab or Resources panel of the web inspector
     *
     * // using the `variable` option to ensure a with-statement isn't used in the compiled template
     * var compiled = _.template('hi <%= data.name %>!', null, { 'variable': 'data' });
     * compiled.source;
     * // => function(data) {
     *   var __t, __p = '', __e = _.escape;
     *   __p += 'hi ' + ((__t = ( data.name )) == null ? '' : __t) + '!';
     *   return __p;
     * }
     *
     * // using the `source` property to inline compiled templates for meaningful
     * // line numbers in error messages and a stack trace
     * fs.writeFileSync(path.join(cwd, 'jst.js'), '\
     *   var JST = {\
     *     "main": ' + _.template(mainText).source + '\
     *   };\
     * ');
     */
    function template(text, data, options) {
      // based on John Resig's `tmpl` implementation
      // http://ejohn.org/blog/javascript-micro-templating/
      // and Laura Doktorova's doT.js
      // https://github.com/olado/doT
      var settings = lodash.templateSettings;
      text = String(text || '');

      // avoid missing dependencies when `iteratorTemplate` is not defined
      options = defaults({}, options, settings);

      var imports = defaults({}, options.imports, settings.imports),
          importsKeys = keys(imports),
          importsValues = values(imports);

      var isEvaluating,
          index = 0,
          interpolate = options.interpolate || reNoMatch,
          source = "__p += '";

      // compile the regexp to match each delimiter
      var reDelimiters = RegExp(
        (options.escape || reNoMatch).source + '|' +
        interpolate.source + '|' +
        (interpolate === reInterpolate ? reEsTemplate : reNoMatch).source + '|' +
        (options.evaluate || reNoMatch).source + '|$'
      , 'g');

      text.replace(reDelimiters, function(match, escapeValue, interpolateValue, esTemplateValue, evaluateValue, offset) {
        interpolateValue || (interpolateValue = esTemplateValue);

        // escape characters that cannot be included in string literals
        source += text.slice(index, offset).replace(reUnescapedString, escapeStringChar);

        // replace delimiters with snippets
        if (escapeValue) {
          source += "' +\n__e(" + escapeValue + ") +\n'";
        }
        if (evaluateValue) {
          isEvaluating = true;
          source += "';\n" + evaluateValue + ";\n__p += '";
        }
        if (interpolateValue) {
          source += "' +\n((__t = (" + interpolateValue + ")) == null ? '' : __t) +\n'";
        }
        index = offset + match.length;

        // the JS engine embedded in Adobe products requires returning the `match`
        // string in order to produce the correct `offset` value
        return match;
      });

      source += "';\n";

      // if `variable` is not specified, wrap a with-statement around the generated
      // code to add the data object to the top of the scope chain
      var variable = options.variable,
          hasVariable = variable;

      if (!hasVariable) {
        variable = 'obj';
        source = 'with (' + variable + ') {\n' + source + '\n}\n';
      }
      // cleanup code by stripping empty strings
      source = (isEvaluating ? source.replace(reEmptyStringLeading, '') : source)
        .replace(reEmptyStringMiddle, '$1')
        .replace(reEmptyStringTrailing, '$1;');

      // frame code as the function body
      source = 'function(' + variable + ') {\n' +
        (hasVariable ? '' : variable + ' || (' + variable + ' = {});\n') +
        "var __t, __p = '', __e = _.escape" +
        (isEvaluating
          ? ', __j = Array.prototype.join;\n' +
            "function print() { __p += __j.call(arguments, '') }\n"
          : ';\n'
        ) +
        source +
        'return __p\n}';

      // Use a sourceURL for easier debugging.
      // http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl
      var sourceURL = '\n/*\n//# sourceURL=' + (options.sourceURL || '/lodash/template/source[' + (templateCounter++) + ']') + '\n*/';

      try {
        var result = Function(importsKeys, 'return ' + source + sourceURL).apply(undefined, importsValues);
      } catch(e) {
        e.source = source;
        throw e;
      }
      if (data) {
        return result(data);
      }
      // provide the compiled function's source by its `toString` method, in
      // supported environments, or the `source` property as a convenience for
      // inlining compiled templates during the build process
      result.source = source;
      return result;
    }

    /**
     * Executes the callback `n` times, returning an array of the results
     * of each callback execution. The callback is bound to `thisArg` and invoked
     * with one argument; (index).
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {number} n The number of times to execute the callback.
     * @param {Function} callback The function called per iteration.
     * @param {*} [thisArg] The `this` binding of `callback`.
     * @returns {Array} Returns an array of the results of each `callback` execution.
     * @example
     *
     * var diceRolls = _.times(3, _.partial(_.random, 1, 6));
     * // => [3, 6, 4]
     *
     * _.times(3, function(n) { mage.castSpell(n); });
     * // => calls `mage.castSpell(n)` three times, passing `n` of `0`, `1`, and `2` respectively
     *
     * _.times(3, function(n) { this.cast(n); }, mage);
     * // => also calls `mage.castSpell(n)` three times
     */
    function times(n, callback, thisArg) {
      n = (n = +n) > -1 ? n : 0;
      var index = -1,
          result = Array(n);

      callback = baseCreateCallback(callback, thisArg, 1);
      while (++index < n) {
        result[index] = callback(index);
      }
      return result;
    }

    /**
     * The inverse of `_.escape` this method converts the HTML entities
     * `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&#39;` in `string` to their
     * corresponding characters.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {string} string The string to unescape.
     * @returns {string} Returns the unescaped string.
     * @example
     *
     * _.unescape('Fred, Barney &amp; Pebbles');
     * // => 'Fred, Barney & Pebbles'
     */
    function unescape(string) {
      return string == null ? '' : String(string).replace(reEscapedHtml, unescapeHtmlChar);
    }

    /**
     * Generates a unique ID. If `prefix` is provided the ID will be appended to it.
     *
     * @static
     * @memberOf _
     * @category Utilities
     * @param {string} [prefix] The value to prefix the ID with.
     * @returns {string} Returns the unique ID.
     * @example
     *
     * _.uniqueId('contact_');
     * // => 'contact_104'
     *
     * _.uniqueId();
     * // => '105'
     */
    function uniqueId(prefix) {
      var id = ++idCounter;
      return String(prefix == null ? '' : prefix) + id;
    }

    /*--------------------------------------------------------------------------*/

    /**
     * Creates a `lodash` object that wraps the given value with explicit
     * method chaining enabled.
     *
     * @static
     * @memberOf _
     * @category Chaining
     * @param {*} value The value to wrap.
     * @returns {Object} Returns the wrapper object.
     * @example
     *
     * var characters = [
     *   { 'name': 'barney',  'age': 36 },
     *   { 'name': 'fred',    'age': 40 },
     *   { 'name': 'pebbles', 'age': 1 }
     * ];
     *
     * var youngest = _.chain(characters)
     *     .sortBy('age')
     *     .map(function(chr) { return chr.name + ' is ' + chr.age; })
     *     .first()
     *     .value();
     * // => 'pebbles is 1'
     */
    function chain(value) {
      value = new lodashWrapper(value);
      value.__chain__ = true;
      return value;
    }

    /**
     * Invokes `interceptor` with the `value` as the first argument and then
     * returns `value`. The purpose of this method is to "tap into" a method
     * chain in order to perform operations on intermediate results within
     * the chain.
     *
     * @static
     * @memberOf _
     * @category Chaining
     * @param {*} value The value to provide to `interceptor`.
     * @param {Function} interceptor The function to invoke.
     * @returns {*} Returns `value`.
     * @example
     *
     * _([1, 2, 3, 4])
     *  .tap(function(array) { array.pop(); })
     *  .reverse()
     *  .value();
     * // => [3, 2, 1]
     */
    function tap(value, interceptor) {
      interceptor(value);
      return value;
    }

    /**
     * Enables explicit method chaining on the wrapper object.
     *
     * @name chain
     * @memberOf _
     * @category Chaining
     * @returns {*} Returns the wrapper object.
     * @example
     *
     * var characters = [
     *   { 'name': 'barney', 'age': 36 },
     *   { 'name': 'fred',   'age': 40 }
     * ];
     *
     * // without explicit chaining
     * _(characters).first();
     * // => { 'name': 'barney', 'age': 36 }
     *
     * // with explicit chaining
     * _(characters).chain()
     *   .first()
     *   .pick('age')
     *   .value();
     * // => { 'age': 36 }
     */
    function wrapperChain() {
      this.__chain__ = true;
      return this;
    }

    /**
     * Produces the `toString` result of the wrapped value.
     *
     * @name toString
     * @memberOf _
     * @category Chaining
     * @returns {string} Returns the string result.
     * @example
     *
     * _([1, 2, 3]).toString();
     * // => '1,2,3'
     */
    function wrapperToString() {
      return String(this.__wrapped__);
    }

    /**
     * Extracts the wrapped value.
     *
     * @name valueOf
     * @memberOf _
     * @alias value
     * @category Chaining
     * @returns {*} Returns the wrapped value.
     * @example
     *
     * _([1, 2, 3]).valueOf();
     * // => [1, 2, 3]
     */
    function wrapperValueOf() {
      return this.__wrapped__;
    }

    /*--------------------------------------------------------------------------*/

    // add functions that return wrapped values when chaining
    lodash.after = after;
    lodash.assign = assign;
    lodash.at = at;
    lodash.bind = bind;
    lodash.bindAll = bindAll;
    lodash.bindKey = bindKey;
    lodash.chain = chain;
    lodash.compact = compact;
    lodash.compose = compose;
    lodash.constant = constant;
    lodash.countBy = countBy;
    lodash.create = create;
    lodash.createCallback = createCallback;
    lodash.curry = curry;
    lodash.debounce = debounce;
    lodash.defaults = defaults;
    lodash.defer = defer;
    lodash.delay = delay;
    lodash.difference = difference;
    lodash.filter = filter;
    lodash.flatten = flatten;
    lodash.forEach = forEach;
    lodash.forEachRight = forEachRight;
    lodash.forIn = forIn;
    lodash.forInRight = forInRight;
    lodash.forOwn = forOwn;
    lodash.forOwnRight = forOwnRight;
    lodash.functions = functions;
    lodash.groupBy = groupBy;
    lodash.indexBy = indexBy;
    lodash.initial = initial;
    lodash.intersection = intersection;
    lodash.invert = invert;
    lodash.invoke = invoke;
    lodash.keys = keys;
    lodash.map = map;
    lodash.mapValues = mapValues;
    lodash.max = max;
    lodash.memoize = memoize;
    lodash.merge = merge;
    lodash.min = min;
    lodash.omit = omit;
    lodash.once = once;
    lodash.pairs = pairs;
    lodash.partial = partial;
    lodash.partialRight = partialRight;
    lodash.pick = pick;
    lodash.pluck = pluck;
    lodash.property = property;
    lodash.pull = pull;
    lodash.range = range;
    lodash.reject = reject;
    lodash.remove = remove;
    lodash.rest = rest;
    lodash.shuffle = shuffle;
    lodash.sortBy = sortBy;
    lodash.tap = tap;
    lodash.throttle = throttle;
    lodash.times = times;
    lodash.toArray = toArray;
    lodash.transform = transform;
    lodash.union = union;
    lodash.uniq = uniq;
    lodash.values = values;
    lodash.where = where;
    lodash.without = without;
    lodash.wrap = wrap;
    lodash.xor = xor;
    lodash.zip = zip;
    lodash.zipObject = zipObject;

    // add aliases
    lodash.collect = map;
    lodash.drop = rest;
    lodash.each = forEach;
    lodash.eachRight = forEachRight;
    lodash.extend = assign;
    lodash.methods = functions;
    lodash.object = zipObject;
    lodash.select = filter;
    lodash.tail = rest;
    lodash.unique = uniq;
    lodash.unzip = zip;

    // add functions to `lodash.prototype`
    mixin(lodash);

    /*--------------------------------------------------------------------------*/

    // add functions that return unwrapped values when chaining
    lodash.clone = clone;
    lodash.cloneDeep = cloneDeep;
    lodash.contains = contains;
    lodash.escape = escape;
    lodash.every = every;
    lodash.find = find;
    lodash.findIndex = findIndex;
    lodash.findKey = findKey;
    lodash.findLast = findLast;
    lodash.findLastIndex = findLastIndex;
    lodash.findLastKey = findLastKey;
    lodash.has = has;
    lodash.identity = identity;
    lodash.indexOf = indexOf;
    lodash.isArguments = isArguments;
    lodash.isArray = isArray;
    lodash.isBoolean = isBoolean;
    lodash.isDate = isDate;
    lodash.isElement = isElement;
    lodash.isEmpty = isEmpty;
    lodash.isEqual = isEqual;
    lodash.isFinite = isFinite;
    lodash.isFunction = isFunction;
    lodash.isNaN = isNaN;
    lodash.isNull = isNull;
    lodash.isNumber = isNumber;
    lodash.isObject = isObject;
    lodash.isPlainObject = isPlainObject;
    lodash.isRegExp = isRegExp;
    lodash.isString = isString;
    lodash.isUndefined = isUndefined;
    lodash.lastIndexOf = lastIndexOf;
    lodash.mixin = mixin;
    lodash.noConflict = noConflict;
    lodash.noop = noop;
    lodash.now = now;
    lodash.parseInt = parseInt;
    lodash.random = random;
    lodash.reduce = reduce;
    lodash.reduceRight = reduceRight;
    lodash.result = result;
    lodash.runInContext = runInContext;
    lodash.size = size;
    lodash.some = some;
    lodash.sortedIndex = sortedIndex;
    lodash.template = template;
    lodash.unescape = unescape;
    lodash.uniqueId = uniqueId;

    // add aliases
    lodash.all = every;
    lodash.any = some;
    lodash.detect = find;
    lodash.findWhere = find;
    lodash.foldl = reduce;
    lodash.foldr = reduceRight;
    lodash.include = contains;
    lodash.inject = reduce;

    mixin(function() {
      var source = {}
      forOwn(lodash, function(func, methodName) {
        if (!lodash.prototype[methodName]) {
          source[methodName] = func;
        }
      });
      return source;
    }(), false);

    /*--------------------------------------------------------------------------*/

    // add functions capable of returning wrapped and unwrapped values when chaining
    lodash.first = first;
    lodash.last = last;
    lodash.sample = sample;

    // add aliases
    lodash.take = first;
    lodash.head = first;

    forOwn(lodash, function(func, methodName) {
      var callbackable = methodName !== 'sample';
      if (!lodash.prototype[methodName]) {
        lodash.prototype[methodName]= function(n, guard) {
          var chainAll = this.__chain__,
              result = func(this.__wrapped__, n, guard);

          return !chainAll && (n == null || (guard && !(callbackable && typeof n == 'function')))
            ? result
            : new lodashWrapper(result, chainAll);
        };
      }
    });

    /*--------------------------------------------------------------------------*/

    /**
     * The semantic version number.
     *
     * @static
     * @memberOf _
     * @type string
     */
    lodash.VERSION = '2.4.1';

    // add "Chaining" functions to the wrapper
    lodash.prototype.chain = wrapperChain;
    lodash.prototype.toString = wrapperToString;
    lodash.prototype.value = wrapperValueOf;
    lodash.prototype.valueOf = wrapperValueOf;

    // add `Array` functions that return unwrapped values
    forEach(['join', 'pop', 'shift'], function(methodName) {
      var func = arrayRef[methodName];
      lodash.prototype[methodName] = function() {
        var chainAll = this.__chain__,
            result = func.apply(this.__wrapped__, arguments);

        return chainAll
          ? new lodashWrapper(result, chainAll)
          : result;
      };
    });

    // add `Array` functions that return the existing wrapped value
    forEach(['push', 'reverse', 'sort', 'unshift'], function(methodName) {
      var func = arrayRef[methodName];
      lodash.prototype[methodName] = function() {
        func.apply(this.__wrapped__, arguments);
        return this;
      };
    });

    // add `Array` functions that return new wrapped values
    forEach(['concat', 'slice', 'splice'], function(methodName) {
      var func = arrayRef[methodName];
      lodash.prototype[methodName] = function() {
        return new lodashWrapper(func.apply(this.__wrapped__, arguments), this.__chain__);
      };
    });

    return lodash;
  }

  /*--------------------------------------------------------------------------*/

  // expose Lo-Dash
  var _ = runInContext();

  // some AMD build optimizers like r.js check for condition patterns like the following:
  if (typeof define == 'function' && typeof define.amd == 'object' && define.amd) {
    // Expose Lo-Dash to the global object even when an AMD loader is present in
    // case Lo-Dash is loaded with a RequireJS shim config.
    // See http://requirejs.org/docs/api.html#config-shim
    root._ = _;

    // define as an anonymous module so, through path mapping, it can be
    // referenced as the "underscore" module
    define(function() {
      return _;
    });
  }
  // check for `exports` after `define` in case a build optimizer adds an `exports` object
  else if (freeExports && freeModule) {
    // in Node.js or RingoJS
    if (moduleExports) {
      (freeModule.exports = _)._ = _;
    }
    // in Narwhal or Rhino -require
    else {
      freeExports._ = _;
    }
  }
  else {
    // in a browser or Rhino
    root._ = _;
  }
}.call(this));

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],777:[function(require,module,exports){
(function() {
  var Mixen, indexOf, moduleSuper, uniqueId,
    __slice = [].slice,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  indexOf = function(haystack, needle) {
    var i, stalk, _i, _len;
    for (i = _i = 0, _len = haystack.length; _i < _len; i = ++_i) {
      stalk = haystack[i];
      if (stalk === needle) {
        return i;
      }
    }
    return -1;
  };

  uniqueId = (function() {
    var id;
    id = 0;
    return function() {
      return id++;
    };
  })();

  Mixen = function() {
    return Mixen.createMixen.apply(Mixen, arguments);
  };

  Mixen.createdMixens = {};

  Mixen.createMixen = function() {
    var Inst, Last, method, mods, module, _base, _i, _len, _ref, _ref1;
    mods = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    Last = mods[mods.length - 1];
    _ref = mods.slice(0).reverse();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      module = _ref[_i];
      Inst = (function(_super) {
        __extends(Inst, _super);

        function Inst() {
          var args, mod, _j, _len1;
          args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          for (_j = 0, _len1 = mods.length; _j < _len1; _j++) {
            mod = mods[_j];
            mod.apply(this, args);
          }
        }

        return Inst;

      })(Last);
      Last = Inst;
      for (method in module.prototype) {
        Inst.prototype[method] = module.prototype[method];
      }
      _ref1 = module.prototype;
      for (method in _ref1) {
        if (!__hasProp.call(_ref1, method)) continue;
        if (method === 'constructor') {
          continue;
        }
        if (typeof module.prototype[method] !== 'function') {
          continue;
        }
        if (module.__super__ == null) {
          module.__super__ = {};
        }
        if ((_base = module.__super__)[method] == null) {
          _base[method] = moduleSuper(module, method);
        }
      }
    }
    Last.prototype._mixen_id = uniqueId();
    Mixen.createdMixens[Last.prototype._mixen_id] = mods;
    return Last;
  };

  moduleSuper = function(module, method) {
    return function() {
      var args, current, id, modules, nextModule, pos;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      current = this.constructor.prototype;
      id = null;
      while (true) {
        if (current === Object.prototype) {
          return;
        }
        id = current._mixen_id;
        if (id != null) {
          break;
        }
        current = current.constructor.__super__.constructor.prototype;
      }
      if (id == null) {
        return;
      }
      modules = Mixen.createdMixens[id];
      pos = indexOf(modules, module);
      nextModule = null;
      while (pos++ < modules.length - 1) {
        nextModule = modules[pos];
        if (nextModule.prototype[method] != null) {
          break;
        }
      }
      if ((nextModule != null) && (nextModule.prototype != null) && (nextModule.prototype[method] != null)) {
        return nextModule.prototype[method].apply(this, args);
      }
    };
  };

  if (typeof define === 'function' && define.amd) {
    define(function() {
      return Mixen;
    });
  } else if (typeof exports === 'object') {
    module.exports = Mixen;
  } else {
    window.Mixen = Mixen;
  }

}).call(this);

},{}],778:[function(require,module,exports){
(function (global){
//! moment.js
//! version : 2.6.0
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com

(function (undefined) {

    /************************************
        Constants
    ************************************/

    var moment,
        VERSION = "2.6.0",
        // the global-scope this is NOT the global object in Node.js
        globalScope = typeof global !== 'undefined' ? global : this,
        oldGlobalMoment,
        round = Math.round,
        i,

        YEAR = 0,
        MONTH = 1,
        DATE = 2,
        HOUR = 3,
        MINUTE = 4,
        SECOND = 5,
        MILLISECOND = 6,

        // internal storage for language config files
        languages = {},

        // moment internal properties
        momentProperties = {
            _isAMomentObject: null,
            _i : null,
            _f : null,
            _l : null,
            _strict : null,
            _isUTC : null,
            _offset : null,  // optional. Combine with _isUTC
            _pf : null,
            _lang : null  // optional
        },

        // check for nodeJS
        hasModule = (typeof module !== 'undefined' && module.exports),

        // ASP.NET json date format regex
        aspNetJsonRegex = /^\/?Date\((\-?\d+)/i,
        aspNetTimeSpanJsonRegex = /(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,

        // from http://docs.closure-library.googlecode.com/git/closure_goog_date_date.js.source.html
        // somewhat more in line with 4.4.3.2 2004 spec, but allows decimal anywhere
        isoDurationRegex = /^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,

        // format tokens
        formattingTokens = /(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,
        localFormattingTokens = /(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,

        // parsing token regexes
        parseTokenOneOrTwoDigits = /\d\d?/, // 0 - 99
        parseTokenOneToThreeDigits = /\d{1,3}/, // 0 - 999
        parseTokenOneToFourDigits = /\d{1,4}/, // 0 - 9999
        parseTokenOneToSixDigits = /[+\-]?\d{1,6}/, // -999,999 - 999,999
        parseTokenDigits = /\d+/, // nonzero number of digits
        parseTokenWord = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i, // any word (or two) characters or numbers including two/three word month in arabic.
        parseTokenTimezone = /Z|[\+\-]\d\d:?\d\d/gi, // +00:00 -00:00 +0000 -0000 or Z
        parseTokenT = /T/i, // T (ISO separator)
        parseTokenTimestampMs = /[\+\-]?\d+(\.\d{1,3})?/, // 123456789 123456789.123
        parseTokenOrdinal = /\d{1,2}/,

        //strict parsing regexes
        parseTokenOneDigit = /\d/, // 0 - 9
        parseTokenTwoDigits = /\d\d/, // 00 - 99
        parseTokenThreeDigits = /\d{3}/, // 000 - 999
        parseTokenFourDigits = /\d{4}/, // 0000 - 9999
        parseTokenSixDigits = /[+-]?\d{6}/, // -999,999 - 999,999
        parseTokenSignedNumber = /[+-]?\d+/, // -inf - inf

        // iso 8601 regex
        // 0000-00-00 0000-W00 or 0000-W00-0 + T + 00 or 00:00 or 00:00:00 or 00:00:00.000 + +00:00 or +0000 or +00)
        isoRegex = /^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,

        isoFormat = 'YYYY-MM-DDTHH:mm:ssZ',

        isoDates = [
            ['YYYYYY-MM-DD', /[+-]\d{6}-\d{2}-\d{2}/],
            ['YYYY-MM-DD', /\d{4}-\d{2}-\d{2}/],
            ['GGGG-[W]WW-E', /\d{4}-W\d{2}-\d/],
            ['GGGG-[W]WW', /\d{4}-W\d{2}/],
            ['YYYY-DDD', /\d{4}-\d{3}/]
        ],

        // iso time formats and regexes
        isoTimes = [
            ['HH:mm:ss.SSSS', /(T| )\d\d:\d\d:\d\d\.\d+/],
            ['HH:mm:ss', /(T| )\d\d:\d\d:\d\d/],
            ['HH:mm', /(T| )\d\d:\d\d/],
            ['HH', /(T| )\d\d/]
        ],

        // timezone chunker "+10:00" > ["10", "00"] or "-1530" > ["-15", "30"]
        parseTimezoneChunker = /([\+\-]|\d\d)/gi,

        // getter and setter names
        proxyGettersAndSetters = 'Date|Hours|Minutes|Seconds|Milliseconds'.split('|'),
        unitMillisecondFactors = {
            'Milliseconds' : 1,
            'Seconds' : 1e3,
            'Minutes' : 6e4,
            'Hours' : 36e5,
            'Days' : 864e5,
            'Months' : 2592e6,
            'Years' : 31536e6
        },

        unitAliases = {
            ms : 'millisecond',
            s : 'second',
            m : 'minute',
            h : 'hour',
            d : 'day',
            D : 'date',
            w : 'week',
            W : 'isoWeek',
            M : 'month',
            Q : 'quarter',
            y : 'year',
            DDD : 'dayOfYear',
            e : 'weekday',
            E : 'isoWeekday',
            gg: 'weekYear',
            GG: 'isoWeekYear'
        },

        camelFunctions = {
            dayofyear : 'dayOfYear',
            isoweekday : 'isoWeekday',
            isoweek : 'isoWeek',
            weekyear : 'weekYear',
            isoweekyear : 'isoWeekYear'
        },

        // format function strings
        formatFunctions = {},

        // tokens to ordinalize and pad
        ordinalizeTokens = 'DDD w W M D d'.split(' '),
        paddedTokens = 'M D H h m s w W'.split(' '),

        formatTokenFunctions = {
            M    : function () {
                return this.month() + 1;
            },
            MMM  : function (format) {
                return this.lang().monthsShort(this, format);
            },
            MMMM : function (format) {
                return this.lang().months(this, format);
            },
            D    : function () {
                return this.date();
            },
            DDD  : function () {
                return this.dayOfYear();
            },
            d    : function () {
                return this.day();
            },
            dd   : function (format) {
                return this.lang().weekdaysMin(this, format);
            },
            ddd  : function (format) {
                return this.lang().weekdaysShort(this, format);
            },
            dddd : function (format) {
                return this.lang().weekdays(this, format);
            },
            w    : function () {
                return this.week();
            },
            W    : function () {
                return this.isoWeek();
            },
            YY   : function () {
                return leftZeroFill(this.year() % 100, 2);
            },
            YYYY : function () {
                return leftZeroFill(this.year(), 4);
            },
            YYYYY : function () {
                return leftZeroFill(this.year(), 5);
            },
            YYYYYY : function () {
                var y = this.year(), sign = y >= 0 ? '+' : '-';
                return sign + leftZeroFill(Math.abs(y), 6);
            },
            gg   : function () {
                return leftZeroFill(this.weekYear() % 100, 2);
            },
            gggg : function () {
                return leftZeroFill(this.weekYear(), 4);
            },
            ggggg : function () {
                return leftZeroFill(this.weekYear(), 5);
            },
            GG   : function () {
                return leftZeroFill(this.isoWeekYear() % 100, 2);
            },
            GGGG : function () {
                return leftZeroFill(this.isoWeekYear(), 4);
            },
            GGGGG : function () {
                return leftZeroFill(this.isoWeekYear(), 5);
            },
            e : function () {
                return this.weekday();
            },
            E : function () {
                return this.isoWeekday();
            },
            a    : function () {
                return this.lang().meridiem(this.hours(), this.minutes(), true);
            },
            A    : function () {
                return this.lang().meridiem(this.hours(), this.minutes(), false);
            },
            H    : function () {
                return this.hours();
            },
            h    : function () {
                return this.hours() % 12 || 12;
            },
            m    : function () {
                return this.minutes();
            },
            s    : function () {
                return this.seconds();
            },
            S    : function () {
                return toInt(this.milliseconds() / 100);
            },
            SS   : function () {
                return leftZeroFill(toInt(this.milliseconds() / 10), 2);
            },
            SSS  : function () {
                return leftZeroFill(this.milliseconds(), 3);
            },
            SSSS : function () {
                return leftZeroFill(this.milliseconds(), 3);
            },
            Z    : function () {
                var a = -this.zone(),
                    b = "+";
                if (a < 0) {
                    a = -a;
                    b = "-";
                }
                return b + leftZeroFill(toInt(a / 60), 2) + ":" + leftZeroFill(toInt(a) % 60, 2);
            },
            ZZ   : function () {
                var a = -this.zone(),
                    b = "+";
                if (a < 0) {
                    a = -a;
                    b = "-";
                }
                return b + leftZeroFill(toInt(a / 60), 2) + leftZeroFill(toInt(a) % 60, 2);
            },
            z : function () {
                return this.zoneAbbr();
            },
            zz : function () {
                return this.zoneName();
            },
            X    : function () {
                return this.unix();
            },
            Q : function () {
                return this.quarter();
            }
        },

        lists = ['months', 'monthsShort', 'weekdays', 'weekdaysShort', 'weekdaysMin'];

    function defaultParsingFlags() {
        // We need to deep clone this object, and es5 standard is not very
        // helpful.
        return {
            empty : false,
            unusedTokens : [],
            unusedInput : [],
            overflow : -2,
            charsLeftOver : 0,
            nullInput : false,
            invalidMonth : null,
            invalidFormat : false,
            userInvalidated : false,
            iso: false
        };
    }

    function deprecate(msg, fn) {
        var firstTime = true;
        function printMsg() {
            if (moment.suppressDeprecationWarnings === false &&
                    typeof console !== 'undefined' && console.warn) {
                console.warn("Deprecation warning: " + msg);
            }
        }
        return extend(function () {
            if (firstTime) {
                printMsg();
                firstTime = false;
            }
            return fn.apply(this, arguments);
        }, fn);
    }

    function padToken(func, count) {
        return function (a) {
            return leftZeroFill(func.call(this, a), count);
        };
    }
    function ordinalizeToken(func, period) {
        return function (a) {
            return this.lang().ordinal(func.call(this, a), period);
        };
    }

    while (ordinalizeTokens.length) {
        i = ordinalizeTokens.pop();
        formatTokenFunctions[i + 'o'] = ordinalizeToken(formatTokenFunctions[i], i);
    }
    while (paddedTokens.length) {
        i = paddedTokens.pop();
        formatTokenFunctions[i + i] = padToken(formatTokenFunctions[i], 2);
    }
    formatTokenFunctions.DDDD = padToken(formatTokenFunctions.DDD, 3);


    /************************************
        Constructors
    ************************************/

    function Language() {

    }

    // Moment prototype object
    function Moment(config) {
        checkOverflow(config);
        extend(this, config);
    }

    // Duration Constructor
    function Duration(duration) {
        var normalizedInput = normalizeObjectUnits(duration),
            years = normalizedInput.year || 0,
            quarters = normalizedInput.quarter || 0,
            months = normalizedInput.month || 0,
            weeks = normalizedInput.week || 0,
            days = normalizedInput.day || 0,
            hours = normalizedInput.hour || 0,
            minutes = normalizedInput.minute || 0,
            seconds = normalizedInput.second || 0,
            milliseconds = normalizedInput.millisecond || 0;

        // representation for dateAddRemove
        this._milliseconds = +milliseconds +
            seconds * 1e3 + // 1000
            minutes * 6e4 + // 1000 * 60
            hours * 36e5; // 1000 * 60 * 60
        // Because of dateAddRemove treats 24 hours as different from a
        // day when working around DST, we need to store them separately
        this._days = +days +
            weeks * 7;
        // It is impossible translate months into days without knowing
        // which months you are are talking about, so we have to store
        // it separately.
        this._months = +months +
            quarters * 3 +
            years * 12;

        this._data = {};

        this._bubble();
    }

    /************************************
        Helpers
    ************************************/


    function extend(a, b) {
        for (var i in b) {
            if (b.hasOwnProperty(i)) {
                a[i] = b[i];
            }
        }

        if (b.hasOwnProperty("toString")) {
            a.toString = b.toString;
        }

        if (b.hasOwnProperty("valueOf")) {
            a.valueOf = b.valueOf;
        }

        return a;
    }

    function cloneMoment(m) {
        var result = {}, i;
        for (i in m) {
            if (m.hasOwnProperty(i) && momentProperties.hasOwnProperty(i)) {
                result[i] = m[i];
            }
        }

        return result;
    }

    function absRound(number) {
        if (number < 0) {
            return Math.ceil(number);
        } else {
            return Math.floor(number);
        }
    }

    // left zero fill a number
    // see http://jsperf.com/left-zero-filling for performance comparison
    function leftZeroFill(number, targetLength, forceSign) {
        var output = '' + Math.abs(number),
            sign = number >= 0;

        while (output.length < targetLength) {
            output = '0' + output;
        }
        return (sign ? (forceSign ? '+' : '') : '-') + output;
    }

    // helper function for _.addTime and _.subtractTime
    function addOrSubtractDurationFromMoment(mom, duration, isAdding, updateOffset) {
        var milliseconds = duration._milliseconds,
            days = duration._days,
            months = duration._months;
        updateOffset = updateOffset == null ? true : updateOffset;

        if (milliseconds) {
            mom._d.setTime(+mom._d + milliseconds * isAdding);
        }
        if (days) {
            rawSetter(mom, 'Date', rawGetter(mom, 'Date') + days * isAdding);
        }
        if (months) {
            rawMonthSetter(mom, rawGetter(mom, 'Month') + months * isAdding);
        }
        if (updateOffset) {
            moment.updateOffset(mom, days || months);
        }
    }

    // check if is an array
    function isArray(input) {
        return Object.prototype.toString.call(input) === '[object Array]';
    }

    function isDate(input) {
        return  Object.prototype.toString.call(input) === '[object Date]' ||
                input instanceof Date;
    }

    // compare two arrays, return the number of differences
    function compareArrays(array1, array2, dontConvert) {
        var len = Math.min(array1.length, array2.length),
            lengthDiff = Math.abs(array1.length - array2.length),
            diffs = 0,
            i;
        for (i = 0; i < len; i++) {
            if ((dontConvert && array1[i] !== array2[i]) ||
                (!dontConvert && toInt(array1[i]) !== toInt(array2[i]))) {
                diffs++;
            }
        }
        return diffs + lengthDiff;
    }

    function normalizeUnits(units) {
        if (units) {
            var lowered = units.toLowerCase().replace(/(.)s$/, '$1');
            units = unitAliases[units] || camelFunctions[lowered] || lowered;
        }
        return units;
    }

    function normalizeObjectUnits(inputObject) {
        var normalizedInput = {},
            normalizedProp,
            prop;

        for (prop in inputObject) {
            if (inputObject.hasOwnProperty(prop)) {
                normalizedProp = normalizeUnits(prop);
                if (normalizedProp) {
                    normalizedInput[normalizedProp] = inputObject[prop];
                }
            }
        }

        return normalizedInput;
    }

    function makeList(field) {
        var count, setter;

        if (field.indexOf('week') === 0) {
            count = 7;
            setter = 'day';
        }
        else if (field.indexOf('month') === 0) {
            count = 12;
            setter = 'month';
        }
        else {
            return;
        }

        moment[field] = function (format, index) {
            var i, getter,
                method = moment.fn._lang[field],
                results = [];

            if (typeof format === 'number') {
                index = format;
                format = undefined;
            }

            getter = function (i) {
                var m = moment().utc().set(setter, i);
                return method.call(moment.fn._lang, m, format || '');
            };

            if (index != null) {
                return getter(index);
            }
            else {
                for (i = 0; i < count; i++) {
                    results.push(getter(i));
                }
                return results;
            }
        };
    }

    function toInt(argumentForCoercion) {
        var coercedNumber = +argumentForCoercion,
            value = 0;

        if (coercedNumber !== 0 && isFinite(coercedNumber)) {
            if (coercedNumber >= 0) {
                value = Math.floor(coercedNumber);
            } else {
                value = Math.ceil(coercedNumber);
            }
        }

        return value;
    }

    function daysInMonth(year, month) {
        return new Date(Date.UTC(year, month + 1, 0)).getUTCDate();
    }

    function weeksInYear(year, dow, doy) {
        return weekOfYear(moment([year, 11, 31 + dow - doy]), dow, doy).week;
    }

    function daysInYear(year) {
        return isLeapYear(year) ? 366 : 365;
    }

    function isLeapYear(year) {
        return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
    }

    function checkOverflow(m) {
        var overflow;
        if (m._a && m._pf.overflow === -2) {
            overflow =
                m._a[MONTH] < 0 || m._a[MONTH] > 11 ? MONTH :
                m._a[DATE] < 1 || m._a[DATE] > daysInMonth(m._a[YEAR], m._a[MONTH]) ? DATE :
                m._a[HOUR] < 0 || m._a[HOUR] > 23 ? HOUR :
                m._a[MINUTE] < 0 || m._a[MINUTE] > 59 ? MINUTE :
                m._a[SECOND] < 0 || m._a[SECOND] > 59 ? SECOND :
                m._a[MILLISECOND] < 0 || m._a[MILLISECOND] > 999 ? MILLISECOND :
                -1;

            if (m._pf._overflowDayOfYear && (overflow < YEAR || overflow > DATE)) {
                overflow = DATE;
            }

            m._pf.overflow = overflow;
        }
    }

    function isValid(m) {
        if (m._isValid == null) {
            m._isValid = !isNaN(m._d.getTime()) &&
                m._pf.overflow < 0 &&
                !m._pf.empty &&
                !m._pf.invalidMonth &&
                !m._pf.nullInput &&
                !m._pf.invalidFormat &&
                !m._pf.userInvalidated;

            if (m._strict) {
                m._isValid = m._isValid &&
                    m._pf.charsLeftOver === 0 &&
                    m._pf.unusedTokens.length === 0;
            }
        }
        return m._isValid;
    }

    function normalizeLanguage(key) {
        return key ? key.toLowerCase().replace('_', '-') : key;
    }

    // Return a moment from input, that is local/utc/zone equivalent to model.
    function makeAs(input, model) {
        return model._isUTC ? moment(input).zone(model._offset || 0) :
            moment(input).local();
    }

    /************************************
        Languages
    ************************************/


    extend(Language.prototype, {

        set : function (config) {
            var prop, i;
            for (i in config) {
                prop = config[i];
                if (typeof prop === 'function') {
                    this[i] = prop;
                } else {
                    this['_' + i] = prop;
                }
            }
        },

        _months : "January_February_March_April_May_June_July_August_September_October_November_December".split("_"),
        months : function (m) {
            return this._months[m.month()];
        },

        _monthsShort : "Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),
        monthsShort : function (m) {
            return this._monthsShort[m.month()];
        },

        monthsParse : function (monthName) {
            var i, mom, regex;

            if (!this._monthsParse) {
                this._monthsParse = [];
            }

            for (i = 0; i < 12; i++) {
                // make the regex if we don't have it already
                if (!this._monthsParse[i]) {
                    mom = moment.utc([2000, i]);
                    regex = '^' + this.months(mom, '') + '|^' + this.monthsShort(mom, '');
                    this._monthsParse[i] = new RegExp(regex.replace('.', ''), 'i');
                }
                // test the regex
                if (this._monthsParse[i].test(monthName)) {
                    return i;
                }
            }
        },

        _weekdays : "Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),
        weekdays : function (m) {
            return this._weekdays[m.day()];
        },

        _weekdaysShort : "Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),
        weekdaysShort : function (m) {
            return this._weekdaysShort[m.day()];
        },

        _weekdaysMin : "Su_Mo_Tu_We_Th_Fr_Sa".split("_"),
        weekdaysMin : function (m) {
            return this._weekdaysMin[m.day()];
        },

        weekdaysParse : function (weekdayName) {
            var i, mom, regex;

            if (!this._weekdaysParse) {
                this._weekdaysParse = [];
            }

            for (i = 0; i < 7; i++) {
                // make the regex if we don't have it already
                if (!this._weekdaysParse[i]) {
                    mom = moment([2000, 1]).day(i);
                    regex = '^' + this.weekdays(mom, '') + '|^' + this.weekdaysShort(mom, '') + '|^' + this.weekdaysMin(mom, '');
                    this._weekdaysParse[i] = new RegExp(regex.replace('.', ''), 'i');
                }
                // test the regex
                if (this._weekdaysParse[i].test(weekdayName)) {
                    return i;
                }
            }
        },

        _longDateFormat : {
            LT : "h:mm A",
            L : "MM/DD/YYYY",
            LL : "MMMM D YYYY",
            LLL : "MMMM D YYYY LT",
            LLLL : "dddd, MMMM D YYYY LT"
        },
        longDateFormat : function (key) {
            var output = this._longDateFormat[key];
            if (!output && this._longDateFormat[key.toUpperCase()]) {
                output = this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g, function (val) {
                    return val.slice(1);
                });
                this._longDateFormat[key] = output;
            }
            return output;
        },

        isPM : function (input) {
            // IE8 Quirks Mode & IE7 Standards Mode do not allow accessing strings like arrays
            // Using charAt should be more compatible.
            return ((input + '').toLowerCase().charAt(0) === 'p');
        },

        _meridiemParse : /[ap]\.?m?\.?/i,
        meridiem : function (hours, minutes, isLower) {
            if (hours > 11) {
                return isLower ? 'pm' : 'PM';
            } else {
                return isLower ? 'am' : 'AM';
            }
        },

        _calendar : {
            sameDay : '[Today at] LT',
            nextDay : '[Tomorrow at] LT',
            nextWeek : 'dddd [at] LT',
            lastDay : '[Yesterday at] LT',
            lastWeek : '[Last] dddd [at] LT',
            sameElse : 'L'
        },
        calendar : function (key, mom) {
            var output = this._calendar[key];
            return typeof output === 'function' ? output.apply(mom) : output;
        },

        _relativeTime : {
            future : "in %s",
            past : "%s ago",
            s : "a few seconds",
            m : "a minute",
            mm : "%d minutes",
            h : "an hour",
            hh : "%d hours",
            d : "a day",
            dd : "%d days",
            M : "a month",
            MM : "%d months",
            y : "a year",
            yy : "%d years"
        },
        relativeTime : function (number, withoutSuffix, string, isFuture) {
            var output = this._relativeTime[string];
            return (typeof output === 'function') ?
                output(number, withoutSuffix, string, isFuture) :
                output.replace(/%d/i, number);
        },
        pastFuture : function (diff, output) {
            var format = this._relativeTime[diff > 0 ? 'future' : 'past'];
            return typeof format === 'function' ? format(output) : format.replace(/%s/i, output);
        },

        ordinal : function (number) {
            return this._ordinal.replace("%d", number);
        },
        _ordinal : "%d",

        preparse : function (string) {
            return string;
        },

        postformat : function (string) {
            return string;
        },

        week : function (mom) {
            return weekOfYear(mom, this._week.dow, this._week.doy).week;
        },

        _week : {
            dow : 0, // Sunday is the first day of the week.
            doy : 6  // The week that contains Jan 1st is the first week of the year.
        },

        _invalidDate: 'Invalid date',
        invalidDate: function () {
            return this._invalidDate;
        }
    });

    // Loads a language definition into the `languages` cache.  The function
    // takes a key and optionally values.  If not in the browser and no values
    // are provided, it will load the language file module.  As a convenience,
    // this function also returns the language values.
    function loadLang(key, values) {
        values.abbr = key;
        if (!languages[key]) {
            languages[key] = new Language();
        }
        languages[key].set(values);
        return languages[key];
    }

    // Remove a language from the `languages` cache. Mostly useful in tests.
    function unloadLang(key) {
        delete languages[key];
    }

    // Determines which language definition to use and returns it.
    //
    // With no parameters, it will return the global language.  If you
    // pass in a language key, such as 'en', it will return the
    // definition for 'en', so long as 'en' has already been loaded using
    // moment.lang.
    function getLangDefinition(key) {
        var i = 0, j, lang, next, split,
            get = function (k) {
                if (!languages[k] && hasModule) {
                    try {
                        require('./lang/' + k);
                    } catch (e) { }
                }
                return languages[k];
            };

        if (!key) {
            return moment.fn._lang;
        }

        if (!isArray(key)) {
            //short-circuit everything else
            lang = get(key);
            if (lang) {
                return lang;
            }
            key = [key];
        }

        //pick the language from the array
        //try ['en-au', 'en-gb'] as 'en-au', 'en-gb', 'en', as in move through the list trying each
        //substring from most specific to least, but move to the next array item if it's a more specific variant than the current root
        while (i < key.length) {
            split = normalizeLanguage(key[i]).split('-');
            j = split.length;
            next = normalizeLanguage(key[i + 1]);
            next = next ? next.split('-') : null;
            while (j > 0) {
                lang = get(split.slice(0, j).join('-'));
                if (lang) {
                    return lang;
                }
                if (next && next.length >= j && compareArrays(split, next, true) >= j - 1) {
                    //the next array item is better than a shallower substring of this one
                    break;
                }
                j--;
            }
            i++;
        }
        return moment.fn._lang;
    }

    /************************************
        Formatting
    ************************************/


    function removeFormattingTokens(input) {
        if (input.match(/\[[\s\S]/)) {
            return input.replace(/^\[|\]$/g, "");
        }
        return input.replace(/\\/g, "");
    }

    function makeFormatFunction(format) {
        var array = format.match(formattingTokens), i, length;

        for (i = 0, length = array.length; i < length; i++) {
            if (formatTokenFunctions[array[i]]) {
                array[i] = formatTokenFunctions[array[i]];
            } else {
                array[i] = removeFormattingTokens(array[i]);
            }
        }

        return function (mom) {
            var output = "";
            for (i = 0; i < length; i++) {
                output += array[i] instanceof Function ? array[i].call(mom, format) : array[i];
            }
            return output;
        };
    }

    // format date using native date object
    function formatMoment(m, format) {

        if (!m.isValid()) {
            return m.lang().invalidDate();
        }

        format = expandFormat(format, m.lang());

        if (!formatFunctions[format]) {
            formatFunctions[format] = makeFormatFunction(format);
        }

        return formatFunctions[format](m);
    }

    function expandFormat(format, lang) {
        var i = 5;

        function replaceLongDateFormatTokens(input) {
            return lang.longDateFormat(input) || input;
        }

        localFormattingTokens.lastIndex = 0;
        while (i >= 0 && localFormattingTokens.test(format)) {
            format = format.replace(localFormattingTokens, replaceLongDateFormatTokens);
            localFormattingTokens.lastIndex = 0;
            i -= 1;
        }

        return format;
    }


    /************************************
        Parsing
    ************************************/


    // get the regex to find the next token
    function getParseRegexForToken(token, config) {
        var a, strict = config._strict;
        switch (token) {
        case 'Q':
            return parseTokenOneDigit;
        case 'DDDD':
            return parseTokenThreeDigits;
        case 'YYYY':
        case 'GGGG':
        case 'gggg':
            return strict ? parseTokenFourDigits : parseTokenOneToFourDigits;
        case 'Y':
        case 'G':
        case 'g':
            return parseTokenSignedNumber;
        case 'YYYYYY':
        case 'YYYYY':
        case 'GGGGG':
        case 'ggggg':
            return strict ? parseTokenSixDigits : parseTokenOneToSixDigits;
        case 'S':
            if (strict) { return parseTokenOneDigit; }
            /* falls through */
        case 'SS':
            if (strict) { return parseTokenTwoDigits; }
            /* falls through */
        case 'SSS':
            if (strict) { return parseTokenThreeDigits; }
            /* falls through */
        case 'DDD':
            return parseTokenOneToThreeDigits;
        case 'MMM':
        case 'MMMM':
        case 'dd':
        case 'ddd':
        case 'dddd':
            return parseTokenWord;
        case 'a':
        case 'A':
            return getLangDefinition(config._l)._meridiemParse;
        case 'X':
            return parseTokenTimestampMs;
        case 'Z':
        case 'ZZ':
            return parseTokenTimezone;
        case 'T':
            return parseTokenT;
        case 'SSSS':
            return parseTokenDigits;
        case 'MM':
        case 'DD':
        case 'YY':
        case 'GG':
        case 'gg':
        case 'HH':
        case 'hh':
        case 'mm':
        case 'ss':
        case 'ww':
        case 'WW':
            return strict ? parseTokenTwoDigits : parseTokenOneOrTwoDigits;
        case 'M':
        case 'D':
        case 'd':
        case 'H':
        case 'h':
        case 'm':
        case 's':
        case 'w':
        case 'W':
        case 'e':
        case 'E':
            return parseTokenOneOrTwoDigits;
        case 'Do':
            return parseTokenOrdinal;
        default :
            a = new RegExp(regexpEscape(unescapeFormat(token.replace('\\', '')), "i"));
            return a;
        }
    }

    function timezoneMinutesFromString(string) {
        string = string || "";
        var possibleTzMatches = (string.match(parseTokenTimezone) || []),
            tzChunk = possibleTzMatches[possibleTzMatches.length - 1] || [],
            parts = (tzChunk + '').match(parseTimezoneChunker) || ['-', 0, 0],
            minutes = +(parts[1] * 60) + toInt(parts[2]);

        return parts[0] === '+' ? -minutes : minutes;
    }

    // function to convert string input to date
    function addTimeToArrayFromToken(token, input, config) {
        var a, datePartArray = config._a;

        switch (token) {
        // QUARTER
        case 'Q':
            if (input != null) {
                datePartArray[MONTH] = (toInt(input) - 1) * 3;
            }
            break;
        // MONTH
        case 'M' : // fall through to MM
        case 'MM' :
            if (input != null) {
                datePartArray[MONTH] = toInt(input) - 1;
            }
            break;
        case 'MMM' : // fall through to MMMM
        case 'MMMM' :
            a = getLangDefinition(config._l).monthsParse(input);
            // if we didn't find a month name, mark the date as invalid.
            if (a != null) {
                datePartArray[MONTH] = a;
            } else {
                config._pf.invalidMonth = input;
            }
            break;
        // DAY OF MONTH
        case 'D' : // fall through to DD
        case 'DD' :
            if (input != null) {
                datePartArray[DATE] = toInt(input);
            }
            break;
        case 'Do' :
            if (input != null) {
                datePartArray[DATE] = toInt(parseInt(input, 10));
            }
            break;
        // DAY OF YEAR
        case 'DDD' : // fall through to DDDD
        case 'DDDD' :
            if (input != null) {
                config._dayOfYear = toInt(input);
            }

            break;
        // YEAR
        case 'YY' :
            datePartArray[YEAR] = moment.parseTwoDigitYear(input);
            break;
        case 'YYYY' :
        case 'YYYYY' :
        case 'YYYYYY' :
            datePartArray[YEAR] = toInt(input);
            break;
        // AM / PM
        case 'a' : // fall through to A
        case 'A' :
            config._isPm = getLangDefinition(config._l).isPM(input);
            break;
        // 24 HOUR
        case 'H' : // fall through to hh
        case 'HH' : // fall through to hh
        case 'h' : // fall through to hh
        case 'hh' :
            datePartArray[HOUR] = toInt(input);
            break;
        // MINUTE
        case 'm' : // fall through to mm
        case 'mm' :
            datePartArray[MINUTE] = toInt(input);
            break;
        // SECOND
        case 's' : // fall through to ss
        case 'ss' :
            datePartArray[SECOND] = toInt(input);
            break;
        // MILLISECOND
        case 'S' :
        case 'SS' :
        case 'SSS' :
        case 'SSSS' :
            datePartArray[MILLISECOND] = toInt(('0.' + input) * 1000);
            break;
        // UNIX TIMESTAMP WITH MS
        case 'X':
            config._d = new Date(parseFloat(input) * 1000);
            break;
        // TIMEZONE
        case 'Z' : // fall through to ZZ
        case 'ZZ' :
            config._useUTC = true;
            config._tzm = timezoneMinutesFromString(input);
            break;
        case 'w':
        case 'ww':
        case 'W':
        case 'WW':
        case 'd':
        case 'dd':
        case 'ddd':
        case 'dddd':
        case 'e':
        case 'E':
            token = token.substr(0, 1);
            /* falls through */
        case 'gg':
        case 'gggg':
        case 'GG':
        case 'GGGG':
        case 'GGGGG':
            token = token.substr(0, 2);
            if (input) {
                config._w = config._w || {};
                config._w[token] = input;
            }
            break;
        }
    }

    // convert an array to a date.
    // the array should mirror the parameters below
    // note: all values past the year are optional and will default to the lowest possible value.
    // [year, month, day , hour, minute, second, millisecond]
    function dateFromConfig(config) {
        var i, date, input = [], currentDate,
            yearToUse, fixYear, w, temp, lang, weekday, week;

        if (config._d) {
            return;
        }

        currentDate = currentDateArray(config);

        //compute day of the year from weeks and weekdays
        if (config._w && config._a[DATE] == null && config._a[MONTH] == null) {
            fixYear = function (val) {
                var intVal = parseInt(val, 10);
                return val ?
                  (val.length < 3 ? (intVal > 68 ? 1900 + intVal : 2000 + intVal) : intVal) :
                  (config._a[YEAR] == null ? moment().weekYear() : config._a[YEAR]);
            };

            w = config._w;
            if (w.GG != null || w.W != null || w.E != null) {
                temp = dayOfYearFromWeeks(fixYear(w.GG), w.W || 1, w.E, 4, 1);
            }
            else {
                lang = getLangDefinition(config._l);
                weekday = w.d != null ?  parseWeekday(w.d, lang) :
                  (w.e != null ?  parseInt(w.e, 10) + lang._week.dow : 0);

                week = parseInt(w.w, 10) || 1;

                //if we're parsing 'd', then the low day numbers may be next week
                if (w.d != null && weekday < lang._week.dow) {
                    week++;
                }

                temp = dayOfYearFromWeeks(fixYear(w.gg), week, weekday, lang._week.doy, lang._week.dow);
            }

            config._a[YEAR] = temp.year;
            config._dayOfYear = temp.dayOfYear;
        }

        //if the day of the year is set, figure out what it is
        if (config._dayOfYear) {
            yearToUse = config._a[YEAR] == null ? currentDate[YEAR] : config._a[YEAR];

            if (config._dayOfYear > daysInYear(yearToUse)) {
                config._pf._overflowDayOfYear = true;
            }

            date = makeUTCDate(yearToUse, 0, config._dayOfYear);
            config._a[MONTH] = date.getUTCMonth();
            config._a[DATE] = date.getUTCDate();
        }

        // Default to current date.
        // * if no year, month, day of month are given, default to today
        // * if day of month is given, default month and year
        // * if month is given, default only year
        // * if year is given, don't default anything
        for (i = 0; i < 3 && config._a[i] == null; ++i) {
            config._a[i] = input[i] = currentDate[i];
        }

        // Zero out whatever was not defaulted, including time
        for (; i < 7; i++) {
            config._a[i] = input[i] = (config._a[i] == null) ? (i === 2 ? 1 : 0) : config._a[i];
        }

        // add the offsets to the time to be parsed so that we can have a clean array for checking isValid
        input[HOUR] += toInt((config._tzm || 0) / 60);
        input[MINUTE] += toInt((config._tzm || 0) % 60);

        config._d = (config._useUTC ? makeUTCDate : makeDate).apply(null, input);
    }

    function dateFromObject(config) {
        var normalizedInput;

        if (config._d) {
            return;
        }

        normalizedInput = normalizeObjectUnits(config._i);
        config._a = [
            normalizedInput.year,
            normalizedInput.month,
            normalizedInput.day,
            normalizedInput.hour,
            normalizedInput.minute,
            normalizedInput.second,
            normalizedInput.millisecond
        ];

        dateFromConfig(config);
    }

    function currentDateArray(config) {
        var now = new Date();
        if (config._useUTC) {
            return [
                now.getUTCFullYear(),
                now.getUTCMonth(),
                now.getUTCDate()
            ];
        } else {
            return [now.getFullYear(), now.getMonth(), now.getDate()];
        }
    }

    // date from string and format string
    function makeDateFromStringAndFormat(config) {

        config._a = [];
        config._pf.empty = true;

        // This array is used to make a Date, either with `new Date` or `Date.UTC`
        var lang = getLangDefinition(config._l),
            string = '' + config._i,
            i, parsedInput, tokens, token, skipped,
            stringLength = string.length,
            totalParsedInputLength = 0;

        tokens = expandFormat(config._f, lang).match(formattingTokens) || [];

        for (i = 0; i < tokens.length; i++) {
            token = tokens[i];
            parsedInput = (string.match(getParseRegexForToken(token, config)) || [])[0];
            if (parsedInput) {
                skipped = string.substr(0, string.indexOf(parsedInput));
                if (skipped.length > 0) {
                    config._pf.unusedInput.push(skipped);
                }
                string = string.slice(string.indexOf(parsedInput) + parsedInput.length);
                totalParsedInputLength += parsedInput.length;
            }
            // don't parse if it's not a known token
            if (formatTokenFunctions[token]) {
                if (parsedInput) {
                    config._pf.empty = false;
                }
                else {
                    config._pf.unusedTokens.push(token);
                }
                addTimeToArrayFromToken(token, parsedInput, config);
            }
            else if (config._strict && !parsedInput) {
                config._pf.unusedTokens.push(token);
            }
        }

        // add remaining unparsed input length to the string
        config._pf.charsLeftOver = stringLength - totalParsedInputLength;
        if (string.length > 0) {
            config._pf.unusedInput.push(string);
        }

        // handle am pm
        if (config._isPm && config._a[HOUR] < 12) {
            config._a[HOUR] += 12;
        }
        // if is 12 am, change hours to 0
        if (config._isPm === false && config._a[HOUR] === 12) {
            config._a[HOUR] = 0;
        }

        dateFromConfig(config);
        checkOverflow(config);
    }

    function unescapeFormat(s) {
        return s.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function (matched, p1, p2, p3, p4) {
            return p1 || p2 || p3 || p4;
        });
    }

    // Code from http://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript
    function regexpEscape(s) {
        return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    }

    // date from string and array of format strings
    function makeDateFromStringAndArray(config) {
        var tempConfig,
            bestMoment,

            scoreToBeat,
            i,
            currentScore;

        if (config._f.length === 0) {
            config._pf.invalidFormat = true;
            config._d = new Date(NaN);
            return;
        }

        for (i = 0; i < config._f.length; i++) {
            currentScore = 0;
            tempConfig = extend({}, config);
            tempConfig._pf = defaultParsingFlags();
            tempConfig._f = config._f[i];
            makeDateFromStringAndFormat(tempConfig);

            if (!isValid(tempConfig)) {
                continue;
            }

            // if there is any input that was not parsed add a penalty for that format
            currentScore += tempConfig._pf.charsLeftOver;

            //or tokens
            currentScore += tempConfig._pf.unusedTokens.length * 10;

            tempConfig._pf.score = currentScore;

            if (scoreToBeat == null || currentScore < scoreToBeat) {
                scoreToBeat = currentScore;
                bestMoment = tempConfig;
            }
        }

        extend(config, bestMoment || tempConfig);
    }

    // date from iso format
    function makeDateFromString(config) {
        var i, l,
            string = config._i,
            match = isoRegex.exec(string);

        if (match) {
            config._pf.iso = true;
            for (i = 0, l = isoDates.length; i < l; i++) {
                if (isoDates[i][1].exec(string)) {
                    // match[5] should be "T" or undefined
                    config._f = isoDates[i][0] + (match[6] || " ");
                    break;
                }
            }
            for (i = 0, l = isoTimes.length; i < l; i++) {
                if (isoTimes[i][1].exec(string)) {
                    config._f += isoTimes[i][0];
                    break;
                }
            }
            if (string.match(parseTokenTimezone)) {
                config._f += "Z";
            }
            makeDateFromStringAndFormat(config);
        }
        else {
            moment.createFromInputFallback(config);
        }
    }

    function makeDateFromInput(config) {
        var input = config._i,
            matched = aspNetJsonRegex.exec(input);

        if (input === undefined) {
            config._d = new Date();
        } else if (matched) {
            config._d = new Date(+matched[1]);
        } else if (typeof input === 'string') {
            makeDateFromString(config);
        } else if (isArray(input)) {
            config._a = input.slice(0);
            dateFromConfig(config);
        } else if (isDate(input)) {
            config._d = new Date(+input);
        } else if (typeof(input) === 'object') {
            dateFromObject(config);
        } else if (typeof(input) === 'number') {
            // from milliseconds
            config._d = new Date(input);
        } else {
            moment.createFromInputFallback(config);
        }
    }

    function makeDate(y, m, d, h, M, s, ms) {
        //can't just apply() to create a date:
        //http://stackoverflow.com/questions/181348/instantiating-a-javascript-object-by-calling-prototype-constructor-apply
        var date = new Date(y, m, d, h, M, s, ms);

        //the date constructor doesn't accept years < 1970
        if (y < 1970) {
            date.setFullYear(y);
        }
        return date;
    }

    function makeUTCDate(y) {
        var date = new Date(Date.UTC.apply(null, arguments));
        if (y < 1970) {
            date.setUTCFullYear(y);
        }
        return date;
    }

    function parseWeekday(input, language) {
        if (typeof input === 'string') {
            if (!isNaN(input)) {
                input = parseInt(input, 10);
            }
            else {
                input = language.weekdaysParse(input);
                if (typeof input !== 'number') {
                    return null;
                }
            }
        }
        return input;
    }

    /************************************
        Relative Time
    ************************************/


    // helper function for moment.fn.from, moment.fn.fromNow, and moment.duration.fn.humanize
    function substituteTimeAgo(string, number, withoutSuffix, isFuture, lang) {
        return lang.relativeTime(number || 1, !!withoutSuffix, string, isFuture);
    }

    function relativeTime(milliseconds, withoutSuffix, lang) {
        var seconds = round(Math.abs(milliseconds) / 1000),
            minutes = round(seconds / 60),
            hours = round(minutes / 60),
            days = round(hours / 24),
            years = round(days / 365),
            args = seconds < 45 && ['s', seconds] ||
                minutes === 1 && ['m'] ||
                minutes < 45 && ['mm', minutes] ||
                hours === 1 && ['h'] ||
                hours < 22 && ['hh', hours] ||
                days === 1 && ['d'] ||
                days <= 25 && ['dd', days] ||
                days <= 45 && ['M'] ||
                days < 345 && ['MM', round(days / 30)] ||
                years === 1 && ['y'] || ['yy', years];
        args[2] = withoutSuffix;
        args[3] = milliseconds > 0;
        args[4] = lang;
        return substituteTimeAgo.apply({}, args);
    }


    /************************************
        Week of Year
    ************************************/


    // firstDayOfWeek       0 = sun, 6 = sat
    //                      the day of the week that starts the week
    //                      (usually sunday or monday)
    // firstDayOfWeekOfYear 0 = sun, 6 = sat
    //                      the first week is the week that contains the first
    //                      of this day of the week
    //                      (eg. ISO weeks use thursday (4))
    function weekOfYear(mom, firstDayOfWeek, firstDayOfWeekOfYear) {
        var end = firstDayOfWeekOfYear - firstDayOfWeek,
            daysToDayOfWeek = firstDayOfWeekOfYear - mom.day(),
            adjustedMoment;


        if (daysToDayOfWeek > end) {
            daysToDayOfWeek -= 7;
        }

        if (daysToDayOfWeek < end - 7) {
            daysToDayOfWeek += 7;
        }

        adjustedMoment = moment(mom).add('d', daysToDayOfWeek);
        return {
            week: Math.ceil(adjustedMoment.dayOfYear() / 7),
            year: adjustedMoment.year()
        };
    }

    //http://en.wikipedia.org/wiki/ISO_week_date#Calculating_a_date_given_the_year.2C_week_number_and_weekday
    function dayOfYearFromWeeks(year, week, weekday, firstDayOfWeekOfYear, firstDayOfWeek) {
        var d = makeUTCDate(year, 0, 1).getUTCDay(), daysToAdd, dayOfYear;

        weekday = weekday != null ? weekday : firstDayOfWeek;
        daysToAdd = firstDayOfWeek - d + (d > firstDayOfWeekOfYear ? 7 : 0) - (d < firstDayOfWeek ? 7 : 0);
        dayOfYear = 7 * (week - 1) + (weekday - firstDayOfWeek) + daysToAdd + 1;

        return {
            year: dayOfYear > 0 ? year : year - 1,
            dayOfYear: dayOfYear > 0 ?  dayOfYear : daysInYear(year - 1) + dayOfYear
        };
    }

    /************************************
        Top Level Functions
    ************************************/

    function makeMoment(config) {
        var input = config._i,
            format = config._f;

        if (input === null || (format === undefined && input === '')) {
            return moment.invalid({nullInput: true});
        }

        if (typeof input === 'string') {
            config._i = input = getLangDefinition().preparse(input);
        }

        if (moment.isMoment(input)) {
            config = cloneMoment(input);

            config._d = new Date(+input._d);
        } else if (format) {
            if (isArray(format)) {
                makeDateFromStringAndArray(config);
            } else {
                makeDateFromStringAndFormat(config);
            }
        } else {
            makeDateFromInput(config);
        }

        return new Moment(config);
    }

    moment = function (input, format, lang, strict) {
        var c;

        if (typeof(lang) === "boolean") {
            strict = lang;
            lang = undefined;
        }
        // object construction must be done this way.
        // https://github.com/moment/moment/issues/1423
        c = {};
        c._isAMomentObject = true;
        c._i = input;
        c._f = format;
        c._l = lang;
        c._strict = strict;
        c._isUTC = false;
        c._pf = defaultParsingFlags();

        return makeMoment(c);
    };

    moment.suppressDeprecationWarnings = false;

    moment.createFromInputFallback = deprecate(
            "moment construction falls back to js Date. This is " +
            "discouraged and will be removed in upcoming major " +
            "release. Please refer to " +
            "https://github.com/moment/moment/issues/1407 for more info.",
            function (config) {
        config._d = new Date(config._i);
    });

    // creating with utc
    moment.utc = function (input, format, lang, strict) {
        var c;

        if (typeof(lang) === "boolean") {
            strict = lang;
            lang = undefined;
        }
        // object construction must be done this way.
        // https://github.com/moment/moment/issues/1423
        c = {};
        c._isAMomentObject = true;
        c._useUTC = true;
        c._isUTC = true;
        c._l = lang;
        c._i = input;
        c._f = format;
        c._strict = strict;
        c._pf = defaultParsingFlags();

        return makeMoment(c).utc();
    };

    // creating with unix timestamp (in seconds)
    moment.unix = function (input) {
        return moment(input * 1000);
    };

    // duration
    moment.duration = function (input, key) {
        var duration = input,
            // matching against regexp is expensive, do it on demand
            match = null,
            sign,
            ret,
            parseIso;

        if (moment.isDuration(input)) {
            duration = {
                ms: input._milliseconds,
                d: input._days,
                M: input._months
            };
        } else if (typeof input === 'number') {
            duration = {};
            if (key) {
                duration[key] = input;
            } else {
                duration.milliseconds = input;
            }
        } else if (!!(match = aspNetTimeSpanJsonRegex.exec(input))) {
            sign = (match[1] === "-") ? -1 : 1;
            duration = {
                y: 0,
                d: toInt(match[DATE]) * sign,
                h: toInt(match[HOUR]) * sign,
                m: toInt(match[MINUTE]) * sign,
                s: toInt(match[SECOND]) * sign,
                ms: toInt(match[MILLISECOND]) * sign
            };
        } else if (!!(match = isoDurationRegex.exec(input))) {
            sign = (match[1] === "-") ? -1 : 1;
            parseIso = function (inp) {
                // We'd normally use ~~inp for this, but unfortunately it also
                // converts floats to ints.
                // inp may be undefined, so careful calling replace on it.
                var res = inp && parseFloat(inp.replace(',', '.'));
                // apply sign while we're at it
                return (isNaN(res) ? 0 : res) * sign;
            };
            duration = {
                y: parseIso(match[2]),
                M: parseIso(match[3]),
                d: parseIso(match[4]),
                h: parseIso(match[5]),
                m: parseIso(match[6]),
                s: parseIso(match[7]),
                w: parseIso(match[8])
            };
        }

        ret = new Duration(duration);

        if (moment.isDuration(input) && input.hasOwnProperty('_lang')) {
            ret._lang = input._lang;
        }

        return ret;
    };

    // version number
    moment.version = VERSION;

    // default format
    moment.defaultFormat = isoFormat;

    // Plugins that add properties should also add the key here (null value),
    // so we can properly clone ourselves.
    moment.momentProperties = momentProperties;

    // This function will be called whenever a moment is mutated.
    // It is intended to keep the offset in sync with the timezone.
    moment.updateOffset = function () {};

    // This function will load languages and then set the global language.  If
    // no arguments are passed in, it will simply return the current global
    // language key.
    moment.lang = function (key, values) {
        var r;
        if (!key) {
            return moment.fn._lang._abbr;
        }
        if (values) {
            loadLang(normalizeLanguage(key), values);
        } else if (values === null) {
            unloadLang(key);
            key = 'en';
        } else if (!languages[key]) {
            getLangDefinition(key);
        }
        r = moment.duration.fn._lang = moment.fn._lang = getLangDefinition(key);
        return r._abbr;
    };

    // returns language data
    moment.langData = function (key) {
        if (key && key._lang && key._lang._abbr) {
            key = key._lang._abbr;
        }
        return getLangDefinition(key);
    };

    // compare moment object
    moment.isMoment = function (obj) {
        return obj instanceof Moment ||
            (obj != null &&  obj.hasOwnProperty('_isAMomentObject'));
    };

    // for typechecking Duration objects
    moment.isDuration = function (obj) {
        return obj instanceof Duration;
    };

    for (i = lists.length - 1; i >= 0; --i) {
        makeList(lists[i]);
    }

    moment.normalizeUnits = function (units) {
        return normalizeUnits(units);
    };

    moment.invalid = function (flags) {
        var m = moment.utc(NaN);
        if (flags != null) {
            extend(m._pf, flags);
        }
        else {
            m._pf.userInvalidated = true;
        }

        return m;
    };

    moment.parseZone = function () {
        return moment.apply(null, arguments).parseZone();
    };

    moment.parseTwoDigitYear = function (input) {
        return toInt(input) + (toInt(input) > 68 ? 1900 : 2000);
    };

    /************************************
        Moment Prototype
    ************************************/


    extend(moment.fn = Moment.prototype, {

        clone : function () {
            return moment(this);
        },

        valueOf : function () {
            return +this._d + ((this._offset || 0) * 60000);
        },

        unix : function () {
            return Math.floor(+this / 1000);
        },

        toString : function () {
            return this.clone().lang('en').format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ");
        },

        toDate : function () {
            return this._offset ? new Date(+this) : this._d;
        },

        toISOString : function () {
            var m = moment(this).utc();
            if (0 < m.year() && m.year() <= 9999) {
                return formatMoment(m, 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
            } else {
                return formatMoment(m, 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]');
            }
        },

        toArray : function () {
            var m = this;
            return [
                m.year(),
                m.month(),
                m.date(),
                m.hours(),
                m.minutes(),
                m.seconds(),
                m.milliseconds()
            ];
        },

        isValid : function () {
            return isValid(this);
        },

        isDSTShifted : function () {

            if (this._a) {
                return this.isValid() && compareArrays(this._a, (this._isUTC ? moment.utc(this._a) : moment(this._a)).toArray()) > 0;
            }

            return false;
        },

        parsingFlags : function () {
            return extend({}, this._pf);
        },

        invalidAt: function () {
            return this._pf.overflow;
        },

        utc : function () {
            return this.zone(0);
        },

        local : function () {
            this.zone(0);
            this._isUTC = false;
            return this;
        },

        format : function (inputString) {
            var output = formatMoment(this, inputString || moment.defaultFormat);
            return this.lang().postformat(output);
        },

        add : function (input, val) {
            var dur;
            // switch args to support add('s', 1) and add(1, 's')
            if (typeof input === 'string') {
                dur = moment.duration(+val, input);
            } else {
                dur = moment.duration(input, val);
            }
            addOrSubtractDurationFromMoment(this, dur, 1);
            return this;
        },

        subtract : function (input, val) {
            var dur;
            // switch args to support subtract('s', 1) and subtract(1, 's')
            if (typeof input === 'string') {
                dur = moment.duration(+val, input);
            } else {
                dur = moment.duration(input, val);
            }
            addOrSubtractDurationFromMoment(this, dur, -1);
            return this;
        },

        diff : function (input, units, asFloat) {
            var that = makeAs(input, this),
                zoneDiff = (this.zone() - that.zone()) * 6e4,
                diff, output;

            units = normalizeUnits(units);

            if (units === 'year' || units === 'month') {
                // average number of days in the months in the given dates
                diff = (this.daysInMonth() + that.daysInMonth()) * 432e5; // 24 * 60 * 60 * 1000 / 2
                // difference in months
                output = ((this.year() - that.year()) * 12) + (this.month() - that.month());
                // adjust by taking difference in days, average number of days
                // and dst in the given months.
                output += ((this - moment(this).startOf('month')) -
                        (that - moment(that).startOf('month'))) / diff;
                // same as above but with zones, to negate all dst
                output -= ((this.zone() - moment(this).startOf('month').zone()) -
                        (that.zone() - moment(that).startOf('month').zone())) * 6e4 / diff;
                if (units === 'year') {
                    output = output / 12;
                }
            } else {
                diff = (this - that);
                output = units === 'second' ? diff / 1e3 : // 1000
                    units === 'minute' ? diff / 6e4 : // 1000 * 60
                    units === 'hour' ? diff / 36e5 : // 1000 * 60 * 60
                    units === 'day' ? (diff - zoneDiff) / 864e5 : // 1000 * 60 * 60 * 24, negate dst
                    units === 'week' ? (diff - zoneDiff) / 6048e5 : // 1000 * 60 * 60 * 24 * 7, negate dst
                    diff;
            }
            return asFloat ? output : absRound(output);
        },

        from : function (time, withoutSuffix) {
            return moment.duration(this.diff(time)).lang(this.lang()._abbr).humanize(!withoutSuffix);
        },

        fromNow : function (withoutSuffix) {
            return this.from(moment(), withoutSuffix);
        },

        calendar : function () {
            // We want to compare the start of today, vs this.
            // Getting start-of-today depends on whether we're zone'd or not.
            var sod = makeAs(moment(), this).startOf('day'),
                diff = this.diff(sod, 'days', true),
                format = diff < -6 ? 'sameElse' :
                    diff < -1 ? 'lastWeek' :
                    diff < 0 ? 'lastDay' :
                    diff < 1 ? 'sameDay' :
                    diff < 2 ? 'nextDay' :
                    diff < 7 ? 'nextWeek' : 'sameElse';
            return this.format(this.lang().calendar(format, this));
        },

        isLeapYear : function () {
            return isLeapYear(this.year());
        },

        isDST : function () {
            return (this.zone() < this.clone().month(0).zone() ||
                this.zone() < this.clone().month(5).zone());
        },

        day : function (input) {
            var day = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
            if (input != null) {
                input = parseWeekday(input, this.lang());
                return this.add({ d : input - day });
            } else {
                return day;
            }
        },

        month : makeAccessor('Month', true),

        startOf: function (units) {
            units = normalizeUnits(units);
            // the following switch intentionally omits break keywords
            // to utilize falling through the cases.
            switch (units) {
            case 'year':
                this.month(0);
                /* falls through */
            case 'quarter':
            case 'month':
                this.date(1);
                /* falls through */
            case 'week':
            case 'isoWeek':
            case 'day':
                this.hours(0);
                /* falls through */
            case 'hour':
                this.minutes(0);
                /* falls through */
            case 'minute':
                this.seconds(0);
                /* falls through */
            case 'second':
                this.milliseconds(0);
                /* falls through */
            }

            // weeks are a special case
            if (units === 'week') {
                this.weekday(0);
            } else if (units === 'isoWeek') {
                this.isoWeekday(1);
            }

            // quarters are also special
            if (units === 'quarter') {
                this.month(Math.floor(this.month() / 3) * 3);
            }

            return this;
        },

        endOf: function (units) {
            units = normalizeUnits(units);
            return this.startOf(units).add((units === 'isoWeek' ? 'week' : units), 1).subtract('ms', 1);
        },

        isAfter: function (input, units) {
            units = typeof units !== 'undefined' ? units : 'millisecond';
            return +this.clone().startOf(units) > +moment(input).startOf(units);
        },

        isBefore: function (input, units) {
            units = typeof units !== 'undefined' ? units : 'millisecond';
            return +this.clone().startOf(units) < +moment(input).startOf(units);
        },

        isSame: function (input, units) {
            units = units || 'ms';
            return +this.clone().startOf(units) === +makeAs(input, this).startOf(units);
        },

        min: function (other) {
            other = moment.apply(null, arguments);
            return other < this ? this : other;
        },

        max: function (other) {
            other = moment.apply(null, arguments);
            return other > this ? this : other;
        },

        // keepTime = true means only change the timezone, without affecting
        // the local hour. So 5:31:26 +0300 --[zone(2, true)]--> 5:31:26 +0200
        // It is possible that 5:31:26 doesn't exist int zone +0200, so we
        // adjust the time as needed, to be valid.
        //
        // Keeping the time actually adds/subtracts (one hour)
        // from the actual represented time. That is why we call updateOffset
        // a second time. In case it wants us to change the offset again
        // _changeInProgress == true case, then we have to adjust, because
        // there is no such time in the given timezone.
        zone : function (input, keepTime) {
            var offset = this._offset || 0;
            if (input != null) {
                if (typeof input === "string") {
                    input = timezoneMinutesFromString(input);
                }
                if (Math.abs(input) < 16) {
                    input = input * 60;
                }
                this._offset = input;
                this._isUTC = true;
                if (offset !== input) {
                    if (!keepTime || this._changeInProgress) {
                        addOrSubtractDurationFromMoment(this,
                                moment.duration(offset - input, 'm'), 1, false);
                    } else if (!this._changeInProgress) {
                        this._changeInProgress = true;
                        moment.updateOffset(this, true);
                        this._changeInProgress = null;
                    }
                }
            } else {
                return this._isUTC ? offset : this._d.getTimezoneOffset();
            }
            return this;
        },

        zoneAbbr : function () {
            return this._isUTC ? "UTC" : "";
        },

        zoneName : function () {
            return this._isUTC ? "Coordinated Universal Time" : "";
        },

        parseZone : function () {
            if (this._tzm) {
                this.zone(this._tzm);
            } else if (typeof this._i === 'string') {
                this.zone(this._i);
            }
            return this;
        },

        hasAlignedHourOffset : function (input) {
            if (!input) {
                input = 0;
            }
            else {
                input = moment(input).zone();
            }

            return (this.zone() - input) % 60 === 0;
        },

        daysInMonth : function () {
            return daysInMonth(this.year(), this.month());
        },

        dayOfYear : function (input) {
            var dayOfYear = round((moment(this).startOf('day') - moment(this).startOf('year')) / 864e5) + 1;
            return input == null ? dayOfYear : this.add("d", (input - dayOfYear));
        },

        quarter : function (input) {
            return input == null ? Math.ceil((this.month() + 1) / 3) : this.month((input - 1) * 3 + this.month() % 3);
        },

        weekYear : function (input) {
            var year = weekOfYear(this, this.lang()._week.dow, this.lang()._week.doy).year;
            return input == null ? year : this.add("y", (input - year));
        },

        isoWeekYear : function (input) {
            var year = weekOfYear(this, 1, 4).year;
            return input == null ? year : this.add("y", (input - year));
        },

        week : function (input) {
            var week = this.lang().week(this);
            return input == null ? week : this.add("d", (input - week) * 7);
        },

        isoWeek : function (input) {
            var week = weekOfYear(this, 1, 4).week;
            return input == null ? week : this.add("d", (input - week) * 7);
        },

        weekday : function (input) {
            var weekday = (this.day() + 7 - this.lang()._week.dow) % 7;
            return input == null ? weekday : this.add("d", input - weekday);
        },

        isoWeekday : function (input) {
            // behaves the same as moment#day except
            // as a getter, returns 7 instead of 0 (1-7 range instead of 0-6)
            // as a setter, sunday should belong to the previous week.
            return input == null ? this.day() || 7 : this.day(this.day() % 7 ? input : input - 7);
        },

        isoWeeksInYear : function () {
            return weeksInYear(this.year(), 1, 4);
        },

        weeksInYear : function () {
            var weekInfo = this._lang._week;
            return weeksInYear(this.year(), weekInfo.dow, weekInfo.doy);
        },

        get : function (units) {
            units = normalizeUnits(units);
            return this[units]();
        },

        set : function (units, value) {
            units = normalizeUnits(units);
            if (typeof this[units] === 'function') {
                this[units](value);
            }
            return this;
        },

        // If passed a language key, it will set the language for this
        // instance.  Otherwise, it will return the language configuration
        // variables for this instance.
        lang : function (key) {
            if (key === undefined) {
                return this._lang;
            } else {
                this._lang = getLangDefinition(key);
                return this;
            }
        }
    });

    function rawMonthSetter(mom, value) {
        var dayOfMonth;

        // TODO: Move this out of here!
        if (typeof value === 'string') {
            value = mom.lang().monthsParse(value);
            // TODO: Another silent failure?
            if (typeof value !== 'number') {
                return mom;
            }
        }

        dayOfMonth = Math.min(mom.date(),
                daysInMonth(mom.year(), value));
        mom._d['set' + (mom._isUTC ? 'UTC' : '') + 'Month'](value, dayOfMonth);
        return mom;
    }

    function rawGetter(mom, unit) {
        return mom._d['get' + (mom._isUTC ? 'UTC' : '') + unit]();
    }

    function rawSetter(mom, unit, value) {
        if (unit === 'Month') {
            return rawMonthSetter(mom, value);
        } else {
            return mom._d['set' + (mom._isUTC ? 'UTC' : '') + unit](value);
        }
    }

    function makeAccessor(unit, keepTime) {
        return function (value) {
            if (value != null) {
                rawSetter(this, unit, value);
                moment.updateOffset(this, keepTime);
                return this;
            } else {
                return rawGetter(this, unit);
            }
        };
    }

    moment.fn.millisecond = moment.fn.milliseconds = makeAccessor('Milliseconds', false);
    moment.fn.second = moment.fn.seconds = makeAccessor('Seconds', false);
    moment.fn.minute = moment.fn.minutes = makeAccessor('Minutes', false);
    // Setting the hour should keep the time, because the user explicitly
    // specified which hour he wants. So trying to maintain the same hour (in
    // a new timezone) makes sense. Adding/subtracting hours does not follow
    // this rule.
    moment.fn.hour = moment.fn.hours = makeAccessor('Hours', true);
    // moment.fn.month is defined separately
    moment.fn.date = makeAccessor('Date', true);
    moment.fn.dates = deprecate("dates accessor is deprecated. Use date instead.", makeAccessor('Date', true));
    moment.fn.year = makeAccessor('FullYear', true);
    moment.fn.years = deprecate("years accessor is deprecated. Use year instead.", makeAccessor('FullYear', true));

    // add plural methods
    moment.fn.days = moment.fn.day;
    moment.fn.months = moment.fn.month;
    moment.fn.weeks = moment.fn.week;
    moment.fn.isoWeeks = moment.fn.isoWeek;
    moment.fn.quarters = moment.fn.quarter;

    // add aliased format methods
    moment.fn.toJSON = moment.fn.toISOString;

    /************************************
        Duration Prototype
    ************************************/


    extend(moment.duration.fn = Duration.prototype, {

        _bubble : function () {
            var milliseconds = this._milliseconds,
                days = this._days,
                months = this._months,
                data = this._data,
                seconds, minutes, hours, years;

            // The following code bubbles up values, see the tests for
            // examples of what that means.
            data.milliseconds = milliseconds % 1000;

            seconds = absRound(milliseconds / 1000);
            data.seconds = seconds % 60;

            minutes = absRound(seconds / 60);
            data.minutes = minutes % 60;

            hours = absRound(minutes / 60);
            data.hours = hours % 24;

            days += absRound(hours / 24);
            data.days = days % 30;

            months += absRound(days / 30);
            data.months = months % 12;

            years = absRound(months / 12);
            data.years = years;
        },

        weeks : function () {
            return absRound(this.days() / 7);
        },

        valueOf : function () {
            return this._milliseconds +
              this._days * 864e5 +
              (this._months % 12) * 2592e6 +
              toInt(this._months / 12) * 31536e6;
        },

        humanize : function (withSuffix) {
            var difference = +this,
                output = relativeTime(difference, !withSuffix, this.lang());

            if (withSuffix) {
                output = this.lang().pastFuture(difference, output);
            }

            return this.lang().postformat(output);
        },

        add : function (input, val) {
            // supports only 2.0-style add(1, 's') or add(moment)
            var dur = moment.duration(input, val);

            this._milliseconds += dur._milliseconds;
            this._days += dur._days;
            this._months += dur._months;

            this._bubble();

            return this;
        },

        subtract : function (input, val) {
            var dur = moment.duration(input, val);

            this._milliseconds -= dur._milliseconds;
            this._days -= dur._days;
            this._months -= dur._months;

            this._bubble();

            return this;
        },

        get : function (units) {
            units = normalizeUnits(units);
            return this[units.toLowerCase() + 's']();
        },

        as : function (units) {
            units = normalizeUnits(units);
            return this['as' + units.charAt(0).toUpperCase() + units.slice(1) + 's']();
        },

        lang : moment.fn.lang,

        toIsoString : function () {
            // inspired by https://github.com/dordille/moment-isoduration/blob/master/moment.isoduration.js
            var years = Math.abs(this.years()),
                months = Math.abs(this.months()),
                days = Math.abs(this.days()),
                hours = Math.abs(this.hours()),
                minutes = Math.abs(this.minutes()),
                seconds = Math.abs(this.seconds() + this.milliseconds() / 1000);

            if (!this.asSeconds()) {
                // this is the same as C#'s (Noda) and python (isodate)...
                // but not other JS (goog.date)
                return 'P0D';
            }

            return (this.asSeconds() < 0 ? '-' : '') +
                'P' +
                (years ? years + 'Y' : '') +
                (months ? months + 'M' : '') +
                (days ? days + 'D' : '') +
                ((hours || minutes || seconds) ? 'T' : '') +
                (hours ? hours + 'H' : '') +
                (minutes ? minutes + 'M' : '') +
                (seconds ? seconds + 'S' : '');
        }
    });

    function makeDurationGetter(name) {
        moment.duration.fn[name] = function () {
            return this._data[name];
        };
    }

    function makeDurationAsGetter(name, factor) {
        moment.duration.fn['as' + name] = function () {
            return +this / factor;
        };
    }

    for (i in unitMillisecondFactors) {
        if (unitMillisecondFactors.hasOwnProperty(i)) {
            makeDurationAsGetter(i, unitMillisecondFactors[i]);
            makeDurationGetter(i.toLowerCase());
        }
    }

    makeDurationAsGetter('Weeks', 6048e5);
    moment.duration.fn.asMonths = function () {
        return (+this - this.years() * 31536e6) / 2592e6 + this.years() * 12;
    };


    /************************************
        Default Lang
    ************************************/


    // Set default language, other languages will inherit from English.
    moment.lang('en', {
        ordinal : function (number) {
            var b = number % 10,
                output = (toInt(number % 100 / 10) === 1) ? 'th' :
                (b === 1) ? 'st' :
                (b === 2) ? 'nd' :
                (b === 3) ? 'rd' : 'th';
            return number + output;
        }
    });

    /* EMBED_LANGUAGES */

    /************************************
        Exposing Moment
    ************************************/

    function makeGlobal(shouldDeprecate) {
        /*global ender:false */
        if (typeof ender !== 'undefined') {
            return;
        }
        oldGlobalMoment = globalScope.moment;
        if (shouldDeprecate) {
            globalScope.moment = deprecate(
                    "Accessing Moment through the global scope is " +
                    "deprecated, and will be removed in an upcoming " +
                    "release.",
                    moment);
        } else {
            globalScope.moment = moment;
        }
    }

    // CommonJS module is defined
    if (hasModule) {
        module.exports = moment;
    } else if (typeof define === "function" && define.amd) {
        define("moment", function (require, exports, module) {
            if (module.config && module.config() && module.config().noGlobal === true) {
                // release the global variable
                globalScope.moment = oldGlobalMoment;
            }

            return moment;
        });
        makeGlobal(true);
    } else {
        makeGlobal();
    }
}).call(this);

}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],779:[function(require,module,exports){
(function (process){
// vim:ts=4:sts=4:sw=4:
/*!
 *
 * Copyright 2009-2012 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */

(function (definition) {
    // Turn off strict mode for this function so we can assign to global.Q
    /* jshint strict: false */

    // This file will function properly as a <script> tag, or a module
    // using CommonJS and NodeJS or RequireJS module formats.  In
    // Common/Node/RequireJS, the module exports the Q API and when
    // executed as a simple <script>, it creates a Q global instead.

    // Montage Require
    if (typeof bootstrap === "function") {
        bootstrap("promise", definition);

    // CommonJS
    } else if (typeof exports === "object") {
        module.exports = definition();

    // RequireJS
    } else if (typeof define === "function" && define.amd) {
        define(definition);

    // SES (Secure EcmaScript)
    } else if (typeof ses !== "undefined") {
        if (!ses.ok()) {
            return;
        } else {
            ses.makeQ = definition;
        }

    // <script>
    } else {
        Q = definition();
    }

})(function () {
"use strict";

var hasStacks = false;
try {
    throw new Error();
} catch (e) {
    hasStacks = !!e.stack;
}

// All code after this point will be filtered from stack traces reported
// by Q.
var qStartingLine = captureLine();
var qFileName;

// shims

// used for fallback in "allResolved"
var noop = function () {};

// Use the fastest possible means to execute a task in a future turn
// of the event loop.
var nextTick =(function () {
    // linked list of tasks (single, with head node)
    var head = {task: void 0, next: null};
    var tail = head;
    var flushing = false;
    var requestTick = void 0;
    var isNodeJS = false;

    function flush() {
        /* jshint loopfunc: true */

        while (head.next) {
            head = head.next;
            var task = head.task;
            head.task = void 0;
            var domain = head.domain;

            if (domain) {
                head.domain = void 0;
                domain.enter();
            }

            try {
                task();

            } catch (e) {
                if (isNodeJS) {
                    // In node, uncaught exceptions are considered fatal errors.
                    // Re-throw them synchronously to interrupt flushing!

                    // Ensure continuation if the uncaught exception is suppressed
                    // listening "uncaughtException" events (as domains does).
                    // Continue in next event to avoid tick recursion.
                    if (domain) {
                        domain.exit();
                    }
                    setTimeout(flush, 0);
                    if (domain) {
                        domain.enter();
                    }

                    throw e;

                } else {
                    // In browsers, uncaught exceptions are not fatal.
                    // Re-throw them asynchronously to avoid slow-downs.
                    setTimeout(function() {
                       throw e;
                    }, 0);
                }
            }

            if (domain) {
                domain.exit();
            }
        }

        flushing = false;
    }

    nextTick = function (task) {
        tail = tail.next = {
            task: task,
            domain: isNodeJS && process.domain,
            next: null
        };

        if (!flushing) {
            flushing = true;
            requestTick();
        }
    };

    if (typeof process !== "undefined" && process.nextTick) {
        // Node.js before 0.9. Note that some fake-Node environments, like the
        // Mocha test runner, introduce a `process` global without a `nextTick`.
        isNodeJS = true;

        requestTick = function () {
            process.nextTick(flush);
        };

    } else if (typeof setImmediate === "function") {
        // In IE10, Node.js 0.9+, or https://github.com/NobleJS/setImmediate
        if (typeof window !== "undefined") {
            requestTick = setImmediate.bind(window, flush);
        } else {
            requestTick = function () {
                setImmediate(flush);
            };
        }

    } else if (typeof MessageChannel !== "undefined") {
        // modern browsers
        // http://www.nonblocking.io/2011/06/windownexttick.html
        var channel = new MessageChannel();
        // At least Safari Version 6.0.5 (8536.30.1) intermittently cannot create
        // working message ports the first time a page loads.
        channel.port1.onmessage = function () {
            requestTick = requestPortTick;
            channel.port1.onmessage = flush;
            flush();
        };
        var requestPortTick = function () {
            // Opera requires us to provide a message payload, regardless of
            // whether we use it.
            channel.port2.postMessage(0);
        };
        requestTick = function () {
            setTimeout(flush, 0);
            requestPortTick();
        };

    } else {
        // old browsers
        requestTick = function () {
            setTimeout(flush, 0);
        };
    }

    return nextTick;
})();

// Attempt to make generics safe in the face of downstream
// modifications.
// There is no situation where this is necessary.
// If you need a security guarantee, these primordials need to be
// deeply frozen anyway, and if you don’t need a security guarantee,
// this is just plain paranoid.
// However, this **might** have the nice side-effect of reducing the size of
// the minified code by reducing x.call() to merely x()
// See Mark Miller’s explanation of what this does.
// http://wiki.ecmascript.org/doku.php?id=conventions:safe_meta_programming
var call = Function.call;
function uncurryThis(f) {
    return function () {
        return call.apply(f, arguments);
    };
}
// This is equivalent, but slower:
// uncurryThis = Function_bind.bind(Function_bind.call);
// http://jsperf.com/uncurrythis

var array_slice = uncurryThis(Array.prototype.slice);

var array_reduce = uncurryThis(
    Array.prototype.reduce || function (callback, basis) {
        var index = 0,
            length = this.length;
        // concerning the initial value, if one is not provided
        if (arguments.length === 1) {
            // seek to the first value in the array, accounting
            // for the possibility that is is a sparse array
            do {
                if (index in this) {
                    basis = this[index++];
                    break;
                }
                if (++index >= length) {
                    throw new TypeError();
                }
            } while (1);
        }
        // reduce
        for (; index < length; index++) {
            // account for the possibility that the array is sparse
            if (index in this) {
                basis = callback(basis, this[index], index);
            }
        }
        return basis;
    }
);

var array_indexOf = uncurryThis(
    Array.prototype.indexOf || function (value) {
        // not a very good shim, but good enough for our one use of it
        for (var i = 0; i < this.length; i++) {
            if (this[i] === value) {
                return i;
            }
        }
        return -1;
    }
);

var array_map = uncurryThis(
    Array.prototype.map || function (callback, thisp) {
        var self = this;
        var collect = [];
        array_reduce(self, function (undefined, value, index) {
            collect.push(callback.call(thisp, value, index, self));
        }, void 0);
        return collect;
    }
);

var object_create = Object.create || function (prototype) {
    function Type() { }
    Type.prototype = prototype;
    return new Type();
};

var object_hasOwnProperty = uncurryThis(Object.prototype.hasOwnProperty);

var object_keys = Object.keys || function (object) {
    var keys = [];
    for (var key in object) {
        if (object_hasOwnProperty(object, key)) {
            keys.push(key);
        }
    }
    return keys;
};

var object_toString = uncurryThis(Object.prototype.toString);

function isObject(value) {
    return value === Object(value);
}

// generator related shims

// FIXME: Remove this function once ES6 generators are in SpiderMonkey.
function isStopIteration(exception) {
    return (
        object_toString(exception) === "[object StopIteration]" ||
        exception instanceof QReturnValue
    );
}

// FIXME: Remove this helper and Q.return once ES6 generators are in
// SpiderMonkey.
var QReturnValue;
if (typeof ReturnValue !== "undefined") {
    QReturnValue = ReturnValue;
} else {
    QReturnValue = function (value) {
        this.value = value;
    };
}

// long stack traces

var STACK_JUMP_SEPARATOR = "From previous event:";

function makeStackTraceLong(error, promise) {
    // If possible, transform the error stack trace by removing Node and Q
    // cruft, then concatenating with the stack trace of `promise`. See #57.
    if (hasStacks &&
        promise.stack &&
        typeof error === "object" &&
        error !== null &&
        error.stack &&
        error.stack.indexOf(STACK_JUMP_SEPARATOR) === -1
    ) {
        var stacks = [];
        for (var p = promise; !!p; p = p.source) {
            if (p.stack) {
                stacks.unshift(p.stack);
            }
        }
        stacks.unshift(error.stack);

        var concatedStacks = stacks.join("\n" + STACK_JUMP_SEPARATOR + "\n");
        error.stack = filterStackString(concatedStacks);
    }
}

function filterStackString(stackString) {
    var lines = stackString.split("\n");
    var desiredLines = [];
    for (var i = 0; i < lines.length; ++i) {
        var line = lines[i];

        if (!isInternalFrame(line) && !isNodeFrame(line) && line) {
            desiredLines.push(line);
        }
    }
    return desiredLines.join("\n");
}

function isNodeFrame(stackLine) {
    return stackLine.indexOf("(module.js:") !== -1 ||
           stackLine.indexOf("(node.js:") !== -1;
}

function getFileNameAndLineNumber(stackLine) {
    // Named functions: "at functionName (filename:lineNumber:columnNumber)"
    // In IE10 function name can have spaces ("Anonymous function") O_o
    var attempt1 = /at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);
    if (attempt1) {
        return [attempt1[1], Number(attempt1[2])];
    }

    // Anonymous functions: "at filename:lineNumber:columnNumber"
    var attempt2 = /at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);
    if (attempt2) {
        return [attempt2[1], Number(attempt2[2])];
    }

    // Firefox style: "function@filename:lineNumber or @filename:lineNumber"
    var attempt3 = /.*@(.+):(\d+)$/.exec(stackLine);
    if (attempt3) {
        return [attempt3[1], Number(attempt3[2])];
    }
}

function isInternalFrame(stackLine) {
    var fileNameAndLineNumber = getFileNameAndLineNumber(stackLine);

    if (!fileNameAndLineNumber) {
        return false;
    }

    var fileName = fileNameAndLineNumber[0];
    var lineNumber = fileNameAndLineNumber[1];

    return fileName === qFileName &&
        lineNumber >= qStartingLine &&
        lineNumber <= qEndingLine;
}

// discover own file name and line number range for filtering stack
// traces
function captureLine() {
    if (!hasStacks) {
        return;
    }

    try {
        throw new Error();
    } catch (e) {
        var lines = e.stack.split("\n");
        var firstLine = lines[0].indexOf("@") > 0 ? lines[1] : lines[2];
        var fileNameAndLineNumber = getFileNameAndLineNumber(firstLine);
        if (!fileNameAndLineNumber) {
            return;
        }

        qFileName = fileNameAndLineNumber[0];
        return fileNameAndLineNumber[1];
    }
}

function deprecate(callback, name, alternative) {
    return function () {
        if (typeof console !== "undefined" &&
            typeof console.warn === "function") {
            console.warn(name + " is deprecated, use " + alternative +
                         " instead.", new Error("").stack);
        }
        return callback.apply(callback, arguments);
    };
}

// end of shims
// beginning of real work

/**
 * Constructs a promise for an immediate reference, passes promises through, or
 * coerces promises from different systems.
 * @param value immediate reference or promise
 */
function Q(value) {
    // If the object is already a Promise, return it directly.  This enables
    // the resolve function to both be used to created references from objects,
    // but to tolerably coerce non-promises to promises.
    if (isPromise(value)) {
        return value;
    }

    // assimilate thenables
    if (isPromiseAlike(value)) {
        return coerce(value);
    } else {
        return fulfill(value);
    }
}
Q.resolve = Q;

/**
 * Performs a task in a future turn of the event loop.
 * @param {Function} task
 */
Q.nextTick = nextTick;

/**
 * Controls whether or not long stack traces will be on
 */
Q.longStackSupport = false;

/**
 * Constructs a {promise, resolve, reject} object.
 *
 * `resolve` is a callback to invoke with a more resolved value for the
 * promise. To fulfill the promise, invoke `resolve` with any value that is
 * not a thenable. To reject the promise, invoke `resolve` with a rejected
 * thenable, or invoke `reject` with the reason directly. To resolve the
 * promise to another thenable, thus putting it in the same state, invoke
 * `resolve` with that other thenable.
 */
Q.defer = defer;
function defer() {
    // if "messages" is an "Array", that indicates that the promise has not yet
    // been resolved.  If it is "undefined", it has been resolved.  Each
    // element of the messages array is itself an array of complete arguments to
    // forward to the resolved promise.  We coerce the resolution value to a
    // promise using the `resolve` function because it handles both fully
    // non-thenable values and other thenables gracefully.
    var messages = [], progressListeners = [], resolvedPromise;

    var deferred = object_create(defer.prototype);
    var promise = object_create(Promise.prototype);

    promise.promiseDispatch = function (resolve, op, operands) {
        var args = array_slice(arguments);
        if (messages) {
            messages.push(args);
            if (op === "when" && operands[1]) { // progress operand
                progressListeners.push(operands[1]);
            }
        } else {
            nextTick(function () {
                resolvedPromise.promiseDispatch.apply(resolvedPromise, args);
            });
        }
    };

    // XXX deprecated
    promise.valueOf = function () {
        if (messages) {
            return promise;
        }
        var nearerValue = nearer(resolvedPromise);
        if (isPromise(nearerValue)) {
            resolvedPromise = nearerValue; // shorten chain
        }
        return nearerValue;
    };

    promise.inspect = function () {
        if (!resolvedPromise) {
            return { state: "pending" };
        }
        return resolvedPromise.inspect();
    };

    if (Q.longStackSupport && hasStacks) {
        try {
            throw new Error();
        } catch (e) {
            // NOTE: don't try to use `Error.captureStackTrace` or transfer the
            // accessor around; that causes memory leaks as per GH-111. Just
            // reify the stack trace as a string ASAP.
            //
            // At the same time, cut off the first line; it's always just
            // "[object Promise]\n", as per the `toString`.
            promise.stack = e.stack.substring(e.stack.indexOf("\n") + 1);
        }
    }

    // NOTE: we do the checks for `resolvedPromise` in each method, instead of
    // consolidating them into `become`, since otherwise we'd create new
    // promises with the lines `become(whatever(value))`. See e.g. GH-252.

    function become(newPromise) {
        resolvedPromise = newPromise;
        promise.source = newPromise;

        array_reduce(messages, function (undefined, message) {
            nextTick(function () {
                newPromise.promiseDispatch.apply(newPromise, message);
            });
        }, void 0);

        messages = void 0;
        progressListeners = void 0;
    }

    deferred.promise = promise;
    deferred.resolve = function (value) {
        if (resolvedPromise) {
            return;
        }

        become(Q(value));
    };

    deferred.fulfill = function (value) {
        if (resolvedPromise) {
            return;
        }

        become(fulfill(value));
    };
    deferred.reject = function (reason) {
        if (resolvedPromise) {
            return;
        }

        become(reject(reason));
    };
    deferred.notify = function (progress) {
        if (resolvedPromise) {
            return;
        }

        array_reduce(progressListeners, function (undefined, progressListener) {
            nextTick(function () {
                progressListener(progress);
            });
        }, void 0);
    };

    return deferred;
}

/**
 * Creates a Node-style callback that will resolve or reject the deferred
 * promise.
 * @returns a nodeback
 */
defer.prototype.makeNodeResolver = function () {
    var self = this;
    return function (error, value) {
        if (error) {
            self.reject(error);
        } else if (arguments.length > 2) {
            self.resolve(array_slice(arguments, 1));
        } else {
            self.resolve(value);
        }
    };
};

/**
 * @param resolver {Function} a function that returns nothing and accepts
 * the resolve, reject, and notify functions for a deferred.
 * @returns a promise that may be resolved with the given resolve and reject
 * functions, or rejected by a thrown exception in resolver
 */
Q.Promise = promise; // ES6
Q.promise = promise;
function promise(resolver) {
    if (typeof resolver !== "function") {
        throw new TypeError("resolver must be a function.");
    }
    var deferred = defer();
    try {
        resolver(deferred.resolve, deferred.reject, deferred.notify);
    } catch (reason) {
        deferred.reject(reason);
    }
    return deferred.promise;
}

promise.race = race; // ES6
promise.all = all; // ES6
promise.reject = reject; // ES6
promise.resolve = Q; // ES6

// XXX experimental.  This method is a way to denote that a local value is
// serializable and should be immediately dispatched to a remote upon request,
// instead of passing a reference.
Q.passByCopy = function (object) {
    //freeze(object);
    //passByCopies.set(object, true);
    return object;
};

Promise.prototype.passByCopy = function () {
    //freeze(object);
    //passByCopies.set(object, true);
    return this;
};

/**
 * If two promises eventually fulfill to the same value, promises that value,
 * but otherwise rejects.
 * @param x {Any*}
 * @param y {Any*}
 * @returns {Any*} a promise for x and y if they are the same, but a rejection
 * otherwise.
 *
 */
Q.join = function (x, y) {
    return Q(x).join(y);
};

Promise.prototype.join = function (that) {
    return Q([this, that]).spread(function (x, y) {
        if (x === y) {
            // TODO: "===" should be Object.is or equiv
            return x;
        } else {
            throw new Error("Can't join: not the same: " + x + " " + y);
        }
    });
};

/**
 * Returns a promise for the first of an array of promises to become fulfilled.
 * @param answers {Array[Any*]} promises to race
 * @returns {Any*} the first promise to be fulfilled
 */
Q.race = race;
function race(answerPs) {
    return promise(function(resolve, reject) {
        // Switch to this once we can assume at least ES5
        // answerPs.forEach(function(answerP) {
        //     Q(answerP).then(resolve, reject);
        // });
        // Use this in the meantime
        for (var i = 0, len = answerPs.length; i < len; i++) {
            Q(answerPs[i]).then(resolve, reject);
        }
    });
}

Promise.prototype.race = function () {
    return this.then(Q.race);
};

/**
 * Constructs a Promise with a promise descriptor object and optional fallback
 * function.  The descriptor contains methods like when(rejected), get(name),
 * set(name, value), post(name, args), and delete(name), which all
 * return either a value, a promise for a value, or a rejection.  The fallback
 * accepts the operation name, a resolver, and any further arguments that would
 * have been forwarded to the appropriate method above had a method been
 * provided with the proper name.  The API makes no guarantees about the nature
 * of the returned object, apart from that it is usable whereever promises are
 * bought and sold.
 */
Q.makePromise = Promise;
function Promise(descriptor, fallback, inspect) {
    if (fallback === void 0) {
        fallback = function (op) {
            return reject(new Error(
                "Promise does not support operation: " + op
            ));
        };
    }
    if (inspect === void 0) {
        inspect = function () {
            return {state: "unknown"};
        };
    }

    var promise = object_create(Promise.prototype);

    promise.promiseDispatch = function (resolve, op, args) {
        var result;
        try {
            if (descriptor[op]) {
                result = descriptor[op].apply(promise, args);
            } else {
                result = fallback.call(promise, op, args);
            }
        } catch (exception) {
            result = reject(exception);
        }
        if (resolve) {
            resolve(result);
        }
    };

    promise.inspect = inspect;

    // XXX deprecated `valueOf` and `exception` support
    if (inspect) {
        var inspected = inspect();
        if (inspected.state === "rejected") {
            promise.exception = inspected.reason;
        }

        promise.valueOf = function () {
            var inspected = inspect();
            if (inspected.state === "pending" ||
                inspected.state === "rejected") {
                return promise;
            }
            return inspected.value;
        };
    }

    return promise;
}

Promise.prototype.toString = function () {
    return "[object Promise]";
};

Promise.prototype.then = function (fulfilled, rejected, progressed) {
    var self = this;
    var deferred = defer();
    var done = false;   // ensure the untrusted promise makes at most a
                        // single call to one of the callbacks

    function _fulfilled(value) {
        try {
            return typeof fulfilled === "function" ? fulfilled(value) : value;
        } catch (exception) {
            return reject(exception);
        }
    }

    function _rejected(exception) {
        if (typeof rejected === "function") {
            makeStackTraceLong(exception, self);
            try {
                return rejected(exception);
            } catch (newException) {
                return reject(newException);
            }
        }
        return reject(exception);
    }

    function _progressed(value) {
        return typeof progressed === "function" ? progressed(value) : value;
    }

    nextTick(function () {
        self.promiseDispatch(function (value) {
            if (done) {
                return;
            }
            done = true;

            deferred.resolve(_fulfilled(value));
        }, "when", [function (exception) {
            if (done) {
                return;
            }
            done = true;

            deferred.resolve(_rejected(exception));
        }]);
    });

    // Progress propagator need to be attached in the current tick.
    self.promiseDispatch(void 0, "when", [void 0, function (value) {
        var newValue;
        var threw = false;
        try {
            newValue = _progressed(value);
        } catch (e) {
            threw = true;
            if (Q.onerror) {
                Q.onerror(e);
            } else {
                throw e;
            }
        }

        if (!threw) {
            deferred.notify(newValue);
        }
    }]);

    return deferred.promise;
};

/**
 * Registers an observer on a promise.
 *
 * Guarantees:
 *
 * 1. that fulfilled and rejected will be called only once.
 * 2. that either the fulfilled callback or the rejected callback will be
 *    called, but not both.
 * 3. that fulfilled and rejected will not be called in this turn.
 *
 * @param value      promise or immediate reference to observe
 * @param fulfilled  function to be called with the fulfilled value
 * @param rejected   function to be called with the rejection exception
 * @param progressed function to be called on any progress notifications
 * @return promise for the return value from the invoked callback
 */
Q.when = when;
function when(value, fulfilled, rejected, progressed) {
    return Q(value).then(fulfilled, rejected, progressed);
}

Promise.prototype.thenResolve = function (value) {
    return this.then(function () { return value; });
};

Q.thenResolve = function (promise, value) {
    return Q(promise).thenResolve(value);
};

Promise.prototype.thenReject = function (reason) {
    return this.then(function () { throw reason; });
};

Q.thenReject = function (promise, reason) {
    return Q(promise).thenReject(reason);
};

/**
 * If an object is not a promise, it is as "near" as possible.
 * If a promise is rejected, it is as "near" as possible too.
 * If it’s a fulfilled promise, the fulfillment value is nearer.
 * If it’s a deferred promise and the deferred has been resolved, the
 * resolution is "nearer".
 * @param object
 * @returns most resolved (nearest) form of the object
 */

// XXX should we re-do this?
Q.nearer = nearer;
function nearer(value) {
    if (isPromise(value)) {
        var inspected = value.inspect();
        if (inspected.state === "fulfilled") {
            return inspected.value;
        }
    }
    return value;
}

/**
 * @returns whether the given object is a promise.
 * Otherwise it is a fulfilled value.
 */
Q.isPromise = isPromise;
function isPromise(object) {
    return isObject(object) &&
        typeof object.promiseDispatch === "function" &&
        typeof object.inspect === "function";
}

Q.isPromiseAlike = isPromiseAlike;
function isPromiseAlike(object) {
    return isObject(object) && typeof object.then === "function";
}

/**
 * @returns whether the given object is a pending promise, meaning not
 * fulfilled or rejected.
 */
Q.isPending = isPending;
function isPending(object) {
    return isPromise(object) && object.inspect().state === "pending";
}

Promise.prototype.isPending = function () {
    return this.inspect().state === "pending";
};

/**
 * @returns whether the given object is a value or fulfilled
 * promise.
 */
Q.isFulfilled = isFulfilled;
function isFulfilled(object) {
    return !isPromise(object) || object.inspect().state === "fulfilled";
}

Promise.prototype.isFulfilled = function () {
    return this.inspect().state === "fulfilled";
};

/**
 * @returns whether the given object is a rejected promise.
 */
Q.isRejected = isRejected;
function isRejected(object) {
    return isPromise(object) && object.inspect().state === "rejected";
}

Promise.prototype.isRejected = function () {
    return this.inspect().state === "rejected";
};

//// BEGIN UNHANDLED REJECTION TRACKING

// This promise library consumes exceptions thrown in handlers so they can be
// handled by a subsequent promise.  The exceptions get added to this array when
// they are created, and removed when they are handled.  Note that in ES6 or
// shimmed environments, this would naturally be a `Set`.
var unhandledReasons = [];
var unhandledRejections = [];
var trackUnhandledRejections = true;

function resetUnhandledRejections() {
    unhandledReasons.length = 0;
    unhandledRejections.length = 0;

    if (!trackUnhandledRejections) {
        trackUnhandledRejections = true;
    }
}

function trackRejection(promise, reason) {
    if (!trackUnhandledRejections) {
        return;
    }

    unhandledRejections.push(promise);
    if (reason && typeof reason.stack !== "undefined") {
        unhandledReasons.push(reason.stack);
    } else {
        unhandledReasons.push("(no stack) " + reason);
    }
}

function untrackRejection(promise) {
    if (!trackUnhandledRejections) {
        return;
    }

    var at = array_indexOf(unhandledRejections, promise);
    if (at !== -1) {
        unhandledRejections.splice(at, 1);
        unhandledReasons.splice(at, 1);
    }
}

Q.resetUnhandledRejections = resetUnhandledRejections;

Q.getUnhandledReasons = function () {
    // Make a copy so that consumers can't interfere with our internal state.
    return unhandledReasons.slice();
};

Q.stopUnhandledRejectionTracking = function () {
    resetUnhandledRejections();
    trackUnhandledRejections = false;
};

resetUnhandledRejections();

//// END UNHANDLED REJECTION TRACKING

/**
 * Constructs a rejected promise.
 * @param reason value describing the failure
 */
Q.reject = reject;
function reject(reason) {
    var rejection = Promise({
        "when": function (rejected) {
            // note that the error has been handled
            if (rejected) {
                untrackRejection(this);
            }
            return rejected ? rejected(reason) : this;
        }
    }, function fallback() {
        return this;
    }, function inspect() {
        return { state: "rejected", reason: reason };
    });

    // Note that the reason has not been handled.
    trackRejection(rejection, reason);

    return rejection;
}

/**
 * Constructs a fulfilled promise for an immediate reference.
 * @param value immediate reference
 */
Q.fulfill = fulfill;
function fulfill(value) {
    return Promise({
        "when": function () {
            return value;
        },
        "get": function (name) {
            return value[name];
        },
        "set": function (name, rhs) {
            value[name] = rhs;
        },
        "delete": function (name) {
            delete value[name];
        },
        "post": function (name, args) {
            // Mark Miller proposes that post with no name should apply a
            // promised function.
            if (name === null || name === void 0) {
                return value.apply(void 0, args);
            } else {
                return value[name].apply(value, args);
            }
        },
        "apply": function (thisp, args) {
            return value.apply(thisp, args);
        },
        "keys": function () {
            return object_keys(value);
        }
    }, void 0, function inspect() {
        return { state: "fulfilled", value: value };
    });
}

/**
 * Converts thenables to Q promises.
 * @param promise thenable promise
 * @returns a Q promise
 */
function coerce(promise) {
    var deferred = defer();
    nextTick(function () {
        try {
            promise.then(deferred.resolve, deferred.reject, deferred.notify);
        } catch (exception) {
            deferred.reject(exception);
        }
    });
    return deferred.promise;
}

/**
 * Annotates an object such that it will never be
 * transferred away from this process over any promise
 * communication channel.
 * @param object
 * @returns promise a wrapping of that object that
 * additionally responds to the "isDef" message
 * without a rejection.
 */
Q.master = master;
function master(object) {
    return Promise({
        "isDef": function () {}
    }, function fallback(op, args) {
        return dispatch(object, op, args);
    }, function () {
        return Q(object).inspect();
    });
}

/**
 * Spreads the values of a promised array of arguments into the
 * fulfillment callback.
 * @param fulfilled callback that receives variadic arguments from the
 * promised array
 * @param rejected callback that receives the exception if the promise
 * is rejected.
 * @returns a promise for the return value or thrown exception of
 * either callback.
 */
Q.spread = spread;
function spread(value, fulfilled, rejected) {
    return Q(value).spread(fulfilled, rejected);
}

Promise.prototype.spread = function (fulfilled, rejected) {
    return this.all().then(function (array) {
        return fulfilled.apply(void 0, array);
    }, rejected);
};

/**
 * The async function is a decorator for generator functions, turning
 * them into asynchronous generators.  Although generators are only part
 * of the newest ECMAScript 6 drafts, this code does not cause syntax
 * errors in older engines.  This code should continue to work and will
 * in fact improve over time as the language improves.
 *
 * ES6 generators are currently part of V8 version 3.19 with the
 * --harmony-generators runtime flag enabled.  SpiderMonkey has had them
 * for longer, but under an older Python-inspired form.  This function
 * works on both kinds of generators.
 *
 * Decorates a generator function such that:
 *  - it may yield promises
 *  - execution will continue when that promise is fulfilled
 *  - the value of the yield expression will be the fulfilled value
 *  - it returns a promise for the return value (when the generator
 *    stops iterating)
 *  - the decorated function returns a promise for the return value
 *    of the generator or the first rejected promise among those
 *    yielded.
 *  - if an error is thrown in the generator, it propagates through
 *    every following yield until it is caught, or until it escapes
 *    the generator function altogether, and is translated into a
 *    rejection for the promise returned by the decorated generator.
 */
Q.async = async;
function async(makeGenerator) {
    return function () {
        // when verb is "send", arg is a value
        // when verb is "throw", arg is an exception
        function continuer(verb, arg) {
            var result;

            // Until V8 3.19 / Chromium 29 is released, SpiderMonkey is the only
            // engine that has a deployed base of browsers that support generators.
            // However, SM's generators use the Python-inspired semantics of
            // outdated ES6 drafts.  We would like to support ES6, but we'd also
            // like to make it possible to use generators in deployed browsers, so
            // we also support Python-style generators.  At some point we can remove
            // this block.

            if (typeof StopIteration === "undefined") {
                // ES6 Generators
                try {
                    result = generator[verb](arg);
                } catch (exception) {
                    return reject(exception);
                }
                if (result.done) {
                    return result.value;
                } else {
                    return when(result.value, callback, errback);
                }
            } else {
                // SpiderMonkey Generators
                // FIXME: Remove this case when SM does ES6 generators.
                try {
                    result = generator[verb](arg);
                } catch (exception) {
                    if (isStopIteration(exception)) {
                        return exception.value;
                    } else {
                        return reject(exception);
                    }
                }
                return when(result, callback, errback);
            }
        }
        var generator = makeGenerator.apply(this, arguments);
        var callback = continuer.bind(continuer, "next");
        var errback = continuer.bind(continuer, "throw");
        return callback();
    };
}

/**
 * The spawn function is a small wrapper around async that immediately
 * calls the generator and also ends the promise chain, so that any
 * unhandled errors are thrown instead of forwarded to the error
 * handler. This is useful because it's extremely common to run
 * generators at the top-level to work with libraries.
 */
Q.spawn = spawn;
function spawn(makeGenerator) {
    Q.done(Q.async(makeGenerator)());
}

// FIXME: Remove this interface once ES6 generators are in SpiderMonkey.
/**
 * Throws a ReturnValue exception to stop an asynchronous generator.
 *
 * This interface is a stop-gap measure to support generator return
 * values in older Firefox/SpiderMonkey.  In browsers that support ES6
 * generators like Chromium 29, just use "return" in your generator
 * functions.
 *
 * @param value the return value for the surrounding generator
 * @throws ReturnValue exception with the value.
 * @example
 * // ES6 style
 * Q.async(function* () {
 *      var foo = yield getFooPromise();
 *      var bar = yield getBarPromise();
 *      return foo + bar;
 * })
 * // Older SpiderMonkey style
 * Q.async(function () {
 *      var foo = yield getFooPromise();
 *      var bar = yield getBarPromise();
 *      Q.return(foo + bar);
 * })
 */
Q["return"] = _return;
function _return(value) {
    throw new QReturnValue(value);
}

/**
 * The promised function decorator ensures that any promise arguments
 * are settled and passed as values (`this` is also settled and passed
 * as a value).  It will also ensure that the result of a function is
 * always a promise.
 *
 * @example
 * var add = Q.promised(function (a, b) {
 *     return a + b;
 * });
 * add(Q(a), Q(B));
 *
 * @param {function} callback The function to decorate
 * @returns {function} a function that has been decorated.
 */
Q.promised = promised;
function promised(callback) {
    return function () {
        return spread([this, all(arguments)], function (self, args) {
            return callback.apply(self, args);
        });
    };
}

/**
 * sends a message to a value in a future turn
 * @param object* the recipient
 * @param op the name of the message operation, e.g., "when",
 * @param args further arguments to be forwarded to the operation
 * @returns result {Promise} a promise for the result of the operation
 */
Q.dispatch = dispatch;
function dispatch(object, op, args) {
    return Q(object).dispatch(op, args);
}

Promise.prototype.dispatch = function (op, args) {
    var self = this;
    var deferred = defer();
    nextTick(function () {
        self.promiseDispatch(deferred.resolve, op, args);
    });
    return deferred.promise;
};

/**
 * Gets the value of a property in a future turn.
 * @param object    promise or immediate reference for target object
 * @param name      name of property to get
 * @return promise for the property value
 */
Q.get = function (object, key) {
    return Q(object).dispatch("get", [key]);
};

Promise.prototype.get = function (key) {
    return this.dispatch("get", [key]);
};

/**
 * Sets the value of a property in a future turn.
 * @param object    promise or immediate reference for object object
 * @param name      name of property to set
 * @param value     new value of property
 * @return promise for the return value
 */
Q.set = function (object, key, value) {
    return Q(object).dispatch("set", [key, value]);
};

Promise.prototype.set = function (key, value) {
    return this.dispatch("set", [key, value]);
};

/**
 * Deletes a property in a future turn.
 * @param object    promise or immediate reference for target object
 * @param name      name of property to delete
 * @return promise for the return value
 */
Q.del = // XXX legacy
Q["delete"] = function (object, key) {
    return Q(object).dispatch("delete", [key]);
};

Promise.prototype.del = // XXX legacy
Promise.prototype["delete"] = function (key) {
    return this.dispatch("delete", [key]);
};

/**
 * Invokes a method in a future turn.
 * @param object    promise or immediate reference for target object
 * @param name      name of method to invoke
 * @param value     a value to post, typically an array of
 *                  invocation arguments for promises that
 *                  are ultimately backed with `resolve` values,
 *                  as opposed to those backed with URLs
 *                  wherein the posted value can be any
 *                  JSON serializable object.
 * @return promise for the return value
 */
// bound locally because it is used by other methods
Q.mapply = // XXX As proposed by "Redsandro"
Q.post = function (object, name, args) {
    return Q(object).dispatch("post", [name, args]);
};

Promise.prototype.mapply = // XXX As proposed by "Redsandro"
Promise.prototype.post = function (name, args) {
    return this.dispatch("post", [name, args]);
};

/**
 * Invokes a method in a future turn.
 * @param object    promise or immediate reference for target object
 * @param name      name of method to invoke
 * @param ...args   array of invocation arguments
 * @return promise for the return value
 */
Q.send = // XXX Mark Miller's proposed parlance
Q.mcall = // XXX As proposed by "Redsandro"
Q.invoke = function (object, name /*...args*/) {
    return Q(object).dispatch("post", [name, array_slice(arguments, 2)]);
};

Promise.prototype.send = // XXX Mark Miller's proposed parlance
Promise.prototype.mcall = // XXX As proposed by "Redsandro"
Promise.prototype.invoke = function (name /*...args*/) {
    return this.dispatch("post", [name, array_slice(arguments, 1)]);
};

/**
 * Applies the promised function in a future turn.
 * @param object    promise or immediate reference for target function
 * @param args      array of application arguments
 */
Q.fapply = function (object, args) {
    return Q(object).dispatch("apply", [void 0, args]);
};

Promise.prototype.fapply = function (args) {
    return this.dispatch("apply", [void 0, args]);
};

/**
 * Calls the promised function in a future turn.
 * @param object    promise or immediate reference for target function
 * @param ...args   array of application arguments
 */
Q["try"] =
Q.fcall = function (object /* ...args*/) {
    return Q(object).dispatch("apply", [void 0, array_slice(arguments, 1)]);
};

Promise.prototype.fcall = function (/*...args*/) {
    return this.dispatch("apply", [void 0, array_slice(arguments)]);
};

/**
 * Binds the promised function, transforming return values into a fulfilled
 * promise and thrown errors into a rejected one.
 * @param object    promise or immediate reference for target function
 * @param ...args   array of application arguments
 */
Q.fbind = function (object /*...args*/) {
    var promise = Q(object);
    var args = array_slice(arguments, 1);
    return function fbound() {
        return promise.dispatch("apply", [
            this,
            args.concat(array_slice(arguments))
        ]);
    };
};
Promise.prototype.fbind = function (/*...args*/) {
    var promise = this;
    var args = array_slice(arguments);
    return function fbound() {
        return promise.dispatch("apply", [
            this,
            args.concat(array_slice(arguments))
        ]);
    };
};

/**
 * Requests the names of the owned properties of a promised
 * object in a future turn.
 * @param object    promise or immediate reference for target object
 * @return promise for the keys of the eventually settled object
 */
Q.keys = function (object) {
    return Q(object).dispatch("keys", []);
};

Promise.prototype.keys = function () {
    return this.dispatch("keys", []);
};

/**
 * Turns an array of promises into a promise for an array.  If any of
 * the promises gets rejected, the whole array is rejected immediately.
 * @param {Array*} an array (or promise for an array) of values (or
 * promises for values)
 * @returns a promise for an array of the corresponding values
 */
// By Mark Miller
// http://wiki.ecmascript.org/doku.php?id=strawman:concurrency&rev=1308776521#allfulfilled
Q.all = all;
function all(promises) {
    return when(promises, function (promises) {
        var countDown = 0;
        var deferred = defer();
        array_reduce(promises, function (undefined, promise, index) {
            var snapshot;
            if (
                isPromise(promise) &&
                (snapshot = promise.inspect()).state === "fulfilled"
            ) {
                promises[index] = snapshot.value;
            } else {
                ++countDown;
                when(
                    promise,
                    function (value) {
                        promises[index] = value;
                        if (--countDown === 0) {
                            deferred.resolve(promises);
                        }
                    },
                    deferred.reject,
                    function (progress) {
                        deferred.notify({ index: index, value: progress });
                    }
                );
            }
        }, void 0);
        if (countDown === 0) {
            deferred.resolve(promises);
        }
        return deferred.promise;
    });
}

Promise.prototype.all = function () {
    return all(this);
};

/**
 * Waits for all promises to be settled, either fulfilled or
 * rejected.  This is distinct from `all` since that would stop
 * waiting at the first rejection.  The promise returned by
 * `allResolved` will never be rejected.
 * @param promises a promise for an array (or an array) of promises
 * (or values)
 * @return a promise for an array of promises
 */
Q.allResolved = deprecate(allResolved, "allResolved", "allSettled");
function allResolved(promises) {
    return when(promises, function (promises) {
        promises = array_map(promises, Q);
        return when(all(array_map(promises, function (promise) {
            return when(promise, noop, noop);
        })), function () {
            return promises;
        });
    });
}

Promise.prototype.allResolved = function () {
    return allResolved(this);
};

/**
 * @see Promise#allSettled
 */
Q.allSettled = allSettled;
function allSettled(promises) {
    return Q(promises).allSettled();
}

/**
 * Turns an array of promises into a promise for an array of their states (as
 * returned by `inspect`) when they have all settled.
 * @param {Array[Any*]} values an array (or promise for an array) of values (or
 * promises for values)
 * @returns {Array[State]} an array of states for the respective values.
 */
Promise.prototype.allSettled = function () {
    return this.then(function (promises) {
        return all(array_map(promises, function (promise) {
            promise = Q(promise);
            function regardless() {
                return promise.inspect();
            }
            return promise.then(regardless, regardless);
        }));
    });
};

/**
 * Captures the failure of a promise, giving an oportunity to recover
 * with a callback.  If the given promise is fulfilled, the returned
 * promise is fulfilled.
 * @param {Any*} promise for something
 * @param {Function} callback to fulfill the returned promise if the
 * given promise is rejected
 * @returns a promise for the return value of the callback
 */
Q.fail = // XXX legacy
Q["catch"] = function (object, rejected) {
    return Q(object).then(void 0, rejected);
};

Promise.prototype.fail = // XXX legacy
Promise.prototype["catch"] = function (rejected) {
    return this.then(void 0, rejected);
};

/**
 * Attaches a listener that can respond to progress notifications from a
 * promise's originating deferred. This listener receives the exact arguments
 * passed to ``deferred.notify``.
 * @param {Any*} promise for something
 * @param {Function} callback to receive any progress notifications
 * @returns the given promise, unchanged
 */
Q.progress = progress;
function progress(object, progressed) {
    return Q(object).then(void 0, void 0, progressed);
}

Promise.prototype.progress = function (progressed) {
    return this.then(void 0, void 0, progressed);
};

/**
 * Provides an opportunity to observe the settling of a promise,
 * regardless of whether the promise is fulfilled or rejected.  Forwards
 * the resolution to the returned promise when the callback is done.
 * The callback can return a promise to defer completion.
 * @param {Any*} promise
 * @param {Function} callback to observe the resolution of the given
 * promise, takes no arguments.
 * @returns a promise for the resolution of the given promise when
 * ``fin`` is done.
 */
Q.fin = // XXX legacy
Q["finally"] = function (object, callback) {
    return Q(object)["finally"](callback);
};

Promise.prototype.fin = // XXX legacy
Promise.prototype["finally"] = function (callback) {
    callback = Q(callback);
    return this.then(function (value) {
        return callback.fcall().then(function () {
            return value;
        });
    }, function (reason) {
        // TODO attempt to recycle the rejection with "this".
        return callback.fcall().then(function () {
            throw reason;
        });
    });
};

/**
 * Terminates a chain of promises, forcing rejections to be
 * thrown as exceptions.
 * @param {Any*} promise at the end of a chain of promises
 * @returns nothing
 */
Q.done = function (object, fulfilled, rejected, progress) {
    return Q(object).done(fulfilled, rejected, progress);
};

Promise.prototype.done = function (fulfilled, rejected, progress) {
    var onUnhandledError = function (error) {
        // forward to a future turn so that ``when``
        // does not catch it and turn it into a rejection.
        nextTick(function () {
            makeStackTraceLong(error, promise);
            if (Q.onerror) {
                Q.onerror(error);
            } else {
                throw error;
            }
        });
    };

    // Avoid unnecessary `nextTick`ing via an unnecessary `when`.
    var promise = fulfilled || rejected || progress ?
        this.then(fulfilled, rejected, progress) :
        this;

    if (typeof process === "object" && process && process.domain) {
        onUnhandledError = process.domain.bind(onUnhandledError);
    }

    promise.then(void 0, onUnhandledError);
};

/**
 * Causes a promise to be rejected if it does not get fulfilled before
 * some milliseconds time out.
 * @param {Any*} promise
 * @param {Number} milliseconds timeout
 * @param {String} custom error message (optional)
 * @returns a promise for the resolution of the given promise if it is
 * fulfilled before the timeout, otherwise rejected.
 */
Q.timeout = function (object, ms, message) {
    return Q(object).timeout(ms, message);
};

Promise.prototype.timeout = function (ms, message) {
    var deferred = defer();
    var timeoutId = setTimeout(function () {
        deferred.reject(new Error(message || "Timed out after " + ms + " ms"));
    }, ms);

    this.then(function (value) {
        clearTimeout(timeoutId);
        deferred.resolve(value);
    }, function (exception) {
        clearTimeout(timeoutId);
        deferred.reject(exception);
    }, deferred.notify);

    return deferred.promise;
};

/**
 * Returns a promise for the given value (or promised value), some
 * milliseconds after it resolved. Passes rejections immediately.
 * @param {Any*} promise
 * @param {Number} milliseconds
 * @returns a promise for the resolution of the given promise after milliseconds
 * time has elapsed since the resolution of the given promise.
 * If the given promise rejects, that is passed immediately.
 */
Q.delay = function (object, timeout) {
    if (timeout === void 0) {
        timeout = object;
        object = void 0;
    }
    return Q(object).delay(timeout);
};

Promise.prototype.delay = function (timeout) {
    return this.then(function (value) {
        var deferred = defer();
        setTimeout(function () {
            deferred.resolve(value);
        }, timeout);
        return deferred.promise;
    });
};

/**
 * Passes a continuation to a Node function, which is called with the given
 * arguments provided as an array, and returns a promise.
 *
 *      Q.nfapply(FS.readFile, [__filename])
 *      .then(function (content) {
 *      })
 *
 */
Q.nfapply = function (callback, args) {
    return Q(callback).nfapply(args);
};

Promise.prototype.nfapply = function (args) {
    var deferred = defer();
    var nodeArgs = array_slice(args);
    nodeArgs.push(deferred.makeNodeResolver());
    this.fapply(nodeArgs).fail(deferred.reject);
    return deferred.promise;
};

/**
 * Passes a continuation to a Node function, which is called with the given
 * arguments provided individually, and returns a promise.
 * @example
 * Q.nfcall(FS.readFile, __filename)
 * .then(function (content) {
 * })
 *
 */
Q.nfcall = function (callback /*...args*/) {
    var args = array_slice(arguments, 1);
    return Q(callback).nfapply(args);
};

Promise.prototype.nfcall = function (/*...args*/) {
    var nodeArgs = array_slice(arguments);
    var deferred = defer();
    nodeArgs.push(deferred.makeNodeResolver());
    this.fapply(nodeArgs).fail(deferred.reject);
    return deferred.promise;
};

/**
 * Wraps a NodeJS continuation passing function and returns an equivalent
 * version that returns a promise.
 * @example
 * Q.nfbind(FS.readFile, __filename)("utf-8")
 * .then(console.log)
 * .done()
 */
Q.nfbind =
Q.denodeify = function (callback /*...args*/) {
    var baseArgs = array_slice(arguments, 1);
    return function () {
        var nodeArgs = baseArgs.concat(array_slice(arguments));
        var deferred = defer();
        nodeArgs.push(deferred.makeNodeResolver());
        Q(callback).fapply(nodeArgs).fail(deferred.reject);
        return deferred.promise;
    };
};

Promise.prototype.nfbind =
Promise.prototype.denodeify = function (/*...args*/) {
    var args = array_slice(arguments);
    args.unshift(this);
    return Q.denodeify.apply(void 0, args);
};

Q.nbind = function (callback, thisp /*...args*/) {
    var baseArgs = array_slice(arguments, 2);
    return function () {
        var nodeArgs = baseArgs.concat(array_slice(arguments));
        var deferred = defer();
        nodeArgs.push(deferred.makeNodeResolver());
        function bound() {
            return callback.apply(thisp, arguments);
        }
        Q(bound).fapply(nodeArgs).fail(deferred.reject);
        return deferred.promise;
    };
};

Promise.prototype.nbind = function (/*thisp, ...args*/) {
    var args = array_slice(arguments, 0);
    args.unshift(this);
    return Q.nbind.apply(void 0, args);
};

/**
 * Calls a method of a Node-style object that accepts a Node-style
 * callback with a given array of arguments, plus a provided callback.
 * @param object an object that has the named method
 * @param {String} name name of the method of object
 * @param {Array} args arguments to pass to the method; the callback
 * will be provided by Q and appended to these arguments.
 * @returns a promise for the value or error
 */
Q.nmapply = // XXX As proposed by "Redsandro"
Q.npost = function (object, name, args) {
    return Q(object).npost(name, args);
};

Promise.prototype.nmapply = // XXX As proposed by "Redsandro"
Promise.prototype.npost = function (name, args) {
    var nodeArgs = array_slice(args || []);
    var deferred = defer();
    nodeArgs.push(deferred.makeNodeResolver());
    this.dispatch("post", [name, nodeArgs]).fail(deferred.reject);
    return deferred.promise;
};

/**
 * Calls a method of a Node-style object that accepts a Node-style
 * callback, forwarding the given variadic arguments, plus a provided
 * callback argument.
 * @param object an object that has the named method
 * @param {String} name name of the method of object
 * @param ...args arguments to pass to the method; the callback will
 * be provided by Q and appended to these arguments.
 * @returns a promise for the value or error
 */
Q.nsend = // XXX Based on Mark Miller's proposed "send"
Q.nmcall = // XXX Based on "Redsandro's" proposal
Q.ninvoke = function (object, name /*...args*/) {
    var nodeArgs = array_slice(arguments, 2);
    var deferred = defer();
    nodeArgs.push(deferred.makeNodeResolver());
    Q(object).dispatch("post", [name, nodeArgs]).fail(deferred.reject);
    return deferred.promise;
};

Promise.prototype.nsend = // XXX Based on Mark Miller's proposed "send"
Promise.prototype.nmcall = // XXX Based on "Redsandro's" proposal
Promise.prototype.ninvoke = function (name /*...args*/) {
    var nodeArgs = array_slice(arguments, 1);
    var deferred = defer();
    nodeArgs.push(deferred.makeNodeResolver());
    this.dispatch("post", [name, nodeArgs]).fail(deferred.reject);
    return deferred.promise;
};

/**
 * If a function would like to support both Node continuation-passing-style and
 * promise-returning-style, it can end its internal promise chain with
 * `nodeify(nodeback)`, forwarding the optional nodeback argument.  If the user
 * elects to use a nodeback, the result will be sent there.  If they do not
 * pass a nodeback, they will receive the result promise.
 * @param object a result (or a promise for a result)
 * @param {Function} nodeback a Node.js-style callback
 * @returns either the promise or nothing
 */
Q.nodeify = nodeify;
function nodeify(object, nodeback) {
    return Q(object).nodeify(nodeback);
}

Promise.prototype.nodeify = function (nodeback) {
    if (nodeback) {
        this.then(function (value) {
            nextTick(function () {
                nodeback(null, value);
            });
        }, function (error) {
            nextTick(function () {
                nodeback(error);
            });
        });
    } else {
        return this;
    }
};

// All code before this point will be filtered from stack traces.
var qEndingLine = captureLine();

return Q;

});

}).call(this,require("FWaASH"))
},{"FWaASH":787}],780:[function(require,module,exports){
(function (global){
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.storage=a():"undefined"!=typeof global?global.storage=a():"undefined"!=typeof self&&(self.storage=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){/*!
Copyright (c) 2013 Derek Petersen https://github.com/tuxracer/simple-storage MIT Licensed
*/
var c,d,e,f,g;try{window.localStorage.setItem("simple-storage-test",!0),window.localStorage.removeItem("simple-storage-test"),d=!0}catch(h){c=h,d=!1}d?f=window:(g={local:{},session:{}},f={localStorage:{setItem:function(a,b){return g.local[a]=b},getItem:function(a){return g.local[a]},removeItem:function(a){return delete g.local[a]},clear:function(){return g.local={}}},sessionStorage:{setItem:function(a,b){return g.session[a]=b},getItem:function(a){return g.session[a]},removeItem:function(a){return delete g.session[a]},clear:function(){return g.session={}}}}),e=function(a){return"session"!==a&&(a="local"),f[a+"Storage"]},b.exports={nativeStorage:d,set:function(a,b,c){if("function"==typeof b)throw new TypeError("Cannot store functions");return"object"==typeof b&&(b=JSON.stringify(b)),e(c).setItem(a,b)},get:function(a,b){var d;if(null==a)return null;d=e(b).getItem(a);try{return JSON.parse(d)}catch(f){return c=f,d}},remove:function(a,b){if(null==a)throw new Error("Not enough arguments");return e(b).removeItem(a)},clear:function(a){return e(a).clear()}}},{}]},{},[1])(1)});
}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],781:[function(require,module,exports){
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){},{}],2:[function(a,b,c){/*!
Copyright (c) 2013 Derek Petersen https://github.com/tuxracer/touchclick MIT License
*/
var d,e,f,g,h,i,j,k,l,m,n,o,p;d="function"==typeof jQuery?jQuery:a("jquery"),e="touchactive",l=!1,k=10,j=0,m={x:null,y:null},g=function(a){var b,c,d;return b=null!=(c=a.originalEvent)&&null!=(d=c.touches)?d[0]:void 0,b?{x:b.pageX,y:b.pageY}:void 0},i=function(a){var b,c;return b=Math.round((new Date).getTime()/1e3),c=b-j,a.type.match("touchstart|touchmove|touchend")&&(j=b),3>c&&a.type.match("mouse")},h=function(a){var b,c;return b=d(a),c=b.closest('*[data-touchclick="true"]'),c.length?c:b},p=function(a){return m=g(a),i(a)?void 0:h(a.target).addClass(e)},o=function(a){var b;return b=g(a),!b||Math.abs(b.x-m.x)>k||Math.abs(b.y-m.y)>k?h(a.target).removeClass(e):void 0},n=function(a){var b;return b=h(a.target),b.hasClass(e)&&!i(a)?(a.type="touchclick",b.trigger(a).removeClass(e)):void 0},f=function(a){var b;return b=d(this),l&&b[a]("click",function(a){return a.preventDefault()}),window.navigator.pointerEnabled?(b[a]("pointerdown",p),b[a]("pointerup",n)):(b[a]("touchstart mousedown",p),b[a]("touchmove mouseout",o),b[a]("touchend mouseup",n))},d.event.special.touchclick={setup:function(){return f.call(this,"on")},teardown:function(){return f.call(this,"off")}}},{jquery:1}]},{},[2]);
},{}],782:[function(require,module,exports){
//  Underscore.string
//  (c) 2010 Esa-Matti Suuronen <esa-matti aet suuronen dot org>
//  Underscore.string is freely distributable under the terms of the MIT license.
//  Documentation: https://github.com/epeli/underscore.string
//  Some code is borrowed from MooTools and Alexandru Marasteanu.
//  Version '2.3.2'

!function(root, String){
  'use strict';

  // Defining helper functions.

  var nativeTrim = String.prototype.trim;
  var nativeTrimRight = String.prototype.trimRight;
  var nativeTrimLeft = String.prototype.trimLeft;

  var parseNumber = function(source) { return source * 1 || 0; };

  var strRepeat = function(str, qty){
    if (qty < 1) return '';
    var result = '';
    while (qty > 0) {
      if (qty & 1) result += str;
      qty >>= 1, str += str;
    }
    return result;
  };

  var slice = [].slice;

  var defaultToWhiteSpace = function(characters) {
    if (characters == null)
      return '\\s';
    else if (characters.source)
      return characters.source;
    else
      return '[' + _s.escapeRegExp(characters) + ']';
  };

  // Helper for toBoolean
  function boolMatch(s, matchers) {
    var i, matcher, down = s.toLowerCase();
    matchers = [].concat(matchers);
    for (i = 0; i < matchers.length; i += 1) {
      matcher = matchers[i];
      if (!matcher) continue;
      if (matcher.test && matcher.test(s)) return true;
      if (matcher.toLowerCase() === down) return true;
    }
  }

  var escapeChars = {
    lt: '<',
    gt: '>',
    quot: '"',
    amp: '&',
    apos: "'"
  };

  var reversedEscapeChars = {};
  for(var key in escapeChars) reversedEscapeChars[escapeChars[key]] = key;
  reversedEscapeChars["'"] = '#39';

  // sprintf() for JavaScript 0.7-beta1
  // http://www.diveintojavascript.com/projects/javascript-sprintf
  //
  // Copyright (c) Alexandru Marasteanu <alexaholic [at) gmail (dot] com>
  // All rights reserved.

  var sprintf = (function() {
    function get_type(variable) {
      return Object.prototype.toString.call(variable).slice(8, -1).toLowerCase();
    }

    var str_repeat = strRepeat;

    var str_format = function() {
      if (!str_format.cache.hasOwnProperty(arguments[0])) {
        str_format.cache[arguments[0]] = str_format.parse(arguments[0]);
      }
      return str_format.format.call(null, str_format.cache[arguments[0]], arguments);
    };

    str_format.format = function(parse_tree, argv) {
      var cursor = 1, tree_length = parse_tree.length, node_type = '', arg, output = [], i, k, match, pad, pad_character, pad_length;
      for (i = 0; i < tree_length; i++) {
        node_type = get_type(parse_tree[i]);
        if (node_type === 'string') {
          output.push(parse_tree[i]);
        }
        else if (node_type === 'array') {
          match = parse_tree[i]; // convenience purposes only
          if (match[2]) { // keyword argument
            arg = argv[cursor];
            for (k = 0; k < match[2].length; k++) {
              if (!arg.hasOwnProperty(match[2][k])) {
                throw new Error(sprintf('[_.sprintf] property "%s" does not exist', match[2][k]));
              }
              arg = arg[match[2][k]];
            }
          } else if (match[1]) { // positional argument (explicit)
            arg = argv[match[1]];
          }
          else { // positional argument (implicit)
            arg = argv[cursor++];
          }

          if (/[^s]/.test(match[8]) && (get_type(arg) != 'number')) {
            throw new Error(sprintf('[_.sprintf] expecting number but found %s', get_type(arg)));
          }
          switch (match[8]) {
            case 'b': arg = arg.toString(2); break;
            case 'c': arg = String.fromCharCode(arg); break;
            case 'd': arg = parseInt(arg, 10); break;
            case 'e': arg = match[7] ? arg.toExponential(match[7]) : arg.toExponential(); break;
            case 'f': arg = match[7] ? parseFloat(arg).toFixed(match[7]) : parseFloat(arg); break;
            case 'o': arg = arg.toString(8); break;
            case 's': arg = ((arg = String(arg)) && match[7] ? arg.substring(0, match[7]) : arg); break;
            case 'u': arg = Math.abs(arg); break;
            case 'x': arg = arg.toString(16); break;
            case 'X': arg = arg.toString(16).toUpperCase(); break;
          }
          arg = (/[def]/.test(match[8]) && match[3] && arg >= 0 ? '+'+ arg : arg);
          pad_character = match[4] ? match[4] == '0' ? '0' : match[4].charAt(1) : ' ';
          pad_length = match[6] - String(arg).length;
          pad = match[6] ? str_repeat(pad_character, pad_length) : '';
          output.push(match[5] ? arg + pad : pad + arg);
        }
      }
      return output.join('');
    };

    str_format.cache = {};

    str_format.parse = function(fmt) {
      var _fmt = fmt, match = [], parse_tree = [], arg_names = 0;
      while (_fmt) {
        if ((match = /^[^\x25]+/.exec(_fmt)) !== null) {
          parse_tree.push(match[0]);
        }
        else if ((match = /^\x25{2}/.exec(_fmt)) !== null) {
          parse_tree.push('%');
        }
        else if ((match = /^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt)) !== null) {
          if (match[2]) {
            arg_names |= 1;
            var field_list = [], replacement_field = match[2], field_match = [];
            if ((field_match = /^([a-z_][a-z_\d]*)/i.exec(replacement_field)) !== null) {
              field_list.push(field_match[1]);
              while ((replacement_field = replacement_field.substring(field_match[0].length)) !== '') {
                if ((field_match = /^\.([a-z_][a-z_\d]*)/i.exec(replacement_field)) !== null) {
                  field_list.push(field_match[1]);
                }
                else if ((field_match = /^\[(\d+)\]/.exec(replacement_field)) !== null) {
                  field_list.push(field_match[1]);
                }
                else {
                  throw new Error('[_.sprintf] huh?');
                }
              }
            }
            else {
              throw new Error('[_.sprintf] huh?');
            }
            match[2] = field_list;
          }
          else {
            arg_names |= 2;
          }
          if (arg_names === 3) {
            throw new Error('[_.sprintf] mixing positional and named placeholders is not (yet) supported');
          }
          parse_tree.push(match);
        }
        else {
          throw new Error('[_.sprintf] huh?');
        }
        _fmt = _fmt.substring(match[0].length);
      }
      return parse_tree;
    };

    return str_format;
  })();



  // Defining underscore.string

  var _s = {

    VERSION: '2.3.0',

    isBlank: function(str){
      if (str == null) str = '';
      return (/^\s*$/).test(str);
    },

    stripTags: function(str){
      if (str == null) return '';
      return String(str).replace(/<\/?[^>]+>/g, '');
    },

    capitalize : function(str){
      str = str == null ? '' : String(str);
      return str.charAt(0).toUpperCase() + str.slice(1);
    },

    chop: function(str, step){
      if (str == null) return [];
      str = String(str);
      step = ~~step;
      return step > 0 ? str.match(new RegExp('.{1,' + step + '}', 'g')) : [str];
    },

    clean: function(str){
      return _s.strip(str).replace(/\s+/g, ' ');
    },

    count: function(str, substr){
      if (str == null || substr == null) return 0;

      str = String(str);
      substr = String(substr);

      var count = 0,
        pos = 0,
        length = substr.length;

      while (true) {
        pos = str.indexOf(substr, pos);
        if (pos === -1) break;
        count++;
        pos += length;
      }

      return count;
    },

    chars: function(str) {
      if (str == null) return [];
      return String(str).split('');
    },

    swapCase: function(str) {
      if (str == null) return '';
      return String(str).replace(/\S/g, function(c){
        return c === c.toUpperCase() ? c.toLowerCase() : c.toUpperCase();
      });
    },

    escapeHTML: function(str) {
      if (str == null) return '';
      return String(str).replace(/[&<>"']/g, function(m){ return '&' + reversedEscapeChars[m] + ';'; });
    },

    unescapeHTML: function(str) {
      if (str == null) return '';
      return String(str).replace(/\&([^;]+);/g, function(entity, entityCode){
        var match;

        if (entityCode in escapeChars) {
          return escapeChars[entityCode];
        } else if (match = entityCode.match(/^#x([\da-fA-F]+)$/)) {
          return String.fromCharCode(parseInt(match[1], 16));
        } else if (match = entityCode.match(/^#(\d+)$/)) {
          return String.fromCharCode(~~match[1]);
        } else {
          return entity;
        }
      });
    },

    escapeRegExp: function(str){
      if (str == null) return '';
      return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
    },

    splice: function(str, i, howmany, substr){
      var arr = _s.chars(str);
      arr.splice(~~i, ~~howmany, substr);
      return arr.join('');
    },

    insert: function(str, i, substr){
      return _s.splice(str, i, 0, substr);
    },

    include: function(str, needle){
      if (needle === '') return true;
      if (str == null) return false;
      return String(str).indexOf(needle) !== -1;
    },

    join: function() {
      var args = slice.call(arguments),
        separator = args.shift();

      if (separator == null) separator = '';

      return args.join(separator);
    },

    lines: function(str) {
      if (str == null) return [];
      return String(str).split("\n");
    },

    reverse: function(str){
      return _s.chars(str).reverse().join('');
    },

    startsWith: function(str, starts){
      if (starts === '') return true;
      if (str == null || starts == null) return false;
      str = String(str); starts = String(starts);
      return str.length >= starts.length && str.slice(0, starts.length) === starts;
    },

    endsWith: function(str, ends){
      if (ends === '') return true;
      if (str == null || ends == null) return false;
      str = String(str); ends = String(ends);
      return str.length >= ends.length && str.slice(str.length - ends.length) === ends;
    },

    succ: function(str){
      if (str == null) return '';
      str = String(str);
      return str.slice(0, -1) + String.fromCharCode(str.charCodeAt(str.length-1) + 1);
    },

    titleize: function(str){
      if (str == null) return '';
      str  = String(str).toLowerCase();
      return str.replace(/(?:^|\s|-)\S/g, function(c){ return c.toUpperCase(); });
    },

    camelize: function(str){
      return _s.trim(str).replace(/[-_\s]+(.)?/g, function(match, c){ return c ? c.toUpperCase() : ""; });
    },

    underscored: function(str){
      return _s.trim(str).replace(/([a-z\d])([A-Z]+)/g, '$1_$2').replace(/[-\s]+/g, '_').toLowerCase();
    },

    dasherize: function(str){
      return _s.trim(str).replace(/([A-Z])/g, '-$1').replace(/[-_\s]+/g, '-').toLowerCase();
    },

    classify: function(str){
      return _s.titleize(String(str).replace(/[\W_]/g, ' ')).replace(/\s/g, '');
    },

    humanize: function(str){
      return _s.capitalize(_s.underscored(str).replace(/_id$/,'').replace(/_/g, ' '));
    },

    trim: function(str, characters){
      if (str == null) return '';
      if (!characters && nativeTrim) return nativeTrim.call(str);
      characters = defaultToWhiteSpace(characters);
      return String(str).replace(new RegExp('\^' + characters + '+|' + characters + '+$', 'g'), '');
    },

    ltrim: function(str, characters){
      if (str == null) return '';
      if (!characters && nativeTrimLeft) return nativeTrimLeft.call(str);
      characters = defaultToWhiteSpace(characters);
      return String(str).replace(new RegExp('^' + characters + '+'), '');
    },

    rtrim: function(str, characters){
      if (str == null) return '';
      if (!characters && nativeTrimRight) return nativeTrimRight.call(str);
      characters = defaultToWhiteSpace(characters);
      return String(str).replace(new RegExp(characters + '+$'), '');
    },

    truncate: function(str, length, truncateStr){
      if (str == null) return '';
      str = String(str); truncateStr = truncateStr || '...';
      length = ~~length;
      return str.length > length ? str.slice(0, length) + truncateStr : str;
    },

    /**
     * _s.prune: a more elegant version of truncate
     * prune extra chars, never leaving a half-chopped word.
     * @author github.com/rwz
     */
    prune: function(str, length, pruneStr){
      if (str == null) return '';

      str = String(str); length = ~~length;
      pruneStr = pruneStr != null ? String(pruneStr) : '...';

      if (str.length <= length) return str;

      var tmpl = function(c){ return c.toUpperCase() !== c.toLowerCase() ? 'A' : ' '; },
        template = str.slice(0, length+1).replace(/.(?=\W*\w*$)/g, tmpl); // 'Hello, world' -> 'HellAA AAAAA'

      if (template.slice(template.length-2).match(/\w\w/))
        template = template.replace(/\s*\S+$/, '');
      else
        template = _s.rtrim(template.slice(0, template.length-1));

      return (template+pruneStr).length > str.length ? str : str.slice(0, template.length)+pruneStr;
    },

    words: function(str, delimiter) {
      if (_s.isBlank(str)) return [];
      return _s.trim(str, delimiter).split(delimiter || /\s+/);
    },

    pad: function(str, length, padStr, type) {
      str = str == null ? '' : String(str);
      length = ~~length;

      var padlen  = 0;

      if (!padStr)
        padStr = ' ';
      else if (padStr.length > 1)
        padStr = padStr.charAt(0);

      switch(type) {
        case 'right':
          padlen = length - str.length;
          return str + strRepeat(padStr, padlen);
        case 'both':
          padlen = length - str.length;
          return strRepeat(padStr, Math.ceil(padlen/2)) + str
                  + strRepeat(padStr, Math.floor(padlen/2));
        default: // 'left'
          padlen = length - str.length;
          return strRepeat(padStr, padlen) + str;
        }
    },

    lpad: function(str, length, padStr) {
      return _s.pad(str, length, padStr);
    },

    rpad: function(str, length, padStr) {
      return _s.pad(str, length, padStr, 'right');
    },

    lrpad: function(str, length, padStr) {
      return _s.pad(str, length, padStr, 'both');
    },

    sprintf: sprintf,

    vsprintf: function(fmt, argv){
      argv.unshift(fmt);
      return sprintf.apply(null, argv);
    },

    toNumber: function(str, decimals) {
      if (!str) return 0;
      str = _s.trim(str);
      if (!str.match(/^-?\d+(?:\.\d+)?$/)) return NaN;
      return parseNumber(parseNumber(str).toFixed(~~decimals));
    },

    numberFormat : function(number, dec, dsep, tsep) {
      if (isNaN(number) || number == null) return '';

      number = number.toFixed(~~dec);
      tsep = typeof tsep == 'string' ? tsep : ',';

      var parts = number.split('.'), fnums = parts[0],
        decimals = parts[1] ? (dsep || '.') + parts[1] : '';

      return fnums.replace(/(\d)(?=(?:\d{3})+$)/g, '$1' + tsep) + decimals;
    },

    strRight: function(str, sep){
      if (str == null) return '';
      str = String(str); sep = sep != null ? String(sep) : sep;
      var pos = !sep ? -1 : str.indexOf(sep);
      return ~pos ? str.slice(pos+sep.length, str.length) : str;
    },

    strRightBack: function(str, sep){
      if (str == null) return '';
      str = String(str); sep = sep != null ? String(sep) : sep;
      var pos = !sep ? -1 : str.lastIndexOf(sep);
      return ~pos ? str.slice(pos+sep.length, str.length) : str;
    },

    strLeft: function(str, sep){
      if (str == null) return '';
      str = String(str); sep = sep != null ? String(sep) : sep;
      var pos = !sep ? -1 : str.indexOf(sep);
      return ~pos ? str.slice(0, pos) : str;
    },

    strLeftBack: function(str, sep){
      if (str == null) return '';
      str += ''; sep = sep != null ? ''+sep : sep;
      var pos = str.lastIndexOf(sep);
      return ~pos ? str.slice(0, pos) : str;
    },

    toSentence: function(array, separator, lastSeparator, serial) {
      separator = separator || ', ';
      lastSeparator = lastSeparator || ' and ';
      var a = array.slice(), lastMember = a.pop();

      if (array.length > 2 && serial) lastSeparator = _s.rtrim(separator) + lastSeparator;

      return a.length ? a.join(separator) + lastSeparator + lastMember : lastMember;
    },

    toSentenceSerial: function() {
      var args = slice.call(arguments);
      args[3] = true;
      return _s.toSentence.apply(_s, args);
    },

    slugify: function(str) {
      if (str == null) return '';

      var from  = "ąàáäâãåæăćęèéëêìíïîłńòóöôõøśșțùúüûñçżź",
          to    = "aaaaaaaaaceeeeeiiiilnoooooosstuuuunczz",
          regex = new RegExp(defaultToWhiteSpace(from), 'g');

      str = String(str).toLowerCase().replace(regex, function(c){
        var index = from.indexOf(c);
        return to.charAt(index) || '-';
      });

      return _s.dasherize(str.replace(/[^\w\s-]/g, ''));
    },

    surround: function(str, wrapper) {
      return [wrapper, str, wrapper].join('');
    },

    quote: function(str, quoteChar) {
      return _s.surround(str, quoteChar || '"');
    },

    unquote: function(str, quoteChar) {
      quoteChar = quoteChar || '"';
      if (str[0] === quoteChar && str[str.length-1] === quoteChar)
        return str.slice(1,str.length-1);
      else return str;
    },

    exports: function() {
      var result = {};

      for (var prop in this) {
        if (!this.hasOwnProperty(prop) || prop.match(/^(?:include|contains|reverse)$/)) continue;
        result[prop] = this[prop];
      }

      return result;
    },

    repeat: function(str, qty, separator){
      if (str == null) return '';

      qty = ~~qty;

      // using faster implementation if separator is not needed;
      if (separator == null) return strRepeat(String(str), qty);

      // this one is about 300x slower in Google Chrome
      for (var repeat = []; qty > 0; repeat[--qty] = str) {}
      return repeat.join(separator);
    },

    naturalCmp: function(str1, str2){
      if (str1 == str2) return 0;
      if (!str1) return -1;
      if (!str2) return 1;

      var cmpRegex = /(\.\d+)|(\d+)|(\D+)/g,
        tokens1 = String(str1).toLowerCase().match(cmpRegex),
        tokens2 = String(str2).toLowerCase().match(cmpRegex),
        count = Math.min(tokens1.length, tokens2.length);

      for(var i = 0; i < count; i++) {
        var a = tokens1[i], b = tokens2[i];

        if (a !== b){
          var num1 = parseInt(a, 10);
          if (!isNaN(num1)){
            var num2 = parseInt(b, 10);
            if (!isNaN(num2) && num1 - num2)
              return num1 - num2;
          }
          return a < b ? -1 : 1;
        }
      }

      if (tokens1.length === tokens2.length)
        return tokens1.length - tokens2.length;

      return str1 < str2 ? -1 : 1;
    },

    levenshtein: function(str1, str2) {
      if (str1 == null && str2 == null) return 0;
      if (str1 == null) return String(str2).length;
      if (str2 == null) return String(str1).length;

      str1 = String(str1); str2 = String(str2);

      var current = [], prev, value;

      for (var i = 0; i <= str2.length; i++)
        for (var j = 0; j <= str1.length; j++) {
          if (i && j)
            if (str1.charAt(j - 1) === str2.charAt(i - 1))
              value = prev;
            else
              value = Math.min(current[j], current[j - 1], prev) + 1;
          else
            value = i + j;

          prev = current[j];
          current[j] = value;
        }

      return current.pop();
    },

    toBoolean: function(str, trueValues, falseValues) {
      if (typeof str === "number") str = "" + str;
      if (typeof str !== "string") return !!str;
      str = _s.trim(str);
      if (boolMatch(str, trueValues || ["true", "1"])) return true;
      if (boolMatch(str, falseValues || ["false", "0"])) return false;
    }
  };

  // Aliases

  _s.strip    = _s.trim;
  _s.lstrip   = _s.ltrim;
  _s.rstrip   = _s.rtrim;
  _s.center   = _s.lrpad;
  _s.rjust    = _s.lpad;
  _s.ljust    = _s.rpad;
  _s.contains = _s.include;
  _s.q        = _s.quote;
  _s.toBool   = _s.toBoolean;

  // Exporting

  // CommonJS module is defined
  if (typeof exports !== 'undefined') {
    if (typeof module !== 'undefined' && module.exports)
      module.exports = _s;

    exports._s = _s;
  }

  // Register as a named module with AMD.
  if (typeof define === 'function' && define.amd)
    define('underscore.string', [], function(){ return _s; });


  // Integrate with Underscore.js if defined
  // or create our own underscore object.
  root._ = root._ || {};
  root._.string = root._.str = _s;
}(this, String);

},{}],783:[function(require,module,exports){
// Fake underscore remapped to lodash since @isaacs doesn't want npm to support this
// Having this installed and doing `npm dedupe` causes Backbone to use lodash instead of underscore
// https://github.com/isaacs/npm/issues/2943
module.exports = require('lodash');

},{"lodash":776}],784:[function(require,module,exports){
/*
 * jquery.autogrow.js
 *
 * A plugin written for UserVoice that makes it easy to create textareas
 * that automatically resize to fit their contents.
 *
 * Based on Scott Moonen's original code for Prototype.js:
 *
 * <http://scottmoonen.com/2008/07/08/unobtrusive-javascript-expandable-textareas/>
 *
 * Author: John W. Long <john@uservoice.com>
 *
 */
;(function($) {
  var properties = ['-webkit-appearance', '-moz-appearance', '-o-appearance', 'appearance', 'font-family', 'font-size', 'font-weight', 'font-style', 'border', 'border-top', 'border-right', 'border-bottom', 'border-left', 'box-sizing', 'padding', 'padding-top', 'padding-right', 'padding-bottom', 'padding-left', 'min-height', 'max-height', 'line-height']
  ,   escaper    = $('<span />')
  ;

  function escape(string) {
    return escaper.text(string).text().replace(/\n/g, '<br>');
  }

  $.fn.autogrow = function() {
    return this.filter('textarea').each(function() {
      if (!$(this).data('autogrow-applied')) {
        var textarea      = $(this)
        ,   initialHeight = textarea.innerHeight()
        ,   expander      = $('<div />')
        ,   timer         = null
        ;

        // Setup expander
        expander.css({'position': 'absolute', 'visibility': 'hidden', 'top': '-99999px'})
        $.each(properties, function(i, p) { expander.css(p, textarea.css(p)); });
        textarea.after(expander);

        // Setup textarea
        textarea.css({'overflow-y': 'hidden', 'resize': 'none', 'box-sizing': 'border-box'});

        // Sizer function
        function sizeTextarea() {
          clearTimeout(timer);
          timer = setTimeout(function() {
            var value = escape(textarea.val()) + '<br>z';
            expander.text(value);
            expander.css('width', textarea.innerWidth() + 2 + 'px');
            textarea.css('height', Math.max(expander.innerHeight(), initialHeight) + 2 + 'px');
          }, 10); // throttle by 10ms
        }

        // Bind sizer to IE 9+'s input event and Safari's propertychange event
        textarea.on('input.autogrow propertychange.autogrow', sizeTextarea);

        // Set the initial size
        sizeTextarea();

        // Record autogrow applied
        textarea.data('autogrow-applied', true);
      }
    });
  };
}(jQuery));

},{}],785:[function(require,module,exports){
/*!
 * jQuery Smart Banner
 * Copyright (c) 2012 Arnold Daniels <arnold@jasny.net>
 * Based on 'jQuery Smart Web App Banner' by Kurt Zenisek @ kzeni.com
 */
!function ($) {
    var SmartBanner = function (options) {
        this.origHtmlMargin = parseFloat($('html').css('margin-top')) // Get the original margin-top of the HTML element so we can take that into account
        this.options = $.extend({}, $.smartbanner.defaults, options)

        var standalone = navigator.standalone // Check if it's already a standalone web app or running within a webui view of an app (not mobile safari)
          , UA = navigator.userAgent

        // Detect banner type (iOS or Android)
        if (this.options.force) {
            this.type = this.options.force
        } else if (UA.match(/iPhone|iPod/i) != null || (UA.match(/iPad/) && this.options.iOSUniversalApp)) {
            if (UA.match(/Safari/i) != null &&
               (UA.match(/CriOS/i) != null ||
               window.Number(UA.substr(UA.indexOf('OS ') + 3, 3).replace('_', '.')) < 6)) this.type = 'ios' // Check webview and native smart banner support (iOS 6+)
        } else if (UA.match(/\bSilk\/(.*\bMobile Safari\b)?/) || UA.match(/\bKF\w/) || UA.match('Kindle Fire')) {
            this.type = 'kindle'
        } else if (UA.match(/Android/i) != null) {
            this.type = 'android'
        } else if (UA.match(/Windows NT 6.2/i) != null && UA.match(/Touch/i) !== null) {
            this.type = 'windows'
        }

        // Don't show banner if device isn't iOS or Android, website is loaded in app or user dismissed banner
        if (!this.type || standalone || this.getCookie('sb-closed') || this.getCookie('sb-installed')) {
            return
        }

        // Calculate scale
        this.scale = this.options.scale == 'auto' ? $(window).width() / window.screen.width : this.options.scale
        if (this.scale < 1) this.scale = 1

        // Get info from meta data
        var meta = $(this.type == 'android' ? 'meta[name="google-play-app"]' :
            this.type == 'ios' ? 'meta[name="apple-itunes-app"]' :
            this.type == 'kindle' ? 'meta[name="kindle-fire-app"]' : 'meta[name="msApplication-ID"]');
        if (meta.length == 0) return

        // For Windows Store apps, get the PackageFamilyName for protocol launch
        if (this.type == 'windows') {
            this.pfn = $('meta[name="msApplication-PackageFamilyName"]').attr('content');
            this.appId = meta.attr('content')[1]
        } else {
            this.appId = /app-id=([^\s,]+)/.exec(meta.attr('content'))[1]
        }

        this.title = this.options.title ? this.options.title : meta.data('title') || $('title').text().replace(/\s*[|\-·].*$/, '')
        this.author = this.options.author ? this.options.author : meta.data('author') || ($('meta[name="author"]').length ? $('meta[name="author"]').attr('content') : window.location.hostname)
        this.iconUrl = meta.data('icon-url');
        this.price = meta.data('price');

        // Create banner
        this.create()
        this.show()
        this.listen()
    }

    SmartBanner.prototype = {

        constructor: SmartBanner

      , create: function() {
            var iconURL
              , link=(this.options.url ? this.options.url : (this.type == 'windows' ? 'ms-windows-store:PDP?PFN=' + this.pfn : (this.type == 'android' ? 'market://details?id=' : (this.type == 'kindle' ? 'amzn://apps/android?asin=' : 'https://itunes.apple.com/' + this.options.appStoreLanguage + '/app/id'))) + this.appId)
              , price = this.price || this.options.price
              , inStore=price ? price + ' - ' + (this.type == 'android' ? this.options.inGooglePlay : this.type == 'kindle' ? this.options.inAmazonAppStore : this.type == 'ios' ? this.options.inAppStore : this.options.inWindowsStore) : ''
              , gloss=this.options.iconGloss === null ? (this.type=='ios') : this.options.iconGloss
            if(this.options.url)
              link = this.options.url
            else {
              if(this.type=='android') {
                link = 'market://details?id=' + this.appId
                if(this.options.GooglePlayParams)
                  link = link + '&referrer=' + this.options.GooglePlayParams
              }
              else
              link = 'https://itunes.apple.com/' + this.options.appStoreLanguage + '/app/id' + this.appId
            }

            var banner = '<div id="smartbanner" class="'+this.type+'"><div class="sb-container"><a href="#" class="sb-close">&times;</a><span class="sb-icon"></span><div class="sb-info"><strong>'+this.title+'</strong><span>'+this.author+'</span><span>'+inStore+'</span></div><a href="'+link+'" class="sb-button"><span>'+this.options.button+'</span></a></div></div>';
            (this.options.layer) ? $(this.options.appendToSelector).append(banner) : $(this.options.appendToSelector).prepend(banner);

            if (this.options.icon) {
                iconURL = this.options.icon
            } else if(this.iconUrl) {
                iconURL = this.iconUrl;
            } else if ($('link[rel="apple-touch-icon-precomposed"]').length > 0) {
                iconURL = $('link[rel="apple-touch-icon-precomposed"]').attr('href')
                if (this.options.iconGloss === null) gloss = false
            } else if ($('link[rel="apple-touch-icon"]').length > 0) {
                iconURL = $('link[rel="apple-touch-icon"]').attr('href')
            } else if ($('meta[name="msApplication-TileImage"]').length > 0) {
              iconURL = $('meta[name="msApplication-TileImage"]').attr('content')
            } else if ($('meta[name="msapplication-TileImage"]').length > 0) { /* redundant because ms docs show two case usages */
              iconURL = $('meta[name="msapplication-TileImage"]').attr('content')
            }

            if (iconURL) {
                $('#smartbanner .sb-icon').css('background-image','url('+iconURL+')')
                if (gloss) $('#smartbanner .sb-icon').addClass('gloss')
            } else{
                $('#smartbanner').addClass('no-icon')
            }

            this.bannerHeight = $('#smartbanner').outerHeight() + 2

            if (this.scale > 1) {
                $('#smartbanner')
                    .css('top', parseFloat($('#smartbanner').css('top')) * this.scale)
                    .css('height', parseFloat($('#smartbanner').css('height')) * this.scale)
                    .hide()
                $('#smartbanner .sb-container')
                    .css('-webkit-transform', 'scale('+this.scale+')')
                    .css('-msie-transform', 'scale('+this.scale+')')
                    .css('-moz-transform', 'scale('+this.scale+')')
                    .css('width', $(window).width() / this.scale)
            }
            $('#smartbanner').css('position', (this.options.layer) ? 'absolute' : 'static')
        }

      , listen: function () {
            $('#smartbanner .sb-close').on('click',$.proxy(this.close, this))
            $('#smartbanner .sb-button').on('click',$.proxy(this.install, this))
        }

      , show: function(callback) {
            var banner = $('#smartbanner');
            banner.stop();

            if (this.options.layer) {
                banner.animate({top: 0, display: 'block'}, this.options.speedIn).addClass('shown').show();
                $('html').animate({marginTop: this.origHtmlMargin + (this.bannerHeight * this.scale)}, this.options.speedIn, 'swing', callback);
            } else {
                if ($.support.transition) {
                    banner.animate({top:0},this.options.speedIn).addClass('shown');
                    var transitionCallback = function() {
                        $('html').removeClass('sb-animation');
                        if (callback) {
                            callback();
                        }
                    };
                    $('html').addClass('sb-animation').one($.support.transition.end, transitionCallback).emulateTransitionEnd(this.options.speedIn).css('margin-top', this.origHtmlMargin+(this.bannerHeight*this.scale));
                } else {
                    banner.slideDown(this.options.speedIn).addClass('shown');
                }
            }
        }

      , hide: function(callback) {
            var banner = $('#smartbanner');
            banner.stop();

            if (this.options.layer) {
                banner.animate({top: -1 * this.bannerHeight * this.scale, display: 'block'}, this.options.speedIn).removeClass('shown');
                $('html').animate({marginTop: this.origHtmlMargin}, this.options.speedIn, 'swing', callback);
            } else {
                if ($.support.transition) {
                    banner.css('top', -1*this.bannerHeight*this.scale).removeClass('shown');
                    var transitionCallback = function() {
                        $('html').removeClass('sb-animation');
                        if (callback) {
                            callback();
                        }
                    };
                    $('html').addClass('sb-animation').one($.support.transition.end, transitionCallback).emulateTransitionEnd(this.options.speedOut).css('margin-top', this.origHtmlMargin);
                } else {
                    banner.slideUp(this.options.speedOut).removeClass('shown');
                }
            }
            $('#smartbanner').css('height', 0);
            $('#smartbanner').css('border', 0);
        }

      , close: function(e) {
            e.preventDefault()
            this.hide()

            this.setCookie('sb-closed','true',this.options.daysHidden);
        }

      , install: function(e) {
			if (this.options.hideOnInstall) {
				this.hide()
			}
            this.setCookie('sb-installed','true',this.options.daysReminder)
        }

      , setCookie: function(name, value, exdays) {
            var exdate = new Date()
            exdate.setDate(exdate.getDate()+exdays)
            value=encodeURI(value)+((exdays==null)?'':'; expires='+exdate.toUTCString())
            document.cookie=name+'='+value+'; path=/;'
        }

      , getCookie: function(name) {
            var i,x,y,ARRcookies = document.cookie.split(";")
            for(i=0;i<ARRcookies.length;i++) {
                x = ARRcookies[i].substr(0,ARRcookies[i].indexOf("="))
                y = ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1)
                x = x.replace(/^\s+|\s+$/g,"")
                if (x==name) {
                    return decodeURI(y)
                }
            }
            return null
        }

      // Demo only
      , switchType: function() {
          var that = this

          this.hide(function () {
              that.type = that.type == 'android' ? 'ios' : 'android'
              var meta = $(that.type == 'android' ? 'meta[name="google-play-app"]' : 'meta[name="apple-itunes-app"]').attr('content')
              that.appId = /app-id=([^\s,]+)/.exec(meta)[1]

              $('#smartbanner').detach()
              that.create()
              that.show()
          })
      }
    }

    $.smartbanner = function (option) {
        var $window = $(window)
        , data = $window.data('smartbanner')
        , options = typeof option == 'object' && option
        if (!data) $window.data('smartbanner', (data = new SmartBanner(options)))
        if (typeof option == 'string') data[option]()
    }

    // override these globally if you like (they are all optional)
    $.smartbanner.defaults = {
        title: null, // What the title of the app should be in the banner (defaults to <title>)
        author: null, // What the author of the app should be in the banner (defaults to <meta name="author"> or hostname)
        price: 'FREE', // Price of the app
        appStoreLanguage: 'us', // Language code for App Store
        inAppStore: 'On the App Store', // Text of price for iOS
        inGooglePlay: 'In Google Play', // Text of price for Android
        inAmazonAppStore: 'In the Amazon Appstore',
        inWindowsStore: 'In the Windows Store', //Text of price for Windows
        GooglePlayParams: null, // Aditional parameters for the market
        icon: null, // The URL of the icon (defaults to <meta name="apple-touch-icon">)
        iconGloss: null, // Force gloss effect for iOS even for precomposed
        button: 'VIEW', // Text for the install button
        url: null, // The URL for the button. Keep null if you want the button to link to the app store.
        scale: 'auto', // Scale based on viewport size (set to 1 to disable)
        speedIn: 300, // Show animation speed of the banner
        speedOut: 400, // Close animation speed of the banner
        daysHidden: 15, // Duration to hide the banner after being closed (0 = always show banner)
        daysReminder: 90, // Duration to hide the banner after "VIEW" is clicked *separate from when the close button is clicked* (0 = always show banner)
        force: null, // Choose 'ios', 'android' or 'windows'. Don't do a browser check, just always show this banner
        hideOnInstall: true, // Hide the banner after "VIEW" is clicked.
        layer: false, // Display as overlay layer or slide down the page
        iOSUniversalApp: true, // If the iOS App is a universal app for both iPad and iPhone, display Smart Banner to iPad users, too.
        appendToSelector: 'body' //Append the banner to a specific selector
    }

    $.smartbanner.Constructor = SmartBanner;


    // ============================================================
    // Bootstrap transition
    // Copyright 2011-2014 Twitter, Inc.
    // Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)

    function transitionEnd() {
        var el = document.createElement('smartbanner')

        var transEndEventNames = {
            WebkitTransition: 'webkitTransitionEnd',
            MozTransition: 'transitionend',
            OTransition: 'oTransitionEnd otransitionend',
            transition: 'transitionend'
        }

        for (var name in transEndEventNames) {
            if (el.style[name] !== undefined) {
                return {end: transEndEventNames[name]}
            }
        }

        return false // explicit for ie8 (  ._.)
    }

    if ($.support.transition !== undefined)
        return  // Prevent conflict with Twitter Bootstrap

    // http://blog.alexmaccaw.com/css-transitions
    $.fn.emulateTransitionEnd = function(duration) {
        var called = false, $el = this
        $(this).one($.support.transition.end, function() {
            called = true
        })
        var callback = function() {
            if (!called) $($el).trigger($.support.transition.end)
        }
        setTimeout(callback, duration)
        return this
    }

    $(function() {
        $.support.transition = transitionEnd()
    })
    // ============================================================

}(window.jQuery);

},{}],786:[function(require,module,exports){
/*jshint scripturl:true, smarttabs:true */

 /*!
 * @author Sean Coker <sean@seancoker.com>
 * @version 1.5.0
 * @url http://sean.is/poppin/tags
 * @license MIT
 * @description Taggle is a dependency-less tagging library
 */

;(function(window, document, undefined) {

    var DEFAULTS = {

        /**
         * Class names to be added on each tag entered
         * @type {String}
         */
        additionalTagClasses:   '',

        /**
         * Allow duplicate tags to be entered in the field?
         * @type {Boolean}
         */
        allowDuplicates:        false,

        /**
         * Class name that will be added onto duplicate existant tag
         * @type {String}
         */
        duplicateTagClass:      '',

        /**
         * Class added to the container div when focused
         * @type {String}
         */
        containerFocusClass:    'active',

        /**
         * Name added to the hidden inputs within each tag
         * @type {String}
         */
        hiddenInputName:        'taggles[]',

        /**
         * Tags that should be preloaded in the div on load
         * @type {Array}
         */
        tags:                   [],

        /**
         * Tags that the user will be restricted to
         * @type {Array}
         */
        allowedTags:            [],

        /**
         * If within a form, you can specify the tab index flow
         * @type {Number}
         */
        tabIndex:               1,

        /**
         * Placeholder string to be placed in an empty taggle field
         * @type {String}
         */
        placeholder:            'Enter tags...',

        /**
         * Keycodes that will add a tag
         * @type {Array}
         */
        submitKeys:             [],

        /**
         * Function hook called when a tag is added
         * @param  {Event} event Event triggered when tag was added
         * @param  {String} tag The tag added
         */
        onTagAdd:               function() {},

        /**
         * Function hook called when a tag is removed
         * @param  {Event} event Event triggered when tag was removed
         * @param  {String} tag The tag removed
         */
        onTagRemove:            function() {}
    },

    BACKSPACE = 8,
    COMMA = 188,
    TAB = 9,
    ENTER = 13;

    /**
     * Constructor
     * @param {Mixed} el ID of an element or the actual element
     * @param {Object} options
     */
    var Taggle = function(el, options) {
        var self = this,
            settings = _extend({}, DEFAULTS, options),
            measurements = {
                container: {
                    rect: null,
                    style: null,
                    padding: null
                }
            },

            container = el,
            tag = {
                values: [],
                elements: []
            },

            list = document.createElement('ul'),
            input_li = document.createElement('li'),
            input = document.createElement('input'),
            sizer = document.createElement('div'),
            placeholder;

        if (settings.placeholder) {
            placeholder = document.createElement('span');
        }

        if (!settings.submitKeys.length) {
            settings.submitKeys = [COMMA, TAB, ENTER];
        }

        if (typeof el === 'string') {
            container = document.getElementById(el);
        }

        function _init() {
            _getMeasurements();
            _setupTextarea();
            _attachEvents();
        }

        /**
         * Gets all the layout measurements up front
         */
        function _getMeasurements() {
            var style,
                lpad, rpad;

            measurements.container.rect = container.getBoundingClientRect();
            measurements.container.style = window.getComputedStyle(container);

            style = measurements.container.style;
            lpad = parseInt(style['padding-left'] || style.paddingLeft, 10);
            rpad = parseInt(style['padding-right'] || style.paddingRight, 10);
            measurements.container.padding =  lpad + rpad;
        }

        /**
         * Setup the div container for tags to be entered
         */
        function _setupTextarea() {
            var font_size;

            list.className = 'taggle_list';
            input.type = 'text';
            input.className = 'taggle_input';
            input.tabIndex = settings.tabIndex;
            sizer.className = 'taggle_sizer';

            if (settings.tags.length) {
                for (var i = 0, len = settings.tags.length; i < len; i++) {
                    var tag = _createTag(settings.tags[i]);
                    list.appendChild(tag);
                }
            }

            if (placeholder) {
                placeholder.style.opacity = 0;
                placeholder.classList.add('taggle_placeholder');
                container.appendChild(placeholder);
                _setText(placeholder, settings.placeholder);

                if (!settings.tags.length) {
                    placeholder.style.opacity = 1;
                }
            }

            input_li.appendChild(input);
            list.appendChild(input_li);
            container.appendChild(list);
            container.appendChild(sizer);
            font_size = window.getComputedStyle(input).fontSize;
            sizer.style.fontSize = font_size;
        }

        /**
         * Attaches neccessary events
         */
        function _attachEvents() {
            _on(container, 'click', function() {
                input.focus();
            });

            input.onfocus = _focusInput;
            input.onblur = _blurInput;

            _on(input, 'keydown', _keydownEvents);
            _on(input, 'keyup', _keyupEvents);
        }

        /**
         * Resizes the hidden input where user types to fill in the
         * width of the div
         */
        function _fixInputWidth() {
            var width,
                input_rect, rect,
                left_pos,
                padding;
            //reset width incase we've broken to the next line on a backspace erase
            _setInputWidth();

            input_rect = input.getBoundingClientRect();
            rect = measurements.container.rect;
            width = ~~rect.width;
            // Could probably just use right - left all the time
            // but eh, this check is mostly for IE8
            if (!width) {
                width = ~~rect.right - ~~rect.left;
            }
            left_pos = ~~input_rect.left - ~~rect.left;
            padding = measurements.container.padding;

            _setInputWidth(width - left_pos - padding);
        }

        /**
         * Returns whether or not the specified tag text can be added
         * @param  {String} text tag value
         * @return {Boolean}
         */
        function _canAdd(text) {
            if (!text) {
                return false;
            }

            if (!settings.allowDuplicates && _hasDupes(text)) {
                return false;
            }

            if (settings.allowedTags.length && settings.allowedTags.indexOf(text) === -1) {
                return false;
            }

            return true;
        }

        /**
         * Appends tag with its corresponding input to the list
         * @param  {String} tag
         */
        function _add(e, text) {
            var val = typeof text === 'string' ? text.toLowerCase() : _trim(input.value.toLowerCase()),
                li,
                lis,
                last_li;

            if (!_canAdd(val)) {
                return;
            }

            li = _createTag(val);
            lis = list.querySelectorAll('li');
            last_li = lis[lis.length - 1];
            list.insertBefore(li, last_li);

            settings.onTagAdd(e, val);

            input.value = '';
            _setInputWidth();
            _fixInputWidth();
            _focusInput();
        }

        /**
         * Removes last tag if it has already been probed
         */
        function _checkLastTag(e) {
            e = e || window.event;

            var taggles = container.querySelectorAll('.taggle'),
                last_taggle = taggles[taggles.length - 1],
                hot_class = 'taggle_hot',
                held_down = input.classList.contains('taggle_back');

            //prevent holding backspace from deleting all tags
            if (input.value === '' && e.keyCode === BACKSPACE && !held_down) {
                if (last_taggle.classList.contains(hot_class)) {
                    input.classList.add('taggle_back');
                    _remove(last_taggle, e);
                    _fixInputWidth();
                    _focusInput();
                }
                else {
                    last_taggle.classList.add(hot_class);
                }
            }
            else if (last_taggle.classList.contains(hot_class)) {
                last_taggle.classList.remove(hot_class);
            }
        }

        /**
         * Setter for the hidden input.
         * @param {Number} width
         */
        function _setInputWidth(width) {
            input.style.width = (width || 10) + 'px';
        }

        /**
         * Checks global tags array if provided tag exists
         * @param  {String} tag
         */
        function _hasDupes(text) {
            var needle = tag.values.indexOf(text),
                taggle_list = container.querySelector('.taggle_list'),
                dupes;

            if (settings.duplicateTagClass) {
                dupes = taggle_list.querySelectorAll('.' + settings.duplicateTagClass);
                for (var i = 0, len = dupes.length; i < len; i++) {
                    dupes[i].classList.remove(settings.duplicateTagClass);
                }
            }

            //if found
            if (needle > -1) {
                if (settings.duplicateTagClass) {
                    taggle_list.childNodes[needle].classList.add(settings.duplicateTagClass);
                }
                return true;
            }

            return false;
        }

        /**
         * Checks whether or not the key pressed is acceptable
         * @param  {Number}  key code
         * @return {Boolean}
         */
        function _isConfirmKey(key) {
            var confirm_key = false;

            if (settings.submitKeys.indexOf(key) > -1) {
                confirm_key = true;
            }

            return confirm_key;
        }

        //event handlers

        /**
         * Handles focus state of div container.
         */
        function _focusInput() {
            _fixInputWidth();

            if (!container.classList.contains(settings.containerFocusClass)) {
                container.classList.add(settings.containerFocusClass);
            }

            if (placeholder) {
                placeholder.style.opacity = 0;
            }
        }

        /**
         * Sets state of container when blurred
         */
        function _blurInput() {
            input.value = '';
            _setInputWidth();

            if (container.classList.contains(settings.containerFocusClass)) {
                container.classList.remove(settings.containerFocusClass);
            }

            if (!tag.values.length && placeholder) {
                placeholder.style.opacity = 1;
            }
        }

        /**
         * Runs all the events that need to run on keydown
         * @param  {Event} e
         */
         function _keydownEvents(e) {
            e = e || window.event;

            var key = e.keyCode;

            _listenForEndOfContainer();

            if (_isConfirmKey(key) && input.value !== '') {
                _confirmValidTagEvent(e);
                return;
            }

            if (tag.values.length) {
                _checkLastTag(e);
            }
        }

        /**
         * Runs all the events that need to run on keyup
         * @param  {Event} e
         */
        function _keyupEvents(e) {
            e = e || window.event;

            input.classList.remove('taggle_back');

            _setText(sizer, input.value);
        }

        /**
         * Confirms the inputted value to be converted to a tag
         * @param  {Event} e
         * @return {Boolean}
         */
        function _confirmValidTagEvent(e) {
            e = e || window.event;

            _add(e);

            //prevents from jumping out of textarea
            if (e.preventDefault) {
                e.preventDefault();
            }
            else {
                e.returnValue = false;
            }
        }

        /**
         * Approximates when the hidden input should break to the next line
         */
        function _listenForEndOfContainer() {
            var width = sizer.getBoundingClientRect().width,
                max = measurements.container.rect.width - measurements.container.padding,
                size = parseInt(sizer.style.fontSize, 10);

            //1.5 just seems to be a good multiplier here
            if (width + (size * 1.5) > parseInt(input.style.width, 10)) {
                input.style.width = max + 'px';
            }
        }

        function _createTag(text) {
            var li = document.createElement('li'),
                close = document.createElement('a'),
                hidden = document.createElement('input'),
                span = document.createElement('span');

            text = text.toLowerCase();

            close.href = 'javascript:void(0)';
            close.innerHTML = '&times;';
            close.className = 'close';
            close.onclick = _remove.bind(null, close);

            _setText(span, text);
            span.className = 'taggle_text';

            li.className = 'taggle ' + settings.additionalTagClasses;

            hidden.type = 'hidden';
            hidden.value = text;
            hidden.name = settings.hiddenInputName;

            li.appendChild(span);
            li.appendChild(close);
            li.appendChild(hidden);

            tag.values.push(text);
            tag.elements.push(li);

            return li;
        }

        /**
         * Removes tag from the tags collection
         * @param  {li} li List item to remove
         * @param  {Event} e
         */
        function _remove(li, e) {
            var span,
                text;

            if (li.tagName.toLowerCase() !== 'li') {
                li = li.parentNode;
            }

            span = li.querySelector('.taggle_text');
            text = span.innerText || span.textContent;

            settings.onTagRemove(e, text);

            li.parentNode.removeChild(li);
            _removeFromTheTags(li, tag);

            _focusInput();
        }

        self.getTags = function() {
            return tag;
        };

        self.getTagElements = function() {
            return tag.elements;
        };

        self.getTagValues = function() {
            return tag.values;
        };

        self.getInput = function() {
            return input;
        };

        self.getContainer = function() {
            return container;
        };

        self.add = function(text) {
            var is_arr = _isArray(text);

            if (typeof text === 'string') {
                return _add(null, text);
            }

            if (is_arr) {
                for (var i = 0, len = text.length; i < len; i++) {
                    if (typeof text[i] === 'string') {
                        _add(null, text[i]);
                    }
                }
            }

            return self;
        };

        self.remove = function(text, all) {
            var len = tag.values.length - 1,
                found = false;

            while (len > -1) {
                if (tag.values[len] === text) {
                    found = true;
                    _remove(tag.elements[len]);
                }

                if (found && !all) {
                    break;
                }

                len--;
            }

            return self;
        };

        // Bang bang bang skeet skeet
        _init();
    };


    function _extend() {
        if (arguments.length < 2) {
            return;
        }
        var master = arguments[0];
        for (var i = 1, l = arguments.length; i < l; i++) {
            var object = arguments[i];
            for (var key in object) {
                if (object.hasOwnProperty(key)) {
                    master[key] = object[key];
                }
            }
        }

        return master;
    }

    function _isArray(arr) {
        if (Array.isArray) {
            return Array.isArray(arr);
        }
        return Object.prototype.toString.call(arr) === '[object Array]';
    }

    /**
     * Grabs the text from the li item and removes it from global array
     * @param  {Element} el
     */
    function _removeFromTheTags(el, tag) {
        var elem = (el.tagName.toLowerCase() === 'a') ? el.parentNode : el,
            index = tag.elements.indexOf(elem);

        // Going to assume the indicies match for now
        tag.elements.splice(index, 1);
        tag.values.splice(index, 1);
    }

    function _on(element, eventName, handler) {
        if (element.addEventListener) {
            element.addEventListener(eventName, handler, false);
        }
        else if (element.attachEvent) {
            element.attachEvent('on' + eventName, handler);
        }
        else {
            element['on' + eventName] = handler;
        }
    }

    function _trim(str) {
        return str.replace(/^\s+|\s+$/g, '');
    }

    function _setText(el, text) {
        if (window.attachEvent && !window.addEventListener) { // <= IE8
            el.innerText = text;
        }
        else {
            el.textContent = text;
        }
    }

    window.Taggle = Taggle;

}(window, document));

},{}],787:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    if (canPost) {
        var queue = [];
        window.addEventListener('message', function (ev) {
            var source = ev.source;
            if ((source === window || source === null) && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
}

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

},{}],788:[function(require,module,exports){
"use strict";
/*globals Handlebars: true */
var base = require("./handlebars/base");

// Each of these augment the Handlebars object. No need to setup here.
// (This is done to easily share code between commonjs and browse envs)
var SafeString = require("./handlebars/safe-string")["default"];
var Exception = require("./handlebars/exception")["default"];
var Utils = require("./handlebars/utils");
var runtime = require("./handlebars/runtime");

// For compatibility and usage outside of module systems, make the Handlebars object a namespace
var create = function() {
  var hb = new base.HandlebarsEnvironment();

  Utils.extend(hb, base);
  hb.SafeString = SafeString;
  hb.Exception = Exception;
  hb.Utils = Utils;

  hb.VM = runtime;
  hb.template = function(spec) {
    return runtime.template(spec, hb);
  };

  return hb;
};

var Handlebars = create();
Handlebars.create = create;

exports["default"] = Handlebars;
},{"./handlebars/base":789,"./handlebars/exception":790,"./handlebars/runtime":791,"./handlebars/safe-string":792,"./handlebars/utils":793}],789:[function(require,module,exports){
"use strict";
var Utils = require("./utils");
var Exception = require("./exception")["default"];

var VERSION = "1.3.0";
exports.VERSION = VERSION;var COMPILER_REVISION = 4;
exports.COMPILER_REVISION = COMPILER_REVISION;
var REVISION_CHANGES = {
  1: '<= 1.0.rc.2', // 1.0.rc.2 is actually rev2 but doesn't report it
  2: '== 1.0.0-rc.3',
  3: '== 1.0.0-rc.4',
  4: '>= 1.0.0'
};
exports.REVISION_CHANGES = REVISION_CHANGES;
var isArray = Utils.isArray,
    isFunction = Utils.isFunction,
    toString = Utils.toString,
    objectType = '[object Object]';

function HandlebarsEnvironment(helpers, partials) {
  this.helpers = helpers || {};
  this.partials = partials || {};

  registerDefaultHelpers(this);
}

exports.HandlebarsEnvironment = HandlebarsEnvironment;HandlebarsEnvironment.prototype = {
  constructor: HandlebarsEnvironment,

  logger: logger,
  log: log,

  registerHelper: function(name, fn, inverse) {
    if (toString.call(name) === objectType) {
      if (inverse || fn) { throw new Exception('Arg not supported with multiple helpers'); }
      Utils.extend(this.helpers, name);
    } else {
      if (inverse) { fn.not = inverse; }
      this.helpers[name] = fn;
    }
  },

  registerPartial: function(name, str) {
    if (toString.call(name) === objectType) {
      Utils.extend(this.partials,  name);
    } else {
      this.partials[name] = str;
    }
  }
};

function registerDefaultHelpers(instance) {
  instance.registerHelper('helperMissing', function(arg) {
    if(arguments.length === 2) {
      return undefined;
    } else {
      throw new Exception("Missing helper: '" + arg + "'");
    }
  });

  instance.registerHelper('blockHelperMissing', function(context, options) {
    var inverse = options.inverse || function() {}, fn = options.fn;

    if (isFunction(context)) { context = context.call(this); }

    if(context === true) {
      return fn(this);
    } else if(context === false || context == null) {
      return inverse(this);
    } else if (isArray(context)) {
      if(context.length > 0) {
        return instance.helpers.each(context, options);
      } else {
        return inverse(this);
      }
    } else {
      return fn(context);
    }
  });

  instance.registerHelper('each', function(context, options) {
    var fn = options.fn, inverse = options.inverse;
    var i = 0, ret = "", data;

    if (isFunction(context)) { context = context.call(this); }

    if (options.data) {
      data = createFrame(options.data);
    }

    if(context && typeof context === 'object') {
      if (isArray(context)) {
        for(var j = context.length; i<j; i++) {
          if (data) {
            data.index = i;
            data.first = (i === 0);
            data.last  = (i === (context.length-1));
          }
          ret = ret + fn(context[i], { data: data });
        }
      } else {
        for(var key in context) {
          if(context.hasOwnProperty(key)) {
            if(data) { 
              data.key = key; 
              data.index = i;
              data.first = (i === 0);
            }
            ret = ret + fn(context[key], {data: data});
            i++;
          }
        }
      }
    }

    if(i === 0){
      ret = inverse(this);
    }

    return ret;
  });

  instance.registerHelper('if', function(conditional, options) {
    if (isFunction(conditional)) { conditional = conditional.call(this); }

    // Default behavior is to render the positive path if the value is truthy and not empty.
    // The `includeZero` option may be set to treat the condtional as purely not empty based on the
    // behavior of isEmpty. Effectively this determines if 0 is handled by the positive path or negative.
    if ((!options.hash.includeZero && !conditional) || Utils.isEmpty(conditional)) {
      return options.inverse(this);
    } else {
      return options.fn(this);
    }
  });

  instance.registerHelper('unless', function(conditional, options) {
    return instance.helpers['if'].call(this, conditional, {fn: options.inverse, inverse: options.fn, hash: options.hash});
  });

  instance.registerHelper('with', function(context, options) {
    if (isFunction(context)) { context = context.call(this); }

    if (!Utils.isEmpty(context)) return options.fn(context);
  });

  instance.registerHelper('log', function(context, options) {
    var level = options.data && options.data.level != null ? parseInt(options.data.level, 10) : 1;
    instance.log(level, context);
  });
}

var logger = {
  methodMap: { 0: 'debug', 1: 'info', 2: 'warn', 3: 'error' },

  // State enum
  DEBUG: 0,
  INFO: 1,
  WARN: 2,
  ERROR: 3,
  level: 3,

  // can be overridden in the host environment
  log: function(level, obj) {
    if (logger.level <= level) {
      var method = logger.methodMap[level];
      if (typeof console !== 'undefined' && console[method]) {
        console[method].call(console, obj);
      }
    }
  }
};
exports.logger = logger;
function log(level, obj) { logger.log(level, obj); }

exports.log = log;var createFrame = function(object) {
  var obj = {};
  Utils.extend(obj, object);
  return obj;
};
exports.createFrame = createFrame;
},{"./exception":790,"./utils":793}],790:[function(require,module,exports){
"use strict";

var errorProps = ['description', 'fileName', 'lineNumber', 'message', 'name', 'number', 'stack'];

function Exception(message, node) {
  var line;
  if (node && node.firstLine) {
    line = node.firstLine;

    message += ' - ' + line + ':' + node.firstColumn;
  }

  var tmp = Error.prototype.constructor.call(this, message);

  // Unfortunately errors are not enumerable in Chrome (at least), so `for prop in tmp` doesn't work.
  for (var idx = 0; idx < errorProps.length; idx++) {
    this[errorProps[idx]] = tmp[errorProps[idx]];
  }

  if (line) {
    this.lineNumber = line;
    this.column = node.firstColumn;
  }
}

Exception.prototype = new Error();

exports["default"] = Exception;
},{}],791:[function(require,module,exports){
"use strict";
var Utils = require("./utils");
var Exception = require("./exception")["default"];
var COMPILER_REVISION = require("./base").COMPILER_REVISION;
var REVISION_CHANGES = require("./base").REVISION_CHANGES;

function checkRevision(compilerInfo) {
  var compilerRevision = compilerInfo && compilerInfo[0] || 1,
      currentRevision = COMPILER_REVISION;

  if (compilerRevision !== currentRevision) {
    if (compilerRevision < currentRevision) {
      var runtimeVersions = REVISION_CHANGES[currentRevision],
          compilerVersions = REVISION_CHANGES[compilerRevision];
      throw new Exception("Template was precompiled with an older version of Handlebars than the current runtime. "+
            "Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").");
    } else {
      // Use the embedded version info since the runtime doesn't know about this revision yet
      throw new Exception("Template was precompiled with a newer version of Handlebars than the current runtime. "+
            "Please update your runtime to a newer version ("+compilerInfo[1]+").");
    }
  }
}

exports.checkRevision = checkRevision;// TODO: Remove this line and break up compilePartial

function template(templateSpec, env) {
  if (!env) {
    throw new Exception("No environment passed to template");
  }

  // Note: Using env.VM references rather than local var references throughout this section to allow
  // for external users to override these as psuedo-supported APIs.
  var invokePartialWrapper = function(partial, name, context, helpers, partials, data) {
    var result = env.VM.invokePartial.apply(this, arguments);
    if (result != null) { return result; }

    if (env.compile) {
      var options = { helpers: helpers, partials: partials, data: data };
      partials[name] = env.compile(partial, { data: data !== undefined }, env);
      return partials[name](context, options);
    } else {
      throw new Exception("The partial " + name + " could not be compiled when running in runtime-only mode");
    }
  };

  // Just add water
  var container = {
    escapeExpression: Utils.escapeExpression,
    invokePartial: invokePartialWrapper,
    programs: [],
    program: function(i, fn, data) {
      var programWrapper = this.programs[i];
      if(data) {
        programWrapper = program(i, fn, data);
      } else if (!programWrapper) {
        programWrapper = this.programs[i] = program(i, fn);
      }
      return programWrapper;
    },
    merge: function(param, common) {
      var ret = param || common;

      if (param && common && (param !== common)) {
        ret = {};
        Utils.extend(ret, common);
        Utils.extend(ret, param);
      }
      return ret;
    },
    programWithDepth: env.VM.programWithDepth,
    noop: env.VM.noop,
    compilerInfo: null
  };

  return function(context, options) {
    options = options || {};
    var namespace = options.partial ? options : env,
        helpers,
        partials;

    if (!options.partial) {
      helpers = options.helpers;
      partials = options.partials;
    }
    var result = templateSpec.call(
          container,
          namespace, context,
          helpers,
          partials,
          options.data);

    if (!options.partial) {
      env.VM.checkRevision(container.compilerInfo);
    }

    return result;
  };
}

exports.template = template;function programWithDepth(i, fn, data /*, $depth */) {
  var args = Array.prototype.slice.call(arguments, 3);

  var prog = function(context, options) {
    options = options || {};

    return fn.apply(this, [context, options.data || data].concat(args));
  };
  prog.program = i;
  prog.depth = args.length;
  return prog;
}

exports.programWithDepth = programWithDepth;function program(i, fn, data) {
  var prog = function(context, options) {
    options = options || {};

    return fn(context, options.data || data);
  };
  prog.program = i;
  prog.depth = 0;
  return prog;
}

exports.program = program;function invokePartial(partial, name, context, helpers, partials, data) {
  var options = { partial: true, helpers: helpers, partials: partials, data: data };

  if(partial === undefined) {
    throw new Exception("The partial " + name + " could not be found");
  } else if(partial instanceof Function) {
    return partial(context, options);
  }
}

exports.invokePartial = invokePartial;function noop() { return ""; }

exports.noop = noop;
},{"./base":789,"./exception":790,"./utils":793}],792:[function(require,module,exports){
"use strict";
// Build out our basic SafeString type
function SafeString(string) {
  this.string = string;
}

SafeString.prototype.toString = function() {
  return "" + this.string;
};

exports["default"] = SafeString;
},{}],793:[function(require,module,exports){
"use strict";
/*jshint -W004 */
var SafeString = require("./safe-string")["default"];

var escape = {
  "&": "&amp;",
  "<": "&lt;",
  ">": "&gt;",
  '"': "&quot;",
  "'": "&#x27;",
  "`": "&#x60;"
};

var badChars = /[&<>"'`]/g;
var possible = /[&<>"'`]/;

function escapeChar(chr) {
  return escape[chr] || "&amp;";
}

function extend(obj, value) {
  for(var key in value) {
    if(Object.prototype.hasOwnProperty.call(value, key)) {
      obj[key] = value[key];
    }
  }
}

exports.extend = extend;var toString = Object.prototype.toString;
exports.toString = toString;
// Sourced from lodash
// https://github.com/bestiejs/lodash/blob/master/LICENSE.txt
var isFunction = function(value) {
  return typeof value === 'function';
};
// fallback for older versions of Chrome and Safari
if (isFunction(/x/)) {
  isFunction = function(value) {
    return typeof value === 'function' && toString.call(value) === '[object Function]';
  };
}
var isFunction;
exports.isFunction = isFunction;
var isArray = Array.isArray || function(value) {
  return (value && typeof value === 'object') ? toString.call(value) === '[object Array]' : false;
};
exports.isArray = isArray;

function escapeExpression(string) {
  // don't escape SafeStrings, since they're already safe
  if (string instanceof SafeString) {
    return string.toString();
  } else if (!string && string !== 0) {
    return "";
  }

  // Force a string conversion as this will be done by the append regardless and
  // the regex test will do this transparently behind the scenes, causing issues if
  // an object's to string has escaped characters in it.
  string = "" + string;

  if(!possible.test(string)) { return string; }
  return string.replace(badChars, escapeChar);
}

exports.escapeExpression = escapeExpression;function isEmpty(value) {
  if (!value && value !== 0) {
    return true;
  } else if (isArray(value) && value.length === 0) {
    return true;
  } else {
    return false;
  }
}

exports.isEmpty = isEmpty;
},{"./safe-string":792}],794:[function(require,module,exports){
// Create a simple path alias to allow browserify to resolve
// the runtime on a supported path.
module.exports = require('./dist/cjs/handlebars.runtime');

},{"./dist/cjs/handlebars.runtime":788}],795:[function(require,module,exports){
module.exports = require("handlebars/runtime")["default"];

},{"handlebars/runtime":794}]},{},[1,2,"wP9Fvu","GaC0VN","UQqhgU","EnhJGH","rplz2l","POBnuo","ACyywb","0hvB+t","I1qtaK","r8Cpl5","srJZrP","j+DEja","svD88M","1qSlK6","mtRlGp","clXari","ueWto2","dkDAy5","NtLx2I","9FDYms","GutTFp","4vd+/e","uALb3R","hShYzq","MIZV2H","SgcMXx","aBON5c","LbDTXs","PTNjgv","juhPJu","rjdrI+","zQih3N","SuAmUW","+pzGf1","tPjidB","JwTF1w","AZ40Zy","iOvw+V","ZRDRht","VUNDlD","Qt5eXh","y/4jgE","+uT6o6","cwRVAT","xwdIac","cbCaNc","H6uCQL","7hLvyS","d7M8RW","9+Xvh+","PGIivx","sKvE54","e6juNz","pud4fq","j+kYkd",113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670,671,672,673,674,675,676,677,678,679,680,681,682,683,684,685,686,687,688,689,690,691,692,693,694,695,696,697,698,699,700,701,702,703,704,705,706,707,708,709,710,711,712,713,714,715,716,717,718,719,720,721,722,723,724,725,726,727,728,729,730,731,732,733,734,735,736,737,738,739,740,741,742,743,744,745,746,747,748,749,750,751,"v9Hzkf","XjqDnL","kQH+b8","62Mg0q","45cXq2","1wKSJJ","qVK48r","KdOu1R","huS0dS","Pg+1ZR","fo3zxY","U9Rbn5","JK9IfS","LKkC8l","wS2lun","GDieB0","gSF+Uz","XRA0Mh","wGBM6u","eWqpRj","jni7cJ","AeJ6AV","aqcPfP","chmTLy","ELjGRo","Y9MR1R","yF4o8J","gyUW2M","jLYzvb","q0Wl2K","6YMx7Y","x+VomS","EJ14Jg","cxTEmX","nbBTjM","9Wl2XC","3mMLj9","R0qHUj","+XkjfT","4V7FHU","OdnYj5","Msiax0","HAzkOi","8uvyxu","v//HrN","EFUzNh","1MVWwf","/irXeG","wRua1N","yh+e2b","W8dktp","tHM+Gb","5Wf+xl","smv2ra","GVOLL+","G46BbM","/qq0tH","jeb2CH","AeNRLl","9vl5FX","0bWuty","f6CcVt","IssChc","VHyB0o","jBDgCO","pb5Xon","gxkJ4E","DuMpgn","LyXdyy","e5FUOS","TDFRAI","dGXMmo","+e+sDE","5XIoxk","Kxz49+","92Q5ld","uhDMwl","3/QYti","9JAUXg","0RNmO8","3RW9j/","nKeBKw","7zsOPi","UrF83T","Ky7ppy","fthgkn","dSMe6b","L5TBu7","wtMQFi","0O1UkF","q3lpIL","tiSUGe","1O6wZw","Luh4xE","34Eu8w","4p1x6f","uvkCgU","n/Xovh","Jz0bH1","xs5UGO","4dgVDP","yeeyow","kKoRAt","7N+aXr","m/nrZl","Evosrg","nsisvZ","RMVmwV","7FUspW","hwHhgx","DcknTu","yiPzq7","4cyEb0","C38HGo","bGgEdN","UGUm2P","kSD+R2","w8x+Vh","kb3pIP","vm4Js2","nS+p/4","3BMWhH","dbnpZQ","5En4+Q","gdZoxc","m9/vGu","YTHXpB","BzgELe","btUDe3","gd5aiD","ekJUze","NhB93R","BpQ4rp","gdA3gc","S4IyE7","xlwKNq","XEVIu8","89VASx","LF3J/5","K+Jvgp","QssV0E","zPE/Ad","ibXKH5","nTShuv","JW/nJo","cSFr39","jMtiWN","gR/Mei","3++Z21","791uzM","v+GOEy","nq9eAH","b5bLFN","cwmSEi","B5PV0U","RCUi24","7YrkBc","tvO3BP","txn0ZT","yJ+Woq","JtT1E7","/vDAbC","b8XC8z","j9k2Ez","blWMNz"])